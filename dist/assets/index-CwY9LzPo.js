function Mj(u,o){for(var d=0;d<o.length;d++){const g=o[d];if(typeof g!="string"&&!Array.isArray(g)){for(const j in g)if(j!=="default"&&!(j in u)){const Z=Object.getOwnPropertyDescriptor(g,j);Z&&Object.defineProperty(u,j,Z.get?Z:{enumerable:!0,get:()=>g[j]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))g(j);new MutationObserver(j=>{for(const Z of j)if(Z.type==="childList")for(const S of Z.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&g(S)}).observe(document,{childList:!0,subtree:!0});function d(j){const Z={};return j.integrity&&(Z.integrity=j.integrity),j.referrerPolicy&&(Z.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?Z.credentials="include":j.crossOrigin==="anonymous"?Z.credentials="omit":Z.credentials="same-origin",Z}function g(j){if(j.ep)return;j.ep=!0;const Z=d(j);fetch(j.href,Z)}})();function ry(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}function $A(u){if(Object.prototype.hasOwnProperty.call(u,"__esModule"))return u;var o=u.default;if(typeof o=="function"){var d=function g(){var j=!1;try{j=this instanceof g}catch{}return j?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};d.prototype=o.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(u).forEach(function(g){var j=Object.getOwnPropertyDescriptor(u,g);Object.defineProperty(d,g,j.get?j:{enumerable:!0,get:function(){return u[g]}})}),d}var kx={exports:{}},tg={},Jx={exports:{}},Sn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A3;function qA(){if(A3)return Sn;A3=1;var u=Symbol.for("react.element"),o=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),Z=Symbol.for("react.provider"),S=Symbol.for("react.context"),n=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),D=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),G=Symbol.iterator;function Y(Ye){return Ye===null||typeof Ye!="object"?null:(Ye=G&&Ye[G]||Ye["@@iterator"],typeof Ye=="function"?Ye:null)}var X={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ue=Object.assign,oe={};function pe(Ye,wt,Be){this.props=Ye,this.context=wt,this.refs=oe,this.updater=Be||X}pe.prototype.isReactComponent={},pe.prototype.setState=function(Ye,wt){if(typeof Ye!="object"&&typeof Ye!="function"&&Ye!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ye,wt,"setState")},pe.prototype.forceUpdate=function(Ye){this.updater.enqueueForceUpdate(this,Ye,"forceUpdate")};function ve(){}ve.prototype=pe.prototype;function ke(Ye,wt,Be){this.props=Ye,this.context=wt,this.refs=oe,this.updater=Be||X}var ye=ke.prototype=new ve;ye.constructor=ke,ue(ye,pe.prototype),ye.isPureReactComponent=!0;var $e=Array.isArray,De=Object.prototype.hasOwnProperty,Te={current:null},Qe={key:!0,ref:!0,__self:!0,__source:!0};function Ft(Ye,wt,Be){var ba,lr={},Ja=null,Er=null;if(wt!=null)for(ba in wt.ref!==void 0&&(Er=wt.ref),wt.key!==void 0&&(Ja=""+wt.key),wt)De.call(wt,ba)&&!Qe.hasOwnProperty(ba)&&(lr[ba]=wt[ba]);var or=arguments.length-2;if(or===1)lr.children=Be;else if(1<or){for(var ka=Array(or),gr=0;gr<or;gr++)ka[gr]=arguments[gr+2];lr.children=ka}if(Ye&&Ye.defaultProps)for(ba in or=Ye.defaultProps,or)lr[ba]===void 0&&(lr[ba]=or[ba]);return{$$typeof:u,type:Ye,key:Ja,ref:Er,props:lr,_owner:Te.current}}function bt(Ye,wt){return{$$typeof:u,type:Ye.type,key:wt,ref:Ye.ref,props:Ye.props,_owner:Ye._owner}}function Qt(Ye){return typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===u}function Gt(Ye){var wt={"=":"=0",":":"=2"};return"$"+Ye.replace(/[=:]/g,function(Be){return wt[Be]})}var yt=/\/+/g;function Ke(Ye,wt){return typeof Ye=="object"&&Ye!==null&&Ye.key!=null?Gt(""+Ye.key):wt.toString(36)}function st(Ye,wt,Be,ba,lr){var Ja=typeof Ye;(Ja==="undefined"||Ja==="boolean")&&(Ye=null);var Er=!1;if(Ye===null)Er=!0;else switch(Ja){case"string":case"number":Er=!0;break;case"object":switch(Ye.$$typeof){case u:case o:Er=!0}}if(Er)return Er=Ye,lr=lr(Er),Ye=ba===""?"."+Ke(Er,0):ba,$e(lr)?(Be="",Ye!=null&&(Be=Ye.replace(yt,"$&/")+"/"),st(lr,wt,Be,"",function(gr){return gr})):lr!=null&&(Qt(lr)&&(lr=bt(lr,Be+(!lr.key||Er&&Er.key===lr.key?"":(""+lr.key).replace(yt,"$&/")+"/")+Ye)),wt.push(lr)),1;if(Er=0,ba=ba===""?".":ba+":",$e(Ye))for(var or=0;or<Ye.length;or++){Ja=Ye[or];var ka=ba+Ke(Ja,or);Er+=st(Ja,wt,Be,ka,lr)}else if(ka=Y(Ye),typeof ka=="function")for(Ye=ka.call(Ye),or=0;!(Ja=Ye.next()).done;)Ja=Ja.value,ka=ba+Ke(Ja,or++),Er+=st(Ja,wt,Be,ka,lr);else if(Ja==="object")throw wt=String(Ye),Error("Objects are not valid as a React child (found: "+(wt==="[object Object]"?"object with keys {"+Object.keys(Ye).join(", ")+"}":wt)+"). If you meant to render a collection of children, use an array instead.");return Er}function ht(Ye,wt,Be){if(Ye==null)return Ye;var ba=[],lr=0;return st(Ye,ba,"","",function(Ja){return wt.call(Be,Ja,lr++)}),ba}function Wt(Ye){if(Ye._status===-1){var wt=Ye._result;wt=wt(),wt.then(function(Be){(Ye._status===0||Ye._status===-1)&&(Ye._status=1,Ye._result=Be)},function(Be){(Ye._status===0||Ye._status===-1)&&(Ye._status=2,Ye._result=Be)}),Ye._status===-1&&(Ye._status=0,Ye._result=wt)}if(Ye._status===1)return Ye._result.default;throw Ye._result}var qt={current:null},Lt={transition:null},mt={ReactCurrentDispatcher:qt,ReactCurrentBatchConfig:Lt,ReactCurrentOwner:Te};function ze(){throw Error("act(...) is not supported in production builds of React.")}return Sn.Children={map:ht,forEach:function(Ye,wt,Be){ht(Ye,function(){wt.apply(this,arguments)},Be)},count:function(Ye){var wt=0;return ht(Ye,function(){wt++}),wt},toArray:function(Ye){return ht(Ye,function(wt){return wt})||[]},only:function(Ye){if(!Qt(Ye))throw Error("React.Children.only expected to receive a single React element child.");return Ye}},Sn.Component=pe,Sn.Fragment=d,Sn.Profiler=j,Sn.PureComponent=ke,Sn.StrictMode=g,Sn.Suspense=B,Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mt,Sn.act=ze,Sn.cloneElement=function(Ye,wt,Be){if(Ye==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ye+".");var ba=ue({},Ye.props),lr=Ye.key,Ja=Ye.ref,Er=Ye._owner;if(wt!=null){if(wt.ref!==void 0&&(Ja=wt.ref,Er=Te.current),wt.key!==void 0&&(lr=""+wt.key),Ye.type&&Ye.type.defaultProps)var or=Ye.type.defaultProps;for(ka in wt)De.call(wt,ka)&&!Qe.hasOwnProperty(ka)&&(ba[ka]=wt[ka]===void 0&&or!==void 0?or[ka]:wt[ka])}var ka=arguments.length-2;if(ka===1)ba.children=Be;else if(1<ka){or=Array(ka);for(var gr=0;gr<ka;gr++)or[gr]=arguments[gr+2];ba.children=or}return{$$typeof:u,type:Ye.type,key:lr,ref:Ja,props:ba,_owner:Er}},Sn.createContext=function(Ye){return Ye={$$typeof:S,_currentValue:Ye,_currentValue2:Ye,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ye.Provider={$$typeof:Z,_context:Ye},Ye.Consumer=Ye},Sn.createElement=Ft,Sn.createFactory=function(Ye){var wt=Ft.bind(null,Ye);return wt.type=Ye,wt},Sn.createRef=function(){return{current:null}},Sn.forwardRef=function(Ye){return{$$typeof:n,render:Ye}},Sn.isValidElement=Qt,Sn.lazy=function(Ye){return{$$typeof:P,_payload:{_status:-1,_result:Ye},_init:Wt}},Sn.memo=function(Ye,wt){return{$$typeof:D,type:Ye,compare:wt===void 0?null:wt}},Sn.startTransition=function(Ye){var wt=Lt.transition;Lt.transition={};try{Ye()}finally{Lt.transition=wt}},Sn.unstable_act=ze,Sn.useCallback=function(Ye,wt){return qt.current.useCallback(Ye,wt)},Sn.useContext=function(Ye){return qt.current.useContext(Ye)},Sn.useDebugValue=function(){},Sn.useDeferredValue=function(Ye){return qt.current.useDeferredValue(Ye)},Sn.useEffect=function(Ye,wt){return qt.current.useEffect(Ye,wt)},Sn.useId=function(){return qt.current.useId()},Sn.useImperativeHandle=function(Ye,wt,Be){return qt.current.useImperativeHandle(Ye,wt,Be)},Sn.useInsertionEffect=function(Ye,wt){return qt.current.useInsertionEffect(Ye,wt)},Sn.useLayoutEffect=function(Ye,wt){return qt.current.useLayoutEffect(Ye,wt)},Sn.useMemo=function(Ye,wt){return qt.current.useMemo(Ye,wt)},Sn.useReducer=function(Ye,wt,Be){return qt.current.useReducer(Ye,wt,Be)},Sn.useRef=function(Ye){return qt.current.useRef(Ye)},Sn.useState=function(Ye){return qt.current.useState(Ye)},Sn.useSyncExternalStore=function(Ye,wt,Be){return qt.current.useSyncExternalStore(Ye,wt,Be)},Sn.useTransition=function(){return qt.current.useTransition()},Sn.version="18.3.1",Sn}var R3;function qw(){return R3||(R3=1,Jx.exports=qA()),Jx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T3;function KA(){if(T3)return tg;T3=1;var u=qw(),o=Symbol.for("react.element"),d=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,j=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Z={key:!0,ref:!0,__self:!0,__source:!0};function S(n,B,D){var P,G={},Y=null,X=null;D!==void 0&&(Y=""+D),B.key!==void 0&&(Y=""+B.key),B.ref!==void 0&&(X=B.ref);for(P in B)g.call(B,P)&&!Z.hasOwnProperty(P)&&(G[P]=B[P]);if(n&&n.defaultProps)for(P in B=n.defaultProps,B)G[P]===void 0&&(G[P]=B[P]);return{$$typeof:o,type:n,key:Y,ref:X,props:G,_owner:j.current}}return tg.Fragment=d,tg.jsx=S,tg.jsxs=S,tg}var V3;function eR(){return V3||(V3=1,kx.exports=KA()),kx.exports}var l=eR(),fe=qw();const mi=ry(fe),tR=Mj({__proto__:null,default:mi},[fe]);var Z0={},Fx={exports:{}},Ol={},Ox={exports:{}},Dx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M3;function aR(){return M3||(M3=1,function(u){function o(Lt,mt){var ze=Lt.length;Lt.push(mt);e:for(;0<ze;){var Ye=ze-1>>>1,wt=Lt[Ye];if(0<j(wt,mt))Lt[Ye]=mt,Lt[ze]=wt,ze=Ye;else break e}}function d(Lt){return Lt.length===0?null:Lt[0]}function g(Lt){if(Lt.length===0)return null;var mt=Lt[0],ze=Lt.pop();if(ze!==mt){Lt[0]=ze;e:for(var Ye=0,wt=Lt.length,Be=wt>>>1;Ye<Be;){var ba=2*(Ye+1)-1,lr=Lt[ba],Ja=ba+1,Er=Lt[Ja];if(0>j(lr,ze))Ja<wt&&0>j(Er,lr)?(Lt[Ye]=Er,Lt[Ja]=ze,Ye=Ja):(Lt[Ye]=lr,Lt[ba]=ze,Ye=ba);else if(Ja<wt&&0>j(Er,ze))Lt[Ye]=Er,Lt[Ja]=ze,Ye=Ja;else break e}}return mt}function j(Lt,mt){var ze=Lt.sortIndex-mt.sortIndex;return ze!==0?ze:Lt.id-mt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Z=performance;u.unstable_now=function(){return Z.now()}}else{var S=Date,n=S.now();u.unstable_now=function(){return S.now()-n}}var B=[],D=[],P=1,G=null,Y=3,X=!1,ue=!1,oe=!1,pe=typeof setTimeout=="function"?setTimeout:null,ve=typeof clearTimeout=="function"?clearTimeout:null,ke=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ye(Lt){for(var mt=d(D);mt!==null;){if(mt.callback===null)g(D);else if(mt.startTime<=Lt)g(D),mt.sortIndex=mt.expirationTime,o(B,mt);else break;mt=d(D)}}function $e(Lt){if(oe=!1,ye(Lt),!ue)if(d(B)!==null)ue=!0,Wt(De);else{var mt=d(D);mt!==null&&qt($e,mt.startTime-Lt)}}function De(Lt,mt){ue=!1,oe&&(oe=!1,ve(Ft),Ft=-1),X=!0;var ze=Y;try{for(ye(mt),G=d(B);G!==null&&(!(G.expirationTime>mt)||Lt&&!Gt());){var Ye=G.callback;if(typeof Ye=="function"){G.callback=null,Y=G.priorityLevel;var wt=Ye(G.expirationTime<=mt);mt=u.unstable_now(),typeof wt=="function"?G.callback=wt:G===d(B)&&g(B),ye(mt)}else g(B);G=d(B)}if(G!==null)var Be=!0;else{var ba=d(D);ba!==null&&qt($e,ba.startTime-mt),Be=!1}return Be}finally{G=null,Y=ze,X=!1}}var Te=!1,Qe=null,Ft=-1,bt=5,Qt=-1;function Gt(){return!(u.unstable_now()-Qt<bt)}function yt(){if(Qe!==null){var Lt=u.unstable_now();Qt=Lt;var mt=!0;try{mt=Qe(!0,Lt)}finally{mt?Ke():(Te=!1,Qe=null)}}else Te=!1}var Ke;if(typeof ke=="function")Ke=function(){ke(yt)};else if(typeof MessageChannel<"u"){var st=new MessageChannel,ht=st.port2;st.port1.onmessage=yt,Ke=function(){ht.postMessage(null)}}else Ke=function(){pe(yt,0)};function Wt(Lt){Qe=Lt,Te||(Te=!0,Ke())}function qt(Lt,mt){Ft=pe(function(){Lt(u.unstable_now())},mt)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Lt){Lt.callback=null},u.unstable_continueExecution=function(){ue||X||(ue=!0,Wt(De))},u.unstable_forceFrameRate=function(Lt){0>Lt||125<Lt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):bt=0<Lt?Math.floor(1e3/Lt):5},u.unstable_getCurrentPriorityLevel=function(){return Y},u.unstable_getFirstCallbackNode=function(){return d(B)},u.unstable_next=function(Lt){switch(Y){case 1:case 2:case 3:var mt=3;break;default:mt=Y}var ze=Y;Y=mt;try{return Lt()}finally{Y=ze}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(Lt,mt){switch(Lt){case 1:case 2:case 3:case 4:case 5:break;default:Lt=3}var ze=Y;Y=Lt;try{return mt()}finally{Y=ze}},u.unstable_scheduleCallback=function(Lt,mt,ze){var Ye=u.unstable_now();switch(typeof ze=="object"&&ze!==null?(ze=ze.delay,ze=typeof ze=="number"&&0<ze?Ye+ze:Ye):ze=Ye,Lt){case 1:var wt=-1;break;case 2:wt=250;break;case 5:wt=1073741823;break;case 4:wt=1e4;break;default:wt=5e3}return wt=ze+wt,Lt={id:P++,callback:mt,priorityLevel:Lt,startTime:ze,expirationTime:wt,sortIndex:-1},ze>Ye?(Lt.sortIndex=ze,o(D,Lt),d(B)===null&&Lt===d(D)&&(oe?(ve(Ft),Ft=-1):oe=!0,qt($e,ze-Ye))):(Lt.sortIndex=wt,o(B,Lt),ue||X||(ue=!0,Wt(De))),Lt},u.unstable_shouldYield=Gt,u.unstable_wrapCallback=function(Lt){var mt=Y;return function(){var ze=Y;Y=mt;try{return Lt.apply(this,arguments)}finally{Y=ze}}}}(Dx)),Dx}var B3;function rR(){return B3||(B3=1,Ox.exports=aR()),Ox.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I3;function nR(){if(I3)return Ol;I3=1;var u=qw(),o=rR();function d(y){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+y,z=1;z<arguments.length;z++)v+="&args[]="+encodeURIComponent(arguments[z]);return"Minified React error #"+y+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g=new Set,j={};function Z(y,v){S(y,v),S(y+"Capture",v)}function S(y,v){for(j[y]=v,y=0;y<v.length;y++)g.add(v[y])}var n=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),B=Object.prototype.hasOwnProperty,D=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,P={},G={};function Y(y){return B.call(G,y)?!0:B.call(P,y)?!1:D.test(y)?G[y]=!0:(P[y]=!0,!1)}function X(y,v,z,k){if(z!==null&&z.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return k?!1:z!==null?!z.acceptsBooleans:(y=y.toLowerCase().slice(0,5),y!=="data-"&&y!=="aria-");default:return!1}}function ue(y,v,z,k){if(v===null||typeof v>"u"||X(y,v,z,k))return!0;if(k)return!1;if(z!==null)switch(z.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function oe(y,v,z,k,W,ee,be){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=k,this.attributeNamespace=W,this.mustUseProperty=z,this.propertyName=y,this.type=v,this.sanitizeURL=ee,this.removeEmptyString=be}var pe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(y){pe[y]=new oe(y,0,!1,y,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(y){var v=y[0];pe[v]=new oe(v,1,!1,y[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(y){pe[y]=new oe(y,2,!1,y.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(y){pe[y]=new oe(y,2,!1,y,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(y){pe[y]=new oe(y,3,!1,y.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(y){pe[y]=new oe(y,3,!0,y,null,!1,!1)}),["capture","download"].forEach(function(y){pe[y]=new oe(y,4,!1,y,null,!1,!1)}),["cols","rows","size","span"].forEach(function(y){pe[y]=new oe(y,6,!1,y,null,!1,!1)}),["rowSpan","start"].forEach(function(y){pe[y]=new oe(y,5,!1,y.toLowerCase(),null,!1,!1)});var ve=/[\-:]([a-z])/g;function ke(y){return y[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(y){var v=y.replace(ve,ke);pe[v]=new oe(v,1,!1,y,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(y){var v=y.replace(ve,ke);pe[v]=new oe(v,1,!1,y,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(y){var v=y.replace(ve,ke);pe[v]=new oe(v,1,!1,y,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(y){pe[y]=new oe(y,1,!1,y.toLowerCase(),null,!1,!1)}),pe.xlinkHref=new oe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(y){pe[y]=new oe(y,1,!1,y.toLowerCase(),null,!0,!0)});function ye(y,v,z,k){var W=pe.hasOwnProperty(v)?pe[v]:null;(W!==null?W.type!==0:k||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(ue(v,z,W,k)&&(z=null),k||W===null?Y(v)&&(z===null?y.removeAttribute(v):y.setAttribute(v,""+z)):W.mustUseProperty?y[W.propertyName]=z===null?W.type===3?!1:"":z:(v=W.attributeName,k=W.attributeNamespace,z===null?y.removeAttribute(v):(W=W.type,z=W===3||W===4&&z===!0?"":""+z,k?y.setAttributeNS(k,v,z):y.setAttribute(v,z))))}var $e=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,De=Symbol.for("react.element"),Te=Symbol.for("react.portal"),Qe=Symbol.for("react.fragment"),Ft=Symbol.for("react.strict_mode"),bt=Symbol.for("react.profiler"),Qt=Symbol.for("react.provider"),Gt=Symbol.for("react.context"),yt=Symbol.for("react.forward_ref"),Ke=Symbol.for("react.suspense"),st=Symbol.for("react.suspense_list"),ht=Symbol.for("react.memo"),Wt=Symbol.for("react.lazy"),qt=Symbol.for("react.offscreen"),Lt=Symbol.iterator;function mt(y){return y===null||typeof y!="object"?null:(y=Lt&&y[Lt]||y["@@iterator"],typeof y=="function"?y:null)}var ze=Object.assign,Ye;function wt(y){if(Ye===void 0)try{throw Error()}catch(z){var v=z.stack.trim().match(/\n( *(at )?)/);Ye=v&&v[1]||""}return`
`+Ye+y}var Be=!1;function ba(y,v){if(!y||Be)return"";Be=!0;var z=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Ut){var k=Ut}Reflect.construct(y,[],v)}else{try{v.call()}catch(Ut){k=Ut}y.call(v.prototype)}else{try{throw Error()}catch(Ut){k=Ut}y()}}catch(Ut){if(Ut&&k&&typeof Ut.stack=="string"){for(var W=Ut.stack.split(`
`),ee=k.stack.split(`
`),be=W.length-1,He=ee.length-1;1<=be&&0<=He&&W[be]!==ee[He];)He--;for(;1<=be&&0<=He;be--,He--)if(W[be]!==ee[He]){if(be!==1||He!==1)do if(be--,He--,0>He||W[be]!==ee[He]){var lt=`
`+W[be].replace(" at new "," at ");return y.displayName&&lt.includes("<anonymous>")&&(lt=lt.replace("<anonymous>",y.displayName)),lt}while(1<=be&&0<=He);break}}}finally{Be=!1,Error.prepareStackTrace=z}return(y=y?y.displayName||y.name:"")?wt(y):""}function lr(y){switch(y.tag){case 5:return wt(y.type);case 16:return wt("Lazy");case 13:return wt("Suspense");case 19:return wt("SuspenseList");case 0:case 2:case 15:return y=ba(y.type,!1),y;case 11:return y=ba(y.type.render,!1),y;case 1:return y=ba(y.type,!0),y;default:return""}}function Ja(y){if(y==null)return null;if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case Qe:return"Fragment";case Te:return"Portal";case bt:return"Profiler";case Ft:return"StrictMode";case Ke:return"Suspense";case st:return"SuspenseList"}if(typeof y=="object")switch(y.$$typeof){case Gt:return(y.displayName||"Context")+".Consumer";case Qt:return(y._context.displayName||"Context")+".Provider";case yt:var v=y.render;return y=y.displayName,y||(y=v.displayName||v.name||"",y=y!==""?"ForwardRef("+y+")":"ForwardRef"),y;case ht:return v=y.displayName||null,v!==null?v:Ja(y.type)||"Memo";case Wt:v=y._payload,y=y._init;try{return Ja(y(v))}catch{}}return null}function Er(y){var v=y.type;switch(y.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return y=v.render,y=y.displayName||y.name||"",v.displayName||(y!==""?"ForwardRef("+y+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ja(v);case 8:return v===Ft?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function or(y){switch(typeof y){case"boolean":case"number":case"string":case"undefined":return y;case"object":return y;default:return""}}function ka(y){var v=y.type;return(y=y.nodeName)&&y.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function gr(y){var v=ka(y)?"checked":"value",z=Object.getOwnPropertyDescriptor(y.constructor.prototype,v),k=""+y[v];if(!y.hasOwnProperty(v)&&typeof z<"u"&&typeof z.get=="function"&&typeof z.set=="function"){var W=z.get,ee=z.set;return Object.defineProperty(y,v,{configurable:!0,get:function(){return W.call(this)},set:function(be){k=""+be,ee.call(this,be)}}),Object.defineProperty(y,v,{enumerable:z.enumerable}),{getValue:function(){return k},setValue:function(be){k=""+be},stopTracking:function(){y._valueTracker=null,delete y[v]}}}}function Pn(y){y._valueTracker||(y._valueTracker=gr(y))}function qo(y){if(!y)return!1;var v=y._valueTracker;if(!v)return!0;var z=v.getValue(),k="";return y&&(k=ka(y)?y.checked?"true":"false":y.value),y=k,y!==z?(v.setValue(y),!0):!1}function ln(y){if(y=y||(typeof document<"u"?document:void 0),typeof y>"u")return null;try{return y.activeElement||y.body}catch{return y.body}}function bs(y,v){var z=v.checked;return ze({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:z??y._wrapperState.initialChecked})}function Xr(y,v){var z=v.defaultValue==null?"":v.defaultValue,k=v.checked!=null?v.checked:v.defaultChecked;z=or(v.value!=null?v.value:z),y._wrapperState={initialChecked:k,initialValue:z,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function Gn(y,v){v=v.checked,v!=null&&ye(y,"checked",v,!1)}function rn(y,v){Gn(y,v);var z=or(v.value),k=v.type;if(z!=null)k==="number"?(z===0&&y.value===""||y.value!=z)&&(y.value=""+z):y.value!==""+z&&(y.value=""+z);else if(k==="submit"||k==="reset"){y.removeAttribute("value");return}v.hasOwnProperty("value")?pi(y,v.type,z):v.hasOwnProperty("defaultValue")&&pi(y,v.type,or(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(y.defaultChecked=!!v.defaultChecked)}function Sr(y,v,z){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var k=v.type;if(!(k!=="submit"&&k!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+y._wrapperState.initialValue,z||v===y.value||(y.value=v),y.defaultValue=v}z=y.name,z!==""&&(y.name=""),y.defaultChecked=!!y._wrapperState.initialChecked,z!==""&&(y.name=z)}function pi(y,v,z){(v!=="number"||ln(y.ownerDocument)!==y)&&(z==null?y.defaultValue=""+y._wrapperState.initialValue:y.defaultValue!==""+z&&(y.defaultValue=""+z))}var di=Array.isArray;function Tn(y,v,z,k){if(y=y.options,v){v={};for(var W=0;W<z.length;W++)v["$"+z[W]]=!0;for(z=0;z<y.length;z++)W=v.hasOwnProperty("$"+y[z].value),y[z].selected!==W&&(y[z].selected=W),W&&k&&(y[z].defaultSelected=!0)}else{for(z=""+or(z),v=null,W=0;W<y.length;W++){if(y[W].value===z){y[W].selected=!0,k&&(y[W].defaultSelected=!0);return}v!==null||y[W].disabled||(v=y[W])}v!==null&&(v.selected=!0)}}function cs(y,v){if(v.dangerouslySetInnerHTML!=null)throw Error(d(91));return ze({},v,{value:void 0,defaultValue:void 0,children:""+y._wrapperState.initialValue})}function Ls(y,v){var z=v.value;if(z==null){if(z=v.children,v=v.defaultValue,z!=null){if(v!=null)throw Error(d(92));if(di(z)){if(1<z.length)throw Error(d(93));z=z[0]}v=z}v==null&&(v=""),z=v}y._wrapperState={initialValue:or(z)}}function Xi(y,v){var z=or(v.value),k=or(v.defaultValue);z!=null&&(z=""+z,z!==y.value&&(y.value=z),v.defaultValue==null&&y.defaultValue!==z&&(y.defaultValue=z)),k!=null&&(y.defaultValue=""+k)}function Ko(y){var v=y.textContent;v===y._wrapperState.initialValue&&v!==""&&v!==null&&(y.value=v)}function aa(y){switch(y){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function La(y,v){return y==null||y==="http://www.w3.org/1999/xhtml"?aa(v):y==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":y}var hr,wr=function(y){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,z,k,W){MSApp.execUnsafeLocalFunction(function(){return y(v,z,k,W)})}:y}(function(y,v){if(y.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in y)y.innerHTML=v;else{for(hr=hr||document.createElement("div"),hr.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=hr.firstChild;y.firstChild;)y.removeChild(y.firstChild);for(;v.firstChild;)y.appendChild(v.firstChild)}});function nn(y,v){if(v){var z=y.firstChild;if(z&&z===y.lastChild&&z.nodeType===3){z.nodeValue=v;return}}y.textContent=v}var ni={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Gs=["Webkit","ms","Moz","O"];Object.keys(ni).forEach(function(y){Gs.forEach(function(v){v=v+y.charAt(0).toUpperCase()+y.substring(1),ni[v]=ni[y]})});function us(y,v,z){return v==null||typeof v=="boolean"||v===""?"":z||typeof v!="number"||v===0||ni.hasOwnProperty(y)&&ni[y]?(""+v).trim():v+"px"}function kn(y,v){y=y.style;for(var z in v)if(v.hasOwnProperty(z)){var k=z.indexOf("--")===0,W=us(z,v[z],k);z==="float"&&(z="cssFloat"),k?y.setProperty(z,W):y[z]=W}}var co=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zi(y,v){if(v){if(co[y]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(d(137,y));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(d(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(d(61))}if(v.style!=null&&typeof v.style!="object")throw Error(d(62))}}function ts(y,v){if(y.indexOf("-")===-1)return typeof v.is=="string";switch(y){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yi=null;function Us(y){return y=y.target||y.srcElement||window,y.correspondingUseElement&&(y=y.correspondingUseElement),y.nodeType===3?y.parentNode:y}var Ln=null,gi=null,zo=null;function Xl(y){if(y=pd(y)){if(typeof Ln!="function")throw Error(d(280));var v=y.stateNode;v&&(v=wu(v),Ln(y.stateNode,y.type,v))}}function Ws(y){gi?zo?zo.push(y):zo=[y]:gi=y}function $d(){if(gi){var y=gi,v=zo;if(zo=gi=null,Xl(y),v)for(y=0;y<v.length;y++)Xl(v[y])}}function Yu(y,v){return y(v)}function Hh(){}var bc=!1;function St(y,v,z){if(bc)return y(v,z);bc=!0;try{return Yu(y,v,z)}finally{bc=!1,(gi!==null||zo!==null)&&(Hh(),$d())}}function uo(y,v){var z=y.stateNode;if(z===null)return null;var k=wu(z);if(k===null)return null;z=k[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(y=y.type,k=!(y==="button"||y==="input"||y==="select"||y==="textarea")),y=!k;break e;default:y=!1}if(y)return null;if(z&&typeof z!="function")throw Error(d(231,v,typeof z));return z}var tu=!1;if(n)try{var Ql={};Object.defineProperty(Ql,"passive",{get:function(){tu=!0}}),window.addEventListener("test",Ql,Ql),window.removeEventListener("test",Ql,Ql)}catch{tu=!1}function fr(y,v,z,k,W,ee,be,He,lt){var Ut=Array.prototype.slice.call(arguments,3);try{v.apply(z,Ut)}catch(ga){this.onError(ga)}}var Vi=!1,$u=null,Lc=!1,Ge=null,te={onError:function(y){Vi=!0,$u=y}};function re(y,v,z,k,W,ee,be,He,lt){Vi=!1,$u=null,fr.apply(te,arguments)}function xe(y,v,z,k,W,ee,be,He,lt){if(re.apply(this,arguments),Vi){if(Vi){var Ut=$u;Vi=!1,$u=null}else throw Error(d(198));Lc||(Lc=!0,Ge=Ut)}}function Ve(y){var v=y,z=y;if(y.alternate)for(;v.return;)v=v.return;else{y=v;do v=y,(v.flags&4098)!==0&&(z=v.return),y=v.return;while(y)}return v.tag===3?z:null}function Re(y){if(y.tag===13){var v=y.memoizedState;if(v===null&&(y=y.alternate,y!==null&&(v=y.memoizedState)),v!==null)return v.dehydrated}return null}function Oe(y){if(Ve(y)!==y)throw Error(d(188))}function at(y){var v=y.alternate;if(!v){if(v=Ve(y),v===null)throw Error(d(188));return v!==y?null:y}for(var z=y,k=v;;){var W=z.return;if(W===null)break;var ee=W.alternate;if(ee===null){if(k=W.return,k!==null){z=k;continue}break}if(W.child===ee.child){for(ee=W.child;ee;){if(ee===z)return Oe(W),y;if(ee===k)return Oe(W),v;ee=ee.sibling}throw Error(d(188))}if(z.return!==k.return)z=W,k=ee;else{for(var be=!1,He=W.child;He;){if(He===z){be=!0,z=W,k=ee;break}if(He===k){be=!0,k=W,z=ee;break}He=He.sibling}if(!be){for(He=ee.child;He;){if(He===z){be=!0,z=ee,k=W;break}if(He===k){be=!0,k=ee,z=W;break}He=He.sibling}if(!be)throw Error(d(189))}}if(z.alternate!==k)throw Error(d(190))}if(z.tag!==3)throw Error(d(188));return z.stateNode.current===z?y:v}function Ce(y){return y=at(y),y!==null?tt(y):null}function tt(y){if(y.tag===5||y.tag===6)return y;for(y=y.child;y!==null;){var v=tt(y);if(v!==null)return v;y=y.sibling}return null}var Vt=o.unstable_scheduleCallback,Nt=o.unstable_cancelCallback,ha=o.unstable_shouldYield,Ia=o.unstable_requestPaint,ma=o.unstable_now,Za=o.unstable_getCurrentPriorityLevel,$a=o.unstable_ImmediatePriority,ar=o.unstable_UserBlockingPriority,Fr=o.unstable_NormalPriority,Jn=o.unstable_LowPriority,ii=o.unstable_IdlePriority,Fn=null,cn=null;function Pr(y){if(cn&&typeof cn.onCommitFiberRoot=="function")try{cn.onCommitFiberRoot(Fn,y,void 0,(y.current.flags&128)===128)}catch{}}var Ka=Math.clz32?Math.clz32:Yr,yn=Math.log,Vn=Math.LN2;function Yr(y){return y>>>=0,y===0?32:31-(yn(y)/Vn|0)|0}var sn=64,si=4194304;function Mi(y){switch(y&-y){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return y&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return y}}function Bs(y,v){var z=y.pendingLanes;if(z===0)return 0;var k=0,W=y.suspendedLanes,ee=y.pingedLanes,be=z&268435455;if(be!==0){var He=be&~W;He!==0?k=Mi(He):(ee&=be,ee!==0&&(k=Mi(ee)))}else be=z&~W,be!==0?k=Mi(be):ee!==0&&(k=Mi(ee));if(k===0)return 0;if(v!==0&&v!==k&&(v&W)===0&&(W=k&-k,ee=v&-v,W>=ee||W===16&&(ee&4194240)!==0))return v;if((k&4)!==0&&(k|=z&16),v=y.entangledLanes,v!==0)for(y=y.entanglements,v&=k;0<v;)z=31-Ka(v),W=1<<z,k|=y[z],v&=~W;return k}function au(y,v){switch(y){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ni(y,v){for(var z=y.suspendedLanes,k=y.pingedLanes,W=y.expirationTimes,ee=y.pendingLanes;0<ee;){var be=31-Ka(ee),He=1<<be,lt=W[be];lt===-1?((He&z)===0||(He&k)!==0)&&(W[be]=au(He,v)):lt<=v&&(y.expiredLanes|=He),ee&=~He}}function Xs(y){return y=y.pendingLanes&-1073741825,y!==0?y:y&1073741824?1073741824:0}function ds(){var y=sn;return sn<<=1,(sn&4194240)===0&&(sn=64),y}function ho(y){for(var v=[],z=0;31>z;z++)v.push(y);return v}function as(y,v,z){y.pendingLanes|=v,v!==536870912&&(y.suspendedLanes=0,y.pingedLanes=0),y=y.eventTimes,v=31-Ka(v),y[v]=z}function Qs(y,v){var z=y.pendingLanes&~v;y.pendingLanes=v,y.suspendedLanes=0,y.pingedLanes=0,y.expiredLanes&=v,y.mutableReadLanes&=v,y.entangledLanes&=v,v=y.entanglements;var k=y.eventTimes;for(y=y.expirationTimes;0<z;){var W=31-Ka(z),ee=1<<W;v[W]=0,k[W]=-1,y[W]=-1,z&=~ee}}function qu(y,v){var z=y.entangledLanes|=v;for(y=y.entanglements;z;){var k=31-Ka(z),W=1<<k;W&v|y[k]&v&&(y[k]|=v),z&=~W}}var zn=0;function Ku(y){return y&=-y,1<y?4<y?(y&268435455)!==0?16:536870912:4:1}var ed,hs,Ao,fs,Hs,el=!1,Ll=[],tl=null,al=null,ps=null,Ro=new Map,ru=new Map,Hl=[],To="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Yh(y,v){switch(y){case"focusin":case"focusout":tl=null;break;case"dragenter":case"dragleave":al=null;break;case"mouseover":case"mouseout":ps=null;break;case"pointerover":case"pointerout":Ro.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":ru.delete(v.pointerId)}}function rl(y,v,z,k,W,ee){return y===null||y.nativeEvent!==ee?(y={blockedOn:v,domEventName:z,eventSystemFlags:k,nativeEvent:ee,targetContainers:[W]},v!==null&&(v=pd(v),v!==null&&hs(v)),y):(y.eventSystemFlags|=k,v=y.targetContainers,W!==null&&v.indexOf(W)===-1&&v.push(W),y)}function nu(y,v,z,k,W){switch(v){case"focusin":return tl=rl(tl,y,v,z,k,W),!0;case"dragenter":return al=rl(al,y,v,z,k,W),!0;case"mouseover":return ps=rl(ps,y,v,z,k,W),!0;case"pointerover":var ee=W.pointerId;return Ro.set(ee,rl(Ro.get(ee)||null,y,v,z,k,W)),!0;case"gotpointercapture":return ee=W.pointerId,ru.set(ee,rl(ru.get(ee)||null,y,v,z,k,W)),!0}return!1}function $h(y){var v=Oc(y.target);if(v!==null){var z=Ve(v);if(z!==null){if(v=z.tag,v===13){if(v=Re(z),v!==null){y.blockedOn=v,Hs(y.priority,function(){Ao(z)});return}}else if(v===3&&z.stateNode.current.memoizedState.isDehydrated){y.blockedOn=z.tag===3?z.stateNode.containerInfo:null;return}}}y.blockedOn=null}function jc(y){if(y.blockedOn!==null)return!1;for(var v=y.targetContainers;0<v.length;){var z=qh(y.domEventName,y.eventSystemFlags,v[0],y.nativeEvent);if(z===null){z=y.nativeEvent;var k=new z.constructor(z.type,z);yi=k,z.target.dispatchEvent(k),yi=null}else return v=pd(z),v!==null&&hs(v),y.blockedOn=z,!1;v.shift()}return!0}function iu(y,v,z){jc(y)&&z.delete(v)}function zr(){el=!1,tl!==null&&jc(tl)&&(tl=null),al!==null&&jc(al)&&(al=null),ps!==null&&jc(ps)&&(ps=null),Ro.forEach(iu),ru.forEach(iu)}function su(y,v){y.blockedOn===v&&(y.blockedOn=null,el||(el=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,zr)))}function Yl(y){function v(W){return su(W,y)}if(0<Ll.length){su(Ll[0],y);for(var z=1;z<Ll.length;z++){var k=Ll[z];k.blockedOn===y&&(k.blockedOn=null)}}for(tl!==null&&su(tl,y),al!==null&&su(al,y),ps!==null&&su(ps,y),Ro.forEach(v),ru.forEach(v),z=0;z<Hl.length;z++)k=Hl[z],k.blockedOn===y&&(k.blockedOn=null);for(;0<Hl.length&&(z=Hl[0],z.blockedOn===null);)$h(z),z.blockedOn===null&&Hl.shift()}var jl=$e.ReactCurrentBatchConfig,td=!0;function qd(y,v,z,k){var W=zn,ee=jl.transition;jl.transition=null;try{zn=1,ou(y,v,z,k)}finally{zn=W,jl.transition=ee}}function Kd(y,v,z,k){var W=zn,ee=jl.transition;jl.transition=null;try{zn=4,ou(y,v,z,k)}finally{zn=W,jl.transition=ee}}function ou(y,v,z,k){if(td){var W=qh(y,v,z,k);if(W===null)of(y,v,k,Zl,z),Yh(y,k);else if(nu(W,y,v,z,k))k.stopPropagation();else if(Yh(y,k),v&4&&-1<To.indexOf(y)){for(;W!==null;){var ee=pd(W);if(ee!==null&&ed(ee),ee=qh(y,v,z,k),ee===null&&of(y,v,k,Zl,z),ee===W)break;W=ee}W!==null&&k.stopPropagation()}else of(y,v,k,null,z)}}var Zl=null;function qh(y,v,z,k){if(Zl=null,y=Us(k),y=Oc(y),y!==null)if(v=Ve(y),v===null)y=null;else if(z=v.tag,z===13){if(y=Re(v),y!==null)return y;y=null}else if(z===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;y=null}else v!==y&&(y=null);return Zl=y,null}function eh(y){switch(y){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Za()){case $a:return 1;case ar:return 4;case Fr:case Jn:return 16;case ii:return 536870912;default:return 16}default:return 16}}var Zc=null,lu=null,js=null;function ad(){if(js)return js;var y,v=lu,z=v.length,k,W="value"in Zc?Zc.value:Zc.textContent,ee=W.length;for(y=0;y<z&&v[y]===W[y];y++);var be=z-y;for(k=1;k<=be&&v[z-k]===W[ee-k];k++);return js=W.slice(y,1<k?1-k:void 0)}function $l(y){var v=y.keyCode;return"charCode"in y?(y=y.charCode,y===0&&v===13&&(y=13)):y=v,y===10&&(y=13),32<=y||y===13?y:0}function Nc(){return!0}function Nl(){return!1}function xn(y){function v(z,k,W,ee,be){this._reactName=z,this._targetInst=W,this.type=k,this.nativeEvent=ee,this.target=be,this.currentTarget=null;for(var He in y)y.hasOwnProperty(He)&&(z=y[He],this[He]=z?z(ee):ee[He]);return this.isDefaultPrevented=(ee.defaultPrevented!=null?ee.defaultPrevented:ee.returnValue===!1)?Nc:Nl,this.isPropagationStopped=Nl,this}return ze(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var z=this.nativeEvent;z&&(z.preventDefault?z.preventDefault():typeof z.returnValue!="unknown"&&(z.returnValue=!1),this.isDefaultPrevented=Nc)},stopPropagation:function(){var z=this.nativeEvent;z&&(z.stopPropagation?z.stopPropagation():typeof z.cancelBubble!="unknown"&&(z.cancelBubble=!0),this.isPropagationStopped=Nc)},persist:function(){},isPersistent:Nc}),v}var Ec={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(y){return y.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},th=xn(Ec),cu=ze({},Ec,{view:0,detail:0}),Or=xn(cu),ah,Kh,rd,Sa=ze({},cu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:oi,button:0,buttons:0,relatedTarget:function(y){return y.relatedTarget===void 0?y.fromElement===y.srcElement?y.toElement:y.fromElement:y.relatedTarget},movementX:function(y){return"movementX"in y?y.movementX:(y!==rd&&(rd&&y.type==="mousemove"?(ah=y.screenX-rd.screenX,Kh=y.screenY-rd.screenY):Kh=ah=0,rd=y),ah)},movementY:function(y){return"movementY"in y?y.movementY:Kh}}),nd=xn(Sa),ql=ze({},Sa,{dataTransfer:0}),Vo=xn(ql),Mo=ze({},cu,{relatedTarget:0}),Sc=xn(Mo),ya=ze({},Ec,{animationName:0,elapsedTime:0,pseudoElement:0}),jr=xn(ya),Mr=ze({},Ec,{clipboardData:function(y){return"clipboardData"in y?y.clipboardData:window.clipboardData}}),Ys=xn(Mr),id=ze({},Ec,{data:0}),Dr=xn(id),rh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pi(y){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(y):(y=nh[y])?!!v[y]:!1}function oi(){return Pi}var uy=ze({},cu,{key:function(y){if(y.key){var v=rh[y.key]||y.key;if(v!=="Unidentified")return v}return y.type==="keypress"?(y=$l(y),y===13?"Enter":String.fromCharCode(y)):y.type==="keydown"||y.type==="keyup"?uu[y.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:oi,charCode:function(y){return y.type==="keypress"?$l(y):0},keyCode:function(y){return y.type==="keydown"||y.type==="keyup"?y.keyCode:0},which:function(y){return y.type==="keypress"?$l(y):y.type==="keydown"||y.type==="keyup"?y.keyCode:0}}),ih=xn(uy),ep=ze({},Sa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sd=xn(ep),ef=ze({},cu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:oi}),tp=xn(ef),sh=ze({},Ec,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bi=xn(sh),Kl=ze({},Sa,{deltaX:function(y){return"deltaX"in y?y.deltaX:"wheelDeltaX"in y?-y.wheelDeltaX:0},deltaY:function(y){return"deltaY"in y?y.deltaY:"wheelDeltaY"in y?-y.wheelDeltaY:"wheelDelta"in y?-y.wheelDelta:0},deltaZ:0,deltaMode:0}),Is=xn(Kl),tf=[9,13,27,32],zc=n&&"CompositionEvent"in window,li=null;n&&"documentMode"in document&&(li=document.documentMode);var El=n&&"TextEvent"in window&&!li,Sl=n&&(!zc||li&&8<li&&11>=li),Xn=" ",Ya=!1;function ca(y,v){switch(y){case"keyup":return tf.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ac(y){return y=y.detail,typeof y=="object"&&"data"in y?y.data:null}var za=!1;function od(y,v){switch(y){case"compositionend":return Ac(v);case"keypress":return v.which!==32?null:(Ya=!0,Xn);case"textInput":return y=v.data,y===Xn&&Ya?null:y;default:return null}}function af(y,v){if(za)return y==="compositionend"||!zc&&ca(y,v)?(y=ad(),js=lu=Zc=null,za=!1,y):null;switch(y){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Sl&&v.locale!=="ko"?null:v.data;default:return null}}var Ba={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ld(y){var v=y&&y.nodeName&&y.nodeName.toLowerCase();return v==="input"?!!Ba[y.type]:v==="textarea"}function oh(y,v,z,k){Ws(k),v=lf(v,"onChange"),0<v.length&&(z=new th("onChange","change",null,z,k),y.push({event:z,listeners:v}))}var cd=null,$s=null;function rf(y){pu(y,0)}function _i(y){var v=ol(y);if(qo(v))return y}function ms(y,v){if(y==="change")return v}var Rc=!1;if(n){var Tc;if(n){var nl="oninput"in document;if(!nl){var Ii=document.createElement("div");Ii.setAttribute("oninput","return;"),nl=typeof Ii.oninput=="function"}Tc=nl}else Tc=!1;Rc=Tc&&(!document.documentMode||9<document.documentMode)}function qp(){cd&&(cd.detachEvent("onpropertychange",Kp),$s=cd=null)}function Kp(y){if(y.propertyName==="value"&&_i($s)){var v=[];oh(v,$s,y,Us(y)),St(rf,v)}}function lh(y,v,z){y==="focusin"?(qp(),cd=v,$s=z,cd.attachEvent("onpropertychange",Kp)):y==="focusout"&&qp()}function Vc(y){if(y==="selectionchange"||y==="keyup"||y==="keydown")return _i($s)}function em(y,v){if(y==="click")return _i(v)}function Bo(y,v){if(y==="input"||y==="change")return _i(v)}function tm(y,v){return y===v&&(y!==0||1/y===1/v)||y!==y&&v!==v}var qs=typeof Object.is=="function"?Object.is:tm;function ec(y,v){if(qs(y,v))return!0;if(typeof y!="object"||y===null||typeof v!="object"||v===null)return!1;var z=Object.keys(y),k=Object.keys(v);if(z.length!==k.length)return!1;for(k=0;k<z.length;k++){var W=z[k];if(!B.call(v,W)||!qs(y[W],v[W]))return!1}return!0}function tc(y){for(;y&&y.firstChild;)y=y.firstChild;return y}function am(y,v){var z=tc(y);y=0;for(var k;z;){if(z.nodeType===3){if(k=y+z.textContent.length,y<=v&&k>=v)return{node:z,offset:v-y};y=k}e:{for(;z;){if(z.nextSibling){z=z.nextSibling;break e}z=z.parentNode}z=void 0}z=tc(z)}}function ap(y,v){return y&&v?y===v?!0:y&&y.nodeType===3?!1:v&&v.nodeType===3?ap(y,v.parentNode):"contains"in y?y.contains(v):y.compareDocumentPosition?!!(y.compareDocumentPosition(v)&16):!1:!1}function rm(){for(var y=window,v=ln();v instanceof y.HTMLIFrameElement;){try{var z=typeof v.contentWindow.location.href=="string"}catch{z=!1}if(z)y=v.contentWindow;else break;v=ln(y.document)}return v}function zl(y){var v=y&&y.nodeName&&y.nodeName.toLowerCase();return v&&(v==="input"&&(y.type==="text"||y.type==="search"||y.type==="tel"||y.type==="url"||y.type==="password")||v==="textarea"||y.contentEditable==="true")}function dy(y){var v=rm(),z=y.focusedElem,k=y.selectionRange;if(v!==z&&z&&z.ownerDocument&&ap(z.ownerDocument.documentElement,z)){if(k!==null&&zl(z)){if(v=k.start,y=k.end,y===void 0&&(y=v),"selectionStart"in z)z.selectionStart=v,z.selectionEnd=Math.min(y,z.value.length);else if(y=(v=z.ownerDocument||document)&&v.defaultView||window,y.getSelection){y=y.getSelection();var W=z.textContent.length,ee=Math.min(k.start,W);k=k.end===void 0?ee:Math.min(k.end,W),!y.extend&&ee>k&&(W=k,k=ee,ee=W),W=am(z,ee);var be=am(z,k);W&&be&&(y.rangeCount!==1||y.anchorNode!==W.node||y.anchorOffset!==W.offset||y.focusNode!==be.node||y.focusOffset!==be.offset)&&(v=v.createRange(),v.setStart(W.node,W.offset),y.removeAllRanges(),ee>k?(y.addRange(v),y.extend(be.node,be.offset)):(v.setEnd(be.node,be.offset),y.addRange(v)))}}for(v=[],y=z;y=y.parentNode;)y.nodeType===1&&v.push({element:y,left:y.scrollLeft,top:y.scrollTop});for(typeof z.focus=="function"&&z.focus(),z=0;z<v.length;z++)y=v[z],y.element.scrollLeft=y.left,y.element.scrollTop=y.top}}var rp=n&&"documentMode"in document&&11>=document.documentMode,ac=null,ch=null,du=null,Ks=!1;function Mc(y,v,z){var k=z.window===z?z.document:z.nodeType===9?z:z.ownerDocument;Ks||ac==null||ac!==ln(k)||(k=ac,"selectionStart"in k&&zl(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),du&&ec(du,k)||(du=k,k=lf(ch,"onSelect"),0<k.length&&(v=new th("onSelect","select",null,v,z),y.push({event:v,listeners:k}),v.target=ac)))}function Bc(y,v){var z={};return z[y.toLowerCase()]=v.toLowerCase(),z["Webkit"+y]="webkit"+v,z["Moz"+y]="moz"+v,z}var Ic={animationend:Bc("Animation","AnimationEnd"),animationiteration:Bc("Animation","AnimationIteration"),animationstart:Bc("Animation","AnimationStart"),transitionend:Bc("Transition","TransitionEnd")},uh={},hu={};n&&(hu=document.createElement("div").style,"AnimationEvent"in window||(delete Ic.animationend.animation,delete Ic.animationiteration.animation,delete Ic.animationstart.animation),"TransitionEvent"in window||delete Ic.transitionend.transition);function rc(y){if(uh[y])return uh[y];if(!Ic[y])return y;var v=Ic[y],z;for(z in v)if(v.hasOwnProperty(z)&&z in hu)return uh[y]=v[z];return y}var nf=rc("animationend"),dh=rc("animationiteration"),eo=rc("animationstart"),hh=rc("transitionend"),Dt=new Map,sf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fo(y,v){Dt.set(y,v),Z(v,[y])}for(var kc=0;kc<sf.length;kc++){var fu=sf[kc],fh=fu.toLowerCase(),Al=fu[0].toUpperCase()+fu.slice(1);fo(fh,"on"+Al)}fo(nf,"onAnimationEnd"),fo(dh,"onAnimationIteration"),fo(eo,"onAnimationStart"),fo("dblclick","onDoubleClick"),fo("focusin","onFocus"),fo("focusout","onBlur"),fo(hh,"onTransitionEnd"),S("onMouseEnter",["mouseout","mouseover"]),S("onMouseLeave",["mouseout","mouseover"]),S("onPointerEnter",["pointerout","pointerover"]),S("onPointerLeave",["pointerout","pointerover"]),Z("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Z("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Z("onBeforeInput",["compositionend","keypress","textInput","paste"]),Z("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Z("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Z("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Io=new Set("cancel close invalid load scroll toggle".split(" ").concat(Jc));function cr(y,v,z){var k=y.type||"unknown-event";y.currentTarget=z,xe(k,v,void 0,y),y.currentTarget=null}function pu(y,v){v=(v&4)!==0;for(var z=0;z<y.length;z++){var k=y[z],W=k.event;k=k.listeners;e:{var ee=void 0;if(v)for(var be=k.length-1;0<=be;be--){var He=k[be],lt=He.instance,Ut=He.currentTarget;if(He=He.listener,lt!==ee&&W.isPropagationStopped())break e;cr(W,He,Ut),ee=lt}else for(be=0;be<k.length;be++){if(He=k[be],lt=He.instance,Ut=He.currentTarget,He=He.listener,lt!==ee&&W.isPropagationStopped())break e;cr(W,He,Ut),ee=lt}}}if(Lc)throw y=Ge,Lc=!1,Ge=null,y}function hi(y,v){var z=v[fd];z===void 0&&(z=v[fd]=new Set);var k=y+"__bubble";z.has(k)||(jn(v,y,2,!1),z.add(k))}function np(y,v,z){var k=0;v&&(k|=4),jn(z,y,k,v)}var mu="_reactListening"+Math.random().toString(36).slice(2);function ph(y){if(!y[mu]){y[mu]=!0,g.forEach(function(z){z!=="selectionchange"&&(Io.has(z)||np(z,!1,y),np(z,!0,y))});var v=y.nodeType===9?y:y.ownerDocument;v===null||v[mu]||(v[mu]=!0,np("selectionchange",!1,v))}}function jn(y,v,z,k){switch(eh(v)){case 1:var W=qd;break;case 4:W=Kd;break;default:W=ou}z=W.bind(null,v,z,y),W=void 0,!tu||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(W=!0),k?W!==void 0?y.addEventListener(v,z,{capture:!0,passive:W}):y.addEventListener(v,z,!0):W!==void 0?y.addEventListener(v,z,{passive:W}):y.addEventListener(v,z,!1)}function of(y,v,z,k,W){var ee=k;if((v&1)===0&&(v&2)===0&&k!==null)e:for(;;){if(k===null)return;var be=k.tag;if(be===3||be===4){var He=k.stateNode.containerInfo;if(He===W||He.nodeType===8&&He.parentNode===W)break;if(be===4)for(be=k.return;be!==null;){var lt=be.tag;if((lt===3||lt===4)&&(lt=be.stateNode.containerInfo,lt===W||lt.nodeType===8&&lt.parentNode===W))return;be=be.return}for(;He!==null;){if(be=Oc(He),be===null)return;if(lt=be.tag,lt===5||lt===6){k=ee=be;continue e}He=He.parentNode}}k=k.return}St(function(){var Ut=ee,ga=Us(z),wa=[];e:{var _a=Dt.get(y);if(_a!==void 0){var Ha=th,er=y;switch(y){case"keypress":if($l(z)===0)break e;case"keydown":case"keyup":Ha=ih;break;case"focusin":er="focus",Ha=Sc;break;case"focusout":er="blur",Ha=Sc;break;case"beforeblur":case"afterblur":Ha=Sc;break;case"click":if(z.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ha=nd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ha=Vo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ha=tp;break;case nf:case dh:case eo:Ha=jr;break;case hh:Ha=Bi;break;case"scroll":Ha=Or;break;case"wheel":Ha=Is;break;case"copy":case"cut":case"paste":Ha=Ys;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ha=sd}var Wa=(v&4)!==0,ai=!Wa&&y==="scroll",Rt=Wa?_a!==null?_a+"Capture":null:_a;Wa=[];for(var gt=Ut,kt;gt!==null;){kt=gt;var Na=kt.stateNode;if(kt.tag===5&&Na!==null&&(kt=Na,Rt!==null&&(Na=uo(gt,Rt),Na!=null&&Wa.push(yu(gt,Na,kt)))),ai)break;gt=gt.return}0<Wa.length&&(_a=new Ha(_a,er,null,z,ga),wa.push({event:_a,listeners:Wa}))}}if((v&7)===0){e:{if(_a=y==="mouseover"||y==="pointerover",Ha=y==="mouseout"||y==="pointerout",_a&&z!==yi&&(er=z.relatedTarget||z.fromElement)&&(Oc(er)||er[sl]))break e;if((Ha||_a)&&(_a=ga.window===ga?ga:(_a=ga.ownerDocument)?_a.defaultView||_a.parentWindow:window,Ha?(er=z.relatedTarget||z.toElement,Ha=Ut,er=er?Oc(er):null,er!==null&&(ai=Ve(er),er!==ai||er.tag!==5&&er.tag!==6)&&(er=null)):(Ha=null,er=Ut),Ha!==er)){if(Wa=nd,Na="onMouseLeave",Rt="onMouseEnter",gt="mouse",(y==="pointerout"||y==="pointerover")&&(Wa=sd,Na="onPointerLeave",Rt="onPointerEnter",gt="pointer"),ai=Ha==null?_a:ol(Ha),kt=er==null?_a:ol(er),_a=new Wa(Na,gt+"leave",Ha,z,ga),_a.target=ai,_a.relatedTarget=kt,Na=null,Oc(ga)===Ut&&(Wa=new Wa(Rt,gt+"enter",er,z,ga),Wa.target=kt,Wa.relatedTarget=ai,Na=Wa),ai=Na,Ha&&er)t:{for(Wa=Ha,Rt=er,gt=0,kt=Wa;kt;kt=ud(kt))gt++;for(kt=0,Na=Rt;Na;Na=ud(Na))kt++;for(;0<gt-kt;)Wa=ud(Wa),gt--;for(;0<kt-gt;)Rt=ud(Rt),kt--;for(;gt--;){if(Wa===Rt||Rt!==null&&Wa===Rt.alternate)break t;Wa=ud(Wa),Rt=ud(Rt)}Wa=null}else Wa=null;Ha!==null&&nm(wa,_a,Ha,Wa,!1),er!==null&&ai!==null&&nm(wa,ai,er,Wa,!0)}}e:{if(_a=Ut?ol(Ut):window,Ha=_a.nodeName&&_a.nodeName.toLowerCase(),Ha==="select"||Ha==="input"&&_a.type==="file")var rr=ms;else if(ld(_a))if(Rc)rr=Bo;else{rr=Vc;var xr=lh}else(Ha=_a.nodeName)&&Ha.toLowerCase()==="input"&&(_a.type==="checkbox"||_a.type==="radio")&&(rr=em);if(rr&&(rr=rr(y,Ut))){oh(wa,rr,z,ga);break e}xr&&xr(y,_a,Ut),y==="focusout"&&(xr=_a._wrapperState)&&xr.controlled&&_a.type==="number"&&pi(_a,"number",_a.value)}switch(xr=Ut?ol(Ut):window,y){case"focusin":(ld(xr)||xr.contentEditable==="true")&&(ac=xr,ch=Ut,du=null);break;case"focusout":du=ch=ac=null;break;case"mousedown":Ks=!0;break;case"contextmenu":case"mouseup":case"dragend":Ks=!1,Mc(wa,z,ga);break;case"selectionchange":if(rp)break;case"keydown":case"keyup":Mc(wa,z,ga)}var br;if(zc)e:{switch(y){case"compositionstart":var Tr="onCompositionStart";break e;case"compositionend":Tr="onCompositionEnd";break e;case"compositionupdate":Tr="onCompositionUpdate";break e}Tr=void 0}else za?ca(y,z)&&(Tr="onCompositionEnd"):y==="keydown"&&z.keyCode===229&&(Tr="onCompositionStart");Tr&&(Sl&&z.locale!=="ko"&&(za||Tr!=="onCompositionStart"?Tr==="onCompositionEnd"&&za&&(br=ad()):(Zc=ga,lu="value"in Zc?Zc.value:Zc.textContent,za=!0)),xr=lf(Ut,Tr),0<xr.length&&(Tr=new Dr(Tr,y,null,z,ga),wa.push({event:Tr,listeners:xr}),br?Tr.data=br:(br=Ac(z),br!==null&&(Tr.data=br)))),(br=El?od(y,z):af(y,z))&&(Ut=lf(Ut,"onBeforeInput"),0<Ut.length&&(ga=new Dr("onBeforeInput","beforeinput",null,z,ga),wa.push({event:ga,listeners:Ut}),ga.data=br))}pu(wa,v)})}function yu(y,v,z){return{instance:y,listener:v,currentTarget:z}}function lf(y,v){for(var z=v+"Capture",k=[];y!==null;){var W=y,ee=W.stateNode;W.tag===5&&ee!==null&&(W=ee,ee=uo(y,z),ee!=null&&k.unshift(yu(y,ee,W)),ee=uo(y,v),ee!=null&&k.push(yu(y,ee,W))),y=y.return}return k}function ud(y){if(y===null)return null;do y=y.return;while(y&&y.tag!==5);return y||null}function nm(y,v,z,k,W){for(var ee=v._reactName,be=[];z!==null&&z!==k;){var He=z,lt=He.alternate,Ut=He.stateNode;if(lt!==null&&lt===k)break;He.tag===5&&Ut!==null&&(He=Ut,W?(lt=uo(z,ee),lt!=null&&be.unshift(yu(z,lt,He))):W||(lt=uo(z,ee),lt!=null&&be.push(yu(z,lt,He)))),z=z.return}be.length!==0&&y.push({event:v,listeners:be})}var hy=/\r\n?/g,im=/\u0000|\uFFFD/g;function sm(y){return(typeof y=="string"?y:""+y).replace(hy,`
`).replace(im,"")}function gu(y,v,z){if(v=sm(v),sm(y)!==v&&z)throw Error(d(425))}function cf(){}var uf=null,mh=null;function dd(y,v){return y==="textarea"||y==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var yh=typeof setTimeout=="function"?setTimeout:void 0,_u=typeof clearTimeout=="function"?clearTimeout:void 0,xu=typeof Promise=="function"?Promise:void 0,gh=typeof queueMicrotask=="function"?queueMicrotask:typeof xu<"u"?function(y){return xu.resolve(null).then(y).catch(hd)}:yh;function hd(y){setTimeout(function(){throw y})}function df(y,v){var z=v,k=0;do{var W=z.nextSibling;if(y.removeChild(z),W&&W.nodeType===8)if(z=W.data,z==="/$"){if(k===0){y.removeChild(W),Yl(v);return}k--}else z!=="$"&&z!=="$?"&&z!=="$!"||k++;z=W}while(z);Yl(v)}function Rl(y){for(;y!=null;y=y.nextSibling){var v=y.nodeType;if(v===1||v===3)break;if(v===8){if(v=y.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return y}function ip(y){y=y.previousSibling;for(var v=0;y;){if(y.nodeType===8){var z=y.data;if(z==="$"||z==="$!"||z==="$?"){if(v===0)return y;v--}else z==="/$"&&v++}y=y.previousSibling}return null}var il=Math.random().toString(36).slice(2),po="__reactFiber$"+il,Fc="__reactProps$"+il,sl="__reactContainer$"+il,fd="__reactEvents$"+il,_h="__reactListeners$"+il,om="__reactHandles$"+il;function Oc(y){var v=y[po];if(v)return v;for(var z=y.parentNode;z;){if(v=z[sl]||z[po]){if(z=v.alternate,v.child!==null||z!==null&&z.child!==null)for(y=ip(y);y!==null;){if(z=y[po])return z;y=ip(y)}return v}y=z,z=y.parentNode}return null}function pd(y){return y=y[po]||y[sl],!y||y.tag!==5&&y.tag!==6&&y.tag!==13&&y.tag!==3?null:y}function ol(y){if(y.tag===5||y.tag===6)return y.stateNode;throw Error(d(33))}function wu(y){return y[Fc]||null}var sp=[],vu=-1;function Dc(y){return{current:y}}function ti(y){0>vu||(y.current=sp[vu],sp[vu]=null,vu--)}function $n(y,v){vu++,sp[vu]=y.current,y.current=v}var ll={},Qi=Dc(ll),Gi=Dc(!1),nc=ll;function bu(y,v){var z=y.type.contextTypes;if(!z)return ll;var k=y.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===v)return k.__reactInternalMemoizedMaskedChildContext;var W={},ee;for(ee in z)W[ee]=v[ee];return k&&(y=y.stateNode,y.__reactInternalMemoizedUnmaskedChildContext=v,y.__reactInternalMemoizedMaskedChildContext=W),W}function rs(y){return y=y.childContextTypes,y!=null}function Tl(){ti(Gi),ti(Qi)}function xh(y,v,z){if(Qi.current!==ll)throw Error(d(168));$n(Qi,v),$n(Gi,z)}function to(y,v,z){var k=y.stateNode;if(v=v.childContextTypes,typeof k.getChildContext!="function")return z;k=k.getChildContext();for(var W in k)if(!(W in v))throw Error(d(108,Er(y)||"Unknown",W));return ze({},z,k)}function md(y){return y=(y=y.stateNode)&&y.__reactInternalMemoizedMergedChildContext||ll,nc=Qi.current,$n(Qi,y),$n(Gi,Gi.current),!0}function yd(y,v,z){var k=y.stateNode;if(!k)throw Error(d(169));z?(y=to(y,v,nc),k.__reactInternalMemoizedMergedChildContext=y,ti(Gi),ti(Qi),$n(Qi,y)):ti(Gi),$n(Gi,z)}var mo=null,gd=!1,wh=!1;function hf(y){mo===null?mo=[y]:mo.push(y)}function vh(y){gd=!0,hf(y)}function cl(){if(!wh&&mo!==null){wh=!0;var y=0,v=zn;try{var z=mo;for(zn=1;y<z.length;y++){var k=z[y];do k=k(!0);while(k!==null)}mo=null,gd=!1}catch(W){throw mo!==null&&(mo=mo.slice(y+1)),Vt($a,cl),W}finally{zn=v,wh=!1}}return null}var ul=[],ic=0,Lu=null,bh=0,yo=[],ys=0,Cc=null,Vl=1,sc="";function ju(y,v){ul[ic++]=bh,ul[ic++]=Lu,Lu=y,bh=v}function lm(y,v,z){yo[ys++]=Vl,yo[ys++]=sc,yo[ys++]=Cc,Cc=y;var k=Vl;y=sc;var W=32-Ka(k)-1;k&=~(1<<W),z+=1;var ee=32-Ka(v)+W;if(30<ee){var be=W-W%5;ee=(k&(1<<be)-1).toString(32),k>>=be,W-=be,Vl=1<<32-Ka(v)+W|z<<W|k,sc=ee+y}else Vl=1<<ee|z<<W|k,sc=y}function _d(y){y.return!==null&&(ju(y,1),lm(y,1,0))}function Lh(y){for(;y===Lu;)Lu=ul[--ic],ul[ic]=null,bh=ul[--ic],ul[ic]=null;for(;y===Cc;)Cc=yo[--ys],yo[ys]=null,sc=yo[--ys],yo[ys]=null,Vl=yo[--ys],yo[ys]=null}var ks=null,ao=null,Qn=!1,go=null;function op(y,v){var z=sr(5,null,null,0);z.elementType="DELETED",z.stateNode=v,z.return=y,v=y.deletions,v===null?(y.deletions=[z],y.flags|=16):v.push(z)}function lp(y,v){switch(y.tag){case 5:var z=y.type;return v=v.nodeType!==1||z.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(y.stateNode=v,ks=y,ao=Rl(v.firstChild),!0):!1;case 6:return v=y.pendingProps===""||v.nodeType!==3?null:v,v!==null?(y.stateNode=v,ks=y,ao=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(z=Cc!==null?{id:Vl,overflow:sc}:null,y.memoizedState={dehydrated:v,treeContext:z,retryLane:1073741824},z=sr(18,null,null,0),z.stateNode=v,z.return=y,y.child=z,ks=y,ao=null,!0):!1;default:return!1}}function xd(y){return(y.mode&1)!==0&&(y.flags&128)===0}function dl(y){if(Qn){var v=ao;if(v){var z=v;if(!lp(y,v)){if(xd(y))throw Error(d(418));v=Rl(z.nextSibling);var k=ks;v&&lp(y,v)?op(k,z):(y.flags=y.flags&-4097|2,Qn=!1,ks=y)}}else{if(xd(y))throw Error(d(418));y.flags=y.flags&-4097|2,Qn=!1,ks=y}}}function wd(y){for(y=y.return;y!==null&&y.tag!==5&&y.tag!==3&&y.tag!==13;)y=y.return;ks=y}function Zu(y){if(y!==ks)return!1;if(!Qn)return wd(y),Qn=!0,!1;var v;if((v=y.tag!==3)&&!(v=y.tag!==5)&&(v=y.type,v=v!=="head"&&v!=="body"&&!dd(y.type,y.memoizedProps)),v&&(v=ao)){if(xd(y))throw Pc(),Error(d(418));for(;v;)op(y,v),v=Rl(v.nextSibling)}if(wd(y),y.tag===13){if(y=y.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(d(317));e:{for(y=y.nextSibling,v=0;y;){if(y.nodeType===8){var z=y.data;if(z==="/$"){if(v===0){ao=Rl(y.nextSibling);break e}v--}else z!=="$"&&z!=="$!"&&z!=="$?"||v++}y=y.nextSibling}ao=null}}else ao=ks?Rl(y.stateNode.nextSibling):null;return!0}function Pc(){for(var y=ao;y;)y=Rl(y.nextSibling)}function _o(){ao=ks=null,Qn=!1}function jh(y){go===null?go=[y]:go.push(y)}var ff=$e.ReactCurrentBatchConfig;function Nu(y,v,z){if(y=z.ref,y!==null&&typeof y!="function"&&typeof y!="object"){if(z._owner){if(z=z._owner,z){if(z.tag!==1)throw Error(d(309));var k=z.stateNode}if(!k)throw Error(d(147,y));var W=k,ee=""+y;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===ee?v.ref:(v=function(be){var He=W.refs;be===null?delete He[ee]:He[ee]=be},v._stringRef=ee,v)}if(typeof y!="string")throw Error(d(284));if(!z._owner)throw Error(d(290,y))}return y}function vd(y,v){throw y=Object.prototype.toString.call(v),Error(d(31,y==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":y))}function Zh(y){var v=y._init;return v(y._payload)}function Nh(y){function v(Rt,gt){if(y){var kt=Rt.deletions;kt===null?(Rt.deletions=[gt],Rt.flags|=16):kt.push(gt)}}function z(Rt,gt){if(!y)return null;for(;gt!==null;)v(Rt,gt),gt=gt.sibling;return null}function k(Rt,gt){for(Rt=new Map;gt!==null;)gt.key!==null?Rt.set(gt.key,gt):Rt.set(gt.index,gt),gt=gt.sibling;return Rt}function W(Rt,gt){return Rt=Ca(Rt,gt),Rt.index=0,Rt.sibling=null,Rt}function ee(Rt,gt,kt){return Rt.index=kt,y?(kt=Rt.alternate,kt!==null?(kt=kt.index,kt<gt?(Rt.flags|=2,gt):kt):(Rt.flags|=2,gt)):(Rt.flags|=1048576,gt)}function be(Rt){return y&&Rt.alternate===null&&(Rt.flags|=2),Rt}function He(Rt,gt,kt,Na){return gt===null||gt.tag!==6?(gt=yr(kt,Rt.mode,Na),gt.return=Rt,gt):(gt=W(gt,kt),gt.return=Rt,gt)}function lt(Rt,gt,kt,Na){var rr=kt.type;return rr===Qe?ga(Rt,gt,kt.props.children,Na,kt.key):gt!==null&&(gt.elementType===rr||typeof rr=="object"&&rr!==null&&rr.$$typeof===Wt&&Zh(rr)===gt.type)?(Na=W(gt,kt.props),Na.ref=Nu(Rt,gt,kt),Na.return=Rt,Na):(Na=en(kt.type,kt.key,kt.props,null,Rt.mode,Na),Na.ref=Nu(Rt,gt,kt),Na.return=Rt,Na)}function Ut(Rt,gt,kt,Na){return gt===null||gt.tag!==4||gt.stateNode.containerInfo!==kt.containerInfo||gt.stateNode.implementation!==kt.implementation?(gt=_n(kt,Rt.mode,Na),gt.return=Rt,gt):(gt=W(gt,kt.children||[]),gt.return=Rt,gt)}function ga(Rt,gt,kt,Na,rr){return gt===null||gt.tag!==7?(gt=_r(kt,Rt.mode,Na,rr),gt.return=Rt,gt):(gt=W(gt,kt),gt.return=Rt,gt)}function wa(Rt,gt,kt){if(typeof gt=="string"&&gt!==""||typeof gt=="number")return gt=yr(""+gt,Rt.mode,kt),gt.return=Rt,gt;if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case De:return kt=en(gt.type,gt.key,gt.props,null,Rt.mode,kt),kt.ref=Nu(Rt,null,gt),kt.return=Rt,kt;case Te:return gt=_n(gt,Rt.mode,kt),gt.return=Rt,gt;case Wt:var Na=gt._init;return wa(Rt,Na(gt._payload),kt)}if(di(gt)||mt(gt))return gt=_r(gt,Rt.mode,kt,null),gt.return=Rt,gt;vd(Rt,gt)}return null}function _a(Rt,gt,kt,Na){var rr=gt!==null?gt.key:null;if(typeof kt=="string"&&kt!==""||typeof kt=="number")return rr!==null?null:He(Rt,gt,""+kt,Na);if(typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case De:return kt.key===rr?lt(Rt,gt,kt,Na):null;case Te:return kt.key===rr?Ut(Rt,gt,kt,Na):null;case Wt:return rr=kt._init,_a(Rt,gt,rr(kt._payload),Na)}if(di(kt)||mt(kt))return rr!==null?null:ga(Rt,gt,kt,Na,null);vd(Rt,kt)}return null}function Ha(Rt,gt,kt,Na,rr){if(typeof Na=="string"&&Na!==""||typeof Na=="number")return Rt=Rt.get(kt)||null,He(gt,Rt,""+Na,rr);if(typeof Na=="object"&&Na!==null){switch(Na.$$typeof){case De:return Rt=Rt.get(Na.key===null?kt:Na.key)||null,lt(gt,Rt,Na,rr);case Te:return Rt=Rt.get(Na.key===null?kt:Na.key)||null,Ut(gt,Rt,Na,rr);case Wt:var xr=Na._init;return Ha(Rt,gt,kt,xr(Na._payload),rr)}if(di(Na)||mt(Na))return Rt=Rt.get(kt)||null,ga(gt,Rt,Na,rr,null);vd(gt,Na)}return null}function er(Rt,gt,kt,Na){for(var rr=null,xr=null,br=gt,Tr=gt=0,ss=null;br!==null&&Tr<kt.length;Tr++){br.index>Tr?(ss=br,br=null):ss=br.sibling;var Bn=_a(Rt,br,kt[Tr],Na);if(Bn===null){br===null&&(br=ss);break}y&&br&&Bn.alternate===null&&v(Rt,br),gt=ee(Bn,gt,Tr),xr===null?rr=Bn:xr.sibling=Bn,xr=Bn,br=ss}if(Tr===kt.length)return z(Rt,br),Qn&&ju(Rt,Tr),rr;if(br===null){for(;Tr<kt.length;Tr++)br=wa(Rt,kt[Tr],Na),br!==null&&(gt=ee(br,gt,Tr),xr===null?rr=br:xr.sibling=br,xr=br);return Qn&&ju(Rt,Tr),rr}for(br=k(Rt,br);Tr<kt.length;Tr++)ss=Ha(br,Rt,Tr,kt[Tr],Na),ss!==null&&(y&&ss.alternate!==null&&br.delete(ss.key===null?Tr:ss.key),gt=ee(ss,gt,Tr),xr===null?rr=ss:xr.sibling=ss,xr=ss);return y&&br.forEach(function(Du){return v(Rt,Du)}),Qn&&ju(Rt,Tr),rr}function Wa(Rt,gt,kt,Na){var rr=mt(kt);if(typeof rr!="function")throw Error(d(150));if(kt=rr.call(kt),kt==null)throw Error(d(151));for(var xr=rr=null,br=gt,Tr=gt=0,ss=null,Bn=kt.next();br!==null&&!Bn.done;Tr++,Bn=kt.next()){br.index>Tr?(ss=br,br=null):ss=br.sibling;var Du=_a(Rt,br,Bn.value,Na);if(Du===null){br===null&&(br=ss);break}y&&br&&Du.alternate===null&&v(Rt,br),gt=ee(Du,gt,Tr),xr===null?rr=Du:xr.sibling=Du,xr=Du,br=ss}if(Bn.done)return z(Rt,br),Qn&&ju(Rt,Tr),rr;if(br===null){for(;!Bn.done;Tr++,Bn=kt.next())Bn=wa(Rt,Bn.value,Na),Bn!==null&&(gt=ee(Bn,gt,Tr),xr===null?rr=Bn:xr.sibling=Bn,xr=Bn);return Qn&&ju(Rt,Tr),rr}for(br=k(Rt,br);!Bn.done;Tr++,Bn=kt.next())Bn=Ha(br,Rt,Tr,Bn.value,Na),Bn!==null&&(y&&Bn.alternate!==null&&br.delete(Bn.key===null?Tr:Bn.key),gt=ee(Bn,gt,Tr),xr===null?rr=Bn:xr.sibling=Bn,xr=Bn);return y&&br.forEach(function(Vg){return v(Rt,Vg)}),Qn&&ju(Rt,Tr),rr}function ai(Rt,gt,kt,Na){if(typeof kt=="object"&&kt!==null&&kt.type===Qe&&kt.key===null&&(kt=kt.props.children),typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case De:e:{for(var rr=kt.key,xr=gt;xr!==null;){if(xr.key===rr){if(rr=kt.type,rr===Qe){if(xr.tag===7){z(Rt,xr.sibling),gt=W(xr,kt.props.children),gt.return=Rt,Rt=gt;break e}}else if(xr.elementType===rr||typeof rr=="object"&&rr!==null&&rr.$$typeof===Wt&&Zh(rr)===xr.type){z(Rt,xr.sibling),gt=W(xr,kt.props),gt.ref=Nu(Rt,xr,kt),gt.return=Rt,Rt=gt;break e}z(Rt,xr);break}else v(Rt,xr);xr=xr.sibling}kt.type===Qe?(gt=_r(kt.props.children,Rt.mode,Na,kt.key),gt.return=Rt,Rt=gt):(Na=en(kt.type,kt.key,kt.props,null,Rt.mode,Na),Na.ref=Nu(Rt,gt,kt),Na.return=Rt,Rt=Na)}return be(Rt);case Te:e:{for(xr=kt.key;gt!==null;){if(gt.key===xr)if(gt.tag===4&&gt.stateNode.containerInfo===kt.containerInfo&&gt.stateNode.implementation===kt.implementation){z(Rt,gt.sibling),gt=W(gt,kt.children||[]),gt.return=Rt,Rt=gt;break e}else{z(Rt,gt);break}else v(Rt,gt);gt=gt.sibling}gt=_n(kt,Rt.mode,Na),gt.return=Rt,Rt=gt}return be(Rt);case Wt:return xr=kt._init,ai(Rt,gt,xr(kt._payload),Na)}if(di(kt))return er(Rt,gt,kt,Na);if(mt(kt))return Wa(Rt,gt,kt,Na);vd(Rt,kt)}return typeof kt=="string"&&kt!==""||typeof kt=="number"?(kt=""+kt,gt!==null&&gt.tag===6?(z(Rt,gt.sibling),gt=W(gt,kt),gt.return=Rt,Rt=gt):(z(Rt,gt),gt=yr(kt,Rt.mode,Na),gt.return=Rt,Rt=gt),be(Rt)):z(Rt,gt)}return ai}var Gc=Nh(!0),Eh=Nh(!1),oc=Dc(null),pf=null,xo=null,mf=null;function cp(){mf=xo=pf=null}function bd(y){var v=oc.current;ti(oc),y._currentValue=v}function Ld(y,v,z){for(;y!==null;){var k=y.alternate;if((y.childLanes&v)!==v?(y.childLanes|=v,k!==null&&(k.childLanes|=v)):k!==null&&(k.childLanes&v)!==v&&(k.childLanes|=v),y===z)break;y=y.return}}function Js(y,v){pf=y,mf=xo=null,y=y.dependencies,y!==null&&y.firstContext!==null&&((y.lanes&v)!==0&&(Yi=!0),y.firstContext=null)}function Zs(y){var v=y._currentValue;if(mf!==y)if(y={context:y,memoizedValue:v,next:null},xo===null){if(pf===null)throw Error(d(308));xo=y,pf.dependencies={lanes:0,firstContext:y}}else xo=xo.next=y;return v}var ro=null;function Sh(y){ro===null?ro=[y]:ro.push(y)}function zh(y,v,z,k){var W=v.interleaved;return W===null?(z.next=z,Sh(v)):(z.next=W.next,W.next=z),v.interleaved=z,ko(y,k)}function ko(y,v){y.lanes|=v;var z=y.alternate;for(z!==null&&(z.lanes|=v),z=y,y=y.return;y!==null;)y.childLanes|=v,z=y.alternate,z!==null&&(z.childLanes|=v),z=y,y=y.return;return z.tag===3?z.stateNode:null}var Jo=!1;function jd(y){y.updateQueue={baseState:y.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function up(y,v){y=y.updateQueue,v.updateQueue===y&&(v.updateQueue={baseState:y.baseState,firstBaseUpdate:y.firstBaseUpdate,lastBaseUpdate:y.lastBaseUpdate,shared:y.shared,effects:y.effects})}function Fs(y,v){return{eventTime:y,lane:v,tag:0,payload:null,callback:null,next:null}}function wo(y,v,z){var k=y.updateQueue;if(k===null)return null;if(k=k.shared,(An&2)!==0){var W=k.pending;return W===null?v.next=v:(v.next=W.next,W.next=v),k.pending=v,ko(y,z)}return W=k.interleaved,W===null?(v.next=v,Sh(k)):(v.next=W.next,W.next=v),k.interleaved=v,ko(y,z)}function na(y,v,z){if(v=v.updateQueue,v!==null&&(v=v.shared,(z&4194240)!==0)){var k=v.lanes;k&=y.pendingLanes,z|=k,v.lanes=z,qu(y,z)}}function yf(y,v){var z=y.updateQueue,k=y.alternate;if(k!==null&&(k=k.updateQueue,z===k)){var W=null,ee=null;if(z=z.firstBaseUpdate,z!==null){do{var be={eventTime:z.eventTime,lane:z.lane,tag:z.tag,payload:z.payload,callback:z.callback,next:null};ee===null?W=ee=be:ee=ee.next=be,z=z.next}while(z!==null);ee===null?W=ee=v:ee=ee.next=v}else W=ee=v;z={baseState:k.baseState,firstBaseUpdate:W,lastBaseUpdate:ee,shared:k.shared,effects:k.effects},y.updateQueue=z;return}y=z.lastBaseUpdate,y===null?z.firstBaseUpdate=v:y.next=v,z.lastBaseUpdate=v}function Fo(y,v,z,k){var W=y.updateQueue;Jo=!1;var ee=W.firstBaseUpdate,be=W.lastBaseUpdate,He=W.shared.pending;if(He!==null){W.shared.pending=null;var lt=He,Ut=lt.next;lt.next=null,be===null?ee=Ut:be.next=Ut,be=lt;var ga=y.alternate;ga!==null&&(ga=ga.updateQueue,He=ga.lastBaseUpdate,He!==be&&(He===null?ga.firstBaseUpdate=Ut:He.next=Ut,ga.lastBaseUpdate=lt))}if(ee!==null){var wa=W.baseState;be=0,ga=Ut=lt=null,He=ee;do{var _a=He.lane,Ha=He.eventTime;if((k&_a)===_a){ga!==null&&(ga=ga.next={eventTime:Ha,lane:0,tag:He.tag,payload:He.payload,callback:He.callback,next:null});e:{var er=y,Wa=He;switch(_a=v,Ha=z,Wa.tag){case 1:if(er=Wa.payload,typeof er=="function"){wa=er.call(Ha,wa,_a);break e}wa=er;break e;case 3:er.flags=er.flags&-65537|128;case 0:if(er=Wa.payload,_a=typeof er=="function"?er.call(Ha,wa,_a):er,_a==null)break e;wa=ze({},wa,_a);break e;case 2:Jo=!0}}He.callback!==null&&He.lane!==0&&(y.flags|=64,_a=W.effects,_a===null?W.effects=[He]:_a.push(He))}else Ha={eventTime:Ha,lane:_a,tag:He.tag,payload:He.payload,callback:He.callback,next:null},ga===null?(Ut=ga=Ha,lt=wa):ga=ga.next=Ha,be|=_a;if(He=He.next,He===null){if(He=W.shared.pending,He===null)break;_a=He,He=_a.next,_a.next=null,W.lastBaseUpdate=_a,W.shared.pending=null}}while(!0);if(ga===null&&(lt=wa),W.baseState=lt,W.firstBaseUpdate=Ut,W.lastBaseUpdate=ga,v=W.shared.interleaved,v!==null){W=v;do be|=W.lane,W=W.next;while(W!==v)}else ee===null&&(W.shared.lanes=0);_|=be,y.lanes=be,y.memoizedState=wa}}function lc(y,v,z){if(y=v.effects,v.effects=null,y!==null)for(v=0;v<y.length;v++){var k=y[v],W=k.callback;if(W!==null){if(k.callback=null,k=z,typeof W!="function")throw Error(d(191,W));W.call(k)}}}var Oo={},xa=Dc(Oo),Eu=Dc(Oo),Zd=Dc(Oo);function Ml(y){if(y===Oo)throw Error(d(174));return y}function Nd(y,v){switch($n(Zd,v),$n(Eu,y),$n(xa,Oo),y=v.nodeType,y){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:La(null,"");break;default:y=y===8?v.parentNode:v,v=y.namespaceURI||null,y=y.tagName,v=La(v,y)}ti(xa),$n(xa,v)}function Uc(){ti(xa),ti(Eu),ti(Zd)}function gf(y){Ml(Zd.current);var v=Ml(xa.current),z=La(v,y.type);v!==z&&($n(Eu,y),$n(xa,z))}function _f(y){Eu.current===y&&(ti(xa),ti(Eu))}var xi=Dc(0);function xf(y){for(var v=y;v!==null;){if(v.tag===13){var z=v.memoizedState;if(z!==null&&(z=z.dehydrated,z===null||z.data==="$?"||z.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===y)break;for(;v.sibling===null;){if(v.return===null||v.return===y)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var Ns=[];function Ah(){for(var y=0;y<Ns.length;y++)Ns[y]._workInProgressVersionPrimary=null;Ns.length=0}var Hi=$e.ReactCurrentDispatcher,Bl=$e.ReactCurrentBatchConfig,Wc=0,fi=null,ki=null,Ui=null,Ed=!1,ns=!1,$r=0,Rh=0;function Ji(){throw Error(d(321))}function wf(y,v){if(v===null)return!1;for(var z=0;z<v.length&&z<y.length;z++)if(!qs(y[z],v[z]))return!1;return!0}function vf(y,v,z,k,W,ee){if(Wc=ee,fi=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Hi.current=y===null||y.memoizedState===null?yp:Ds,y=z(k,W),ns){ee=0;do{if(ns=!1,$r=0,25<=ee)throw Error(d(301));ee+=1,Ui=ki=null,v.updateQueue=null,Hi.current=Vu,y=z(k,W)}while(ns)}if(Hi.current=tr,v=ki!==null&&ki.next!==null,Wc=0,Ui=ki=fi=null,Ed=!1,v)throw Error(d(300));return y}function hl(){var y=$r!==0;return $r=0,y}function Do(){var y={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ui===null?fi.memoizedState=Ui=y:Ui=Ui.next=y,Ui}function wi(){if(ki===null){var y=fi.alternate;y=y!==null?y.memoizedState:null}else y=ki.next;var v=Ui===null?fi.memoizedState:Ui.next;if(v!==null)Ui=v,ki=y;else{if(y===null)throw Error(d(310));ki=y,y={memoizedState:ki.memoizedState,baseState:ki.baseState,baseQueue:ki.baseQueue,queue:ki.queue,next:null},Ui===null?fi.memoizedState=Ui=y:Ui=Ui.next=y}return Ui}function fl(y,v){return typeof v=="function"?v(y):v}function Tt(y){var v=wi(),z=v.queue;if(z===null)throw Error(d(311));z.lastRenderedReducer=y;var k=ki,W=k.baseQueue,ee=z.pending;if(ee!==null){if(W!==null){var be=W.next;W.next=ee.next,ee.next=be}k.baseQueue=W=ee,z.pending=null}if(W!==null){ee=W.next,k=k.baseState;var He=be=null,lt=null,Ut=ee;do{var ga=Ut.lane;if((Wc&ga)===ga)lt!==null&&(lt=lt.next={lane:0,action:Ut.action,hasEagerState:Ut.hasEagerState,eagerState:Ut.eagerState,next:null}),k=Ut.hasEagerState?Ut.eagerState:y(k,Ut.action);else{var wa={lane:ga,action:Ut.action,hasEagerState:Ut.hasEagerState,eagerState:Ut.eagerState,next:null};lt===null?(He=lt=wa,be=k):lt=lt.next=wa,fi.lanes|=ga,_|=ga}Ut=Ut.next}while(Ut!==null&&Ut!==ee);lt===null?be=k:lt.next=He,qs(k,v.memoizedState)||(Yi=!0),v.memoizedState=k,v.baseState=be,v.baseQueue=lt,z.lastRenderedState=k}if(y=z.interleaved,y!==null){W=y;do ee=W.lane,fi.lanes|=ee,_|=ee,W=W.next;while(W!==y)}else W===null&&(z.lanes=0);return[v.memoizedState,z.dispatch]}function Kt(y){var v=wi(),z=v.queue;if(z===null)throw Error(d(311));z.lastRenderedReducer=y;var k=z.dispatch,W=z.pending,ee=v.memoizedState;if(W!==null){z.pending=null;var be=W=W.next;do ee=y(ee,be.action),be=be.next;while(be!==W);qs(ee,v.memoizedState)||(Yi=!0),v.memoizedState=ee,v.baseQueue===null&&(v.baseState=ee),z.lastRenderedState=ee}return[ee,k]}function Su(){}function Mn(y,v){var z=fi,k=wi(),W=v(),ee=!qs(k.memoizedState,W);if(ee&&(k.memoizedState=W,Yi=!0),k=k.queue,Os(zu.bind(null,z,k,y),[y]),k.getSnapshot!==v||ee||Ui!==null&&Ui.memoizedState.tag&1){if(z.flags|=2048,Il(9,bf.bind(null,z,k,W,v),void 0,null),is===null)throw Error(d(349));(Wc&30)!==0||Ue(z,v,W)}return W}function Ue(y,v,z){y.flags|=16384,y={getSnapshot:v,value:z},v=fi.updateQueue,v===null?(v={lastEffect:null,stores:null},fi.updateQueue=v,v.stores=[y]):(z=v.stores,z===null?v.stores=[y]:z.push(y))}function bf(y,v,z,k){v.value=z,v.getSnapshot=k,Au(v)&&Th(y)}function zu(y,v,z){return z(function(){Au(v)&&Th(y)})}function Au(y){var v=y.getSnapshot;y=y.value;try{var z=v();return!qs(y,z)}catch{return!0}}function Th(y){var v=ko(y,1);v!==null&&we(v,y,1,-1)}function Vh(y){var v=Do();return typeof y=="function"&&(y=y()),v.memoizedState=v.baseState=y,y={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fl,lastRenderedState:y},v.queue=y,y=y.dispatch=gs.bind(null,fi,y),[v.memoizedState,y]}function Il(y,v,z,k){return y={tag:y,create:v,destroy:z,deps:k,next:null},v=fi.updateQueue,v===null?(v={lastEffect:null,stores:null},fi.updateQueue=v,v.lastEffect=y.next=y):(z=v.lastEffect,z===null?v.lastEffect=y.next=y:(k=z.next,z.next=y,y.next=k,v.lastEffect=y)),y}function Ru(){return wi().memoizedState}function Lf(y,v,z,k){var W=Do();fi.flags|=y,W.memoizedState=Il(1|v,z,void 0,k===void 0?null:k)}function Mh(y,v,z,k){var W=wi();k=k===void 0?null:k;var ee=void 0;if(ki!==null){var be=ki.memoizedState;if(ee=be.destroy,k!==null&&wf(k,be.deps)){W.memoizedState=Il(v,z,ee,k);return}}fi.flags|=y,W.memoizedState=Il(1|v,z,ee,k)}function dp(y,v){return Lf(8390656,8,y,v)}function Os(y,v){return Mh(2048,8,y,v)}function jf(y,v){return Mh(4,2,y,v)}function Zf(y,v){return Mh(4,4,y,v)}function hp(y,v){if(typeof v=="function")return y=y(),v(y),function(){v(null)};if(v!=null)return y=y(),v.current=y,function(){v.current=null}}function Bh(y,v,z){return z=z!=null?z.concat([y]):null,Mh(4,4,hp.bind(null,v,y),z)}function Tu(){}function Xc(y,v){var z=wi();v=v===void 0?null:v;var k=z.memoizedState;return k!==null&&v!==null&&wf(v,k[1])?k[0]:(z.memoizedState=[y,v],y)}function fp(y,v){var z=wi();v=v===void 0?null:v;var k=z.memoizedState;return k!==null&&v!==null&&wf(v,k[1])?k[0]:(y=y(),z.memoizedState=[y,v],y)}function pp(y,v,z){return(Wc&21)===0?(y.baseState&&(y.baseState=!1,Yi=!0),y.memoizedState=z):(qs(z,v)||(z=ds(),fi.lanes|=z,_|=z,y.baseState=!0),v)}function fy(y,v){var z=zn;zn=z!==0&&4>z?z:4,y(!0);var k=Bl.transition;Bl.transition={};try{y(!1),v()}finally{zn=z,Bl.transition=k}}function mp(){return wi().memoizedState}function py(y,v,z){var k=Ne(y);if(z={lane:k,action:z,hasEagerState:!1,eagerState:null,next:null},cm(y))Sd(v,z);else if(z=zh(y,v,z,k),z!==null){var W=me();we(z,y,k,W),dn(z,v,k)}}function gs(y,v,z){var k=Ne(y),W={lane:k,action:z,hasEagerState:!1,eagerState:null,next:null};if(cm(y))Sd(v,W);else{var ee=y.alternate;if(y.lanes===0&&(ee===null||ee.lanes===0)&&(ee=v.lastRenderedReducer,ee!==null))try{var be=v.lastRenderedState,He=ee(be,z);if(W.hasEagerState=!0,W.eagerState=He,qs(He,be)){var lt=v.interleaved;lt===null?(W.next=W,Sh(v)):(W.next=lt.next,lt.next=W),v.interleaved=W;return}}catch{}finally{}z=zh(y,v,W,k),z!==null&&(W=me(),we(z,y,k,W),dn(z,v,k))}}function cm(y){var v=y.alternate;return y===fi||v!==null&&v===fi}function Sd(y,v){ns=Ed=!0;var z=y.pending;z===null?v.next=v:(v.next=z.next,z.next=v),y.pending=v}function dn(y,v,z){if((z&4194240)!==0){var k=v.lanes;k&=y.pendingLanes,z|=k,v.lanes=z,qu(y,z)}}var tr={readContext:Zs,useCallback:Ji,useContext:Ji,useEffect:Ji,useImperativeHandle:Ji,useInsertionEffect:Ji,useLayoutEffect:Ji,useMemo:Ji,useReducer:Ji,useRef:Ji,useState:Ji,useDebugValue:Ji,useDeferredValue:Ji,useTransition:Ji,useMutableSource:Ji,useSyncExternalStore:Ji,useId:Ji,unstable_isNewReconciler:!1},yp={readContext:Zs,useCallback:function(y,v){return Do().memoizedState=[y,v===void 0?null:v],y},useContext:Zs,useEffect:dp,useImperativeHandle:function(y,v,z){return z=z!=null?z.concat([y]):null,Lf(4194308,4,hp.bind(null,v,y),z)},useLayoutEffect:function(y,v){return Lf(4194308,4,y,v)},useInsertionEffect:function(y,v){return Lf(4,2,y,v)},useMemo:function(y,v){var z=Do();return v=v===void 0?null:v,y=y(),z.memoizedState=[y,v],y},useReducer:function(y,v,z){var k=Do();return v=z!==void 0?z(v):v,k.memoizedState=k.baseState=v,y={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:y,lastRenderedState:v},k.queue=y,y=y.dispatch=py.bind(null,fi,y),[k.memoizedState,y]},useRef:function(y){var v=Do();return y={current:y},v.memoizedState=y},useState:Vh,useDebugValue:Tu,useDeferredValue:function(y){return Do().memoizedState=y},useTransition:function(){var y=Vh(!1),v=y[0];return y=fy.bind(null,y[1]),Do().memoizedState=y,[v,y]},useMutableSource:function(){},useSyncExternalStore:function(y,v,z){var k=fi,W=Do();if(Qn){if(z===void 0)throw Error(d(407));z=z()}else{if(z=v(),is===null)throw Error(d(349));(Wc&30)!==0||Ue(k,v,z)}W.memoizedState=z;var ee={value:z,getSnapshot:v};return W.queue=ee,dp(zu.bind(null,k,ee,y),[y]),k.flags|=2048,Il(9,bf.bind(null,k,ee,z,v),void 0,null),z},useId:function(){var y=Do(),v=is.identifierPrefix;if(Qn){var z=sc,k=Vl;z=(k&~(1<<32-Ka(k)-1)).toString(32)+z,v=":"+v+"R"+z,z=$r++,0<z&&(v+="H"+z.toString(32)),v+=":"}else z=Rh++,v=":"+v+"r"+z.toString(32)+":";return y.memoizedState=v},unstable_isNewReconciler:!1},Ds={readContext:Zs,useCallback:Xc,useContext:Zs,useEffect:Os,useImperativeHandle:Bh,useInsertionEffect:jf,useLayoutEffect:Zf,useMemo:fp,useReducer:Tt,useRef:Ru,useState:function(){return Tt(fl)},useDebugValue:Tu,useDeferredValue:function(y){var v=wi();return pp(v,ki.memoizedState,y)},useTransition:function(){var y=Tt(fl)[0],v=wi().memoizedState;return[y,v]},useMutableSource:Su,useSyncExternalStore:Mn,useId:mp,unstable_isNewReconciler:!1},Vu={readContext:Zs,useCallback:Xc,useContext:Zs,useEffect:Os,useImperativeHandle:Bh,useInsertionEffect:jf,useLayoutEffect:Zf,useMemo:fp,useReducer:Kt,useRef:Ru,useState:function(){return Kt(fl)},useDebugValue:Tu,useDeferredValue:function(y){var v=wi();return ki===null?v.memoizedState=y:pp(v,ki.memoizedState,y)},useTransition:function(){var y=Kt(fl)[0],v=wi().memoizedState;return[y,v]},useMutableSource:Su,useSyncExternalStore:Mn,useId:mp,unstable_isNewReconciler:!1};function Es(y,v){if(y&&y.defaultProps){v=ze({},v),y=y.defaultProps;for(var z in y)v[z]===void 0&&(v[z]=y[z]);return v}return v}function pl(y,v,z,k){v=y.memoizedState,z=z(k,v),z=z==null?v:ze({},v,z),y.memoizedState=z,y.lanes===0&&(y.updateQueue.baseState=z)}var zd={isMounted:function(y){return(y=y._reactInternals)?Ve(y)===y:!1},enqueueSetState:function(y,v,z){y=y._reactInternals;var k=me(),W=Ne(y),ee=Fs(k,W);ee.payload=v,z!=null&&(ee.callback=z),v=wo(y,ee,W),v!==null&&(we(v,y,W,k),na(v,y,W))},enqueueReplaceState:function(y,v,z){y=y._reactInternals;var k=me(),W=Ne(y),ee=Fs(k,W);ee.tag=1,ee.payload=v,z!=null&&(ee.callback=z),v=wo(y,ee,W),v!==null&&(we(v,y,W,k),na(v,y,W))},enqueueForceUpdate:function(y,v){y=y._reactInternals;var z=me(),k=Ne(y),W=Fs(z,k);W.tag=2,v!=null&&(W.callback=v),v=wo(y,W,k),v!==null&&(we(v,y,k,z),na(v,y,k))}};function Nf(y,v,z,k,W,ee,be){return y=y.stateNode,typeof y.shouldComponentUpdate=="function"?y.shouldComponentUpdate(k,ee,be):v.prototype&&v.prototype.isPureReactComponent?!ec(z,k)||!ec(W,ee):!0}function Ih(y,v,z){var k=!1,W=ll,ee=v.contextType;return typeof ee=="object"&&ee!==null?ee=Zs(ee):(W=rs(v)?nc:Qi.current,k=v.contextTypes,ee=(k=k!=null)?bu(y,W):ll),v=new v(z,ee),y.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=zd,y.stateNode=v,v._reactInternals=y,k&&(y=y.stateNode,y.__reactInternalMemoizedUnmaskedChildContext=W,y.__reactInternalMemoizedMaskedChildContext=ee),v}function kh(y,v,z,k){y=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(z,k),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(z,k),v.state!==y&&zd.enqueueReplaceState(v,v.state,null)}function Cs(y,v,z,k){var W=y.stateNode;W.props=z,W.state=y.memoizedState,W.refs={},jd(y);var ee=v.contextType;typeof ee=="object"&&ee!==null?W.context=Zs(ee):(ee=rs(v)?nc:Qi.current,W.context=bu(y,ee)),W.state=y.memoizedState,ee=v.getDerivedStateFromProps,typeof ee=="function"&&(pl(y,v,ee,z),W.state=y.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(v=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),v!==W.state&&zd.enqueueReplaceState(W,W.state,null),Fo(y,z,W,k),W.state=y.memoizedState),typeof W.componentDidMount=="function"&&(y.flags|=4194308)}function vo(y,v){try{var z="",k=v;do z+=lr(k),k=k.return;while(k);var W=z}catch(ee){W=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:y,source:v,stack:W,digest:null}}function cc(y,v,z){return{value:y,source:null,stack:z??null,digest:v??null}}function Ad(y,v){try{console.error(v.value)}catch(z){setTimeout(function(){throw z})}}var Ef=typeof WeakMap=="function"?WeakMap:Map;function Mu(y,v,z){z=Fs(-1,z),z.tag=3,z.payload={element:null};var k=v.value;return z.callback=function(){J||(J=!0,U=k),Ad(y,v)},z}function uc(y,v,z){z=Fs(-1,z),z.tag=3;var k=y.type.getDerivedStateFromError;if(typeof k=="function"){var W=v.value;z.payload=function(){return k(W)},z.callback=function(){Ad(y,v)}}var ee=y.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(z.callback=function(){Ad(y,v),typeof k!="function"&&(H===null?H=new Set([this]):H.add(this));var be=v.stack;this.componentDidCatch(v.value,{componentStack:be!==null?be:""})}),z}function Sf(y,v,z){var k=y.pingCache;if(k===null){k=y.pingCache=new Ef;var W=new Set;k.set(v,W)}else W=k.get(v),W===void 0&&(W=new Set,k.set(v,W));W.has(z)||(W.add(z),y=Qr.bind(null,y,v,z),v.then(y,y))}function bo(y){do{var v;if((v=y.tag===13)&&(v=y.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return y;y=y.return}while(y!==null);return null}function zf(y,v,z,k,W){return(y.mode&1)===0?(y===v?y.flags|=65536:(y.flags|=128,z.flags|=131072,z.flags&=-52805,z.tag===1&&(z.alternate===null?z.tag=17:(v=Fs(-1,1),v.tag=2,wo(z,v,1))),z.lanes|=1),y):(y.flags|=65536,y.lanes=W,y)}var Af=$e.ReactCurrentOwner,Yi=!1;function Wi(y,v,z,k){v.child=y===null?Eh(v,null,z,k):Gc(v,y.child,z,k)}function gn(y,v,z,k,W){z=z.render;var ee=v.ref;return Js(v,W),k=vf(y,v,z,k,ee,W),z=hl(),y!==null&&!Yi?(v.updateQueue=y.updateQueue,v.flags&=-2053,y.lanes&=~W,kl(y,v,W)):(Qn&&z&&_d(v),v.flags|=1,Wi(y,v,k,W),v.child)}function Bu(y,v,z,k,W){if(y===null){var ee=z.type;return typeof ee=="function"&&!Ga(ee)&&ee.defaultProps===void 0&&z.compare===null&&z.defaultProps===void 0?(v.tag=15,v.type=ee,Rf(y,v,ee,k,W)):(y=en(z.type,null,k,v,v.mode,W),y.ref=v.ref,y.return=v,v.child=y)}if(ee=y.child,(y.lanes&W)===0){var be=ee.memoizedProps;if(z=z.compare,z=z!==null?z:ec,z(be,k)&&y.ref===v.ref)return kl(y,v,W)}return v.flags|=1,y=Ca(ee,k),y.ref=v.ref,y.return=v,v.child=y}function Rf(y,v,z,k,W){if(y!==null){var ee=y.memoizedProps;if(ec(ee,k)&&y.ref===v.ref)if(Yi=!1,v.pendingProps=k=ee,(y.lanes&W)!==0)(y.flags&131072)!==0&&(Yi=!0);else return v.lanes=y.lanes,kl(y,v,W)}return Jh(y,v,z,k,W)}function Tf(y,v,z){var k=v.pendingProps,W=k.children,ee=y!==null?y.memoizedState:null;if(k.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},$n(t,h),h|=z;else{if((z&1073741824)===0)return y=ee!==null?ee.baseLanes|z:z,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:y,cachePool:null,transitions:null},v.updateQueue=null,$n(t,h),h|=y,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=ee!==null?ee.baseLanes:z,$n(t,h),h|=k}else ee!==null?(k=ee.baseLanes|z,v.memoizedState=null):k=z,$n(t,h),h|=k;return Wi(y,v,W,z),v.child}function Qc(y,v){var z=v.ref;(y===null&&z!==null||y!==null&&y.ref!==z)&&(v.flags|=512,v.flags|=2097152)}function Jh(y,v,z,k,W){var ee=rs(z)?nc:Qi.current;return ee=bu(v,ee),Js(v,W),z=vf(y,v,z,k,ee,W),k=hl(),y!==null&&!Yi?(v.updateQueue=y.updateQueue,v.flags&=-2053,y.lanes&=~W,kl(y,v,W)):(Qn&&k&&_d(v),v.flags|=1,Wi(y,v,z,W),v.child)}function Rd(y,v,z,k,W){if(rs(z)){var ee=!0;md(v)}else ee=!1;if(Js(v,W),v.stateNode===null)Id(y,v),Ih(v,z,k),Cs(v,z,k,W),k=!0;else if(y===null){var be=v.stateNode,He=v.memoizedProps;be.props=He;var lt=be.context,Ut=z.contextType;typeof Ut=="object"&&Ut!==null?Ut=Zs(Ut):(Ut=rs(z)?nc:Qi.current,Ut=bu(v,Ut));var ga=z.getDerivedStateFromProps,wa=typeof ga=="function"||typeof be.getSnapshotBeforeUpdate=="function";wa||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(He!==k||lt!==Ut)&&kh(v,be,k,Ut),Jo=!1;var _a=v.memoizedState;be.state=_a,Fo(v,k,be,W),lt=v.memoizedState,He!==k||_a!==lt||Gi.current||Jo?(typeof ga=="function"&&(pl(v,z,ga,k),lt=v.memoizedState),(He=Jo||Nf(v,z,He,k,_a,lt,Ut))?(wa||typeof be.UNSAFE_componentWillMount!="function"&&typeof be.componentWillMount!="function"||(typeof be.componentWillMount=="function"&&be.componentWillMount(),typeof be.UNSAFE_componentWillMount=="function"&&be.UNSAFE_componentWillMount()),typeof be.componentDidMount=="function"&&(v.flags|=4194308)):(typeof be.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=k,v.memoizedState=lt),be.props=k,be.state=lt,be.context=Ut,k=He):(typeof be.componentDidMount=="function"&&(v.flags|=4194308),k=!1)}else{be=v.stateNode,up(y,v),He=v.memoizedProps,Ut=v.type===v.elementType?He:Es(v.type,He),be.props=Ut,wa=v.pendingProps,_a=be.context,lt=z.contextType,typeof lt=="object"&&lt!==null?lt=Zs(lt):(lt=rs(z)?nc:Qi.current,lt=bu(v,lt));var Ha=z.getDerivedStateFromProps;(ga=typeof Ha=="function"||typeof be.getSnapshotBeforeUpdate=="function")||typeof be.UNSAFE_componentWillReceiveProps!="function"&&typeof be.componentWillReceiveProps!="function"||(He!==wa||_a!==lt)&&kh(v,be,k,lt),Jo=!1,_a=v.memoizedState,be.state=_a,Fo(v,k,be,W);var er=v.memoizedState;He!==wa||_a!==er||Gi.current||Jo?(typeof Ha=="function"&&(pl(v,z,Ha,k),er=v.memoizedState),(Ut=Jo||Nf(v,z,Ut,k,_a,er,lt)||!1)?(ga||typeof be.UNSAFE_componentWillUpdate!="function"&&typeof be.componentWillUpdate!="function"||(typeof be.componentWillUpdate=="function"&&be.componentWillUpdate(k,er,lt),typeof be.UNSAFE_componentWillUpdate=="function"&&be.UNSAFE_componentWillUpdate(k,er,lt)),typeof be.componentDidUpdate=="function"&&(v.flags|=4),typeof be.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof be.componentDidUpdate!="function"||He===y.memoizedProps&&_a===y.memoizedState||(v.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||He===y.memoizedProps&&_a===y.memoizedState||(v.flags|=1024),v.memoizedProps=k,v.memoizedState=er),be.props=k,be.state=er,be.context=lt,k=Ut):(typeof be.componentDidUpdate!="function"||He===y.memoizedProps&&_a===y.memoizedState||(v.flags|=4),typeof be.getSnapshotBeforeUpdate!="function"||He===y.memoizedProps&&_a===y.memoizedState||(v.flags|=1024),k=!1)}return Fh(y,v,z,k,ee,W)}function Fh(y,v,z,k,W,ee){Qc(y,v);var be=(v.flags&128)!==0;if(!k&&!be)return W&&yd(v,z,!1),kl(y,v,ee);k=v.stateNode,Af.current=v;var He=be&&typeof z.getDerivedStateFromError!="function"?null:k.render();return v.flags|=1,y!==null&&be?(v.child=Gc(v,y.child,null,ee),v.child=Gc(v,null,He,ee)):Wi(y,v,He,ee),v.memoizedState=k.state,W&&yd(v,z,!0),v.child}function dc(y){var v=y.stateNode;v.pendingContext?xh(y,v.pendingContext,v.pendingContext!==v.context):v.context&&xh(y,v.context,!1),Nd(y,v.containerInfo)}function Vf(y,v,z,k,W){return _o(),jh(W),v.flags|=256,Wi(y,v,z,k),v.child}var Td={dehydrated:null,treeContext:null,retryLane:0};function Vd(y){return{baseLanes:y,cachePool:null,transitions:null}}function Iu(y,v,z){var k=v.pendingProps,W=xi.current,ee=!1,be=(v.flags&128)!==0,He;if((He=be)||(He=y!==null&&y.memoizedState===null?!1:(W&2)!==0),He?(ee=!0,v.flags&=-129):(y===null||y.memoizedState!==null)&&(W|=1),$n(xi,W&1),y===null)return dl(v),y=v.memoizedState,y!==null&&(y=y.dehydrated,y!==null)?((v.mode&1)===0?v.lanes=1:y.data==="$!"?v.lanes=8:v.lanes=1073741824,null):(be=k.children,y=k.fallback,ee?(k=v.mode,ee=v.child,be={mode:"hidden",children:be},(k&1)===0&&ee!==null?(ee.childLanes=0,ee.pendingProps=be):ee=Va(be,k,0,null),y=_r(y,k,z,null),ee.return=v,y.return=v,ee.sibling=y,v.child=ee,v.child.memoizedState=Vd(z),v.memoizedState=Td,y):Oh(v,be));if(W=y.memoizedState,W!==null&&(He=W.dehydrated,He!==null))return gp(y,v,be,k,He,W,z);if(ee){ee=k.fallback,be=v.mode,W=y.child,He=W.sibling;var lt={mode:"hidden",children:k.children};return(be&1)===0&&v.child!==W?(k=v.child,k.childLanes=0,k.pendingProps=lt,v.deletions=null):(k=Ca(W,lt),k.subtreeFlags=W.subtreeFlags&14680064),He!==null?ee=Ca(He,ee):(ee=_r(ee,be,z,null),ee.flags|=2),ee.return=v,k.return=v,k.sibling=ee,v.child=k,k=ee,ee=v.child,be=y.child.memoizedState,be=be===null?Vd(z):{baseLanes:be.baseLanes|z,cachePool:null,transitions:be.transitions},ee.memoizedState=be,ee.childLanes=y.childLanes&~z,v.memoizedState=Td,k}return ee=y.child,y=ee.sibling,k=Ca(ee,{mode:"visible",children:k.children}),(v.mode&1)===0&&(k.lanes=z),k.return=v,k.sibling=null,y!==null&&(z=v.deletions,z===null?(v.deletions=[y],v.flags|=16):z.push(y)),v.child=k,v.memoizedState=null,k}function Oh(y,v){return v=Va({mode:"visible",children:v},y.mode,0,null),v.return=y,y.child=v}function ku(y,v,z,k){return k!==null&&jh(k),Gc(v,y.child,null,z),y=Oh(v,v.pendingProps.children),y.flags|=2,v.memoizedState=null,y}function gp(y,v,z,k,W,ee,be){if(z)return v.flags&256?(v.flags&=-257,k=cc(Error(d(422))),ku(y,v,be,k)):v.memoizedState!==null?(v.child=y.child,v.flags|=128,null):(ee=k.fallback,W=v.mode,k=Va({mode:"visible",children:k.children},W,0,null),ee=_r(ee,W,be,null),ee.flags|=2,k.return=v,ee.return=v,k.sibling=ee,v.child=k,(v.mode&1)!==0&&Gc(v,y.child,null,be),v.child.memoizedState=Vd(be),v.memoizedState=Td,ee);if((v.mode&1)===0)return ku(y,v,be,null);if(W.data==="$!"){if(k=W.nextSibling&&W.nextSibling.dataset,k)var He=k.dgst;return k=He,ee=Error(d(419)),k=cc(ee,k,void 0),ku(y,v,be,k)}if(He=(be&y.childLanes)!==0,Yi||He){if(k=is,k!==null){switch(be&-be){case 4:W=2;break;case 16:W=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:W=32;break;case 536870912:W=268435456;break;default:W=0}W=(W&(k.suspendedLanes|be))!==0?0:W,W!==0&&W!==ee.retryLane&&(ee.retryLane=W,ko(y,W),we(k,y,W,-1))}return Ct(),k=cc(Error(d(421))),ku(y,v,be,k)}return W.data==="$?"?(v.flags|=128,v.child=y.child,v=pr.bind(null,y),W._reactRetry=v,null):(y=ee.treeContext,ao=Rl(W.nextSibling),ks=v,Qn=!0,go=null,y!==null&&(yo[ys++]=Vl,yo[ys++]=sc,yo[ys++]=Cc,Vl=y.id,sc=y.overflow,Cc=v),v=Oh(v,k.children),v.flags|=4096,v)}function _p(y,v,z){y.lanes|=v;var k=y.alternate;k!==null&&(k.lanes|=v),Ld(y.return,v,z)}function Md(y,v,z,k,W){var ee=y.memoizedState;ee===null?y.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:k,tail:z,tailMode:W}:(ee.isBackwards=v,ee.rendering=null,ee.renderingStartTime=0,ee.last=k,ee.tail=z,ee.tailMode=W)}function Bd(y,v,z){var k=v.pendingProps,W=k.revealOrder,ee=k.tail;if(Wi(y,v,k.children,z),k=xi.current,(k&2)!==0)k=k&1|2,v.flags|=128;else{if(y!==null&&(y.flags&128)!==0)e:for(y=v.child;y!==null;){if(y.tag===13)y.memoizedState!==null&&_p(y,z,v);else if(y.tag===19)_p(y,z,v);else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===v)break e;for(;y.sibling===null;){if(y.return===null||y.return===v)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}k&=1}if($n(xi,k),(v.mode&1)===0)v.memoizedState=null;else switch(W){case"forwards":for(z=v.child,W=null;z!==null;)y=z.alternate,y!==null&&xf(y)===null&&(W=z),z=z.sibling;z=W,z===null?(W=v.child,v.child=null):(W=z.sibling,z.sibling=null),Md(v,!1,W,z,ee);break;case"backwards":for(z=null,W=v.child,v.child=null;W!==null;){if(y=W.alternate,y!==null&&xf(y)===null){v.child=W;break}y=W.sibling,W.sibling=z,z=W,W=y}Md(v,!0,z,null,ee);break;case"together":Md(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function Id(y,v){(v.mode&1)===0&&y!==null&&(y.alternate=null,v.alternate=null,v.flags|=2)}function kl(y,v,z){if(y!==null&&(v.dependencies=y.dependencies),_|=v.lanes,(z&v.childLanes)===0)return null;if(y!==null&&v.child!==y.child)throw Error(d(153));if(v.child!==null){for(y=v.child,z=Ca(y,y.pendingProps),v.child=z,z.return=v;y.sibling!==null;)y=y.sibling,z=z.sibling=Ca(y,y.pendingProps),z.return=v;z.sibling=null}return v.child}function xp(y,v,z){switch(v.tag){case 3:dc(v),_o();break;case 5:gf(v);break;case 1:rs(v.type)&&md(v);break;case 4:Nd(v,v.stateNode.containerInfo);break;case 10:var k=v.type._context,W=v.memoizedProps.value;$n(oc,k._currentValue),k._currentValue=W;break;case 13:if(k=v.memoizedState,k!==null)return k.dehydrated!==null?($n(xi,xi.current&1),v.flags|=128,null):(z&v.child.childLanes)!==0?Iu(y,v,z):($n(xi,xi.current&1),y=kl(y,v,z),y!==null?y.sibling:null);$n(xi,xi.current&1);break;case 19:if(k=(z&v.childLanes)!==0,(y.flags&128)!==0){if(k)return Bd(y,v,z);v.flags|=128}if(W=v.memoizedState,W!==null&&(W.rendering=null,W.tail=null,W.lastEffect=null),$n(xi,xi.current),k)break;return null;case 22:case 23:return v.lanes=0,Tf(y,v,z)}return kl(y,v,z)}var wp,kd,vp,bp;wp=function(y,v){for(var z=v.child;z!==null;){if(z.tag===5||z.tag===6)y.appendChild(z.stateNode);else if(z.tag!==4&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===v)break;for(;z.sibling===null;){if(z.return===null||z.return===v)return;z=z.return}z.sibling.return=z.return,z=z.sibling}},kd=function(){},vp=function(y,v,z,k){var W=y.memoizedProps;if(W!==k){y=v.stateNode,Ml(xa.current);var ee=null;switch(z){case"input":W=bs(y,W),k=bs(y,k),ee=[];break;case"select":W=ze({},W,{value:void 0}),k=ze({},k,{value:void 0}),ee=[];break;case"textarea":W=cs(y,W),k=cs(y,k),ee=[];break;default:typeof W.onClick!="function"&&typeof k.onClick=="function"&&(y.onclick=cf)}Zi(z,k);var be;z=null;for(Ut in W)if(!k.hasOwnProperty(Ut)&&W.hasOwnProperty(Ut)&&W[Ut]!=null)if(Ut==="style"){var He=W[Ut];for(be in He)He.hasOwnProperty(be)&&(z||(z={}),z[be]="")}else Ut!=="dangerouslySetInnerHTML"&&Ut!=="children"&&Ut!=="suppressContentEditableWarning"&&Ut!=="suppressHydrationWarning"&&Ut!=="autoFocus"&&(j.hasOwnProperty(Ut)?ee||(ee=[]):(ee=ee||[]).push(Ut,null));for(Ut in k){var lt=k[Ut];if(He=W?.[Ut],k.hasOwnProperty(Ut)&&lt!==He&&(lt!=null||He!=null))if(Ut==="style")if(He){for(be in He)!He.hasOwnProperty(be)||lt&&lt.hasOwnProperty(be)||(z||(z={}),z[be]="");for(be in lt)lt.hasOwnProperty(be)&&He[be]!==lt[be]&&(z||(z={}),z[be]=lt[be])}else z||(ee||(ee=[]),ee.push(Ut,z)),z=lt;else Ut==="dangerouslySetInnerHTML"?(lt=lt?lt.__html:void 0,He=He?He.__html:void 0,lt!=null&&He!==lt&&(ee=ee||[]).push(Ut,lt)):Ut==="children"?typeof lt!="string"&&typeof lt!="number"||(ee=ee||[]).push(Ut,""+lt):Ut!=="suppressContentEditableWarning"&&Ut!=="suppressHydrationWarning"&&(j.hasOwnProperty(Ut)?(lt!=null&&Ut==="onScroll"&&hi("scroll",y),ee||He===lt||(ee=[])):(ee=ee||[]).push(Ut,lt))}z&&(ee=ee||[]).push("style",z);var Ut=ee;(v.updateQueue=Ut)&&(v.flags|=4)}},bp=function(y,v,z,k){z!==k&&(v.flags|=4)};function Jd(y,v){if(!Qn)switch(y.tailMode){case"hidden":v=y.tail;for(var z=null;v!==null;)v.alternate!==null&&(z=v),v=v.sibling;z===null?y.tail=null:z.sibling=null;break;case"collapsed":z=y.tail;for(var k=null;z!==null;)z.alternate!==null&&(k=z),z=z.sibling;k===null?v||y.tail===null?y.tail=null:y.tail.sibling=null:k.sibling=null}}function _s(y){var v=y.alternate!==null&&y.alternate.child===y.child,z=0,k=0;if(v)for(var W=y.child;W!==null;)z|=W.lanes|W.childLanes,k|=W.subtreeFlags&14680064,k|=W.flags&14680064,W.return=y,W=W.sibling;else for(W=y.child;W!==null;)z|=W.lanes|W.childLanes,k|=W.subtreeFlags,k|=W.flags,W.return=y,W=W.sibling;return y.subtreeFlags|=k,y.childLanes=z,v}function um(y,v,z){var k=v.pendingProps;switch(Lh(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _s(v),null;case 1:return rs(v.type)&&Tl(),_s(v),null;case 3:return k=v.stateNode,Uc(),ti(Gi),ti(Qi),Ah(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(y===null||y.child===null)&&(Zu(v)?v.flags|=4:y===null||y.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,go!==null&&(Fe(go),go=null))),kd(y,v),_s(v),null;case 5:_f(v);var W=Ml(Zd.current);if(z=v.type,y!==null&&v.stateNode!=null)vp(y,v,z,k,W),y.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!k){if(v.stateNode===null)throw Error(d(166));return _s(v),null}if(y=Ml(xa.current),Zu(v)){k=v.stateNode,z=v.type;var ee=v.memoizedProps;switch(k[po]=v,k[Fc]=ee,y=(v.mode&1)!==0,z){case"dialog":hi("cancel",k),hi("close",k);break;case"iframe":case"object":case"embed":hi("load",k);break;case"video":case"audio":for(W=0;W<Jc.length;W++)hi(Jc[W],k);break;case"source":hi("error",k);break;case"img":case"image":case"link":hi("error",k),hi("load",k);break;case"details":hi("toggle",k);break;case"input":Xr(k,ee),hi("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!ee.multiple},hi("invalid",k);break;case"textarea":Ls(k,ee),hi("invalid",k)}Zi(z,ee),W=null;for(var be in ee)if(ee.hasOwnProperty(be)){var He=ee[be];be==="children"?typeof He=="string"?k.textContent!==He&&(ee.suppressHydrationWarning!==!0&&gu(k.textContent,He,y),W=["children",He]):typeof He=="number"&&k.textContent!==""+He&&(ee.suppressHydrationWarning!==!0&&gu(k.textContent,He,y),W=["children",""+He]):j.hasOwnProperty(be)&&He!=null&&be==="onScroll"&&hi("scroll",k)}switch(z){case"input":Pn(k),Sr(k,ee,!0);break;case"textarea":Pn(k),Ko(k);break;case"select":case"option":break;default:typeof ee.onClick=="function"&&(k.onclick=cf)}k=W,v.updateQueue=k,k!==null&&(v.flags|=4)}else{be=W.nodeType===9?W:W.ownerDocument,y==="http://www.w3.org/1999/xhtml"&&(y=aa(z)),y==="http://www.w3.org/1999/xhtml"?z==="script"?(y=be.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild)):typeof k.is=="string"?y=be.createElement(z,{is:k.is}):(y=be.createElement(z),z==="select"&&(be=y,k.multiple?be.multiple=!0:k.size&&(be.size=k.size))):y=be.createElementNS(y,z),y[po]=v,y[Fc]=k,wp(y,v,!1,!1),v.stateNode=y;e:{switch(be=ts(z,k),z){case"dialog":hi("cancel",y),hi("close",y),W=k;break;case"iframe":case"object":case"embed":hi("load",y),W=k;break;case"video":case"audio":for(W=0;W<Jc.length;W++)hi(Jc[W],y);W=k;break;case"source":hi("error",y),W=k;break;case"img":case"image":case"link":hi("error",y),hi("load",y),W=k;break;case"details":hi("toggle",y),W=k;break;case"input":Xr(y,k),W=bs(y,k),hi("invalid",y);break;case"option":W=k;break;case"select":y._wrapperState={wasMultiple:!!k.multiple},W=ze({},k,{value:void 0}),hi("invalid",y);break;case"textarea":Ls(y,k),W=cs(y,k),hi("invalid",y);break;default:W=k}Zi(z,W),He=W;for(ee in He)if(He.hasOwnProperty(ee)){var lt=He[ee];ee==="style"?kn(y,lt):ee==="dangerouslySetInnerHTML"?(lt=lt?lt.__html:void 0,lt!=null&&wr(y,lt)):ee==="children"?typeof lt=="string"?(z!=="textarea"||lt!=="")&&nn(y,lt):typeof lt=="number"&&nn(y,""+lt):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(j.hasOwnProperty(ee)?lt!=null&&ee==="onScroll"&&hi("scroll",y):lt!=null&&ye(y,ee,lt,be))}switch(z){case"input":Pn(y),Sr(y,k,!1);break;case"textarea":Pn(y),Ko(y);break;case"option":k.value!=null&&y.setAttribute("value",""+or(k.value));break;case"select":y.multiple=!!k.multiple,ee=k.value,ee!=null?Tn(y,!!k.multiple,ee,!1):k.defaultValue!=null&&Tn(y,!!k.multiple,k.defaultValue,!0);break;default:typeof W.onClick=="function"&&(y.onclick=cf)}switch(z){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return _s(v),null;case 6:if(y&&v.stateNode!=null)bp(y,v,y.memoizedProps,k);else{if(typeof k!="string"&&v.stateNode===null)throw Error(d(166));if(z=Ml(Zd.current),Ml(xa.current),Zu(v)){if(k=v.stateNode,z=v.memoizedProps,k[po]=v,(ee=k.nodeValue!==z)&&(y=ks,y!==null))switch(y.tag){case 3:gu(k.nodeValue,z,(y.mode&1)!==0);break;case 5:y.memoizedProps.suppressHydrationWarning!==!0&&gu(k.nodeValue,z,(y.mode&1)!==0)}ee&&(v.flags|=4)}else k=(z.nodeType===9?z:z.ownerDocument).createTextNode(k),k[po]=v,v.stateNode=k}return _s(v),null;case 13:if(ti(xi),k=v.memoizedState,y===null||y.memoizedState!==null&&y.memoizedState.dehydrated!==null){if(Qn&&ao!==null&&(v.mode&1)!==0&&(v.flags&128)===0)Pc(),_o(),v.flags|=98560,ee=!1;else if(ee=Zu(v),k!==null&&k.dehydrated!==null){if(y===null){if(!ee)throw Error(d(318));if(ee=v.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(d(317));ee[po]=v}else _o(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;_s(v),ee=!1}else go!==null&&(Fe(go),go=null),ee=!0;if(!ee)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=z,v):(k=k!==null,k!==(y!==null&&y.memoizedState!==null)&&k&&(v.child.flags|=8192,(v.mode&1)!==0&&(y===null||(xi.current&1)!==0?i===0&&(i=3):Ct())),v.updateQueue!==null&&(v.flags|=4),_s(v),null);case 4:return Uc(),kd(y,v),y===null&&ph(v.stateNode.containerInfo),_s(v),null;case 10:return bd(v.type._context),_s(v),null;case 17:return rs(v.type)&&Tl(),_s(v),null;case 19:if(ti(xi),ee=v.memoizedState,ee===null)return _s(v),null;if(k=(v.flags&128)!==0,be=ee.rendering,be===null)if(k)Jd(ee,!1);else{if(i!==0||y!==null&&(y.flags&128)!==0)for(y=v.child;y!==null;){if(be=xf(y),be!==null){for(v.flags|=128,Jd(ee,!1),k=be.updateQueue,k!==null&&(v.updateQueue=k,v.flags|=4),v.subtreeFlags=0,k=z,z=v.child;z!==null;)ee=z,y=k,ee.flags&=14680066,be=ee.alternate,be===null?(ee.childLanes=0,ee.lanes=y,ee.child=null,ee.subtreeFlags=0,ee.memoizedProps=null,ee.memoizedState=null,ee.updateQueue=null,ee.dependencies=null,ee.stateNode=null):(ee.childLanes=be.childLanes,ee.lanes=be.lanes,ee.child=be.child,ee.subtreeFlags=0,ee.deletions=null,ee.memoizedProps=be.memoizedProps,ee.memoizedState=be.memoizedState,ee.updateQueue=be.updateQueue,ee.type=be.type,y=be.dependencies,ee.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext}),z=z.sibling;return $n(xi,xi.current&1|2),v.child}y=y.sibling}ee.tail!==null&&ma()>I&&(v.flags|=128,k=!0,Jd(ee,!1),v.lanes=4194304)}else{if(!k)if(y=xf(be),y!==null){if(v.flags|=128,k=!0,z=y.updateQueue,z!==null&&(v.updateQueue=z,v.flags|=4),Jd(ee,!0),ee.tail===null&&ee.tailMode==="hidden"&&!be.alternate&&!Qn)return _s(v),null}else 2*ma()-ee.renderingStartTime>I&&z!==1073741824&&(v.flags|=128,k=!0,Jd(ee,!1),v.lanes=4194304);ee.isBackwards?(be.sibling=v.child,v.child=be):(z=ee.last,z!==null?z.sibling=be:v.child=be,ee.last=be)}return ee.tail!==null?(v=ee.tail,ee.rendering=v,ee.tail=v.sibling,ee.renderingStartTime=ma(),v.sibling=null,z=xi.current,$n(xi,k?z&1|2:z&1),v):(_s(v),null);case 22:case 23:return Ie(),k=v.memoizedState!==null,y!==null&&y.memoizedState!==null!==k&&(v.flags|=8192),k&&(v.mode&1)!==0?(h&1073741824)!==0&&(_s(v),v.subtreeFlags&6&&(v.flags|=8192)):_s(v),null;case 24:return null;case 25:return null}throw Error(d(156,v.tag))}function my(y,v){switch(Lh(v),v.tag){case 1:return rs(v.type)&&Tl(),y=v.flags,y&65536?(v.flags=y&-65537|128,v):null;case 3:return Uc(),ti(Gi),ti(Qi),Ah(),y=v.flags,(y&65536)!==0&&(y&128)===0?(v.flags=y&-65537|128,v):null;case 5:return _f(v),null;case 13:if(ti(xi),y=v.memoizedState,y!==null&&y.dehydrated!==null){if(v.alternate===null)throw Error(d(340));_o()}return y=v.flags,y&65536?(v.flags=y&-65537|128,v):null;case 19:return ti(xi),null;case 4:return Uc(),null;case 10:return bd(v.type._context),null;case 22:case 23:return Ie(),null;case 24:return null;default:return null}}var Mf=!1,Ar=!1,dm=typeof WeakSet=="function"?WeakSet:Set,qa=null;function Fd(y,v){var z=y.ref;if(z!==null)if(typeof z=="function")try{z(null)}catch(k){Oa(y,v,k)}else z.current=null}function Lp(y,v,z){try{z()}catch(k){Oa(y,v,k)}}var Od=!1;function Dh(y,v){if(uf=td,y=rm(),zl(y)){if("selectionStart"in y)var z={start:y.selectionStart,end:y.selectionEnd};else e:{z=(z=y.ownerDocument)&&z.defaultView||window;var k=z.getSelection&&z.getSelection();if(k&&k.rangeCount!==0){z=k.anchorNode;var W=k.anchorOffset,ee=k.focusNode;k=k.focusOffset;try{z.nodeType,ee.nodeType}catch{z=null;break e}var be=0,He=-1,lt=-1,Ut=0,ga=0,wa=y,_a=null;t:for(;;){for(var Ha;wa!==z||W!==0&&wa.nodeType!==3||(He=be+W),wa!==ee||k!==0&&wa.nodeType!==3||(lt=be+k),wa.nodeType===3&&(be+=wa.nodeValue.length),(Ha=wa.firstChild)!==null;)_a=wa,wa=Ha;for(;;){if(wa===y)break t;if(_a===z&&++Ut===W&&(He=be),_a===ee&&++ga===k&&(lt=be),(Ha=wa.nextSibling)!==null)break;wa=_a,_a=wa.parentNode}wa=Ha}z=He===-1||lt===-1?null:{start:He,end:lt}}else z=null}z=z||{start:0,end:0}}else z=null;for(mh={focusedElem:y,selectionRange:z},td=!1,qa=v;qa!==null;)if(v=qa,y=v.child,(v.subtreeFlags&1028)!==0&&y!==null)y.return=v,qa=y;else for(;qa!==null;){v=qa;try{var er=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(er!==null){var Wa=er.memoizedProps,ai=er.memoizedState,Rt=v.stateNode,gt=Rt.getSnapshotBeforeUpdate(v.elementType===v.type?Wa:Es(v.type,Wa),ai);Rt.__reactInternalSnapshotBeforeUpdate=gt}break;case 3:var kt=v.stateNode.containerInfo;kt.nodeType===1?kt.textContent="":kt.nodeType===9&&kt.documentElement&&kt.removeChild(kt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(d(163))}}catch(Na){Oa(v,v.return,Na)}if(y=v.sibling,y!==null){y.return=v.return,qa=y;break}qa=v.return}return er=Od,Od=!1,er}function Ju(y,v,z){var k=v.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var W=k=k.next;do{if((W.tag&y)===y){var ee=W.destroy;W.destroy=void 0,ee!==void 0&&Lp(v,z,ee)}W=W.next}while(W!==k)}}function Fu(y,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var z=v=v.next;do{if((z.tag&y)===y){var k=z.create;z.destroy=k()}z=z.next}while(z!==v)}}function no(y){var v=y.ref;if(v!==null){var z=y.stateNode;switch(y.tag){case 5:y=z;break;default:y=z}typeof v=="function"?v(y):v.current=y}}function Ch(y){var v=y.alternate;v!==null&&(y.alternate=null,Ch(v)),y.child=null,y.deletions=null,y.sibling=null,y.tag===5&&(v=y.stateNode,v!==null&&(delete v[po],delete v[Fc],delete v[fd],delete v[_h],delete v[om])),y.stateNode=null,y.return=null,y.dependencies=null,y.memoizedProps=null,y.memoizedState=null,y.pendingProps=null,y.stateNode=null,y.updateQueue=null}function qn(y){return y.tag===5||y.tag===3||y.tag===4}function ml(y){e:for(;;){for(;y.sibling===null;){if(y.return===null||qn(y.return))return null;y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&y.tag!==18;){if(y.flags&2||y.child===null||y.tag===4)continue e;y.child.return=y,y=y.child}if(!(y.flags&2))return y.stateNode}}function Hc(y,v,z){var k=y.tag;if(k===5||k===6)y=y.stateNode,v?z.nodeType===8?z.parentNode.insertBefore(y,v):z.insertBefore(y,v):(z.nodeType===8?(v=z.parentNode,v.insertBefore(y,z)):(v=z,v.appendChild(y)),z=z._reactRootContainer,z!=null||v.onclick!==null||(v.onclick=cf));else if(k!==4&&(y=y.child,y!==null))for(Hc(y,v,z),y=y.sibling;y!==null;)Hc(y,v,z),y=y.sibling}function Ou(y,v,z){var k=y.tag;if(k===5||k===6)y=y.stateNode,v?z.insertBefore(y,v):z.appendChild(y);else if(k!==4&&(y=y.child,y!==null))for(Ou(y,v,z),y=y.sibling;y!==null;)Ou(y,v,z),y=y.sibling}var $i=null,Co=!1;function Po(y,v,z){for(z=z.child;z!==null;)hm(y,v,z),z=z.sibling}function hm(y,v,z){if(cn&&typeof cn.onCommitFiberUnmount=="function")try{cn.onCommitFiberUnmount(Fn,z)}catch{}switch(z.tag){case 5:Ar||Fd(z,v);case 6:var k=$i,W=Co;$i=null,Po(y,v,z),$i=k,Co=W,$i!==null&&(Co?(y=$i,z=z.stateNode,y.nodeType===8?y.parentNode.removeChild(z):y.removeChild(z)):$i.removeChild(z.stateNode));break;case 18:$i!==null&&(Co?(y=$i,z=z.stateNode,y.nodeType===8?df(y.parentNode,z):y.nodeType===1&&df(y,z),Yl(y)):df($i,z.stateNode));break;case 4:k=$i,W=Co,$i=z.stateNode.containerInfo,Co=!0,Po(y,v,z),$i=k,Co=W;break;case 0:case 11:case 14:case 15:if(!Ar&&(k=z.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){W=k=k.next;do{var ee=W,be=ee.destroy;ee=ee.tag,be!==void 0&&((ee&2)!==0||(ee&4)!==0)&&Lp(z,v,be),W=W.next}while(W!==k)}Po(y,v,z);break;case 1:if(!Ar&&(Fd(z,v),k=z.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=z.memoizedProps,k.state=z.memoizedState,k.componentWillUnmount()}catch(He){Oa(z,v,He)}Po(y,v,z);break;case 21:Po(y,v,z);break;case 22:z.mode&1?(Ar=(k=Ar)||z.memoizedState!==null,Po(y,v,z),Ar=k):Po(y,v,z);break;default:Po(y,v,z)}}function jp(y){var v=y.updateQueue;if(v!==null){y.updateQueue=null;var z=y.stateNode;z===null&&(z=y.stateNode=new dm),v.forEach(function(k){var W=Ua.bind(null,y,k);z.has(k)||(z.add(k),k.then(W,W))})}}function Lo(y,v){var z=v.deletions;if(z!==null)for(var k=0;k<z.length;k++){var W=z[k];try{var ee=y,be=v,He=be;e:for(;He!==null;){switch(He.tag){case 5:$i=He.stateNode,Co=!1;break e;case 3:$i=He.stateNode.containerInfo,Co=!0;break e;case 4:$i=He.stateNode.containerInfo,Co=!0;break e}He=He.return}if($i===null)throw Error(d(160));hm(ee,be,W),$i=null,Co=!1;var lt=W.alternate;lt!==null&&(lt.return=null),W.return=null}catch(Ut){Oa(W,v,Ut)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)Bf(v,y),v=v.sibling}function Bf(y,v){var z=y.alternate,k=y.flags;switch(y.tag){case 0:case 11:case 14:case 15:if(Lo(v,y),jo(y),k&4){try{Ju(3,y,y.return),Fu(3,y)}catch(Wa){Oa(y,y.return,Wa)}try{Ju(5,y,y.return)}catch(Wa){Oa(y,y.return,Wa)}}break;case 1:Lo(v,y),jo(y),k&512&&z!==null&&Fd(z,z.return);break;case 5:if(Lo(v,y),jo(y),k&512&&z!==null&&Fd(z,z.return),y.flags&32){var W=y.stateNode;try{nn(W,"")}catch(Wa){Oa(y,y.return,Wa)}}if(k&4&&(W=y.stateNode,W!=null)){var ee=y.memoizedProps,be=z!==null?z.memoizedProps:ee,He=y.type,lt=y.updateQueue;if(y.updateQueue=null,lt!==null)try{He==="input"&&ee.type==="radio"&&ee.name!=null&&Gn(W,ee),ts(He,be);var Ut=ts(He,ee);for(be=0;be<lt.length;be+=2){var ga=lt[be],wa=lt[be+1];ga==="style"?kn(W,wa):ga==="dangerouslySetInnerHTML"?wr(W,wa):ga==="children"?nn(W,wa):ye(W,ga,wa,Ut)}switch(He){case"input":rn(W,ee);break;case"textarea":Xi(W,ee);break;case"select":var _a=W._wrapperState.wasMultiple;W._wrapperState.wasMultiple=!!ee.multiple;var Ha=ee.value;Ha!=null?Tn(W,!!ee.multiple,Ha,!1):_a!==!!ee.multiple&&(ee.defaultValue!=null?Tn(W,!!ee.multiple,ee.defaultValue,!0):Tn(W,!!ee.multiple,ee.multiple?[]:"",!1))}W[Fc]=ee}catch(Wa){Oa(y,y.return,Wa)}}break;case 6:if(Lo(v,y),jo(y),k&4){if(y.stateNode===null)throw Error(d(162));W=y.stateNode,ee=y.memoizedProps;try{W.nodeValue=ee}catch(Wa){Oa(y,y.return,Wa)}}break;case 3:if(Lo(v,y),jo(y),k&4&&z!==null&&z.memoizedState.isDehydrated)try{Yl(v.containerInfo)}catch(Wa){Oa(y,y.return,Wa)}break;case 4:Lo(v,y),jo(y);break;case 13:Lo(v,y),jo(y),W=y.child,W.flags&8192&&(ee=W.memoizedState!==null,W.stateNode.isHidden=ee,!ee||W.alternate!==null&&W.alternate.memoizedState!==null||(M=ma())),k&4&&jp(y);break;case 22:if(ga=z!==null&&z.memoizedState!==null,y.mode&1?(Ar=(Ut=Ar)||ga,Lo(v,y),Ar=Ut):Lo(v,y),jo(y),k&8192){if(Ut=y.memoizedState!==null,(y.stateNode.isHidden=Ut)&&!ga&&(y.mode&1)!==0)for(qa=y,ga=y.child;ga!==null;){for(wa=qa=ga;qa!==null;){switch(_a=qa,Ha=_a.child,_a.tag){case 0:case 11:case 14:case 15:Ju(4,_a,_a.return);break;case 1:Fd(_a,_a.return);var er=_a.stateNode;if(typeof er.componentWillUnmount=="function"){k=_a,z=_a.return;try{v=k,er.props=v.memoizedProps,er.state=v.memoizedState,er.componentWillUnmount()}catch(Wa){Oa(k,z,Wa)}}break;case 5:Fd(_a,_a.return);break;case 22:if(_a.memoizedState!==null){Go(wa);continue}}Ha!==null?(Ha.return=_a,qa=Ha):Go(wa)}ga=ga.sibling}e:for(ga=null,wa=y;;){if(wa.tag===5){if(ga===null){ga=wa;try{W=wa.stateNode,Ut?(ee=W.style,typeof ee.setProperty=="function"?ee.setProperty("display","none","important"):ee.display="none"):(He=wa.stateNode,lt=wa.memoizedProps.style,be=lt!=null&&lt.hasOwnProperty("display")?lt.display:null,He.style.display=us("display",be))}catch(Wa){Oa(y,y.return,Wa)}}}else if(wa.tag===6){if(ga===null)try{wa.stateNode.nodeValue=Ut?"":wa.memoizedProps}catch(Wa){Oa(y,y.return,Wa)}}else if((wa.tag!==22&&wa.tag!==23||wa.memoizedState===null||wa===y)&&wa.child!==null){wa.child.return=wa,wa=wa.child;continue}if(wa===y)break e;for(;wa.sibling===null;){if(wa.return===null||wa.return===y)break e;ga===wa&&(ga=null),wa=wa.return}ga===wa&&(ga=null),wa.sibling.return=wa.return,wa=wa.sibling}}break;case 19:Lo(v,y),jo(y),k&4&&jp(y);break;case 21:break;default:Lo(v,y),jo(y)}}function jo(y){var v=y.flags;if(v&2){try{e:{for(var z=y.return;z!==null;){if(qn(z)){var k=z;break e}z=z.return}throw Error(d(160))}switch(k.tag){case 5:var W=k.stateNode;k.flags&32&&(nn(W,""),k.flags&=-33);var ee=ml(y);Ou(y,ee,W);break;case 3:case 4:var be=k.stateNode.containerInfo,He=ml(y);Hc(y,He,be);break;default:throw Error(d(161))}}catch(lt){Oa(y,y.return,lt)}y.flags&=-3}v&4096&&(y.flags&=-4097)}function If(y,v,z){qa=y,Dd(y)}function Dd(y,v,z){for(var k=(y.mode&1)!==0;qa!==null;){var W=qa,ee=W.child;if(W.tag===22&&k){var be=W.memoizedState!==null||Mf;if(!be){var He=W.alternate,lt=He!==null&&He.memoizedState!==null||Ar;He=Mf;var Ut=Ar;if(Mf=be,(Ar=lt)&&!Ut)for(qa=W;qa!==null;)be=qa,lt=be.child,be.tag===22&&be.memoizedState!==null?qi(W):lt!==null?(lt.return=be,qa=lt):qi(W);for(;ee!==null;)qa=ee,Dd(ee),ee=ee.sibling;qa=W,Mf=He,Ar=Ut}Jl(y)}else(W.subtreeFlags&8772)!==0&&ee!==null?(ee.return=W,qa=ee):Jl(y)}}function Jl(y){for(;qa!==null;){var v=qa;if((v.flags&8772)!==0){var z=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:Ar||Fu(5,v);break;case 1:var k=v.stateNode;if(v.flags&4&&!Ar)if(z===null)k.componentDidMount();else{var W=v.elementType===v.type?z.memoizedProps:Es(v.type,z.memoizedProps);k.componentDidUpdate(W,z.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var ee=v.updateQueue;ee!==null&&lc(v,ee,k);break;case 3:var be=v.updateQueue;if(be!==null){if(z=null,v.child!==null)switch(v.child.tag){case 5:z=v.child.stateNode;break;case 1:z=v.child.stateNode}lc(v,be,z)}break;case 5:var He=v.stateNode;if(z===null&&v.flags&4){z=He;var lt=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":lt.autoFocus&&z.focus();break;case"img":lt.src&&(z.src=lt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var Ut=v.alternate;if(Ut!==null){var ga=Ut.memoizedState;if(ga!==null){var wa=ga.dehydrated;wa!==null&&Yl(wa)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(d(163))}Ar||v.flags&512&&no(v)}catch(_a){Oa(v,v.return,_a)}}if(v===y){qa=null;break}if(z=v.sibling,z!==null){z.return=v.return,qa=z;break}qa=v.return}}function Go(y){for(;qa!==null;){var v=qa;if(v===y){qa=null;break}var z=v.sibling;if(z!==null){z.return=v.return,qa=z;break}qa=v.return}}function qi(y){for(;qa!==null;){var v=qa;try{switch(v.tag){case 0:case 11:case 15:var z=v.return;try{Fu(4,v)}catch(lt){Oa(v,z,lt)}break;case 1:var k=v.stateNode;if(typeof k.componentDidMount=="function"){var W=v.return;try{k.componentDidMount()}catch(lt){Oa(v,W,lt)}}var ee=v.return;try{no(v)}catch(lt){Oa(v,ee,lt)}break;case 5:var be=v.return;try{no(v)}catch(lt){Oa(v,be,lt)}}}catch(lt){Oa(v,v.return,lt)}if(v===y){qa=null;break}var He=v.sibling;if(He!==null){He.return=v.return,qa=He;break}qa=v.return}}var hc=Math.ceil,io=$e.ReactCurrentDispatcher,Zp=$e.ReactCurrentOwner,Uo=$e.ReactCurrentBatchConfig,An=0,is=null,Ei=null,On=0,h=0,t=Dc(0),i=0,f=null,_=0,w=0,b=0,E=null,A=null,M=0,I=1/0,C=null,J=!1,U=null,H=null,q=!1,ne=null,ae=0,se=0,he=null,ce=-1,Ze=0;function me(){return(An&6)!==0?ma():ce!==-1?ce:ce=ma()}function Ne(y){return(y.mode&1)===0?1:(An&2)!==0&&On!==0?On&-On:ff.transition!==null?(Ze===0&&(Ze=ds()),Ze):(y=zn,y!==0||(y=window.event,y=y===void 0?16:eh(y.type)),y)}function we(y,v,z,k){if(50<se)throw se=0,he=null,Error(d(185));as(y,z,k),((An&2)===0||y!==is)&&(y===is&&((An&2)===0&&(w|=z),i===4&&qe(y,On)),ge(y,k),z===1&&An===0&&(v.mode&1)===0&&(I=ma()+500,gd&&cl()))}function ge(y,v){var z=y.callbackNode;Ni(y,v);var k=Bs(y,y===is?On:0);if(k===0)z!==null&&Nt(z),y.callbackNode=null,y.callbackPriority=0;else if(v=k&-k,y.callbackPriority!==v){if(z!=null&&Nt(z),v===1)y.tag===0?vh(dt.bind(null,y)):hf(dt.bind(null,y)),gh(function(){(An&6)===0&&cl()}),z=null;else{switch(Ku(k)){case 1:z=$a;break;case 4:z=ar;break;case 16:z=Fr;break;case 536870912:z=ii;break;default:z=Fr}z=mr(z,Se.bind(null,y))}y.callbackPriority=v,y.callbackNode=z}}function Se(y,v){if(ce=-1,Ze=0,(An&6)!==0)throw Error(d(327));var z=y.callbackNode;if(va()&&y.callbackNode!==z)return null;var k=Bs(y,y===is?On:0);if(k===0)return null;if((k&30)!==0||(k&y.expiredLanes)!==0||v)v=oa(y,k);else{v=k;var W=An;An|=2;var ee=jt();(is!==y||On!==v)&&(C=null,I=ma()+500,ct(y,v));do try{Ot();break}catch(He){et(y,He)}while(!0);cp(),io.current=ee,An=W,Ei!==null?v=0:(is=null,On=0,v=i)}if(v!==0){if(v===2&&(W=Xs(y),W!==0&&(k=W,v=Pe(y,W))),v===1)throw z=f,ct(y,0),qe(y,k),ge(y,ma()),z;if(v===6)qe(y,k);else{if(W=y.current.alternate,(k&30)===0&&!it(W)&&(v=oa(y,k),v===2&&(ee=Xs(y),ee!==0&&(k=ee,v=Pe(y,ee))),v===1))throw z=f,ct(y,0),qe(y,k),ge(y,ma()),z;switch(y.finishedWork=W,y.finishedLanes=k,v){case 0:case 1:throw Error(d(345));case 2:Ht(y,A,C);break;case 3:if(qe(y,k),(k&130023424)===k&&(v=M+500-ma(),10<v)){if(Bs(y,0)!==0)break;if(W=y.suspendedLanes,(W&k)!==k){me(),y.pingedLanes|=y.suspendedLanes&W;break}y.timeoutHandle=yh(Ht.bind(null,y,A,C),v);break}Ht(y,A,C);break;case 4:if(qe(y,k),(k&4194240)===k)break;for(v=y.eventTimes,W=-1;0<k;){var be=31-Ka(k);ee=1<<be,be=v[be],be>W&&(W=be),k&=~ee}if(k=W,k=ma()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*hc(k/1960))-k,10<k){y.timeoutHandle=yh(Ht.bind(null,y,A,C),k);break}Ht(y,A,C);break;case 5:Ht(y,A,C);break;default:throw Error(d(329))}}}return ge(y,ma()),y.callbackNode===z?Se.bind(null,y):null}function Pe(y,v){var z=E;return y.current.memoizedState.isDehydrated&&(ct(y,v).flags|=256),y=oa(y,v),y!==2&&(v=A,A=z,v!==null&&Fe(v)),y}function Fe(y){A===null?A=y:A.push.apply(A,y)}function it(y){for(var v=y;;){if(v.flags&16384){var z=v.updateQueue;if(z!==null&&(z=z.stores,z!==null))for(var k=0;k<z.length;k++){var W=z[k],ee=W.getSnapshot;W=W.value;try{if(!qs(ee(),W))return!1}catch{return!1}}}if(z=v.child,v.subtreeFlags&16384&&z!==null)z.return=v,v=z;else{if(v===y)break;for(;v.sibling===null;){if(v.return===null||v.return===y)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function qe(y,v){for(v&=~b,v&=~w,y.suspendedLanes|=v,y.pingedLanes&=~v,y=y.expirationTimes;0<v;){var z=31-Ka(v),k=1<<z;y[z]=-1,v&=~k}}function dt(y){if((An&6)!==0)throw Error(d(327));va();var v=Bs(y,0);if((v&1)===0)return ge(y,ma()),null;var z=oa(y,v);if(y.tag!==0&&z===2){var k=Xs(y);k!==0&&(v=k,z=Pe(y,k))}if(z===1)throw z=f,ct(y,0),qe(y,v),ge(y,ma()),z;if(z===6)throw Error(d(345));return y.finishedWork=y.current.alternate,y.finishedLanes=v,Ht(y,A,C),ge(y,ma()),null}function Mt(y,v){var z=An;An|=1;try{return y(v)}finally{An=z,An===0&&(I=ma()+500,gd&&cl())}}function Xe(y){ne!==null&&ne.tag===0&&(An&6)===0&&va();var v=An;An|=1;var z=Uo.transition,k=zn;try{if(Uo.transition=null,zn=1,y)return y()}finally{zn=k,Uo.transition=z,An=v,(An&6)===0&&cl()}}function Ie(){h=t.current,ti(t)}function ct(y,v){y.finishedWork=null,y.finishedLanes=0;var z=y.timeoutHandle;if(z!==-1&&(y.timeoutHandle=-1,_u(z)),Ei!==null)for(z=Ei.return;z!==null;){var k=z;switch(Lh(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&Tl();break;case 3:Uc(),ti(Gi),ti(Qi),Ah();break;case 5:_f(k);break;case 4:Uc();break;case 13:ti(xi);break;case 19:ti(xi);break;case 10:bd(k.type._context);break;case 22:case 23:Ie()}z=z.return}if(is=y,Ei=y=Ca(y.current,null),On=h=v,i=0,f=null,b=w=_=0,A=E=null,ro!==null){for(v=0;v<ro.length;v++)if(z=ro[v],k=z.interleaved,k!==null){z.interleaved=null;var W=k.next,ee=z.pending;if(ee!==null){var be=ee.next;ee.next=W,k.next=be}z.pending=k}ro=null}return y}function et(y,v){do{var z=Ei;try{if(cp(),Hi.current=tr,Ed){for(var k=fi.memoizedState;k!==null;){var W=k.queue;W!==null&&(W.pending=null),k=k.next}Ed=!1}if(Wc=0,Ui=ki=fi=null,ns=!1,$r=0,Zp.current=null,z===null||z.return===null){i=1,f=v,Ei=null;break}e:{var ee=y,be=z.return,He=z,lt=v;if(v=On,He.flags|=32768,lt!==null&&typeof lt=="object"&&typeof lt.then=="function"){var Ut=lt,ga=He,wa=ga.tag;if((ga.mode&1)===0&&(wa===0||wa===11||wa===15)){var _a=ga.alternate;_a?(ga.updateQueue=_a.updateQueue,ga.memoizedState=_a.memoizedState,ga.lanes=_a.lanes):(ga.updateQueue=null,ga.memoizedState=null)}var Ha=bo(be);if(Ha!==null){Ha.flags&=-257,zf(Ha,be,He,ee,v),Ha.mode&1&&Sf(ee,Ut,v),v=Ha,lt=Ut;var er=v.updateQueue;if(er===null){var Wa=new Set;Wa.add(lt),v.updateQueue=Wa}else er.add(lt);break e}else{if((v&1)===0){Sf(ee,Ut,v),Ct();break e}lt=Error(d(426))}}else if(Qn&&He.mode&1){var ai=bo(be);if(ai!==null){(ai.flags&65536)===0&&(ai.flags|=256),zf(ai,be,He,ee,v),jh(vo(lt,He));break e}}ee=lt=vo(lt,He),i!==4&&(i=2),E===null?E=[ee]:E.push(ee),ee=be;do{switch(ee.tag){case 3:ee.flags|=65536,v&=-v,ee.lanes|=v;var Rt=Mu(ee,lt,v);yf(ee,Rt);break e;case 1:He=lt;var gt=ee.type,kt=ee.stateNode;if((ee.flags&128)===0&&(typeof gt.getDerivedStateFromError=="function"||kt!==null&&typeof kt.componentDidCatch=="function"&&(H===null||!H.has(kt)))){ee.flags|=65536,v&=-v,ee.lanes|=v;var Na=uc(ee,He,v);yf(ee,Na);break e}}ee=ee.return}while(ee!==null)}ra(z)}catch(rr){v=rr,Ei===z&&z!==null&&(Ei=z=z.return);continue}break}while(!0)}function jt(){var y=io.current;return io.current=tr,y===null?tr:y}function Ct(){(i===0||i===3||i===2)&&(i=4),is===null||(_&268435455)===0&&(w&268435455)===0||qe(is,On)}function oa(y,v){var z=An;An|=2;var k=jt();(is!==y||On!==v)&&(C=null,ct(y,v));do try{Bt();break}catch(W){et(y,W)}while(!0);if(cp(),An=z,io.current=k,Ei!==null)throw Error(d(261));return is=null,On=0,i}function Bt(){for(;Ei!==null;)la(Ei)}function Ot(){for(;Ei!==null&&!ha();)la(Ei)}function la(y){var v=Cr(y.alternate,y,h);y.memoizedProps=y.pendingProps,v===null?ra(y):Ei=v,Zp.current=null}function ra(y){var v=y;do{var z=v.alternate;if(y=v.return,(v.flags&32768)===0){if(z=um(z,v,h),z!==null){Ei=z;return}}else{if(z=my(z,v),z!==null){z.flags&=32767,Ei=z;return}if(y!==null)y.flags|=32768,y.subtreeFlags=0,y.deletions=null;else{i=6,Ei=null;return}}if(v=v.sibling,v!==null){Ei=v;return}Ei=v=y}while(v!==null);i===0&&(i=5)}function Ht(y,v,z){var k=zn,W=Uo.transition;try{Uo.transition=null,zn=1,ia(y,v,z,k)}finally{Uo.transition=W,zn=k}return null}function ia(y,v,z,k){do va();while(ne!==null);if((An&6)!==0)throw Error(d(327));z=y.finishedWork;var W=y.finishedLanes;if(z===null)return null;if(y.finishedWork=null,y.finishedLanes=0,z===y.current)throw Error(d(177));y.callbackNode=null,y.callbackPriority=0;var ee=z.lanes|z.childLanes;if(Qs(y,ee),y===is&&(Ei=is=null,On=0),(z.subtreeFlags&2064)===0&&(z.flags&2064)===0||q||(q=!0,mr(Fr,function(){return va(),null})),ee=(z.flags&15990)!==0,(z.subtreeFlags&15990)!==0||ee){ee=Uo.transition,Uo.transition=null;var be=zn;zn=1;var He=An;An|=4,Zp.current=null,Dh(y,z),Bf(z,y),dy(mh),td=!!uf,mh=uf=null,y.current=z,If(z),Ia(),An=He,zn=be,Uo.transition=ee}else y.current=z;if(q&&(q=!1,ne=y,ae=W),ee=y.pendingLanes,ee===0&&(H=null),Pr(z.stateNode),ge(y,ma()),v!==null)for(k=y.onRecoverableError,z=0;z<v.length;z++)W=v[z],k(W.value,{componentStack:W.stack,digest:W.digest});if(J)throw J=!1,y=U,U=null,y;return(ae&1)!==0&&y.tag!==0&&va(),ee=y.pendingLanes,(ee&1)!==0?y===he?se++:(se=0,he=y):se=0,cl(),null}function va(){if(ne!==null){var y=Ku(ae),v=Uo.transition,z=zn;try{if(Uo.transition=null,zn=16>y?16:y,ne===null)var k=!1;else{if(y=ne,ne=null,ae=0,(An&6)!==0)throw Error(d(331));var W=An;for(An|=4,qa=y.current;qa!==null;){var ee=qa,be=ee.child;if((qa.flags&16)!==0){var He=ee.deletions;if(He!==null){for(var lt=0;lt<He.length;lt++){var Ut=He[lt];for(qa=Ut;qa!==null;){var ga=qa;switch(ga.tag){case 0:case 11:case 15:Ju(8,ga,ee)}var wa=ga.child;if(wa!==null)wa.return=ga,qa=wa;else for(;qa!==null;){ga=qa;var _a=ga.sibling,Ha=ga.return;if(Ch(ga),ga===Ut){qa=null;break}if(_a!==null){_a.return=Ha,qa=_a;break}qa=Ha}}}var er=ee.alternate;if(er!==null){var Wa=er.child;if(Wa!==null){er.child=null;do{var ai=Wa.sibling;Wa.sibling=null,Wa=ai}while(Wa!==null)}}qa=ee}}if((ee.subtreeFlags&2064)!==0&&be!==null)be.return=ee,qa=be;else e:for(;qa!==null;){if(ee=qa,(ee.flags&2048)!==0)switch(ee.tag){case 0:case 11:case 15:Ju(9,ee,ee.return)}var Rt=ee.sibling;if(Rt!==null){Rt.return=ee.return,qa=Rt;break e}qa=ee.return}}var gt=y.current;for(qa=gt;qa!==null;){be=qa;var kt=be.child;if((be.subtreeFlags&2064)!==0&&kt!==null)kt.return=be,qa=kt;else e:for(be=gt;qa!==null;){if(He=qa,(He.flags&2048)!==0)try{switch(He.tag){case 0:case 11:case 15:Fu(9,He)}}catch(rr){Oa(He,He.return,rr)}if(He===be){qa=null;break e}var Na=He.sibling;if(Na!==null){Na.return=He.return,qa=Na;break e}qa=He.return}}if(An=W,cl(),cn&&typeof cn.onPostCommitFiberRoot=="function")try{cn.onPostCommitFiberRoot(Fn,y)}catch{}k=!0}return k}finally{zn=z,Uo.transition=v}}return!1}function ir(y,v,z){v=vo(z,v),v=Mu(y,v,1),y=wo(y,v,1),v=me(),y!==null&&(as(y,1,v),ge(y,v))}function Oa(y,v,z){if(y.tag===3)ir(y,y,z);else for(;v!==null;){if(v.tag===3){ir(v,y,z);break}else if(v.tag===1){var k=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(H===null||!H.has(k))){y=vo(z,y),y=uc(v,y,1),v=wo(v,y,1),y=me(),v!==null&&(as(v,1,y),ge(v,y));break}}v=v.return}}function Qr(y,v,z){var k=y.pingCache;k!==null&&k.delete(v),v=me(),y.pingedLanes|=y.suspendedLanes&z,is===y&&(On&z)===z&&(i===4||i===3&&(On&130023424)===On&&500>ma()-M?ct(y,0):b|=z),ge(y,v)}function Ta(y,v){v===0&&((y.mode&1)===0?v=1:(v=si,si<<=1,(si&130023424)===0&&(si=4194304)));var z=me();y=ko(y,v),y!==null&&(as(y,v,z),ge(y,z))}function pr(y){var v=y.memoizedState,z=0;v!==null&&(z=v.retryLane),Ta(y,z)}function Ua(y,v){var z=0;switch(y.tag){case 13:var k=y.stateNode,W=y.memoizedState;W!==null&&(z=W.retryLane);break;case 19:k=y.stateNode;break;default:throw Error(d(314))}k!==null&&k.delete(v),Ta(y,z)}var Cr;Cr=function(y,v,z){if(y!==null)if(y.memoizedProps!==v.pendingProps||Gi.current)Yi=!0;else{if((y.lanes&z)===0&&(v.flags&128)===0)return Yi=!1,xp(y,v,z);Yi=(y.flags&131072)!==0}else Yi=!1,Qn&&(v.flags&1048576)!==0&&lm(v,bh,v.index);switch(v.lanes=0,v.tag){case 2:var k=v.type;Id(y,v),y=v.pendingProps;var W=bu(v,Qi.current);Js(v,z),W=vf(null,v,k,y,W,z);var ee=hl();return v.flags|=1,typeof W=="object"&&W!==null&&typeof W.render=="function"&&W.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,rs(k)?(ee=!0,md(v)):ee=!1,v.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,jd(v),W.updater=zd,v.stateNode=W,W._reactInternals=v,Cs(v,k,y,z),v=Fh(null,v,k,!0,ee,z)):(v.tag=0,Qn&&ee&&_d(v),Wi(null,v,W,z),v=v.child),v;case 16:k=v.elementType;e:{switch(Id(y,v),y=v.pendingProps,W=k._init,k=W(k._payload),v.type=k,W=v.tag=Rr(k),y=Es(k,y),W){case 0:v=Jh(null,v,k,y,z);break e;case 1:v=Rd(null,v,k,y,z);break e;case 11:v=gn(null,v,k,y,z);break e;case 14:v=Bu(null,v,k,Es(k.type,y),z);break e}throw Error(d(306,k,""))}return v;case 0:return k=v.type,W=v.pendingProps,W=v.elementType===k?W:Es(k,W),Jh(y,v,k,W,z);case 1:return k=v.type,W=v.pendingProps,W=v.elementType===k?W:Es(k,W),Rd(y,v,k,W,z);case 3:e:{if(dc(v),y===null)throw Error(d(387));k=v.pendingProps,ee=v.memoizedState,W=ee.element,up(y,v),Fo(v,k,null,z);var be=v.memoizedState;if(k=be.element,ee.isDehydrated)if(ee={element:k,isDehydrated:!1,cache:be.cache,pendingSuspenseBoundaries:be.pendingSuspenseBoundaries,transitions:be.transitions},v.updateQueue.baseState=ee,v.memoizedState=ee,v.flags&256){W=vo(Error(d(423)),v),v=Vf(y,v,k,z,W);break e}else if(k!==W){W=vo(Error(d(424)),v),v=Vf(y,v,k,z,W);break e}else for(ao=Rl(v.stateNode.containerInfo.firstChild),ks=v,Qn=!0,go=null,z=Eh(v,null,k,z),v.child=z;z;)z.flags=z.flags&-3|4096,z=z.sibling;else{if(_o(),k===W){v=kl(y,v,z);break e}Wi(y,v,k,z)}v=v.child}return v;case 5:return gf(v),y===null&&dl(v),k=v.type,W=v.pendingProps,ee=y!==null?y.memoizedProps:null,be=W.children,dd(k,W)?be=null:ee!==null&&dd(k,ee)&&(v.flags|=32),Qc(y,v),Wi(y,v,be,z),v.child;case 6:return y===null&&dl(v),null;case 13:return Iu(y,v,z);case 4:return Nd(v,v.stateNode.containerInfo),k=v.pendingProps,y===null?v.child=Gc(v,null,k,z):Wi(y,v,k,z),v.child;case 11:return k=v.type,W=v.pendingProps,W=v.elementType===k?W:Es(k,W),gn(y,v,k,W,z);case 7:return Wi(y,v,v.pendingProps,z),v.child;case 8:return Wi(y,v,v.pendingProps.children,z),v.child;case 12:return Wi(y,v,v.pendingProps.children,z),v.child;case 10:e:{if(k=v.type._context,W=v.pendingProps,ee=v.memoizedProps,be=W.value,$n(oc,k._currentValue),k._currentValue=be,ee!==null)if(qs(ee.value,be)){if(ee.children===W.children&&!Gi.current){v=kl(y,v,z);break e}}else for(ee=v.child,ee!==null&&(ee.return=v);ee!==null;){var He=ee.dependencies;if(He!==null){be=ee.child;for(var lt=He.firstContext;lt!==null;){if(lt.context===k){if(ee.tag===1){lt=Fs(-1,z&-z),lt.tag=2;var Ut=ee.updateQueue;if(Ut!==null){Ut=Ut.shared;var ga=Ut.pending;ga===null?lt.next=lt:(lt.next=ga.next,ga.next=lt),Ut.pending=lt}}ee.lanes|=z,lt=ee.alternate,lt!==null&&(lt.lanes|=z),Ld(ee.return,z,v),He.lanes|=z;break}lt=lt.next}}else if(ee.tag===10)be=ee.type===v.type?null:ee.child;else if(ee.tag===18){if(be=ee.return,be===null)throw Error(d(341));be.lanes|=z,He=be.alternate,He!==null&&(He.lanes|=z),Ld(be,z,v),be=ee.sibling}else be=ee.child;if(be!==null)be.return=ee;else for(be=ee;be!==null;){if(be===v){be=null;break}if(ee=be.sibling,ee!==null){ee.return=be.return,be=ee;break}be=be.return}ee=be}Wi(y,v,W.children,z),v=v.child}return v;case 9:return W=v.type,k=v.pendingProps.children,Js(v,z),W=Zs(W),k=k(W),v.flags|=1,Wi(y,v,k,z),v.child;case 14:return k=v.type,W=Es(k,v.pendingProps),W=Es(k.type,W),Bu(y,v,k,W,z);case 15:return Rf(y,v,v.type,v.pendingProps,z);case 17:return k=v.type,W=v.pendingProps,W=v.elementType===k?W:Es(k,W),Id(y,v),v.tag=1,rs(k)?(y=!0,md(v)):y=!1,Js(v,z),Ih(v,k,W),Cs(v,k,W,z),Fh(null,v,k,!0,y,z);case 19:return Bd(y,v,z);case 22:return Tf(y,v,z)}throw Error(d(156,v.tag))};function mr(y,v){return Vt(y,v)}function Kr(y,v,z,k){this.tag=y,this.key=z,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sr(y,v,z,k){return new Kr(y,v,z,k)}function Ga(y){return y=y.prototype,!(!y||!y.isReactComponent)}function Rr(y){if(typeof y=="function")return Ga(y)?1:0;if(y!=null){if(y=y.$$typeof,y===yt)return 11;if(y===ht)return 14}return 2}function Ca(y,v){var z=y.alternate;return z===null?(z=sr(y.tag,v,y.key,y.mode),z.elementType=y.elementType,z.type=y.type,z.stateNode=y.stateNode,z.alternate=y,y.alternate=z):(z.pendingProps=v,z.type=y.type,z.flags=0,z.subtreeFlags=0,z.deletions=null),z.flags=y.flags&14680064,z.childLanes=y.childLanes,z.lanes=y.lanes,z.child=y.child,z.memoizedProps=y.memoizedProps,z.memoizedState=y.memoizedState,z.updateQueue=y.updateQueue,v=y.dependencies,z.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},z.sibling=y.sibling,z.index=y.index,z.ref=y.ref,z}function en(y,v,z,k,W,ee){var be=2;if(k=y,typeof y=="function")Ga(y)&&(be=1);else if(typeof y=="string")be=5;else e:switch(y){case Qe:return _r(z.children,W,ee,v);case Ft:be=8,W|=8;break;case bt:return y=sr(12,z,v,W|2),y.elementType=bt,y.lanes=ee,y;case Ke:return y=sr(13,z,v,W),y.elementType=Ke,y.lanes=ee,y;case st:return y=sr(19,z,v,W),y.elementType=st,y.lanes=ee,y;case qt:return Va(z,W,ee,v);default:if(typeof y=="object"&&y!==null)switch(y.$$typeof){case Qt:be=10;break e;case Gt:be=9;break e;case yt:be=11;break e;case ht:be=14;break e;case Wt:be=16,k=null;break e}throw Error(d(130,y==null?y:typeof y,""))}return v=sr(be,z,v,W),v.elementType=y,v.type=k,v.lanes=ee,v}function _r(y,v,z,k){return y=sr(7,y,k,v),y.lanes=z,y}function Va(y,v,z,k){return y=sr(22,y,k,v),y.elementType=qt,y.lanes=z,y.stateNode={isHidden:!1},y}function yr(y,v,z){return y=sr(6,y,null,v),y.lanes=z,y}function _n(y,v,z){return v=sr(4,y.children!==null?y.children:[],y.key,v),v.lanes=z,v.stateNode={containerInfo:y.containerInfo,pendingChildren:null,implementation:y.implementation},v}function Hn(y,v,z,k,W){this.tag=v,this.containerInfo=y,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ho(0),this.expirationTimes=ho(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ho(0),this.identifierPrefix=k,this.onRecoverableError=W,this.mutableSourceEagerHydrationData=null}function wn(y,v,z,k,W,ee,be,He,lt){return y=new Hn(y,v,z,He,lt),v===1?(v=1,ee===!0&&(v|=8)):v=0,ee=sr(3,null,null,v),y.current=ee,ee.stateNode=y,ee.memoizedState={element:k,isDehydrated:z,cache:null,transitions:null,pendingSuspenseBoundaries:null},jd(ee),y}function Dn(y,v,z){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Te,key:k==null?null:""+k,children:y,containerInfo:v,implementation:z}}function Ss(y){if(!y)return ll;y=y._reactInternals;e:{if(Ve(y)!==y||y.tag!==1)throw Error(d(170));var v=y;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(rs(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(d(171))}if(y.tag===1){var z=y.type;if(rs(z))return to(y,z,v)}return v}function xs(y,v,z,k,W,ee,be,He,lt){return y=wn(z,k,!0,y,W,ee,be,He,lt),y.context=Ss(null),z=y.current,k=me(),W=Ne(z),ee=Fs(k,W),ee.callback=v??null,wo(z,ee,W),y.current.lanes=W,as(y,W,k),ge(y,k),y}function Si(y,v,z,k){var W=v.current,ee=me(),be=Ne(W);return z=Ss(z),v.context===null?v.context=z:v.pendingContext=z,v=Fs(ee,be),v.payload={element:y},k=k===void 0?null:k,k!==null&&(v.callback=k),y=wo(W,v,be),y!==null&&(we(y,W,be,ee),na(y,W,be)),be}function Fi(y){if(y=y.current,!y.child)return null;switch(y.child.tag){case 5:return y.child.stateNode;default:return y.child.stateNode}}function so(y,v){if(y=y.memoizedState,y!==null&&y.dehydrated!==null){var z=y.retryLane;y.retryLane=z!==0&&z<v?z:v}}function Oi(y,v){so(y,v),(y=y.alternate)&&so(y,v)}function Zo(){return null}var No=typeof reportError=="function"?reportError:function(y){console.error(y)};function vi(y){this._internalRoot=y}vn.prototype.render=vi.prototype.render=function(y){var v=this._internalRoot;if(v===null)throw Error(d(409));Si(y,v,null,null)},vn.prototype.unmount=vi.prototype.unmount=function(){var y=this._internalRoot;if(y!==null){this._internalRoot=null;var v=y.containerInfo;Xe(function(){Si(null,y,null,null)}),v[sl]=null}};function vn(y){this._internalRoot=y}vn.prototype.unstable_scheduleHydration=function(y){if(y){var v=fs();y={blockedOn:null,target:y,priority:v};for(var z=0;z<Hl.length&&v!==0&&v<Hl[z].priority;z++);Hl.splice(z,0,y),z===0&&$h(y)}};function Cn(y){return!(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)}function Gr(y){return!(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11&&(y.nodeType!==8||y.nodeValue!==" react-mount-point-unstable "))}function Yn(){}function Di(y,v,z,k,W){if(W){if(typeof k=="function"){var ee=k;k=function(){var Ut=Fi(be);ee.call(Ut)}}var be=xs(v,k,y,0,null,!1,!1,"",Yn);return y._reactRootContainer=be,y[sl]=be.current,ph(y.nodeType===8?y.parentNode:y),Xe(),be}for(;W=y.lastChild;)y.removeChild(W);if(typeof k=="function"){var He=k;k=function(){var Ut=Fi(lt);He.call(Ut)}}var lt=wn(y,0,!1,null,null,!1,!1,"",Yn);return y._reactRootContainer=lt,y[sl]=lt.current,ph(y.nodeType===8?y.parentNode:y),Xe(function(){Si(v,lt,z,k)}),lt}function bn(y,v,z,k,W){var ee=z._reactRootContainer;if(ee){var be=ee;if(typeof W=="function"){var He=W;W=function(){var lt=Fi(be);He.call(lt)}}Si(v,be,y,W)}else be=Di(z,v,y,W,k);return Fi(be)}ed=function(y){switch(y.tag){case 3:var v=y.stateNode;if(v.current.memoizedState.isDehydrated){var z=Mi(v.pendingLanes);z!==0&&(qu(v,z|1),ge(v,ma()),(An&6)===0&&(I=ma()+500,cl()))}break;case 13:Xe(function(){var k=ko(y,1);if(k!==null){var W=me();we(k,y,1,W)}}),Oi(y,1)}},hs=function(y){if(y.tag===13){var v=ko(y,134217728);if(v!==null){var z=me();we(v,y,134217728,z)}Oi(y,134217728)}},Ao=function(y){if(y.tag===13){var v=Ne(y),z=ko(y,v);if(z!==null){var k=me();we(z,y,v,k)}Oi(y,v)}},fs=function(){return zn},Hs=function(y,v){var z=zn;try{return zn=y,v()}finally{zn=z}},Ln=function(y,v,z){switch(v){case"input":if(rn(y,z),v=z.name,z.type==="radio"&&v!=null){for(z=y;z.parentNode;)z=z.parentNode;for(z=z.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<z.length;v++){var k=z[v];if(k!==y&&k.form===y.form){var W=wu(k);if(!W)throw Error(d(90));qo(k),rn(k,W)}}}break;case"textarea":Xi(y,z);break;case"select":v=z.value,v!=null&&Tn(y,!!z.multiple,v,!1)}},Yu=Mt,Hh=Xe;var Eo={usingClientEntryPoint:!1,Events:[pd,ol,wu,Ws,$d,Mt]},Fl={findFiberByHostInstance:Oc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},fc={bundleType:Fl.bundleType,version:Fl.version,rendererPackageName:Fl.rendererPackageName,rendererConfig:Fl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$e.ReactCurrentDispatcher,findHostInstanceByFiber:function(y){return y=Ce(y),y===null?null:y.stateNode},findFiberByHostInstance:Fl.findFiberByHostInstance||Zo,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pc.isDisabled&&pc.supportsFiber)try{Fn=pc.inject(fc),cn=pc}catch{}}return Ol.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Eo,Ol.createPortal=function(y,v){var z=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Cn(v))throw Error(d(200));return Dn(y,v,null,z)},Ol.createRoot=function(y,v){if(!Cn(y))throw Error(d(299));var z=!1,k="",W=No;return v!=null&&(v.unstable_strictMode===!0&&(z=!0),v.identifierPrefix!==void 0&&(k=v.identifierPrefix),v.onRecoverableError!==void 0&&(W=v.onRecoverableError)),v=wn(y,1,!1,null,null,z,!1,k,W),y[sl]=v.current,ph(y.nodeType===8?y.parentNode:y),new vi(v)},Ol.findDOMNode=function(y){if(y==null)return null;if(y.nodeType===1)return y;var v=y._reactInternals;if(v===void 0)throw typeof y.render=="function"?Error(d(188)):(y=Object.keys(y).join(","),Error(d(268,y)));return y=Ce(v),y=y===null?null:y.stateNode,y},Ol.flushSync=function(y){return Xe(y)},Ol.hydrate=function(y,v,z){if(!Gr(v))throw Error(d(200));return bn(null,y,v,!0,z)},Ol.hydrateRoot=function(y,v,z){if(!Cn(y))throw Error(d(405));var k=z!=null&&z.hydratedSources||null,W=!1,ee="",be=No;if(z!=null&&(z.unstable_strictMode===!0&&(W=!0),z.identifierPrefix!==void 0&&(ee=z.identifierPrefix),z.onRecoverableError!==void 0&&(be=z.onRecoverableError)),v=xs(v,null,y,1,z??null,W,!1,ee,be),y[sl]=v.current,ph(y),k)for(y=0;y<k.length;y++)z=k[y],W=z._getVersion,W=W(z._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[z,W]:v.mutableSourceEagerHydrationData.push(z,W);return new vn(v)},Ol.render=function(y,v,z){if(!Gr(v))throw Error(d(200));return bn(null,y,v,!1,z)},Ol.unmountComponentAtNode=function(y){if(!Gr(y))throw Error(d(40));return y._reactRootContainer?(Xe(function(){bn(null,null,y,!1,function(){y._reactRootContainer=null,y[sl]=null})}),!0):!1},Ol.unstable_batchedUpdates=Mt,Ol.unstable_renderSubtreeIntoContainer=function(y,v,z,k){if(!Gr(z))throw Error(d(200));if(y==null||y._reactInternals===void 0)throw Error(d(38));return bn(y,v,z,!1,k)},Ol.version="18.3.1-next-f1338f8080-20240426",Ol}var k3;function Bj(){if(k3)return Fx.exports;k3=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(o){console.error(o)}}return u(),Fx.exports=nR(),Fx.exports}var J3;function iR(){if(J3)return Z0;J3=1;var u=Bj();return Z0.createRoot=u.createRoot,Z0.hydrateRoot=u.hydrateRoot,Z0}var sR=iR();Bj();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yg(){return yg=Object.assign?Object.assign.bind():function(u){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(u[g]=d[g])}return u},yg.apply(this,arguments)}var Hf;(function(u){u.Pop="POP",u.Push="PUSH",u.Replace="REPLACE"})(Hf||(Hf={}));const F3="popstate";function oR(u){u===void 0&&(u={});function o(g,j){let{pathname:Z,search:S,hash:n}=g.location;return _w("",{pathname:Z,search:S,hash:n},j.state&&j.state.usr||null,j.state&&j.state.key||"default")}function d(g,j){return typeof j=="string"?j:kj(j)}return cR(o,d,null,u)}function Ms(u,o){if(u===!1||u===null||typeof u>"u")throw new Error(o)}function Ij(u,o){if(!u){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function lR(){return Math.random().toString(36).substr(2,8)}function O3(u,o){return{usr:u.state,key:u.key,idx:o}}function _w(u,o,d,g){return d===void 0&&(d=null),yg({pathname:typeof u=="string"?u:u.pathname,search:"",hash:""},typeof o=="string"?ny(o):o,{state:d,key:o&&o.key||g||lR()})}function kj(u){let{pathname:o="/",search:d="",hash:g=""}=u;return d&&d!=="?"&&(o+=d.charAt(0)==="?"?d:"?"+d),g&&g!=="#"&&(o+=g.charAt(0)==="#"?g:"#"+g),o}function ny(u){let o={};if(u){let d=u.indexOf("#");d>=0&&(o.hash=u.substr(d),u=u.substr(0,d));let g=u.indexOf("?");g>=0&&(o.search=u.substr(g),u=u.substr(0,g)),u&&(o.pathname=u)}return o}function cR(u,o,d,g){g===void 0&&(g={});let{window:j=document.defaultView,v5Compat:Z=!1}=g,S=j.history,n=Hf.Pop,B=null,D=P();D==null&&(D=0,S.replaceState(yg({},S.state,{idx:D}),""));function P(){return(S.state||{idx:null}).idx}function G(){n=Hf.Pop;let pe=P(),ve=pe==null?null:pe-D;D=pe,B&&B({action:n,location:oe.location,delta:ve})}function Y(pe,ve){n=Hf.Push;let ke=_w(oe.location,pe,ve);D=P()+1;let ye=O3(ke,D),$e=oe.createHref(ke);try{S.pushState(ye,"",$e)}catch(De){if(De instanceof DOMException&&De.name==="DataCloneError")throw De;j.location.assign($e)}Z&&B&&B({action:n,location:oe.location,delta:1})}function X(pe,ve){n=Hf.Replace;let ke=_w(oe.location,pe,ve);D=P();let ye=O3(ke,D),$e=oe.createHref(ke);S.replaceState(ye,"",$e),Z&&B&&B({action:n,location:oe.location,delta:0})}function ue(pe){let ve=j.location.origin!=="null"?j.location.origin:j.location.href,ke=typeof pe=="string"?pe:kj(pe);return ke=ke.replace(/ $/,"%20"),Ms(ve,"No window.location.(origin|href) available to create URL for href: "+ke),new URL(ke,ve)}let oe={get action(){return n},get location(){return u(j,S)},listen(pe){if(B)throw new Error("A history only accepts one active listener");return j.addEventListener(F3,G),B=pe,()=>{j.removeEventListener(F3,G),B=null}},createHref(pe){return o(j,pe)},createURL:ue,encodeLocation(pe){let ve=ue(pe);return{pathname:ve.pathname,search:ve.search,hash:ve.hash}},push:Y,replace:X,go(pe){return S.go(pe)}};return oe}var D3;(function(u){u.data="data",u.deferred="deferred",u.redirect="redirect",u.error="error"})(D3||(D3={}));function uR(u,o,d){return d===void 0&&(d="/"),dR(u,o,d)}function dR(u,o,d,g){let j=typeof o=="string"?ny(o):o,Z=Oj(j.pathname||"/",d);if(Z==null)return null;let S=Jj(u);hR(S);let n=null;for(let B=0;n==null&&B<S.length;++B){let D=jR(Z);n=vR(S[B],D)}return n}function Jj(u,o,d,g){o===void 0&&(o=[]),d===void 0&&(d=[]),g===void 0&&(g="");let j=(Z,S,n)=>{let B={relativePath:n===void 0?Z.path||"":n,caseSensitive:Z.caseSensitive===!0,childrenIndex:S,route:Z};B.relativePath.startsWith("/")&&(Ms(B.relativePath.startsWith(g),'Absolute route path "'+B.relativePath+'" nested under path '+('"'+g+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),B.relativePath=B.relativePath.slice(g.length));let D=Pp([g,B.relativePath]),P=d.concat(B);Z.children&&Z.children.length>0&&(Ms(Z.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+D+'".')),Jj(Z.children,o,P,D)),!(Z.path==null&&!Z.index)&&o.push({path:D,score:xR(D,Z.index),routesMeta:P})};return u.forEach((Z,S)=>{var n;if(Z.path===""||!((n=Z.path)!=null&&n.includes("?")))j(Z,S);else for(let B of Fj(Z.path))j(Z,S,B)}),o}function Fj(u){let o=u.split("/");if(o.length===0)return[];let[d,...g]=o,j=d.endsWith("?"),Z=d.replace(/\?$/,"");if(g.length===0)return j?[Z,""]:[Z];let S=Fj(g.join("/")),n=[];return n.push(...S.map(B=>B===""?Z:[Z,B].join("/"))),j&&n.push(...S),n.map(B=>u.startsWith("/")&&B===""?"/":B)}function hR(u){u.sort((o,d)=>o.score!==d.score?d.score-o.score:wR(o.routesMeta.map(g=>g.childrenIndex),d.routesMeta.map(g=>g.childrenIndex)))}const fR=/^:[\w-]+$/,pR=3,mR=2,yR=1,gR=10,_R=-2,C3=u=>u==="*";function xR(u,o){let d=u.split("/"),g=d.length;return d.some(C3)&&(g+=_R),o&&(g+=mR),d.filter(j=>!C3(j)).reduce((j,Z)=>j+(fR.test(Z)?pR:Z===""?yR:gR),g)}function wR(u,o){return u.length===o.length&&u.slice(0,-1).every((g,j)=>g===o[j])?u[u.length-1]-o[o.length-1]:0}function vR(u,o,d){let{routesMeta:g}=u,j={},Z="/",S=[];for(let n=0;n<g.length;++n){let B=g[n],D=n===g.length-1,P=Z==="/"?o:o.slice(Z.length)||"/",G=bR({path:B.relativePath,caseSensitive:B.caseSensitive,end:D},P),Y=B.route;if(!G)return null;Object.assign(j,G.params),S.push({params:j,pathname:Pp([Z,G.pathname]),pathnameBase:SR(Pp([Z,G.pathnameBase])),route:Y}),G.pathnameBase!=="/"&&(Z=Pp([Z,G.pathnameBase]))}return S}function bR(u,o){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[d,g]=LR(u.path,u.caseSensitive,u.end),j=o.match(d);if(!j)return null;let Z=j[0],S=Z.replace(/(.)\/+$/,"$1"),n=j.slice(1);return{params:g.reduce((D,P,G)=>{let{paramName:Y,isOptional:X}=P;if(Y==="*"){let oe=n[G]||"";S=Z.slice(0,Z.length-oe.length).replace(/(.)\/+$/,"$1")}const ue=n[G];return X&&!ue?D[Y]=void 0:D[Y]=(ue||"").replace(/%2F/g,"/"),D},{}),pathname:Z,pathnameBase:S,pattern:u}}function LR(u,o,d){o===void 0&&(o=!1),d===void 0&&(d=!0),Ij(u==="*"||!u.endsWith("*")||u.endsWith("/*"),'Route path "'+u+'" will be treated as if it were '+('"'+u.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+u.replace(/\*$/,"/*")+'".'));let g=[],j="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(S,n,B)=>(g.push({paramName:n,isOptional:B!=null}),B?"/?([^\\/]+)?":"/([^\\/]+)"));return u.endsWith("*")?(g.push({paramName:"*"}),j+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):d?j+="\\/*$":u!==""&&u!=="/"&&(j+="(?:(?=\\/|$))"),[new RegExp(j,o?void 0:"i"),g]}function jR(u){try{return u.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return Ij(!1,'The URL path "'+u+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),u}}function Oj(u,o){if(o==="/")return u;if(!u.toLowerCase().startsWith(o.toLowerCase()))return null;let d=o.endsWith("/")?o.length-1:o.length,g=u.charAt(d);return g&&g!=="/"?null:u.slice(d)||"/"}function ZR(u,o){o===void 0&&(o="/");let{pathname:d,search:g="",hash:j=""}=typeof u=="string"?ny(u):u;return{pathname:d?d.startsWith("/")?d:NR(d,o):o,search:zR(g),hash:AR(j)}}function NR(u,o){let d=o.replace(/\/+$/,"").split("/");return u.split("/").forEach(j=>{j===".."?d.length>1&&d.pop():j!=="."&&d.push(j)}),d.length>1?d.join("/"):"/"}function Cx(u,o,d,g){return"Cannot include a '"+u+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(g)+"].  Please separate it out to the ")+("`to."+d+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ER(u){return u.filter((o,d)=>d===0||o.route.path&&o.route.path.length>0)}function Dj(u,o){let d=ER(u);return o?d.map((g,j)=>j===d.length-1?g.pathname:g.pathnameBase):d.map(g=>g.pathnameBase)}function Cj(u,o,d,g){g===void 0&&(g=!1);let j;typeof u=="string"?j=ny(u):(j=yg({},u),Ms(!j.pathname||!j.pathname.includes("?"),Cx("?","pathname","search",j)),Ms(!j.pathname||!j.pathname.includes("#"),Cx("#","pathname","hash",j)),Ms(!j.search||!j.search.includes("#"),Cx("#","search","hash",j)));let Z=u===""||j.pathname==="",S=Z?"/":j.pathname,n;if(S==null)n=d;else{let G=o.length-1;if(!g&&S.startsWith("..")){let Y=S.split("/");for(;Y[0]==="..";)Y.shift(),G-=1;j.pathname=Y.join("/")}n=G>=0?o[G]:"/"}let B=ZR(j,n),D=S&&S!=="/"&&S.endsWith("/"),P=(Z||S===".")&&d.endsWith("/");return!B.pathname.endsWith("/")&&(D||P)&&(B.pathname+="/"),B}const Pp=u=>u.join("/").replace(/\/\/+/g,"/"),SR=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),zR=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,AR=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function RR(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}const Pj=["post","put","patch","delete"];new Set(Pj);const TR=["get",...Pj];new Set(TR);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gg(){return gg=Object.assign?Object.assign.bind():function(u){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(u[g]=d[g])}return u},gg.apply(this,arguments)}const Kw=fe.createContext(null),VR=fe.createContext(null),Zg=fe.createContext(null),f_=fe.createContext(null),Yf=fe.createContext({outlet:null,matches:[],isDataRoute:!1}),Gj=fe.createContext(null);function Ng(){return fe.useContext(f_)!=null}function Eg(){return Ng()||Ms(!1),fe.useContext(f_).location}function Uj(u){fe.useContext(Zg).static||fe.useLayoutEffect(u)}function on(){let{isDataRoute:u}=fe.useContext(Yf);return u?WR():MR()}function MR(){Ng()||Ms(!1);let u=fe.useContext(Kw),{basename:o,future:d,navigator:g}=fe.useContext(Zg),{matches:j}=fe.useContext(Yf),{pathname:Z}=Eg(),S=JSON.stringify(Dj(j,d.v7_relativeSplatPath)),n=fe.useRef(!1);return Uj(()=>{n.current=!0}),fe.useCallback(function(D,P){if(P===void 0&&(P={}),!n.current)return;if(typeof D=="number"){g.go(D);return}let G=Cj(D,JSON.parse(S),Z,P.relative==="path");u==null&&o!=="/"&&(G.pathname=G.pathname==="/"?o:Pp([o,G.pathname])),(P.replace?g.replace:g.push)(G,P.state,P)},[o,g,S,Z,u])}function Qp(){let{matches:u}=fe.useContext(Yf),o=u[u.length-1];return o?o.params:{}}function BR(u,o){return IR(u,o)}function IR(u,o,d,g){Ng()||Ms(!1);let{navigator:j}=fe.useContext(Zg),{matches:Z}=fe.useContext(Yf),S=Z[Z.length-1],n=S?S.params:{};S&&S.pathname;let B=S?S.pathnameBase:"/";S&&S.route;let D=Eg(),P;if(o){var G;let pe=typeof o=="string"?ny(o):o;B==="/"||(G=pe.pathname)!=null&&G.startsWith(B)||Ms(!1),P=pe}else P=D;let Y=P.pathname||"/",X=Y;if(B!=="/"){let pe=B.replace(/^\//,"").split("/");X="/"+Y.replace(/^\//,"").split("/").slice(pe.length).join("/")}let ue=uR(u,{pathname:X}),oe=DR(ue&&ue.map(pe=>Object.assign({},pe,{params:Object.assign({},n,pe.params),pathname:Pp([B,j.encodeLocation?j.encodeLocation(pe.pathname).pathname:pe.pathname]),pathnameBase:pe.pathnameBase==="/"?B:Pp([B,j.encodeLocation?j.encodeLocation(pe.pathnameBase).pathname:pe.pathnameBase])})),Z,d,g);return o&&oe?fe.createElement(f_.Provider,{value:{location:gg({pathname:"/",search:"",hash:"",state:null,key:"default"},P),navigationType:Hf.Pop}},oe):oe}function kR(){let u=UR(),o=RR(u)?u.status+" "+u.statusText:u instanceof Error?u.message:JSON.stringify(u),d=u instanceof Error?u.stack:null,j={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return fe.createElement(fe.Fragment,null,fe.createElement("h2",null,"Unexpected Application Error!"),fe.createElement("h3",{style:{fontStyle:"italic"}},o),d?fe.createElement("pre",{style:j},d):null,null)}const JR=fe.createElement(kR,null);class FR extends fe.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,d){return d.location!==o.location||d.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:d.error,location:d.location,revalidation:o.revalidation||d.revalidation}}componentDidCatch(o,d){console.error("React Router caught the following error during render",o,d)}render(){return this.state.error!==void 0?fe.createElement(Yf.Provider,{value:this.props.routeContext},fe.createElement(Gj.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function OR(u){let{routeContext:o,match:d,children:g}=u,j=fe.useContext(Kw);return j&&j.static&&j.staticContext&&(d.route.errorElement||d.route.ErrorBoundary)&&(j.staticContext._deepestRenderedBoundaryId=d.route.id),fe.createElement(Yf.Provider,{value:o},g)}function DR(u,o,d,g){var j;if(o===void 0&&(o=[]),d===void 0&&(d=null),g===void 0&&(g=null),u==null){var Z;if(!d)return null;if(d.errors)u=d.matches;else if((Z=g)!=null&&Z.v7_partialHydration&&o.length===0&&!d.initialized&&d.matches.length>0)u=d.matches;else return null}let S=u,n=(j=d)==null?void 0:j.errors;if(n!=null){let P=S.findIndex(G=>G.route.id&&n?.[G.route.id]!==void 0);P>=0||Ms(!1),S=S.slice(0,Math.min(S.length,P+1))}let B=!1,D=-1;if(d&&g&&g.v7_partialHydration)for(let P=0;P<S.length;P++){let G=S[P];if((G.route.HydrateFallback||G.route.hydrateFallbackElement)&&(D=P),G.route.id){let{loaderData:Y,errors:X}=d,ue=G.route.loader&&Y[G.route.id]===void 0&&(!X||X[G.route.id]===void 0);if(G.route.lazy||ue){B=!0,D>=0?S=S.slice(0,D+1):S=[S[0]];break}}}return S.reduceRight((P,G,Y)=>{let X,ue=!1,oe=null,pe=null;d&&(X=n&&G.route.id?n[G.route.id]:void 0,oe=G.route.errorElement||JR,B&&(D<0&&Y===0?(XR("route-fallback"),ue=!0,pe=null):D===Y&&(ue=!0,pe=G.route.hydrateFallbackElement||null)));let ve=o.concat(S.slice(0,Y+1)),ke=()=>{let ye;return X?ye=oe:ue?ye=pe:G.route.Component?ye=fe.createElement(G.route.Component,null):G.route.element?ye=G.route.element:ye=P,fe.createElement(OR,{match:G,routeContext:{outlet:P,matches:ve,isDataRoute:d!=null},children:ye})};return d&&(G.route.ErrorBoundary||G.route.errorElement||Y===0)?fe.createElement(FR,{location:d.location,revalidation:d.revalidation,component:oe,error:X,children:ke(),routeContext:{outlet:null,matches:ve,isDataRoute:!0}}):ke()},null)}var Wj=function(u){return u.UseBlocker="useBlocker",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u}(Wj||{}),Xj=function(u){return u.UseBlocker="useBlocker",u.UseLoaderData="useLoaderData",u.UseActionData="useActionData",u.UseRouteError="useRouteError",u.UseNavigation="useNavigation",u.UseRouteLoaderData="useRouteLoaderData",u.UseMatches="useMatches",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u.UseRouteId="useRouteId",u}(Xj||{});function CR(u){let o=fe.useContext(Kw);return o||Ms(!1),o}function PR(u){let o=fe.useContext(VR);return o||Ms(!1),o}function GR(u){let o=fe.useContext(Yf);return o||Ms(!1),o}function Qj(u){let o=GR(),d=o.matches[o.matches.length-1];return d.route.id||Ms(!1),d.route.id}function UR(){var u;let o=fe.useContext(Gj),d=PR(),g=Qj();return o!==void 0?o:(u=d.errors)==null?void 0:u[g]}function WR(){let{router:u}=CR(Wj.UseNavigateStable),o=Qj(Xj.UseNavigateStable),d=fe.useRef(!1);return Uj(()=>{d.current=!0}),fe.useCallback(function(j,Z){Z===void 0&&(Z={}),d.current&&(typeof j=="number"?u.navigate(j):u.navigate(j,gg({fromRouteId:o},Z)))},[u,o])}const P3={};function XR(u,o,d){P3[u]||(P3[u]=!0)}function QR(u,o){u?.v7_startTransition,u?.v7_relativeSplatPath}function Rn(u){let{to:o,replace:d,state:g,relative:j}=u;Ng()||Ms(!1);let{future:Z,static:S}=fe.useContext(Zg),{matches:n}=fe.useContext(Yf),{pathname:B}=Eg(),D=on(),P=Cj(o,Dj(n,Z.v7_relativeSplatPath),B,j==="path"),G=JSON.stringify(P);return fe.useEffect(()=>D(JSON.parse(G),{replace:d,state:g,relative:j}),[D,G,j,d,g]),null}function pn(u){Ms(!1)}function HR(u){let{basename:o="/",children:d=null,location:g,navigationType:j=Hf.Pop,navigator:Z,static:S=!1,future:n}=u;Ng()&&Ms(!1);let B=o.replace(/^\/*/,"/"),D=fe.useMemo(()=>({basename:B,navigator:Z,static:S,future:gg({v7_relativeSplatPath:!1},n)}),[B,n,Z,S]);typeof g=="string"&&(g=ny(g));let{pathname:P="/",search:G="",hash:Y="",state:X=null,key:ue="default"}=g,oe=fe.useMemo(()=>{let pe=Oj(P,B);return pe==null?null:{location:{pathname:pe,search:G,hash:Y,state:X,key:ue},navigationType:j}},[B,P,G,Y,X,ue,j]);return oe==null?null:fe.createElement(Zg.Provider,{value:D},fe.createElement(f_.Provider,{children:d,value:oe}))}function YR(u){let{children:o,location:d}=u;return BR(xw(o),d)}new Promise(()=>{});function xw(u,o){o===void 0&&(o=[]);let d=[];return fe.Children.forEach(u,(g,j)=>{if(!fe.isValidElement(g))return;let Z=[...o,j];if(g.type===fe.Fragment){d.push.apply(d,xw(g.props.children,Z));return}g.type!==pn&&Ms(!1),!g.props.index||!g.props.children||Ms(!1);let S={id:g.props.id||Z.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:g.props.ErrorBoundary!=null||g.props.errorElement!=null,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(S.children=xw(g.props.children,Z)),d.push(S)}),d}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ww(u){return u===void 0&&(u=""),new URLSearchParams(typeof u=="string"||Array.isArray(u)||u instanceof URLSearchParams?u:Object.keys(u).reduce((o,d)=>{let g=u[d];return o.concat(Array.isArray(g)?g.map(j=>[d,j]):[[d,g]])},[]))}function $R(u,o){let d=ww(u);return o&&o.forEach((g,j)=>{d.has(j)||o.getAll(j).forEach(Z=>{d.append(j,Z)})}),d}const qR="6";try{window.__reactRouterVersion=qR}catch{}const KR="startTransition",G3=tR[KR];function eT(u){let{basename:o,children:d,future:g,window:j}=u,Z=fe.useRef();Z.current==null&&(Z.current=oR({window:j,v5Compat:!0}));let S=Z.current,[n,B]=fe.useState({action:S.action,location:S.location}),{v7_startTransition:D}=g||{},P=fe.useCallback(G=>{D&&G3?G3(()=>B(G)):B(G)},[B,D]);return fe.useLayoutEffect(()=>S.listen(P),[S,P]),fe.useEffect(()=>QR(g),[g]),fe.createElement(HR,{basename:o,children:d,location:n.location,navigationType:n.action,navigator:S,future:g})}var U3;(function(u){u.UseScrollRestoration="useScrollRestoration",u.UseSubmit="useSubmit",u.UseSubmitFetcher="useSubmitFetcher",u.UseFetcher="useFetcher",u.useViewTransitionState="useViewTransitionState"})(U3||(U3={}));var W3;(function(u){u.UseFetcher="useFetcher",u.UseFetchers="useFetchers",u.UseScrollRestoration="useScrollRestoration"})(W3||(W3={}));function ev(u){let o=fe.useRef(ww(u)),d=fe.useRef(!1),g=Eg(),j=fe.useMemo(()=>$R(g.search,d.current?null:o.current),[g.search]),Z=on(),S=fe.useCallback((n,B)=>{const D=ww(typeof n=="function"?n(j):n);d.current=!0,Z("?"+D,B)},[Z,j]);return[j,S]}const Bm={USERS:"ongopool_users",RIDES:"ongopool_rides",CHATS:"ongopool_chats"},tT=()=>{localStorage.getItem(Bm.RIDES)||localStorage.setItem(Bm.RIDES,JSON.stringify(rT)),localStorage.getItem(Bm.USERS)||localStorage.setItem(Bm.USERS,JSON.stringify(aT)),localStorage.getItem(Bm.CHATS)||localStorage.setItem(Bm.CHATS,JSON.stringify(nT))},aT=[{id:"1",name:"John Driver",email:"john@driver.com",phone:"+1-555-0123",dateOfBirth:"1990-05-15",address:"123 Main St",city:"Toronto",state:"ON",zipCode:"M5H 2N2",profilePicture:"/assets/placeholder-avatar.jpg",userType:"driver",licenseNumber:"D1234567",licenseExpiry:"2025-12-31",vehicleMake:"Toyota",vehicleModel:"Camry",vehicleYear:2020,vehicleColor:"Silver",vehiclePlate:"ABC 123",rating:4.8,totalRides:245,earnings:3240.5},{id:"2",name:"Sarah Rider",email:"sarah@rider.com",phone:"+1-555-0124",dateOfBirth:"1995-08-22",address:"456 Oak Ave",city:"Toronto",state:"ON",zipCode:"M4C 1B5",profilePicture:"/assets/placeholder-avatar-2.jpg",userType:"rider",rating:4.9,totalRides:67}],Qm=[{id:"s1",address:"123 Main St, Toronto, ON",city:"Toronto",state:"ON",zipCode:"M5H 2N2",latitude:43.6532,longitude:-79.3832,estimatedArrival:"10:00 AM",actualArrival:null,order:0},{id:"s2",address:"789 Queen St W, Toronto, ON",city:"Toronto",state:"ON",zipCode:"M6J 1G1",latitude:43.6476,longitude:-79.4134,estimatedArrival:"10:25 AM",actualArrival:null,order:1},{id:"s3",address:"456 Bloor St E, Toronto, ON",city:"Toronto",state:"ON",zipCode:"M4W 1A1",latitude:43.6708,longitude:-79.3799,estimatedArrival:"10:45 AM",actualArrival:null,order:2}],rT=[{id:"r1",driverId:"1",driverName:"John Driver",driverPhoto:"/assets/placeholder-avatar.jpg",driverRating:4.8,stops:Qm,departureDate:"2025-11-16",departureTime:"10:00",period:"AM",pricePerSeat:25,totalSeats:3,availableSeats:2,features:["No Smoking","Music","Winter Tires"],status:"pending",riders:[{id:"2",name:"Sarah Rider",photo:"/assets/placeholder-avatar-2.jpg",seatsBooked:1,pickupStopId:"s1",dropoffStopId:"s3"}],createdAt:"2025-11-15T10:00:00Z"},{id:"r2",driverId:"1",driverName:"John Driver",driverPhoto:"/assets/placeholder-avatar.jpg",driverRating:4.8,stops:[{id:"s4",address:"200 Bay St, Toronto, ON",city:"Toronto",state:"ON",zipCode:"M5J 2J1",latitude:43.6481,longitude:-79.3809,estimatedArrival:"2:00 PM",actualArrival:"2:05 PM",order:0},{id:"s5",address:"100 King St W, Toronto, ON",city:"Toronto",state:"ON",zipCode:"M5X 1C7",latitude:43.6481,longitude:-79.3832,estimatedArrival:"2:20 PM",actualArrival:null,order:1}],departureDate:"2025-11-15",departureTime:"2:00",period:"PM",pricePerSeat:20,totalSeats:3,availableSeats:0,features:["Coffee","No Smoking"],status:"active",riders:[{id:"3",name:"Mike Johnson",photo:"/assets/placeholder-avatar-3.jpg",seatsBooked:2,pickupStopId:"s4",dropoffStopId:"s5"}],createdAt:"2025-11-14T08:00:00Z"},{id:"r3",driverId:"1",driverName:"John Driver",driverPhoto:"/assets/placeholder-avatar.jpg",driverRating:4.8,stops:[{id:"s6",address:"50 University Ave, Toronto, ON",city:"Toronto",state:"ON",zipCode:"M5J 2H7",latitude:43.6532,longitude:-79.3849,estimatedArrival:"9:00 AM",actualArrival:"9:00 AM",order:0}],departureDate:"2025-11-14",departureTime:"9:00",period:"AM",pricePerSeat:15,totalSeats:2,availableSeats:0,features:["Music"],status:"completed",riders:[{id:"4",name:"Emma Wilson",photo:"/assets/placeholder-avatar-4.jpg",seatsBooked:1,pickupStopId:"s6",dropoffStopId:"s6"}],createdAt:"2025-11-13T06:00:00Z",completedAt:"2025-11-14T10:00:00Z"},{id:"r4",driverId:"1",driverName:"John Driver",driverPhoto:"/assets/placeholder-avatar.jpg",driverRating:4.8,stops:Qm,departureDate:"2025-11-20",departureTime:"3:00",period:"PM",pricePerSeat:30,totalSeats:4,availableSeats:4,features:["Coffee","No Smoking","Winter Tires","Music"],status:"upcoming",riders:[],createdAt:"2025-11-15T11:00:00Z"},{id:"r5",driverId:"1",driverName:"John Driver",driverPhoto:"/assets/placeholder-avatar.jpg",driverRating:4.8,stops:[Qm[0],Qm[2]],departureDate:"2025-11-18",departureTime:"11:00",period:"AM",pricePerSeat:22,totalSeats:3,availableSeats:3,features:["No Smoking"],status:"canceled",riders:[],createdAt:"2025-11-14T09:00:00Z",canceledAt:"2025-11-15T08:00:00Z",cancelReason:"Vehicle maintenance required"}],nT=[{id:"c1",rideId:"r1",senderId:"2",senderName:"Sarah Rider",receiverId:"1",receiverName:"John Driver",message:"Hi! Can you wait 2 minutes at the pickup point?",timestamp:"2025-11-15T09:45:00Z",read:!1},{id:"c2",rideId:"r1",senderId:"1",senderName:"John Driver",receiverId:"2",receiverName:"Sarah Rider",message:"Sure, no problem!",timestamp:"2025-11-15T09:46:00Z",read:!0},{id:"c3",rideId:"r2",senderId:"3",senderName:"Mike Johnson",receiverId:"1",receiverName:"John Driver",message:"I'm at the pickup location",timestamp:"2025-11-15T13:58:00Z",read:!0}];Qm[0],Qm[2];var vw=function(u,o){return vw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,g){d.__proto__=g}||function(d,g){for(var j in g)Object.prototype.hasOwnProperty.call(g,j)&&(d[j]=g[j])},vw(u,o)};function Hj(u,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");vw(u,o);function d(){this.constructor=u}u.prototype=o===null?Object.create(o):(d.prototype=o.prototype,new d)}var $0=function(){return $0=Object.assign||function(o){for(var d,g=1,j=arguments.length;g<j;g++){d=arguments[g];for(var Z in d)Object.prototype.hasOwnProperty.call(d,Z)&&(o[Z]=d[Z])}return o},$0.apply(this,arguments)};function iy(u,o){var d={};for(var g in u)Object.prototype.hasOwnProperty.call(u,g)&&o.indexOf(g)<0&&(d[g]=u[g]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var j=0,g=Object.getOwnPropertySymbols(u);j<g.length;j++)o.indexOf(g[j])<0&&Object.prototype.propertyIsEnumerable.call(u,g[j])&&(d[g[j]]=u[g[j]]);return d}function Yj(u,o,d,g){var j=arguments.length,Z=j<3?o:g===null?g=Object.getOwnPropertyDescriptor(o,d):g,S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(u,o,d,g);else for(var n=u.length-1;n>=0;n--)(S=u[n])&&(Z=(j<3?S(Z):j>3?S(o,d,Z):S(o,d))||Z);return j>3&&Z&&Object.defineProperty(o,d,Z),Z}function $j(u,o){return function(d,g){o(d,g,u)}}function qj(u,o,d,g,j,Z){function S(ve){if(ve!==void 0&&typeof ve!="function")throw new TypeError("Function expected");return ve}for(var n=g.kind,B=n==="getter"?"get":n==="setter"?"set":"value",D=!o&&u?g.static?u:u.prototype:null,P=o||(D?Object.getOwnPropertyDescriptor(D,g.name):{}),G,Y=!1,X=d.length-1;X>=0;X--){var ue={};for(var oe in g)ue[oe]=oe==="access"?{}:g[oe];for(var oe in g.access)ue.access[oe]=g.access[oe];ue.addInitializer=function(ve){if(Y)throw new TypeError("Cannot add initializers after decoration has completed");Z.push(S(ve||null))};var pe=(0,d[X])(n==="accessor"?{get:P.get,set:P.set}:P[B],ue);if(n==="accessor"){if(pe===void 0)continue;if(pe===null||typeof pe!="object")throw new TypeError("Object expected");(G=S(pe.get))&&(P.get=G),(G=S(pe.set))&&(P.set=G),(G=S(pe.init))&&j.unshift(G)}else(G=S(pe))&&(n==="field"?j.unshift(G):P[B]=G)}D&&Object.defineProperty(D,g.name,P),Y=!0}function Kj(u,o,d){for(var g=arguments.length>2,j=0;j<o.length;j++)d=g?o[j].call(u,d):o[j].call(u);return g?d:void 0}function eZ(u){return typeof u=="symbol"?u:"".concat(u)}function tZ(u,o,d){return typeof o=="symbol"&&(o=o.description?"[".concat(o.description,"]"):""),Object.defineProperty(u,"name",{configurable:!0,value:d?"".concat(d," ",o):o})}function aZ(u,o){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(u,o)}function ur(u,o,d,g){function j(Z){return Z instanceof d?Z:new d(function(S){S(Z)})}return new(d||(d=Promise))(function(Z,S){function n(P){try{D(g.next(P))}catch(G){S(G)}}function B(P){try{D(g.throw(P))}catch(G){S(G)}}function D(P){P.done?Z(P.value):j(P.value).then(n,B)}D((g=g.apply(u,o||[])).next())})}function rZ(u,o){var d={label:0,sent:function(){if(Z[0]&1)throw Z[1];return Z[1]},trys:[],ops:[]},g,j,Z,S=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return S.next=n(0),S.throw=n(1),S.return=n(2),typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function n(D){return function(P){return B([D,P])}}function B(D){if(g)throw new TypeError("Generator is already executing.");for(;S&&(S=0,D[0]&&(d=0)),d;)try{if(g=1,j&&(Z=D[0]&2?j.return:D[0]?j.throw||((Z=j.return)&&Z.call(j),0):j.next)&&!(Z=Z.call(j,D[1])).done)return Z;switch(j=0,Z&&(D=[D[0]&2,Z.value]),D[0]){case 0:case 1:Z=D;break;case 4:return d.label++,{value:D[1],done:!1};case 5:d.label++,j=D[1],D=[0];continue;case 7:D=d.ops.pop(),d.trys.pop();continue;default:if(Z=d.trys,!(Z=Z.length>0&&Z[Z.length-1])&&(D[0]===6||D[0]===2)){d=0;continue}if(D[0]===3&&(!Z||D[1]>Z[0]&&D[1]<Z[3])){d.label=D[1];break}if(D[0]===6&&d.label<Z[1]){d.label=Z[1],Z=D;break}if(Z&&d.label<Z[2]){d.label=Z[2],d.ops.push(D);break}Z[2]&&d.ops.pop(),d.trys.pop();continue}D=o.call(u,d)}catch(P){D=[6,P],j=0}finally{g=Z=0}if(D[0]&5)throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}}var p_=Object.create?function(u,o,d,g){g===void 0&&(g=d);var j=Object.getOwnPropertyDescriptor(o,d);(!j||("get"in j?!o.__esModule:j.writable||j.configurable))&&(j={enumerable:!0,get:function(){return o[d]}}),Object.defineProperty(u,g,j)}:function(u,o,d,g){g===void 0&&(g=d),u[g]=o[d]};function nZ(u,o){for(var d in u)d!=="default"&&!Object.prototype.hasOwnProperty.call(o,d)&&p_(o,u,d)}function q0(u){var o=typeof Symbol=="function"&&Symbol.iterator,d=o&&u[o],g=0;if(d)return d.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function tv(u,o){var d=typeof Symbol=="function"&&u[Symbol.iterator];if(!d)return u;var g=d.call(u),j,Z=[],S;try{for(;(o===void 0||o-- >0)&&!(j=g.next()).done;)Z.push(j.value)}catch(n){S={error:n}}finally{try{j&&!j.done&&(d=g.return)&&d.call(g)}finally{if(S)throw S.error}}return Z}function iZ(){for(var u=[],o=0;o<arguments.length;o++)u=u.concat(tv(arguments[o]));return u}function sZ(){for(var u=0,o=0,d=arguments.length;o<d;o++)u+=arguments[o].length;for(var g=Array(u),j=0,o=0;o<d;o++)for(var Z=arguments[o],S=0,n=Z.length;S<n;S++,j++)g[j]=Z[S];return g}function oZ(u,o,d){if(d||arguments.length===2)for(var g=0,j=o.length,Z;g<j;g++)(Z||!(g in o))&&(Z||(Z=Array.prototype.slice.call(o,0,g)),Z[g]=o[g]);return u.concat(Z||Array.prototype.slice.call(o))}function qm(u){return this instanceof qm?(this.v=u,this):new qm(u)}function lZ(u,o,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=d.apply(u,o||[]),j,Z=[];return j=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),n("next"),n("throw"),n("return",S),j[Symbol.asyncIterator]=function(){return this},j;function S(X){return function(ue){return Promise.resolve(ue).then(X,G)}}function n(X,ue){g[X]&&(j[X]=function(oe){return new Promise(function(pe,ve){Z.push([X,oe,pe,ve])>1||B(X,oe)})},ue&&(j[X]=ue(j[X])))}function B(X,ue){try{D(g[X](ue))}catch(oe){Y(Z[0][3],oe)}}function D(X){X.value instanceof qm?Promise.resolve(X.value.v).then(P,G):Y(Z[0][2],X)}function P(X){B("next",X)}function G(X){B("throw",X)}function Y(X,ue){X(ue),Z.shift(),Z.length&&B(Z[0][0],Z[0][1])}}function cZ(u){var o,d;return o={},g("next"),g("throw",function(j){throw j}),g("return"),o[Symbol.iterator]=function(){return this},o;function g(j,Z){o[j]=u[j]?function(S){return(d=!d)?{value:qm(u[j](S)),done:!1}:Z?Z(S):S}:Z}}function uZ(u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=u[Symbol.asyncIterator],d;return o?o.call(u):(u=typeof q0=="function"?q0(u):u[Symbol.iterator](),d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d);function g(Z){d[Z]=u[Z]&&function(S){return new Promise(function(n,B){S=u[Z](S),j(n,B,S.done,S.value)})}}function j(Z,S,n,B){Promise.resolve(B).then(function(D){Z({value:D,done:n})},S)}}function dZ(u,o){return Object.defineProperty?Object.defineProperty(u,"raw",{value:o}):u.raw=o,u}var iT=Object.create?function(u,o){Object.defineProperty(u,"default",{enumerable:!0,value:o})}:function(u,o){u.default=o},bw=function(u){return bw=Object.getOwnPropertyNames||function(o){var d=[];for(var g in o)Object.prototype.hasOwnProperty.call(o,g)&&(d[d.length]=g);return d},bw(u)};function hZ(u){if(u&&u.__esModule)return u;var o={};if(u!=null)for(var d=bw(u),g=0;g<d.length;g++)d[g]!=="default"&&p_(o,u,d[g]);return iT(o,u),o}function fZ(u){return u&&u.__esModule?u:{default:u}}function pZ(u,o,d,g){if(d==="a"&&!g)throw new TypeError("Private accessor was defined without a getter");if(typeof o=="function"?u!==o||!g:!o.has(u))throw new TypeError("Cannot read private member from an object whose class did not declare it");return d==="m"?g:d==="a"?g.call(u):g?g.value:o.get(u)}function mZ(u,o,d,g,j){if(g==="m")throw new TypeError("Private method is not writable");if(g==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof o=="function"?u!==o||!j:!o.has(u))throw new TypeError("Cannot write private member to an object whose class did not declare it");return g==="a"?j.call(u,d):j?j.value=d:o.set(u,d),d}function yZ(u,o){if(o===null||typeof o!="object"&&typeof o!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof u=="function"?o===u:u.has(o)}function gZ(u,o,d){if(o!=null){if(typeof o!="object"&&typeof o!="function")throw new TypeError("Object expected.");var g,j;if(d){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");g=o[Symbol.asyncDispose]}if(g===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");g=o[Symbol.dispose],d&&(j=g)}if(typeof g!="function")throw new TypeError("Object not disposable.");j&&(g=function(){try{j.call(this)}catch(Z){return Promise.reject(Z)}}),u.stack.push({value:o,dispose:g,async:d})}else d&&u.stack.push({async:!0});return o}var sT=typeof SuppressedError=="function"?SuppressedError:function(u,o,d){var g=new Error(d);return g.name="SuppressedError",g.error=u,g.suppressed=o,g};function _Z(u){function o(Z){u.error=u.hasError?new sT(Z,u.error,"An error was suppressed during disposal."):Z,u.hasError=!0}var d,g=0;function j(){for(;d=u.stack.pop();)try{if(!d.async&&g===1)return g=0,u.stack.push(d),Promise.resolve().then(j);if(d.dispose){var Z=d.dispose.call(d.value);if(d.async)return g|=2,Promise.resolve(Z).then(j,function(S){return o(S),j()})}else g|=1}catch(S){o(S)}if(g===1)return u.hasError?Promise.reject(u.error):Promise.resolve();if(u.hasError)throw u.error}return j()}function xZ(u,o){return typeof u=="string"&&/^\.\.?\//.test(u)?u.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(d,g,j,Z,S){return g?o?".jsx":".js":j&&(!Z||!S)?d:j+Z+"."+S.toLowerCase()+"js"}):u}const oT={__extends:Hj,__assign:$0,__rest:iy,__decorate:Yj,__param:$j,__esDecorate:qj,__runInitializers:Kj,__propKey:eZ,__setFunctionName:tZ,__metadata:aZ,__awaiter:ur,__generator:rZ,__createBinding:p_,__exportStar:nZ,__values:q0,__read:tv,__spread:iZ,__spreadArrays:sZ,__spreadArray:oZ,__await:qm,__asyncGenerator:lZ,__asyncDelegator:cZ,__asyncValues:uZ,__makeTemplateObject:dZ,__importStar:hZ,__importDefault:fZ,__classPrivateFieldGet:pZ,__classPrivateFieldSet:mZ,__classPrivateFieldIn:yZ,__addDisposableResource:gZ,__disposeResources:_Z,__rewriteRelativeImportExtension:xZ},lT=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:gZ,get __assign(){return $0},__asyncDelegator:cZ,__asyncGenerator:lZ,__asyncValues:uZ,__await:qm,__awaiter:ur,__classPrivateFieldGet:pZ,__classPrivateFieldIn:yZ,__classPrivateFieldSet:mZ,__createBinding:p_,__decorate:Yj,__disposeResources:_Z,__esDecorate:qj,__exportStar:nZ,__extends:Hj,__generator:rZ,__importDefault:fZ,__importStar:hZ,__makeTemplateObject:dZ,__metadata:aZ,__param:$j,__propKey:eZ,__read:tv,__rest:iy,__rewriteRelativeImportExtension:xZ,__runInitializers:Kj,__setFunctionName:tZ,__spread:iZ,__spreadArray:oZ,__spreadArrays:sZ,__values:q0,default:oT},Symbol.toStringTag,{value:"Module"})),cT=u=>u?(...o)=>u(...o):(...o)=>fetch(...o);class av extends Error{constructor(o,d="FunctionsError",g){super(o),this.name=d,this.context=g}}class uT extends av{constructor(o){super("Failed to send a request to the Edge Function","FunctionsFetchError",o)}}class X3 extends av{constructor(o){super("Relay Error invoking the Edge Function","FunctionsRelayError",o)}}class Q3 extends av{constructor(o){super("Edge Function returned a non-2xx status code","FunctionsHttpError",o)}}var Lw;(function(u){u.Any="any",u.ApNortheast1="ap-northeast-1",u.ApNortheast2="ap-northeast-2",u.ApSouth1="ap-south-1",u.ApSoutheast1="ap-southeast-1",u.ApSoutheast2="ap-southeast-2",u.CaCentral1="ca-central-1",u.EuCentral1="eu-central-1",u.EuWest1="eu-west-1",u.EuWest2="eu-west-2",u.EuWest3="eu-west-3",u.SaEast1="sa-east-1",u.UsEast1="us-east-1",u.UsWest1="us-west-1",u.UsWest2="us-west-2"})(Lw||(Lw={}));class dT{constructor(o,{headers:d={},customFetch:g,region:j=Lw.Any}={}){this.url=o,this.headers=d,this.region=j,this.fetch=cT(g)}setAuth(o){this.headers.Authorization=`Bearer ${o}`}invoke(o){return ur(this,arguments,void 0,function*(d,g={}){var j;let Z,S;try{const{headers:n,method:B,body:D,signal:P,timeout:G}=g;let Y={},{region:X}=g;X||(X=this.region);const ue=new URL(`${this.url}/${d}`);X&&X!=="any"&&(Y["x-region"]=X,ue.searchParams.set("forceFunctionRegion",X));let oe;D&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)?typeof Blob<"u"&&D instanceof Blob||D instanceof ArrayBuffer?(Y["Content-Type"]="application/octet-stream",oe=D):typeof D=="string"?(Y["Content-Type"]="text/plain",oe=D):typeof FormData<"u"&&D instanceof FormData?oe=D:(Y["Content-Type"]="application/json",oe=JSON.stringify(D)):oe=D;let pe=P;G&&(S=new AbortController,Z=setTimeout(()=>S.abort(),G),P?(pe=S.signal,P.addEventListener("abort",()=>S.abort())):pe=S.signal);const ve=yield this.fetch(ue.toString(),{method:B||"POST",headers:Object.assign(Object.assign(Object.assign({},Y),this.headers),n),body:oe,signal:pe}).catch(De=>{throw new uT(De)}),ke=ve.headers.get("x-relay-error");if(ke&&ke==="true")throw new X3(ve);if(!ve.ok)throw new Q3(ve);let ye=((j=ve.headers.get("Content-Type"))!==null&&j!==void 0?j:"text/plain").split(";")[0].trim(),$e;return ye==="application/json"?$e=yield ve.json():ye==="application/octet-stream"||ye==="application/pdf"?$e=yield ve.blob():ye==="text/event-stream"?$e=ve:ye==="multipart/form-data"?$e=yield ve.formData():$e=yield ve.text(),{data:$e,error:null,response:ve}}catch(n){return{data:null,error:n,response:n instanceof Q3||n instanceof X3?n.context:void 0}}finally{Z&&clearTimeout(Z)}})}}var Qo={};const sy=$A(lT);var N0={},E0={},S0={},z0={},A0={},R0={},H3;function wZ(){if(H3)return R0;H3=1,Object.defineProperty(R0,"__esModule",{value:!0});class u extends Error{constructor(d){super(d.message),this.name="PostgrestError",this.details=d.details,this.hint=d.hint,this.code=d.code}}return R0.default=u,R0}var Y3;function vZ(){if(Y3)return A0;Y3=1,Object.defineProperty(A0,"__esModule",{value:!0});const o=sy.__importDefault(wZ());class d{constructor(j){var Z,S;this.shouldThrowOnError=!1,this.method=j.method,this.url=j.url,this.headers=new Headers(j.headers),this.schema=j.schema,this.body=j.body,this.shouldThrowOnError=(Z=j.shouldThrowOnError)!==null&&Z!==void 0?Z:!1,this.signal=j.signal,this.isMaybeSingle=(S=j.isMaybeSingle)!==null&&S!==void 0?S:!1,j.fetch?this.fetch=j.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(j,Z){return this.headers=new Headers(this.headers),this.headers.set(j,Z),this}then(j,Z){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const S=this.fetch;let n=S(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async B=>{var D,P,G,Y;let X=null,ue=null,oe=null,pe=B.status,ve=B.statusText;if(B.ok){if(this.method!=="HEAD"){const De=await B.text();De===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((D=this.headers.get("Accept"))===null||D===void 0)&&D.includes("application/vnd.pgrst.plan+text"))?ue=De:ue=JSON.parse(De))}const ye=(P=this.headers.get("Prefer"))===null||P===void 0?void 0:P.match(/count=(exact|planned|estimated)/),$e=(G=B.headers.get("content-range"))===null||G===void 0?void 0:G.split("/");ye&&$e&&$e.length>1&&(oe=parseInt($e[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(ue)&&(ue.length>1?(X={code:"PGRST116",details:`Results contain ${ue.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},ue=null,oe=null,pe=406,ve="Not Acceptable"):ue.length===1?ue=ue[0]:ue=null)}else{const ye=await B.text();try{X=JSON.parse(ye),Array.isArray(X)&&B.status===404&&(ue=[],X=null,pe=200,ve="OK")}catch{B.status===404&&ye===""?(pe=204,ve="No Content"):X={message:ye}}if(X&&this.isMaybeSingle&&(!((Y=X?.details)===null||Y===void 0)&&Y.includes("0 rows"))&&(X=null,pe=200,ve="OK"),X&&this.shouldThrowOnError)throw new o.default(X)}return{error:X,data:ue,count:oe,status:pe,statusText:ve}});return this.shouldThrowOnError||(n=n.catch(B=>{var D,P,G;return{error:{message:`${(D=B?.name)!==null&&D!==void 0?D:"FetchError"}: ${B?.message}`,details:`${(P=B?.stack)!==null&&P!==void 0?P:""}`,hint:"",code:`${(G=B?.code)!==null&&G!==void 0?G:""}`},data:null,count:null,status:0,statusText:""}})),n.then(j,Z)}returns(){return this}overrideTypes(){return this}}return A0.default=d,A0}var $3;function bZ(){if($3)return z0;$3=1,Object.defineProperty(z0,"__esModule",{value:!0});const o=sy.__importDefault(vZ());class d extends o.default{select(j){let Z=!1;const S=(j??"*").split("").map(n=>/\s/.test(n)&&!Z?"":(n==='"'&&(Z=!Z),n)).join("");return this.url.searchParams.set("select",S),this.headers.append("Prefer","return=representation"),this}order(j,{ascending:Z=!0,nullsFirst:S,foreignTable:n,referencedTable:B=n}={}){const D=B?`${B}.order`:"order",P=this.url.searchParams.get(D);return this.url.searchParams.set(D,`${P?`${P},`:""}${j}.${Z?"asc":"desc"}${S===void 0?"":S?".nullsfirst":".nullslast"}`),this}limit(j,{foreignTable:Z,referencedTable:S=Z}={}){const n=typeof S>"u"?"limit":`${S}.limit`;return this.url.searchParams.set(n,`${j}`),this}range(j,Z,{foreignTable:S,referencedTable:n=S}={}){const B=typeof n>"u"?"offset":`${n}.offset`,D=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(B,`${j}`),this.url.searchParams.set(D,`${Z-j+1}`),this}abortSignal(j){return this.signal=j,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:j=!1,verbose:Z=!1,settings:S=!1,buffers:n=!1,wal:B=!1,format:D="text"}={}){var P;const G=[j?"analyze":null,Z?"verbose":null,S?"settings":null,n?"buffers":null,B?"wal":null].filter(Boolean).join("|"),Y=(P=this.headers.get("Accept"))!==null&&P!==void 0?P:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${D}; for="${Y}"; options=${G};`),D==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(j){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${j}`),this}}return z0.default=d,z0}var q3;function rv(){if(q3)return S0;q3=1,Object.defineProperty(S0,"__esModule",{value:!0});const o=sy.__importDefault(bZ()),d=new RegExp("[,()]");class g extends o.default{eq(Z,S){return this.url.searchParams.append(Z,`eq.${S}`),this}neq(Z,S){return this.url.searchParams.append(Z,`neq.${S}`),this}gt(Z,S){return this.url.searchParams.append(Z,`gt.${S}`),this}gte(Z,S){return this.url.searchParams.append(Z,`gte.${S}`),this}lt(Z,S){return this.url.searchParams.append(Z,`lt.${S}`),this}lte(Z,S){return this.url.searchParams.append(Z,`lte.${S}`),this}like(Z,S){return this.url.searchParams.append(Z,`like.${S}`),this}likeAllOf(Z,S){return this.url.searchParams.append(Z,`like(all).{${S.join(",")}}`),this}likeAnyOf(Z,S){return this.url.searchParams.append(Z,`like(any).{${S.join(",")}}`),this}ilike(Z,S){return this.url.searchParams.append(Z,`ilike.${S}`),this}ilikeAllOf(Z,S){return this.url.searchParams.append(Z,`ilike(all).{${S.join(",")}}`),this}ilikeAnyOf(Z,S){return this.url.searchParams.append(Z,`ilike(any).{${S.join(",")}}`),this}is(Z,S){return this.url.searchParams.append(Z,`is.${S}`),this}in(Z,S){const n=Array.from(new Set(S)).map(B=>typeof B=="string"&&d.test(B)?`"${B}"`:`${B}`).join(",");return this.url.searchParams.append(Z,`in.(${n})`),this}contains(Z,S){return typeof S=="string"?this.url.searchParams.append(Z,`cs.${S}`):Array.isArray(S)?this.url.searchParams.append(Z,`cs.{${S.join(",")}}`):this.url.searchParams.append(Z,`cs.${JSON.stringify(S)}`),this}containedBy(Z,S){return typeof S=="string"?this.url.searchParams.append(Z,`cd.${S}`):Array.isArray(S)?this.url.searchParams.append(Z,`cd.{${S.join(",")}}`):this.url.searchParams.append(Z,`cd.${JSON.stringify(S)}`),this}rangeGt(Z,S){return this.url.searchParams.append(Z,`sr.${S}`),this}rangeGte(Z,S){return this.url.searchParams.append(Z,`nxl.${S}`),this}rangeLt(Z,S){return this.url.searchParams.append(Z,`sl.${S}`),this}rangeLte(Z,S){return this.url.searchParams.append(Z,`nxr.${S}`),this}rangeAdjacent(Z,S){return this.url.searchParams.append(Z,`adj.${S}`),this}overlaps(Z,S){return typeof S=="string"?this.url.searchParams.append(Z,`ov.${S}`):this.url.searchParams.append(Z,`ov.{${S.join(",")}}`),this}textSearch(Z,S,{config:n,type:B}={}){let D="";B==="plain"?D="pl":B==="phrase"?D="ph":B==="websearch"&&(D="w");const P=n===void 0?"":`(${n})`;return this.url.searchParams.append(Z,`${D}fts${P}.${S}`),this}match(Z){return Object.entries(Z).forEach(([S,n])=>{this.url.searchParams.append(S,`eq.${n}`)}),this}not(Z,S,n){return this.url.searchParams.append(Z,`not.${S}.${n}`),this}or(Z,{foreignTable:S,referencedTable:n=S}={}){const B=n?`${n}.or`:"or";return this.url.searchParams.append(B,`(${Z})`),this}filter(Z,S,n){return this.url.searchParams.append(Z,`${S}.${n}`),this}}return S0.default=g,S0}var K3;function LZ(){if(K3)return E0;K3=1,Object.defineProperty(E0,"__esModule",{value:!0});const o=sy.__importDefault(rv());class d{constructor(j,{headers:Z={},schema:S,fetch:n}){this.url=j,this.headers=new Headers(Z),this.schema=S,this.fetch=n}select(j,Z){const{head:S=!1,count:n}=Z??{},B=S?"HEAD":"GET";let D=!1;const P=(j??"*").split("").map(G=>/\s/.test(G)&&!D?"":(G==='"'&&(D=!D),G)).join("");return this.url.searchParams.set("select",P),n&&this.headers.append("Prefer",`count=${n}`),new o.default({method:B,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(j,{count:Z,defaultToNull:S=!0}={}){var n;const B="POST";if(Z&&this.headers.append("Prefer",`count=${Z}`),S||this.headers.append("Prefer","missing=default"),Array.isArray(j)){const D=j.reduce((P,G)=>P.concat(Object.keys(G)),[]);if(D.length>0){const P=[...new Set(D)].map(G=>`"${G}"`);this.url.searchParams.set("columns",P.join(","))}}return new o.default({method:B,url:this.url,headers:this.headers,schema:this.schema,body:j,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(j,{onConflict:Z,ignoreDuplicates:S=!1,count:n,defaultToNull:B=!0}={}){var D;const P="POST";if(this.headers.append("Prefer",`resolution=${S?"ignore":"merge"}-duplicates`),Z!==void 0&&this.url.searchParams.set("on_conflict",Z),n&&this.headers.append("Prefer",`count=${n}`),B||this.headers.append("Prefer","missing=default"),Array.isArray(j)){const G=j.reduce((Y,X)=>Y.concat(Object.keys(X)),[]);if(G.length>0){const Y=[...new Set(G)].map(X=>`"${X}"`);this.url.searchParams.set("columns",Y.join(","))}}return new o.default({method:P,url:this.url,headers:this.headers,schema:this.schema,body:j,fetch:(D=this.fetch)!==null&&D!==void 0?D:fetch})}update(j,{count:Z}={}){var S;const n="PATCH";return Z&&this.headers.append("Prefer",`count=${Z}`),new o.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:j,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}delete({count:j}={}){var Z;const S="DELETE";return j&&this.headers.append("Prefer",`count=${j}`),new o.default({method:S,url:this.url,headers:this.headers,schema:this.schema,fetch:(Z=this.fetch)!==null&&Z!==void 0?Z:fetch})}}return E0.default=d,E0}var eL;function hT(){if(eL)return N0;eL=1,Object.defineProperty(N0,"__esModule",{value:!0});const u=sy,o=u.__importDefault(LZ()),d=u.__importDefault(rv());class g{constructor(Z,{headers:S={},schema:n,fetch:B}={}){this.url=Z,this.headers=new Headers(S),this.schemaName=n,this.fetch=B}from(Z){const S=new URL(`${this.url}/${Z}`);return new o.default(S,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(Z){return new g(this.url,{headers:this.headers,schema:Z,fetch:this.fetch})}rpc(Z,S={},{head:n=!1,get:B=!1,count:D}={}){var P;let G;const Y=new URL(`${this.url}/rpc/${Z}`);let X;n||B?(G=n?"HEAD":"GET",Object.entries(S).filter(([oe,pe])=>pe!==void 0).map(([oe,pe])=>[oe,Array.isArray(pe)?`{${pe.join(",")}}`:`${pe}`]).forEach(([oe,pe])=>{Y.searchParams.append(oe,pe)})):(G="POST",X=S);const ue=new Headers(this.headers);return D&&ue.set("Prefer",`count=${D}`),new d.default({method:G,url:Y,headers:ue,schema:this.schemaName,body:X,fetch:(P=this.fetch)!==null&&P!==void 0?P:fetch})}}return N0.default=g,N0}var tL;function fT(){if(tL)return Qo;tL=1,Object.defineProperty(Qo,"__esModule",{value:!0}),Qo.PostgrestError=Qo.PostgrestBuilder=Qo.PostgrestTransformBuilder=Qo.PostgrestFilterBuilder=Qo.PostgrestQueryBuilder=Qo.PostgrestClient=void 0;const u=sy,o=u.__importDefault(hT());Qo.PostgrestClient=o.default;const d=u.__importDefault(LZ());Qo.PostgrestQueryBuilder=d.default;const g=u.__importDefault(rv());Qo.PostgrestFilterBuilder=g.default;const j=u.__importDefault(bZ());Qo.PostgrestTransformBuilder=j.default;const Z=u.__importDefault(vZ());Qo.PostgrestBuilder=Z.default;const S=u.__importDefault(wZ());return Qo.PostgrestError=S.default,Qo.default={PostgrestClient:o.default,PostgrestQueryBuilder:d.default,PostgrestFilterBuilder:g.default,PostgrestTransformBuilder:j.default,PostgrestBuilder:Z.default,PostgrestError:S.default},Qo}var jZ=fT();const ZZ=ry(jZ),pT=Mj({__proto__:null,default:ZZ},[jZ]),{PostgrestClient:mT,PostgrestQueryBuilder:z5,PostgrestFilterBuilder:A5,PostgrestTransformBuilder:R5,PostgrestBuilder:T5,PostgrestError:V5}=ZZ||pT;class yT{static detectEnvironment(){var o;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((o=navigator.userAgent)===null||o===void 0)&&o.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const d=process.versions;if(d&&d.node){const g=d.node,j=parseInt(g.replace(/^v/,"").split(".")[0]);return j>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${j} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${j} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const o=this.detectEnvironment();if(o.constructor)return o.constructor;let d=o.error||"WebSocket not supported in this environment.";throw o.workaround&&(d+=`

Suggested solution: ${o.workaround}`),new Error(d)}static createWebSocket(o,d){const g=this.getWebSocketConstructor();return new g(o,d)}static isWebSocketSupported(){try{const o=this.detectEnvironment();return o.type==="native"||o.type==="ws"}catch{return!1}}}const gT="2.81.1",_T=`realtime-js/${gT}`,NZ="1.0.0",xT="2.0.0",aL=NZ,jw=1e4,wT=1e3,vT=100;var Fp;(function(u){u[u.connecting=0]="connecting",u[u.open=1]="open",u[u.closing=2]="closing",u[u.closed=3]="closed"})(Fp||(Fp={}));var Ps;(function(u){u.closed="closed",u.errored="errored",u.joined="joined",u.joining="joining",u.leaving="leaving"})(Ps||(Ps={}));var $c;(function(u){u.close="phx_close",u.error="phx_error",u.join="phx_join",u.reply="phx_reply",u.leave="phx_leave",u.access_token="access_token"})($c||($c={}));var Zw;(function(u){u.websocket="websocket"})(Zw||(Zw={}));var Op;(function(u){u.Connecting="connecting",u.Open="open",u.Closing="closing",u.Closed="closed"})(Op||(Op={}));class bT{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(o,d){if(this._isArrayBuffer(o.payload))return d(this._binaryEncodePush(o));if(o.event===this.BROADCAST&&!(o.payload instanceof ArrayBuffer)&&typeof o.payload.event=="string")return d(this._binaryEncodeUserBroadcastPush(o));let g=[o.join_ref,o.ref,o.topic,o.event,o.payload];return d(JSON.stringify(g))}_binaryEncodePush(o){const{join_ref:d,ref:g,event:j,topic:Z,payload:S}=o,n=this.META_LENGTH+d.length+g.length+Z.length+j.length,B=new ArrayBuffer(this.HEADER_LENGTH+n);let D=new DataView(B),P=0;D.setUint8(P++,this.KINDS.push),D.setUint8(P++,d.length),D.setUint8(P++,g.length),D.setUint8(P++,Z.length),D.setUint8(P++,j.length),Array.from(d,Y=>D.setUint8(P++,Y.charCodeAt(0))),Array.from(g,Y=>D.setUint8(P++,Y.charCodeAt(0))),Array.from(Z,Y=>D.setUint8(P++,Y.charCodeAt(0))),Array.from(j,Y=>D.setUint8(P++,Y.charCodeAt(0)));var G=new Uint8Array(B.byteLength+S.byteLength);return G.set(new Uint8Array(B),0),G.set(new Uint8Array(S),B.byteLength),G.buffer}_binaryEncodeUserBroadcastPush(o){var d;return this._isArrayBuffer((d=o.payload)===null||d===void 0?void 0:d.payload)?this._encodeBinaryUserBroadcastPush(o):this._encodeJsonUserBroadcastPush(o)}_encodeBinaryUserBroadcastPush(o){var d,g;const{join_ref:j,ref:Z,topic:S}=o,n=o.payload.event,B=(g=(d=o.payload)===null||d===void 0?void 0:d.payload)!==null&&g!==void 0?g:new ArrayBuffer(0),D=this.USER_BROADCAST_PUSH_META_LENGTH+j.length+Z.length+S.length+n.length,P=new ArrayBuffer(this.HEADER_LENGTH+D);let G=new DataView(P),Y=0;G.setUint8(Y++,this.KINDS.userBroadcastPush),G.setUint8(Y++,j.length),G.setUint8(Y++,Z.length),G.setUint8(Y++,S.length),G.setUint8(Y++,n.length),G.setUint8(Y++,this.BINARY_ENCODING),Array.from(j,ue=>G.setUint8(Y++,ue.charCodeAt(0))),Array.from(Z,ue=>G.setUint8(Y++,ue.charCodeAt(0))),Array.from(S,ue=>G.setUint8(Y++,ue.charCodeAt(0))),Array.from(n,ue=>G.setUint8(Y++,ue.charCodeAt(0)));var X=new Uint8Array(P.byteLength+B.byteLength);return X.set(new Uint8Array(P),0),X.set(new Uint8Array(B),P.byteLength),X.buffer}_encodeJsonUserBroadcastPush(o){var d,g;const{join_ref:j,ref:Z,topic:S}=o,n=o.payload.event,B=(g=(d=o.payload)===null||d===void 0?void 0:d.payload)!==null&&g!==void 0?g:{},P=new TextEncoder().encode(JSON.stringify(B)).buffer,G=this.USER_BROADCAST_PUSH_META_LENGTH+j.length+Z.length+S.length+n.length,Y=new ArrayBuffer(this.HEADER_LENGTH+G);let X=new DataView(Y),ue=0;X.setUint8(ue++,this.KINDS.userBroadcastPush),X.setUint8(ue++,j.length),X.setUint8(ue++,Z.length),X.setUint8(ue++,S.length),X.setUint8(ue++,n.length),X.setUint8(ue++,this.JSON_ENCODING),Array.from(j,pe=>X.setUint8(ue++,pe.charCodeAt(0))),Array.from(Z,pe=>X.setUint8(ue++,pe.charCodeAt(0))),Array.from(S,pe=>X.setUint8(ue++,pe.charCodeAt(0))),Array.from(n,pe=>X.setUint8(ue++,pe.charCodeAt(0)));var oe=new Uint8Array(Y.byteLength+P.byteLength);return oe.set(new Uint8Array(Y),0),oe.set(new Uint8Array(P),Y.byteLength),oe.buffer}decode(o,d){if(this._isArrayBuffer(o)){let g=this._binaryDecode(o);return d(g)}if(typeof o=="string"){const g=JSON.parse(o),[j,Z,S,n,B]=g;return d({join_ref:j,ref:Z,topic:S,event:n,payload:B})}return d({})}_binaryDecode(o){const d=new DataView(o),g=d.getUint8(0),j=new TextDecoder;switch(g){case this.KINDS.push:return this._decodePush(o,d,j);case this.KINDS.reply:return this._decodeReply(o,d,j);case this.KINDS.broadcast:return this._decodeBroadcast(o,d,j);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(o,d,j)}}_decodePush(o,d,g){const j=d.getUint8(1),Z=d.getUint8(2),S=d.getUint8(3);let n=this.HEADER_LENGTH+this.META_LENGTH-1;const B=g.decode(o.slice(n,n+j));n=n+j;const D=g.decode(o.slice(n,n+Z));n=n+Z;const P=g.decode(o.slice(n,n+S));n=n+S;const G=JSON.parse(g.decode(o.slice(n,o.byteLength)));return{join_ref:B,ref:null,topic:D,event:P,payload:G}}_decodeReply(o,d,g){const j=d.getUint8(1),Z=d.getUint8(2),S=d.getUint8(3),n=d.getUint8(4);let B=this.HEADER_LENGTH+this.META_LENGTH;const D=g.decode(o.slice(B,B+j));B=B+j;const P=g.decode(o.slice(B,B+Z));B=B+Z;const G=g.decode(o.slice(B,B+S));B=B+S;const Y=g.decode(o.slice(B,B+n));B=B+n;const X=JSON.parse(g.decode(o.slice(B,o.byteLength))),ue={status:Y,response:X};return{join_ref:D,ref:P,topic:G,event:$c.reply,payload:ue}}_decodeBroadcast(o,d,g){const j=d.getUint8(1),Z=d.getUint8(2);let S=this.HEADER_LENGTH+2;const n=g.decode(o.slice(S,S+j));S=S+j;const B=g.decode(o.slice(S,S+Z));S=S+Z;const D=JSON.parse(g.decode(o.slice(S,o.byteLength)));return{join_ref:null,ref:null,topic:n,event:B,payload:D}}_decodeUserBroadcast(o,d,g){const j=d.getUint8(1),Z=d.getUint8(2),S=d.getUint8(3),n=d.getUint8(4);let B=this.HEADER_LENGTH+4;const D=g.decode(o.slice(B,B+j));B=B+j;const P=g.decode(o.slice(B,B+Z));B=B+Z;const G=g.decode(o.slice(B,B+S));B=B+S;const Y=o.slice(B,o.byteLength),X=n===this.JSON_ENCODING?JSON.parse(g.decode(Y)):Y,ue={type:this.BROADCAST,event:P,payload:X};return S>0&&(ue.meta=JSON.parse(G)),{join_ref:null,ref:null,topic:D,event:this.BROADCAST,payload:ue}}_isArrayBuffer(o){var d;return o instanceof ArrayBuffer||((d=o?.constructor)===null||d===void 0?void 0:d.name)==="ArrayBuffer"}}class EZ{constructor(o,d){this.callback=o,this.timerCalc=d,this.timer=void 0,this.tries=0,this.callback=o,this.timerCalc=d}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ai;(function(u){u.abstime="abstime",u.bool="bool",u.date="date",u.daterange="daterange",u.float4="float4",u.float8="float8",u.int2="int2",u.int4="int4",u.int4range="int4range",u.int8="int8",u.int8range="int8range",u.json="json",u.jsonb="jsonb",u.money="money",u.numeric="numeric",u.oid="oid",u.reltime="reltime",u.text="text",u.time="time",u.timestamp="timestamp",u.timestamptz="timestamptz",u.timetz="timetz",u.tsrange="tsrange",u.tstzrange="tstzrange"})(Ai||(Ai={}));const rL=(u,o,d={})=>{var g;const j=(g=d.skipTypes)!==null&&g!==void 0?g:[];return o?Object.keys(o).reduce((Z,S)=>(Z[S]=LT(S,u,o,j),Z),{}):{}},LT=(u,o,d,g)=>{const j=o.find(n=>n.name===u),Z=j?.type,S=d[u];return Z&&!g.includes(Z)?SZ(Z,S):Nw(S)},SZ=(u,o)=>{if(u.charAt(0)==="_"){const d=u.slice(1,u.length);return ET(o,d)}switch(u){case Ai.bool:return jT(o);case Ai.float4:case Ai.float8:case Ai.int2:case Ai.int4:case Ai.int8:case Ai.numeric:case Ai.oid:return ZT(o);case Ai.json:case Ai.jsonb:return NT(o);case Ai.timestamp:return ST(o);case Ai.abstime:case Ai.date:case Ai.daterange:case Ai.int4range:case Ai.int8range:case Ai.money:case Ai.reltime:case Ai.text:case Ai.time:case Ai.timestamptz:case Ai.timetz:case Ai.tsrange:case Ai.tstzrange:return Nw(o);default:return Nw(o)}},Nw=u=>u,jT=u=>{switch(u){case"t":return!0;case"f":return!1;default:return u}},ZT=u=>{if(typeof u=="string"){const o=parseFloat(u);if(!Number.isNaN(o))return o}return u},NT=u=>{if(typeof u=="string")try{return JSON.parse(u)}catch(o){return console.log(`JSON parse error: ${o}`),u}return u},ET=(u,o)=>{if(typeof u!="string")return u;const d=u.length-1,g=u[d];if(u[0]==="{"&&g==="}"){let Z;const S=u.slice(1,d);try{Z=JSON.parse("["+S+"]")}catch{Z=S?S.split(","):[]}return Z.map(n=>SZ(o,n))}return u},ST=u=>typeof u=="string"?u.replace(" ","T"):u,zZ=u=>{const o=new URL(u);return o.protocol=o.protocol.replace(/^ws/i,"http"),o.pathname=o.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),o.pathname===""||o.pathname==="/"?o.pathname="/api/broadcast":o.pathname=o.pathname+"/api/broadcast",o.href};class Px{constructor(o,d,g={},j=jw){this.channel=o,this.event=d,this.payload=g,this.timeout=j,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(o){this.timeout=o,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(o){this.payload=Object.assign(Object.assign({},this.payload),o)}receive(o,d){var g;return this._hasReceived(o)&&d((g=this.receivedResp)===null||g===void 0?void 0:g.response),this.recHooks.push({status:o,callback:d}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const o=d=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=d,this._matchReceive(d)};this.channel._on(this.refEvent,{},o),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(o,d){this.refEvent&&this.channel._trigger(this.refEvent,{status:o,response:d})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:o,response:d}){this.recHooks.filter(g=>g.status===o).forEach(g=>g.callback(d))}_hasReceived(o){return this.receivedResp&&this.receivedResp.status===o}}var nL;(function(u){u.SYNC="sync",u.JOIN="join",u.LEAVE="leave"})(nL||(nL={}));class cg{constructor(o,d){this.channel=o,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const g=d?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(g.state,{},j=>{const{onJoin:Z,onLeave:S,onSync:n}=this.caller;this.joinRef=this.channel._joinRef(),this.state=cg.syncState(this.state,j,Z,S),this.pendingDiffs.forEach(B=>{this.state=cg.syncDiff(this.state,B,Z,S)}),this.pendingDiffs=[],n()}),this.channel._on(g.diff,{},j=>{const{onJoin:Z,onLeave:S,onSync:n}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(j):(this.state=cg.syncDiff(this.state,j,Z,S),n())}),this.onJoin((j,Z,S)=>{this.channel._trigger("presence",{event:"join",key:j,currentPresences:Z,newPresences:S})}),this.onLeave((j,Z,S)=>{this.channel._trigger("presence",{event:"leave",key:j,currentPresences:Z,leftPresences:S})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(o,d,g,j){const Z=this.cloneDeep(o),S=this.transformState(d),n={},B={};return this.map(Z,(D,P)=>{S[D]||(B[D]=P)}),this.map(S,(D,P)=>{const G=Z[D];if(G){const Y=P.map(pe=>pe.presence_ref),X=G.map(pe=>pe.presence_ref),ue=P.filter(pe=>X.indexOf(pe.presence_ref)<0),oe=G.filter(pe=>Y.indexOf(pe.presence_ref)<0);ue.length>0&&(n[D]=ue),oe.length>0&&(B[D]=oe)}else n[D]=P}),this.syncDiff(Z,{joins:n,leaves:B},g,j)}static syncDiff(o,d,g,j){const{joins:Z,leaves:S}={joins:this.transformState(d.joins),leaves:this.transformState(d.leaves)};return g||(g=()=>{}),j||(j=()=>{}),this.map(Z,(n,B)=>{var D;const P=(D=o[n])!==null&&D!==void 0?D:[];if(o[n]=this.cloneDeep(B),P.length>0){const G=o[n].map(X=>X.presence_ref),Y=P.filter(X=>G.indexOf(X.presence_ref)<0);o[n].unshift(...Y)}g(n,P,B)}),this.map(S,(n,B)=>{let D=o[n];if(!D)return;const P=B.map(G=>G.presence_ref);D=D.filter(G=>P.indexOf(G.presence_ref)<0),o[n]=D,j(n,D,B),D.length===0&&delete o[n]}),o}static map(o,d){return Object.getOwnPropertyNames(o).map(g=>d(g,o[g]))}static transformState(o){return o=this.cloneDeep(o),Object.getOwnPropertyNames(o).reduce((d,g)=>{const j=o[g];return"metas"in j?d[g]=j.metas.map(Z=>(Z.presence_ref=Z.phx_ref,delete Z.phx_ref,delete Z.phx_ref_prev,Z)):d[g]=j,d},{})}static cloneDeep(o){return JSON.parse(JSON.stringify(o))}onJoin(o){this.caller.onJoin=o}onLeave(o){this.caller.onLeave=o}onSync(o){this.caller.onSync=o}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var iL;(function(u){u.ALL="*",u.INSERT="INSERT",u.UPDATE="UPDATE",u.DELETE="DELETE"})(iL||(iL={}));var ug;(function(u){u.BROADCAST="broadcast",u.PRESENCE="presence",u.POSTGRES_CHANGES="postgres_changes",u.SYSTEM="system"})(ug||(ug={}));var Wh;(function(u){u.SUBSCRIBED="SUBSCRIBED",u.TIMED_OUT="TIMED_OUT",u.CLOSED="CLOSED",u.CHANNEL_ERROR="CHANNEL_ERROR"})(Wh||(Wh={}));class nv{constructor(o,d={config:{}},g){var j,Z;if(this.topic=o,this.params=d,this.socket=g,this.bindings={},this.state=Ps.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=o.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},d.config),this.timeout=this.socket.timeout,this.joinPush=new Px(this,$c.join,this.params,this.timeout),this.rejoinTimer=new EZ(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ps.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(S=>S.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ps.closed,this.socket._remove(this)}),this._onError(S=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,S),this.state=Ps.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ps.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",S=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,S),this.state=Ps.errored,this.rejoinTimer.scheduleTimeout())}),this._on($c.reply,{},(S,n)=>{this._trigger(this._replyEventName(n),S)}),this.presence=new cg(this),this.broadcastEndpointURL=zZ(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((Z=(j=this.params.config)===null||j===void 0?void 0:j.broadcast)===null||Z===void 0)&&Z.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(o,d=this.timeout){var g,j,Z;if(this.socket.isConnected()||this.socket.connect(),this.state==Ps.closed){const{config:{broadcast:S,presence:n,private:B}}=this.params,D=(j=(g=this.bindings.postgres_changes)===null||g===void 0?void 0:g.map(X=>X.filter))!==null&&j!==void 0?j:[],P=!!this.bindings[ug.PRESENCE]&&this.bindings[ug.PRESENCE].length>0||((Z=this.params.config.presence)===null||Z===void 0?void 0:Z.enabled)===!0,G={},Y={broadcast:S,presence:Object.assign(Object.assign({},n),{enabled:P}),postgres_changes:D,private:B};this.socket.accessTokenValue&&(G.access_token=this.socket.accessTokenValue),this._onError(X=>o?.(Wh.CHANNEL_ERROR,X)),this._onClose(()=>o?.(Wh.CLOSED)),this.updateJoinPayload(Object.assign({config:Y},G)),this.joinedOnce=!0,this._rejoin(d),this.joinPush.receive("ok",async({postgres_changes:X})=>{var ue;if(this.socket.setAuth(),X===void 0){o?.(Wh.SUBSCRIBED);return}else{const oe=this.bindings.postgres_changes,pe=(ue=oe?.length)!==null&&ue!==void 0?ue:0,ve=[];for(let ke=0;ke<pe;ke++){const ye=oe[ke],{filter:{event:$e,schema:De,table:Te,filter:Qe}}=ye,Ft=X&&X[ke];if(Ft&&Ft.event===$e&&Ft.schema===De&&Ft.table===Te&&Ft.filter===Qe)ve.push(Object.assign(Object.assign({},ye),{id:Ft.id}));else{this.unsubscribe(),this.state=Ps.errored,o?.(Wh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=ve,o&&o(Wh.SUBSCRIBED);return}}).receive("error",X=>{this.state=Ps.errored,o?.(Wh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(X).join(", ")||"error")))}).receive("timeout",()=>{o?.(Wh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(o,d={}){return await this.send({type:"presence",event:"track",payload:o},d.timeout||this.timeout)}async untrack(o={}){return await this.send({type:"presence",event:"untrack"},o)}on(o,d,g){return this.state===Ps.joined&&o===ug.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(o,d,g)}async httpSend(o,d,g={}){var j;const Z=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(d==null)return Promise.reject("Payload is required for httpSend()");const S={method:"POST",headers:{Authorization:Z,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:d,private:this.private}]})},n=await this._fetchWithTimeout(this.broadcastEndpointURL,S,(j=g.timeout)!==null&&j!==void 0?j:this.timeout);if(n.status===202)return{success:!0};let B=n.statusText;try{const D=await n.json();B=D.error||D.message||B}catch{}return Promise.reject(new Error(B))}async send(o,d={}){var g,j;if(!this._canPush()&&o.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:Z,payload:S}=o,B={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:Z,payload:S,private:this.private}]})};try{const D=await this._fetchWithTimeout(this.broadcastEndpointURL,B,(g=d.timeout)!==null&&g!==void 0?g:this.timeout);return await((j=D.body)===null||j===void 0?void 0:j.cancel()),D.ok?"ok":"error"}catch(D){return D.name==="AbortError"?"timed out":"error"}}else return new Promise(Z=>{var S,n,B;const D=this._push(o.type,o,d.timeout||this.timeout);o.type==="broadcast"&&!(!((B=(n=(S=this.params)===null||S===void 0?void 0:S.config)===null||n===void 0?void 0:n.broadcast)===null||B===void 0)&&B.ack)&&Z("ok"),D.receive("ok",()=>Z("ok")),D.receive("error",()=>Z("error")),D.receive("timeout",()=>Z("timed out"))})}updateJoinPayload(o){this.joinPush.updatePayload(o)}unsubscribe(o=this.timeout){this.state=Ps.leaving;const d=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger($c.close,"leave",this._joinRef())};this.joinPush.destroy();let g=null;return new Promise(j=>{g=new Px(this,$c.leave,{},o),g.receive("ok",()=>{d(),j("ok")}).receive("timeout",()=>{d(),j("timed out")}).receive("error",()=>{j("error")}),g.send(),this._canPush()||g.trigger("ok",{})}).finally(()=>{g?.destroy()})}teardown(){this.pushBuffer.forEach(o=>o.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ps.closed,this.bindings={}}async _fetchWithTimeout(o,d,g){const j=new AbortController,Z=setTimeout(()=>j.abort(),g),S=await this.socket.fetch(o,Object.assign(Object.assign({},d),{signal:j.signal}));return clearTimeout(Z),S}_push(o,d,g=this.timeout){if(!this.joinedOnce)throw`tried to push '${o}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let j=new Px(this,o,d,g);return this._canPush()?j.send():this._addToPushBuffer(j),j}_addToPushBuffer(o){if(o.startTimeout(),this.pushBuffer.push(o),this.pushBuffer.length>vT){const d=this.pushBuffer.shift();d&&(d.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${d.event}`,d.payload))}}_onMessage(o,d,g){return d}_isMember(o){return this.topic===o}_joinRef(){return this.joinPush.ref}_trigger(o,d,g){var j,Z;const S=o.toLocaleLowerCase(),{close:n,error:B,leave:D,join:P}=$c;if(g&&[n,B,D,P].indexOf(S)>=0&&g!==this._joinRef())return;let Y=this._onMessage(S,d,g);if(d&&!Y)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(S)?(j=this.bindings.postgres_changes)===null||j===void 0||j.filter(X=>{var ue,oe,pe;return((ue=X.filter)===null||ue===void 0?void 0:ue.event)==="*"||((pe=(oe=X.filter)===null||oe===void 0?void 0:oe.event)===null||pe===void 0?void 0:pe.toLocaleLowerCase())===S}).map(X=>X.callback(Y,g)):(Z=this.bindings[S])===null||Z===void 0||Z.filter(X=>{var ue,oe,pe,ve,ke,ye;if(["broadcast","presence","postgres_changes"].includes(S))if("id"in X){const $e=X.id,De=(ue=X.filter)===null||ue===void 0?void 0:ue.event;return $e&&((oe=d.ids)===null||oe===void 0?void 0:oe.includes($e))&&(De==="*"||De?.toLocaleLowerCase()===((pe=d.data)===null||pe===void 0?void 0:pe.type.toLocaleLowerCase()))}else{const $e=(ke=(ve=X?.filter)===null||ve===void 0?void 0:ve.event)===null||ke===void 0?void 0:ke.toLocaleLowerCase();return $e==="*"||$e===((ye=d?.event)===null||ye===void 0?void 0:ye.toLocaleLowerCase())}else return X.type.toLocaleLowerCase()===S}).map(X=>{if(typeof Y=="object"&&"ids"in Y){const ue=Y.data,{schema:oe,table:pe,commit_timestamp:ve,type:ke,errors:ye}=ue;Y=Object.assign(Object.assign({},{schema:oe,table:pe,commit_timestamp:ve,eventType:ke,new:{},old:{},errors:ye}),this._getPayloadRecords(ue))}X.callback(Y,g)})}_isClosed(){return this.state===Ps.closed}_isJoined(){return this.state===Ps.joined}_isJoining(){return this.state===Ps.joining}_isLeaving(){return this.state===Ps.leaving}_replyEventName(o){return`chan_reply_${o}`}_on(o,d,g){const j=o.toLocaleLowerCase(),Z={type:j,filter:d,callback:g};return this.bindings[j]?this.bindings[j].push(Z):this.bindings[j]=[Z],this}_off(o,d){const g=o.toLocaleLowerCase();return this.bindings[g]&&(this.bindings[g]=this.bindings[g].filter(j=>{var Z;return!(((Z=j.type)===null||Z===void 0?void 0:Z.toLocaleLowerCase())===g&&nv.isEqual(j.filter,d))})),this}static isEqual(o,d){if(Object.keys(o).length!==Object.keys(d).length)return!1;for(const g in o)if(o[g]!==d[g])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(o){this._on($c.close,{},o)}_onError(o){this._on($c.error,{},d=>o(d))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(o=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ps.joining,this.joinPush.resend(o))}_getPayloadRecords(o){const d={new:{},old:{}};return(o.type==="INSERT"||o.type==="UPDATE")&&(d.new=rL(o.columns,o.record)),(o.type==="UPDATE"||o.type==="DELETE")&&(d.old=rL(o.columns,o.old_record)),d}}const Gx=()=>{},T0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},zT=[1e3,2e3,5e3,1e4],AT=1e4,RT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class TT{constructor(o,d){var g;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=jw,this.transport=null,this.heartbeatIntervalMs=T0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Gx,this.ref=0,this.reconnectTimer=null,this.vsn=aL,this.logger=Gx,this.conn=null,this.sendBuffer=[],this.serializer=new bT,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=j=>j?(...Z)=>j(...Z):(...Z)=>fetch(...Z),!(!((g=d?.params)===null||g===void 0)&&g.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=d.params.apikey,this.endPoint=`${o}/${Zw.websocket}`,this.httpEndpoint=zZ(o),this._initializeOptions(d),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(d?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=yT.createWebSocket(this.endpointURL())}catch(o){this._setConnectionState("disconnected");const d=o.message;throw d.includes("Node.js")?new Error(`${d}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${d}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(o,d){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const g=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(g),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(o?this.conn.close(o,d??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(o){const d=await o.unsubscribe();return this.channels.length===0&&this.disconnect(),d}async removeAllChannels(){const o=await Promise.all(this.channels.map(d=>d.unsubscribe()));return this.channels=[],this.disconnect(),o}log(o,d,g){this.logger(o,d,g)}connectionState(){switch(this.conn&&this.conn.readyState){case Fp.connecting:return Op.Connecting;case Fp.open:return Op.Open;case Fp.closing:return Op.Closing;default:return Op.Closed}}isConnected(){return this.connectionState()===Op.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(o,d={config:{}}){const g=`realtime:${o}`,j=this.getChannels().find(Z=>Z.topic===g);if(j)return j;{const Z=new nv(`realtime:${o}`,d,this);return this.channels.push(Z),Z}}push(o){const{topic:d,event:g,payload:j,ref:Z}=o,S=()=>{this.encode(o,n=>{var B;(B=this.conn)===null||B===void 0||B.send(n)})};this.log("push",`${d} ${g} (${Z})`,j),this.isConnected()?S():this.sendBuffer.push(S)}async setAuth(o=null){this._authPromise=this._performAuth(o);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var o;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(d){this.log("error","error in heartbeat callback",d)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(d){this.log("error","error in heartbeat callback",d)}this._wasManualDisconnect=!1,(o=this.conn)===null||o===void 0||o.close(wT,"heartbeat timeout"),setTimeout(()=>{var d;this.isConnected()||(d=this.reconnectTimer)===null||d===void 0||d.scheduleTimeout()},T0.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(d){this.log("error","error in heartbeat callback",d)}this._setAuthSafely("heartbeat")}onHeartbeat(o){this.heartbeatCallback=o}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(o=>o()),this.sendBuffer=[])}_makeRef(){let o=this.ref+1;return o===this.ref?this.ref=0:this.ref=o,this.ref.toString()}_leaveOpenTopic(o){let d=this.channels.find(g=>g.topic===o&&(g._isJoined()||g._isJoining()));d&&(this.log("transport",`leaving duplicate topic "${o}"`),d.unsubscribe())}_remove(o){this.channels=this.channels.filter(d=>d.topic!==o.topic)}_onConnMessage(o){this.decode(o.data,d=>{if(d.topic==="phoenix"&&d.event==="phx_reply")try{this.heartbeatCallback(d.payload.status==="ok"?"ok":"error")}catch(D){this.log("error","error in heartbeat callback",D)}d.ref&&d.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:g,event:j,payload:Z,ref:S}=d,n=S?`(${S})`:"",B=Z.status||"";this.log("receive",`${B} ${g} ${j} ${n}`.trim(),Z),this.channels.filter(D=>D._isMember(g)).forEach(D=>D._trigger(j,Z,S)),this._triggerStateCallbacks("message",d)})}_clearTimer(o){var d;o==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):o==="reconnect"&&((d=this.reconnectTimer)===null||d===void 0||d.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=o=>this._onConnError(o),this.conn.onmessage=o=>this._onConnMessage(o),this.conn.onclose=o=>this._onConnClose(o))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Fp.open||this.conn.readyState===Fp.connecting)try{this.conn.close()}catch(o){this.log("error","Error closing connection",o)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(o=>o.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(d=>{this.log("error","error waiting for auth on connect",d),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const o=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(o),this.workerRef.onerror=d=>{this.log("worker","worker error",d.message),this.workerRef.terminate()},this.workerRef.onmessage=d=>{d.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(o){var d;this._setConnectionState("disconnected"),this.log("transport","close",o),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(d=this.reconnectTimer)===null||d===void 0||d.scheduleTimeout(),this._triggerStateCallbacks("close",o)}_onConnError(o){this._setConnectionState("disconnected"),this.log("transport",`${o}`),this._triggerChanError(),this._triggerStateCallbacks("error",o)}_triggerChanError(){this.channels.forEach(o=>o._trigger($c.error))}_appendParams(o,d){if(Object.keys(d).length===0)return o;const g=o.match(/\?/)?"&":"?",j=new URLSearchParams(d);return`${o}${g}${j}`}_workerObjectUrl(o){let d;if(o)d=o;else{const g=new Blob([RT],{type:"application/javascript"});d=URL.createObjectURL(g)}return d}_setConnectionState(o,d=!1){this._connectionState=o,o==="connecting"?this._wasManualDisconnect=!1:o==="disconnecting"&&(this._wasManualDisconnect=d)}async _performAuth(o=null){let d;o?d=o:this.accessToken?d=await this.accessToken():d=this.accessTokenValue,this.accessTokenValue!=d&&(this.accessTokenValue=d,this.channels.forEach(g=>{const j={access_token:d,version:_T};d&&g.updateJoinPayload(j),g.joinedOnce&&g._isJoined()&&g._push($c.access_token,{access_token:d})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(o="general"){this.setAuth().catch(d=>{this.log("error",`error setting auth in ${o}`,d)})}_triggerStateCallbacks(o,d){try{this.stateChangeCallbacks[o].forEach(g=>{try{g(d)}catch(j){this.log("error",`error in ${o} callback`,j)}})}catch(g){this.log("error",`error triggering ${o} callbacks`,g)}}_setupReconnectionTimer(){this.reconnectTimer=new EZ(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},T0.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(o){var d,g,j,Z,S,n,B,D,P,G,Y,X;switch(this.transport=(d=o?.transport)!==null&&d!==void 0?d:null,this.timeout=(g=o?.timeout)!==null&&g!==void 0?g:jw,this.heartbeatIntervalMs=(j=o?.heartbeatIntervalMs)!==null&&j!==void 0?j:T0.HEARTBEAT_INTERVAL,this.worker=(Z=o?.worker)!==null&&Z!==void 0?Z:!1,this.accessToken=(S=o?.accessToken)!==null&&S!==void 0?S:null,this.heartbeatCallback=(n=o?.heartbeatCallback)!==null&&n!==void 0?n:Gx,this.vsn=(B=o?.vsn)!==null&&B!==void 0?B:aL,o?.params&&(this.params=o.params),o?.logger&&(this.logger=o.logger),(o?.logLevel||o?.log_level)&&(this.logLevel=o.logLevel||o.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(D=o?.reconnectAfterMs)!==null&&D!==void 0?D:ue=>zT[ue-1]||AT,this.vsn){case NZ:this.encode=(P=o?.encode)!==null&&P!==void 0?P:(ue,oe)=>oe(JSON.stringify(ue)),this.decode=(G=o?.decode)!==null&&G!==void 0?G:(ue,oe)=>oe(JSON.parse(ue));break;case xT:this.encode=(Y=o?.encode)!==null&&Y!==void 0?Y:this.serializer.encode.bind(this.serializer),this.decode=(X=o?.decode)!==null&&X!==void 0?X:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=o?.workerUrl}}}class iv extends Error{constructor(o){super(o),this.__isStorageError=!0,this.name="StorageError"}}function es(u){return typeof u=="object"&&u!==null&&"__isStorageError"in u}class VT extends iv{constructor(o,d,g){super(o),this.name="StorageApiError",this.status=d,this.statusCode=g}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ew extends iv{constructor(o,d){super(o),this.name="StorageUnknownError",this.originalError=d}}const sv=u=>u?(...o)=>u(...o):(...o)=>fetch(...o),MT=()=>Response,Sw=u=>{if(Array.isArray(u))return u.map(d=>Sw(d));if(typeof u=="function"||u!==Object(u))return u;const o={};return Object.entries(u).forEach(([d,g])=>{const j=d.replace(/([-_][a-z])/gi,Z=>Z.toUpperCase().replace(/[-_]/g,""));o[j]=Sw(g)}),o},BT=u=>{if(typeof u!="object"||u===null)return!1;const o=Object.getPrototypeOf(u);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in u)&&!(Symbol.iterator in u)},Ux=u=>{var o;return u.msg||u.message||u.error_description||(typeof u.error=="string"?u.error:(o=u.error)===null||o===void 0?void 0:o.message)||JSON.stringify(u)},IT=(u,o,d)=>ur(void 0,void 0,void 0,function*(){const g=yield MT();u instanceof g&&!d?.noResolveJson?u.json().then(j=>{const Z=u.status||500,S=j?.statusCode||Z+"";o(new VT(Ux(j),Z,S))}).catch(j=>{o(new Ew(Ux(j),j))}):o(new Ew(Ux(u),u))}),kT=(u,o,d,g)=>{const j={method:u,headers:o?.headers||{}};return u==="GET"||!g?j:(BT(g)?(j.headers=Object.assign({"Content-Type":"application/json"},o?.headers),j.body=JSON.stringify(g)):j.body=g,o?.duplex&&(j.duplex=o.duplex),Object.assign(Object.assign({},j),d))};function Sg(u,o,d,g,j,Z){return ur(this,void 0,void 0,function*(){return new Promise((S,n)=>{u(d,kT(o,g,j,Z)).then(B=>{if(!B.ok)throw B;return g?.noResolveJson?B:B.json()}).then(B=>S(B)).catch(B=>IT(B,n,g))})})}function _g(u,o,d,g){return ur(this,void 0,void 0,function*(){return Sg(u,"GET",o,d,g)})}function Hu(u,o,d,g,j){return ur(this,void 0,void 0,function*(){return Sg(u,"POST",o,g,j,d)})}function zw(u,o,d,g,j){return ur(this,void 0,void 0,function*(){return Sg(u,"PUT",o,g,j,d)})}function JT(u,o,d,g){return ur(this,void 0,void 0,function*(){return Sg(u,"HEAD",o,Object.assign(Object.assign({},d),{noResolveJson:!0}),g)})}function ov(u,o,d,g,j){return ur(this,void 0,void 0,function*(){return Sg(u,"DELETE",o,g,j,d)})}class FT{constructor(o,d){this.downloadFn=o,this.shouldThrowOnError=d}then(o,d){return this.execute().then(o,d)}execute(){return ur(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(es(o))return{data:null,error:o};throw o}})}}var AZ;class OT{constructor(o,d){this.downloadFn=o,this.shouldThrowOnError=d,this[AZ]="BlobDownloadBuilder",this.promise=null}asStream(){return new FT(this.downloadFn,this.shouldThrowOnError)}then(o,d){return this.getPromise().then(o,d)}catch(o){return this.getPromise().catch(o)}finally(o){return this.getPromise().finally(o)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return ur(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(es(o))return{data:null,error:o};throw o}})}}AZ=Symbol.toStringTag;const DT={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},sL={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class CT{constructor(o,d={},g,j){this.shouldThrowOnError=!1,this.url=o,this.headers=d,this.bucketId=g,this.fetch=sv(j)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(o,d,g,j){return ur(this,void 0,void 0,function*(){try{let Z;const S=Object.assign(Object.assign({},sL),j);let n=Object.assign(Object.assign({},this.headers),o==="POST"&&{"x-upsert":String(S.upsert)});const B=S.metadata;typeof Blob<"u"&&g instanceof Blob?(Z=new FormData,Z.append("cacheControl",S.cacheControl),B&&Z.append("metadata",this.encodeMetadata(B)),Z.append("",g)):typeof FormData<"u"&&g instanceof FormData?(Z=g,Z.has("cacheControl")||Z.append("cacheControl",S.cacheControl),B&&!Z.has("metadata")&&Z.append("metadata",this.encodeMetadata(B))):(Z=g,n["cache-control"]=`max-age=${S.cacheControl}`,n["content-type"]=S.contentType,B&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(B))),(typeof ReadableStream<"u"&&Z instanceof ReadableStream||Z&&typeof Z=="object"&&"pipe"in Z&&typeof Z.pipe=="function")&&!S.duplex&&(S.duplex="half")),j?.headers&&(n=Object.assign(Object.assign({},n),j.headers));const D=this._removeEmptyFolders(d),P=this._getFinalPath(D),G=yield(o=="PUT"?zw:Hu)(this.fetch,`${this.url}/object/${P}`,Z,Object.assign({headers:n},S?.duplex?{duplex:S.duplex}:{}));return{data:{path:D,id:G.Id,fullPath:G.Key},error:null}}catch(Z){if(this.shouldThrowOnError)throw Z;if(es(Z))return{data:null,error:Z};throw Z}})}upload(o,d,g){return ur(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",o,d,g)})}uploadToSignedUrl(o,d,g,j){return ur(this,void 0,void 0,function*(){const Z=this._removeEmptyFolders(o),S=this._getFinalPath(Z),n=new URL(this.url+`/object/upload/sign/${S}`);n.searchParams.set("token",d);try{let B;const D=Object.assign({upsert:sL.upsert},j),P=Object.assign(Object.assign({},this.headers),{"x-upsert":String(D.upsert)});typeof Blob<"u"&&g instanceof Blob?(B=new FormData,B.append("cacheControl",D.cacheControl),B.append("",g)):typeof FormData<"u"&&g instanceof FormData?(B=g,B.append("cacheControl",D.cacheControl)):(B=g,P["cache-control"]=`max-age=${D.cacheControl}`,P["content-type"]=D.contentType);const G=yield zw(this.fetch,n.toString(),B,{headers:P});return{data:{path:Z,fullPath:G.Key},error:null}}catch(B){if(this.shouldThrowOnError)throw B;if(es(B))return{data:null,error:B};throw B}})}createSignedUploadUrl(o,d){return ur(this,void 0,void 0,function*(){try{let g=this._getFinalPath(o);const j=Object.assign({},this.headers);d?.upsert&&(j["x-upsert"]="true");const Z=yield Hu(this.fetch,`${this.url}/object/upload/sign/${g}`,{},{headers:j}),S=new URL(this.url+Z.url),n=S.searchParams.get("token");if(!n)throw new iv("No token returned by API");return{data:{signedUrl:S.toString(),path:o,token:n},error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(es(g))return{data:null,error:g};throw g}})}update(o,d,g){return ur(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",o,d,g)})}move(o,d,g){return ur(this,void 0,void 0,function*(){try{return{data:yield Hu(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:o,destinationKey:d,destinationBucket:g?.destinationBucket},{headers:this.headers}),error:null}}catch(j){if(this.shouldThrowOnError)throw j;if(es(j))return{data:null,error:j};throw j}})}copy(o,d,g){return ur(this,void 0,void 0,function*(){try{return{data:{path:(yield Hu(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:o,destinationKey:d,destinationBucket:g?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(j){if(this.shouldThrowOnError)throw j;if(es(j))return{data:null,error:j};throw j}})}createSignedUrl(o,d,g){return ur(this,void 0,void 0,function*(){try{let j=this._getFinalPath(o),Z=yield Hu(this.fetch,`${this.url}/object/sign/${j}`,Object.assign({expiresIn:d},g?.transform?{transform:g.transform}:{}),{headers:this.headers});const S=g?.download?`&download=${g.download===!0?"":g.download}`:"";return Z={signedUrl:encodeURI(`${this.url}${Z.signedURL}${S}`)},{data:Z,error:null}}catch(j){if(this.shouldThrowOnError)throw j;if(es(j))return{data:null,error:j};throw j}})}createSignedUrls(o,d,g){return ur(this,void 0,void 0,function*(){try{const j=yield Hu(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:d,paths:o},{headers:this.headers}),Z=g?.download?`&download=${g.download===!0?"":g.download}`:"";return{data:j.map(S=>Object.assign(Object.assign({},S),{signedUrl:S.signedURL?encodeURI(`${this.url}${S.signedURL}${Z}`):null})),error:null}}catch(j){if(this.shouldThrowOnError)throw j;if(es(j))return{data:null,error:j};throw j}})}download(o,d){const j=typeof d?.transform<"u"?"render/image/authenticated":"object",Z=this.transformOptsToQueryString(d?.transform||{}),S=Z?`?${Z}`:"",n=this._getFinalPath(o),B=()=>_g(this.fetch,`${this.url}/${j}/${n}${S}`,{headers:this.headers,noResolveJson:!0});return new OT(B,this.shouldThrowOnError)}info(o){return ur(this,void 0,void 0,function*(){const d=this._getFinalPath(o);try{const g=yield _g(this.fetch,`${this.url}/object/info/${d}`,{headers:this.headers});return{data:Sw(g),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(es(g))return{data:null,error:g};throw g}})}exists(o){return ur(this,void 0,void 0,function*(){const d=this._getFinalPath(o);try{return yield JT(this.fetch,`${this.url}/object/${d}`,{headers:this.headers}),{data:!0,error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(es(g)&&g instanceof Ew){const j=g.originalError;if([400,404].includes(j?.status))return{data:!1,error:g}}throw g}})}getPublicUrl(o,d){const g=this._getFinalPath(o),j=[],Z=d?.download?`download=${d.download===!0?"":d.download}`:"";Z!==""&&j.push(Z);const n=typeof d?.transform<"u"?"render/image":"object",B=this.transformOptsToQueryString(d?.transform||{});B!==""&&j.push(B);let D=j.join("&");return D!==""&&(D=`?${D}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${g}${D}`)}}}remove(o){return ur(this,void 0,void 0,function*(){try{return{data:yield ov(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:o},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}list(o,d,g){return ur(this,void 0,void 0,function*(){try{const j=Object.assign(Object.assign(Object.assign({},DT),d),{prefix:o||""});return{data:yield Hu(this.fetch,`${this.url}/object/list/${this.bucketId}`,j,{headers:this.headers},g),error:null}}catch(j){if(this.shouldThrowOnError)throw j;if(es(j))return{data:null,error:j};throw j}})}listV2(o,d){return ur(this,void 0,void 0,function*(){try{const g=Object.assign({},o);return{data:yield Hu(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,g,{headers:this.headers},d),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(es(g))return{data:null,error:g};throw g}})}encodeMetadata(o){return JSON.stringify(o)}toBase64(o){return typeof Buffer<"u"?Buffer.from(o).toString("base64"):btoa(o)}_getFinalPath(o){return`${this.bucketId}/${o.replace(/^\/+/,"")}`}_removeEmptyFolders(o){return o.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(o){const d=[];return o.width&&d.push(`width=${o.width}`),o.height&&d.push(`height=${o.height}`),o.resize&&d.push(`resize=${o.resize}`),o.format&&d.push(`format=${o.format}`),o.quality&&d.push(`quality=${o.quality}`),d.join("&")}}const RZ="2.81.1",TZ={"X-Client-Info":`storage-js/${RZ}`};class PT{constructor(o,d={},g,j){this.shouldThrowOnError=!1;const Z=new URL(o);j?.useNewHostname&&/supabase\.(co|in|red)$/.test(Z.hostname)&&!Z.hostname.includes("storage.supabase.")&&(Z.hostname=Z.hostname.replace("supabase.","storage.supabase.")),this.url=Z.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},TZ),d),this.fetch=sv(g)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(o){return ur(this,void 0,void 0,function*(){try{const d=this.listBucketOptionsToQueryString(o);return{data:yield _g(this.fetch,`${this.url}/bucket${d}`,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}getBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:yield _g(this.fetch,`${this.url}/bucket/${o}`,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}createBucket(o){return ur(this,arguments,void 0,function*(d,g={public:!1}){try{return{data:yield Hu(this.fetch,`${this.url}/bucket`,{id:d,name:d,type:g.type,public:g.public,file_size_limit:g.fileSizeLimit,allowed_mime_types:g.allowedMimeTypes},{headers:this.headers}),error:null}}catch(j){if(this.shouldThrowOnError)throw j;if(es(j))return{data:null,error:j};throw j}})}updateBucket(o,d){return ur(this,void 0,void 0,function*(){try{return{data:yield zw(this.fetch,`${this.url}/bucket/${o}`,{id:o,name:o,public:d.public,file_size_limit:d.fileSizeLimit,allowed_mime_types:d.allowedMimeTypes},{headers:this.headers}),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(es(g))return{data:null,error:g};throw g}})}emptyBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:yield Hu(this.fetch,`${this.url}/bucket/${o}/empty`,{},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}deleteBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:yield ov(this.fetch,`${this.url}/bucket/${o}`,{},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}listBucketOptionsToQueryString(o){const d={};return o&&("limit"in o&&(d.limit=String(o.limit)),"offset"in o&&(d.offset=String(o.offset)),o.search&&(d.search=o.search),o.sortColumn&&(d.sortColumn=o.sortColumn),o.sortOrder&&(d.sortOrder=o.sortOrder)),Object.keys(d).length>0?"?"+new URLSearchParams(d).toString():""}}class GT{constructor(o,d={},g){this.shouldThrowOnError=!1,this.url=o.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},TZ),d),this.fetch=sv(g)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:yield Hu(this.fetch,`${this.url}/bucket`,{name:o},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}listBuckets(o){return ur(this,void 0,void 0,function*(){try{const d=new URLSearchParams;o?.limit!==void 0&&d.set("limit",o.limit.toString()),o?.offset!==void 0&&d.set("offset",o.offset.toString()),o?.sortColumn&&d.set("sortColumn",o.sortColumn),o?.sortOrder&&d.set("sortOrder",o.sortOrder),o?.search&&d.set("search",o.search);const g=d.toString(),j=g?`${this.url}/bucket?${g}`:`${this.url}/bucket`;return{data:yield _g(this.fetch,j,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}deleteBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:yield ov(this.fetch,`${this.url}/bucket/${o}`,{},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(es(d))return{data:null,error:d};throw d}})}}const lv={"X-Client-Info":`storage-js/${RZ}`,"Content-Type":"application/json"};class VZ extends Error{constructor(o){super(o),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function xc(u){return typeof u=="object"&&u!==null&&"__isStorageVectorsError"in u}class Wx extends VZ{constructor(o,d,g){super(o),this.name="StorageVectorsApiError",this.status=d,this.statusCode=g}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class UT extends VZ{constructor(o,d){super(o),this.name="StorageVectorsUnknownError",this.originalError=d}}var oL;(function(u){u.InternalError="InternalError",u.S3VectorConflictException="S3VectorConflictException",u.S3VectorNotFoundException="S3VectorNotFoundException",u.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",u.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",u.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(oL||(oL={}));const cv=u=>u?(...o)=>u(...o):(...o)=>fetch(...o),WT=u=>{if(typeof u!="object"||u===null)return!1;const o=Object.getPrototypeOf(u);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in u)&&!(Symbol.iterator in u)},lL=u=>u.msg||u.message||u.error_description||u.error||JSON.stringify(u),XT=(u,o,d)=>ur(void 0,void 0,void 0,function*(){if(u&&typeof u=="object"&&"status"in u&&"ok"in u&&typeof u.status=="number"&&!d?.noResolveJson){const j=u.status||500,Z=u;if(typeof Z.json=="function")Z.json().then(S=>{const n=S?.statusCode||S?.code||j+"";o(new Wx(lL(S),j,n))}).catch(()=>{const S=j+"",n=Z.statusText||`HTTP ${j} error`;o(new Wx(n,j,S))});else{const S=j+"",n=Z.statusText||`HTTP ${j} error`;o(new Wx(n,j,S))}}else o(new UT(lL(u),u))}),QT=(u,o,d,g)=>{const j={method:u,headers:o?.headers||{}};return g?(WT(g)?(j.headers=Object.assign({"Content-Type":"application/json"},o?.headers),j.body=JSON.stringify(g)):j.body=g,Object.assign(Object.assign({},j),d)):j};function HT(u,o,d,g,j,Z){return ur(this,void 0,void 0,function*(){return new Promise((S,n)=>{u(d,QT(o,g,j,Z)).then(B=>{if(!B.ok)throw B;if(g?.noResolveJson)return B;const D=B.headers.get("content-type");return!D||!D.includes("application/json")?{}:B.json()}).then(B=>S(B)).catch(B=>XT(B,n,g))})})}function wc(u,o,d,g,j){return ur(this,void 0,void 0,function*(){return HT(u,"POST",o,g,j,d)})}class YT{constructor(o,d={},g){this.shouldThrowOnError=!1,this.url=o.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lv),d),this.fetch=cv(g)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(o){return ur(this,void 0,void 0,function*(){try{return{data:(yield wc(this.fetch,`${this.url}/CreateIndex`,o,{headers:this.headers}))||{},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}getIndex(o,d){return ur(this,void 0,void 0,function*(){try{return{data:yield wc(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:o,indexName:d},{headers:this.headers}),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(xc(g))return{data:null,error:g};throw g}})}listIndexes(o){return ur(this,void 0,void 0,function*(){try{return{data:yield wc(this.fetch,`${this.url}/ListIndexes`,o,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}deleteIndex(o,d){return ur(this,void 0,void 0,function*(){try{return{data:(yield wc(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:o,indexName:d},{headers:this.headers}))||{},error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(xc(g))return{data:null,error:g};throw g}})}}class $T{constructor(o,d={},g){this.shouldThrowOnError=!1,this.url=o.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lv),d),this.fetch=cv(g)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(o){return ur(this,void 0,void 0,function*(){try{if(o.vectors.length<1||o.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield wc(this.fetch,`${this.url}/PutVectors`,o,{headers:this.headers}))||{},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}getVectors(o){return ur(this,void 0,void 0,function*(){try{return{data:yield wc(this.fetch,`${this.url}/GetVectors`,o,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}listVectors(o){return ur(this,void 0,void 0,function*(){try{if(o.segmentCount!==void 0){if(o.segmentCount<1||o.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(o.segmentIndex!==void 0&&(o.segmentIndex<0||o.segmentIndex>=o.segmentCount))throw new Error(`segmentIndex must be between 0 and ${o.segmentCount-1}`)}return{data:yield wc(this.fetch,`${this.url}/ListVectors`,o,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}queryVectors(o){return ur(this,void 0,void 0,function*(){try{return{data:yield wc(this.fetch,`${this.url}/QueryVectors`,o,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}deleteVectors(o){return ur(this,void 0,void 0,function*(){try{if(o.keys.length<1||o.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield wc(this.fetch,`${this.url}/DeleteVectors`,o,{headers:this.headers}))||{},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}}class qT{constructor(o,d={},g){this.shouldThrowOnError=!1,this.url=o.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lv),d),this.fetch=cv(g)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:(yield wc(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:o},{headers:this.headers}))||{},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}getBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:yield wc(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:o},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}listBuckets(){return ur(this,arguments,void 0,function*(o={}){try{return{data:yield wc(this.fetch,`${this.url}/ListVectorBuckets`,o,{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}deleteBucket(o){return ur(this,void 0,void 0,function*(){try{return{data:(yield wc(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:o},{headers:this.headers}))||{},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(xc(d))return{data:null,error:d};throw d}})}}class KT extends qT{constructor(o,d={}){super(o,d.headers||{},d.fetch)}from(o){return new eV(this.url,this.headers,o,this.fetch)}}class eV extends YT{constructor(o,d,g,j){super(o,d,j),this.vectorBucketName=g}createIndex(o){const d=Object.create(null,{createIndex:{get:()=>super.createIndex}});return ur(this,void 0,void 0,function*(){return d.createIndex.call(this,Object.assign(Object.assign({},o),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const o=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return ur(this,arguments,void 0,function*(d={}){return o.listIndexes.call(this,Object.assign(Object.assign({},d),{vectorBucketName:this.vectorBucketName}))})}getIndex(o){const d=Object.create(null,{getIndex:{get:()=>super.getIndex}});return ur(this,void 0,void 0,function*(){return d.getIndex.call(this,this.vectorBucketName,o)})}deleteIndex(o){const d=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return ur(this,void 0,void 0,function*(){return d.deleteIndex.call(this,this.vectorBucketName,o)})}index(o){return new tV(this.url,this.headers,this.vectorBucketName,o,this.fetch)}}class tV extends $T{constructor(o,d,g,j,Z){super(o,d,Z),this.vectorBucketName=g,this.indexName=j}putVectors(o){const d=Object.create(null,{putVectors:{get:()=>super.putVectors}});return ur(this,void 0,void 0,function*(){return d.putVectors.call(this,Object.assign(Object.assign({},o),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(o){const d=Object.create(null,{getVectors:{get:()=>super.getVectors}});return ur(this,void 0,void 0,function*(){return d.getVectors.call(this,Object.assign(Object.assign({},o),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const o=Object.create(null,{listVectors:{get:()=>super.listVectors}});return ur(this,arguments,void 0,function*(d={}){return o.listVectors.call(this,Object.assign(Object.assign({},d),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(o){const d=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return ur(this,void 0,void 0,function*(){return d.queryVectors.call(this,Object.assign(Object.assign({},o),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(o){const d=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return ur(this,void 0,void 0,function*(){return d.deleteVectors.call(this,Object.assign(Object.assign({},o),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class aV extends PT{constructor(o,d={},g,j){super(o,d,g,j)}from(o){return new CT(this.url,this.headers,o,this.fetch)}get vectors(){return new KT(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new GT(this.url+"/iceberg",this.headers,this.fetch)}}const rV="2.81.1";let lg="";typeof Deno<"u"?lg="deno":typeof document<"u"?lg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?lg="react-native":lg="node";const nV={"X-Client-Info":`supabase-js-${lg}/${rV}`},iV={headers:nV},sV={schema:"public"},oV={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},lV={},cV=u=>u?(...o)=>u(...o):(...o)=>fetch(...o),uV=()=>Headers,dV=(u,o,d)=>{const g=cV(d),j=uV();return async(Z,S)=>{var n;const B=(n=await o())!==null&&n!==void 0?n:u;let D=new j(S?.headers);return D.has("apikey")||D.set("apikey",u),D.has("Authorization")||D.set("Authorization",`Bearer ${B}`),g(Z,Object.assign(Object.assign({},S),{headers:D}))}};function hV(u){return u.endsWith("/")?u:u+"/"}function fV(u,o){var d,g;const{db:j,auth:Z,realtime:S,global:n}=u,{db:B,auth:D,realtime:P,global:G}=o,Y={db:Object.assign(Object.assign({},B),j),auth:Object.assign(Object.assign({},D),Z),realtime:Object.assign(Object.assign({},P),S),storage:{},global:Object.assign(Object.assign(Object.assign({},G),n),{headers:Object.assign(Object.assign({},(d=G?.headers)!==null&&d!==void 0?d:{}),(g=n?.headers)!==null&&g!==void 0?g:{})}),accessToken:async()=>""};return u.accessToken?Y.accessToken=u.accessToken:delete Y.accessToken,Y}function pV(u){const o=u?.trim();if(!o)throw new Error("supabaseUrl is required.");if(!o.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(hV(o))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const MZ="2.81.1",Wm=30*1e3,Aw=3,Xx=Aw*Wm,mV="http://localhost:9999",yV="supabase.auth.token",gV={"X-Client-Info":`gotrue-js/${MZ}`},Rw="X-Supabase-Api-Version",BZ={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},_V=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,xV=10*60*1e3;class xg extends Error{constructor(o,d,g){super(o),this.__isAuthError=!0,this.name="AuthError",this.status=d,this.code=g}}function vr(u){return typeof u=="object"&&u!==null&&"__isAuthError"in u}class wV extends xg{constructor(o,d,g){super(o,d,g),this.name="AuthApiError",this.status=d,this.code=g}}function vV(u){return vr(u)&&u.name==="AuthApiError"}class Dp extends xg{constructor(o,d){super(o),this.name="AuthUnknownError",this.originalError=d}}class $f extends xg{constructor(o,d,g,j){super(o,g,j),this.name=d,this.status=g}}class Xu extends $f{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function bV(u){return vr(u)&&u.name==="AuthSessionMissingError"}class Im extends $f{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class V0 extends $f{constructor(o){super(o,"AuthInvalidCredentialsError",400,void 0)}}class M0 extends $f{constructor(o,d=null){super(o,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=d}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function LV(u){return vr(u)&&u.name==="AuthImplicitGrantRedirectError"}class cL extends $f{constructor(o,d=null){super(o,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=d}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Tw extends $f{constructor(o,d){super(o,"AuthRetryableFetchError",d,void 0)}}function Qx(u){return vr(u)&&u.name==="AuthRetryableFetchError"}class uL extends $f{constructor(o,d,g){super(o,"AuthWeakPasswordError",d,"weak_password"),this.reasons=g}}class Vw extends $f{constructor(o){super(o,"AuthInvalidJwtError",400,"invalid_jwt")}}const K0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),dL=` 	
\r=`.split(""),jV=(()=>{const u=new Array(128);for(let o=0;o<u.length;o+=1)u[o]=-1;for(let o=0;o<dL.length;o+=1)u[dL[o].charCodeAt(0)]=-2;for(let o=0;o<K0.length;o+=1)u[K0[o].charCodeAt(0)]=o;return u})();function hL(u,o,d){if(u!==null)for(o.queue=o.queue<<8|u,o.queuedBits+=8;o.queuedBits>=6;){const g=o.queue>>o.queuedBits-6&63;d(K0[g]),o.queuedBits-=6}else if(o.queuedBits>0)for(o.queue=o.queue<<6-o.queuedBits,o.queuedBits=6;o.queuedBits>=6;){const g=o.queue>>o.queuedBits-6&63;d(K0[g]),o.queuedBits-=6}}function IZ(u,o,d){const g=jV[u];if(g>-1)for(o.queue=o.queue<<6|g,o.queuedBits+=6;o.queuedBits>=8;)d(o.queue>>o.queuedBits-8&255),o.queuedBits-=8;else{if(g===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(u)}"`)}}function fL(u){const o=[],d=S=>{o.push(String.fromCodePoint(S))},g={utf8seq:0,codepoint:0},j={queue:0,queuedBits:0},Z=S=>{EV(S,g,d)};for(let S=0;S<u.length;S+=1)IZ(u.charCodeAt(S),j,Z);return o.join("")}function ZV(u,o){if(u<=127){o(u);return}else if(u<=2047){o(192|u>>6),o(128|u&63);return}else if(u<=65535){o(224|u>>12),o(128|u>>6&63),o(128|u&63);return}else if(u<=1114111){o(240|u>>18),o(128|u>>12&63),o(128|u>>6&63),o(128|u&63);return}throw new Error(`Unrecognized Unicode codepoint: ${u.toString(16)}`)}function NV(u,o){for(let d=0;d<u.length;d+=1){let g=u.charCodeAt(d);if(g>55295&&g<=56319){const j=(g-55296)*1024&65535;g=(u.charCodeAt(d+1)-56320&65535|j)+65536,d+=1}ZV(g,o)}}function EV(u,o,d){if(o.utf8seq===0){if(u<=127){d(u);return}for(let g=1;g<6;g+=1)if((u>>7-g&1)===0){o.utf8seq=g;break}if(o.utf8seq===2)o.codepoint=u&31;else if(o.utf8seq===3)o.codepoint=u&15;else if(o.utf8seq===4)o.codepoint=u&7;else throw new Error("Invalid UTF-8 sequence");o.utf8seq-=1}else if(o.utf8seq>0){if(u<=127)throw new Error("Invalid UTF-8 sequence");o.codepoint=o.codepoint<<6|u&63,o.utf8seq-=1,o.utf8seq===0&&d(o.codepoint)}}function Hm(u){const o=[],d={queue:0,queuedBits:0},g=j=>{o.push(j)};for(let j=0;j<u.length;j+=1)IZ(u.charCodeAt(j),d,g);return new Uint8Array(o)}function SV(u){const o=[];return NV(u,d=>o.push(d)),new Uint8Array(o)}function Cp(u){const o=[],d={queue:0,queuedBits:0},g=j=>{o.push(j)};return u.forEach(j=>hL(j,d,g)),hL(null,d,g),o.join("")}function zV(u){return Math.round(Date.now()/1e3)+u}function AV(){return Symbol("auth-callback")}const So=()=>typeof window<"u"&&typeof document<"u",Bp={tested:!1,writable:!1},kZ=()=>{if(!So())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Bp.tested)return Bp.writable;const u=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(u,u),globalThis.localStorage.removeItem(u),Bp.tested=!0,Bp.writable=!0}catch{Bp.tested=!0,Bp.writable=!1}return Bp.writable};function RV(u){const o={},d=new URL(u);if(d.hash&&d.hash[0]==="#")try{new URLSearchParams(d.hash.substring(1)).forEach((j,Z)=>{o[Z]=j})}catch{}return d.searchParams.forEach((g,j)=>{o[j]=g}),o}const JZ=u=>u?(...o)=>u(...o):(...o)=>fetch(...o),TV=u=>typeof u=="object"&&u!==null&&"status"in u&&"ok"in u&&"json"in u&&typeof u.json=="function",Xm=async(u,o,d)=>{await u.setItem(o,JSON.stringify(d))},Ip=async(u,o)=>{const d=await u.getItem(o);if(!d)return null;try{return JSON.parse(d)}catch{return d}},Uf=async(u,o)=>{await u.removeItem(o)};class m_{constructor(){this.promise=new m_.promiseConstructor((o,d)=>{this.resolve=o,this.reject=d})}}m_.promiseConstructor=Promise;function Hx(u){const o=u.split(".");if(o.length!==3)throw new Vw("Invalid JWT structure");for(let g=0;g<o.length;g++)if(!_V.test(o[g]))throw new Vw("JWT not in base64url format");return{header:JSON.parse(fL(o[0])),payload:JSON.parse(fL(o[1])),signature:Hm(o[2]),raw:{header:o[0],payload:o[1]}}}async function VV(u){return await new Promise(o=>{setTimeout(()=>o(null),u)})}function MV(u,o){return new Promise((g,j)=>{(async()=>{for(let Z=0;Z<1/0;Z++)try{const S=await u(Z);if(!o(Z,null,S)){g(S);return}}catch(S){if(!o(Z,S)){j(S);return}}})()})}function BV(u){return("0"+u.toString(16)).substr(-2)}function IV(){const o=new Uint32Array(56);if(typeof crypto>"u"){const d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",g=d.length;let j="";for(let Z=0;Z<56;Z++)j+=d.charAt(Math.floor(Math.random()*g));return j}return crypto.getRandomValues(o),Array.from(o,BV).join("")}async function kV(u){const d=new TextEncoder().encode(u),g=await crypto.subtle.digest("SHA-256",d),j=new Uint8Array(g);return Array.from(j).map(Z=>String.fromCharCode(Z)).join("")}async function JV(u){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),u;const d=await kV(u);return btoa(d).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function km(u,o,d=!1){const g=IV();let j=g;d&&(j+="/PASSWORD_RECOVERY"),await Xm(u,`${o}-code-verifier`,j);const Z=await JV(g);return[Z,g===Z?"plain":"s256"]}const FV=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function OV(u){const o=u.headers.get(Rw);if(!o||!o.match(FV))return null;try{return new Date(`${o}T00:00:00.0Z`)}catch{return null}}function DV(u){if(!u)throw new Error("Missing exp claim");const o=Math.floor(Date.now()/1e3);if(u<=o)throw new Error("JWT has expired")}function CV(u){switch(u){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const PV=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Jm(u){if(!PV.test(u))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Yx(){const u={};return new Proxy(u,{get:(o,d)=>{if(d==="__isUserNotAvailableProxy")return!0;if(typeof d=="symbol"){const g=d.toString();if(g==="Symbol(Symbol.toPrimitive)"||g==="Symbol(Symbol.toStringTag)"||g==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${d}" property of the session object is not supported. Please use getUser() instead.`)},set:(o,d)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${d}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(o,d)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${d}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function GV(u,o){return new Proxy(u,{get:(d,g,j)=>{if(g==="__isInsecureUserWarningProxy")return!0;if(typeof g=="symbol"){const Z=g.toString();if(Z==="Symbol(Symbol.toPrimitive)"||Z==="Symbol(Symbol.toStringTag)"||Z==="Symbol(util.inspect.custom)"||Z==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(d,g,j)}return!o.value&&typeof g=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o.value=!0),Reflect.get(d,g,j)}})}function pL(u){return JSON.parse(JSON.stringify(u))}const Jp=u=>u.msg||u.message||u.error_description||u.error||JSON.stringify(u),UV=[502,503,504];async function mL(u){var o;if(!TV(u))throw new Tw(Jp(u),0);if(UV.includes(u.status))throw new Tw(Jp(u),u.status);let d;try{d=await u.json()}catch(Z){throw new Dp(Jp(Z),Z)}let g;const j=OV(u);if(j&&j.getTime()>=BZ["2024-01-01"].timestamp&&typeof d=="object"&&d&&typeof d.code=="string"?g=d.code:typeof d=="object"&&d&&typeof d.error_code=="string"&&(g=d.error_code),g){if(g==="weak_password")throw new uL(Jp(d),u.status,((o=d.weak_password)===null||o===void 0?void 0:o.reasons)||[]);if(g==="session_not_found")throw new Xu}else if(typeof d=="object"&&d&&typeof d.weak_password=="object"&&d.weak_password&&Array.isArray(d.weak_password.reasons)&&d.weak_password.reasons.length&&d.weak_password.reasons.reduce((Z,S)=>Z&&typeof S=="string",!0))throw new uL(Jp(d),u.status,d.weak_password.reasons);throw new wV(Jp(d),u.status||500,g)}const WV=(u,o,d,g)=>{const j={method:u,headers:o?.headers||{}};return u==="GET"?j:(j.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},o?.headers),j.body=JSON.stringify(g),Object.assign(Object.assign({},j),d))};async function Wr(u,o,d,g){var j;const Z=Object.assign({},g?.headers);Z[Rw]||(Z[Rw]=BZ["2024-01-01"].name),g?.jwt&&(Z.Authorization=`Bearer ${g.jwt}`);const S=(j=g?.query)!==null&&j!==void 0?j:{};g?.redirectTo&&(S.redirect_to=g.redirectTo);const n=Object.keys(S).length?"?"+new URLSearchParams(S).toString():"",B=await XV(u,o,d+n,{headers:Z,noResolveJson:g?.noResolveJson},{},g?.body);return g?.xform?g?.xform(B):{data:Object.assign({},B),error:null}}async function XV(u,o,d,g,j,Z){const S=WV(o,g,j,Z);let n;try{n=await u(d,Object.assign({},S))}catch(B){throw console.error(B),new Tw(Jp(B),0)}if(n.ok||await mL(n),g?.noResolveJson)return n;try{return await n.json()}catch(B){await mL(B)}}function Qu(u){var o;let d=null;YV(u)&&(d=Object.assign({},u),u.expires_at||(d.expires_at=zV(u.expires_in)));const g=(o=u.user)!==null&&o!==void 0?o:u;return{data:{session:d,user:g},error:null}}function yL(u){const o=Qu(u);return!o.error&&u.weak_password&&typeof u.weak_password=="object"&&Array.isArray(u.weak_password.reasons)&&u.weak_password.reasons.length&&u.weak_password.message&&typeof u.weak_password.message=="string"&&u.weak_password.reasons.reduce((d,g)=>d&&typeof g=="string",!0)&&(o.data.weak_password=u.weak_password),o}function Xf(u){var o;return{data:{user:(o=u.user)!==null&&o!==void 0?o:u},error:null}}function QV(u){return{data:u,error:null}}function HV(u){const{action_link:o,email_otp:d,hashed_token:g,redirect_to:j,verification_type:Z}=u,S=iy(u,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),n={action_link:o,email_otp:d,hashed_token:g,redirect_to:j,verification_type:Z},B=Object.assign({},S);return{data:{properties:n,user:B},error:null}}function gL(u){return u}function YV(u){return u.access_token&&u.refresh_token&&u.expires_in}const $x=["global","local","others"];class $V{constructor({url:o="",headers:d={},fetch:g}){this.url=o,this.headers=d,this.fetch=JZ(g),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(o,d=$x[0]){if($x.indexOf(d)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${$x.join(", ")}`);try{return await Wr(this.fetch,"POST",`${this.url}/logout?scope=${d}`,{headers:this.headers,jwt:o,noResolveJson:!0}),{data:null,error:null}}catch(g){if(vr(g))return{data:null,error:g};throw g}}async inviteUserByEmail(o,d={}){try{return await Wr(this.fetch,"POST",`${this.url}/invite`,{body:{email:o,data:d.data},headers:this.headers,redirectTo:d.redirectTo,xform:Xf})}catch(g){if(vr(g))return{data:{user:null},error:g};throw g}}async generateLink(o){try{const{options:d}=o,g=iy(o,["options"]),j=Object.assign(Object.assign({},g),d);return"newEmail"in g&&(j.new_email=g?.newEmail,delete j.newEmail),await Wr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:j,headers:this.headers,xform:HV,redirectTo:d?.redirectTo})}catch(d){if(vr(d))return{data:{properties:null,user:null},error:d};throw d}}async createUser(o){try{return await Wr(this.fetch,"POST",`${this.url}/admin/users`,{body:o,headers:this.headers,xform:Xf})}catch(d){if(vr(d))return{data:{user:null},error:d};throw d}}async listUsers(o){var d,g,j,Z,S,n,B;try{const D={nextPage:null,lastPage:0,total:0},P=await Wr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(g=(d=o?.page)===null||d===void 0?void 0:d.toString())!==null&&g!==void 0?g:"",per_page:(Z=(j=o?.perPage)===null||j===void 0?void 0:j.toString())!==null&&Z!==void 0?Z:""},xform:gL});if(P.error)throw P.error;const G=await P.json(),Y=(S=P.headers.get("x-total-count"))!==null&&S!==void 0?S:0,X=(B=(n=P.headers.get("link"))===null||n===void 0?void 0:n.split(","))!==null&&B!==void 0?B:[];return X.length>0&&(X.forEach(ue=>{const oe=parseInt(ue.split(";")[0].split("=")[1].substring(0,1)),pe=JSON.parse(ue.split(";")[1].split("=")[1]);D[`${pe}Page`]=oe}),D.total=parseInt(Y)),{data:Object.assign(Object.assign({},G),D),error:null}}catch(D){if(vr(D))return{data:{users:[]},error:D};throw D}}async getUserById(o){Jm(o);try{return await Wr(this.fetch,"GET",`${this.url}/admin/users/${o}`,{headers:this.headers,xform:Xf})}catch(d){if(vr(d))return{data:{user:null},error:d};throw d}}async updateUserById(o,d){Jm(o);try{return await Wr(this.fetch,"PUT",`${this.url}/admin/users/${o}`,{body:d,headers:this.headers,xform:Xf})}catch(g){if(vr(g))return{data:{user:null},error:g};throw g}}async deleteUser(o,d=!1){Jm(o);try{return await Wr(this.fetch,"DELETE",`${this.url}/admin/users/${o}`,{headers:this.headers,body:{should_soft_delete:d},xform:Xf})}catch(g){if(vr(g))return{data:{user:null},error:g};throw g}}async _listFactors(o){Jm(o.userId);try{const{data:d,error:g}=await Wr(this.fetch,"GET",`${this.url}/admin/users/${o.userId}/factors`,{headers:this.headers,xform:j=>({data:{factors:j},error:null})});return{data:d,error:g}}catch(d){if(vr(d))return{data:null,error:d};throw d}}async _deleteFactor(o){Jm(o.userId),Jm(o.id);try{return{data:await Wr(this.fetch,"DELETE",`${this.url}/admin/users/${o.userId}/factors/${o.id}`,{headers:this.headers}),error:null}}catch(d){if(vr(d))return{data:null,error:d};throw d}}async _listOAuthClients(o){var d,g,j,Z,S,n,B;try{const D={nextPage:null,lastPage:0,total:0},P=await Wr(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(g=(d=o?.page)===null||d===void 0?void 0:d.toString())!==null&&g!==void 0?g:"",per_page:(Z=(j=o?.perPage)===null||j===void 0?void 0:j.toString())!==null&&Z!==void 0?Z:""},xform:gL});if(P.error)throw P.error;const G=await P.json(),Y=(S=P.headers.get("x-total-count"))!==null&&S!==void 0?S:0,X=(B=(n=P.headers.get("link"))===null||n===void 0?void 0:n.split(","))!==null&&B!==void 0?B:[];return X.length>0&&(X.forEach(ue=>{const oe=parseInt(ue.split(";")[0].split("=")[1].substring(0,1)),pe=JSON.parse(ue.split(";")[1].split("=")[1]);D[`${pe}Page`]=oe}),D.total=parseInt(Y)),{data:Object.assign(Object.assign({},G),D),error:null}}catch(D){if(vr(D))return{data:{clients:[]},error:D};throw D}}async _createOAuthClient(o){try{return await Wr(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:o,headers:this.headers,xform:d=>({data:d,error:null})})}catch(d){if(vr(d))return{data:null,error:d};throw d}}async _getOAuthClient(o){try{return await Wr(this.fetch,"GET",`${this.url}/admin/oauth/clients/${o}`,{headers:this.headers,xform:d=>({data:d,error:null})})}catch(d){if(vr(d))return{data:null,error:d};throw d}}async _updateOAuthClient(o,d){try{return await Wr(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${o}`,{body:d,headers:this.headers,xform:g=>({data:g,error:null})})}catch(g){if(vr(g))return{data:null,error:g};throw g}}async _deleteOAuthClient(o){try{return await Wr(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${o}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(d){if(vr(d))return{data:null,error:d};throw d}}async _regenerateOAuthClientSecret(o){try{return await Wr(this.fetch,"POST",`${this.url}/admin/oauth/clients/${o}/regenerate_secret`,{headers:this.headers,xform:d=>({data:d,error:null})})}catch(d){if(vr(d))return{data:null,error:d};throw d}}}function _L(u={}){return{getItem:o=>u[o]||null,setItem:(o,d)=>{u[o]=d},removeItem:o=>{delete u[o]}}}const Fm={debug:!!(globalThis&&kZ()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class FZ extends Error{constructor(o){super(o),this.isAcquireTimeout=!0}}class qV extends FZ{}async function KV(u,o,d){Fm.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",u,o);const g=new globalThis.AbortController;return o>0&&setTimeout(()=>{g.abort(),Fm.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",u)},o),await Promise.resolve().then(()=>globalThis.navigator.locks.request(u,o===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:g.signal},async j=>{if(j){Fm.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",u,j.name);try{return await d()}finally{Fm.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",u,j.name)}}else{if(o===0)throw Fm.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",u),new qV(`Acquiring an exclusive Navigator LockManager lock "${u}" immediately failed`);if(Fm.debug)try{const Z=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(Z,null,"  "))}catch(Z){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",Z)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await d()}}))}function eM(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function OZ(u){if(!/^0x[a-fA-F0-9]{40}$/.test(u))throw new Error(`@supabase/auth-js: Address "${u}" is invalid.`);return u.toLowerCase()}function tM(u){return parseInt(u,16)}function aM(u){const o=new TextEncoder().encode(u);return"0x"+Array.from(o,g=>g.toString(16).padStart(2,"0")).join("")}function rM(u){var o;const{chainId:d,domain:g,expirationTime:j,issuedAt:Z=new Date,nonce:S,notBefore:n,requestId:B,resources:D,scheme:P,uri:G,version:Y}=u;{if(!Number.isInteger(d))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${d}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(S&&S.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${S}`);if(!G)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(Y!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${Y}`);if(!((o=u.statement)===null||o===void 0)&&o.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${u.statement}`)}const X=OZ(u.address),ue=P?`${P}://${g}`:g,oe=u.statement?`${u.statement}
`:"",pe=`${ue} wants you to sign in with your Ethereum account:
${X}

${oe}`;let ve=`URI: ${G}
Version: ${Y}
Chain ID: ${d}${S?`
Nonce: ${S}`:""}
Issued At: ${Z.toISOString()}`;if(j&&(ve+=`
Expiration Time: ${j.toISOString()}`),n&&(ve+=`
Not Before: ${n.toISOString()}`),B&&(ve+=`
Request ID: ${B}`),D){let ke=`
Resources:`;for(const ye of D){if(!ye||typeof ye!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${ye}`);ke+=`
- ${ye}`}ve+=ke}return`${pe}
${ve}`}class Vs extends Error{constructor({message:o,code:d,cause:g,name:j}){var Z;super(o,{cause:g}),this.__isWebAuthnError=!0,this.name=(Z=j??(g instanceof Error?g.name:void 0))!==null&&Z!==void 0?Z:"Unknown Error",this.code=d}}class e_ extends Vs{constructor(o,d){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:d,message:o}),this.name="WebAuthnUnknownError",this.originalError=d}}function nM({error:u,options:o}){var d,g,j;const{publicKey:Z}=o;if(!Z)throw Error("options was missing required publicKey property");if(u.name==="AbortError"){if(o.signal instanceof AbortSignal)return new Vs({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:u})}else if(u.name==="ConstraintError"){if(((d=Z.authenticatorSelection)===null||d===void 0?void 0:d.requireResidentKey)===!0)return new Vs({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:u});if(o.mediation==="conditional"&&((g=Z.authenticatorSelection)===null||g===void 0?void 0:g.userVerification)==="required")return new Vs({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:u});if(((j=Z.authenticatorSelection)===null||j===void 0?void 0:j.userVerification)==="required")return new Vs({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:u})}else{if(u.name==="InvalidStateError")return new Vs({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:u});if(u.name==="NotAllowedError")return new Vs({message:u.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:u});if(u.name==="NotSupportedError")return Z.pubKeyCredParams.filter(n=>n.type==="public-key").length===0?new Vs({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:u}):new Vs({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:u});if(u.name==="SecurityError"){const S=window.location.hostname;if(DZ(S)){if(Z.rp.id!==S)return new Vs({message:`The RP ID "${Z.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:u})}else return new Vs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:u})}else if(u.name==="TypeError"){if(Z.user.id.byteLength<1||Z.user.id.byteLength>64)return new Vs({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:u})}else if(u.name==="UnknownError")return new Vs({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:u})}return new Vs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:u})}function iM({error:u,options:o}){const{publicKey:d}=o;if(!d)throw Error("options was missing required publicKey property");if(u.name==="AbortError"){if(o.signal instanceof AbortSignal)return new Vs({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:u})}else{if(u.name==="NotAllowedError")return new Vs({message:u.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:u});if(u.name==="SecurityError"){const g=window.location.hostname;if(DZ(g)){if(d.rpId!==g)return new Vs({message:`The RP ID "${d.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:u})}else return new Vs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:u})}else if(u.name==="UnknownError")return new Vs({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:u})}return new Vs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:u})}class sM{createNewAbortSignal(){if(this.controller){const d=new Error("Cancelling existing WebAuthn API call for new one");d.name="AbortError",this.controller.abort(d)}const o=new AbortController;return this.controller=o,o.signal}cancelCeremony(){if(this.controller){const o=new Error("Manually cancelling existing WebAuthn API call");o.name="AbortError",this.controller.abort(o),this.controller=void 0}}}const oM=new sM;function lM(u){if(!u)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(u);const{challenge:o,user:d,excludeCredentials:g}=u,j=iy(u,["challenge","user","excludeCredentials"]),Z=Hm(o).buffer,S=Object.assign(Object.assign({},d),{id:Hm(d.id).buffer}),n=Object.assign(Object.assign({},j),{challenge:Z,user:S});if(g&&g.length>0){n.excludeCredentials=new Array(g.length);for(let B=0;B<g.length;B++){const D=g[B];n.excludeCredentials[B]=Object.assign(Object.assign({},D),{id:Hm(D.id).buffer,type:D.type||"public-key",transports:D.transports})}}return n}function cM(u){if(!u)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(u);const{challenge:o,allowCredentials:d}=u,g=iy(u,["challenge","allowCredentials"]),j=Hm(o).buffer,Z=Object.assign(Object.assign({},g),{challenge:j});if(d&&d.length>0){Z.allowCredentials=new Array(d.length);for(let S=0;S<d.length;S++){const n=d[S];Z.allowCredentials[S]=Object.assign(Object.assign({},n),{id:Hm(n.id).buffer,type:n.type||"public-key",transports:n.transports})}}return Z}function uM(u){var o;if("toJSON"in u&&typeof u.toJSON=="function")return u.toJSON();const d=u;return{id:u.id,rawId:u.id,response:{attestationObject:Cp(new Uint8Array(u.response.attestationObject)),clientDataJSON:Cp(new Uint8Array(u.response.clientDataJSON))},type:"public-key",clientExtensionResults:u.getClientExtensionResults(),authenticatorAttachment:(o=d.authenticatorAttachment)!==null&&o!==void 0?o:void 0}}function dM(u){var o;if("toJSON"in u&&typeof u.toJSON=="function")return u.toJSON();const d=u,g=u.getClientExtensionResults(),j=u.response;return{id:u.id,rawId:u.id,response:{authenticatorData:Cp(new Uint8Array(j.authenticatorData)),clientDataJSON:Cp(new Uint8Array(j.clientDataJSON)),signature:Cp(new Uint8Array(j.signature)),userHandle:j.userHandle?Cp(new Uint8Array(j.userHandle)):void 0},type:"public-key",clientExtensionResults:g,authenticatorAttachment:(o=d.authenticatorAttachment)!==null&&o!==void 0?o:void 0}}function DZ(u){return u==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(u)}function xL(){var u,o;return!!(So()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((u=navigator?.credentials)===null||u===void 0?void 0:u.create)=="function"&&typeof((o=navigator?.credentials)===null||o===void 0?void 0:o.get)=="function")}async function hM(u){try{const o=await navigator.credentials.create(u);return o?o instanceof PublicKeyCredential?{data:o,error:null}:{data:null,error:new e_("Browser returned unexpected credential type",o)}:{data:null,error:new e_("Empty credential response",o)}}catch(o){return{data:null,error:nM({error:o,options:u})}}}async function fM(u){try{const o=await navigator.credentials.get(u);return o?o instanceof PublicKeyCredential?{data:o,error:null}:{data:null,error:new e_("Browser returned unexpected credential type",o)}:{data:null,error:new e_("Empty credential response",o)}}catch(o){return{data:null,error:iM({error:o,options:u})}}}const pM={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},mM={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function t_(...u){const o=j=>j!==null&&typeof j=="object"&&!Array.isArray(j),d=j=>j instanceof ArrayBuffer||ArrayBuffer.isView(j),g={};for(const j of u)if(j)for(const Z in j){const S=j[Z];if(S!==void 0)if(Array.isArray(S))g[Z]=S;else if(d(S))g[Z]=S;else if(o(S)){const n=g[Z];o(n)?g[Z]=t_(n,S):g[Z]=t_(S)}else g[Z]=S}return g}function yM(u,o){return t_(pM,u,o||{})}function gM(u,o){return t_(mM,u,o||{})}class _M{constructor(o){this.client=o,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(o){return this.client.mfa.enroll(Object.assign(Object.assign({},o),{factorType:"webauthn"}))}async _challenge({factorId:o,webauthn:d,friendlyName:g,signal:j},Z){try{const{data:S,error:n}=await this.client.mfa.challenge({factorId:o,webauthn:d});if(!S)return{data:null,error:n};const B=j??oM.createNewAbortSignal();if(S.webauthn.type==="create"){const{user:D}=S.webauthn.credential_options.publicKey;D.name||(D.name=`${D.id}:${g}`),D.displayName||(D.displayName=D.name)}switch(S.webauthn.type){case"create":{const D=yM(S.webauthn.credential_options.publicKey,Z?.create),{data:P,error:G}=await hM({publicKey:D,signal:B});return P?{data:{factorId:o,challengeId:S.id,webauthn:{type:S.webauthn.type,credential_response:P}},error:null}:{data:null,error:G}}case"request":{const D=gM(S.webauthn.credential_options.publicKey,Z?.request),{data:P,error:G}=await fM(Object.assign(Object.assign({},S.webauthn.credential_options),{publicKey:D,signal:B}));return P?{data:{factorId:o,challengeId:S.id,webauthn:{type:S.webauthn.type,credential_response:P}},error:null}:{data:null,error:G}}}}catch(S){return vr(S)?{data:null,error:S}:{data:null,error:new Dp("Unexpected error in challenge",S)}}}async _verify({challengeId:o,factorId:d,webauthn:g}){return this.client.mfa.verify({factorId:d,challengeId:o,webauthn:g})}async _authenticate({factorId:o,webauthn:{rpId:d=typeof window<"u"?window.location.hostname:void 0,rpOrigins:g=typeof window<"u"?[window.location.origin]:void 0,signal:j}={}},Z){if(!d)return{data:null,error:new xg("rpId is required for WebAuthn authentication")};try{if(!xL())return{data:null,error:new Dp("Browser does not support WebAuthn",null)};const{data:S,error:n}=await this.challenge({factorId:o,webauthn:{rpId:d,rpOrigins:g},signal:j},{request:Z});if(!S)return{data:null,error:n};const{webauthn:B}=S;return this._verify({factorId:o,challengeId:S.challengeId,webauthn:{type:B.type,rpId:d,rpOrigins:g,credential_response:B.credential_response}})}catch(S){return vr(S)?{data:null,error:S}:{data:null,error:new Dp("Unexpected error in authenticate",S)}}}async _register({friendlyName:o,webauthn:{rpId:d=typeof window<"u"?window.location.hostname:void 0,rpOrigins:g=typeof window<"u"?[window.location.origin]:void 0,signal:j}={}},Z){if(!d)return{data:null,error:new xg("rpId is required for WebAuthn registration")};try{if(!xL())return{data:null,error:new Dp("Browser does not support WebAuthn",null)};const{data:S,error:n}=await this._enroll({friendlyName:o});if(!S)return await this.client.mfa.listFactors().then(P=>{var G;return(G=P.data)===null||G===void 0?void 0:G.all.find(Y=>Y.factor_type==="webauthn"&&Y.friendly_name===o&&Y.status!=="unverified")}).then(P=>P?this.client.mfa.unenroll({factorId:P?.id}):void 0),{data:null,error:n};const{data:B,error:D}=await this._challenge({factorId:S.id,friendlyName:S.friendly_name,webauthn:{rpId:d,rpOrigins:g},signal:j},{create:Z});return B?this._verify({factorId:S.id,challengeId:B.challengeId,webauthn:{rpId:d,rpOrigins:g,type:B.webauthn.type,credential_response:B.webauthn.credential_response}}):{data:null,error:D}}catch(S){return vr(S)?{data:null,error:S}:{data:null,error:new Dp("Unexpected error in register",S)}}}}eM();const xM={url:mV,storageKey:yV,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:gV,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function wL(u,o,d){return await d()}const Om={};class wg{get jwks(){var o,d;return(d=(o=Om[this.storageKey])===null||o===void 0?void 0:o.jwks)!==null&&d!==void 0?d:{keys:[]}}set jwks(o){Om[this.storageKey]=Object.assign(Object.assign({},Om[this.storageKey]),{jwks:o})}get jwks_cached_at(){var o,d;return(d=(o=Om[this.storageKey])===null||o===void 0?void 0:o.cachedAt)!==null&&d!==void 0?d:Number.MIN_SAFE_INTEGER}set jwks_cached_at(o){Om[this.storageKey]=Object.assign(Object.assign({},Om[this.storageKey]),{cachedAt:o})}constructor(o){var d,g,j;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const Z=Object.assign(Object.assign({},xM),o);if(this.storageKey=Z.storageKey,this.instanceID=(d=wg.nextInstanceID[this.storageKey])!==null&&d!==void 0?d:0,wg.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!Z.debug,typeof Z.debug=="function"&&(this.logger=Z.debug),this.instanceID>0&&So()){const S=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(S),this.logDebugMessages&&console.trace(S)}if(this.persistSession=Z.persistSession,this.autoRefreshToken=Z.autoRefreshToken,this.admin=new $V({url:Z.url,headers:Z.headers,fetch:Z.fetch}),this.url=Z.url,this.headers=Z.headers,this.fetch=JZ(Z.fetch),this.lock=Z.lock||wL,this.detectSessionInUrl=Z.detectSessionInUrl,this.flowType=Z.flowType,this.hasCustomAuthorizationHeader=Z.hasCustomAuthorizationHeader,this.throwOnError=Z.throwOnError,Z.lock?this.lock=Z.lock:So()&&(!((g=globalThis?.navigator)===null||g===void 0)&&g.locks)?this.lock=KV:this.lock=wL,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new _M(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(Z.storage?this.storage=Z.storage:kZ()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=_L(this.memoryStorage)),Z.userStorage&&(this.userStorage=Z.userStorage)):(this.memoryStorage={},this.storage=_L(this.memoryStorage)),So()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(S){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",S)}(j=this.broadcastChannel)===null||j===void 0||j.addEventListener("message",async S=>{this._debug("received broadcast notification from other tab or client",S),await this._notifyAllSubscribers(S.data.event,S.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(o){if(this.throwOnError&&o&&o.error)throw o.error;return o}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${MZ}) ${new Date().toISOString()}`}_debug(...o){return this.logDebugMessages&&this.logger(this._logPrefix(),...o),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var o;try{let d={},g="none";if(So()&&(d=RV(window.location.href),this._isImplicitGrantCallback(d)?g="implicit":await this._isPKCECallback(d)&&(g="pkce")),So()&&this.detectSessionInUrl&&g!=="none"){const{data:j,error:Z}=await this._getSessionFromURL(d,g);if(Z){if(this._debug("#_initialize()","error detecting session from URL",Z),LV(Z)){const B=(o=Z.details)===null||o===void 0?void 0:o.code;if(B==="identity_already_exists"||B==="identity_not_found"||B==="single_identity_not_deletable")return{error:Z}}return await this._removeSession(),{error:Z}}const{session:S,redirectType:n}=j;return this._debug("#_initialize()","detected session in URL",S,"redirect type",n),await this._saveSession(S),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",S):await this._notifyAllSubscribers("SIGNED_IN",S)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(d){return vr(d)?this._returnResult({error:d}):this._returnResult({error:new Dp("Unexpected error during initialization",d)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(o){var d,g,j;try{const Z=await Wr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(g=(d=o?.options)===null||d===void 0?void 0:d.data)!==null&&g!==void 0?g:{},gotrue_meta_security:{captcha_token:(j=o?.options)===null||j===void 0?void 0:j.captchaToken}},xform:Qu}),{data:S,error:n}=Z;if(n||!S)return this._returnResult({data:{user:null,session:null},error:n});const B=S.session,D=S.user;return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",B)),this._returnResult({data:{user:D,session:B},error:null})}catch(Z){if(vr(Z))return this._returnResult({data:{user:null,session:null},error:Z});throw Z}}async signUp(o){var d,g,j;try{let Z;if("email"in o){const{email:P,password:G,options:Y}=o;let X=null,ue=null;this.flowType==="pkce"&&([X,ue]=await km(this.storage,this.storageKey)),Z=await Wr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:Y?.emailRedirectTo,body:{email:P,password:G,data:(d=Y?.data)!==null&&d!==void 0?d:{},gotrue_meta_security:{captcha_token:Y?.captchaToken},code_challenge:X,code_challenge_method:ue},xform:Qu})}else if("phone"in o){const{phone:P,password:G,options:Y}=o;Z=await Wr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:P,password:G,data:(g=Y?.data)!==null&&g!==void 0?g:{},channel:(j=Y?.channel)!==null&&j!==void 0?j:"sms",gotrue_meta_security:{captcha_token:Y?.captchaToken}},xform:Qu})}else throw new V0("You must provide either an email or phone number and a password");const{data:S,error:n}=Z;if(n||!S)return this._returnResult({data:{user:null,session:null},error:n});const B=S.session,D=S.user;return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",B)),this._returnResult({data:{user:D,session:B},error:null})}catch(Z){if(vr(Z))return this._returnResult({data:{user:null,session:null},error:Z});throw Z}}async signInWithPassword(o){try{let d;if("email"in o){const{email:Z,password:S,options:n}=o;d=await Wr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:Z,password:S,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:yL})}else if("phone"in o){const{phone:Z,password:S,options:n}=o;d=await Wr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:Z,password:S,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:yL})}else throw new V0("You must provide either an email or phone number and a password");const{data:g,error:j}=d;if(j)return this._returnResult({data:{user:null,session:null},error:j});if(!g||!g.session||!g.user){const Z=new Im;return this._returnResult({data:{user:null,session:null},error:Z})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({user:g.user,session:g.session},g.weak_password?{weakPassword:g.weak_password}:null),error:j})}catch(d){if(vr(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signInWithOAuth(o){var d,g,j,Z;return await this._handleProviderSignIn(o.provider,{redirectTo:(d=o.options)===null||d===void 0?void 0:d.redirectTo,scopes:(g=o.options)===null||g===void 0?void 0:g.scopes,queryParams:(j=o.options)===null||j===void 0?void 0:j.queryParams,skipBrowserRedirect:(Z=o.options)===null||Z===void 0?void 0:Z.skipBrowserRedirect})}async exchangeCodeForSession(o){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(o))}async signInWithWeb3(o){const{chain:d}=o;switch(d){case"ethereum":return await this.signInWithEthereum(o);case"solana":return await this.signInWithSolana(o);default:throw new Error(`@supabase/auth-js: Unsupported chain "${d}"`)}}async signInWithEthereum(o){var d,g,j,Z,S,n,B,D,P,G,Y;let X,ue;if("message"in o)X=o.message,ue=o.signature;else{const{chain:oe,wallet:pe,statement:ve,options:ke}=o;let ye;if(So())if(typeof pe=="object")ye=pe;else{const bt=window;if("ethereum"in bt&&typeof bt.ethereum=="object"&&"request"in bt.ethereum&&typeof bt.ethereum.request=="function")ye=bt.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof pe!="object"||!ke?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ye=pe}const $e=new URL((d=ke?.url)!==null&&d!==void 0?d:window.location.href),De=await ye.request({method:"eth_requestAccounts"}).then(bt=>bt).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!De||De.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Te=OZ(De[0]);let Qe=(g=ke?.signInWithEthereum)===null||g===void 0?void 0:g.chainId;if(!Qe){const bt=await ye.request({method:"eth_chainId"});Qe=tM(bt)}const Ft={domain:$e.host,address:Te,statement:ve,uri:$e.href,version:"1",chainId:Qe,nonce:(j=ke?.signInWithEthereum)===null||j===void 0?void 0:j.nonce,issuedAt:(S=(Z=ke?.signInWithEthereum)===null||Z===void 0?void 0:Z.issuedAt)!==null&&S!==void 0?S:new Date,expirationTime:(n=ke?.signInWithEthereum)===null||n===void 0?void 0:n.expirationTime,notBefore:(B=ke?.signInWithEthereum)===null||B===void 0?void 0:B.notBefore,requestId:(D=ke?.signInWithEthereum)===null||D===void 0?void 0:D.requestId,resources:(P=ke?.signInWithEthereum)===null||P===void 0?void 0:P.resources};X=rM(Ft),ue=await ye.request({method:"personal_sign",params:[aM(X),Te]})}try{const{data:oe,error:pe}=await Wr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:X,signature:ue},!((G=o.options)===null||G===void 0)&&G.captchaToken?{gotrue_meta_security:{captcha_token:(Y=o.options)===null||Y===void 0?void 0:Y.captchaToken}}:null),xform:Qu});if(pe)throw pe;if(!oe||!oe.session||!oe.user){const ve=new Im;return this._returnResult({data:{user:null,session:null},error:ve})}return oe.session&&(await this._saveSession(oe.session),await this._notifyAllSubscribers("SIGNED_IN",oe.session)),this._returnResult({data:Object.assign({},oe),error:pe})}catch(oe){if(vr(oe))return this._returnResult({data:{user:null,session:null},error:oe});throw oe}}async signInWithSolana(o){var d,g,j,Z,S,n,B,D,P,G,Y,X;let ue,oe;if("message"in o)ue=o.message,oe=o.signature;else{const{chain:pe,wallet:ve,statement:ke,options:ye}=o;let $e;if(So())if(typeof ve=="object")$e=ve;else{const Te=window;if("solana"in Te&&typeof Te.solana=="object"&&("signIn"in Te.solana&&typeof Te.solana.signIn=="function"||"signMessage"in Te.solana&&typeof Te.solana.signMessage=="function"))$e=Te.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof ve!="object"||!ye?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$e=ve}const De=new URL((d=ye?.url)!==null&&d!==void 0?d:window.location.href);if("signIn"in $e&&$e.signIn){const Te=await $e.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},ye?.signInWithSolana),{version:"1",domain:De.host,uri:De.href}),ke?{statement:ke}:null));let Qe;if(Array.isArray(Te)&&Te[0]&&typeof Te[0]=="object")Qe=Te[0];else if(Te&&typeof Te=="object"&&"signedMessage"in Te&&"signature"in Te)Qe=Te;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Qe&&"signature"in Qe&&(typeof Qe.signedMessage=="string"||Qe.signedMessage instanceof Uint8Array)&&Qe.signature instanceof Uint8Array)ue=typeof Qe.signedMessage=="string"?Qe.signedMessage:new TextDecoder().decode(Qe.signedMessage),oe=Qe.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in $e)||typeof $e.signMessage!="function"||!("publicKey"in $e)||typeof $e!="object"||!$e.publicKey||!("toBase58"in $e.publicKey)||typeof $e.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");ue=[`${De.host} wants you to sign in with your Solana account:`,$e.publicKey.toBase58(),...ke?["",ke,""]:[""],"Version: 1",`URI: ${De.href}`,`Issued At: ${(j=(g=ye?.signInWithSolana)===null||g===void 0?void 0:g.issuedAt)!==null&&j!==void 0?j:new Date().toISOString()}`,...!((Z=ye?.signInWithSolana)===null||Z===void 0)&&Z.notBefore?[`Not Before: ${ye.signInWithSolana.notBefore}`]:[],...!((S=ye?.signInWithSolana)===null||S===void 0)&&S.expirationTime?[`Expiration Time: ${ye.signInWithSolana.expirationTime}`]:[],...!((n=ye?.signInWithSolana)===null||n===void 0)&&n.chainId?[`Chain ID: ${ye.signInWithSolana.chainId}`]:[],...!((B=ye?.signInWithSolana)===null||B===void 0)&&B.nonce?[`Nonce: ${ye.signInWithSolana.nonce}`]:[],...!((D=ye?.signInWithSolana)===null||D===void 0)&&D.requestId?[`Request ID: ${ye.signInWithSolana.requestId}`]:[],...!((G=(P=ye?.signInWithSolana)===null||P===void 0?void 0:P.resources)===null||G===void 0)&&G.length?["Resources",...ye.signInWithSolana.resources.map(Qe=>`- ${Qe}`)]:[]].join(`
`);const Te=await $e.signMessage(new TextEncoder().encode(ue),"utf8");if(!Te||!(Te instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");oe=Te}}try{const{data:pe,error:ve}=await Wr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:ue,signature:Cp(oe)},!((Y=o.options)===null||Y===void 0)&&Y.captchaToken?{gotrue_meta_security:{captcha_token:(X=o.options)===null||X===void 0?void 0:X.captchaToken}}:null),xform:Qu});if(ve)throw ve;if(!pe||!pe.session||!pe.user){const ke=new Im;return this._returnResult({data:{user:null,session:null},error:ke})}return pe.session&&(await this._saveSession(pe.session),await this._notifyAllSubscribers("SIGNED_IN",pe.session)),this._returnResult({data:Object.assign({},pe),error:ve})}catch(pe){if(vr(pe))return this._returnResult({data:{user:null,session:null},error:pe});throw pe}}async _exchangeCodeForSession(o){const d=await Ip(this.storage,`${this.storageKey}-code-verifier`),[g,j]=(d??"").split("/");try{const{data:Z,error:S}=await Wr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:o,code_verifier:g},xform:Qu});if(await Uf(this.storage,`${this.storageKey}-code-verifier`),S)throw S;if(!Z||!Z.session||!Z.user){const n=new Im;return this._returnResult({data:{user:null,session:null,redirectType:null},error:n})}return Z.session&&(await this._saveSession(Z.session),await this._notifyAllSubscribers("SIGNED_IN",Z.session)),this._returnResult({data:Object.assign(Object.assign({},Z),{redirectType:j??null}),error:S})}catch(Z){if(vr(Z))return this._returnResult({data:{user:null,session:null,redirectType:null},error:Z});throw Z}}async signInWithIdToken(o){try{const{options:d,provider:g,token:j,access_token:Z,nonce:S}=o,n=await Wr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:g,id_token:j,access_token:Z,nonce:S,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Qu}),{data:B,error:D}=n;if(D)return this._returnResult({data:{user:null,session:null},error:D});if(!B||!B.session||!B.user){const P=new Im;return this._returnResult({data:{user:null,session:null},error:P})}return B.session&&(await this._saveSession(B.session),await this._notifyAllSubscribers("SIGNED_IN",B.session)),this._returnResult({data:B,error:D})}catch(d){if(vr(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signInWithOtp(o){var d,g,j,Z,S;try{if("email"in o){const{email:n,options:B}=o;let D=null,P=null;this.flowType==="pkce"&&([D,P]=await km(this.storage,this.storageKey));const{error:G}=await Wr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:n,data:(d=B?.data)!==null&&d!==void 0?d:{},create_user:(g=B?.shouldCreateUser)!==null&&g!==void 0?g:!0,gotrue_meta_security:{captcha_token:B?.captchaToken},code_challenge:D,code_challenge_method:P},redirectTo:B?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:G})}if("phone"in o){const{phone:n,options:B}=o,{data:D,error:P}=await Wr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:n,data:(j=B?.data)!==null&&j!==void 0?j:{},create_user:(Z=B?.shouldCreateUser)!==null&&Z!==void 0?Z:!0,gotrue_meta_security:{captcha_token:B?.captchaToken},channel:(S=B?.channel)!==null&&S!==void 0?S:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:D?.message_id},error:P})}throw new V0("You must provide either an email or phone number.")}catch(n){if(vr(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async verifyOtp(o){var d,g;try{let j,Z;"options"in o&&(j=(d=o.options)===null||d===void 0?void 0:d.redirectTo,Z=(g=o.options)===null||g===void 0?void 0:g.captchaToken);const{data:S,error:n}=await Wr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},o),{gotrue_meta_security:{captcha_token:Z}}),redirectTo:j,xform:Qu});if(n)throw n;if(!S)throw new Error("An error occurred on token verification.");const B=S.session,D=S.user;return B?.access_token&&(await this._saveSession(B),await this._notifyAllSubscribers(o.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",B)),this._returnResult({data:{user:D,session:B},error:null})}catch(j){if(vr(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async signInWithSSO(o){var d,g,j,Z,S;try{let n=null,B=null;this.flowType==="pkce"&&([n,B]=await km(this.storage,this.storageKey));const D=await Wr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in o?{provider_id:o.providerId}:null),"domain"in o?{domain:o.domain}:null),{redirect_to:(g=(d=o.options)===null||d===void 0?void 0:d.redirectTo)!==null&&g!==void 0?g:void 0}),!((j=o?.options)===null||j===void 0)&&j.captchaToken?{gotrue_meta_security:{captcha_token:o.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:B}),headers:this.headers,xform:QV});return!((Z=D.data)===null||Z===void 0)&&Z.url&&So()&&!(!((S=o.options)===null||S===void 0)&&S.skipBrowserRedirect)&&window.location.assign(D.data.url),this._returnResult(D)}catch(n){if(vr(n))return this._returnResult({data:null,error:n});throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async o=>{const{data:{session:d},error:g}=o;if(g)throw g;if(!d)throw new Xu;const{error:j}=await Wr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:d.access_token});return this._returnResult({data:{user:null,session:null},error:j})})}catch(o){if(vr(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async resend(o){try{const d=`${this.url}/resend`;if("email"in o){const{email:g,type:j,options:Z}=o,{error:S}=await Wr(this.fetch,"POST",d,{headers:this.headers,body:{email:g,type:j,gotrue_meta_security:{captcha_token:Z?.captchaToken}},redirectTo:Z?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:S})}else if("phone"in o){const{phone:g,type:j,options:Z}=o,{data:S,error:n}=await Wr(this.fetch,"POST",d,{headers:this.headers,body:{phone:g,type:j,gotrue_meta_security:{captcha_token:Z?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:S?.message_id},error:n})}throw new V0("You must provide either an email or phone number and a type")}catch(d){if(vr(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async d=>d))}async _acquireLock(o,d){this._debug("#_acquireLock","begin",o);try{if(this.lockAcquired){const g=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),j=(async()=>(await g,await d()))();return this.pendingInLock.push((async()=>{try{await j}catch{}})()),j}return await this.lock(`lock:${this.storageKey}`,o,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const g=d();for(this.pendingInLock.push((async()=>{try{await g}catch{}})()),await g;this.pendingInLock.length;){const j=[...this.pendingInLock];await Promise.all(j),this.pendingInLock.splice(0,j.length)}return await g}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(o){this._debug("#_useSession","begin");try{const d=await this.__loadSession();return await o(d)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let o=null;const d=await Ip(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",d),d!==null&&(this._isValidSession(d)?o=d:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!o)return{data:{session:null},error:null};const g=o.expires_at?o.expires_at*1e3-Date.now()<Xx:!1;if(this._debug("#__loadSession()",`session has${g?"":" not"} expired`,"expires_at",o.expires_at),!g){if(this.userStorage){const S=await Ip(this.userStorage,this.storageKey+"-user");S?.user?o.user=S.user:o.user=Yx()}if(this.storage.isServer&&o.user&&!o.user.__isUserNotAvailableProxy){const S={value:this.suppressGetSessionWarning};o.user=GV(o.user,S),S.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:o},error:null}}const{data:j,error:Z}=await this._callRefreshToken(o.refresh_token);return Z?this._returnResult({data:{session:null},error:Z}):this._returnResult({data:{session:j},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(o){return o?await this._getUser(o):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(o){try{return o?await Wr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:o,xform:Xf}):await this._useSession(async d=>{var g,j,Z;const{data:S,error:n}=d;if(n)throw n;return!(!((g=S.session)===null||g===void 0)&&g.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Xu}:await Wr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(Z=(j=S.session)===null||j===void 0?void 0:j.access_token)!==null&&Z!==void 0?Z:void 0,xform:Xf})})}catch(d){if(vr(d))return bV(d)&&(await this._removeSession(),await Uf(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:d});throw d}}async updateUser(o,d={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(o,d))}async _updateUser(o,d={}){try{return await this._useSession(async g=>{const{data:j,error:Z}=g;if(Z)throw Z;if(!j.session)throw new Xu;const S=j.session;let n=null,B=null;this.flowType==="pkce"&&o.email!=null&&([n,B]=await km(this.storage,this.storageKey));const{data:D,error:P}=await Wr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:Object.assign(Object.assign({},o),{code_challenge:n,code_challenge_method:B}),jwt:S.access_token,xform:Xf});if(P)throw P;return S.user=D.user,await this._saveSession(S),await this._notifyAllSubscribers("USER_UPDATED",S),this._returnResult({data:{user:S.user},error:null})})}catch(g){if(vr(g))return this._returnResult({data:{user:null},error:g});throw g}}async setSession(o){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(o))}async _setSession(o){try{if(!o.access_token||!o.refresh_token)throw new Xu;const d=Date.now()/1e3;let g=d,j=!0,Z=null;const{payload:S}=Hx(o.access_token);if(S.exp&&(g=S.exp,j=g<=d),j){const{data:n,error:B}=await this._callRefreshToken(o.refresh_token);if(B)return this._returnResult({data:{user:null,session:null},error:B});if(!n)return{data:{user:null,session:null},error:null};Z=n}else{const{data:n,error:B}=await this._getUser(o.access_token);if(B)throw B;Z={access_token:o.access_token,refresh_token:o.refresh_token,user:n.user,token_type:"bearer",expires_in:g-d,expires_at:g},await this._saveSession(Z),await this._notifyAllSubscribers("SIGNED_IN",Z)}return this._returnResult({data:{user:Z.user,session:Z},error:null})}catch(d){if(vr(d))return this._returnResult({data:{session:null,user:null},error:d});throw d}}async refreshSession(o){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(o))}async _refreshSession(o){try{return await this._useSession(async d=>{var g;if(!o){const{data:S,error:n}=d;if(n)throw n;o=(g=S.session)!==null&&g!==void 0?g:void 0}if(!o?.refresh_token)throw new Xu;const{data:j,error:Z}=await this._callRefreshToken(o.refresh_token);return Z?this._returnResult({data:{user:null,session:null},error:Z}):j?this._returnResult({data:{user:j.user,session:j},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(d){if(vr(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async _getSessionFromURL(o,d){try{if(!So())throw new M0("No browser detected.");if(o.error||o.error_description||o.error_code)throw new M0(o.error_description||"Error in URL with unspecified error_description",{error:o.error||"unspecified_error",code:o.error_code||"unspecified_code"});switch(d){case"implicit":if(this.flowType==="pkce")throw new cL("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new M0("Not a valid implicit grant flow url.");break;default:}if(d==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!o.code)throw new cL("No code detected.");const{data:ke,error:ye}=await this._exchangeCodeForSession(o.code);if(ye)throw ye;const $e=new URL(window.location.href);return $e.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$e.toString()),{data:{session:ke.session,redirectType:null},error:null}}const{provider_token:g,provider_refresh_token:j,access_token:Z,refresh_token:S,expires_in:n,expires_at:B,token_type:D}=o;if(!Z||!n||!S||!D)throw new M0("No session defined in URL");const P=Math.round(Date.now()/1e3),G=parseInt(n);let Y=P+G;B&&(Y=parseInt(B));const X=Y-P;X*1e3<=Wm&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${X}s, should have been closer to ${G}s`);const ue=Y-G;P-ue>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",ue,Y,P):P-ue<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",ue,Y,P);const{data:oe,error:pe}=await this._getUser(Z);if(pe)throw pe;const ve={provider_token:g,provider_refresh_token:j,access_token:Z,expires_in:G,expires_at:Y,refresh_token:S,token_type:D,user:oe.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:ve,redirectType:o.type},error:null})}catch(g){if(vr(g))return this._returnResult({data:{session:null,redirectType:null},error:g});throw g}}_isImplicitGrantCallback(o){return!!(o.access_token||o.error_description)}async _isPKCECallback(o){const d=await Ip(this.storage,`${this.storageKey}-code-verifier`);return!!(o.code&&d)}async signOut(o={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(o))}async _signOut({scope:o}={scope:"global"}){return await this._useSession(async d=>{var g;const{data:j,error:Z}=d;if(Z)return this._returnResult({error:Z});const S=(g=j.session)===null||g===void 0?void 0:g.access_token;if(S){const{error:n}=await this.admin.signOut(S,o);if(n&&!(vV(n)&&(n.status===404||n.status===401||n.status===403)))return this._returnResult({error:n})}return o!=="others"&&(await this._removeSession(),await Uf(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(o){const d=AV(),g={id:d,callback:o,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",d),this.stateChangeEmitters.delete(d)}};return this._debug("#onAuthStateChange()","registered callback with id",d),this.stateChangeEmitters.set(d,g),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(d)})))(),{data:{subscription:g}}}async _emitInitialSession(o){return await this._useSession(async d=>{var g,j;try{const{data:{session:Z},error:S}=d;if(S)throw S;await((g=this.stateChangeEmitters.get(o))===null||g===void 0?void 0:g.callback("INITIAL_SESSION",Z)),this._debug("INITIAL_SESSION","callback id",o,"session",Z)}catch(Z){await((j=this.stateChangeEmitters.get(o))===null||j===void 0?void 0:j.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",o,"error",Z),console.error(Z)}})}async resetPasswordForEmail(o,d={}){let g=null,j=null;this.flowType==="pkce"&&([g,j]=await km(this.storage,this.storageKey,!0));try{return await Wr(this.fetch,"POST",`${this.url}/recover`,{body:{email:o,code_challenge:g,code_challenge_method:j,gotrue_meta_security:{captcha_token:d.captchaToken}},headers:this.headers,redirectTo:d.redirectTo})}catch(Z){if(vr(Z))return this._returnResult({data:null,error:Z});throw Z}}async getUserIdentities(){var o;try{const{data:d,error:g}=await this.getUser();if(g)throw g;return this._returnResult({data:{identities:(o=d.user.identities)!==null&&o!==void 0?o:[]},error:null})}catch(d){if(vr(d))return this._returnResult({data:null,error:d});throw d}}async linkIdentity(o){return"token"in o?this.linkIdentityIdToken(o):this.linkIdentityOAuth(o)}async linkIdentityOAuth(o){var d;try{const{data:g,error:j}=await this._useSession(async Z=>{var S,n,B,D,P;const{data:G,error:Y}=Z;if(Y)throw Y;const X=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,o.provider,{redirectTo:(S=o.options)===null||S===void 0?void 0:S.redirectTo,scopes:(n=o.options)===null||n===void 0?void 0:n.scopes,queryParams:(B=o.options)===null||B===void 0?void 0:B.queryParams,skipBrowserRedirect:!0});return await Wr(this.fetch,"GET",X,{headers:this.headers,jwt:(P=(D=G.session)===null||D===void 0?void 0:D.access_token)!==null&&P!==void 0?P:void 0})});if(j)throw j;return So()&&!(!((d=o.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(g?.url),this._returnResult({data:{provider:o.provider,url:g?.url},error:null})}catch(g){if(vr(g))return this._returnResult({data:{provider:o.provider,url:null},error:g});throw g}}async linkIdentityIdToken(o){return await this._useSession(async d=>{var g;try{const{error:j,data:{session:Z}}=d;if(j)throw j;const{options:S,provider:n,token:B,access_token:D,nonce:P}=o,G=await Wr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(g=Z?.access_token)!==null&&g!==void 0?g:void 0,body:{provider:n,id_token:B,access_token:D,nonce:P,link_identity:!0,gotrue_meta_security:{captcha_token:S?.captchaToken}},xform:Qu}),{data:Y,error:X}=G;return X?this._returnResult({data:{user:null,session:null},error:X}):!Y||!Y.session||!Y.user?this._returnResult({data:{user:null,session:null},error:new Im}):(Y.session&&(await this._saveSession(Y.session),await this._notifyAllSubscribers("USER_UPDATED",Y.session)),this._returnResult({data:Y,error:X}))}catch(j){if(vr(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}})}async unlinkIdentity(o){try{return await this._useSession(async d=>{var g,j;const{data:Z,error:S}=d;if(S)throw S;return await Wr(this.fetch,"DELETE",`${this.url}/user/identities/${o.identity_id}`,{headers:this.headers,jwt:(j=(g=Z.session)===null||g===void 0?void 0:g.access_token)!==null&&j!==void 0?j:void 0})})}catch(d){if(vr(d))return this._returnResult({data:null,error:d});throw d}}async _refreshAccessToken(o){const d=`#_refreshAccessToken(${o.substring(0,5)}...)`;this._debug(d,"begin");try{const g=Date.now();return await MV(async j=>(j>0&&await VV(200*Math.pow(2,j-1)),this._debug(d,"refreshing attempt",j),await Wr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:o},headers:this.headers,xform:Qu})),(j,Z)=>{const S=200*Math.pow(2,j);return Z&&Qx(Z)&&Date.now()+S-g<Wm})}catch(g){if(this._debug(d,"error",g),vr(g))return this._returnResult({data:{session:null,user:null},error:g});throw g}finally{this._debug(d,"end")}}_isValidSession(o){return typeof o=="object"&&o!==null&&"access_token"in o&&"refresh_token"in o&&"expires_at"in o}async _handleProviderSignIn(o,d){const g=await this._getUrlForProvider(`${this.url}/authorize`,o,{redirectTo:d.redirectTo,scopes:d.scopes,queryParams:d.queryParams});return this._debug("#_handleProviderSignIn()","provider",o,"options",d,"url",g),So()&&!d.skipBrowserRedirect&&window.location.assign(g),{data:{provider:o,url:g},error:null}}async _recoverAndRefresh(){var o,d;const g="#_recoverAndRefresh()";this._debug(g,"begin");try{const j=await Ip(this.storage,this.storageKey);if(j&&this.userStorage){let S=await Ip(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!S&&(S={user:j.user},await Xm(this.userStorage,this.storageKey+"-user",S)),j.user=(o=S?.user)!==null&&o!==void 0?o:Yx()}else if(j&&!j.user&&!j.user){const S=await Ip(this.storage,this.storageKey+"-user");S&&S?.user?(j.user=S.user,await Uf(this.storage,this.storageKey+"-user"),await Xm(this.storage,this.storageKey,j)):j.user=Yx()}if(this._debug(g,"session from storage",j),!this._isValidSession(j)){this._debug(g,"session is not valid"),j!==null&&await this._removeSession();return}const Z=((d=j.expires_at)!==null&&d!==void 0?d:1/0)*1e3-Date.now()<Xx;if(this._debug(g,`session has${Z?"":" not"} expired with margin of ${Xx}s`),Z){if(this.autoRefreshToken&&j.refresh_token){const{error:S}=await this._callRefreshToken(j.refresh_token);S&&(console.error(S),Qx(S)||(this._debug(g,"refresh failed with a non-retryable error, removing the session",S),await this._removeSession()))}}else if(j.user&&j.user.__isUserNotAvailableProxy===!0)try{const{data:S,error:n}=await this._getUser(j.access_token);!n&&S?.user?(j.user=S.user,await this._saveSession(j),await this._notifyAllSubscribers("SIGNED_IN",j)):this._debug(g,"could not get user data, skipping SIGNED_IN notification")}catch(S){console.error("Error getting user data:",S),this._debug(g,"error getting user data, skipping SIGNED_IN notification",S)}else await this._notifyAllSubscribers("SIGNED_IN",j)}catch(j){this._debug(g,"error",j),console.error(j);return}finally{this._debug(g,"end")}}async _callRefreshToken(o){var d,g;if(!o)throw new Xu;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const j=`#_callRefreshToken(${o.substring(0,5)}...)`;this._debug(j,"begin");try{this.refreshingDeferred=new m_;const{data:Z,error:S}=await this._refreshAccessToken(o);if(S)throw S;if(!Z.session)throw new Xu;await this._saveSession(Z.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",Z.session);const n={data:Z.session,error:null};return this.refreshingDeferred.resolve(n),n}catch(Z){if(this._debug(j,"error",Z),vr(Z)){const S={data:null,error:Z};return Qx(Z)||await this._removeSession(),(d=this.refreshingDeferred)===null||d===void 0||d.resolve(S),S}throw(g=this.refreshingDeferred)===null||g===void 0||g.reject(Z),Z}finally{this.refreshingDeferred=null,this._debug(j,"end")}}async _notifyAllSubscribers(o,d,g=!0){const j=`#_notifyAllSubscribers(${o})`;this._debug(j,"begin",d,`broadcast = ${g}`);try{this.broadcastChannel&&g&&this.broadcastChannel.postMessage({event:o,session:d});const Z=[],S=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(o,d)}catch(B){Z.push(B)}});if(await Promise.all(S),Z.length>0){for(let n=0;n<Z.length;n+=1)console.error(Z[n]);throw Z[0]}}finally{this._debug(j,"end")}}async _saveSession(o){this._debug("#_saveSession()",o),this.suppressGetSessionWarning=!0;const d=Object.assign({},o),g=d.user&&d.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!g&&d.user&&await Xm(this.userStorage,this.storageKey+"-user",{user:d.user});const j=Object.assign({},d);delete j.user;const Z=pL(j);await Xm(this.storage,this.storageKey,Z)}else{const j=pL(d);await Xm(this.storage,this.storageKey,j)}}async _removeSession(){this._debug("#_removeSession()"),await Uf(this.storage,this.storageKey),await Uf(this.storage,this.storageKey+"-code-verifier"),await Uf(this.storage,this.storageKey+"-user"),this.userStorage&&await Uf(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const o=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{o&&So()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",o)}catch(d){console.error("removing visibilitychange callback failed",d)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const o=setInterval(()=>this._autoRefreshTokenTick(),Wm);this.autoRefreshTicker=o,o&&typeof o=="object"&&typeof o.unref=="function"?o.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(o),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const o=this.autoRefreshTicker;this.autoRefreshTicker=null,o&&clearInterval(o)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const o=Date.now();try{return await this._useSession(async d=>{const{data:{session:g}}=d;if(!g||!g.refresh_token||!g.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const j=Math.floor((g.expires_at*1e3-o)/Wm);this._debug("#_autoRefreshTokenTick()",`access token expires in ${j} ticks, a tick lasts ${Wm}ms, refresh threshold is ${Aw} ticks`),j<=Aw&&await this._callRefreshToken(g.refresh_token)})}catch(d){console.error("Auto refresh tick failed with error. This is likely a transient error.",d)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(o){if(o.isAcquireTimeout||o instanceof FZ)this._debug("auto refresh token tick lock not available");else throw o}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!So()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(o){console.error("_handleVisibilityChange",o)}}async _onVisibilityChanged(o){const d=`#_onVisibilityChanged(${o})`;this._debug(d,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),o||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(d,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(o,d,g){const j=[`provider=${encodeURIComponent(d)}`];if(g?.redirectTo&&j.push(`redirect_to=${encodeURIComponent(g.redirectTo)}`),g?.scopes&&j.push(`scopes=${encodeURIComponent(g.scopes)}`),this.flowType==="pkce"){const[Z,S]=await km(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:`${encodeURIComponent(Z)}`,code_challenge_method:`${encodeURIComponent(S)}`});j.push(n.toString())}if(g?.queryParams){const Z=new URLSearchParams(g.queryParams);j.push(Z.toString())}return g?.skipBrowserRedirect&&j.push(`skip_http_redirect=${g.skipBrowserRedirect}`),`${o}?${j.join("&")}`}async _unenroll(o){try{return await this._useSession(async d=>{var g;const{data:j,error:Z}=d;return Z?this._returnResult({data:null,error:Z}):await Wr(this.fetch,"DELETE",`${this.url}/factors/${o.factorId}`,{headers:this.headers,jwt:(g=j?.session)===null||g===void 0?void 0:g.access_token})})}catch(d){if(vr(d))return this._returnResult({data:null,error:d});throw d}}async _enroll(o){try{return await this._useSession(async d=>{var g,j;const{data:Z,error:S}=d;if(S)return this._returnResult({data:null,error:S});const n=Object.assign({friendly_name:o.friendlyName,factor_type:o.factorType},o.factorType==="phone"?{phone:o.phone}:o.factorType==="totp"?{issuer:o.issuer}:{}),{data:B,error:D}=await Wr(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:(g=Z?.session)===null||g===void 0?void 0:g.access_token});return D?this._returnResult({data:null,error:D}):(o.factorType==="totp"&&B.type==="totp"&&(!((j=B?.totp)===null||j===void 0)&&j.qr_code)&&(B.totp.qr_code=`data:image/svg+xml;utf-8,${B.totp.qr_code}`),this._returnResult({data:B,error:null}))})}catch(d){if(vr(d))return this._returnResult({data:null,error:d});throw d}}async _verify(o){return this._acquireLock(-1,async()=>{try{return await this._useSession(async d=>{var g;const{data:j,error:Z}=d;if(Z)return this._returnResult({data:null,error:Z});const S=Object.assign({challenge_id:o.challengeId},"webauthn"in o?{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_response:o.webauthn.type==="create"?uM(o.webauthn.credential_response):dM(o.webauthn.credential_response)})}:{code:o.code}),{data:n,error:B}=await Wr(this.fetch,"POST",`${this.url}/factors/${o.factorId}/verify`,{body:S,headers:this.headers,jwt:(g=j?.session)===null||g===void 0?void 0:g.access_token});return B?this._returnResult({data:null,error:B}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),this._returnResult({data:n,error:B}))})}catch(d){if(vr(d))return this._returnResult({data:null,error:d});throw d}})}async _challenge(o){return this._acquireLock(-1,async()=>{try{return await this._useSession(async d=>{var g;const{data:j,error:Z}=d;if(Z)return this._returnResult({data:null,error:Z});const S=await Wr(this.fetch,"POST",`${this.url}/factors/${o.factorId}/challenge`,{body:o,headers:this.headers,jwt:(g=j?.session)===null||g===void 0?void 0:g.access_token});if(S.error)return S;const{data:n}=S;if(n.type!=="webauthn")return{data:n,error:null};switch(n.webauthn.type){case"create":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:lM(n.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:cM(n.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(d){if(vr(d))return this._returnResult({data:null,error:d});throw d}})}async _challengeAndVerify(o){const{data:d,error:g}=await this._challenge({factorId:o.factorId});return g?this._returnResult({data:null,error:g}):await this._verify({factorId:o.factorId,challengeId:d.id,code:o.code})}async _listFactors(){var o;const{data:{user:d},error:g}=await this.getUser();if(g)return{data:null,error:g};const j={all:[],phone:[],totp:[],webauthn:[]};for(const Z of(o=d?.factors)!==null&&o!==void 0?o:[])j.all.push(Z),Z.status==="verified"&&j[Z.factor_type].push(Z);return{data:j,error:null}}async _getAuthenticatorAssuranceLevel(){var o,d;const{data:{session:g},error:j}=await this.getSession();if(j)return this._returnResult({data:null,error:j});if(!g)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:Z}=Hx(g.access_token);let S=null;Z.aal&&(S=Z.aal);let n=S;((d=(o=g.user.factors)===null||o===void 0?void 0:o.filter(P=>P.status==="verified"))!==null&&d!==void 0?d:[]).length>0&&(n="aal2");const D=Z.amr||[];return{data:{currentLevel:S,nextLevel:n,currentAuthenticationMethods:D},error:null}}async _getAuthorizationDetails(o){try{return await this._useSession(async d=>{const{data:{session:g},error:j}=d;return j?this._returnResult({data:null,error:j}):g?await Wr(this.fetch,"GET",`${this.url}/oauth/authorizations/${o}`,{headers:this.headers,jwt:g.access_token,xform:Z=>({data:Z,error:null})}):this._returnResult({data:null,error:new Xu})})}catch(d){if(vr(d))return this._returnResult({data:null,error:d});throw d}}async _approveAuthorization(o,d){try{return await this._useSession(async g=>{const{data:{session:j},error:Z}=g;if(Z)return this._returnResult({data:null,error:Z});if(!j)return this._returnResult({data:null,error:new Xu});const S=await Wr(this.fetch,"POST",`${this.url}/oauth/authorizations/${o}/consent`,{headers:this.headers,jwt:j.access_token,body:{action:"approve"},xform:n=>({data:n,error:null})});return S.data&&S.data.redirect_url&&So()&&!d?.skipBrowserRedirect&&window.location.assign(S.data.redirect_url),S})}catch(g){if(vr(g))return this._returnResult({data:null,error:g});throw g}}async _denyAuthorization(o,d){try{return await this._useSession(async g=>{const{data:{session:j},error:Z}=g;if(Z)return this._returnResult({data:null,error:Z});if(!j)return this._returnResult({data:null,error:new Xu});const S=await Wr(this.fetch,"POST",`${this.url}/oauth/authorizations/${o}/consent`,{headers:this.headers,jwt:j.access_token,body:{action:"deny"},xform:n=>({data:n,error:null})});return S.data&&S.data.redirect_url&&So()&&!d?.skipBrowserRedirect&&window.location.assign(S.data.redirect_url),S})}catch(g){if(vr(g))return this._returnResult({data:null,error:g});throw g}}async fetchJwk(o,d={keys:[]}){let g=d.keys.find(n=>n.kid===o);if(g)return g;const j=Date.now();if(g=this.jwks.keys.find(n=>n.kid===o),g&&this.jwks_cached_at+xV>j)return g;const{data:Z,error:S}=await Wr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(S)throw S;return!Z.keys||Z.keys.length===0||(this.jwks=Z,this.jwks_cached_at=j,g=Z.keys.find(n=>n.kid===o),!g)?null:g}async getClaims(o,d={}){try{let g=o;if(!g){const{data:X,error:ue}=await this.getSession();if(ue||!X.session)return this._returnResult({data:null,error:ue});g=X.session.access_token}const{header:j,payload:Z,signature:S,raw:{header:n,payload:B}}=Hx(g);d?.allowExpired||DV(Z.exp);const D=!j.alg||j.alg.startsWith("HS")||!j.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(j.kid,d?.keys?{keys:d.keys}:d?.jwks);if(!D){const{error:X}=await this.getUser(g);if(X)throw X;return{data:{claims:Z,header:j,signature:S},error:null}}const P=CV(j.alg),G=await crypto.subtle.importKey("jwk",D,P,!0,["verify"]);if(!await crypto.subtle.verify(P,G,S,SV(`${n}.${B}`)))throw new Vw("Invalid JWT signature");return{data:{claims:Z,header:j,signature:S},error:null}}catch(g){if(vr(g))return this._returnResult({data:null,error:g});throw g}}}wg.nextInstanceID={};const wM=wg;class vM extends wM{constructor(o){super(o)}}class bM{constructor(o,d,g){var j,Z,S;this.supabaseUrl=o,this.supabaseKey=d;const n=pV(o);if(!d)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);const B=`sb-${n.hostname.split(".")[0]}-auth-token`,D={db:sV,realtime:lV,auth:Object.assign(Object.assign({},oV),{storageKey:B}),global:iV},P=fV(g??{},D);this.storageKey=(j=P.auth.storageKey)!==null&&j!==void 0?j:"",this.headers=(Z=P.global.headers)!==null&&Z!==void 0?Z:{},P.accessToken?(this.accessToken=P.accessToken,this.auth=new Proxy({},{get:(G,Y)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(Y)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((S=P.auth)!==null&&S!==void 0?S:{},this.headers,P.global.fetch),this.fetch=dV(d,this._getAccessToken.bind(this),P.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},P.realtime)),this.accessToken&&this.accessToken().then(G=>this.realtime.setAuth(G)).catch(G=>console.warn("Failed to set initial Realtime auth token:",G)),this.rest=new mT(new URL("rest/v1",n).href,{headers:this.headers,schema:P.db.schema,fetch:this.fetch}),this.storage=new aV(this.storageUrl.href,this.headers,this.fetch,g?.storage),P.accessToken||this._listenForAuthEvents()}get functions(){return new dT(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(o){return this.rest.from(o)}schema(o){return this.rest.schema(o)}rpc(o,d={},g={head:!1,get:!1,count:void 0}){return this.rest.rpc(o,d,g)}channel(o,d={config:{}}){return this.realtime.channel(o,d)}getChannels(){return this.realtime.getChannels()}removeChannel(o){return this.realtime.removeChannel(o)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var o,d;if(this.accessToken)return await this.accessToken();const{data:g}=await this.auth.getSession();return(d=(o=g.session)===null||o===void 0?void 0:o.access_token)!==null&&d!==void 0?d:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:o,persistSession:d,detectSessionInUrl:g,storage:j,userStorage:Z,storageKey:S,flowType:n,lock:B,debug:D,throwOnError:P},G,Y){const X={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new vM({url:this.authUrl.href,headers:Object.assign(Object.assign({},X),G),storageKey:S,autoRefreshToken:o,persistSession:d,detectSessionInUrl:g,storage:j,userStorage:Z,flowType:n,lock:B,debug:D,throwOnError:P,fetch:Y,hasCustomAuthorizationHeader:Object.keys(this.headers).some(ue=>ue.toLowerCase()==="authorization")})}_initRealtimeClient(o){return new TT(this.realtimeUrl.href,Object.assign(Object.assign({},o),{params:Object.assign({apikey:this.supabaseKey},o?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((d,g)=>{this._handleTokenChanged(d,"CLIENT",g?.access_token)})}_handleTokenChanged(o,d,g){(o==="TOKEN_REFRESHED"||o==="SIGNED_IN")&&this.changedAccessToken!==g?(this.changedAccessToken=g,this.realtime.setAuth(g)):o==="SIGNED_OUT"&&(this.realtime.setAuth(),d=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const LM=(u,o,d)=>new bM(u,o,d);function jM(){if(typeof window<"u"||typeof process>"u")return!1;const u=process.version;if(u==null)return!1;const o=u.match(/^v(\d+)\./);return o?parseInt(o[1],10)<=18:!1}jM()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ZM="https://fewhwgvlgstmukhebyvz.supabase.co",NM="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZld2h3Z3ZsZ3N0bXVraGVieXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxNDY0NDEsImV4cCI6MjA3ODcyMjQ0MX0.Sgw13uQNKId3j3MsT-L5Ae8_oRnWTNvBw480BfS0e-I",It=LM(ZM,NM,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});function Wn(u,o){console.error("Supabase error:",u);const d=o||u.message||"An error occurred with the database";throw new Error(d)}async function ui(){try{const{data:{user:u},error:o}=await It.auth.getUser();if(o||!u)return null;const{data:d,error:g}=await It.from("profiles").select("id, email, name, user_type, profile_image").eq("id",u.id).single();return g||!d?null:{id:d.id,email:d.email,name:d.name,userType:d.user_type,profilePicture:d.profile_image}}catch(u){return console.error("Error getting current user:",u),null}}async function CZ(){try{await It.auth.signOut()}catch(u){throw console.error("Error signing out:",u),u}}function EM(u){const{data:{subscription:o}}=It.auth.onAuthStateChange(async(d,g)=>{if(g?.user){const j=await ui();u(j)}else u(null)});return o}/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SM=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),zM=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(o,d,g)=>g?g.toUpperCase():d.toLowerCase()),vL=u=>{const o=zM(u);return o.charAt(0).toUpperCase()+o.slice(1)},PZ=(...u)=>u.filter((o,d,g)=>!!o&&o.trim()!==""&&g.indexOf(o)===d).join(" ").trim(),AM=u=>{for(const o in u)if(o.startsWith("aria-")||o==="role"||o==="title")return!0};/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var RM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=fe.forwardRef(({color:u="currentColor",size:o=24,strokeWidth:d=2,absoluteStrokeWidth:g,className:j="",children:Z,iconNode:S,...n},B)=>fe.createElement("svg",{ref:B,...RM,width:o,height:o,stroke:u,strokeWidth:g?Number(d)*24/Number(o):d,className:PZ("lucide",j),...!Z&&!AM(n)&&{"aria-hidden":"true"},...n},[...S.map(([D,P])=>fe.createElement(D,P)),...Array.isArray(Z)?Z:[Z]]));/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=(u,o)=>{const d=fe.forwardRef(({className:g,...j},Z)=>fe.createElement(TM,{ref:Z,iconNode:o,className:PZ(`lucide-${SM(vL(u))}`,`lucide-${u}`,g),...j}));return d.displayName=vL(u),d};/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VM=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ei=dr("arrow-left",VM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MM=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Xh=dr("bell",MM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BM=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],GZ=dr("book-open",BM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IM=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],bl=dr("calendar",IM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kM=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Km=dr("camera",kM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JM=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],Wp=dr("car",JM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FM=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],bL=dr("check-check",FM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Hp=dr("check",OM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],zg=dr("chevron-right",DM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CM=[["path",{d:"M17 12H3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h14",key:"1mb5g1"}],["path",{d:"M18 8c0-2.5-2-2.5-2-5",key:"1il607"}],["path",{d:"M21 16a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"1yl5r7"}],["path",{d:"M22 8c0-2.5-2-2.5-2-5",key:"1gah44"}],["path",{d:"M7 12v4",key:"jqww69"}]],PM=dr("cigarette",CM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Kc=dr("circle-alert",GM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UM=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Hd=dr("circle-check-big",UM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],XM=dr("circle-plus",WM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],HM=dr("circle-user",QM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Gp=dr("circle-x",YM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $M=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ws=dr("clock",$M);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qM=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],KM=dr("copy",qM);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eB=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Ag=dr("credit-card",eB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tB=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Ho=dr("dollar-sign",tB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aB=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],rB=dr("ellipsis-vertical",aB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nB=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],UZ=dr("file-check",nB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iB=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ey=dr("file-text",iB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sB=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],a_=dr("gift",sB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oB=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],lB=dr("heart",oB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cB=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],uB=dr("history",cB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dB=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],hB=dr("house",dB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fB=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],pB=dr("loader-circle",fB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mB=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],r_=dr("loader",mB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yB=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],LL=dr("lock",yB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gB=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],WZ=dr("log-out",gB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _B=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Yo=dr("map-pin",_B);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xB=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],eu=dr("message-circle",xB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wB=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],uv=dr("message-square",wB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vB=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],bB=dr("music",vB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LB=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],Xp=dr("navigation",LB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jB=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ty=dr("pen",jB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZB=[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Up=dr("phone-call",ZB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NB=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],EB=dr("plus",NB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SB=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],dv=dr("refresh-cw",SB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zB=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],oy=dr("save",zB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=[["path",{d:"m8 11 2 2 4-4",key:"1sed1v"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],RB=dr("search-check",AB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TB=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],XZ=dr("search",TB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VB=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],y_=dr("send",VB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],BB=dr("settings",MB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IB=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],kB=dr("share-2",IB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JB=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],FB=dr("shield-check",JB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OB=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],DB=dr("shield",OB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],PB=dr("smile",CB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GB=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],UB=dr("square-pen",GB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WB=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],vs=dr("star",WB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XB=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],QB=dr("trash-2",XB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HB=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Yp=dr("trending-up",HB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YB=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Qh=dr("triangle-alert",YB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $B=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],QZ=dr("upload",$B);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qB=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],vg=dr("user",qB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KB=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Yd=dr("users",KB);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eI=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],tI=dr("wind",eI);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aI=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],lo=dr("x",aI);/**
 * @license lucide-react v0.533.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rI=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],nI=dr("zap",rI);function iI(){const u=on();return fe.useEffect(()=>{const o=setTimeout(()=>{u("/auth")},3e3);return()=>clearTimeout(o)},[u]),l.jsx("div",{className:"w-full h-dvh bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-600","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAxODo0","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAxOTo2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 text-center space-y-6","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAyNzo4","data-yw-s":!0,children:[l.jsx("div",{className:"w-24 h-24 bg-white rounded-3xl flex items-center justify-center shadow-2xl","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAyOToxMA","data-yw-s":!0,children:l.jsx("span",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAzMDoxMg","data-yw-t":!0,"data-yw-s":!0,children:"OG"})}),l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAzNjoxMA","data-yw-s":!0,children:[l.jsx("h1",{className:"text-4xl font-bold text-white","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAzNzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"OnGoPool"}),l.jsx("p",{className:"text-xl text-blue-100","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEAzODoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Share rides, save money, go green"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full max-w-sm mt-8","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA0MjoxMA","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-white","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA0MzoxMg","data-yw-s":!0,children:[l.jsx(Wp,{className:"w-8 h-8 mb-2 mx-auto","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA0NDoxNA","data-yw-s":!0}),l.jsx("div",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA0NToxNA","data-yw-t":!0,"data-yw-s":!0,children:"Easy Booking"})]}),l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-white","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA0NzoxMg","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-8 h-8 mb-2 mx-auto","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA0ODoxNA","data-yw-s":!0}),l.jsx("div",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA0OToxNA","data-yw-t":!0,"data-yw-s":!0,children:"Safe Community"})]}),l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-white","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA1MToxMg","data-yw-s":!0,children:[l.jsx(DB,{className:"w-8 h-8 mb-2 mx-auto","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA1MjoxNA","data-yw-s":!0}),l.jsx("div",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA1MzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Verified Drivers"})]}),l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 text-white","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA1NToxMg","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-8 h-8 mb-2 mx-auto","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA1NjoxNA","data-yw-s":!0}),l.jsx("div",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA1NzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Save Money"})]})]})]}),l.jsx("div",{className:"flex-none px-6 pb-8","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA2Mzo4","data-yw-s":!0,children:l.jsx("p",{className:"text-center text-sm text-blue-100","data-yw":"c3JjL3BhZ2VzL1dlbGNvbWVQYWdlLnRzeEA2NDoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Join thousands of happy carpoolers"})})]})})}function bg({src:u,alt:o,className:d}){const[g,j]=fe.useState(!1),[Z,S]=fe.useState(!1),B=(D=>{if(!D)return null;if(D.includes("supabase.co/storage")){const P=D.includes("?")?"&":"?";return`${D}${P}width=200&height=200&quality=80`}return D})(u);return B?l.jsxs("div",{className:`${d} relative`,"data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEA0Mjo0","data-yw-s":!0,children:[!g&&!Z&&l.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse rounded-full","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEA0NDo4","data-yw-s":!0}),!Z&&l.jsx("img",{src:B,alt:o,className:`${d} ${g?"opacity-100":"opacity-0"} transition-opacity duration-300`,loading:"lazy",onLoad:()=>j(!0),onError:()=>{console.warn(`Failed to load image: ${B}`),S(!0)},"data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEA0Nzo4","data-yw-s":!0}),Z&&l.jsx("div",{className:"absolute inset-0 bg-gray-200 rounded-full flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEA2MDo4","data-yw-s":!0,children:l.jsx(Km,{className:"w-6 h-6 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEA2MToxMA","data-yw-s":!0})})]}):l.jsx("div",{className:`${d} relative bg-gray-200 rounded-full flex items-center justify-center`,"data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAzNTo2","data-yw-s":!0,children:l.jsx(Km,{className:"w-6 h-6 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAzNjo4","data-yw-s":!0})})}function hv({onImageSelect:u,currentImage:o}){const d=fe.useRef(null),[g,j]=fe.useState(!1),Z=async D=>{const P=D.target.files?.[0];if(!P)return;if(P.size>5*1024*1024){alert("Image size should be less than 5MB");return}if(!P.type.startsWith("image/")){alert("Please select an image file");return}const G=await S(P);u(G)},S=D=>new Promise((P,G)=>{const Y=new FileReader;Y.onload=X=>{const ue=new Image;ue.onload=()=>{const oe=document.createElement("canvas"),pe=oe.getContext("2d"),ve=400;let ke=ue.width,ye=ue.height;ke>ye?ke>ve&&(ye=ye*ve/ke,ke=ve):ye>ve&&(ke=ke*ve/ye,ye=ve),oe.width=ke,oe.height=ye,pe?.drawImage(ue,0,0,ke,ye);const $e=oe.toDataURL("image/jpeg",.8);P($e)},ue.onerror=()=>G(new Error("Failed to load image")),ue.src=X.target?.result},Y.onerror=()=>G(new Error("Failed to read file")),Y.readAsDataURL(D)}),n=async()=>{j(!0);try{const D=document.createElement("input");D.type="file",D.accept="image/*",D.capture="user",D.onchange=async P=>{const G=P.target?.files?.[0];if(G){const Y=await S(G);u(Y)}j(!1)},D.click()}catch(D){console.error("Error capturing image:",D),alert("Failed to capture image. Please try uploading instead."),j(!1)}},B=()=>{u("")};return l.jsxs("div",{className:"flex flex-col items-center gap-4","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxNzM6NA","data-yw-s":!0,children:[l.jsx("div",{className:"relative","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxNzU6Ng","data-yw-s":!0,children:o?l.jsxs("div",{className:"relative","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxNzc6MTA","data-yw-s":!0,children:[l.jsx(bg,{src:o,alt:"Profile",className:"w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxNzg6MTI","data-yw-s":!0}),l.jsx("button",{onClick:B,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-md active:bg-red-600","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxODM6MTI","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxODc6MTQ","data-yw-s":!0})})]}):l.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center border-4 border-white shadow-lg","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxOTE6MTA","data-yw-s":!0,children:l.jsx(Km,{className:"w-12 h-12 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxOTI6MTI","data-yw-s":!0})})}),l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxOTg6Ng","data-yw-s":!0,children:[l.jsxs("button",{onClick:()=>d.current?.click(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium active:bg-blue-700 shadow-sm","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAxOTk6OA","data-yw-s":!0,children:[l.jsx(QZ,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMDM6MTA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMDM6NDA","data-yw-t":!0,"data-yw-auto":!0,children:"Upload"})]}),l.jsxs("button",{onClick:n,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg font-medium active:bg-gray-700 shadow-sm disabled:opacity-50","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMDY6OA","data-yw-s":!0,children:[l.jsx(Km,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMTE6MTA","data-yw-s":!0}),g?"Capturing...":"Camera"]})]}),l.jsx("input",{ref:d,type:"file",accept:"image/*",onChange:Z,className:"hidden","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMTY6Ng","data-yw-s":!0}),l.jsxs("p",{className:"text-xs text-gray-500 text-center","data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMjQ6Ng","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMjQ6NTU","data-yw-t":!0,"data-yw-auto":!0,children:"Max size: 5MB  Recommended: 400x400px"}),l.jsx("br",{"data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMjU6NDY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUHJvZmlsZVVwbG9hZGVyLnRzeEAyMjU6NTI","data-yw-t":!0,"data-yw-auto":!0,children:"Images are auto-optimized for faster loading"})]})]})}function sI(u,o){const d=u.substring(0,3).toUpperCase(),g=o.substring(0,6).toUpperCase();return`${d}${g}`}async function oI(u,o){try{const{data:d,error:g}=await It.from("referrals").select("*").eq("user_id",u).single();if(d)return d;const j=sI(o,u),{data:Z,error:S}=await It.from("referrals").insert([{user_id:u,referral_code:j,discount_percent:10,total_referrals:0,total_earned:0}]).select().single();if(S)throw S;return Z}catch(d){return console.error("Error getting/creating referral:",d),null}}async function lI(u){try{const{data:o,error:d}=await It.from("referral_uses").select("*").eq("referred_user_id",u).eq("status","pending").single();if(o)return{...o,discountType:"referred"};const{data:g,error:j}=await It.from("referral_uses").select("*").eq("referrer_id",u).eq("referrer_discount_status","pending").single();return g?{...g,discountType:"referrer"}:null}catch(o){return console.error("Error getting pending referral:",o),null}}async function cI(u,o){try{const{data:d,error:g}=await It.from("referrals").select("*").eq("referral_code",u).single();if(g||!d)return console.error("Invalid referral code"),!1;if(d.user_id===o)return console.error("Cannot use your own referral code"),!1;const{error:j}=await It.from("referral_uses").insert([{referral_code:u,referrer_id:d.user_id,referred_user_id:o,status:"pending"}]);if(j)throw j;const{error:Z}=await It.from("referrals").update({total_referrals:d.total_referrals+1}).eq("id",d.id);if(Z)throw Z;return!0}catch(d){return console.error("Error applying referral code:",d),!1}}async function uI(u){try{const{data:o}=await It.from("referrals").select("total_referrals, total_earned").eq("user_id",u).single();if(!o)return null;const{count:d}=await It.from("referral_uses").select("*",{count:"exact",head:!0}).eq("referrer_id",u).eq("status","pending");return{totalReferrals:o.total_referrals,totalEarned:o.total_earned,pendingReferrals:d||0}}catch(o){return console.error("Error getting referral stats:",o),null}}function dI(){const u=on(),[o,d]=fe.useState("login"),[g,j]=fe.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",dateOfBirth:"",address:"",city:"",state:"",zipCode:"",profilePicture:"",userType:"rider",referralCode:"",licenseNumber:"",licenseExpiry:"",vehicleMake:"",vehicleModel:"",vehicleYear:"",vehicleColor:"",vehiclePlate:""}),[Z,S]=fe.useState(!1),[n,B]=fe.useState(""),[D,P]=fe.useState(1),[G,Y]=fe.useState(""),[X,ue]=fe.useState(!1),oe=De=>{j({...g,[De.target.name]:De.target.value}),Y("")},pe=async De=>{De.preventDefault(),Y(""),ue(!0);try{const Te=It.auth.signInWithPassword({email:g.email,password:g.password}),Qe=new Promise((Qt,Gt)=>setTimeout(()=>Gt(new Error("Authentication timeout")),15e3)),{data:Ft,error:bt}=await Promise.race([Te,Qe]);if(bt){Y(bt.message),ue(!1);return}if(Ft.user){let Qt=null,Gt=null;for(let yt=0;yt<3;yt++)try{const Ke=It.from("profiles").select("user_type").eq("id",Ft.user.id).single(),st=new Promise((Wt,qt)=>setTimeout(()=>qt(new Error("Profile fetch timeout")),1e4)),ht=await Promise.race([Ke,st]);if(Qt=ht.data,Gt=ht.error,Qt)break;yt<2&&await new Promise(Wt=>setTimeout(Wt,1e3))}catch(Ke){Gt=Ke,yt<2&&await new Promise(st=>setTimeout(st,1e3))}Qt?.user_type==="driver"?u("/driver/home"):(Qt?.user_type==="rider"||console.warn("Profile fetch failed, using fallback navigation"),u("/rider/home"))}}catch(Te){console.error("Login error:",Te),Te.message==="Authentication timeout"?Y("Sign in is taking too long. Please check your internet connection and try again."):Y(Te.message||"An error occurred during login"),ue(!1)}},ve=De=>{if(De.preventDefault(),g.password!==g.confirmPassword){Y("Passwords do not match");return}if(g.password.length<6){Y("Password must be at least 6 characters");return}P(2)},ke=De=>{De.preventDefault(),g.userType==="driver"?P(3):$e()},ye=De=>{De.preventDefault(),$e()},$e=async()=>{Y("");try{const{data:De,error:Te}=await It.auth.signUp({email:g.email,password:g.password,options:{emailRedirectTo:window.location.origin,data:{name:g.name,user_type:g.userType}}});if(Te){Te.message.includes("Invalid API")?Y("Unable to connect to authentication service. Please check your internet connection and try again."):Te.message.includes("already registered")?Y("This email is already registered. Please login instead."):Y(Te.message),P(1);return}if(!De.user){Y("Failed to create user account. Please try again."),P(1);return}if(De.user&&!De.session){Y("Please check your email to confirm your account before logging in."),P(1);return}const{error:Qe}=await It.from("profiles").insert({id:De.user.id,email:g.email,name:g.name,phone:g.phone||null,address:g.address||null,city:g.city||null,state:g.state||null,zipcode:g.zipCode||null,user_type:g.userType,profile_image:g.profilePicture||null,bio:null,rating:5,total_trips:0,verified:!1});if(Qe){Y("Failed to create user profile: "+Qe.message),P(1);return}const{error:Ft}=await It.from("user_preferences").insert({user_id:De.user.id,address:g.address,city:g.city,state:g.state,zip_code:g.zipCode,date_of_birth:g.dateOfBirth||null});if(Ft&&console.error("Failed to create user preferences:",Ft),g.userType==="driver"){const{error:bt}=await It.from("car_details").insert({user_id:De.user.id,make:g.vehicleMake,model:g.vehicleModel,year:parseInt(g.vehicleYear),color:g.vehicleColor,license_plate:g.vehiclePlate,seats:4});bt&&console.error("Failed to create car details:",bt)}g.referralCode.trim()&&(await cI(g.referralCode.trim().toUpperCase(),De.user.id)?(console.log(" Referral code applied successfully - 10% discount on first ride!"),S(!0),B("Referral code applied! You'll get 10% off your first ride.")):(console.warn(" Referral code invalid or already used"),B("Referral code could not be applied."))),g.userType==="driver"?u("/driver/home"):u("/rider/home")}catch(De){Y(De.message||"An error occurred during signup"),P(1)}};return l.jsx("div",{className:"w-full h-dvh bg-gradient-to-br from-blue-50 via-white to-indigo-50","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAyODc6NA","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAyODg6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none px-4 py-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAyOTY6OA","data-yw-s":!0,children:o==="signup"&&D>1&&l.jsxs("button",{onClick:()=>P(D-1),className:"flex items-center space-x-2 text-blue-600 font-medium active:scale-95 transition-transform","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAyOTg6MTI","data-yw-s":!0,children:[l.jsx(ei,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMDI6MTQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMDM6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Back"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMDk6OA","data-yw-s":!0,children:l.jsxs("div",{className:"max-w-md mx-auto py-6","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMTA6MTA","data-yw-s":!0,children:[o==="login"&&l.jsxs("form",{onSubmit:pe,className:"space-y-6","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMTM6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"text-center space-y-2 mb-8","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMTQ6MTY","data-yw-s":!0,children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-2xl mx-auto flex items-center justify-center shadow-lg","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMTU6MTg","data-yw-s":!0,children:l.jsx("span",{className:"text-3xl font-bold text-white","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMTY6MjA","data-yw-t":!0,"data-yw-s":!0,children:"OG"})}),l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMTg6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Welcome to OnGoPool"}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMTk6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Share rides, save money"})]}),G&&l.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMjM6MTg","data-yw-s":!0,children:G}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMjg6MTY","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMjk6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Email"}),l.jsx("input",{type:"email",name:"email",value:g.email,onChange:oe,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzMzA6MTg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzNDA6MTY","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzNDE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Password"}),l.jsx("input",{type:"password",name:"password",value:g.password,onChange:oe,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzNDI6MTg","data-yw-s":!0})]}),l.jsx("button",{type:"submit",disabled:X,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 active:scale-98 transition-all shadow-md min-h-touch disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzNTI6MTY","data-yw-s":!0,children:X?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzNTk6MjI","data-yw-s":!0}),"Signing in..."]}):"Sign In"}),l.jsx("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzNjc6MTY","data-yw-s":!0,children:l.jsx("button",{type:"button",onClick:()=>d("signup"),className:"text-blue-600 font-medium hover:underline","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzNjg6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Don't have an account? Sign Up"})})]}),o==="signup"&&D===1&&l.jsxs("form",{onSubmit:ve,className:"space-y-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzODE6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"text-center space-y-2 mb-6","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzODI6MTY","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzODM6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Create Account"}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzODQ6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Step 1: Basic Information"})]}),G&&l.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzODg6MTg","data-yw-s":!0,children:G}),l.jsx(hv,{onImageSelect:De=>j({...g,profilePicture:De}),currentImage:g.profilePicture,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzOTM6MTY","data-yw-s":!0}),l.jsxs("div",{className:"grid grid-cols-1 gap-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzOTg6MTY","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEAzOTk6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MDA6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Full Name"}),l.jsx("input",{type:"text",name:"name",value:g.name,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MDE6MjA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MTE6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MTI6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Email"}),l.jsx("input",{type:"email",name:"email",value:g.email,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MTM6MjA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MjM6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MjQ6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Phone Number"}),l.jsx("input",{type:"tel",name:"phone",value:g.phone,onChange:oe,placeholder:"+1-555-0123",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MjU6MjA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0MzY6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0Mzc6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Date of Birth"}),l.jsx("input",{type:"date",name:"dateOfBirth",value:g.dateOfBirth,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0Mzg6MjA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NDg6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NDk6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Password"}),l.jsx("input",{type:"password",name:"password",value:g.password,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NTA6MjA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NjA6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NjE6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Confirm Password"}),l.jsx("input",{type:"password",name:"confirmPassword",value:g.confirmPassword,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NjI6MjA","data-yw-s":!0})]}),l.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border-2 border-blue-200","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NzM6MTg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NzQ6MjA","data-yw-s":!0,children:[l.jsx(a_,{className:"w-5 h-5 text-blue-600","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NzU6MjI","data-yw-s":!0}),l.jsx("label",{className:"text-sm font-medium text-blue-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0NzY6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Have a Referral Code? (Optional)"})]}),l.jsx("input",{type:"text",name:"referralCode",value:g.referralCode,onChange:oe,placeholder:"Enter code for 10% off first ride",className:"w-full px-4 py-2 rounded-lg border-2 border-blue-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 uppercase",maxLength:12,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0ODA6MjA","data-yw-s":!0}),l.jsx("p",{className:"text-xs text-blue-700 mt-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0ODk6MjA","data-yw-t":!0,"data-yw-s":!0,children:" Get 10% discount on your first ride with a referral code!"})]})]}),l.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 active:scale-98 transition-all shadow-md min-h-touch","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA0OTU6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Continue"}),l.jsx("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MDI6MTY","data-yw-s":!0,children:l.jsx("button",{type:"button",onClick:()=>d("login"),className:"text-blue-600 font-medium hover:underline","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MDM6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Already have an account? Sign In"})})]}),o==="signup"&&D===2&&l.jsxs("form",{onSubmit:ke,className:"space-y-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MTY6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"text-center space-y-2 mb-6","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MTc6MTY","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MTg6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Address & Type"}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MTk6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Step 2: Where do you live?"})]}),l.jsxs("div",{className:"grid grid-cols-1 gap-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MjI6MTY","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MjM6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MjQ6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Street Address"}),l.jsx("input",{type:"text",name:"address",value:g.address,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MjU6MjA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MzU6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1MzY6MjA","data-yw-t":!0,"data-yw-s":!0,children:"City"}),l.jsx("input",{type:"text",name:"city",value:g.city,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1Mzc6MjA","data-yw-s":!0})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NDc6MTg","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NDg6MjA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NDk6MjI","data-yw-t":!0,"data-yw-s":!0,children:"State/Province"}),l.jsx("input",{type:"text",name:"state",value:g.state,onChange:oe,placeholder:"ON",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NTA6MjI","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NjE6MjA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NjI6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Zip/Postal Code"}),l.jsx("input",{type:"text",name:"zipCode",value:g.zipCode,onChange:oe,placeholder:"M5H 2N2",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NjM6MjI","data-yw-s":!0})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NzU6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1NzY6MjA","data-yw-t":!0,"data-yw-s":!0,children:"I want to:"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1Nzc6MjA","data-yw-s":!0,children:[l.jsxs("button",{type:"button",onClick:()=>j({...g,userType:"rider"}),className:`p-4 rounded-lg border-2 text-center transition-all min-h-touch ${g.userType==="rider"?"border-blue-600 bg-blue-50":"border-gray-300 bg-white"}`,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1Nzg6MjI","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1ODc6MjQ","data-yw-t":!0,"data-yw-s":!0,children:"Rider"}),l.jsx("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1ODg6MjQ","data-yw-t":!0,"data-yw-s":!0,children:"Find rides"})]}),l.jsxs("button",{type:"button",onClick:()=>j({...g,userType:"driver"}),className:`p-4 rounded-lg border-2 text-center transition-all min-h-touch ${g.userType==="driver"?"border-blue-600 bg-blue-50":"border-gray-300 bg-white"}`,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA1OTE6MjI","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MDA6MjQ","data-yw-t":!0,"data-yw-s":!0,children:"Driver"}),l.jsx("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MDE6MjQ","data-yw-t":!0,"data-yw-s":!0,children:"Offer rides"})]})]})]})]}),l.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 active:scale-98 transition-all shadow-md min-h-touch","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MDc6MTY","data-yw-s":!0,children:g.userType==="driver"?"Continue":"Complete Registration"})]}),o==="signup"&&D===3&&g.userType==="driver"&&l.jsxs("form",{onSubmit:ye,className:"space-y-4","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MTg6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"text-center space-y-2 mb-6","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MTk6MTY","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MjA6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Driver Details"}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MjE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Step 3: License & Vehicle"})]}),l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MjQ6MTY","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2MjU6MTg","data-yw-t":!0,"data-yw-s":!0,children:"License Information"}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2Mjc6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2Mjg6MjA","data-yw-t":!0,"data-yw-s":!0,children:"License Number"}),l.jsx("input",{type:"text",name:"licenseNumber",value:g.licenseNumber,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2Mjk6MjA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2Mzk6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NDA6MjA","data-yw-t":!0,"data-yw-s":!0,children:"License Expiry"}),l.jsx("input",{type:"date",name:"licenseExpiry",value:g.licenseExpiry,onChange:oe,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NDE6MjA","data-yw-s":!0})]})]}),l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NTI6MTY","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NTM6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Vehicle Information"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NTU6MTg","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NTY6MjA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NTc6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Make"}),l.jsx("input",{type:"text",name:"vehicleMake",value:g.vehicleMake,onChange:oe,placeholder:"Toyota",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NTg6MjI","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2Njk6MjA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NzA6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Model"}),l.jsx("input",{type:"text",name:"vehicleModel",value:g.vehicleModel,onChange:oe,placeholder:"Camry",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2NzE6MjI","data-yw-s":!0})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2ODM6MTg","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2ODQ6MjA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2ODU6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Year"}),l.jsx("input",{type:"number",name:"vehicleYear",value:g.vehicleYear,onChange:oe,placeholder:"2020",min:"2000",max:"2025",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2ODY6MjI","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA2OTk6MjA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA3MDA6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Color"}),l.jsx("input",{type:"text",name:"vehicleColor",value:g.vehicleColor,onChange:oe,placeholder:"Silver",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA3MDE6MjI","data-yw-s":!0})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA3MTM6MTg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA3MTQ6MjA","data-yw-t":!0,"data-yw-s":!0,children:"License Plate"}),l.jsx("input",{type:"text",name:"vehiclePlate",value:g.vehiclePlate,onChange:oe,placeholder:"ABC 123",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA3MTU6MjA","data-yw-s":!0})]})]}),l.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 active:scale-98 transition-all shadow-md min-h-touch","data-yw":"c3JjL3BhZ2VzL0F1dGhQYWdlLnRzeEA3Mjc6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Complete Registration"})]})]})})]})})}function qf({active:u,userType:o}){const d=on(),g=Eg(),j=S=>u?u===S:g.pathname.includes(`/${o}/${S}`),Z=[{icon:hB,label:"Home",key:"home",path:`/${o}/home`},{icon:bl,label:"Trips",key:"trips",path:`/${o}/trips`},...o==="driver"?[{icon:XM,label:"Post",key:"post",path:"/driver/post-ride",isPrimary:!0}]:[{icon:RB,label:"Find",key:"find",path:"/rider/find-ride",isPrimary:!0}],{icon:uv,label:"Chat",key:"chat",path:`/${o}/chat`},{icon:HM,label:"Profile",key:"profile",path:`/${o}/profile`}];return l.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full bg-white border-t border-gray-200 shadow-2xl backdrop-blur-lg bg-opacity-95 z-50",style:{paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL2NvbXBvbmVudHMvQm90dG9tTmF2LnRzeEA2MDo0","data-yw-s":!0,children:l.jsx("div",{className:"flex items-center justify-around px-1 pt-2 pb-1 max-w-screen-lg mx-auto","data-yw":"c3JjL2NvbXBvbmVudHMvQm90dG9tTmF2LnRzeEA2Njo2","data-yw-s":!0,children:Z.map(S=>{const n=S.icon,B=j(S.key),D="isPrimary"in S&&S.isPrimary;return l.jsxs("button",{onClick:()=>d(S.path),className:`relative flex flex-col items-center justify-center space-y-1 py-2 px-3 rounded-2xl transition-all duration-300 min-h-touch ${B?D?"bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg scale-110":"bg-blue-50 text-blue-600":"text-gray-500 hover:text-gray-700 active:scale-95"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvQm90dG9tTmF2LnRzeEA3MzoxMg","data-yw-s":!0,children:[B&&!D&&l.jsx("div",{className:"absolute top-1 right-1 w-1.5 h-1.5 bg-blue-600 rounded-full animate-pulse","data-yw":"c3JjL2NvbXBvbmVudHMvQm90dG9tTmF2LnRzeEA4NjoxNg","data-yw-s":!0}),l.jsx(n,{className:`transition-all duration-300 ${D&&B?"w-7 h-7 stroke-[2.5]":B?"w-6 h-6 stroke-[2.5]":"w-6 h-6 stroke-[1.5]"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvQm90dG9tTmF2LnRzeEA4OToxNA","data-yw-s":!0}),l.jsx("span",{className:`text-[10px] transition-all duration-300 ${B?"font-bold tracking-wide":"font-medium"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvQm90dG9tTmF2LnRzeEA5ODoxNA","data-yw-s":!0,children:S.label})]},S.path)})})})}async function hI(u,o){try{let d=It.from("notifications").select(`
        *,
        sender_profile:profiles!notifications_sender_id_fkey(
          name,
          profile_image
        )
      `).eq("user_id",u).order("created_at",{ascending:!1});o?.unreadOnly&&(d=d.eq("is_read",!1)),o?.type&&(d=d.eq("type",o.type)),o?.limit&&(d=d.limit(o.limit)),o?.offset&&(d=d.range(o.offset,o.offset+(o.limit||20)-1));const{data:g,error:j}=await d;if(j)throw j;return{data:g||[],error:null}}catch(d){return console.error("Error fetching notifications:",d),{data:[],error:d}}}async function fI(u){try{const{data:o,error:d}=await It.rpc("get_unread_notification_count");if(d)throw d;return o||0}catch(o){console.error("Error getting unread count:",o);try{const{count:d,error:g}=await It.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",u).eq("is_read",!1);if(g)throw g;return d||0}catch(d){return console.error("Fallback count failed:",d),0}}}async function pI(u){try{const{error:o}=await It.rpc("mark_notification_read",{p_notification_id:u});if(o)throw o;return{success:!0,error:null}}catch(o){console.error("Error marking notification as read:",o);try{const{error:d}=await It.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",u);if(d)throw d;return{success:!0,error:null}}catch(d){return{success:!1,error:d}}}}async function mI(u){try{const{data:o,error:d}=await It.rpc("mark_all_notifications_read");if(d)throw d;return{count:o||0,error:null}}catch(o){console.error("Error marking all as read:",o);try{const{data:d,error:g}=await It.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("user_id",u).eq("is_read",!1).select();if(g)throw g;return{count:d?.length||0,error:null}}catch(d){return{count:0,error:d}}}}async function n_(u){try{const{data:o,error:d}=await It.rpc("create_notification",{p_user_id:u.userId,p_type:u.type,p_title:u.title,p_message:u.message,p_ride_id:u.rideId||null,p_booking_id:u.bookingId||null,p_conversation_id:u.conversationId||null,p_sender_id:u.senderId||null,p_metadata:u.metadata||{},p_action_url:u.actionUrl||null});if(d)throw d;return{notificationId:o,error:null}}catch(o){return console.error("Error creating notification:",o),{notificationId:null,error:o}}}async function yI(u){try{const{error:o}=await It.from("notifications").delete().eq("id",u);if(o)throw o;return{success:!0,error:null}}catch(o){return console.error("Error deleting notification:",o),{success:!1,error:o}}}async function gI(u){try{const{data:o,error:d}=await It.from("notification_preferences").select("*").eq("user_id",u).single();if(d&&d.code!=="PGRST116")throw d;if(!o){const{data:g,error:j}=await It.from("notification_preferences").insert([{user_id:u}]).select().single();if(j)throw j;return{data:g,error:null}}return{data:o,error:null}}catch(o){return console.error("Error fetching notification preferences:",o),{data:null,error:o}}}async function _I(u,o){try{const{error:d}=await It.from("notification_preferences").update({...o,updated_at:new Date().toISOString()}).eq("user_id",u);if(d)throw d;return{success:!0,error:null}}catch(d){return console.error("Error updating notification preferences:",d),{success:!1,error:d}}}function HZ(u,o,d){const g=It.channel(`notifications:${u}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${u}`},j=>{o(j.new)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"notifications",filter:`user_id=eq.${u}`},j=>{d(j.new)}).subscribe();return()=>{It.removeChannel(g)}}function YZ({onOpen:u,className:o=""}){const[d,g]=fe.useState(0),[j,Z]=fe.useState(!0),S=fe.useRef(null);fe.useEffect(()=>{let B=!0;const D=async()=>{try{const{data:{user:G}}=await It.auth.getUser();if(!G||!B)return;const Y=await fI(G.id);B&&(g(Y),Z(!1))}catch(G){console.error("Error loading unread count:",G),B&&Z(!1)}},P=async()=>{try{const{data:{user:G}}=await It.auth.getUser();if(!G||!B)return;S.current=HZ(G.id,()=>{B&&g(Y=>Y+1)},Y=>{Y.is_read&&B&&g(X=>Math.max(0,X-1))})}catch(G){console.error("Error setting up notification subscription:",G)}};return D(),P(),()=>{B=!1,S.current&&S.current()}},[]);const n=()=>{u&&u()};return l.jsxs("button",{onClick:n,className:`relative p-2 rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors ${o}`,"aria-label":`Notifications ${d>0?`(${d} unread)`:""}`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uQmVsbC50c3hAODE6NA","data-yw-s":!0,children:[l.jsx(Xh,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uQmVsbC50c3hAODY6Ng","data-yw-s":!0}),!j&&d>0&&l.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uQmVsbC50c3hAODk6OA","data-yw-s":!0,children:d>99?"99+":d})]})}function Cl(u){if(!u)return"";if(u.includes("T"))return new Date(u).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});const[o,d]=u.split(":"),g=parseInt(o,10),j=d;if(isNaN(g))return u;const Z=g>=12?"PM":"AM";return`${g===0?12:g>12?g-12:g}:${j} ${Z}`}function xI(u){const o=new Date(u),g=Math.floor((new Date().getTime()-o.getTime())/1e3);if(g<60)return"just now";const j=Math.floor(g/60);if(j<60)return`${j}m ago`;const Z=Math.floor(j/60);if(Z<24)return`${Z}h ago`;const S=Math.floor(Z/24);if(S<7)return`${S}d ago`;const n=Math.floor(S/7);if(n<4)return`${n}w ago`;const B=Math.floor(S/30);return B<12?`${B}mo ago`:`${Math.floor(S/365)}y ago`}function $Z({isOpen:u,onClose:o}){const[d,g]=fe.useState([]),[j,Z]=fe.useState(!0),[S,n]=fe.useState("all"),B=on(),D=fe.useRef(null);fe.useEffect(()=>{if(!u)return;let oe=!0;const pe=async()=>{try{const{data:{user:ke}}=await It.auth.getUser();if(!ke||!oe)return;Z(!0);const{data:ye}=await hI(ke.id,{limit:50,unreadOnly:S==="unread"});oe&&(g(ye),Z(!1))}catch(ke){console.error("Error loading notifications:",ke),oe&&Z(!1)}},ve=async()=>{try{const{data:{user:ke}}=await It.auth.getUser();if(!ke||!oe)return;D.current=HZ(ke.id,ye=>{oe&&g($e=>[ye,...$e])},ye=>{oe&&g($e=>$e.map(De=>De.id===ye.id?ye:De))})}catch(ke){console.error("Error setting up notification subscription:",ke)}};return pe(),ve(),()=>{oe=!1,D.current&&D.current()}},[u,S]);const P=async oe=>{oe.is_read||(await pI(oe.id),g(pe=>pe.map(ve=>ve.id===oe.id?{...ve,is_read:!0}:ve))),oe.action_url&&(B(oe.action_url),o())},G=async()=>{try{const{data:{user:oe}}=await It.auth.getUser();if(!oe)return;await mI(oe.id),g(pe=>pe.map(ve=>({...ve,is_read:!0})))}catch(oe){console.error("Error marking all as read:",oe)}},Y=async(oe,pe)=>{pe.stopPropagation();try{await yI(oe),g(ve=>ve.filter(ke=>ke.id!==oe))}catch(ve){console.error("Error deleting notification:",ve)}},X=oe=>{const pe="w-5 h-5";switch(oe){case"ride_post":return l.jsx(Xh,{className:pe,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDEzNToxNQ","data-yw-s":!0});case"chat_message":return l.jsx(Xh,{className:pe,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDEzNzoxNQ","data-yw-s":!0});case"ride_request":return l.jsx(Xh,{className:pe,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDEzOToxNQ","data-yw-s":!0});case"booking_confirmed":return l.jsx(Hp,{className:`${pe} text-green-600`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE0MToxNQ","data-yw-s":!0});case"booking_rejected":return l.jsx(lo,{className:`${pe} text-red-600`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE0MzoxNQ","data-yw-s":!0});default:return l.jsx(Xh,{className:pe,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE0NToxNQ","data-yw-s":!0})}};if(!u)return null;const ue=d.filter(oe=>!oe.is_read).length;return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:o,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE1Njo2","data-yw-s":!0}),l.jsxs("div",{className:"fixed inset-y-0 right-0 w-full max-w-md bg-white shadow-2xl z-50 flex flex-col","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE2Mjo2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE2NDo4","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE2NToxMA","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE2NjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Notifications"}),ue>0&&l.jsxs("p",{className:"text-sm text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE2ODoxNA","data-yw-s":!0,children:[ue,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE2ODo2NA","data-yw-t":!0,"data-yw-auto":!0,children:" unread"})]})]}),l.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE3MToxMA","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE3NToxMg","data-yw-s":!0})})]}),l.jsxs("div",{className:"flex gap-2 p-4 border-b border-gray-100","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE4MDo4","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>n("all"),className:`flex-1 py-2 px-4 rounded-lg font-medium text-sm transition-colors ${S==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE4MToxMA","data-yw-t":!0,"data-yw-s":!0,children:"All"}),l.jsx("button",{onClick:()=>n("unread"),className:`flex-1 py-2 px-4 rounded-lg font-medium text-sm transition-colors ${S==="unread"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDE5MToxMA","data-yw-t":!0,"data-yw-s":!0,children:"Unread"})]}),ue>0&&l.jsx("div",{className:"px-4 py-2 border-b border-gray-100","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIwNToxMA","data-yw-s":!0,children:l.jsx("button",{onClick:G,className:"text-sm text-blue-600 hover:text-blue-700 font-medium","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIwNjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Mark all as read"})}),l.jsx("div",{className:"flex-1 overflow-y-auto","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIxNjo4","data-yw-s":!0,children:j?l.jsx("div",{className:"flex items-center justify-center h-full","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIxODoxMg","data-yw-s":!0,children:l.jsx("div",{className:"text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIxOToxNA","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})}):d.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIyMjoxMg","data-yw-s":!0,children:[l.jsx(Xh,{className:"w-16 h-16 text-gray-300 mb-4","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIyMzoxNA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIyNDoxNA","data-yw-t":!0,"data-yw-s":!0,children:"No notifications"}),l.jsx("p",{className:"text-gray-400 text-sm mt-2","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIyNToxNA","data-yw-t":!0,"data-yw-s":!0,children:"You're all caught up!"})]}):l.jsx("div",{className:"divide-y divide-gray-100","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIzMDoxMg","data-yw-s":!0,children:d.map(oe=>l.jsxs("div",{onClick:()=>P(oe),className:`p-4 cursor-pointer transition-colors ${oe.is_read?"bg-white hover:bg-gray-50":"bg-blue-50 hover:bg-blue-100"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDIzMjoxNg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI0MToxOA","data-yw-s":!0,children:[l.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${oe.is_read?"bg-gray-100":"bg-blue-100"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI0MzoyMA","data-yw-s":!0,children:X(oe.type)}),l.jsxs("div",{className:"flex-1 min-w-0","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI1MDoyMA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start justify-between gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI1MToyMg","data-yw-s":!0,children:[l.jsx("h3",{className:`font-semibold text-sm ${oe.is_read?"text-gray-700":"text-gray-900"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI1MjoyNA","data-yw-s":!0,children:oe.title}),l.jsx("button",{onClick:pe=>Y(oe.id,pe),className:"flex-shrink-0 p-1 rounded hover:bg-gray-200 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI1NzoyNA","data-yw-s":!0,children:l.jsx(QB,{className:"w-4 h-4 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI2MToyNg","data-yw-s":!0})})]}),l.jsx("p",{className:`text-sm mt-1 line-clamp-2 ${oe.is_read?"text-gray-500":"text-gray-700"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI2NToyMg","data-yw-s":!0,children:oe.message}),l.jsx("p",{className:"text-xs text-gray-400 mt-2","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI3MToyMg","data-yw-s":!0,children:xI(oe.created_at)})]})]}),!oe.is_read&&l.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-blue-600 rounded-full","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI3OToyMA","data-yw-s":!0})]},oe.id))})}),l.jsx("div",{className:"p-4 border-t border-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI4ODo4","data-yw-s":!0,children:l.jsxs("button",{onClick:()=>{B("/settings/notifications"),o()},className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 rounded-lg font-medium text-gray-700 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI4OToxMA","data-yw-s":!0,children:[l.jsx(BB,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI5NjoxMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvTm90aWZpY2F0aW9uUGFuZWwudHN4QDI5Njo0NA","data-yw-t":!0,"data-yw-auto":!0,children:"Notification Settings"})]})})]})]})}const wI=.15;function fv(u){const o=u*wI,d=u-o;return{gross:u,platformFee:o,net:d}}async function vI(u,o){try{let d=It.from("driver_earnings").select("*").eq("driver_id",u).order("date",{ascending:!1});o&&o!=="all"&&(d=d.eq("status",o));const{data:g,error:j}=await d;if(j)throw j;return(g||[]).map(S=>{const n=parseFloat(S.amount.toString()),B=fv(n);return{...S,amount:B.gross,platform_fee:B.platformFee,net_amount:B.net}})}catch(d){return Wn(d,"Failed to fetch driver earnings"),[]}}async function bI(u){try{const{data:o,error:d}=await It.from("driver_earnings").select("amount, status, date").eq("driver_id",u);if(d)throw d;const g=new Date,j=g.getMonth(),Z=g.getFullYear(),S=new Date(g);return S.setDate(g.getDate()-g.getDay()),S.setHours(0,0,0,0),(o||[]).reduce((B,D)=>{const P=new Date(D.date),G=parseFloat(D.amount.toString()),Y=fv(G);return B.totalEarnings+=Y.gross,B.totalNetEarnings+=Y.net,B.totalPlatformFees+=Y.platformFee,D.status==="paid"?B.paidEarnings+=Y.net:D.status==="pending"&&(B.pendingEarnings+=Y.net),P.getMonth()===j&&P.getFullYear()===Z&&(B.thisMonthEarnings+=Y.gross,B.thisMonthNetEarnings+=Y.net),P>=S&&(B.thisWeekEarnings+=Y.gross,B.thisWeekNetEarnings+=Y.net),B},{totalEarnings:0,totalNetEarnings:0,totalPlatformFees:0,thisMonthEarnings:0,thisMonthNetEarnings:0,thisWeekEarnings:0,thisWeekNetEarnings:0,pendingEarnings:0,paidEarnings:0})}catch(o){return Wn(o,"Failed to fetch earnings summary"),{totalEarnings:0,totalNetEarnings:0,totalPlatformFees:0,thisMonthEarnings:0,thisMonthNetEarnings:0,thisWeekEarnings:0,thisWeekNetEarnings:0,pendingEarnings:0,paidEarnings:0}}}async function LI(u,o,d,g){try{const j=fv(d),{error:Z}=await It.from("driver_earnings").insert({driver_id:u,ride_id:o,booking_id:g||null,amount:j.gross,platform_fee:j.platformFee,net_amount:j.net,status:"pending",date:new Date().toISOString()});if(Z)throw Z;return await n_({userId:u,type:"payment_received",title:"Payment Received",message:`You earned $${j.net.toFixed(2)} from your ride (after 15% platform fee).`,rideId:o,bookingId:g,metadata:{gross_amount:j.gross,platform_fee:j.platformFee,net_amount:j.net},actionUrl:"/driver/earnings"}),!0}catch(j){return Wn(j,"Failed to create earning record"),!1}}async function jI(u){try{const{data:o,error:d}=await It.from("payout_methods").select("*").eq("driver_id",u).order("is_default",{ascending:!1});if(d)throw d;return o||[]}catch(o){return Wn(o,"Failed to fetch payout methods"),[]}}async function ZI(u,o){try{const{data:d}=await It.from("payout_methods").select("id").eq("driver_id",u).single(),g=o.account_number.slice(-4);if(d){const{error:j}=await It.from("payout_methods").update({bank_name:o.bank_name,account_holder_name:o.account_holder_name,institution_number:o.institution_number,transit_number:o.transit_number,account_number:g,is_default:o.is_default??!0}).eq("id",d.id);if(j)throw j}else{const{error:j}=await It.from("payout_methods").insert({driver_id:u,bank_name:o.bank_name,account_holder_name:o.account_holder_name,institution_number:o.institution_number,transit_number:o.transit_number,account_number:g,is_default:o.is_default??!0,is_verified:!1});if(j)throw j}return!0}catch(d){return Wn(d,"Failed to save payout method"),!1}}const B0="https://rideshare-backend-api.onrender.com",NI={payment:{create:`${B0}/api/payment/create`,capture:`${B0}/api/payment/capture`,cancel:`${B0}/api/payment/cancel`,refund:`${B0}/api/payment/refund`}};async function g_(u,o){const{data:{session:d}}=await It.auth.getSession();if(!d)throw new Error("User not authenticated");const g=NI.payment[u];if(!g)throw new Error(`Unknown action: ${u}`);const j=await fetch(g,{method:"POST",headers:{Authorization:`Bearer ${d.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!j.ok){const Z=await j.json();throw new Error(Z.error||`Edge Function call failed: ${j.statusText}`)}return await j.json()}async function EI(u){try{const o=await g_("create",{rideId:u.rideId,bookingId:u.bookingId,riderId:u.riderId,driverId:u.driverId,amountSubtotal:u.amountSubtotal,referralCode:u.referralCode});if(o.success){try{const{error:d}=await It.from("payment_history").insert({user_id:u.riderId,ride_id:u.rideId,booking_id:u.bookingId||null,amount:o.paymentIntent.amount_total/100,payment_method:"stripe",transaction_id:o.paymentIntent.stripe_payment_intent_id,status:"authorized",payment_type:"ride",date:new Date().toISOString()});d?console.error("Failed to create payment history record:",d):console.log(" Payment history record created for",o.paymentIntent.stripe_payment_intent_id)}catch(d){console.error("Error creating payment history:",d)}return{success:!0,paymentIntent:o.paymentIntent,clientSecret:o.clientSecret}}else return{success:!1,error:o.error||"Payment authorization failed"}}catch(o){return console.error("Error creating and authorizing payment:",o),{success:!1,error:o instanceof Error?o.message:"Payment authorization failed"}}}async function Mw(u){try{const o=await g_("capture",{paymentIntentId:u.paymentIntentId});return o.success?{success:!0,capturedAmount:o.capturedAmount,driverEarnings:o.driverEarnings}:{success:!1,error:o.error||"Payment capture failed"}}catch(o){return console.error("Error capturing payment:",o),{success:!1,error:o instanceof Error?o.message:"Payment capture failed"}}}async function SI(u){try{const o=await g_("cancel",{paymentIntentId:u.paymentIntentId,reason:u.cancellationReason});return o.success?{success:!0}:{success:!1,error:o.error||"Payment cancellation failed"}}catch(o){return console.error("Error canceling payment:",o),{success:!1,error:o instanceof Error?o.message:"Payment cancellation failed"}}}async function zI(u,o){try{const d=await g_("refund",{paymentIntentId:u,reason:o});return d.success?{success:!0,refundId:d.refundId,amountRefunded:d.amountRefunded}:{success:!1,error:d.error||"Refund failed"}}catch(d){return console.error("Error refunding payment:",d),{success:!1,error:d instanceof Error?d.message:"Refund failed"}}}async function AI(u,o,d,g){try{const{data:j,error:Z}=await It.from("stripe_payment_intents").select("*").eq("id",u).single();if(Z||!j)throw new Error("Payment intent not found");const S=new Date,n=(o.getTime()-S.getTime())/(1e3*60*60);let B=0;d==="driver"||n>=24?B=100:n>=12?B=50:B=0;const D=j.amount_total,P=Math.round(D*B/100),G=D-P;return j.status==="authorized"?B===100?(await SI({paymentIntentId:u,cancellationReason:`${d} cancellation: ${g}`}),await It.from("payment_history").update({status:"cancelled",amount_refunded:D,refund_reason:`${d} cancellation: ${g}`,updated_at:new Date().toISOString()}).eq("stripe_payment_intent_id",j.id)):B>0?(await Mw({paymentIntentId:u}),await It.from("stripe_payment_intents").update({cancellation_reason:`Partial cancellation (${B}% refund): ${g}`,metadata:{...j.metadata,cancellation_fee:G,original_amount:D,charged_amount:G}}).eq("id",u),await It.from("payment_history").update({status:"partial_refund",amount_refunded:P,refund_reason:`Partial cancellation (${B}% refund): ${g}`,updated_at:new Date().toISOString()}).eq("stripe_payment_intent_id",j.id)):(await Mw({paymentIntentId:u}),await It.from("payment_history").update({status:"completed_no_refund",amount_refunded:0,refund_reason:"No refund - cancelled within 12 hours of departure",updated_at:new Date().toISOString()}).eq("stripe_payment_intent_id",j.id)):j.status==="succeeded"&&(P>0?(await zI(u,`${d} cancellation (${B}% policy)`),await It.from("payment_history").update({status:B===100?"refunded":"partial_refund",amount_refunded:P,refund_reason:`${d} cancellation (${B}% policy)`,updated_at:new Date().toISOString()}).eq("stripe_payment_intent_id",j.id)):await It.from("payment_history").update({status:"completed_no_refund",amount_refunded:0,refund_reason:"No refund - cancelled within 12 hours of departure",updated_at:new Date().toISOString()}).eq("stripe_payment_intent_id",j.id)),B===100&&j.referral_code&&await It.from("referral_uses").update({status:"expired"}).eq("referral_code",j.referral_code).eq("referred_user_id",j.rider_id),{success:!0,refundAmount:P,refundPercentage:B,cancellationFee:G}}catch(j){return console.error("Error processing policy-based cancellation:",j),{success:!1,refundAmount:0,refundPercentage:0,cancellationFee:0,error:j instanceof Error?j.message:"Cancellation failed"}}}async function RI(u){try{const{data:o,error:d}=await It.from("stripe_payment_intents").select("*").eq("booking_id",u).maybeSingle();if(d)throw d;return o}catch(o){return console.error("Error fetching payment intent by booking:",o),null}}async function TI(u){try{const{data:o,error:d}=await It.from("payment_history").select("*").eq("user_id",u).order("created_at",{ascending:!1});if(d)throw d;return o||[]}catch(o){return console.error("Error fetching payment history:",o),[]}}function qZ(u,o){const d=new Date(`${u}T${o}`),g=new Date;return(d.getTime()-g.getTime())/(1e3*60*60)}function KZ(u,o){return qZ(u,o)>=0}function VI(u,o,d){return KZ(u,o)}function MI(u){if(!u||u.status!=="completed"&&u.status!=="cancelled")return!1;const o=u.completed_at||u.updated_at||u.created_at;if(!o)return!1;const d=new Date(o);return(new Date().getTime()-d.getTime())/(1e3*60*60)>=8}function Bw(u){return u.filter(o=>!MI(o))}async function BI(u,o){try{const{data:d,error:g}=await It.from("rides").insert({driver_id:u,from_location:o.fromLocation,to_location:o.toLocation,date:o.date,time:o.time,available_seats:o.availableSeats,price_per_seat:o.pricePerSeat,price_per_km:o.pricePerKm||null,distance:o.distance||null,duration:o.duration||null,estimated_arrival:o.estimatedArrival||null,route_data:o.routeData||null,status:"scheduled",ride_policy_accepted:o.ridePolicyAccepted}).select("id").single();if(g)return Wn(g),null;if(o.stops&&o.stops.length>0){const j=o.stops.map((S,n)=>({ride_id:d.id,name:S.address,address:S.address,lat:S.lat,lng:S.lng,stop_order:n,estimated_arrival:S.estimatedArrival||null})),{error:Z}=await It.from("route_stops").insert(j);Z&&console.error("Error creating route stops:",Z)}return d.id}catch(d){return console.error("Error creating ride:",d),null}}async function Iw(u){try{const{data:o,error:d}=await It.from("rides").select(`
        *,
        driver:profiles!rides_driver_id_fkey(id, name, profile_image, rating),
        route_stops(*)
      `).eq("driver_id",u).order("date",{ascending:!1}).order("time",{ascending:!1});return d?(Wn(d),[]):o||[]}catch(o){return console.error("Error fetching driver rides:",o),[]}}async function __(u){try{const{data:o,error:d}=await It.from("rides").select(`
        *,
        driver:profiles!rides_driver_id_fkey(
          id, name, profile_image, rating, phone,
          car_details:car_details!car_details_user_id_fkey(*)
        ),
        route_stops(*)
      `).eq("id",u).single();return d?(Wn(d),null):o}catch(o){return console.error("Error fetching ride:",o),null}}function II(u,o,d){const j=kp(o.lat,o.lng,u.from_location.lat,u.from_location.lng),Z=kp(d.lat,d.lng,u.to_location.lat,u.to_location.lng);if(j<20&&Z<20){console.log(` FULL ROUTE MATCH: Start distance ${j.toFixed(1)}km, End distance ${Z.toFixed(1)}km`),console.log(` Using stored price $${u.price_per_seat} directly from database (NO calculations)`);const pe=[{...u.from_location,order:-1,time:u.time,estimatedArrival:u.time},...(u.route_stops||[]).sort((ve,ke)=>ve.stop_order-ke.stop_order),{...u.to_location,order:999,estimatedArrival:u.estimated_arrival}];return{fromStop:pe[0],toStop:pe[pe.length-1],fromStopIndex:0,toStopIndex:pe.length-1,distance:u.distance||kp(u.from_location.lat,u.from_location.lng,u.to_location.lat,u.to_location.lng),duration:u.duration||0,price:u.price_per_seat,isFullRoute:!0}}const S=[{...u.from_location,order:-1,time:u.time,estimatedArrival:u.time},...(u.route_stops||[]).sort((pe,ve)=>pe.stop_order-ve.stop_order),{...u.to_location,order:999,estimatedArrival:u.estimated_arrival}];console.log(` Checking ${S.length} stops for segment match`),console.log(` Search FROM: ${o.lat}, ${o.lng}`),console.log(` Search TO: ${d.lat}, ${d.lng}`);let n=-1,B=-1,D=1/0,P=1/0;if(S.forEach((pe,ve)=>{const ke=kp(o.lat,o.lng,pe.lat,pe.lng),ye=kp(d.lat,d.lng,pe.lat,pe.lng);console.log(`  Stop ${ve} (${pe.address}): from=${ke.toFixed(1)}km, to=${ye.toFixed(1)}km`),ke<D&&ke<20&&(D=ke,n=ve,console.log(`     New best FROM match (${ke.toFixed(1)}km)`)),ye<P&&ye<20&&(P=ye,B=ve,console.log(`     New best TO match (${ye.toFixed(1)}km)`))}),console.log(` Final match indices: FROM=${n}, TO=${B}`),n===-1||B===-1||n>=B)return console.log(` No valid segment: from=${n}, to=${B}, fromDist=${D.toFixed(1)}km, toDist=${P.toFixed(1)}km`),null;const G=S[n],Y=S[B],X=kp(G.lat,G.lng,Y.lat,Y.lng),ue=u.distance||kp(u.from_location.lat,u.from_location.lng,u.to_location.lat,u.to_location.lng),oe=ue>0?Math.round(X/ue*u.price_per_seat*100)/100:u.price_per_seat;return console.log(` SEGMENT BOOKING: stop ${n}  ${B}, ${X.toFixed(1)}km / ${ue.toFixed(1)}km`),console.log(` Calculated price $${oe}`),{fromStop:G,toStop:Y,fromStopIndex:n,toStopIndex:B,distance:X,duration:0,price:oe,isFullRoute:!1}}async function eN(u){try{console.log(" Searching rides with date:",u.date),console.log(" From:",u.fromAddress,"To:",u.toAddress);const{data:o,error:d}=await It.from("rides").select(`
        *,
        driver:profiles!rides_driver_id_fkey(
          id, name, profile_image, rating,
          car_details:car_details!car_details_user_id_fkey(*)
        ),
        route_stops(*)
      `).eq("date",u.date).eq("status","scheduled").gte("available_seats",u.seats||1).order("time",{ascending:!0});if(d)return console.error(" Database error:",d),Wn(d),[];console.log(` Database returned ${o?.length||0} rides for date ${u.date}`);const g=(o||[]).map(j=>{const Z=II(j,{lat:u.fromLat,lng:u.fromLng},{lat:u.toLat,lng:u.toLng});if(!Z)return null;const S=Z.fromStop.estimatedArrival||Z.fromStop.time||j.time,n=Z.toStop.estimatedArrival||Z.toStop.time||"";let B=!0,D="";if(n){if(B=VI(j.date,S,n),!B)return console.log(` Segment ${Z.fromStop.address}  ${Z.toStop.address} is past booking window`),null;const P=qZ(j.date,S);P>=0&&P<24&&(D=`Starts in ${Math.floor(P)} hours`)}else if(B=KZ(j.date,S),!B)return console.log(` Ride starting at ${S} has already started or passed`),null;return{...j,matchedSegment:Z,displayFrom:Z.fromStop,displayTo:Z.toStop,displayPrice:Z.price,displayDistance:Z.distance,isSegmentBooking:!Z.isFullRoute,isWithinBookingWindow:B,bookingWindowMessage:D,segmentStartTime:S,segmentEndTime:n}}).filter(Boolean);return console.log(` Found ${g.length} rides with matching segments within booking window`),g}catch(o){return console.error("Error searching rides:",o),[]}}async function kw(u,o){try{const d={status:o.status,available_seats:o.availableSeats,price_per_seat:o.pricePerSeat,updated_at:new Date().toISOString()};o.status==="completed"&&(d.completed_at=new Date().toISOString());const{error:g}=await It.from("rides").update(d).eq("id",u);return g?(Wn(g),!1):(o.status&&await DI(u,o.status),!0)}catch(d){return console.error("Error updating ride:",d),!1}}async function kI(u){try{const{data:o,error:d}=await It.from("rides").select("status").eq("driver_id",u);return d?(Wn(d),{totalRides:0,completedRides:0,upcomingRides:0,cancelledRides:0}):{totalRides:o.length,completedRides:o.filter(j=>j.status==="completed").length,upcomingRides:o.filter(j=>j.status==="scheduled"||j.status==="ongoing").length,cancelledRides:o.filter(j=>j.status==="cancelled").length}}catch(o){return console.error("Error fetching ride stats:",o),{totalRides:0,completedRides:0,upcomingRides:0,cancelledRides:0}}}function kp(u,o,d,g){const Z=I0(d-u),S=I0(g-o),n=Math.sin(Z/2)*Math.sin(Z/2)+Math.cos(I0(u))*Math.cos(I0(d))*Math.sin(S/2)*Math.sin(S/2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))}function I0(u){return u*(Math.PI/180)}async function JI(u,o){try{const{data:d,error:g}=await It.from("profiles").select("admin_daily_ride_limit").eq("id",u).single();g&&console.error("Error fetching profile:",g);const j=d?.admin_daily_ride_limit||2,{count:Z,error:S}=await It.from("rides").select("*",{count:"exact",head:!0}).eq("driver_id",u).eq("date",o).in("status",["scheduled","ongoing"]);if(S)return Wn(S),{allowed:!0,currentCount:0,limit:j};const n=Z||0,B=n<j;return{allowed:B,currentCount:n,limit:j,message:B?void 0:`Daily ride limit reached (${n}/${j} rides). You cannot post more rides for this date.`}}catch(d){return console.error("Error checking daily ride limit:",d),{allowed:!0,currentCount:0,limit:2}}}async function FI(u,o){try{const{data:d,error:g}=await It.from("profiles").select("admin_monthly_ride_limit").eq("id",u).single();g&&console.error("Error fetching profile:",g);const j=d?.admin_monthly_ride_limit||42,Z=new Date(o),S=Z.getFullYear(),n=Z.getMonth()+1,B=`${S}-${String(n).padStart(2,"0")}-01`,D=new Date(S,n,1),G=new Date(D.getTime()-1).toISOString().split("T")[0],{count:Y,error:X}=await It.from("rides").select("*",{count:"exact",head:!0}).eq("driver_id",u).gte("date",B).lte("date",G).in("status",["scheduled","ongoing","completed"]);if(X)return Wn(X),{allowed:!0,currentCount:0,limit:j};const ue=Y||0,oe=ue<j;return{allowed:oe,currentCount:ue,limit:j,message:oe?void 0:`Monthly ride limit reached (${ue}/${j} rides). You cannot post more rides this month.`}}catch(d){return console.error("Error checking monthly ride limit:",d),{allowed:!0,currentCount:0,limit:42}}}async function OI(u,o,d,g){try{const{data:j,error:Z}=await It.from("rides").select("*").eq("driver_id",u).eq("date",o).in("status",["scheduled","ongoing"]);if(Z)return Wn(Z),{hasConflict:!1,conflictingRides:[]};if(!j||j.length===0)return{hasConflict:!1,conflictingRides:[]};const S=jL(d),n=S+g,B=[];for(const D of j){const P=jL(D.time),G=D.duration||0,Y=P+G;(S>=P&&S<Y||n>P&&n<=Y||S<=P&&n>=Y)&&B.push(D)}return{hasConflict:B.length>0,conflictingRides:B,message:B.length>0?`Time conflict detected! You have ${B.length} existing ride(s) at this time.`:void 0}}catch(j){return console.error("Error checking ride time conflict:",j),{hasConflict:!1,conflictingRides:[]}}}function jL(u){const[o,d]=u.split(":").map(Number);return o*60+d}async function ZL(u){try{console.log(` Starting ride completion for ride ID: ${u}`);const{data:o,error:d}=await It.from("rides").select("id, driver_id, price_per_seat, status").eq("id",u).single();if(d||!o)return console.error(" Error fetching ride:",d),{success:!1,earningsCreated:0,error:"Ride not found"};if(o.status==="completed")return console.log(" Ride already completed, skipping earnings creation"),{success:!0,earningsCreated:0};const{data:g,error:j}=await It.from("ride_requests").select("id, passenger_id, requested_seats, price_per_seat").eq("ride_id",u).eq("status","accepted");if(j)return console.error(" Error fetching ride requests:",j),{success:!1,earningsCreated:0,error:"Failed to fetch ride requests"};if(console.log(` Found ${g?.length||0} accepted ride requests`),!await kw(u,{status:"completed"}))return{success:!1,earningsCreated:0,error:"Failed to update ride status"};console.log(" Ride status updated to completed");let S=0;if(g&&g.length>0)for(const n of g){const B=parseFloat(n.price_per_seat.toString())*n.requested_seats,{data:D,error:P}=await It.from("stripe_payment_intents").select("*").eq("ride_id",u).eq("rider_id",n.passenger_id).order("created_at",{ascending:!1}).limit(1);if(P||!D||D.length===0){console.warn(` No payment intent found for ride request ${n.id} (rider: ${n.passenger_id})`);continue}const G=D[0];if(G&&G.status==="authorized"){console.log(` Capturing payment for ride request ${n.id}...`);const Y=await Mw({paymentIntentId:G.id});Y.success?(console.log(` Payment captured: $${(Y.capturedAmount||0)/100}`),S++):console.error(` Failed to capture payment for ride request ${n.id}: ${Y.error}`)}else G&&G.status==="succeeded"?(console.log(` Payment already captured for ride request ${n.id}`),S++):(console.warn(` No authorized payment found for ride request ${n.id}, creating earning without payment`),await LI(o.driver_id,u,B,null)?(S++,console.log(` Created earning for ride request ${n.id}: $${B.toFixed(2)}`)):console.error(` Failed to create earning for ride request ${n.id}`))}return console.log(` Ride completion successful! Created ${S} earnings`),{success:!0,earningsCreated:S}}catch(o){return console.error(" Error completing ride:",o),{success:!1,earningsCreated:0,error:o instanceof Error?o.message:"Unknown error"}}}async function DI(u,o){try{const{data:d,error:g}=await It.from("rides").select(`
        *,
        driver:profiles!rides_driver_id_fkey(name, email)
      `).eq("id",u).single();if(g||!d){console.error("Error fetching ride for notification:",g);return}const{data:j,error:Z}=await It.from("bookings").select("rider_id, id").eq("ride_id",u).eq("status","accepted");if(Z||!j){console.error("Error fetching bookings for notification:",Z);return}const S=d.driver?.name||d.driver?.email||"Driver",n=`${d.from_location?.address||"Unknown"}  ${d.to_location?.address||"Unknown"}`;if(o==="ongoing"){for(const B of j)await n_({userId:B.rider_id,type:"ride_started",title:"Ride Started",message:`${S} has started your ride: ${n}`,rideId:u,bookingId:B.id,senderId:d.driver_id,actionUrl:`/rider/ride-detail/${B.id}`});console.log(` Sent ride_started notifications to ${j.length} riders`)}else if(o==="completed"){for(const B of j)await n_({userId:B.rider_id,type:"ride_completed",title:"Ride Completed",message:`Your ride with ${S} is complete. Please rate your experience!`,rideId:u,bookingId:B.id,senderId:d.driver_id,actionUrl:`/rider/rate/${B.id}`});console.log(` Sent ride_completed notifications to ${j.length} riders`)}}catch(d){console.error("Error sending ride status notifications:",d)}}function CI(u){if(!u)return!1;if(u.ride){const o=u.ride.status;if(o!=="completed"&&o!=="cancelled")return!1;const d=u.ride.completed_at||u.ride.updated_at||u.ride.created_at;if(!d)return!1;const g=new Date(d);return(new Date().getTime()-g.getTime())/(1e3*60*60)>=8}if(u.status==="cancelled"||u.status==="rejected"){const o=u.updated_at||u.created_at;if(!o)return!1;const d=new Date(o);return(new Date().getTime()-d.getTime())/(1e3*60*60)>=8}return!1}function pv(u){return u.filter(o=>!CI(o))}async function PI(u,o,d){try{const g=new Date,{data:j,error:Z}=await It.from("ride_requests").insert({ride_id:u.rideId,passenger_id:u.passengerId,requested_seats:u.requestedSeats,pickup_location:u.pickupLocation,dropoff_location:u.dropoffLocation,status:"pending",message:u.message||null,request_date:g.toISOString(),price_per_seat:u.pricePerSeat||null}).select("id").single();if(Z)return Wn(Z),null;const S=j.id;if(u.pricePerSeat&&u.totalPrice&&S){const n=u.distanceKm?Math.round(u.distanceKm*1e3):0,B=Math.round(u.totalPrice*100),{error:D}=await It.from("ride_request_price").insert({ride_request_id:S,segment_index:0,start_lat:u.pickupLocation.lat,start_lng:u.pickupLocation.lng,end_lat:u.dropoffLocation.lat,end_lng:u.dropoffLocation.lng,distance_meters:n,price_cents:B,currency:"USD"});D&&console.error("Error saving price information:",D)}return S}catch(g){return console.error("Error creating booking:",g),null}}async function tN(u){try{const{data:o,error:d}=await It.from("ride_requests").select(`
        id, ride_id, passenger_id, requested_seats, pickup_location, dropoff_location, 
        message, status, confirmed_at, request_date, created_at, updated_at,
        ride:rides!ride_requests_ride_id_fkey(
          id, driver_id, from_location, to_location, date, time, available_seats, 
          price_per_seat, distance, duration, status, created_at
        )
      `).eq("passenger_id",u).order("request_date",{ascending:!1}).limit(100);if(d)return Wn(d),[];if(!o||o.length===0)return[];const g=[...new Set(o.map(G=>G.ride?.driver_id).filter(Boolean))],j=o.map(G=>G.id),[Z,S,n]=await Promise.all([It.from("profiles").select("id, name, profile_image, rating, phone").in("id",g),It.from("car_details").select("user_id, id, make, model, year, color, license_plate, seats").in("user_id",g),It.from("ride_request_price").select("ride_request_id, id, segment_index, distance_meters, price_cents, currency").in("ride_request_id",j)]);Z.error&&console.error("Error fetching driver profiles:",Z.error),S.error&&console.error("Error fetching car details:",S.error),n.error&&console.error("Error fetching prices:",n.error);const B=new Map((Z.data||[]).map(G=>[G.id,G])),D=new Map((S.data||[]).map(G=>[G.user_id,G])),P=new Map;return(n.data||[]).forEach(G=>{P.has(G.ride_request_id)||P.set(G.ride_request_id,[]),P.get(G.ride_request_id).push(G)}),o.map(G=>{const Y=B.get(G.ride?.driver_id),X=D.get(G.ride?.driver_id);return{...G,ride:G.ride?{...G.ride,driver:Y?{...Y,car_details:X?[X]:[]}:null}:null,price:P.get(G.id)||[]}})}catch(o){return console.error("Error fetching passenger bookings:",o),[]}}async function mv(u){try{const{data:o,error:d}=await It.from("rides").select("id").eq("driver_id",u);if(d)return Wn(d),[];if(!o||o.length===0)return[];const g=o.map(Y=>Y.id),{data:j,error:Z}=await It.from("ride_requests").select(`
        id, ride_id, passenger_id, requested_seats, pickup_location, dropoff_location, 
        message, status, confirmed_at, request_date, created_at, updated_at, price_per_seat,
        ride:rides!ride_requests_ride_id_fkey(
          id, driver_id, from_location, to_location, date, time, available_seats, 
          price_per_seat, distance, duration, status, created_at, updated_at
        )
      `).in("ride_id",g).order("request_date",{ascending:!1}).limit(100);if(Z)return Wn(Z),[];if(!j||j.length===0)return[];const S=[...new Set(j.map(Y=>Y.passenger_id).filter(Boolean))],n=j.map(Y=>Y.id),[B,D]=await Promise.all([It.from("profiles").select("id, name, profile_image, rating, phone").in("id",S),It.from("ride_request_price").select("ride_request_id, id, segment_index, distance_meters, price_cents, currency").in("ride_request_id",n)]);B.error&&console.error("Error fetching passenger profiles:",B.error),D.error&&console.error("Error fetching prices:",D.error);const P=new Map((B.data||[]).map(Y=>[Y.id,Y])),G=new Map;return(D.data||[]).forEach(Y=>{G.has(Y.ride_request_id)||G.set(Y.ride_request_id,[]),G.get(Y.ride_request_id).push(Y)}),j.map(Y=>{const X=P.get(Y.passenger_id);return{...Y,passenger:X||null,price:G.get(Y.id)||[]}})}catch(o){return console.error("Error fetching driver booking requests:",o),[]}}async function yv(u){try{console.log(`[bookingService] Fetching ride request with ID: ${u}`);const{data:o,error:d}=await It.from("ride_requests").select(`
        *,
        passenger:profiles!ride_requests_passenger_id_fkey(id, name, profile_image, rating, phone),
        ride:rides!ride_requests_ride_id_fkey(
          *,
          driver:profiles!rides_driver_id_fkey(
            id, name, profile_image, rating, phone,
            car_details:car_details!car_details_user_id_fkey(*)
          ),
          route_stops(*)
        ),
        price:ride_request_price!ride_request_price_ride_request_id_fkey(*)
      `).eq("id",u).single();return d?(d.code==="PGRST116"?(console.error(`[bookingService] Ride request not found: ${u}`),console.error("[bookingService] Possible causes: Invalid ID, deleted record, or RLS policy blocking access")):console.error(`[bookingService] Database error fetching ride request: ${d.message}`,d),Wn(d),null):o?(console.log(`[bookingService] Successfully fetched ride request: ${u}`),o):(console.error(`[bookingService] No data returned for ride request ID: ${u}`),null)}catch(o){return console.error("[bookingService] Unexpected error fetching booking:",o),null}}async function dg(u,o,d){try{const g={status:o,updated_at:new Date().toISOString()};o==="accepted"&&(g.confirmed_at=new Date().toISOString());const{error:j}=await It.from("ride_requests").update(g).eq("id",u);if(j)return Wn(j),!1;if(o==="accepted"){const Z=await yv(u);if(Z&&Z.ride){const{error:S}=await It.from("rides").update({available_seats:Z.ride.available_seats-Z.requested_seats,updated_at:new Date().toISOString()}).eq("id",Z.ride_id);S&&console.error("Error updating ride seats:",S)}}return!0}catch(g){return console.error("Error updating booking status:",g),!1}}async function qx(u){try{const{data:o,error:d}=await It.from("ride_requests").select(`
        *,
        passenger:profiles!ride_requests_passenger_id_fkey(id, name, profile_image, rating, phone),
        price:ride_request_price!ride_request_price_ride_request_id_fkey(*)
      `).eq("ride_id",u).eq("status","pending").order("created_at",{ascending:!0});return d?(Wn(d),[]):o||[]}catch(o){return console.error("Error fetching pending bookings:",o),[]}}async function GI(u){try{const{data:o,error:d}=await It.from("ride_requests").select(`
        id, passenger_id, pickup_location, dropoff_location,
        passenger:profiles!ride_requests_passenger_id_fkey(id, name, profile_image)
      `).eq("ride_id",u).eq("status","accepted").order("created_at",{ascending:!0});if(d)throw d;return o||[]}catch(o){return Wn(o,"Failed to fetch accepted bookings"),[]}}async function UI(u,o){try{const{data:d,error:g}=await It.from("ride_requests").select("id").eq("passenger_id",u).eq("ride_id",o).in("status",["pending","accepted"]).limit(1);return g?(Wn(g),!1):d&&d.length>0||!1}catch(d){return console.error("Error checking existing booking:",d),!1}}async function Kx(u){try{const{data:o,error:d}=await It.from("ride_requests").select(`
        *,
        passenger:profiles!ride_requests_passenger_id_fkey(id, name, profile_image, rating, phone),
        price:ride_request_price!ride_request_price_ride_request_id_fkey(*)
      `).eq("ride_id",u).eq("status","accepted").order("created_at",{ascending:!0});return d?(Wn(d),[]):o||[]}catch(o){return console.error("Error fetching accepted passengers:",o),[]}}async function i_(u,o,d){try{const{data:g,error:j}=await It.from("conversations").select("*").eq("ride_request_id",u).single();if(g&&!j)return g;const{data:Z,error:S}=await It.from("conversations").insert([{ride_request_id:u,driver_id:o,passenger_id:d}]).select().single();return S?(console.error("Error creating conversation:",S),null):Z}catch(g){return console.error("Error in createOrGetConversation:",g),null}}async function aN(u){try{const{data:o,error:d}=await It.from("conversation_messages").select("*").eq("conversation_id",u).order("created_at",{ascending:!0});return d?(console.error("Error fetching messages:",d),[]):o||[]}catch(o){return console.error("Error in getConversationMessages:",o),[]}}async function rN(u,o,d){try{const{data:g,error:j}=await It.from("conversation_messages").insert([{conversation_id:u,sender_id:o,message_text:d}]).select().single();return j?(console.error("Error sending message:",j),null):g}catch(g){return console.error("Error in sendMessage:",g),null}}async function s_(u,o){try{const{error:d}=await It.from("conversation_messages").update({is_read:!0}).eq("conversation_id",u).neq("sender_id",o).eq("is_read",!1);return d?(console.error("Error marking messages as read:",d),!1):!0}catch(d){return console.error("Error in markMessagesAsRead:",d),!1}}function nN(u,o){const d=It.channel(`conversation:${u}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"conversation_messages",filter:`conversation_id=eq.${u}`},g=>{o(g.new)}).subscribe();return()=>{It.removeChannel(d)}}async function WI(u,o){try{const{count:d,error:g}=await It.from("conversation_messages").select("*",{count:"exact",head:!0}).eq("conversation_id",u).neq("sender_id",o).eq("is_read",!1);return g?(console.error("Error getting unread count:",g),0):d||0}catch(d){return console.error("Error in getUnreadCount:",d),0}}function XI(u){if(!u||u.status!=="completed"&&u.status!=="cancelled")return!1;const o=u.completed_at||u.updated_at||u.created_at;if(!o)return!1;const d=new Date(o);return(new Date().getTime()-d.getTime())/(1e3*60*60)>=8}async function iN(u){try{const{data:o,error:d}=await It.from("conversations").select(`
        *,
        driver:driver_id(name),
        passenger:passenger_id(name),
        ride_request:ride_request_id(
          ride:ride_id(
            status,
            completed_at,
            updated_at,
            created_at
          )
        )
      `).or(`driver_id.eq.${u},passenger_id.eq.${u}`).order("last_message_at",{ascending:!1});if(d)return console.error("Error fetching conversations:",d),[];if(!o)return[];const g=o.filter(Z=>{const S=Z.ride_request?.ride;return!XI(S)});return console.log(` Filtered ${o.length-g.length} old conversations`),await Promise.all(g.map(async Z=>{const{data:S}=await It.from("conversation_messages").select("message_text").eq("conversation_id",Z.id).order("created_at",{ascending:!1}).limit(1).single(),n=await WI(Z.id,u);return{...Z,last_message:S?.message_text||"",unread_count:n,driver_name:Z.driver?.name||"Driver",passenger_name:Z.passenger?.name||"Passenger"}}))}catch(o){return console.error("Error in getUserConversations:",o),[]}}async function QI(u,o,d){try{const{data:g,error:j}=await It.from("conversations").select("id").or(`and(driver_id.eq.${u},passenger_id.eq.${o}),and(driver_id.eq.${o},passenger_id.eq.${u})`).limit(1).single();if(g&&!j)return g.id;const{data:Z,error:S}=await It.from("conversations").insert({driver_id:u,passenger_id:o,ride_request_id:d||null,last_message_at:new Date().toISOString()}).select("id").single();if(S)throw S;return Z?.id||null}catch(g){return Wn(g,"Failed to get or create conversation"),null}}async function HI(u,o){try{const d=await QI(u,o.receiver_id,o.ride_id);if(!d)throw new Error("Failed to create conversation");const{data:g,error:j}=await It.from("conversation_messages").insert({conversation_id:d,sender_id:u,message_text:o.message,is_read:!1}).select(`
        *,
        sender:profiles!conversation_messages_sender_id_fkey(id, name, profile_image)
      `).single();if(j)throw j;return g}catch(d){return Wn(d,"Failed to send message"),null}}async function YI(u,o,d,g,j){const Z=` Ride starting soon! Please confirm your pickup address:

${j}

Reply with your exact address if different, or confirm this location.`;return HI(u,{receiver_id:o,message:Z,ride_id:d})}const gv=()=>!!window.inAppWebview,sN=(u,o)=>new Promise((d,g)=>{if(!gv()){g(new Error("Not in WebView"));return}const j=`${Date.now()}_${Math.random().toString(36).substr(2,9)}`;window._nativeCallbacks=window._nativeCallbacks||{},window._nativeCallbacks[j]={resolve:d,reject:g},window.inAppWebview.postMessage(JSON.stringify({type:u,data:o,requestId:j})),setTimeout(()=>{window._nativeCallbacks[j]&&(delete window._nativeCallbacks[j],g(new Error("Native call timeout")))},3e3)});typeof window<"u"&&(window.handleNativeResponse=u=>{const o=window._nativeCallbacks?.[u.requestId];o&&(u.success?o.resolve(u.data):o.reject(new Error(u.error||"Native call failed")),delete window._nativeCallbacks[u.requestId])});const o_=(u=100)=>{if(gv()){sN("vibrate",{pattern:u});return}"vibrate"in navigator&&navigator.vibrate(u)},un=(u="medium")=>{gv()&&sN("hapticFeedback",{type:u})};let G0=null,U0=null,W0=null,X0=null,Qf=null;async function $I(u,o,d=5e3){try{if(console.log(`[LocationService] Starting tracking for ride: ${u}`),!navigator.geolocation)return console.error("[LocationService] Geolocation not supported"),alert("GPS location tracking is not supported on this device"),!1;try{if((await navigator.permissions.query({name:"geolocation"})).state==="denied")return alert("Location permission denied. Please enable location access in your device settings."),!1}catch{console.warn("[LocationService] Permission API not supported, will prompt for location access")}U0=u;try{if("wakeLock"in navigator){Qf=await navigator.wakeLock.request("screen"),console.log("[LocationService] Screen WakeLock acquired - screen will stay on");const g=async()=>{if(Qf!==null&&document.visibilityState==="visible")try{Qf=await navigator.wakeLock.request("screen"),console.log("[LocationService] WakeLock re-acquired after visibility change")}catch{console.warn("[LocationService] WakeLock re-acquire failed, continuing without WakeLock")}};document.addEventListener("visibilitychange",g),Qf.addEventListener("release",()=>{console.log("[LocationService] WakeLock released"),document.removeEventListener("visibilitychange",g)})}else console.warn("[LocationService] WakeLock API not supported - device may sleep during tracking")}catch(g){g?.name==="NotAllowedError"?console.warn("[LocationService] WakeLock not allowed by Feature-Policy (iframe restriction) - tracking will continue without screen wake lock"):console.warn("[LocationService] WakeLock request failed:",g?.message||g,"- tracking will continue without screen wake lock"),Qf=null}return G0=navigator.geolocation.watchPosition(g=>{const j={lat:g.coords.latitude,lng:g.coords.longitude,heading:g.coords.heading||void 0,speed:g.coords.speed?g.coords.speed*3.6:void 0,accuracy:g.coords.accuracy,timestamp:new Date().toISOString()};X0=j,console.log("[LocationService] Location updated:",j)},g=>{switch(console.error("[LocationService] Geolocation error:",g),g.code){case g.PERMISSION_DENIED:alert("Location permission denied. Please enable location access to track your ride."),Lg();break;case g.POSITION_UNAVAILABLE:console.warn("[LocationService] Location information unavailable");break;case g.TIMEOUT:console.warn("[LocationService] Location request timed out");break}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}),W0=setInterval(async()=>{X0&&U0&&await qI(U0,o,X0)},d),console.log("[LocationService] Tracking started successfully"),!0}catch(g){return console.error("[LocationService] Error starting tracking:",g),!1}}function Lg(){console.log("[LocationService] Stopping tracking"),G0!==null&&(navigator.geolocation.clearWatch(G0),G0=null),W0&&(clearInterval(W0),W0=null),Qf!==null&&Qf.release().then(()=>{console.log("[LocationService] WakeLock released"),Qf=null}).catch(u=>{console.error("[LocationService] WakeLock release failed:",u)}),U0=null,X0=null,console.log("[LocationService] Tracking stopped")}async function qI(u,o,d){try{const{error:g}=await It.from("driver_locations").insert({ride_id:u,driver_id:o,lat:d.lat,lng:d.lng,heading:d.heading,speed:d.speed,accuracy:d.accuracy,timestamp:d.timestamp});return g?(console.error("[LocationService] Error saving location:",g),Wn(g),!1):!0}catch(g){return console.error("[LocationService] Error saving location:",g),!1}}async function ew(u){try{const{data:o,error:d}=await It.from("driver_locations").select("*").eq("ride_id",u).order("timestamp",{ascending:!1}).limit(1).single();return d?(d.code!=="PGRST116"&&Wn(d),null):o}catch(o){return console.error("[LocationService] Error getting latest location:",o),null}}function oN(u,o){console.log(`[LocationService] Subscribing to ride location: ${u}`);const d=It.channel(`driver-location-${u}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"driver_locations",filter:`ride_id=eq.${u}`},g=>{console.log("[LocationService] Location update received:",g.new),o(g.new)}).subscribe(g=>{console.log("[LocationService] Subscription status:",g)});return{unsubscribe:()=>{console.log("[LocationService] Unsubscribing from location updates"),d.unsubscribe()}}}function NL(u,o,d,g){const Z=(d-u)*Math.PI/180,S=(g-o)*Math.PI/180,n=Math.sin(Z/2)*Math.sin(Z/2)+Math.cos(u*Math.PI/180)*Math.cos(d*Math.PI/180)*Math.sin(S/2)*Math.sin(S/2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))}function KI(u,o=50){return o<=0?0:Math.round(u/o*60)}function ek(u,o=2e3){console.log("[LocationService] Starting SOS real-time tracking");let d=null,g=null,j=null;return d=navigator.geolocation.watchPosition(Z=>{j={lat:Z.coords.latitude,lng:Z.coords.longitude,heading:Z.coords.heading||void 0,speed:Z.coords.speed?Z.coords.speed*3.6:void 0,accuracy:Z.coords.accuracy,timestamp:new Date().toISOString()},console.log("[LocationService] SOS location updated:",j)},Z=>{console.error("[LocationService] SOS geolocation error:",Z)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}),g=setInterval(()=>{j&&u(j)},o),{stopTracking:()=>{console.log("[LocationService] Stopping SOS tracking"),d!==null&&navigator.geolocation.clearWatch(d),g&&clearInterval(g)}}}const k0=typeof window<"u"&&window.ywConfig?.mapbox_token||"";function lN({rideId:u,pickupLocation:o,dropoffLocation:d,role:g,onLocationUpdate:j,passengerPickups:Z=[]}){const S=fe.useRef(null),n=fe.useRef(null),B=fe.useRef(null),D=fe.useRef(!1),P=fe.useRef(null),G=fe.useRef(0),Y=fe.useRef(null),[X,ue]=fe.useState(null),[oe,pe]=fe.useState(0),[ve,ke]=fe.useState(0),[ye,$e]=fe.useState(!0),[De,Te]=fe.useState(!1),[Qe,Ft]=fe.useState([]),[bt,Qt]=fe.useState(!1);fe.useEffect(()=>{(async()=>{Qt(!0);try{console.log("[LiveTrackingMap] Fetching ride stops for ride:",u);const ht=await __(u);ht&&ht.route_stops?(console.log("[LiveTrackingMap] Loaded",ht.route_stops.length,"stops from database"),Ft(ht.route_stops)):(console.log("[LiveTrackingMap] No stops found for this ride"),Ft([]))}catch(ht){console.error("[LiveTrackingMap] Error fetching ride stops:",ht),Ft([])}finally{Qt(!1)}})()},[u]),fe.useEffect(()=>{if(!S.current||!k0)return;const st=document.createElement("script");st.src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js",st.async=!0;const ht=document.createElement("link");return ht.href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css",ht.rel="stylesheet",document.head.appendChild(ht),document.head.appendChild(st),st.onload=()=>{const Wt=window.mapboxgl;Wt.accessToken=k0;const qt=(o.lat+d.lat)/2,Lt=(o.lng+d.lng)/2;n.current=new Wt.Map({container:S.current,style:"mapbox://styles/mapbox/streets-v12",center:[Lt,qt],zoom:12}),new Wt.Marker({color:"#22c55e"}).setLngLat([o.lng,o.lat]).setPopup(new Wt.Popup().setHTML(`<strong>Pickup</strong><br/>${o.address}`)).addTo(n.current),new Wt.Marker({color:"#ef4444"}).setLngLat([d.lng,d.lat]).setPopup(new Wt.Popup().setHTML(`<strong>Dropoff</strong><br/>${d.address}`)).addTo(n.current),Z.length>0&&Z.forEach((ze,Ye)=>{const wt=document.createElement("div");wt.className="passenger-marker",wt.style.width="32px",wt.style.height="32px",wt.style.backgroundColor="#f59e0b",wt.style.color="white",wt.style.borderRadius="50%",wt.style.display="flex",wt.style.alignItems="center",wt.style.justifyContent="center",wt.style.fontWeight="bold",wt.style.fontSize="14px",wt.style.border="3px solid white",wt.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)",wt.textContent=String(Ye+1),new Wt.Marker({element:wt}).setLngLat([ze.lng,ze.lat]).setPopup(new Wt.Popup().setHTML(`<strong>${ze.passengerName}</strong><br/>${ze.address}`)).addTo(n.current)}),Qe.length>0&&Qe.forEach((ze,Ye)=>{if(!Z.some(Be=>Math.abs(Be.lat-ze.lat)<1e-4&&Math.abs(Be.lng-ze.lng)<1e-4)){const Be=document.createElement("div");Be.className="route-stop-marker",Be.style.width="28px",Be.style.height="28px",Be.style.backgroundColor="#8b5cf6",Be.style.color="white",Be.style.borderRadius="50%",Be.style.display="flex",Be.style.alignItems="center",Be.style.justifyContent="center",Be.style.fontWeight="bold",Be.style.fontSize="12px",Be.style.border="2px solid white",Be.style.boxShadow="0 2px 6px rgba(0,0,0,0.3)",Be.textContent=String(ze.stop_order+1),new Wt.Marker({element:Be}).setLngLat([ze.lng,ze.lat]).setPopup(new Wt.Popup().setHTML(`<strong>Stop ${ze.stop_order+1}</strong><br/>${ze.name}`)).addTo(n.current)}});const mt=document.createElement("div");mt.className="driver-marker",mt.style.width="40px",mt.style.height="40px",mt.style.backgroundImage="url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIyMCIgZmlsbD0iIzM0NjZmZiIvPjxjaXJjbGUgY3g9IjIwIiBjeT0iMjAiIHI9IjE1IiBmaWxsPSJ3aGl0ZSIvPjxwYXRoIGQ9Ik0yMCAxMEwyNSAyMEgyMFYzMEwxNSAyMEgyMFYxMFoiIGZpbGw9IiMzNDY2ZmYiLz48L3N2Zz4=)",mt.style.backgroundSize="cover",mt.style.borderRadius="50%",mt.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)",B.current=new Wt.Marker({element:mt}).setLngLat([Lt,qt]).addTo(n.current),$e(!1)},()=>{n.current&&n.current.remove()}},[o,d]),fe.useEffect(()=>{if(!n.current||ye||!X||bt)return;Gt(X)&&(console.log("[LiveTrackingMap] Route recalculation triggered"),yt(),P.current={lat:X.lat,lng:X.lng},G.current=Date.now(),Y.current=X.heading||null)},[X,Z,Qe,ye,bt]),fe.useEffect(()=>{g==="rider"&&n.current&&!ye&&!X&&!bt&&yt()},[g,ye,bt,Qe]);const Gt=st=>{if(g==="rider")return!1;if(!P.current)return!0;if(Date.now()-G.current>=15e3)return console.log("[Route Trigger] Time threshold reached: 15s"),!0;const Lt=NL(P.current.lat,P.current.lng,st.lat,st.lng)*1e3;if(Lt>=75)return console.log(`[Route Trigger] Distance threshold reached: ${Lt.toFixed(0)}m`),!0;if(st.heading!==null&&st.heading!==void 0&&Y.current!==null){let mt=Math.abs(st.heading-Y.current);if(mt>180&&(mt=360-mt),mt>=30)return console.log(`[Route Trigger] Heading change threshold reached: ${mt.toFixed(0)}`),!0}return!1},yt=async()=>{if(!(!n.current||!k0)){Te(!0);try{let st;g==="driver"&&X?st=[[X.lng,X.lat],...Z.map(mt=>[mt.lng,mt.lat]),...(Qe||[]).sort((mt,ze)=>mt.stop_order-ze.stop_order).map(mt=>[mt.lng,mt.lat]),[d.lng,d.lat]]:st=[[o.lng,o.lat],...Z.map(mt=>[mt.lng,mt.lat]),...(Qe||[]).sort((mt,ze)=>mt.stop_order-ze.stop_order).map(mt=>[mt.lng,mt.lat]),[d.lng,d.lat]];const Wt=`https://api.mapbox.com/directions/v5/mapbox/driving/${st.map(mt=>`${mt[0]},${mt[1]}`).join(";")}?geometries=geojson&access_token=${k0}&overview=full&steps=true`,Lt=await(await fetch(Wt)).json();if(Lt.routes&&Lt.routes.length>0){const mt=Lt.routes[0].geometry;D.current&&n.current.getLayer("route")&&(n.current.removeLayer("route"),n.current.removeSource("route"),D.current=!1),n.current.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:mt}}),n.current.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":5,"line-opacity":.75}}),D.current=!0;const ze=mt.coordinates,Ye=ze.reduce((wt,Be)=>wt.extend(Be),new window.mapboxgl.LngLatBounds(ze[0],ze[0]));n.current.fitBounds(Ye,{padding:{top:80,bottom:80,left:40,right:40}})}}catch(st){console.error("Error fetching route:",st)}finally{Te(!1)}}};fe.useEffect(()=>{if(g==="rider"){const st=oN(u,ht=>{Ke(ht)});return ew(u).then(ht=>{ht&&Ke(ht)}),()=>{st.unsubscribe()}}else{ew(u).then(ht=>{ht&&Ke(ht)});const st=setInterval(async()=>{const ht=await ew(u);ht&&Ke(ht)},5e3);return()=>clearInterval(st)}},[u,g]);const Ke=st=>{if(ue(st),B.current){if(B.current.setLngLat([st.lng,st.lat]),st.heading!==null&&st.heading!==void 0){const qt=B.current.getElement();qt.style.transform=`rotate(${st.heading}deg)`}g==="rider"&&n.current&&n.current.easeTo({center:[st.lng,st.lat],zoom:14,duration:1e3})}const ht=NL(st.lat,st.lng,d.lat,d.lng);pe(ht);const Wt=st.speed||50;ke(KI(ht,Wt)),j&&j(st)};return l.jsxs("div",{className:"w-full h-full relative bg-gray-100 rounded-xl overflow-hidden","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDY0OjQ","data-yw-s":!0,children:[l.jsx("div",{ref:S,className:"w-full h-full","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDY2OjY","data-yw-s":!0}),ye&&l.jsx("div",{className:"absolute inset-0 bg-white/90 flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDcwOjg","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDcxOjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDcyOjEy","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDczOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Loading map..."})]})}),De&&l.jsx("div",{className:"absolute top-20 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg text-sm","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDgwOjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDgxOjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDgyOjEy","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDgzOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Loading route..."})]})}),!ye&&X&&l.jsx("div",{className:"absolute bottom-4 left-4 right-4 bg-white rounded-xl shadow-lg p-3","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDkwOjg","data-yw-s":!0,children:l.jsxs("div",{className:"grid grid-cols-3 gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDkxOjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"text-center","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDkzOjEy","data-yw-s":!0,children:[l.jsx("div",{className:"flex items-center justify-center mb-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDk0OjE0","data-yw-s":!0,children:l.jsx(Yo,{className:"w-4 h-4 text-blue-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDk1OjE2","data-yw-s":!0})}),l.jsx("div",{className:"text-xs text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDk3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Distance"}),l.jsxs("div",{className:"text-base font-bold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDk4OjE0","data-yw-s":!0,children:[oe.toFixed(1),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANDk4Ojg2","data-yw-t":!0,"data-yw-auto":!0,children:" km"})]})]}),l.jsxs("div",{className:"text-center","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTAyOjEy","data-yw-s":!0,children:[l.jsx("div",{className:"flex items-center justify-center mb-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTAzOjE0","data-yw-s":!0,children:l.jsx(ws,{className:"w-4 h-4 text-green-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTA0OjE2","data-yw-s":!0})}),l.jsx("div",{className:"text-xs text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTA2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"ETA"}),l.jsxs("div",{className:"text-base font-bold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTA3OjE0","data-yw-s":!0,children:[ve,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTA3Ojcw","data-yw-t":!0,"data-yw-auto":!0,children:" min"})]})]}),l.jsxs("div",{className:"text-center","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTExOjEy","data-yw-s":!0,children:[l.jsx("div",{className:"flex items-center justify-center mb-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTEyOjE0","data-yw-s":!0,children:l.jsx(Xp,{className:"w-4 h-4 text-purple-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTEzOjE2","data-yw-s":!0})}),l.jsx("div",{className:"text-xs text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTE1OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Speed"}),l.jsxs("div",{className:"text-base font-bold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTE2OjE0","data-yw-s":!0,children:[X.speed?Math.round(X.speed):0,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTE3Ojc3","data-yw-t":!0,"data-yw-auto":!0,children:" km/h"})]})]})]})}),!ye&&!X&&g==="rider"&&l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTI2Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"text-center px-4","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTI3OjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full mx-auto mb-3 flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTI4OjEy","data-yw-s":!0,children:l.jsx(Yo,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTI5OjE0","data-yw-s":!0})}),l.jsx("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTMxOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Waiting for driver location"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0xpdmVUcmFja2luZ01hcC50c3hANTMyOjEy","data-yw-t":!0,"data-yw-s":!0,children:"The driver's location will appear here once they start the ride"})]})})]})}function tk({riderId:u,isOpen:o,onClose:d}){const[g,j]=fe.useState(null),[Z,S]=fe.useState([]),[n,B]=fe.useState(!0);fe.useEffect(()=>{o&&u&&D()},[o,u]);const D=async()=>{B(!0);try{const{data:P,error:G}=await It.from("profiles").select("*").eq("id",u).single();if(G)throw G;j(P);const{data:Y,error:X}=await It.from("reviews").select(`
          *,
          reviewer:profiles!reviews_reviewer_id_fkey(id, name, profile_image)
        `).eq("reviewed_user_id",u).order("created_at",{ascending:!1}).limit(10);if(X)throw X;S(Y||[])}catch(P){console.error("Error loading rider data:",P)}finally{B(!1)}};return o?l.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDU4OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[90vh] flex flex-col animate-slide-up",style:{paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDU5OjY","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-none flex items-center justify-between p-4 border-b border-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDY2Ojg","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDY3OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Rider Profile"}),l.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 rounded-full active:scale-95 transition-all","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDY4OjEw","data-yw-s":!0,children:l.jsx(lo,{className:"w-6 h-6 text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDcyOjEy","data-yw-s":!0})})]}),l.jsx("div",{className:"flex-1 overflow-y-auto","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDc3Ojg","data-yw-s":!0,children:n?l.jsx("div",{className:"flex items-center justify-center py-12","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDc5OjEy","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDgwOjE0","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDgxOjE2","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDgyOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Loading rider details..."})]})}):g?l.jsxs("div",{className:"px-4 py-4 space-y-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDg2OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDg4OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-4 mb-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDg5OjE2","data-yw-s":!0,children:[g.profile_image?l.jsx("img",{src:g.profile_image,alt:g.name,className:"w-20 h-20 rounded-full object-cover border-4 border-white shadow-md","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDkxOjIw","data-yw-s":!0}):l.jsx("div",{className:"w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center border-4 border-white shadow-md","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDk3OjIw","data-yw-s":!0,children:l.jsx(vg,{className:"w-10 h-10 text-white","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDk4OjIy","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwMToxOA","data-yw-s":!0,children:[l.jsx("h3",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwMjoyMA","data-yw-s":!0,children:g.name}),l.jsxs("div",{className:"flex items-center gap-1 mt-1","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwMzoyMA","data-yw-s":!0,children:[l.jsx(vs,{className:"w-5 h-5 text-yellow-500 fill-yellow-500","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwNDoyMg","data-yw-s":!0}),l.jsx("span",{className:"font-semibold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwNToyMg","data-yw-s":!0,children:g.rating?.toFixed(1)||"5.0"}),l.jsxs("span",{className:"text-sm text-gray-600 ml-1","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwODoyMg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwODo2Nw","data-yw-t":!0,"data-yw-auto":!0,children:"("}),Z.length,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEwOTo0MQ","data-yw-t":!0,"data-yw-auto":!0,children:" reviews)"})]})]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDExNjoxNg","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white/60 rounded-lg p-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDExNzoxOA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDExODoyMA","data-yw-s":!0,children:[l.jsx(Yp,{className:"w-4 h-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDExOToyMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDExOTo1Ng","data-yw-t":!0,"data-yw-auto":!0,children:"Total Rides"})]}),l.jsx("div",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEyMjoyMA","data-yw-s":!0,children:g.total_trips||0})]}),l.jsxs("div",{className:"bg-white/60 rounded-lg p-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEyNjoxOA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEyNzoyMA","data-yw-s":!0,children:[l.jsx(bl,{className:"w-4 h-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEyODoyMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEyODo1NA","data-yw-t":!0,"data-yw-auto":!0,children:"Member Since"})]}),l.jsx("div",{className:"text-sm font-semibold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDEzMToyMA","data-yw-s":!0,children:new Date(g.member_since||g.created_at).toLocaleDateString("en-US",{month:"short",year:"numeric"})})]})]}),g.bio&&l.jsx("div",{className:"mt-3 bg-white/60 rounded-lg p-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE0MjoxOA","data-yw-s":!0,children:l.jsx("p",{className:"text-sm text-gray-700","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE0MzoyMA","data-yw-s":!0,children:g.bio})})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE0OToxNA","data-yw-s":!0,children:[l.jsx("div",{className:"p-4 border-b border-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE1MDoxNg","data-yw-s":!0,children:l.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE1MToxOA","data-yw-s":!0,children:[l.jsx(eu,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE1MjoyMA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE1Mjo3MQ","data-yw-t":!0,"data-yw-auto":!0,children:"Reviews ("}),Z.length,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE1Mzo0NQ","data-yw-t":!0,"data-yw-auto":!0,children:")"})]})}),l.jsx("div",{className:"p-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE1NjoxNg","data-yw-s":!0,children:Z.length>0?l.jsx("div",{className:"space-y-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE1ODoyMA","data-yw-s":!0,children:Z.map(P=>l.jsxs("div",{className:"border-b border-gray-100 last:border-0 pb-4 last:pb-0","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE2MDoyNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE2MToyNg","data-yw-s":!0,children:[P.reviewer?.profile_image?l.jsx("img",{src:P.reviewer.profile_image,alt:P.reviewer.name,className:"w-10 h-10 rounded-full object-cover","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE2MzozMA","data-yw-s":!0}):l.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE2OTozMA","data-yw-s":!0,children:l.jsx(vg,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE3MDozMg","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE3MzoyOA","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE3NDozMA","data-yw-s":!0,children:P.reviewer?.name||"Anonymous"}),l.jsx("div",{className:"flex items-center gap-1","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE3NzozMA","data-yw-s":!0,children:[...Array(5)].map((G,Y)=>l.jsx(vs,{className:`w-4 h-4 ${Y<P.rating?"text-yellow-500 fill-yellow-500":"text-gray-300"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE3OTozNA","data-yw-s":!0},Y))})]}),l.jsx("span",{className:"text-xs text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE5MDoyOA","data-yw-s":!0,children:new Date(P.created_at).toLocaleDateString()})]}),P.comment&&l.jsx("p",{className:"text-sm text-gray-700 ml-13","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDE5NToyOA","data-yw-s":!0,children:P.comment})]},P.id))}):l.jsxs("div",{className:"text-center py-8","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDIwMToyMA","data-yw-s":!0,children:[l.jsx(eu,{className:"w-12 h-12 text-gray-300 mx-auto mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDIwMjoyMg","data-yw-s":!0}),l.jsx("p",{className:"text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDIwMzoyMg","data-yw-t":!0,"data-yw-s":!0,children:"No reviews yet"})]})})]})]}):l.jsx("div",{className:"flex items-center justify-center py-12","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDIxMDoxMg","data-yw-s":!0,children:l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZXJQcm9maWxlTW9kYWwudHN4QDIxMToxNA","data-yw-t":!0,"data-yw-s":!0,children:"Failed to load rider profile"})})})]})}):null}function ak(){return l.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-4 border border-gray-100 animate-pulse","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDQ6NA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDY6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"h-6 w-20 bg-gray-200 rounded-full","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDc6OA","data-yw-s":!0}),l.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDg6OA","data-yw-s":!0})]}),l.jsxs("div",{className:"space-y-3 mb-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDEyOjY","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDE0Ojg","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300 mt-1 flex-shrink-0","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDE1OjEw","data-yw-s":!0}),l.jsxs("div",{className:"flex-1 space-y-2","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDE2OjEw","data-yw-s":!0,children:[l.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDE3OjEy","data-yw-s":!0}),l.jsx("div",{className:"h-3 bg-gray-100 rounded w-1/2","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDE4OjEy","data-yw-s":!0})]})]}),l.jsx("div",{className:"ml-1.5 w-0.5 h-6 bg-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDIzOjg","data-yw-s":!0}),l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDI2Ojg","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300 mt-1 flex-shrink-0","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDI3OjEw","data-yw-s":!0}),l.jsxs("div",{className:"flex-1 space-y-2","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDI4OjEw","data-yw-s":!0,children:[l.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDI5OjEy","data-yw-s":!0}),l.jsx("div",{className:"h-3 bg-gray-100 rounded w-5/12","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDMwOjEy","data-yw-s":!0})]})]})]}),l.jsxs("div",{className:"flex items-center justify-between text-sm pt-3 border-t border-gray-100","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDM2OjY","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-4","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDM3Ojg","data-yw-s":!0,children:[l.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDM4OjEw","data-yw-s":!0}),l.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDM5OjEw","data-yw-s":!0})]}),l.jsx("div",{className:"h-4 w-4 bg-gray-200 rounded","data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDQxOjg","data-yw-s":!0})]})]})}function _v({count:u=3}){return l.jsx(l.Fragment,{children:Array.from({length:u}).map((o,d)=>l.jsx(ak,{"data-yw":"c3JjL2NvbXBvbmVudHMvUmlkZUNhcmQudHN4QDUyOjg","data-yw-s":!0},d))})}function rk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState([]),[Z,S]=fe.useState({totalRides:0,completedRides:0,upcomingRides:0,cancelledRides:0}),[n,B]=fe.useState(!0),[D,P]=fe.useState(!0),[G,Y]=fe.useState(null),[X,ue]=fe.useState(null),[oe,pe]=fe.useState(null),[ve,ke]=fe.useState(!1),[ye,$e]=fe.useState(null),[De,Te]=fe.useState(!1),[Qe,Ft]=fe.useState([]),[bt,Qt]=fe.useState(null),[Gt,yt]=fe.useState(!1);fe.useEffect(()=>(Ke(),()=>{ve&&Lg()}),[u]);const Ke=async()=>{const mt=await ui();if(!mt||mt.userType!=="driver"){u("/auth");return}d(mt),B(!1),await st(mt.id)},st=async mt=>{try{P(!0);const[ze,Ye,wt]=await Promise.all([mv(mt),kI(mt),Iw(mt)]),ba=pv(ze).filter(Ja=>Ja.status==="pending");j(ba),S(Ye);const lr=wt.find(Ja=>Ja.status==="ongoing");if(pe(lr||null),lr){const Ja=await GI(lr.id);Ft(Ja)}else Ft([]);lr&&!ve?await $I(lr.id,mt)&&(ke(!0),un("success")):!lr&&ve&&(Lg(),ke(!1))}catch(ze){console.error("Error loading booking requests:",ze)}finally{P(!1)}},ht=async(mt,ze,Ye)=>{ue(mt),un("medium");try{await dg(mt,"accepted")?(await i_(mt,ze,Ye),await st(ze),Y(null),un("success"),alert("Request accepted successfully!")):alert("Failed to accept request. Please try again.")}catch(wt){console.error("Error accepting request:",wt),alert("An error occurred while accepting the request.")}finally{ue(null)}},Wt=async mt=>{if(window.confirm("Are you sure you want to decline this request?")){ue(mt),un("light");try{await dg(mt,"rejected")?(o&&await st(o.id),Y(null),un("light")):alert("Failed to decline request. Please try again.")}catch(ze){console.error("Error declining request:",ze),alert("An error occurred while declining the request.")}finally{ue(null)}}},qt=async(mt,ze,Ye,wt)=>{if(!(!o||!oe)){Qt(Ye),un("light");try{await YI(o.id,mt,oe.id,Ye,wt)?(un("success"),alert(`Pickup confirmation request sent to ${ze}!`)):alert("Failed to send confirmation request. Please try again.")}catch(Be){console.error("Error sending pickup confirmation:",Be),alert("An error occurred while sending the confirmation request.")}finally{Qt(null)}}},Lt=mt=>mt.price_per_seat!=null?mt.price_per_seat:mt.ride?.price_per_seat||0;return l.jsxs("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMTY6NA","data-yw-s":!0,children:[l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMTc6Ng","data-yw-s":!0,children:[!o&&n?l.jsx("div",{className:"flex-1 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMjQ6MTA","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMjU6MTI","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMjY6MTQ","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMjc6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):o?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex-none bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMzM6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMzQ6MTQ","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMzU6MTY","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMzY6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Welcome back!"}),l.jsx("p",{className:"text-blue-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMzc6MTg","data-yw-s":!0,children:o.name})]}),l.jsx(YZ,{onOpen:()=>yt(!0),className:"p-2 bg-white/20 rounded-full hover:bg-white/30 active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyMzk6MTY","data-yw-s":!0})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNDY6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNDc6MTY","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNDg6MTg","data-yw-s":!0,children:[l.jsx(Yp,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNDk6MjA","data-yw-s":!0}),l.jsx("span",{className:"text-xs font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNTA6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Total Rides"})]}),l.jsx("div",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNTI6MTg","data-yw-s":!0,children:Z.totalRides})]}),l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNTU6MTY","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNTY6MTg","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNTc6MjA","data-yw-s":!0}),l.jsx("span",{className:"text-xs font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNTg6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Upcoming"})]}),l.jsx("div",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNjA6MTg","data-yw-s":!0,children:Z.upcomingRides})]})]})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 pb-24","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNjY6MTI","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNjc6MTQ","data-yw-s":!0,children:[oe&&l.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 overflow-hidden","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNzA6MTg","data-yw-s":!0,children:[l.jsxs("div",{className:"px-4 pt-3 pb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNzE6MjA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNzI6MjI","data-yw-s":!0,children:[l.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNzM6MjQ","data-yw-s":!0,children:[l.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNzQ6MjY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNzQ6OTc","data-yw-t":!0,"data-yw-auto":!0,children:"Live Tracking"})]}),l.jsx("span",{className:"text-xs bg-green-600 text-white px-2 py-1 rounded-full font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyNzc6MjQ","data-yw-t":!0,"data-yw-s":!0,children:"ONGOING"})]}),l.jsxs("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyODE6MjI","data-yw-s":!0,children:[oe.from_location?.address,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyODI6NjA","data-yw-t":!0,"data-yw-auto":!0,children:"  "}),oe.to_location?.address]})]}),l.jsx("div",{className:"h-[500px]","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyODU6MjA","data-yw-s":!0,children:l.jsx(lN,{rideId:oe.id,pickupLocation:oe.from_location,dropoffLocation:oe.to_location,role:"driver",passengerPickups:Qe.map(mt=>({lat:mt.pickup_location.lat,lng:mt.pickup_location.lng,address:mt.pickup_location.address,passengerId:mt.passenger_id,passengerName:mt.passenger?.name||"Passenger"})),"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAyODY6MjI","data-yw-s":!0})}),Qe.length>0&&l.jsxs("div",{className:"mt-3 px-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMDM6MjI","data-yw-s":!0,children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMDQ6MjQ","data-yw-t":!0,"data-yw-s":!0,children:"Passenger Pickups"}),l.jsx("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMDU6MjQ","data-yw-s":!0,children:Qe.map((mt,ze)=>l.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMDc6Mjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMDg6MzA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3 flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMDk6MzI","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-500 text-white flex items-center justify-center font-bold text-sm flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMTA6MzQ","data-yw-s":!0,children:ze+1}),l.jsxs("div",{className:"flex-1 min-w-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMTM6MzQ","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMTQ6MzY","data-yw-s":!0,children:mt.passenger?.name||"Passenger"}),l.jsx("div",{className:"text-sm text-gray-600 mt-1 line-clamp-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMTU6MzY","data-yw-s":!0,children:mt.pickup_location.address})]})]}),l.jsx("button",{onClick:()=>qt(mt.passenger_id,mt.passenger?.name||"Passenger",mt.id,mt.pickup_location.address),disabled:bt===mt.id,className:"ml-2 p-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 active:scale-95 transition-all disabled:opacity-50 flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMjA6MzI","data-yw-s":!0,children:bt===mt.id?l.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMzE6MzY","data-yw-s":!0}):l.jsx(eu,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzMzM6MzY","data-yw-s":!0})})]})},mt.id))})]})]}),l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNDU6MTY","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNDY6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Ride Requests"}),g.length>0&&l.jsx("span",{className:"bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNDg6MjA","data-yw-s":!0,children:g.length})]}),D?l.jsx(_v,{count:3,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNTY6MTg","data-yw-s":!0}):g.length>0?l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNTg6MTg","data-yw-s":!0,children:g.map(mt=>{const ze=Lt(mt),Ye=mt.pickup_location?.address!==mt.ride?.from_location?.address||mt.dropoff_location?.address!==mt.ride?.to_location?.address;return l.jsxs("div",{onClick:()=>Y(mt),className:"bg-white rounded-xl p-4 shadow-sm border border-orange-200 active:scale-98 transition-all cursor-pointer","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNjY6MjQ","data-yw-s":!0,children:[Ye&&l.jsx("div",{className:"mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNzM6Mjg","data-yw-s":!0}),l.jsxs("div",{className:"flex items-center gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNzg6MjY","data-yw-s":!0,children:[l.jsx("div",{onClick:wt=>{wt.stopPropagation(),$e(mt.passenger_id),Te(!0)},className:"cursor-pointer","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzNzk6Mjg","data-yw-s":!0,children:mt.passenger?.profile_image?l.jsx(bg,{src:mt.passenger.profile_image,alt:mt.passenger.name,className:"w-12 h-12 rounded-full object-cover border-2 border-gray-200 hover:border-blue-500 transition-colors","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzODg6MzI","data-yw-s":!0}):l.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center hover:bg-blue-100 transition-colors","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzOTQ6MzI","data-yw-s":!0,children:l.jsx("span",{className:"text-gray-600 font-semibold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEAzOTU6MzQ","data-yw-s":!0,children:mt.passenger?.name?.charAt(0)||"?"})})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDE6Mjg","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDI6MzA","data-yw-s":!0,children:mt.passenger?.name||"Unknown"}),l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDM6MzA","data-yw-s":!0,children:[mt.requested_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDQ6NTc","data-yw-t":!0,"data-yw-auto":!0,children:" seat"}),mt.requested_seats>1?"s":"",l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDQ6MTAy","data-yw-t":!0,"data-yw-auto":!0,children:" requested"})]})]}),l.jsxs("div",{className:"text-right","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDc6Mjg","data-yw-s":!0,children:[l.jsx("div",{className:"text-orange-600 font-semibold text-xs","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDg6MzA","data-yw-t":!0,"data-yw-s":!0,children:"NEW"}),l.jsxs("div",{className:"text-lg font-bold text-blue-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDk6MzA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MDk6Nzk","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),(ze*mt.requested_seats).toFixed(2)]})]})]}),l.jsxs("div",{className:"space-y-1 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MTY6MjY","data-yw-s":!0,children:[l.jsxs("div",{className:"text-sm text-gray-600",style:{fontWeight:"bold"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MTc6Mjg","data-yw-s":!0,children:[mt.pickup_location?.address||"N/A",l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MjI6NzQ","data-yw-t":!0,"data-yw-auto":!0,children:" "}),mt.dropoff_location?.address||"N/A"]}),Ye,l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MjU6Mjg","data-yw-s":!0,children:[l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MjY6MzA","data-yw-t":!0,"data-yw-s":!0,children:"Date:"})," ",mt.ride?.date,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0MjY6OTM","data-yw-t":!0,"data-yw-auto":!0,children:" at "}),Cl(mt.ride?.time)]})]}),mt.message]},mt.id)})}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center space-y-3 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0Mzg6MTg","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0Mzk6MjA","data-yw-s":!0,children:l.jsx(Xh,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NDA6MjI","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NDI6MjA","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NDM6MjI","data-yw-t":!0,"data-yw-s":!0,children:"No pending requests"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NDQ6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Booking requests from riders will appear here"})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NTA6MTY","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NTE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Quick Actions"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NTI6MTg","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u("/driver/trips"),className:"bg-blue-50 text-blue-700 py-3 rounded-lg font-medium hover:bg-blue-100 active:scale-95 transition-all border border-blue-200 min-h-touch","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NTM6MjA","data-yw-t":!0,"data-yw-s":!0,children:"View Trips"}),l.jsx("button",{onClick:()=>u("/driver/post-ride"),className:"bg-green-50 text-green-700 py-3 rounded-lg font-medium hover:bg-green-100 active:scale-95 transition-all border border-green-200 min-h-touch","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NTk6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Post Ride"})]})]})]})})]}):null,l.jsx(qf,{userType:"driver","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0NzM6OA","data-yw-s":!0})]}),G&&l.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0Nzc6OA","data-yw-s":!0,children:l.jsxs("div",{className:"w-full bg-white rounded-t-3xl max-h-[90vh] flex flex-col animate-slide-up",style:{paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0Nzg6MTA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-none flex items-center justify-between p-4 border-b border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0ODU6MTI","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0ODY6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Ride Request Details"}),l.jsx("button",{onClick:()=>Y(null),className:"p-2 hover:bg-gray-100 rounded-full active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0ODc6MTQ","data-yw-s":!0,children:l.jsx(lo,{className:"w-6 h-6 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0OTE6MTY","data-yw-s":!0})})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0OTY6MTI","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0OTc6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA0OTk6MTY","data-yw-s":!0,children:[l.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MDA6MTg","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MDE6MjA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MDE6NDk","data-yw-t":!0,"data-yw-auto":!0,children:"Passenger Information"})]}),l.jsxs("div",{className:"flex items-center gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MDQ6MTg","data-yw-s":!0,children:[G.passenger?.profile_image?l.jsx(bg,{src:G.passenger.profile_image,alt:G.passenger.name,className:"w-16 h-16 rounded-full object-cover border-2 border-white shadow-md","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MDY6MjI","data-yw-s":!0}):l.jsx("div",{className:"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center border-2 border-white shadow-md","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MTI6MjI","data-yw-s":!0,children:l.jsx("span",{className:"text-white font-bold text-xl","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MTM6MjQ","data-yw-s":!0,children:G.passenger?.name?.charAt(0)||"?"})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MTg6MjA","data-yw-s":!0,children:[l.jsx("div",{className:"font-bold text-gray-900 text-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MTk6MjI","data-yw-s":!0,children:G.passenger?.name||"Unknown Passenger"}),G.passenger?.rating&&l.jsxs("div",{className:"flex items-center gap-1 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MjQ6MjQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-yellow-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MjU6MjY","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsx("span",{className:"text-sm font-medium text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MjY6MjY","data-yw-s":!0,children:G.passenger.rating.toFixed(1)})]})]})]}),l.jsxs("div",{className:"flex items-center justify-between bg-white/60 rounded-lg p-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MzM6MTg","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MzQ6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Seats Requested"}),l.jsxs("span",{className:"font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MzU6MjA","data-yw-s":!0,children:[G.requested_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1MzY6NTU","data-yw-t":!0,"data-yw-auto":!0,children:" seat"}),G.requested_seats>1?"s":""]})]})]}),l.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NDI6MTY","data-yw-s":!0,children:[l.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NDM6MTg","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NDQ6MjA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NDQ6NTA","data-yw-t":!0,"data-yw-auto":!0,children:"Trip Details"})]}),l.jsx("div",{className:"space-y-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NDk6MTg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTA6MjA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex flex-col items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTE6MjI","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTI6MjQ","data-yw-s":!0}),l.jsx("div",{className:"w-0.5 h-8 bg-gray-300","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTM6MjQ","data-yw-s":!0}),l.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTQ6MjQ","data-yw-s":!0})]}),l.jsxs("div",{className:"flex-1 space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTY6MjI","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTc6MjQ","data-yw-s":!0,children:[l.jsx("div",{className:"text-xs text-gray-500 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTg6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Pickup Location"}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NTk6MjY","data-yw-s":!0,children:G.pickup_location?.address||"N/A"})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NjM6MjQ","data-yw-s":!0,children:[l.jsx("div",{className:"text-xs text-gray-500 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NjQ6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Dropoff Location"}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1NjU6MjY","data-yw-s":!0,children:G.dropoff_location?.address||"N/A"})]})]})]})}),(G.pickup_location?.address!==G.ride?.from_location?.address||G.dropoff_location?.address!==G.ride?.to_location?.address)&&l.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1ODA6MjI","data-yw-s":!0,children:[l.jsx("div",{className:"text-xs font-semibold text-purple-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1ODE6MjQ","data-yw-t":!0,"data-yw-s":!0,children:" Segment Booking (Partial Route)"}),l.jsxs("div",{className:"text-xs text-purple-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1ODQ6MjQ","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1ODQ6NjU","data-yw-t":!0,"data-yw-auto":!0,children:"Full route: "}),G.ride?.from_location?.address,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1ODU6ODQ","data-yw-t":!0,"data-yw-auto":!0,children:"  "}),G.ride?.to_location?.address]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1OTI6MTg","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-lg p-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1OTM6MjA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1OTQ6MjI","data-yw-s":!0,children:[l.jsx(bl,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1OTU6MjQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1OTU6NTY","data-yw-t":!0,"data-yw-auto":!0,children:"Date"})]}),l.jsx("div",{className:"font-medium text-gray-900 text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA1OTg6MjI","data-yw-s":!0,children:G.ride?.date||"N/A"})]}),l.jsxs("div",{className:"bg-white rounded-lg p-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MDI6MjA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MDM6MjI","data-yw-s":!0,children:[l.jsx(ws,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MDQ6MjQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MDQ6NTM","data-yw-t":!0,"data-yw-auto":!0,children:"Time"})]}),l.jsx("div",{className:"font-medium text-gray-900 text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MDc6MjI","data-yw-s":!0,children:Cl(G.ride?.time)||"N/A"})]})]})]}),G.message&&l.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MTY6MTg","data-yw-s":!0,children:[l.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MTc6MjA","data-yw-s":!0,children:[l.jsx(eu,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MTg6MjI","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MTg6NTk","data-yw-t":!0,"data-yw-auto":!0,children:"Passenger Message"})]}),l.jsx("p",{className:"text-gray-800 text-sm leading-relaxed","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MjE6MjA","data-yw-s":!0,children:G.message})]}),l.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2Mjg6MTY","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2Mjk6MTg","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzA6MjA","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzE6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Total Earning"}),l.jsxs("div",{className:"text-3xl font-bold text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzI6MjI","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzI6NzM","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),(Lt(G)*G.requested_seats).toFixed(2)]}),l.jsxs("div",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzU6MjI","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzU6NjY","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),Lt(G).toFixed(2),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzY6NzA","data-yw-t":!0,"data-yw-auto":!0,children:" per seat  "}),G.requested_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2MzY6MTE1","data-yw-t":!0,"data-yw-auto":!0,children:" seat"}),G.requested_seats>1?"s":""]})]}),l.jsx(Ho,{className:"w-12 h-12 text-green-500 opacity-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2Mzk6MjA","data-yw-s":!0})]})})]})}),l.jsx("div",{className:"flex-none p-4 border-t border-gray-200 bg-white","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2NDY6MTI","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2NDc6MTQ","data-yw-s":!0,children:[l.jsxs("button",{onClick:()=>{u(`/driver/chat/${G.id}`)},className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 rounded-xl font-semibold hover:from-purple-700 hover:to-indigo-700 active:scale-95 transition-all min-h-touch shadow-lg shadow-purple-600/30 flex items-center justify-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2NDk6MTY","data-yw-s":!0,children:[l.jsx(eu,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2NTU6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2NTU6NTU","data-yw-t":!0,"data-yw-auto":!0,children:"Chat with Passenger"})]}),l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2NjA6MTY","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>Wt(G.id),disabled:X===G.id,className:"flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200 active:scale-95 transition-all min-h-touch disabled:opacity-50 disabled:cursor-not-allowed","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2NjE6MTg","data-yw-s":!0,children:X===G.id?"Processing...":"Decline"}),l.jsx("button",{onClick:()=>ht(G.id,o.id,G.passenger_id),disabled:X===G.id,className:"flex-1 bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 active:scale-95 transition-all min-h-touch shadow-lg shadow-blue-600/30 disabled:opacity-50 disabled:cursor-not-allowed","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2Njg6MTg","data-yw-s":!0,children:X===G.id?"Processing...":"Accept Request"})]})]})})]})}),ye&&l.jsx(tk,{riderId:ye,isOpen:De,onClose:()=>{Te(!1),$e(null)},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2ODM6OA","data-yw-s":!0}),l.jsx($Z,{isOpen:Gt,onClose:()=>yt(!1),"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJIb21lLnRzeEA2OTQ6Ng","data-yw-s":!0})]})}const cN=({isOpen:u,onClose:o,onSubmit:d,userName:g,userImage:j,userType:Z})=>{const[S,n]=fe.useState(0),[B,D]=fe.useState(0),[P,G]=fe.useState(""),[Y,X]=fe.useState(!1);if(!u)return null;const ue=pe=>{n(pe),un("light")},oe=async()=>{if(S===0){alert("Please select a rating");return}X(!0),un("medium");try{await d(S,P),o()}catch(pe){console.error("Error submitting rating:",pe),alert("Failed to submit rating. Please try again.")}finally{X(!1)}};return l.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA1NTo0","data-yw-s":!0,children:[l.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:o,"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA1Nzo2","data-yw-s":!0}),l.jsxs("div",{className:"relative bg-white rounded-t-3xl sm:rounded-3xl w-full sm:max-w-md max-h-[90vh] overflow-y-auto",style:{paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA2Mzo2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA2ODo4","data-yw-s":!0,children:[l.jsxs("h2",{className:"text-lg font-semibold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA2OToxMA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA2OTo2Mg","data-yw-t":!0,"data-yw-auto":!0,children:"Rate Your "}),Z==="driver"?"Driver":"Passenger"]}),l.jsx("button",{onClick:o,className:"p-2 active:bg-gray-100 rounded-full","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA3MjoxMA","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5 text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA3NjoxMg","data-yw-s":!0})})]}),l.jsxs("div",{className:"p-6 space-y-6","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA4MTo4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex flex-col items-center","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA4MzoxMA","data-yw-s":!0,children:[l.jsx("img",{src:j||"/assets/placeholder-avatar.jpg",alt:g,className:"w-20 h-20 rounded-full object-cover mb-3","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA4NDoxMg","data-yw-s":!0}),l.jsx("h3",{className:"text-xl font-semibold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA4OToxMg","data-yw-s":!0,children:g}),l.jsxs("p",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA5MDoxMg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA5MDo0OQ","data-yw-t":!0,"data-yw-auto":!0,children:"How was your ride with "}),g,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA5MTo0Nw","data-yw-t":!0,"data-yw-auto":!0,children:"?"})]})]}),l.jsx("div",{className:"flex justify-center gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA5NjoxMA","data-yw-s":!0,children:[1,2,3,4,5].map(pe=>l.jsx("button",{onClick:()=>ue(pe),onMouseEnter:()=>D(pe),onMouseLeave:()=>D(0),className:"p-1 active:scale-110 transition-transform","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEA5ODoxNA","data-yw-s":!0,children:l.jsx(vs,{className:`w-10 h-10 ${pe<=(B||S)?"text-yellow-500 fill-yellow-500":"text-gray-300"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxMDU6MTY","data-yw-s":!0})},pe))}),S>0&&l.jsx("div",{className:"text-center","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxMTg6MTI","data-yw-s":!0,children:l.jsxs("p",{className:"text-lg font-medium text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxMTk6MTQ","data-yw-s":!0,children:[S===5&&"Excellent!",S===4&&"Great!",S===3&&"Good",S===2&&"Fair",S===1&&"Poor"]})}),l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxMzA6MTA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxMzE6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Add a comment (optional)"}),l.jsx("textarea",{value:P,onChange:pe=>G(pe.target.value),placeholder:"Share your experience...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:500,"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxMzQ6MTI","data-yw-s":!0}),l.jsxs("div",{className:"text-xs text-gray-500 text-right mt-1","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxNDI6MTI","data-yw-s":!0,children:[P.length,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxNDM6MzA","data-yw-t":!0,"data-yw-auto":!0,children:"/500"})]})]}),l.jsx("button",{onClick:oe,disabled:Y||S===0,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium active:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxNDg6MTA","data-yw-s":!0,children:Y?"Submitting...":"Submit Rating"}),l.jsx("button",{onClick:o,className:"w-full text-gray-600 py-2 text-sm","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ01vZGFsLnRzeEAxNTc6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Skip for now"})]})]})]})};function uN({rating:u,pending:o=!1,size:d="sm"}){if(o)return l.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 border border-yellow-200 ${d==="sm"?"text-xs":"text-sm"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ0JhZGdlLnRzeEAyNDo2","data-yw-s":!0,children:[l.jsx(ws,{className:`${d==="sm"?"w-3 h-3":"w-4 h-4"} text-yellow-600`,"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ0JhZGdlLnRzeEAyNzo4","data-yw-s":!0}),l.jsx("span",{className:"font-medium text-yellow-700","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ0JhZGdlLnRzeEAyODo4","data-yw-t":!0,"data-yw-s":!0,children:"Pending"})]});if(!u)return null;const g=u.toFixed(1),j=u>=4.5?"bg-green-50 border-green-200 text-green-700":u>=4?"bg-blue-50 border-blue-200 text-blue-700":u>=3?"bg-yellow-50 border-yellow-200 text-yellow-700":"bg-orange-50 border-orange-200 text-orange-700";return l.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full border ${j} ${d==="sm"?"text-xs":"text-sm"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ0JhZGdlLnRzeEA0OTo0","data-yw-s":!0,children:[l.jsx(vs,{className:`${d==="sm"?"w-3 h-3":"w-4 h-4"} fill-current`,"data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ0JhZGdlLnRzeEA1Mjo2","data-yw-s":!0}),l.jsx("span",{className:"font-semibold","data-yw":"c3JjL2NvbXBvbmVudHMvcmF0aW5nL1JhdGluZ0JhZGdlLnRzeEA1Mzo2","data-yw-s":!0,children:g})]})}async function dN(u,o){try{console.log("[ratingService] Creating review:",{reviewerId:u,...o});const{data:d,error:g}=await It.from("reviews").insert([{reviewer_id:u,...o}]).select().single();if(g)throw console.error("[ratingService]  Failed to create review:",g),g;return console.log("[ratingService]  Review created successfully:",d.id),await sk(o.reviewed_user_id),console.log("[ratingService] Note: If you see RLS errors above, apply RATING_UPDATE_TRIGGER_FIX.sql to your database"),d}catch(d){return console.error("[ratingService] Error creating review:",d),null}}async function nk(u){try{const{data:o,error:d}=await It.from("reviews").select(`
        *,
        reviewed_user:profiles!reviews_reviewed_user_id_fkey(name, profile_image)
      `).eq("reviewer_id",u).order("created_at",{ascending:!1});if(d)throw d;return o||[]}catch(o){return console.error("Error getting reviews by user:",o),[]}}async function ik(u){try{const{data:o,error:d}=await It.from("reviews").select(`
        *,
        reviewer:profiles!reviews_reviewer_id_fkey(name, profile_image)
      `).eq("reviewed_user_id",u).order("created_at",{ascending:!1});if(d)throw d;return o||[]}catch(o){return console.error("Error getting reviews for user:",o),[]}}async function hN(u){try{const{data:o,error:d}=await It.from("reviews").select("rating").eq("reviewed_user_id",u);if(d)throw d;if(!o||o.length===0)return 5;const g=o.reduce((j,Z)=>j+Z.rating,0);return Number((g/o.length).toFixed(2))}catch(o){return console.error("Error calculating average rating:",o),5}}async function sk(u){try{const o=await hN(u);console.log(`[ratingService] Attempting to update rating for user ${u} to ${o}`);const{error:d}=await It.from("profiles").update({rating:o}).eq("id",u);if(d)throw console.error("[ratingService]  CRITICAL: Rating update blocked by RLS policy:",d),console.error("[ratingService] This is expected - ratings should be updated by database trigger"),console.error("[ratingService] Please apply RATING_UPDATE_TRIGGER_FIX.sql to your Supabase database"),d;console.log(`[ratingService]  Rating updated successfully for user ${u}`)}catch(o){console.error("[ratingService] Error updating user rating:",o)}}async function Jw(u,o,d){try{const{data:g,error:j}=await It.from("reviews").select("id").eq("reviewer_id",u).eq("reviewed_user_id",o).eq("ride_id",d).limit(1);if(j)throw j;return g&&g.length>0||!1}catch(g){return console.error("Error checking if user reviewed:",g),!1}}function ok(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState("scheduled"),[Z,S]=fe.useState([]),[n,B]=fe.useState(!0),[D,P]=fe.useState(!1),[G,Y]=fe.useState(null),[X,ue]=fe.useState(null),[oe,pe]=fe.useState(new Set),ve=fe.useRef(null);fe.useEffect(()=>{ye()},[u]),fe.useEffect(()=>(o&&($e(),ke()),()=>{ve.current&&(console.log(" Unsubscribing from rides realtime updates"),It.removeChannel(ve.current),ve.current=null)}),[g,o]);const ke=()=>{if(!o)return;ve.current&&It.removeChannel(ve.current),console.log(" Setting up realtime subscription for driver rides");const bt=It.channel("driver-rides-changes").on("postgres_changes",{event:"*",schema:"public",table:"rides",filter:`driver_id=eq.${o.id}`},Qt=>{console.log(" Ride change detected:",Qt),$e()}).on("postgres_changes",{event:"*",schema:"public",table:"ride_requests"},Qt=>{console.log(" Ride request change detected:",Qt),$e()}).subscribe(Qt=>{Qt==="SUBSCRIBED"?console.log(" Successfully subscribed to realtime updates"):Qt==="CLOSED"?console.log(" Realtime subscription closed"):Qt==="CHANNEL_ERROR"&&console.error(" Realtime subscription error")});ve.current=bt},ye=async()=>{B(!0);const bt=await ui();if(!bt||bt.userType!=="driver"){u("/auth");return}d(bt),await $e(bt.id),B(!1)},$e=async bt=>{const Qt=bt||o?.id;if(Qt)try{const Gt=await Iw(Qt);console.log("All rides from DB:",Gt);const yt=Bw(Gt),Ke=yt.filter(st=>st.status===g);console.log("Filtered rides:",Ke),S(Ke),await De(Qt,yt)}catch(Gt){console.error("Error loading rides:",Gt),S([])}},De=async(bt,Qt)=>{const Gt=Qt.filter(ht=>ht.status==="completed"),yt=new Set;let Ke=null,st=null;for(const ht of Gt){const qt=(await mv(bt)).filter(Lt=>Lt.ride_id===ht.id&&Lt.status==="accepted");for(const Lt of qt){if(!Lt.passenger)continue;await Jw(bt,Lt.passenger.id,ht.id)||(yt.add(ht.id),Ke||(Ke=Lt.passenger,st=ht))}}pe(yt),Ke&&st&&(Y(Ke),ue(st),P(!0))},Te=async(bt,Qt)=>{if(!o||!G||!X)return;if(await dN(o.id,{reviewed_user_id:G.id,ride_id:X.id,rating:bt,comment:Qt})){P(!1),Y(null),ue(null);const yt=await Iw(o.id),Ke=Bw(yt);await De(o.id,Ke)}},Qe=[{label:"Scheduled",value:"scheduled",color:"blue"},{label:"Ongoing",value:"ongoing",color:"green"},{label:"Completed",value:"completed",color:"gray"},{label:"Cancelled",value:"cancelled",color:"red"}],Ft=(bt,Qt)=>({blue:Qt?"bg-blue-600 text-white":"bg-blue-50 text-blue-700 border-blue-200",green:Qt?"bg-green-600 text-white":"bg-green-50 text-green-700 border-green-200",gray:Qt?"bg-gray-600 text-white":"bg-gray-50 text-gray-700 border-gray-200",red:Qt?"bg-red-600 text-white":"bg-red-50 text-red-700 border-red-200"})[bt];return l.jsxs("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjI1OjQ","data-yw-s":!0,children:[l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjI2OjY","data-yw-s":!0,children:[!o&&n?l.jsx("div",{className:"flex-1 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjMzOjEw","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjM0OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjM1OjE0","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjM2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):o?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjQyOjEy","data-yw-s":!0,children:l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjQzOjE0","data-yw-t":!0,"data-yw-s":!0,children:"My Trips"})}),l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3 overflow-x-auto","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjQ3OjEy","data-yw-s":!0,children:l.jsx("div",{className:"flex space-x-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjQ4OjE0","data-yw-s":!0,children:Qe.map(bt=>l.jsx("button",{onClick:()=>j(bt.value),className:`px-4 py-2 rounded-lg font-medium border transition-all whitespace-nowrap min-h-touch ${Ft(bt.color,g===bt.value)}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjUwOjE4","data-yw-s":!0,children:bt.label},bt.value))})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 pb-24","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjY0OjEy","data-yw-s":!0,children:n?l.jsx("div",{className:"flex items-center justify-center py-12","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjY2OjE2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjY3OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjY4OjIw","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjY5OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Loading trips..."})]})}):Z.length>0?l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjczOjE2","data-yw-s":!0,children:Z.map(bt=>l.jsxs("div",{onClick:()=>u(`/driver/ride/${bt.id}`),className:"bg-white rounded-xl shadow-md p-4 space-y-3 border border-gray-100 active:scale-98 transition-transform","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjc1OjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjgxOjIy","data-yw-s":!0,children:[l.jsxs("h3",{className:"font-semibold text-gray-900 flex-1 pr-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjgyOjI0","data-yw-s":!0,children:[bt.from_location?.address||"Unknown",l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjgzOjY4","data-yw-t":!0,"data-yw-auto":!0,children:"  "}),bt.to_location?.address||"Unknown"]}),l.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjg1OjI0","data-yw-s":!0,children:[oe.has(bt.id)&&l.jsx(uN,{pending:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjg3OjI4","data-yw-s":!0}),l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${bt.status==="scheduled"?"bg-blue-100 text-blue-800 border-blue-200":bt.status==="ongoing"?"bg-green-100 text-green-800 border-green-200":bt.status==="completed"?"bg-gray-100 text-gray-800 border-gray-200":"bg-red-100 text-red-800 border-red-200"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMjg5OjI2","data-yw-s":!0,children:bt.status.charAt(0).toUpperCase()+bt.status.slice(1)})]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzAxOjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzAyOjI0","data-yw-s":!0,children:[l.jsx("div",{className:"text-gray-500 text-xs","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzAzOjI2","data-yw-t":!0,"data-yw-s":!0,children:"Date"}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzA0OjI2","data-yw-s":!0,children:bt.date})]}),l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzA2OjI0","data-yw-s":!0,children:[l.jsx("div",{className:"text-gray-500 text-xs","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzA3OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Time"}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzA4OjI2","data-yw-s":!0,children:Cl(bt.time)})]}),l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzEwOjI0","data-yw-s":!0,children:[l.jsx("div",{className:"text-gray-500 text-xs","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzExOjI2","data-yw-t":!0,"data-yw-s":!0,children:"Seats"}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzEyOjI2","data-yw-s":!0,children:bt.available_seats})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzE3OjIy","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzE4OjI0","data-yw-s":!0,children:bt.distance?`${bt.distance}km`:"Distance N/A"}),l.jsxs("div",{className:"text-green-600 font-semibold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzIxOjI0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzIxOjcw","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),bt.price_per_seat,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzIyOjQ4","data-yw-t":!0,"data-yw-auto":!0,children:"/seat"})]})]})]},bt.id))}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center space-y-3 shadow-sm border border-gray-100 mt-8","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzI5OjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzMwOjE4","data-yw-s":!0,children:l.jsx("span",{className:"text-3xl","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzMxOjIw","data-yw-t":!0,"data-yw-s":!0,children:""})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzMzOjE4","data-yw-s":!0,children:[l.jsxs("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzM0OjIw","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzM0OjY5","data-yw-t":!0,"data-yw-auto":!0,children:"No "}),g,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzM0Ojg2","data-yw-t":!0,"data-yw-auto":!0,children:" trips"})]}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzM1OjIw","data-yw-s":!0,children:g==="scheduled"?"Post a ride to get started":`You don't have any ${g} trips`})]}),g==="scheduled"&&l.jsx("button",{onClick:()=>u("/driver/post-ride"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700 active:scale-95 transition-all inline-block min-h-touch","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzQyOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Post a Ride"})]})})]}):null,l.jsx(qf,{userType:"driver","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzU2Ojg","data-yw-s":!0})]}),D&&G&&l.jsx(cN,{isOpen:D,onClose:()=>{P(!1),Y(null),ue(null)},onSubmit:Te,userName:G.name||"Passenger",userImage:G.profile_image,userType:"passenger","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJUcmlwcy50c3hAMzYxOjg","data-yw-s":!0})]})}const hg=({value:u,onChange:o,onSelectLocation:d,placeholder:g="Search address, mall, landmark...",mapboxToken:j=typeof window<"u"&&window.ywConfig?.mapbox_token||"pk.YOUR_MAPBOX_ACCESS_TOKEN_HERE"})=>{const[Z,S]=fe.useState([]),[n,B]=fe.useState(!1),[D,P]=fe.useState(!1),G=fe.useRef(),Y=fe.useRef(null);fe.useEffect(()=>{const ve=ke=>{Y.current&&!Y.current.contains(ke.target)&&P(!1)};return document.addEventListener("mousedown",ve),()=>document.removeEventListener("mousedown",ve)},[]);const X=async ve=>{if(!ve||ve.length<3){S([]);return}B(!0);try{const $e=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(ve)}.json?access_token=${j}&country=ca&types=address,poi,place,locality,neighborhood&limit=5&language=en`,Te=await(await fetch($e)).json();Te.features&&(S(Te.features),P(!0))}catch(ke){console.error("Error fetching address suggestions:",ke),S([])}finally{B(!1)}},ue=ve=>{const ke=ve.target.value;o(ke),G.current&&clearTimeout(G.current),G.current=setTimeout(()=>{X(ke)},300)},oe=ve=>{const ke={id:ve.id,name:ve.text,address:ve.place_name,lat:ve.center[1],lng:ve.center[0]};o(ve.place_name),d(ke),P(!1),S([])},pe=()=>{o(""),S([]),P(!1)};return l.jsxs("div",{ref:Y,className:"relative w-full","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDExNjo0","data-yw-s":!0,children:[l.jsxs("div",{className:"relative","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDExODo2","data-yw-s":!0,children:[l.jsx(Yo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDExOTo4","data-yw-s":!0}),l.jsx("input",{type:"text",value:u,onChange:ue,onFocus:()=>Z.length>0&&P(!0),placeholder:g,className:"w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDEyMDo4","data-yw-s":!0}),n&&l.jsx(pB,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 animate-spin","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDEyOToxMA","data-yw-s":!0}),!n&&u&&l.jsx("button",{onClick:pe,className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 hover:text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDEzMjoxMA","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDEzNjoxMg","data-yw-s":!0})})]}),D&&Z.length>0&&l.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE0Mzo4","data-yw-s":!0,children:Z.map(ve=>l.jsxs("button",{onClick:()=>oe(ve),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 flex items-start gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE0NToxMg","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE1MDoxNA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1 min-w-0","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE1MToxNA","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900 truncate","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE1MjoxNg","data-yw-s":!0,children:ve.text}),l.jsx("div",{className:"text-sm text-gray-500 truncate","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE1MzoxNg","data-yw-s":!0,children:ve.place_name})]})]},ve.id))}),D&&!n&&u.length>=3&&Z.length===0&&l.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-4 text-center text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE2Mjo4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE2MjoxMzQ","data-yw-t":!0,"data-yw-auto":!0,children:'No locations found for "'}),u,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL0FkZHJlc3NBdXRvY29tcGxldGUudHN4QDE2Mzo0MQ","data-yw-t":!0,"data-yw-auto":!0,children:'"'})]})]})},lk=(u,o,d)=>{if(u.length===0)return{stops:[],totalDuration:0};const g=[];let j=0;const[Z,S]=d.split(":").map(Number),n=new Date;return n.setHours(0,0,0,0),n.setHours(Z,S,0,0),u.forEach((B,D)=>{if(D===0)g.push({...B,estimatedArrival:`${d}:00`});else{const P=u[D-1].id,G=B.id,Y=o.find(X=>X.fromStopId===P&&X.toStopId===G);if(Y){j+=Y.duration;const X=new Date(n.getTime()+j*1e3),ue=`${X.getHours().toString().padStart(2,"0")}:${X.getMinutes().toString().padStart(2,"0")}:00`;g.push({...B,estimatedArrival:ue})}else g.push({...B,estimatedArrival:"TBD"})}}),{stops:g,totalDuration:j}},ck=u=>{const o=Math.floor(u/3600),d=Math.floor(u%3600/60);return o>0?`${o}h ${d}m`:`${d}m`},uk=({onRouteCalculated:u,initialStartLocation:o,initialEndLocation:d,startTime:g,pricePerKm:j=.15,mapboxToken:Z=typeof window<"u"&&window.ywConfig?.mapbox_token||"pk.YOUR_MAPBOX_ACCESS_TOKEN_HERE"})=>{const[S,n]=fe.useState({id:"start",location:o||null,searchValue:o?.address||""}),[B,D]=fe.useState({id:"end",location:d||null,searchValue:d?.address||""}),[P,G]=fe.useState([]),[Y,X]=fe.useState(!1),[ue,oe]=fe.useState(null),pe=()=>{G([...P,{id:`stop-${Date.now()}`,location:null,searchValue:""}])},ve=$e=>{G(P.filter(De=>De.id!==$e))};fe.useEffect(()=>{S.location&&B.location&&ke()},[S.location,B.location,P,g]);const ke=async()=>{if(!(!S.location||!B.location)){X(!0);try{const $e=[S.location,...P.map(bt=>bt.location).filter(Boolean),B.location],Te=`https://api.mapbox.com/directions/v5/mapbox/driving/${$e.map(bt=>`${bt.lng},${bt.lat}`).join(";")}?geometries=geojson&steps=true&access_token=${Z}`,Ft=await(await fetch(Te)).json();if(Ft.routes&&Ft.routes.length>0){const bt=Ft.routes[0],Qt=bt.legs.map((Lt,mt)=>({distance:Lt.distance,duration:Lt.duration,fromStopId:$e[mt].id,toStopId:$e[mt+1].id,geometry:{type:"LineString",coordinates:Lt.steps.flatMap(ze=>ze.geometry.coordinates)}})),Gt=bt.distance,yt=bt.duration,Ke=$e.map((Lt,mt)=>({id:Lt.id,name:Lt.name,address:Lt.address,lat:Lt.lat,lng:Lt.lng,time:mt===0?g:"",order:mt})),{stops:st}=lk(Ke,Qt,g),ht={geometry:bt.geometry,distance:Gt,duration:yt,legs:Qt},Wt=Math.round(Gt/1e3*j*100)/100,qt={fullRoute:ht,stops:st,totalDistance:Gt,totalDuration:yt,pricePerKm:j,totalPrice:Wt};oe(qt),u(qt)}}catch($e){console.error("Error calculating route:",$e)}finally{X(!1)}}},ye=S.location&&B.location;return l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE2NDo0","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE2Njo2","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE2Nzo4","data-yw-s":!0,children:[l.jsx(Yo,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE2ODoxMA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE2ODo1Mg","data-yw-t":!0,"data-yw-auto":!0,children:"Start Location"})]}),l.jsx(hg,{value:S.searchValue,onChange:$e=>n({...S,searchValue:$e}),onSelectLocation:$e=>n({...S,location:$e,searchValue:$e.address}),placeholder:"Enter start address...",mapboxToken:Z,"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE3MTo4","data-yw-s":!0})]}),P.map(($e,De)=>l.jsxs("div",{className:"relative","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE4Mjo4","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE4MzoxMA","data-yw-s":!0,children:[l.jsx(Xp,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE4NDoxMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE4NDo1OA","data-yw-t":!0,"data-yw-auto":!0,children:"Stop "}),De+1]}),l.jsxs("div",{className:"flex gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE4NzoxMA","data-yw-s":!0,children:[l.jsx("div",{className:"flex-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE4ODoxMg","data-yw-s":!0,children:l.jsx(hg,{value:$e.searchValue,onChange:Te=>{const Qe=[...P];Qe[De]={...$e,searchValue:Te},G(Qe)},onSelectLocation:Te=>{const Qe=[...P];Qe[De]={...$e,location:Te,searchValue:Te.address},G(Qe)},placeholder:"Enter stop address...",mapboxToken:Z,"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDE4OToxNA","data-yw-s":!0})}),l.jsx("button",{onClick:()=>ve($e.id),className:"px-3 py-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIwNToxMg","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIwOToxNA","data-yw-s":!0})})]})]},$e.id)),l.jsxs("button",{onClick:pe,className:"w-full py-2 px-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 flex items-center justify-center gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIxNjo2","data-yw-s":!0,children:[l.jsx(EB,{className:"w-4 h-4","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIyMDo4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIyMDozNg","data-yw-t":!0,"data-yw-auto":!0,children:"Add Stop"})]}),l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIyNTo2","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIyNjo4","data-yw-s":!0,children:[l.jsx(Yo,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIyNzoxMA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIyNzo1Mg","data-yw-t":!0,"data-yw-auto":!0,children:"End Location"})]}),l.jsx(hg,{value:B.searchValue,onChange:$e=>D({...B,searchValue:$e}),onSelectLocation:$e=>D({...B,location:$e,searchValue:$e.address}),placeholder:"Enter end address...",mapboxToken:Z,"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDIzMDo4","data-yw-s":!0})]}),Y&&l.jsx("div",{className:"p-4 bg-blue-50 rounded-lg text-center text-blue-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI0MTo4","data-yw-t":!0,"data-yw-s":!0,children:"Calculating route..."}),ue&&!Y&&l.jsxs("div",{className:"p-4 bg-green-50 rounded-lg space-y-2","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI0Nzo4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI0ODoxMA","data-yw-s":!0,children:[l.jsxs("span",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI0OToxMg","data-yw-s":!0,children:[l.jsx(Xp,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1MDoxNA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1MDo2MA","data-yw-t":!0,"data-yw-auto":!0,children:"Distance:"})]}),l.jsxs("span",{className:"font-medium","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1MzoxMg","data-yw-s":!0,children:[(ue.totalDistance/1e3).toFixed(1),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1Mzo4OQ","data-yw-t":!0,"data-yw-auto":!0,children:" km"})]})]}),l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1NToxMA","data-yw-s":!0,children:[l.jsxs("span",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1NjoxMg","data-yw-s":!0,children:[l.jsx(ws,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1NzoxNA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI1Nzo1NQ","data-yw-t":!0,"data-yw-auto":!0,children:"Duration:"})]}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI2MDoxMg","data-yw-s":!0,children:ck(ue.totalDuration)})]}),l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI2MjoxMA","data-yw-s":!0,children:[l.jsxs("span",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI2MzoxMg","data-yw-s":!0,children:[l.jsx(Ho,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI2NDoxNA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI2NDo2MA","data-yw-t":!0,"data-yw-auto":!0,children:"Total Price:"})]}),l.jsxs("span",{className:"font-medium text-lg text-green-600","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI2NzoxMg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI2Nzo2NQ","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ue.totalPrice]})]})]}),!ye&&l.jsx("div",{className:"p-4 bg-gray-50 rounded-lg text-center text-gray-500 text-sm","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL01hcFJvdXRlSW5wdXQudHN4QDI3Mzo4","data-yw-t":!0,"data-yw-s":!0,children:"Enter start and end locations to calculate route"})]})};var Q0={exports:{}},dk=Q0.exports,EL;function hk(){return EL||(EL=1,function(u,o){(function(d,g){u.exports=g()})(dk,function(){var d,g,j;function Z(n,B){if(!d)d=B;else if(!g)g=B;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",P={};d(P),j=B(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(j.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}Z(["exports"],function(n){var B=1e-6,D=typeof Float32Array<"u"?Float32Array:Array;function P(r,e){var a=e[0],s=e[1],c=e[2],p=e[3],m=a*p-c*s;return m?(r[0]=p*(m=1/m),r[1]=-s*m,r[2]=-c*m,r[3]=a*m,r):null}function G(){var r=new D(9);return D!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Y(r,e){var a=e[0],s=e[1],c=e[2],p=e[3],m=e[4],x=e[5],L=e[6],N=e[7],R=e[8];return r[0]=m*R-x*N,r[1]=c*N-s*R,r[2]=s*x-c*m,r[3]=x*L-p*R,r[4]=a*R-c*L,r[5]=c*p-a*x,r[6]=p*N-m*L,r[7]=s*L-a*N,r[8]=a*m-s*p,r}function X(r,e,a){var s=e[0],c=e[1],p=e[2],m=e[3],x=e[4],L=e[5],N=e[6],R=e[7],T=e[8],V=a[0],F=a[1],O=a[2],Q=a[3],$=a[4],K=a[5],ie=a[6],le=a[7],de=a[8];return r[0]=V*s+F*m+O*N,r[1]=V*c+F*x+O*R,r[2]=V*p+F*L+O*T,r[3]=Q*s+$*m+K*N,r[4]=Q*c+$*x+K*R,r[5]=Q*p+$*L+K*T,r[6]=ie*s+le*m+de*N,r[7]=ie*c+le*x+de*R,r[8]=ie*p+le*L+de*T,r}function ue(){var r=new D(16);return D!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function oe(r){var e=new D(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function pe(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ve(r,e){var a=e[0],s=e[1],c=e[2],p=e[3],m=e[4],x=e[5],L=e[6],N=e[7],R=e[8],T=e[9],V=e[10],F=e[11],O=e[12],Q=e[13],$=e[14],K=e[15],ie=a*x-s*m,le=a*L-c*m,de=a*N-p*m,Ee=s*L-c*x,Le=s*N-p*x,Ae=c*N-p*L,Me=R*Q-T*O,Je=R*$-V*O,ot=R*K-F*O,We=T*$-V*Q,ut=T*K-F*Q,_t=V*K-F*$,Zt=ie*_t-le*ut+de*We+Ee*ot-Le*Je+Ae*Me;return Zt?(r[0]=(x*_t-L*ut+N*We)*(Zt=1/Zt),r[1]=(c*ut-s*_t-p*We)*Zt,r[2]=(Q*Ae-$*Le+K*Ee)*Zt,r[3]=(V*Le-T*Ae-F*Ee)*Zt,r[4]=(L*ot-m*_t-N*Je)*Zt,r[5]=(a*_t-c*ot+p*Je)*Zt,r[6]=($*de-O*Ae-K*le)*Zt,r[7]=(R*Ae-V*de+F*le)*Zt,r[8]=(m*ut-x*ot+N*Me)*Zt,r[9]=(s*ot-a*ut-p*Me)*Zt,r[10]=(O*Le-Q*de+K*ie)*Zt,r[11]=(T*de-R*Le-F*ie)*Zt,r[12]=(x*Je-m*We-L*Me)*Zt,r[13]=(a*We-s*Je+c*Me)*Zt,r[14]=(Q*le-O*Ee-$*ie)*Zt,r[15]=(R*Ee-T*le+V*ie)*Zt,r):null}function ke(r,e,a){var s=e[0],c=e[1],p=e[2],m=e[3],x=e[4],L=e[5],N=e[6],R=e[7],T=e[8],V=e[9],F=e[10],O=e[11],Q=e[12],$=e[13],K=e[14],ie=e[15],le=a[0],de=a[1],Ee=a[2],Le=a[3];return r[0]=le*s+de*x+Ee*T+Le*Q,r[1]=le*c+de*L+Ee*V+Le*$,r[2]=le*p+de*N+Ee*F+Le*K,r[3]=le*m+de*R+Ee*O+Le*ie,r[4]=(le=a[4])*s+(de=a[5])*x+(Ee=a[6])*T+(Le=a[7])*Q,r[5]=le*c+de*L+Ee*V+Le*$,r[6]=le*p+de*N+Ee*F+Le*K,r[7]=le*m+de*R+Ee*O+Le*ie,r[8]=(le=a[8])*s+(de=a[9])*x+(Ee=a[10])*T+(Le=a[11])*Q,r[9]=le*c+de*L+Ee*V+Le*$,r[10]=le*p+de*N+Ee*F+Le*K,r[11]=le*m+de*R+Ee*O+Le*ie,r[12]=(le=a[12])*s+(de=a[13])*x+(Ee=a[14])*T+(Le=a[15])*Q,r[13]=le*c+de*L+Ee*V+Le*$,r[14]=le*p+de*N+Ee*F+Le*K,r[15]=le*m+de*R+Ee*O+Le*ie,r}function ye(r,e,a){var s,c,p,m,x,L,N,R,T,V,F,O,Q=a[0],$=a[1],K=a[2];return e===r?(r[12]=e[0]*Q+e[4]*$+e[8]*K+e[12],r[13]=e[1]*Q+e[5]*$+e[9]*K+e[13],r[14]=e[2]*Q+e[6]*$+e[10]*K+e[14],r[15]=e[3]*Q+e[7]*$+e[11]*K+e[15]):(c=e[1],p=e[2],m=e[3],x=e[4],L=e[5],N=e[6],R=e[7],T=e[8],V=e[9],F=e[10],O=e[11],r[0]=s=e[0],r[1]=c,r[2]=p,r[3]=m,r[4]=x,r[5]=L,r[6]=N,r[7]=R,r[8]=T,r[9]=V,r[10]=F,r[11]=O,r[12]=s*Q+x*$+T*K+e[12],r[13]=c*Q+L*$+V*K+e[13],r[14]=p*Q+N*$+F*K+e[14],r[15]=m*Q+R*$+O*K+e[15]),r}function $e(r,e,a){var s=a[0],c=a[1],p=a[2];return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function De(r,e,a){var s=Math.sin(a),c=Math.cos(a),p=e[4],m=e[5],x=e[6],L=e[7],N=e[8],R=e[9],T=e[10],V=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*c+N*s,r[5]=m*c+R*s,r[6]=x*c+T*s,r[7]=L*c+V*s,r[8]=N*c-p*s,r[9]=R*c-m*s,r[10]=T*c-x*s,r[11]=V*c-L*s,r}function Te(r,e,a){var s=Math.sin(a),c=Math.cos(a),p=e[0],m=e[1],x=e[2],L=e[3],N=e[8],R=e[9],T=e[10],V=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*c-N*s,r[1]=m*c-R*s,r[2]=x*c-T*s,r[3]=L*c-V*s,r[8]=p*s+N*c,r[9]=m*s+R*c,r[10]=x*s+T*c,r[11]=L*s+V*c,r}function Qe(r,e,a){var s=Math.sin(a),c=Math.cos(a),p=e[0],m=e[1],x=e[2],L=e[3],N=e[4],R=e[5],T=e[6],V=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*c+N*s,r[1]=m*c+R*s,r[2]=x*c+T*s,r[3]=L*c+V*s,r[4]=N*c-p*s,r[5]=R*c-m*s,r[6]=T*c-x*s,r[7]=V*c-L*s,r}function Ft(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function bt(r,e,a){var s,c,p,m=a[0],x=a[1],L=a[2],N=Math.sqrt(m*m+x*x+L*L);return N<B?null:(m*=N=1/N,x*=N,L*=N,s=Math.sin(e),c=Math.cos(e),r[0]=m*m*(p=1-c)+c,r[1]=x*m*p+L*s,r[2]=L*m*p-x*s,r[3]=0,r[4]=m*x*p-L*s,r[5]=x*x*p+c,r[6]=L*x*p+m*s,r[7]=0,r[8]=m*L*p+x*s,r[9]=x*L*p-m*s,r[10]=L*L*p+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Qt(r,e){var a=e[0],s=e[1],c=e[2],p=e[4],m=e[5],x=e[6],L=e[8],N=e[9],R=e[10];return r[0]=Math.sqrt(a*a+s*s+c*c),r[1]=Math.sqrt(p*p+m*m+x*x),r[2]=Math.sqrt(L*L+N*N+R*R),r}function Gt(r,e){var a=e[0],s=e[1],c=e[2],p=e[3],m=a+a,x=s+s,L=c+c,N=a*m,R=s*m,T=s*x,V=c*m,F=c*x,O=c*L,Q=p*m,$=p*x,K=p*L;return r[0]=1-T-O,r[1]=R+K,r[2]=V-$,r[3]=0,r[4]=R-K,r[5]=1-N-O,r[6]=F+Q,r[7]=0,r[8]=V+$,r[9]=F-Q,r[10]=1-N-T,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var yt=ke;function Ke(){var r=new D(3);return D!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function st(r){var e=new D(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function ht(r){var e=r[0],a=r[1],s=r[2];return Math.sqrt(e*e+a*a+s*s)}function Wt(r,e,a){var s=new D(3);return s[0]=r,s[1]=e,s[2]=a,s}function qt(r,e,a,s){return r[0]=e,r[1]=a,r[2]=s,r}function Lt(r,e,a){return r[0]=e[0]+a[0],r[1]=e[1]+a[1],r[2]=e[2]+a[2],r}function mt(r,e,a){return r[0]=e[0]-a[0],r[1]=e[1]-a[1],r[2]=e[2]-a[2],r}function ze(r,e,a){return r[0]=e[0]*a[0],r[1]=e[1]*a[1],r[2]=e[2]*a[2],r}function Ye(r,e,a){return r[0]=Math.min(e[0],a[0]),r[1]=Math.min(e[1],a[1]),r[2]=Math.min(e[2],a[2]),r}function wt(r,e,a){return r[0]=Math.max(e[0],a[0]),r[1]=Math.max(e[1],a[1]),r[2]=Math.max(e[2],a[2]),r}function Be(r,e,a){return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r}function ba(r,e,a,s){return r[0]=e[0]+a[0]*s,r[1]=e[1]+a[1]*s,r[2]=e[2]+a[2]*s,r}function lr(r,e){var a=e[0]-r[0],s=e[1]-r[1],c=e[2]-r[2];return Math.sqrt(a*a+s*s+c*c)}function Ja(r,e){var a=e[0]-r[0],s=e[1]-r[1],c=e[2]-r[2];return a*a+s*s+c*c}function Er(r){var e=r[0],a=r[1],s=r[2];return e*e+a*a+s*s}function or(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function ka(r,e){var a=e[0],s=e[1],c=e[2],p=a*a+s*s+c*c;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r}function gr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Pn(r,e,a){var s=e[0],c=e[1],p=e[2],m=a[0],x=a[1],L=a[2];return r[0]=c*L-p*x,r[1]=p*m-s*L,r[2]=s*x-c*m,r}function qo(r,e,a,s){var c=e[0],p=e[1],m=e[2];return r[0]=c+s*(a[0]-c),r[1]=p+s*(a[1]-p),r[2]=m+s*(a[2]-m),r}function ln(r,e,a){var s=e[0],c=e[1],p=e[2],m=a[3]*s+a[7]*c+a[11]*p+a[15];return r[0]=(a[0]*s+a[4]*c+a[8]*p+a[12])/(m=m||1),r[1]=(a[1]*s+a[5]*c+a[9]*p+a[13])/m,r[2]=(a[2]*s+a[6]*c+a[10]*p+a[14])/m,r}function bs(r,e,a){var s=e[0],c=e[1],p=e[2];return r[0]=s*a[0]+c*a[3]+p*a[6],r[1]=s*a[1]+c*a[4]+p*a[7],r[2]=s*a[2]+c*a[5]+p*a[8],r}function Xr(r,e,a){var s=a[0],c=a[1],p=a[2],m=a[3],x=e[0],L=e[1],N=e[2],R=c*N-p*L,T=p*x-s*N,V=s*L-c*x;return r[0]=x+m*(R+=R)+c*(V+=V)-p*(T+=T),r[1]=L+m*T+p*R-s*V,r[2]=N+m*V+s*T-c*R,r}function Gn(r){return r[0]=0,r[1]=0,r[2]=0,r}function rn(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Sr=mt,pi=ze,di=ht;function Tn(){var r=new D(4);return D!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function cs(r,e,a){return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r}function Ls(r,e){var a=e[0],s=e[1],c=e[2],p=e[3],m=a*a+s*s+c*c+p*p;return m>0&&(m=1/Math.sqrt(m)),r[0]=a*m,r[1]=s*m,r[2]=c*m,r[3]=p*m,r}function Xi(r,e,a){var s=e[0],c=e[1],p=e[2],m=e[3];return r[0]=a[0]*s+a[4]*c+a[8]*p+a[12]*m,r[1]=a[1]*s+a[5]*c+a[9]*p+a[13]*m,r[2]=a[2]*s+a[6]*c+a[10]*p+a[14]*m,r[3]=a[3]*s+a[7]*c+a[11]*p+a[15]*m,r}function Ko(){var r=new D(4);return D!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function aa(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function La(r,e,a){a*=.5;var s=e[0],c=e[1],p=e[2],m=e[3],x=Math.sin(a),L=Math.cos(a);return r[0]=s*L+m*x,r[1]=c*L+p*x,r[2]=p*L-c*x,r[3]=m*L-s*x,r}function hr(r,e,a){a*=.5;var s=e[0],c=e[1],p=e[2],m=e[3],x=Math.sin(a),L=Math.cos(a);return r[0]=s*L-p*x,r[1]=c*L+m*x,r[2]=p*L+s*x,r[3]=m*L-c*x,r}Ke(),Tn();var wr,nn,ni,Gs=Ls,us=(wr=Ke(),nn=Wt(1,0,0),ni=Wt(0,1,0),function(r,e,a){var s=gr(e,a);return s<-.999999?(Pn(wr,nn,e),di(wr)<1e-6&&Pn(wr,ni,e),ka(wr,wr),function(c,p,m){m*=.5;var x=Math.sin(m);c[0]=x*p[0],c[1]=x*p[1],c[2]=x*p[2],c[3]=Math.cos(m)}(r,wr,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Pn(wr,e,a),r[0]=wr[0],r[1]=wr[1],r[2]=wr[2],r[3]=1+s,Gs(r,r))});function kn(){var r=new D(2);return D!=Float32Array&&(r[0]=0,r[1]=0),r}function co(r,e){var a=new D(2);return a[0]=r,a[1]=e,a}function Zi(r,e,a){return r[0]=e,r[1]=a,r}function ts(r,e,a){return r[0]=e[0]+a[0],r[1]=e[1]+a[1],r}function yi(r,e,a){return r[0]=e[0]-a[0],r[1]=e[1]-a[1],r}function Us(r,e,a){return r[0]=e[0]*a,r[1]=e[1]*a,r}function Ln(r){var e=r[0],a=r[1];return Math.sqrt(e*e+a*a)}function gi(r,e){var a=e[0],s=e[1],c=a*a+s*s;return c>0&&(c=1/Math.sqrt(c)),r[0]=e[0]*c,r[1]=e[1]*c,r}function zo(r,e){return r[0]*e[0]+r[1]*e[1]}Ko(),Ko(),G();var Xl,Ws,$d=yi;function Yu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}kn();var Hh=function(){if(Ws)return Xl;function r(e,a,s,c){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(c-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=a,this.p2x=s,this.p2y=c}return Ws=1,Xl=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,a){if(a===void 0&&(a=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,c=0;c<8;c++){var p=this.sampleCurveX(s)-e;if(Math.abs(p)<a)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=p/m}var x=0,L=1;for(s=e,c=0;c<20&&(p=this.sampleCurveX(s),!(Math.abs(p-e)<a));c++)e>p?x=s:L=s,s=.5*(L-x)+x;return s},solve:function(e,a){return this.sampleCurveY(this.solveCurveX(e,a))}},Xl}(),bc=Yu(Hh);function St(r,e){this.x=r,this.y=e}function uo(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let a=0;a<r.length;a++)if(!uo(r[a],e[a]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const a in r)if(!uo(r[a],e[a]))return!1;return!0}return r===e}St.prototype={clone(){return new St(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,a=r.y-this.y;return e*e+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),a=Math.sin(r),s=a*this.x+e*this.y;return this.x=e*this.x-a*this.y,this.y=s,this},_rotateAround(r,e){const a=Math.cos(r),s=Math.sin(r),c=e.y+s*(this.x-e.x)+a*(this.y-e.y);return this.x=e.x+a*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:St},St.convert=function(r){if(r instanceof St)return r;if(Array.isArray(r))return new St(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new St(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const tu=Math.PI/180,Ql=180/Math.PI;function fr(r){return r*tu}function Vi(r){return r*Ql}const $u=[[0,0],[1,0],[1,1],[0,1]];function Lc(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,a=e*r;return 4*(r<.5?a:3*(r-e)+a-.75)}function Ge(r,e,a,s){const c=new bc(r,e,a,s);return function(p){return c.solve(p)}}const te=Ge(.25,.1,.25,1);function re(r,e,a){return Math.min(a,Math.max(e,r))}function xe(r,e,a){return(a=re((a-r)/(e-r),0,1))*a*(3-2*a)}function Ve(r,e,a){const s=a-e,c=((r-e)%s+s)%s+e;return c===e?a:c}function Re(r,e,a){if(!r.length)return a(null,[]);let s=r.length;const c=new Array(r.length);let p=null;r.forEach((m,x)=>{e(m,(L,N)=>{L&&(p=L),c[x]=N,--s==0&&a(p,c)})})}let Oe=1;function at(){return Oe++}function Ce(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function tt(r,e){r.forEach(a=>{e[a]&&(e[a]=e[a].bind(e))})}function Vt(r,e,a){const s={};for(const c in r)s[c]=e.call(this,r[c],c,r);return s}function Nt(r,e,a){const s={};for(const c in r)e.call(this,r[c],c,r)&&(s[c]=r[c]);return s}function ha(r){return Array.isArray(r)?r.map(ha):typeof r=="object"&&r?Vt(r,ha):r}function Ia(r,e){for(let a=0;a<r.length;a++)if(e.indexOf(r[a])>=0)return!0;return!1}const ma={};function Za(r){ma[r]||(typeof console<"u"&&console.warn(r),ma[r]=!0)}function $a(r,e,a){return(a.y-r.y)*(e.x-r.x)>(e.y-r.y)*(a.x-r.x)}function ar(r){let e=0;for(let a,s,c=0,p=r.length,m=p-1;c<p;m=c++)a=r[c],s=r[m],e+=(s.x-a.x)*(a.y+s.y);return e}function Fr([r,e,a]){const s=fr(e+90),c=fr(a);return{x:r*Math.cos(s)*Math.sin(c),y:r*Math.sin(s)*Math.sin(c),z:r*Math.cos(c),azimuthal:e,polar:a}}function Jn(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function ii(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,s,c,p)=>{const m=c||p;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const a=parseInt(e["max-age"],10);isNaN(a)?delete e["max-age"]:e["max-age"]=a}return e}let Fn=null;function cn(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Pr(r,e,a,s){for(;e<a;){const c=e+a>>1;r[c]<s?e=c+1:a=c}return e}function Ka(r,e,a,s){for(;e<a;){const c=e+a>>1;r[c]<=s?e=c+1:a=c}return e}function yn(r){return r>0?1/(1.001-r):1+r}function Vn(r){return r>0?1-1/(1.001-r):-r}function Yr(r,e,a){return(r-e.min)*(a.max-a.min)/(e.max-e.min)+a.min}const sn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!sn.API_URL)return null;try{const r=new URL(sn.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function si(r){return sn.API_URL_REGEX.test(r)}function Mi(r){return sn.API_SPRITE_REGEX.test(r)}let Bs,au,Ni,Xs,ds,ho;function as(){return Bs==null&&(Bs=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Bs}const Qs={now:()=>Xs!==void 0?Xs:performance.now(),setNow(r){Xs=r},restoreNow(){Xs=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:a,height:s}=r;ds||(ds=document.createElement("canvas"));const c=ds.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(a>ds.width||s>ds.height)&&(ds.width=a,ds.height=s),c.clearRect(-e,-e,a+2*e,s+2*e),c.drawImage(r,0,0,a,s),c.getImageData(-e,-e,a+2*e,s+2*e)},resolveURL:r=>(au||(au=document.createElement("a")),au.href=r,au.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ni==null&&(Ni=window.matchMedia("(prefers-reduced-motion: reduce)")),Ni.matches)},hasCanvasFingerprintNoise(){if(ho!==void 0)return ho;if(!as())return ho=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let a=0;for(let c=0;c<r.width;++c)e.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,e.fillRect(c,0,1,1);const s=e.getImageData(0,0,r.width,r.height);a=0;for(let c=0;c<s.data.length;++c)if(c%4!=3&&a++!==s.data[c])return ho=!0,!0;return ho=!1,!1}};function qu(r,e){const a=r.indexOf("?");if(a<0)return`${r}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(r.slice(a));for(const c in e)s.set(c,e[c]);return`${r.slice(0,a)}?${s.toString()}`}function zn(r,e={persistentParams:[]}){const a=r.indexOf("?");if(a<0)return r;const s=new URLSearchParams,c=new URLSearchParams(r.slice(a));for(const m of e.persistentParams){const x=c.get(m);x&&s.set(m,x)}const p=s.toString();return`${r.slice(0,a)}${p.length>0?`?${p}`:""}`}const Ku="mapbox-tiles";let ed=500,hs=50;const Ao=["language","worldview","jobid"];let fs,Hs;function el(){try{return caches}catch{}}function Ll(){const r=el();r&&fs==null&&(fs=r.open(Ku))}let tl=1/0;const al={supported:!1,testSupport:function(r){!ru&&Ro&&(Hl?Yh(r):ps=r)}};let ps,Ro,ru=!1,Hl=!1;const To=typeof self<"u"?self:{};function Yh(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ro),r.isContextLost())return;al.supported=!0}catch{}r.deleteTexture(e),ru=!0}To.document&&(Ro=To.document.createElement("img"),Ro.onload=function(){ps&&Yh(ps),ps=null,Hl=!0},Ro.onerror=function(){ru=!0,ps=null},Ro.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const rl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(rl);class nu extends Error{constructor(e,a,s){a===401&&si(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=a,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const $h=Jn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,jc=function(r,e){if(!(/^file:/.test(a=r.url)||/^file:/.test($h())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,c){const p=new AbortController,m=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:$h(),referrerPolicy:s.referrerPolicy,signal:p.signal});let x=!1,L=!1;const N=(R=m.url).indexOf("sku=")>0&&si(R);var R;s.type==="json"&&m.headers.set("Accept","application/json");const T=(F,O,Q)=>{if(L)return;if(F&&F.message!=="SecurityError"&&Za(F.toString()),O&&Q)return V(O);const $=Date.now();fetch(m).then(K=>{if(K.ok){const ie=N?K.clone():null;return V(K,ie,$)}return c(new nu(K.statusText,K.status,s.url))}).catch(K=>{K.name!=="AbortError"&&c(new Error(`${K.message} ${s.url}`))})},V=(F,O,Q)=>{(s.type==="arrayBuffer"?F.arrayBuffer():s.type==="json"?F.json():F.text()).then($=>{L||(O&&Q&&function(K,ie,le){if(Ll(),fs==null)return;const de=ii(ie.headers.get("Cache-Control")||"");if(de["no-store"])return;const Ee={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Me,Je)=>Ee.headers.set(Je,Me)),de["max-age"]&&Ee.headers.set("Expires",new Date(le+1e3*de["max-age"]).toUTCString());const Le=Ee.headers.get("Expires");if(!Le||new Date(Le).getTime()-le<42e4)return;let Ae=zn(K.url,{persistentParams:Ao});if(ie.status===206){const Me=K.headers.get("Range");if(!Me)return;Ee.status=200,Ae=qu(Ae,{range:Me})}(function(Me,Je){if(Hs===void 0)try{new Response(new ReadableStream),Hs=!0}catch{Hs=!1}Hs?Je(Me.body):Me.blob().then(Je).catch(ot=>Za(ot.message))})(ie,Me=>{const Je=new Response((ot=ie.status)!==200&&ot!==404&&[101,103,204,205,304].includes(ot)?null:Me,Ee);var ot;Ll(),fs?.then(We=>We.put(Ae,Je)).catch(We=>Za(We.message))})}(m,O,Q),x=!0,c(null,$,F.headers))}).catch($=>{L||c(new Error($.message))})};return N?function(F,O){if(Ll(),fs==null)return O(null);fs.then(Q=>{let $=zn(F.url,{persistentParams:Ao});const K=F.headers.get("Range");K&&($=qu($,{range:K})),Q.match($).then(ie=>{const le=function(de){if(!de)return!1;const Ee=new Date(de.headers.get("Expires")||0),Le=ii(de.headers.get("Cache-Control")||"");return Number(Ee)>Date.now()&&!Le["no-cache"]}(ie);Q.delete($).catch(O),le&&Q.put($,ie.clone()).catch(O),O(null,ie,le)}).catch(O)}).catch(O)}(m,T):T(null,null),{cancel:()=>{L=!0,x||p.abort()}}}(r,e);if(Jn(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var a;return function(s,c){const p=new XMLHttpRequest;p.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in s.headers)p.setRequestHeader(m,s.headers[m]);return s.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=s.credentials==="include",p.onerror=()=>{c(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(s.type==="json")try{m=JSON.parse(p.response)}catch(L){return c(L)}const x=new Headers;p.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(L=>{const N=L.split(": "),R=N.shift(),T=N.join(": ");x.append(R,T)}),c(null,m,x)}else c(new nu(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}}(r,e)},iu=function(r,e){return jc(Object.assign(r,{type:"arrayBuffer"}),e)};function zr(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const su="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Yl,jl;Yl=[],jl=0;const td=function(r,e){if(al.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),jl>=sn.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Yl.push(p),p}jl++;let a=!1;const s=()=>{if(!a)for(a=!0,jl--;Yl.length&&jl<sn.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Yl.shift(),{requestParameters:m,callback:x,cancelled:L}=p;L||(p.cancel=td(m,x).cancel)}},c=iu(r,(p,m,x)=>{s(),p?e(p):m&&(self.createImageBitmap?function(L,N){const R=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(R).then(T=>{N(null,T)}).catch(T=>{N(new Error(`Could not load image because of ${T.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(L,N)=>e(L,N,x)):function(L,N){const R=new Image;R.onload=()=>{N(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=su})},R.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const T=new Blob([new Uint8Array(L)],{type:"image/png"});R.src=L.byteLength?URL.createObjectURL(T):su}(m,(L,N)=>e(L,N,x)))});return{cancel:()=>{c.cancel(),s()}}};var qd,Kd,ou,Zl={exports:{}},qh={exports:{}},eh={exports:{}},Zc=function(){if(ou)return Zl.exports;ou=1;var r=(qd||(qd=1,qh.exports=function(a,s){var c,p,m,x,L,N,R,T;for(p=a.length-(c=3&a.length),m=s,L=3432918353,N=461845907,T=0;T<p;)R=255&a.charCodeAt(T)|(255&a.charCodeAt(++T))<<8|(255&a.charCodeAt(++T))<<16|(255&a.charCodeAt(++T))<<24,++T,m=27492+(65535&(x=5*(65535&(m=(m^=R=(65535&(R=(R=(65535&R)*L+(((R>>>16)*L&65535)<<16)&4294967295)<<15|R>>>17))*N+(((R>>>16)*N&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(R=0,c){case 3:R^=(255&a.charCodeAt(T+2))<<16;case 2:R^=(255&a.charCodeAt(T+1))<<8;case 1:m^=R=(65535&(R=(R=(65535&(R^=255&a.charCodeAt(T)))*L+(((R>>>16)*L&65535)<<16)&4294967295)<<15|R>>>17))*N+(((R>>>16)*N&65535)<<16)&4294967295}return m^=a.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),qh.exports),e=(Kd||(Kd=1,eh.exports=function(a,s){for(var c,p=a.length,m=s^p,x=0;p>=4;)c=1540483477*(65535&(c=255&a.charCodeAt(x)|(255&a.charCodeAt(++x))<<8|(255&a.charCodeAt(++x))<<16|(255&a.charCodeAt(++x))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:m^=(255&a.charCodeAt(x+2))<<16;case 2:m^=(255&a.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&a.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),eh.exports);return Zl.exports=r,Zl.exports.murmur3=r,Zl.exports.murmur2=e,Zl.exports}(),lu=Yu(Zc);class js{constructor(e,...a){Object.assign(this,a[0]||{}),this.type=e}}class ad extends js{constructor(e,a={}){super("error",Object.assign({error:e},a))}}function $l(r,e,a){a[r]&&a[r].indexOf(e)!==-1||(a[r]=a[r]||[],a[r].push(e))}function Nc(r,e,a){if(a&&a[r]){const s=a[r].indexOf(e);s!==-1&&a[r].splice(s,1)}}class Nl{on(e,a){return this._listeners=this._listeners||{},$l(e,a,this._listeners),this}off(e,a){return Nc(e,a,this._listeners),Nc(e,a,this._oneTimeListeners),this}once(e,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},$l(e,a,this._oneTimeListeners),this):new Promise(s=>{this.once(e,s)})}fire(e,a){const s=typeof e=="string"?new js(e,a):e,c=s.type;if(this.listens(c)){s.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const L of p)L.call(this,s);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const L of m)Nc(c,L,this._oneTimeListeners),L.call(this,s);const x=this._eventedParent;if(x){const L=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(s,L),x.fire(s)}}else s instanceof ad&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,a){return this._eventedParent=e,this._eventedParentData=a,this}}class xn{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new xn(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[a,s]=e.split("");return new xn({name:a,iconsetId:s})}static isEqual(e,a){return e.name===a.name&&e.iconsetId===a.iconsetId}toString(){return xn.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ec,th={},cu=function(){if(Ec)return th;Ec=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function a(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function s(p){return(m=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:m>1?1:m;var m}function c(p,m,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?p+(m-p)*x*6:2*x<1?m:3*x<2?p+(m-p)*(2/3-x)*6:p}try{th.parseCSSColor=function(p){var m,x=p.replace(/ /g,"").toLowerCase();if(x in r)return r[x].slice();if(x[0]==="#")return x.length===4?(m=parseInt(x.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:x.length===7&&(m=parseInt(x.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var L=x.indexOf("("),N=x.indexOf(")");if(L!==-1&&N+1===x.length){var R=x.substr(0,L),T=x.substr(L+1,N-(L+1)).split(","),V=1;switch(R){case"rgba":if(T.length!==4)return null;V=s(T.pop());case"rgb":return T.length!==3?null:[a(T[0]),a(T[1]),a(T[2]),V];case"hsla":if(T.length!==4)return null;V=s(T.pop());case"hsl":if(T.length!==3)return null;var F=(parseFloat(T[0])%360+360)%360/360,O=s(T[1]),Q=s(T[2]),$=Q<=.5?Q*(O+1):Q+O-Q*O,K=2*Q-$;return[e(255*c(K,$,F+1/3)),e(255*c(K,$,F)),e(255*c(K,$,F-1/3)),V];default:return null}}return null}}catch{}return th}();class Or{constructor(e,a,s,c=1){this.r=e,this.g=a,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Or)return e;if(typeof e!="string")return;const a=cu.parseCSSColor(e);return a?new Or(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[e,a,s,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*a)},${Math.round(255*s)},${c})`}toNonPremultipliedRenderColor(e){const{r:a,g:s,b:c,a:p}=this;return new Kh(e,a,s,c,p)}toPremultipliedRenderColor(e){const{r:a,g:s,b:c,a:p}=this;return new rd(e,a*p,s*p,c*p,p)}clone(){return new Or(this.r,this.g,this.b,this.a)}}class ah{constructor(e,a,s,c,p,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const x=e.image.height,L=x*x;this.premultiplied?(a=p===0?0:a/p*(x-1),s=p===0?0:s/p*(x-1),c=p===0?0:c/p*(x-1)):(a*=x-1,s*=x-1,c*=x-1);const N=Math.floor(a),R=Math.floor(s),T=Math.floor(c),V=Math.ceil(a),F=Math.ceil(s),O=Math.ceil(c),Q=a-N,$=s-R,K=c-T,ie=e.image.data,le=4*(N+R*L+T*x),de=4*(N+R*L+O*x),Ee=4*(N+F*L+T*x),Le=4*(N+F*L+O*x),Ae=4*(V+R*L+T*x),Me=4*(V+R*L+O*x),Je=4*(V+F*L+T*x),ot=4*(V+F*L+O*x);if(le<0||ot>=ie.length)throw new Error("out of range");this.r=Sa(Sa(Sa(ie[le],ie[de],K),Sa(ie[Ee],ie[Le],K),$),Sa(Sa(ie[Ae],ie[Me],K),Sa(ie[Je],ie[ot],K),$),Q)/255*(this.premultiplied?p:1),this.g=Sa(Sa(Sa(ie[le+1],ie[de+1],K),Sa(ie[Ee+1],ie[Le+1],K),$),Sa(Sa(ie[Ae+1],ie[Me+1],K),Sa(ie[Je+1],ie[ot+1],K),$),Q)/255*(this.premultiplied?p:1),this.b=Sa(Sa(Sa(ie[le+2],ie[de+2],K),Sa(ie[Ee+2],ie[Le+2],K),$),Sa(Sa(ie[Ae+2],ie[Me+2],K),Sa(ie[Je+2],ie[ot+2],K),$),Q)/255*(this.premultiplied?p:1),this.a=p}else this.r=a,this.g=s,this.b=c,this.a=p}toArray(){const{r:e,g:a,b:s,a:c}=this;return[255*e,255*a,255*s,c]}toHslaArray(){let{r:e,g:a,b:s,a:c}=this;if(this.premultiplied){if(c===0)return[0,0,0,0];const O=1/c;e*=O,a*=O,s*=O}const p=Math.min(Math.max(e,0),1),m=Math.min(Math.max(a,0),1),x=Math.min(Math.max(s,0),1),L=Math.min(p,m,x),N=Math.max(p,m,x),R=N-L,T=.5*(L+N);if(R===0)return[0,0,100*T,c];const V=T>.5?R/(2-N-L):R/(N+L);let F;switch(N){case p:F=60*((m-x)/R+(m<x?6:0));break;case m:F=60*((x-p)/R+2);break;default:F=60*((p-m)/R+4)}return[F,100*V,100*T,c]}toArray01(){const{r:e,g:a,b:s,a:c}=this;return[e,a,s,c]}toArray01Scaled(e){const{r:a,g:s,b:c}=this;return[a*e,s*e,c*e]}toArray01Linear(){const{r:e,g:a,b:s,a:c}=this;return[Math.pow(e,2.2),Math.pow(a,2.2),Math.pow(s,2.2),c]}}class Kh extends ah{constructor(e,a,s,c,p){super(e,a,s,c,p,!1)}}class rd extends ah{constructor(e,a,s,c,p){super(e,a,s,c,p,!0)}}function Sa(r,e,a){return r*(1-a)+e*a}function nd(r,e,a){return r.map((s,c)=>Sa(s,e[c],a))}Or.black=new Or(0,0,0,1),Or.white=new Or(1,1,1,1),Or.transparent=new Or(0,0,0,0),Or.red=new Or(1,0,0,1),Or.blue=new Or(0,0,1,1);var ql=Object.freeze({__proto__:null,array:nd,color:function(r,e,a){return new Or(Sa(r.r,e.r,a),Sa(r.g,e.g,a),Sa(r.b,e.b,a),Sa(r.a,e.a,a))},number:Sa});class Vo extends Error{constructor(e,a){super(a),this.message=a,this.key=e}}class Mo{constructor(e,a=[]){this.parent=e,this.bindings={};for(const[s,c]of a)this.bindings[s]=c}concat(e){return new Mo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Sc={kind:"null"},ya={kind:"number"},jr={kind:"string"},Mr={kind:"boolean"},Ys={kind:"color"},id={kind:"object"},Dr={kind:"value"},rh={kind:"collator"},uu={kind:"formatted"},nh={kind:"resolvedImage"};function Pi(r,e){return{kind:"array",itemType:r,N:e}}function oi(r){if(r.kind==="array"){const e=oi(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const uy=[Sc,ya,jr,Mr,Ys,uu,id,Pi(Dr),nh];function ih(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ih(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const a of uy)if(!ih(a,e))return null}}return`Expected ${oi(r)} but found ${oi(e)} instead.`}function ep(r,e){return e.some(a=>a.kind===r.kind)}function sd(r,e){return e.some(a=>a==="null"?r===null:a==="array"?Array.isArray(r):a==="object"?r&&!Array.isArray(r)&&typeof r=="object":a===typeof r)}function ef(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&ef(r.itemType,e.itemType):r.kind===e.kind}class tp{constructor(e,a,s){this.sensitivity=e?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,a){return this.collator.compare(e,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sh{constructor(e,a,s,c,p){this.text=e.normalize?e.normalize():e,this.image=a,this.scale=s,this.fontStack=c,this.textColor=p}}class Bi{constructor(e){this.sections=e}static fromString(e){return new Bi([new sh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Bi?e:Bi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const a of this.sections){if(a.image){const c=a.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(a.text);const s={};a.fontStack&&(s["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(s["font-scale"]=a.scale),a.textColor&&(s["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class Kl{constructor(e,a={}){if(this.id=xn.from(e),this.options=Object.assign({},a),a.transform){const{a:s,b:c,c:p,d:m,e:x,f:L}=a.transform;this.options.transform=new DOMMatrix([s,c,p,m,x,L])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:a,c:s,d:c,e:p,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:a,c:s,d:c,e:p,f:m}})}static parse(e){let a,s,c,p;try{({name:a,iconsetId:s,params:c,transform:p}=JSON.parse(e)||{})}catch{return null}if(!a)return null;const{a:m,b:x,c:L,d:N,e:R,f:T}=p||{};return new Kl({name:a,iconsetId:s},{params:c,transform:new DOMMatrix([m,x,L,N,R,T])})}scaleSelf(e,a){return this.options.transform.scaleSelf(e,a),this}}class Is{constructor(e,a,s,c,p=!1){this.primaryId=xn.from(e),this.primaryOptions=a,s&&(this.secondaryId=xn.from(s)),this.secondaryOptions=c,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Kl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Kl(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Is.build({name:e}):e}static build(e,a,s,c){return!e||typeof e=="object"&&!("name"in e)?null:new Is(e,s,a,c)}}function tf(r,e,a,s){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof a=="number"&&a>=0&&a<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[r,e,a,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[r,e,a,s]:[r,e,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zc(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Or||r instanceof tp||r instanceof Bi||r instanceof Is)return!0;if(Array.isArray(r)){for(const e of r)if(!zc(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!zc(r[e]))return!1;return!0}return!1}function li(r){if(r===null)return Sc;if(typeof r=="string")return jr;if(typeof r=="boolean")return Mr;if(typeof r=="number")return ya;if(r instanceof Or)return Ys;if(r instanceof tp)return rh;if(r instanceof Bi)return uu;if(r instanceof Is)return nh;if(Array.isArray(r)){const e=r.length;let a;for(const s of r){const c=li(s);if(a){if(a===c)continue;a=Dr;break}a=c}return Pi(a||Dr,e)}return id}function El(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Bi||r instanceof Is||r instanceof Or?r.toString():JSON.stringify(r)}class Sl{constructor(e,a){this.type=e,this.value=a}static parse(e,a){if(e.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zc(e[1]))return a.error("invalid value");const s=e[1];let c=li(s);const p=a.expectedType;return c.kind!=="array"||c.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(c=p),new Sl(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Or?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Bi?this.value.serialize():this.value}}class Xn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ya={string:jr,number:ya,boolean:Mr,object:id};class ca{constructor(e,a){this.type=e,this.args=a}static parse(e,a){if(e.length<2)return a.error("Expected at least one argument.");let s,c=1;const p=e[0];if(p==="array"){let x,L;if(e.length>2){const N=e[1];if(typeof N!="string"||!(N in Ya)||N==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ya[N],c++}else x=Dr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return a.error('The length argument to "array" must be a positive integer literal',2);L=e[2],c++}s=Pi(x,L)}else s=Ya[p];const m=[];for(;c<e.length;c++){const x=a.parse(e[c],c,Dr);if(!x)return null;m.push(x)}return new ca(s,m)}evaluate(e){for(let a=0;a<this.args.length;a++){const s=this.args[a].evaluate(e);if(!ih(this.type,li(s)))return s;if(a===this.args.length-1)throw new Xn(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${oi(li(s))} but was expected to be of type ${oi(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,a=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&a.push(c)}}return a.concat(this.args.map(s=>s.serialize()))}}class Ac{constructor(e){this.type=uu,this.sections=e}static parse(e,a){if(e.length<2)return a.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");const c=[];let p=!1;for(let m=1;m<=e.length-1;++m){const x=e[m];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let L=null;if(x["font-scale"]&&(L=a.parseObjectValue(x["font-scale"],m,"font-scale",ya),!L))return null;let N=null;if(x["text-font"]&&(N=a.parseObjectValue(x["text-font"],m,"text-font",Pi(jr)),!N))return null;let R=null;if(x["text-color"]&&(R=a.parseObjectValue(x["text-color"],m,"text-color",Ys),!R))return null;const T=c[c.length-1];T.scale=L,T.font=N,T.textColor=R}else{const L=a.parse(e[m],m,Dr);if(!L)return null;const N=L.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:L,scale:null,font:null,textColor:null})}}return new Ac(c)}evaluate(e){return new Bi(this.sections.map(a=>{const s=a.content.evaluate(e);return ef(li(s),nh)?new sh("",s,null,null,null):new sh(El(s),null,a.scale?a.scale.evaluate(e):null,a.font?a.font.evaluate(e).join(","):null,a.textColor?a.textColor.evaluate(e):null)}))}eachChild(e){for(const a of this.sections)e(a.content),a.scale&&e(a.scale),a.font&&e(a.font),a.textColor&&e(a.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const a of this.sections){e.push(a.content.serialize());const s={};a.scale&&(s["font-scale"]=a.scale.serialize()),a.font&&(s["text-font"]=a.font.serialize()),a.textColor&&(s["text-color"]=a.textColor.serialize()),e.push(s)}return e}}class za{constructor(e,a,s,c){this._imageWarnHistory={},this.type=nh,this.namePrimary=e,this.nameSecondary=a,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,a){if(e.length<2)return a.error("Expected two or more arguments.");let s=1;const c=[];function p(){if(s<e.length){const x=a.parse(e[s],s++,jr);return x?(c.push({image:x,options:{}}),!0):(a.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(s<e.length){const L=e[s];if((x=L)===null||typeof x!="object"||Array.isArray(x))return!0;const N=L.params,R=L.iconset,T=a.concat(s);if(!N&&!R)return s++,!0;if(N){if(typeof N!="object"||N.constructor!==Object)return T.error('Image options "params" should be an object'),!1;const V={},F=T.concat(void 0,"params");for(const O in N){if(!O)return F.error("Image parameter name should be non-empty"),!1;const Q=F.concat(void 0,O).parse(N[O],void 0,Ys,void 0,{typeAnnotation:"coerce"});if(!Q)return!1;V[O]=Q}c[c.length-1].options.params=V}if(R){if(typeof R!="object"||R.constructor!==Object)return T.error('Image options "iconset" should be an object'),!1;if(!R.id)return T.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=R}return s++,!0}var x;return!0}for(let x=0;x<2;x++)if(!p()||!m())return;return new za(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,a){const s={};if(a){for(const c in a)if(a[c])try{s[c]=a[c].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const a={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=Is.build(a,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const p=c.getPrimary().id;if(c.available=e.availableImages.some(m=>xn.isEqual(m,p)),c.available){const m=c.getSecondary()?c.getSecondary().id:null;m&&(c.available=e.availableImages.some(x=>xn.isEqual(x,m)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&e(this.paramsPrimary[a]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&e(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(e,a){const s={};if(a&&(s.iconset={id:a}),e){s.params={};for(const c in e)e[c]&&(s.params[c]=e[c].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&e.push(a)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&e.push(a)}return e}}function od(r){return Ba(r)?"string":ld(r)?"number":oh(r)?"boolean":Array.isArray(r)?"array":r===null?"null":af(r)?"object":typeof r}function af(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function Ba(r){return typeof r=="string"||r instanceof String}function ld(r){return typeof r=="number"||r instanceof Number}function oh(r){return typeof r=="boolean"||r instanceof Boolean}const cd={"to-boolean":Mr,"to-color":Ys,"to-number":ya,"to-string":jr};class $s{constructor(e,a){this.type=e,this.args=a}static parse(e,a){if(e.length<2)return a.error("Expected at least one argument.");const s=e[0],c=[];let p=Sc;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);p=Pi(a.expectedType.itemType,m)}else{if(!(m>0&&zc(e[1][0])))return null;p=Pi(li(e[1][0]),m)}for(let x=0;x<m;x++){const L=e[1][x];let N;if(Array.isArray(L))N=a.parse(L,void 0,p.itemType);else{const R=od(L);if(R!==p.itemType.kind)return a.error(`Expected ${p.itemType.kind} but found ${R}.`);N=a.registry.literal.parse(["literal",L===void 0?null:L],a)}if(!N)return null;c.push(N)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return a.error("Expected one argument.");p=cd[s];for(let m=1;m<e.length;m++){const x=a.parse(e[m],m,Dr);if(!x)return null;c.push(x)}}return new $s(p,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let a,s;for(const c of this.args){if(a=c.evaluate(e),s=null,a instanceof Or)return a;if(typeof a=="string"){const p=e.parseColor(a);if(p)return p}else if(Array.isArray(a)&&(s=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:tf(a[0],a[1],a[2],a[3]),!s))return new Or(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Xn(s||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const s of this.args){if(a=s.evaluate(e),a===null)return 0;const c=Number(a);if(!isNaN(c))return c}throw new Xn(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Bi.fromString(El(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Is.build(El(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(a=>a.evaluate(e)):El(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ac([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new za(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{e.push(a.serialize())}),e}}const rf=["Unknown","Point","LineString","Polygon"];class _i{constructor(e,a,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=a,this.iconImageUseTheme=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*a-e[0])+this.featureDistanceData.bearing[1]*(c*a-e[1])}return 0}parseColor(e){let a=this._parseColorCache[e];return a||(a=this._parseColorCache[e]=Or.parse(e)),a}getConfig(e){return this.options?this.options.get(e):null}}class ms{constructor(e,a,s,c,p){this.name=e,this.type=a,this._evaluate=s,this.args=c,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const a=ms.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,a){const s=e[0],c=ms.definitions[s];if(!c)return a.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=[];let L=null,N=-1;for(const[R,T]of m){if(Array.isArray(R)&&R.length!==e.length-1)continue;x.push(R),N++,L=new Fc(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const V=[];let F=!1;for(let O=1;O<e.length;O++){const Q=e[O],$=Array.isArray(R)?R[O-1]:R.type,K=L.parse(Q,1+V.length,$);if(!K){F=!0;break}V.push(K)}if(!F)if(Array.isArray(R)&&R.length!==V.length)L.error(`Expected ${R.length} arguments, but found ${V.length} instead.`);else{for(let O=0;O<V.length;O++){const Q=Array.isArray(R)?R[O]:R.type,$=V[O];L.concat(O+1).checkSubtype(Q,$.type)}if(L.errors.length===0)return new ms(s,p,T,V,N)}}if(x.length===1)a.errors.push(...L.errors);else{const R=(x.length?x:m.map(([V])=>V)).map(Rc).join(" | "),T=[];for(let V=1;V<e.length;V++){const F=a.parse(e[V],1+T.length);if(!F)return null;T.push(oi(F.type))}a.error(`Expected arguments of type ${R}, but found (${T.join(", ")}) instead.`)}return null}static register(e,a){ms.definitions=a;for(const s in a)e[s]=ms}}function Rc(r){return Array.isArray(r)?`(${r.map(oi).join(", ")})`:`(${oi(r.type)}...)`}class Tc{constructor(e,a,s){this.type=rh,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=a}static parse(e,a){if(e.length!==2)return a.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");const c=s["case-sensitive"]===void 0?a.parse(!1,1,Mr):a.parseObjectValue(s["case-sensitive"],1,"case-sensitive",Mr);if(!c)return null;const p=s["diacritic-sensitive"]===void 0?a.parse(!1,1,Mr):a.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",Mr);if(!p)return null;let m=null;return s.locale&&(m=a.parseObjectValue(s.locale,1,"locale",jr),!m)?null:new Tc(c,p,m)}evaluate(e){return new tp(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function nl(r,e,a=0,s=r.length-1,c=qp){for(;s>a;){if(s-a>600){const L=s-a+1,N=e-a+1,R=Math.log(L),T=.5*Math.exp(2*R/3),V=.5*Math.sqrt(R*T*(L-T)/L)*(N-L/2<0?-1:1);nl(r,e,Math.max(a,Math.floor(e-N*T/L+V)),Math.min(s,Math.floor(e+(L-N)*T/L+V)),c)}const p=r[e];let m=a,x=s;for(Ii(r,a,e),c(r[s],p)>0&&Ii(r,a,s);m<x;){for(Ii(r,m,x),m++,x--;c(r[m],p)<0;)m++;for(;c(r[x],p)>0;)x--}c(r[a],p)===0?Ii(r,a,x):(x++,Ii(r,x,s)),x<=e&&(a=x+1),e<=x&&(s=x-1)}}function Ii(r,e,a){const s=r[e];r[e]=r[a],r[a]=s}function qp(r,e){return r<e?-1:r>e?1:0}function Kp(r){let e=0;for(let a,s,c=0,p=r.length,m=p-1;c<p;m=c++)a=r[c],s=r[m],e+=(s.x-a.x)*(a.y+s.y);return e}function lh(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Vc(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function em(r,e,a){const s=r[0]-e[0],c=r[1]-e[1],p=r[0]-a[0],m=r[1]-a[1];return s*m-p*c==0&&s*p<=0&&c*m<=0}function Bo(r,e,a=!1){let s=!1;for(let x=0,L=e.length;x<L;x++){const N=e[x];for(let R=0,T=N.length,V=T-1;R<T;V=R++){const F=N[V],O=N[R];if(em(r,F,O))return a;(p=F)[1]>(c=r)[1]!=(m=O)[1]>c[1]&&c[0]<(m[0]-p[0])*(c[1]-p[1])/(m[1]-p[1])+p[0]&&(s=!s)}}var c,p,m;return s}function tm(r,e,a,s){const c=s[0]-a[0],p=s[1]-a[1],m=(r[0]-a[0])*p-c*(r[1]-a[1]),x=(e[0]-a[0])*p-c*(e[1]-a[1]);return m>0&&x<0||m<0&&x>0}function qs(r,e,a,s){return(c=[s[0]-a[0],s[1]-a[1]])[0]*(p=[e[0]-r[0],e[1]-r[1]])[1]-c[1]*p[0]!=0&&!(!tm(r,e,a,s)||!tm(a,s,r,e));var c,p}function ec(r){const e=new St(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new St(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const s of r[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),a.x<s.x&&(a.x=s.x),a.y<s.y&&(a.y=s.y);return{min:e,max:a}}const tc=8192;function am(r,e){const a=(180+r[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(a*c*tc),Math.round(s*c*tc)]}function ap(r,e){for(let a=0;a<e.length;a++)if(Bo(r,e[a]))return!0;return!1}function rm(r,e,a){for(const s of a)for(let c=0,p=s.length,m=p-1;c<p;m=c++)if(qs(r,e,s[m],s[c]))return!0;return!1}function zl(r,e){for(let a=0;a<r.length;++a)if(!Bo(r[a],e))return!1;for(let a=0;a<r.length-1;++a)if(rm(r[a],r[a+1],e))return!1;return!0}function dy(r,e){for(let a=0;a<e.length;a++)if(zl(r,e[a]))return!0;return!1}function rp(r,e,a){const s=[];for(let c=0;c<r.length;c++){const p=[];for(let m=0;m<r[c].length;m++){const x=am(r[c][m],a);lh(e,x),p.push(x)}s.push(p)}return s}function ac(r,e,a){const s=[];for(let c=0;c<r.length;c++){const p=rp(r[c],e,a);s.push(p)}return s}function ch(r,e,a,s){if(r[0]<a[0]||r[0]>a[2]){const c=.5*s;let p=r[0]-a[0]>c?-s:a[0]-r[0]>c?s:0;p===0&&(p=r[0]-a[2]>c?-s:a[2]-r[0]>c?s:0),r[0]+=p}lh(e,r)}function du(r,e,a,s){const c=Math.pow(2,s.z)*tc,p=[s.x*tc,s.y*tc],m=[];if(!r)return m;for(const x of r)for(const L of x){const N=[L.x+p[0],L.y+p[1]];ch(N,e,a,c),m.push(N)}return m}function Ks(r,e,a,s){const c=Math.pow(2,s.z)*tc,p=[s.x*tc,s.y*tc],m=[];if(!r)return m;for(const L of r){const N=[];for(const R of L){const T=[R.x+p[0],R.y+p[1]];lh(e,T),N.push(T)}m.push(N)}if(e[2]-e[0]<=c/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const L of m)for(const N of L)ch(N,e,a,c)}var x;return m}class Mc{constructor(e,a){this.type=Mr,this.geojson=e,this.geometries=a}static parse(e,a){if(e.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zc(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const p=s.features[c].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Mc(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Mc(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Mc(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(a,s){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=a.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const x=rp(s.coordinates,p,m),L=du(a.geometry(),c,p,m);if(!Vc(c,p))return!1;for(const N of L)if(!Bo(N,x))return!1}if(s.type==="MultiPolygon"){const x=ac(s.coordinates,p,m),L=du(a.geometry(),c,p,m);if(!Vc(c,p))return!1;for(const N of L)if(!ap(N,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(a,s){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=a.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const x=rp(s.coordinates,p,m),L=Ks(a.geometry(),c,p,m);if(!Vc(c,p))return!1;for(const N of L)if(!zl(N,x))return!1}if(s.type==="MultiPolygon"){const x=ac(s.coordinates,p,m),L=Ks(a.geometry(),c,p,m);if(!Vc(c,p))return!1;for(const N of L)if(!dy(N,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Bc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ic=1/298.257223563,uh=Ic*(2-Ic),hu=Math.PI/180;class rc{static fromTile(e,a,s){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,a)),p=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/hu;return new rc(p,s)}static get units(){return Bc}constructor(e,a){if(e===void 0)throw new Error("No latitude given.");if(a&&!Bc[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Bc).join(", ")}`);const s=6378.137*hu*(a?Bc[a]:1),c=Math.cos(e*hu),p=1/(1-uh*(1-c*c)),m=Math.sqrt(p);this.kx=s*m*c,this.ky=s*m*p*(1-uh)}distance(e,a){const s=eo(e[0]-a[0])*this.kx,c=(e[1]-a[1])*this.ky;return Math.sqrt(s*s+c*c)}bearing(e,a){const s=eo(a[0]-e[0])*this.kx;return Math.atan2(s,(a[1]-e[1])*this.ky)/hu}destination(e,a,s){const c=s*hu;return this.offset(e,Math.sin(c)*a,Math.cos(c)*a)}offset(e,a,s){return[e[0]+a/this.kx,e[1]+s/this.ky]}lineDistance(e){let a=0;for(let s=0;s<e.length-1;s++)a+=this.distance(e[s],e[s+1]);return a}area(e){let a=0;for(let s=0;s<e.length;s++){const c=e[s];for(let p=0,m=c.length,x=m-1;p<m;x=p++)a+=eo(c[p][0]-c[x][0])*(c[p][1]+c[x][1])*(s?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(e,a){let s=0;if(a<=0)return e[0];for(let c=0;c<e.length-1;c++){const p=e[c],m=e[c+1],x=this.distance(p,m);if(s+=x,s>a)return dh(p,m,(a-(s-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,a,s){let[c,p]=a,m=eo(s[0]-c)*this.kx,x=(s[1]-p)*this.ky;if(m!==0||x!==0){const L=(eo(e[0]-c)*this.kx*m+(e[1]-p)*this.ky*x)/(m*m+x*x);L>1?(c=s[0],p=s[1]):L>0&&(c+=m/this.kx*L,p+=x/this.ky*L)}return m=eo(e[0]-c)*this.kx,x=(e[1]-p)*this.ky,Math.sqrt(m*m+x*x)}pointOnLine(e,a){let s=1/0,c=e[0][0],p=e[0][1],m=0,x=0;for(let L=0;L<e.length-1;L++){let N=e[L][0],R=e[L][1],T=eo(e[L+1][0]-N)*this.kx,V=(e[L+1][1]-R)*this.ky,F=0;T===0&&V===0||(F=(eo(a[0]-N)*this.kx*T+(a[1]-R)*this.ky*V)/(T*T+V*V),F>1?(N=e[L+1][0],R=e[L+1][1]):F>0&&(N+=T/this.kx*F,R+=V/this.ky*F)),T=eo(a[0]-N)*this.kx,V=(a[1]-R)*this.ky;const O=T*T+V*V;O<s&&(s=O,c=N,p=R,m=L,x=F)}return{point:[c,p],index:m,t:Math.max(0,Math.min(1,x))}}lineSlice(e,a,s){let c=this.pointOnLine(s,e),p=this.pointOnLine(s,a);if(c.index>p.index||c.index===p.index&&c.t>p.t){const N=c;c=p,p=N}const m=[c.point],x=c.index+1,L=p.index;!nf(s[x],m[0])&&x<=L&&m.push(s[x]);for(let N=x+1;N<=L;N++)m.push(s[N]);return nf(s[L],p.point)||m.push(p.point),m}lineSliceAlong(e,a,s){let c=0;const p=[];for(let m=0;m<s.length-1;m++){const x=s[m],L=s[m+1],N=this.distance(x,L);if(c+=N,c>e&&p.length===0&&p.push(dh(x,L,(e-(c-N))/N)),c>=a)return p.push(dh(x,L,(a-(c-N))/N)),p;c>e&&p.push(L)}return p}bufferPoint(e,a){const s=a/this.ky,c=a/this.kx;return[e[0]-c,e[1]-s,e[0]+c,e[1]+s]}bufferBBox(e,a){const s=a/this.ky,c=a/this.kx;return[e[0]-c,e[1]-s,e[2]+c,e[3]+s]}insideBBox(e,a){return eo(e[0]-a[0])>=0&&eo(e[0]-a[2])<=0&&e[1]>=a[1]&&e[1]<=a[3]}}function nf(r,e){return r[0]===e[0]&&r[1]===e[1]}function dh(r,e,a){const s=eo(e[0]-r[0]);return[r[0]+s*a,r[1]+(e[1]-r[1])*a]}function eo(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class hh{constructor(e=[],a=(s,c)=>s<c?-1:s>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=a,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:a,compare:s}=this,c=a[e];for(;e>0;){const p=e-1>>1,m=a[p];if(s(c,m)>=0)break;a[e]=m,e=p}a[e]=c}_down(e){const{data:a,compare:s}=this,c=this.length>>1,p=a[e];for(;e<c;){let m=1+(e<<1);const x=m+1;if(x<this.length&&s(a[x],a[m])<0&&(m=x),s(a[m],p)>=0)break;a[e]=a[m],e=m}a[e]=p}}var Dt=8192;function sf(r,e){return e.dist-r.dist}const fo=100,kc=50;function fu(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==r[a])return!1;return!0}function fh(r){return r[1]-r[0]+1}function Al(r,e){const a=r[1]>=r[0]&&r[1]<e;return a||console.warn("Distance Expression: Index is out of range"),a}function Jc(r,e){if(r[0]>r[1])return[null,null];const a=fh(r);if(e){if(a===2)return[r,null];const s=Math.floor(a/2);return[[r[0],r[0]+s],[r[0]+s,r[1]]]}{if(a===1)return[r,null];const s=Math.floor(a/2)-1;return[[r[0],r[0]+s],[r[0]+s+1,r[1]]]}}function Io(r,e){const a=[1/0,1/0,-1/0,-1/0];if(!Al(e,r.length))return a;for(let s=e[0];s<=e[1];++s)lh(a,r[s]);return a}function cr(r){const e=[1/0,1/0,-1/0,-1/0];for(let a=0;a<r.length;++a)for(let s=0;s<r[a].length;++s)lh(e,r[a][s]);return e}function pu(r,e,a){if(fu(r)||fu(e))return NaN;let s=0,c=0;return r[2]<e[0]&&(s=e[0]-r[2]),r[0]>e[2]&&(s=r[0]-e[2]),r[1]>e[3]&&(c=r[1]-e[3]),r[3]<e[1]&&(c=e[1]-r[3]),a.distance([0,0],[s,c])}function hi(r){return 360*r-180}function np(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function mu(r,e){const a=Math.pow(2,e.z),s=(r.y/Dt+e.y)/a;return[hi((r.x/Dt+e.x)/a),np(s)]}function ph(r,e){const a=[];for(let s=0;s<r.length;++s)a.push(mu(r[s],e));return a}function jn(r,e,a){const s=a.pointOnLine(e,r).point;return a.distance(r,s)}function of(r,e,a,s,c){const p=a.slice(s[0],s[1]+1);let m=1/0;for(let x=e[0];x<=e[1];++x)if((m=Math.min(m,jn(r[x],p,c)))===0)return 0;return m}function yu(r,e,a,s,c){const p=Math.min(c.pointToSegmentDistance(r,a,s),c.pointToSegmentDistance(e,a,s)),m=Math.min(c.pointToSegmentDistance(a,r,e),c.pointToSegmentDistance(s,r,e));return Math.min(p,m)}function lf(r,e,a,s,c){if(!Al(e,r.length)||!Al(s,a.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let x=s[0];x<s[1];++x){if(qs(r[m],r[m+1],a[x],a[x+1]))return 0;p=Math.min(p,yu(r[m],r[m+1],a[x],a[x+1],c))}return p}function ud(r,e,a,s,c){if(!Al(e,r.length)||!Al(s,a.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let x=s[0];x<=s[1];++x)if((p=Math.min(p,c.distance(r[m],a[x])))===0)return p;return p}function nm(r,e,a){if(Bo(r,e,!0))return 0;let s=1/0;for(const c of e){const p=c.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[p-1]&&(s=Math.min(s,a.pointToSegmentDistance(r,c[p-1],c[0])))===0||(s=Math.min(s,jn(r,c,a)))===0)return s}return s}function hy(r,e,a,s){if(!Al(e,r.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Bo(r[p],a,!0))return 0;let c=1/0;for(let p=e[0];p<e[1];++p)for(const m of a)for(let x=0,L=m.length,N=L-1;x<L;N=x++){if(qs(r[p],r[p+1],m[N],m[x]))return 0;c=Math.min(c,yu(r[p],r[p+1],m[N],m[x],s))}return c}function im(r,e){for(const a of r)for(let s=0;s<=a.length-1;++s)if(Bo(a[s],e,!0))return!0;return!1}function sm(r,e,a,s=1/0){const c=cr(r),p=cr(e);if(s!==1/0&&pu(c,p,a)>=s)return s;if(Vc(c,p)){if(im(r,e))return 0}else if(im(e,r))return 0;let m=s;for(const x of r)for(let L=0,N=x.length,R=N-1;L<N;R=L++)for(const T of e)for(let V=0,F=T.length,O=F-1;V<F;O=V++){if(qs(x[R],x[L],T[O],T[V]))return 0;m=Math.min(m,yu(x[R],x[L],T[O],T[V],a))}return m}function gu(r,e,a,s,c,p,m){if(p===null||m===null)return;const x=pu(Io(s,p),Io(c,m),a);x<e&&r.push({dist:x,range1:p,range2:m})}function cf(r,e,a,s,c=1/0){let p=Math.min(s.distance(r[0],a[0][0]),c);if(p===0)return p;const m=new hh([{dist:0,range1:[0,r.length-1],range2:[0,0]}],sf),x=e?kc:fo,L=cr(a);for(;m.length;){const N=m.pop();if(N.dist>=p)continue;const R=N.range1;if(fh(R)<=x){if(!Al(R,r.length))return NaN;if(e){const T=hy(r,R,a,s);if((p=Math.min(p,T))===0)return p}else for(let T=R[0];T<=R[1];++T){const V=nm(r[T],a,s);if((p=Math.min(p,V))===0)return p}}else{const T=Jc(R,e);if(T[0]!==null){const V=pu(Io(r,T[0]),L,s);V<p&&m.push({dist:V,range1:T[0],range2:[0,0]})}if(T[1]!==null){const V=pu(Io(r,T[1]),L,s);V<p&&m.push({dist:V,range1:T[1],range2:[0,0]})}}}return p}function uf(r,e,a,s,c,p=1/0){let m=Math.min(p,c.distance(r[0],a[0]));if(m===0)return m;const x=new hh([{dist:0,range1:[0,r.length-1],range2:[0,a.length-1]}],sf),L=e?kc:fo,N=s?kc:fo;for(;x.length;){const R=x.pop();if(R.dist>=m)continue;const T=R.range1,V=R.range2;if(fh(T)<=L&&fh(V)<=N){if(!Al(T,r.length)||!Al(V,a.length))return NaN;if(e&&s?m=Math.min(m,lf(r,T,a,V,c)):e||s?e&&!s?m=Math.min(m,of(a,V,r,T,c)):!e&&s&&(m=Math.min(m,of(r,T,a,V,c))):m=Math.min(m,ud(r,T,a,V,c)),m===0)return m}else{const F=Jc(T,e),O=Jc(V,s);gu(x,m,c,r,a,F[0],O[0]),gu(x,m,c,r,a,F[0],O[1]),gu(x,m,c,r,a,F[1],O[0]),gu(x,m,c,r,a,F[1],O[1])}}return m}function mh(r,e,a,s,c=1/0){let p=c;const m=Io(r,[0,r.length-1]);for(const x of a)if(!(p!==1/0&&pu(m,Io(x,[0,x.length-1]),s)>=p)&&(p=Math.min(p,uf(r,e,x,!0,s,p)),p===0))return p;return p}function dd(r,e,a,s,c=1/0){let p=c;const m=Io(r,[0,r.length-1]);for(const x of a){if(p!==1/0&&pu(m,cr(x),s)>=p)continue;const L=cf(r,e,x,s,p);if(isNaN(L))return L;if((p=Math.min(p,L))===0)return p}return p}function yh(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class _u{constructor(e,a){this.type=ya,this.geojson=e,this.geometries=a}static parse(e,a){if(e.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(zc(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let c=0;c<s.features.length;++c)if(yh(s.features[c].geometry.type))return new _u(s,s.features[c].geometry)}else if(s.type==="Feature"){if(yh(s.geometry.type))return new _u(s,s.geometry)}else if(yh(s.type))return new _u(s,s)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const a=e.geometry(),s=e.canonicalID();if(a!=null&&s!=null){if(e.geometryType()==="Point")return function(c,p,m){const x=[];for(const N of c)for(const R of N)x.push(mu(R,p));const L=new rc(x[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?uf(x,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",L):m.type==="MultiLineString"?mh(x,!1,m.coordinates,L):m.type==="Polygon"||m.type==="MultiPolygon"?dd(x,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,L):null}(a,s,this.geometries);if(e.geometryType()==="LineString")return function(c,p,m){const x=[];for(const N of c){const R=[];for(const T of N)R.push(mu(T,p));x.push(R)}const L=new rc(x[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return mh(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,L);if(m.type==="MultiLineString"){let N=1/0;for(let R=0;R<m.coordinates.length;R++){const T=mh(m.coordinates[R],!0,x,L,N);if(isNaN(T))return T;if((N=Math.min(N,T))===0)return N}return N}if(m.type==="Polygon"||m.type==="MultiPolygon"){let N=1/0;for(let R=0;R<x.length;R++){const T=dd(x[R],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,L,N);if(isNaN(T))return T;if((N=Math.min(N,T))===0)return N}return N}return null}(a,s,this.geometries);if(e.geometryType()==="Polygon")return function(c,p,m){const x=[];for(const N of function(R,T){const V=R.length;if(V<=1)return[R];const F=[];let O,Q;for(let $=0;$<V;$++){const K=Kp(R[$]);K!==0&&(R[$].area=Math.abs(K),Q===void 0&&(Q=K<0),Q===K<0?(O&&F.push(O),O=[R[$]]):O.push(R[$]))}return O&&F.push(O),F}(c)){const R=[];for(let T=0;T<N.length;++T)R.push(ph(N[T],p));x.push(R)}const L=new rc(x[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return dd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,L);if(m.type==="MultiLineString"){let N=1/0;for(let R=0;R<m.coordinates.length;R++){const T=dd(m.coordinates[R],!0,x,L,N);if(isNaN(T))return T;if((N=Math.min(N,T))===0)return N}return N}return m.type==="Polygon"||m.type==="MultiPolygon"?function(N,R,T){let V=1/0;for(const F of N)for(const O of R){const Q=sm(F,O,T,V);if(isNaN(Q))return Q;if((V=Math.min(V,Q))===0)return V}return V}(m.type==="Polygon"?[m.coordinates]:m.coordinates,x,L):null}(a,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function xu(r){if(r instanceof ms&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Mc||r instanceof _u)return!1;if(r instanceof il)return r.featureConstant;let e=!0;return r.eachChild(a=>{e&&!xu(a)&&(e=!1)}),e}function gh(r){if(r instanceof ms&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(a=>{e&&!gh(a)&&(e=!1)}),e}function hd(r,e){if(r instanceof ms&&e.indexOf(r.name)>=0)return!1;let a=!0;return r.eachChild(s=>{a&&!hd(s,e)&&(a=!1)}),a}function df(r,e,a){return[r,e,a].filter(Boolean).join("")}function Rl(r,e){switch(r){case"string":return El(e);case"number":return+e;case"boolean":return!!e;case"color":return Or.parse(e);case"formatted":return Bi.fromString(El(e));case"resolvedImage":return Is.build(El(e))}return e}function ip(r,e,a,s){return s!==void 0&&(r=s*Math.round(r/s)),e!==void 0&&r<e&&(r=e),a!==void 0&&r>a&&(r=a),r}class il{constructor(e,a,s,c=!1){this.type=e,this.key=a,this.scope=s,this.featureConstant=c}static parse(e,a){let s=a.expectedType;if(s==null&&(s=Dr),e.length<2||e.length>3)return a.error("Invalid number of arguments for 'config' expression.");const c=a.parse(e[1],1);if(!(c instanceof Sl))return a.error("Key name of 'config' expression must be a string literal.");let p,m=!0;const x=El(c.value);if(e.length>=3){const L=a.parse(e[2],2);if(!(L instanceof Sl))return a.error("Scope of 'config' expression must be a string literal.");p=El(L.value)}if(a.options){const L=df(x,p,a._scope),N=a.options.get(L);N&&(m=xu(N.value||N.default))}return new il(s,x,p,m)}evaluate(e){const a=df(this.key,this.scope,e.scope),s=e.getConfig(a);if(!s)return null;const{type:c,value:p,values:m,minValue:x,maxValue:L,stepValue:N}=s,R=s.default.evaluate(e);let T=R;if(p){const V=e.scope;e.scope=(V||"").split("").slice(1).join(""),T=p.evaluate(e),e.scope=V}return c&&(T=Rl(c,T)),T===void 0||x===void 0&&L===void 0&&N===void 0||(typeof T=="number"?T=ip(T,x,L,N):Array.isArray(T)&&(T=T.map(V=>typeof V=="number"?ip(V,x,L,N):V))),p!==void 0&&T!==void 0&&m&&!m.includes(T)&&(T=R,c&&(T=Rl(c,T))),(c&&c!==this.type||T!==void 0&&!ef(li(T),this.type))&&(T=Rl(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class po{constructor(e,a){this.type=a.type,this.name=e,this.boundExpression=a}static parse(e,a){if(e.length!==2||typeof e[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const s=e[1];return a.scope.has(s)?new po(s,a.scope.get(s)):a.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Fc{constructor(e,a=[],s,c=new Mo,p=[],m,x,L){this.registry=e,this.path=a,this.key=a.map(N=>typeof N=="string"?`['${N}']`:`[${N}]`).join(""),this.scope=c,this.errors=p,this.expectedType=s,this._scope=m,this.options=x,this.iconImageUseTheme=L}parse(e,a,s,c,p={}){return a||s?this.concat(a,null,s,c)._parse(e,p):this._parse(e,p)}parseObjectValue(e,a,s,c,p,m={}){return this.concat(a,s,c,p)._parse(e,m)}_parse(e,a){function s(c,p,m){return m==="assert"?new ca(p,[c]):m==="coerce"?new $s(p,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let p=c.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,x=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(m,x))return null}else p=s(p,m,a.typeAnnotation||"coerce");else p=s(p,m,a.typeAnnotation||"assert")}if(!(p instanceof Sl)&&p.type.kind!=="resolvedImage"&&sl(p)){const m=new _i(this._scope,this.options,this.iconImageUseTheme);try{p=new Sl(p.type,p.evaluate(m))}catch(x){return this.error(x.message),null}}return p}return $s.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,a,s,c){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof a=="string"?p.concat(a):p;const m=c?this.scope.concat(c):this.scope;return new Fc(this.registry,p,s||null,m,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...a){const s=`${this.key}${a.map(c=>`[${c}]`).join("")}`;this.errors.push(new Vo(s,e))}checkSubtype(e,a){const s=ih(e,a);return s&&this.error(s),s}}function sl(r){if(r instanceof po)return sl(r.boundExpression);if(r instanceof ms&&r.name==="error"||r instanceof Tc||r instanceof Mc||r instanceof _u||r instanceof il)return!1;const e=r instanceof $s||r instanceof ca;let a=!0;return r.eachChild(s=>{a=e?a&&sl(s):a&&s instanceof Sl}),!!a&&xu(r)&&hd(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function fd(r,e){const a=r.length-1;let s,c,p=0,m=a,x=0;for(;p<=m;)if(x=Math.floor((p+m)/2),s=r[x],c=r[x+1],s<=e){if(x===a||e<c)return x;p=x+1}else{if(!(s>e))throw new Xn("Input is not a number.");m=x-1}return 0}class _h{constructor(e,a,s){this.type=e,this.input=a,this.labels=[],this.outputs=[];for(const[c,p]of s)this.labels.push(c),this.outputs.push(p)}static parse(e,a){if(e.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return a.error("Expected an even number of arguments.");const s=a.parse(e[1],1,ya);if(!s)return null;const c=[];let p=null;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);for(let m=1;m<e.length;m+=2){const x=m===1?-1/0:e[m],L=e[m+1],N=m,R=m+1;if(typeof x!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(c.length&&c[c.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const T=a.parse(L,R,p);if(!T)return null;p=p||T.type,c.push([x,T])}return new _h(p,s,c)}evaluate(e){const a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=a[0])return s[0].evaluate(e);const p=a.length;return c>=a[p-1]?s[p-1].evaluate(e):s[fd(a,c)].evaluate(e)}eachChild(e){e(this.input);for(const a of this.outputs)e(a)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&e.push(this.labels[a]),e.push(this.outputs[a].serialize());return e}}const om=.95047,Oc=1.08883,pd=4/29,ol=6/29,wu=3*ol*ol,sp=ol*ol*ol,vu=Math.PI/180,Dc=180/Math.PI;function ti(r){return r>sp?Math.pow(r,1/3):r/wu+pd}function $n(r){return r>ol?r*r*r:wu*(r-pd)}function ll(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Qi(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Gi(r){const e=Qi(r.r),a=Qi(r.g),s=Qi(r.b),c=ti((.4124564*e+.3575761*a+.1804375*s)/om),p=ti((.2126729*e+.7151522*a+.072175*s)/1);return{l:116*p-16,a:500*(c-p),b:200*(p-ti((.0193339*e+.119192*a+.9503041*s)/Oc)),alpha:r.a}}function nc(r){let e=(r.l+16)/116,a=isNaN(r.a)?e:e+r.a/500,s=isNaN(r.b)?e:e-r.b/200;return e=1*$n(e),a=om*$n(a),s=Oc*$n(s),new Or(ll(3.2404542*a-1.5371385*e-.4985314*s),ll(-.969266*a+1.8760108*e+.041556*s),ll(.0556434*a-.2040259*e+1.0572252*s),r.alpha)}function bu(r,e,a){const s=e-r;return r+a*(s>180||s<-180?s-360*Math.round(s/360):s)}const rs={forward:Gi,reverse:nc,interpolate:function(r,e,a){return{l:Sa(r.l,e.l,a),a:Sa(r.a,e.a,a),b:Sa(r.b,e.b,a),alpha:Sa(r.alpha,e.alpha,a)}}},Tl={forward:function(r){const{l:e,a,b:s}=Gi(r),c=Math.atan2(s,a)*Dc;return{h:c<0?c+360:c,c:Math.sqrt(a*a+s*s),l:e,alpha:r.a}},reverse:function(r){const e=r.h*vu,a=r.c;return nc({l:r.l,a:Math.cos(e)*a,b:Math.sin(e)*a,alpha:r.alpha})},interpolate:function(r,e,a){return{h:bu(r.h,e.h,a),c:Sa(r.c,e.c,a),l:Sa(r.l,e.l,a),alpha:Sa(r.alpha,e.alpha,a)}}};var xh=Object.freeze({__proto__:null,hcl:Tl,lab:rs});class to{constructor(e,a,s,c,p){this.type=e,this.operator=a,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[m,x]of p)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(e,a,s,c){let p=0;if(e.name==="exponential")p=md(a,e.base,s,c);else if(e.name==="linear")p=md(a,1,s,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new bc(m[0],m[1],m[2],m[3]).solve(md(a,1,s,c))}return p}static parse(e,a){let[s,c,p,...m]=e;if(!Array.isArray(c)||c.length===0)return a.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const N=c[1];if(typeof N!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:N}}else{if(c[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const N=c.slice(1);if(N.length!==4||N.some(R=>typeof R!="number"||R<0||R>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:N}}}if(e.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(p=a.parse(p,2,ya),!p)return null;const x=[];let L=null;s==="interpolate-hcl"||s==="interpolate-lab"?L=Ys:a.expectedType&&a.expectedType.kind!=="value"&&(L=a.expectedType);for(let N=0;N<m.length;N+=2){const R=m[N],T=m[N+1],V=N+3,F=N+4;if(typeof R!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(x.length&&x[x.length-1][0]>=R)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const O=a.parse(T,F,L);if(!O)return null;L=L||O.type,x.push([R,O])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new to(L,s,c,p,x):a.error(`Type ${oi(L)} is not interpolatable.`)}evaluate(e){const a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=a[0])return s[0].evaluate(e);const p=a.length;if(c>=a[p-1])return s[p-1].evaluate(e);const m=fd(a,c),x=to.interpolationFactor(this.interpolation,c,a[m],a[m+1]),L=s[m].evaluate(e),N=s[m+1].evaluate(e);return this.operator==="interpolate"?ql[this.type.kind.toLowerCase()](L,N,x):this.operator==="interpolate-hcl"?Tl.reverse(Tl.interpolate(Tl.forward(L),Tl.forward(N),x)):rs.reverse(rs.interpolate(rs.forward(L),rs.forward(N),x))}eachChild(e){e(this.input);for(const a of this.outputs)e(a)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a}}function md(r,e,a,s){const c=s-a,p=r-a;return c===0?0:e===1?p/c:(Math.pow(e,p)-1)/(Math.pow(e,c)-1)}class yd{constructor(e,a){this.type=e,this.args=a}static parse(e,a){if(e.length<2)return a.error("Expectected at least one argument.");let s=null;const c=a.expectedType;c&&c.kind!=="value"&&(s=c);const p=[];for(const x of e.slice(1)){const L=a.parse(x,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!L)return null;s=s||L.type,p.push(L)}const m=c&&p.some(x=>ih(c,x.type));return new yd(m?Dr:s,p)}evaluate(e){let a,s=null,c=0;for(const p of this.args){if(c++,s=p.evaluate(e),s&&s instanceof Is&&!s.available&&(a||(a=s),s=null,c===this.args.length))return a;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(a=>{e.push(a.serialize())}),e}}class mo{constructor(e,a){this.type=a.type,this.bindings=[].concat(e),this.result=a}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const a of this.bindings)e(a[1]);e(this.result)}static parse(e,a){if(e.length<4)return a.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return a.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return a.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=a.parse(e[p+1],p+1);if(!x)return null;s.push([m,x])}const c=a.parse(e[e.length-1],e.length-1,a.expectedType,s);return c?new mo(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[a,s]of this.bindings)e.push(a,s.serialize());return e.push(this.result.serialize()),e}}class gd{constructor(e,a,s){this.type=e,this.index=a,this.input=s}static parse(e,a){if(e.length!==3)return a.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=a.parse(e[1],1,ya),c=a.parse(e[2],2,Pi(a.expectedType||Dr));return s&&c?new gd(c.type.itemType,s,c):null}evaluate(e){const a=this.index.evaluate(e),s=this.input.evaluate(e);if(a<0)throw new Xn("Array index out of bounds: negative index");if(a>=s.length)throw new Xn("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new Xn("Array index must be an integer. Use at-interpolated for fractional indices");return s[a]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class wh{constructor(e,a,s){this.type=e,this.index=a,this.input=s}static parse(e,a){if(e.length!==3)return a.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=a.parse(e[1],1,ya),c=a.parse(e[2],2,Pi(a.expectedType||Dr));return s&&c?new wh(c.type.itemType,s,c):null}evaluate(e){const a=this.index.evaluate(e),s=this.input.evaluate(e);if(a<0)throw new Xn(`Array index out of bounds: ${a} < 0.`);if(a>s.length-1)throw new Xn(`Array index out of bounds: ${a} > ${s.length-1}.`);if(a===Math.floor(a))return s[a];const c=Math.floor(a),p=Math.ceil(a),m=s[c],x=s[p];if(typeof m!="number"||typeof x!="number")throw new Xn(`Cannot interpolate between non-number values at index ${a}.`);const L=a-c;return m*(1-L)+x*L}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class hf{constructor(e,a){this.type=Mr,this.needle=e,this.haystack=a}static parse(e,a){if(e.length!==3)return a.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=a.parse(e[1],1,Dr),c=a.parse(e[2],2,Dr);return s&&c?ep(s.type,[Mr,jr,ya,Sc,Dr])?new hf(s,c):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${oi(s.type)} instead`):null}evaluate(e){const a=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!sd(a,["boolean","string","number","null"]))throw new Xn(`Expected first argument to be of type boolean, string, number or null, but found ${oi(li(a))} instead.`);if(!sd(s,["string","array"]))throw new Xn(`Expected second argument to be of type array or string, but found ${oi(li(s))} instead.`);return s.indexOf(a)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class vh{constructor(e,a,s){this.type=ya,this.needle=e,this.haystack=a,this.fromIndex=s}static parse(e,a){if(e.length<=2||e.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=a.parse(e[1],1,Dr),c=a.parse(e[2],2,Dr);if(!s||!c)return null;if(!ep(s.type,[Mr,jr,ya,Sc,Dr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${oi(s.type)} instead`);if(e.length===4){const p=a.parse(e[3],3,ya);return p?new vh(s,c,p):null}return new vh(s,c)}evaluate(e){const a=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!sd(a,["boolean","string","number","null"]))throw new Xn(`Expected first argument to be of type boolean, string, number or null, but found ${oi(li(a))} instead.`);if(!sd(s,["string","array"]))throw new Xn(`Expected second argument to be of type array or string, but found ${oi(li(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(a,c)}return s.indexOf(a)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class cl{constructor(e,a,s,c,p,m){this.inputType=e,this.type=a,this.input=s,this.cases=c,this.outputs=p,this.otherwise=m}static parse(e,a){if(e.length<5)return a.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return a.error("Expected an even number of arguments.");let s,c;a.expectedType&&a.expectedType.kind!=="value"&&(c=a.expectedType);const p={},m=[];for(let N=2;N<e.length-1;N+=2){let R=e[N];const T=e[N+1];Array.isArray(R)||(R=[R]);const V=a.concat(N);if(R.length===0)return V.error("Expected at least one branch label.");for(const O of R){if(typeof O!="number"&&typeof O!="string")return V.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return V.error("Numeric branch labels must be integer values.");if(s){if(V.checkSubtype(s,li(O)))return null}else s=li(O);if(p[String(O)]!==void 0)return V.error("Branch labels must be unique.");p[String(O)]=m.length}const F=a.parse(T,N,c);if(!F)return null;c=c||F.type,m.push(F)}const x=a.parse(e[1],1,Dr);if(!x)return null;const L=a.parse(e[e.length-1],e.length-1,c);return L?x.type.kind!=="value"&&a.concat(1).checkSubtype(s,x.type)?null:new cl(s,c,x,p,m,L):null}evaluate(e){const a=this.input.evaluate(e);return(ef(li(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),s=[],c={};for(const m of a){const x=c[this.cases[m]];x===void 0?(c[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[x][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of s)e.push(x.length===1?p(x[0]):x.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class ul{constructor(e,a,s){this.type=e,this.branches=a,this.otherwise=s}static parse(e,a){if(e.length<4)return a.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return a.error("Expected an odd number of arguments.");let s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const x=a.parse(e[m],m,Mr);if(!x)return null;const L=a.parse(e[m+1],m+1,s);if(!L)return null;c.push([x,L]),s=s||L.type}const p=a.parse(e[e.length-1],e.length-1,s);return p?new ul(s,c,p):null}evaluate(e){for(const[a,s]of this.branches)if(a.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[a,s]of this.branches)e(a),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(a=>{e.push(a.serialize())}),e}}class ic{constructor(e,a,s,c){this.type=e,this.input=a,this.beginIndex=s,this.endIndex=c}static parse(e,a){if(e.length<=2||e.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=a.parse(e[1],1,Dr),c=a.parse(e[2],2,ya);if(!s||!c)return null;if(!ep(s.type,[Pi(Dr),jr,Dr]))return a.error(`Expected first argument to be of type array or string, but found ${oi(s.type)} instead`);if(e.length===4){const p=a.parse(e[3],3,ya);return p?new ic(s.type,s,c,p):null}return new ic(s.type,s,c)}evaluate(e){const a=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!sd(a,["string","array"]))throw new Xn(`Expected first argument to be of type array or string, but found ${oi(li(a))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return a.slice(s,c)}return a.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Lu{constructor(e,a){this.type=Pi(jr),this.str=e,this.delimiter=a}static parse(e,a){if(e.length!==3)return a.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=a.parse(e[1],1,jr),c=a.parse(e[2],2,jr);return s&&c?new Lu(s,c):void 0}evaluate(e){const a=this.str.evaluate(e),s=this.delimiter.evaluate(e);return a.split(s)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function bh(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function yo(r,e,a,s){return s.compare(e,a)===0}function ys(r,e,a){const s=r!=="=="&&r!=="!=";return class fN{constructor(p,m,x){this.type=Mr,this.lhs=p,this.rhs=m,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const x=p[0];let L=m.parse(p[1],1,Dr);if(!L)return null;if(!bh(x,L.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${oi(L.type)}'.`);let N=m.parse(p[2],2,Dr);if(!N)return null;if(!bh(x,N.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${oi(N.type)}'.`);if(L.type.kind!==N.type.kind&&L.type.kind!=="value"&&N.type.kind!=="value")return m.error(`Cannot compare types '${oi(L.type)}' and '${oi(N.type)}'.`);s&&(L.type.kind==="value"&&N.type.kind!=="value"?L=new ca(N.type,[L]):L.type.kind!=="value"&&N.type.kind==="value"&&(N=new ca(L.type,[N])));let R=null;if(p.length===4){if(L.type.kind!=="string"&&N.type.kind!=="string"&&L.type.kind!=="value"&&N.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(R=m.parse(p[3],3,rh),!R)return null}return new fN(L,N,R)}evaluate(p){const m=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const L=li(m),N=li(x);if(L.kind!==N.kind||L.kind!=="string"&&L.kind!=="number")throw new Xn(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${L.kind}, ${N.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const L=li(m),N=li(x);if(L.kind!=="string"||N.kind!=="string")return e(p,m,x)}return this.collator?a(p,m,x,this.collator.evaluate(p)):e(p,m,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[r];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const Cc=ys("==",function(r,e,a){return e===a},yo),Vl=ys("!=",function(r,e,a){return e!==a},function(r,e,a,s){return!yo(0,e,a,s)}),sc=ys("<",function(r,e,a){return e<a},function(r,e,a,s){return s.compare(e,a)<0}),ju=ys(">",function(r,e,a){return e>a},function(r,e,a,s){return s.compare(e,a)>0}),lm=ys("<=",function(r,e,a){return e<=a},function(r,e,a,s){return s.compare(e,a)<=0}),_d=ys(">=",function(r,e,a){return e>=a},function(r,e,a,s){return s.compare(e,a)>=0});class Lh{constructor(e,a,s,c,p,m){this.type=jr,this.number=e,this.locale=a,this.currency=s,this.unit=c,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,a){if(e.length!==3)return a.error("Expected two arguments.");const s=a.parse(e[1],1,ya);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return a.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=a.parseObjectValue(c.locale,2,"locale",jr),!p))return null;let m=null;if(c.currency&&(m=a.parseObjectValue(c.currency,2,"currency",jr),!m))return null;let x=null;if(c.unit&&(x=a.parseObjectValue(c.unit,2,"unit",jr),!x))return null;let L=null;if(c["min-fraction-digits"]&&(L=a.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",ya),!L))return null;let N=null;return c["max-fraction-digits"]&&(N=a.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",ya),!N)?null:new Lh(s,p,m,x,L,N)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ks{constructor(e){this.type=ya,this.input=e}static parse(e,a){if(e.length!==2)return a.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=a.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${oi(s.type)} instead.`):new ks(s):null}evaluate(e){const a=this.input.evaluate(e);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Xn(`Expected value to be of type string or array, but found ${oi(li(a))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(a=>{e.push(a.serialize())}),e}}function ao(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Qn={"==":Cc,"!=":Vl,">":ju,"<":sc,">=":_d,"<=":lm,array:ca,at:gd,"at-interpolated":wh,boolean:ca,case:ul,coalesce:yd,collator:Tc,format:Ac,image:za,in:hf,"index-of":vh,interpolate:to,"interpolate-hcl":to,"interpolate-lab":to,length:ks,let:mo,literal:Sl,match:cl,number:ca,"number-format":Lh,object:ca,slice:ic,step:_h,string:ca,"to-boolean":$s,"to-color":$s,"to-number":$s,"to-string":$s,var:po,within:Mc,distance:_u,config:il,split:Lu};function go(r,[e,a,s,c]){e=e.evaluate(r),a=a.evaluate(r),s=s.evaluate(r);const p=c?c.evaluate(r):1,m=tf(e,a,s,p);if(m)throw new Xn(m);return new Or(e/255,a/255,s/255,p)}function op(r,[e,a,s,c]){e=e.evaluate(r),a=a.evaluate(r),s=s.evaluate(r);const p=c?c.evaluate(r):1,m=function(N,R,T,V){return typeof N=="number"&&N>=0&&N<=360?typeof R=="number"&&R>=0&&R<=100&&typeof T=="number"&&T>=0&&T<=100?V===void 0||typeof V=="number"&&V>=0&&V<=1?null:`Invalid hsla value [${[N,R,T,V].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof V=="number"?[N,R,T,V]:[N,R,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof V=="number"?[N,R,T,V]:[N,R,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,a,s,p);if(m)throw new Xn(m);const x=`hsla(${e}, ${a}%, ${s}%, ${p})`,L=Or.parse(x);if(!L)throw new Xn(`Failed to parse HSLA color: ${x}`);return L}function lp(r,e){return r in e}function xd(r,e){const a=e[r];return a===void 0?null:a}function dl(r){return{type:r}}function wd(r){if(r instanceof il)return new Set([r.key]);let e=new Set;return r.eachChild(a=>{e=new Set([...e,...wd(a)])}),e}function Zu(r){if(r instanceof ms&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild(a=>{!e&&Zu(a)&&(e=!0)}),e}function Pc(r){return{result:"success",value:r}}function _o(r){return{result:"error",value:r}}function jh(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function ff(r){return r["property-type"]==="data-driven"}function Nu(r){return jh(r.expression,"measure-light")}function vd(r){return jh(r.expression,"zoom")}function Zh(r){return!!r.expression&&r.expression.interpolated}function Nh(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Gc(r){return r}function Eh(r,e){const a=e.type==="color",s=r.stops&&typeof r.stops[0][0]=="object",c=s||!(s||r.property!==void 0),p=r.type||(Zh(e)?"exponential":"interval");if(a&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map(N=>[N[0],Or.parse(N[1])])),r.default=Or.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!xh[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let m,x,L;if(p==="exponential")m=mf;else if(p==="interval")m=xo;else if(p==="categorical"){m=pf,x=Object.create(null);for(const N of r.stops)x[N[0]]=N[1];L=typeof r.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=cp}if(s){const N={},R=[];for(let F=0;F<r.stops.length;F++){const O=r.stops[F],Q=O[0].zoom;N[Q]===void 0&&(N[Q]={zoom:Q,type:r.type,property:r.property,default:r.default,stops:[]},R.push(Q)),N[Q].stops.push([O[0].value,O[1]])}const T=[];for(const F of R)T.push([N[F].zoom,Eh(N[F],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:to.interpolationFactor.bind(void 0,V),zoomStops:T.map(F=>F[0]),evaluate:({zoom:F},O)=>mf({stops:T,base:r.base},e,F).evaluate(F,O)}}if(c){const N=p==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:to.interpolationFactor.bind(void 0,N),zoomStops:r.stops.map(R=>R[0]),evaluate:({zoom:R})=>m(r,e,R,x,L)}}return{kind:"source",evaluate(N,R){const T=R&&R.properties?R.properties[r.property]:void 0;return T===void 0?oc(r.default,e.default):m(r,e,T,x,L)}}}function oc(r,e,a){return r!==void 0?r:e!==void 0?e:a!==void 0?a:void 0}function pf(r,e,a,s,c){return oc(typeof a===c?s[a]:void 0,r.default,e.default)}function xo(r,e,a){if(!ld(a))return oc(r.default,e.default);const s=r.stops.length;if(s===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[s-1][0])return r.stops[s-1][1];const c=fd(r.stops.map(p=>p[0]),a);return r.stops[c][1]}function mf(r,e,a){const s=r.base!==void 0?r.base:1;if(!ld(a))return oc(r.default,e.default);const c=r.stops.length;if(c===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[c-1][0])return r.stops[c-1][1];const p=fd(r.stops.map(R=>R[0]),a),m=function(R,T,V,F){const O=F-V,Q=R-V;return O===0?0:T===1?Q/O:(Math.pow(T,Q)-1)/(Math.pow(T,O)-1)}(a,s,r.stops[p][0],r.stops[p+1][0]),x=r.stops[p][1],L=r.stops[p+1][1];let N=ql[e.type]||Gc;if(r.colorSpace&&r.colorSpace!=="rgb"){const R=xh[r.colorSpace];N=(T,V)=>R.reverse(R.interpolate(R.forward(T),R.forward(V),m))}return typeof x.evaluate=="function"?{evaluate(...R){const T=x.evaluate.apply(void 0,R),V=L.evaluate.apply(void 0,R);if(T!==void 0&&V!==void 0)return N(T,V,m)}}:N(x,L,m)}function cp(r,e,a){return e.type==="color"?a=Or.parse(a):e.type==="formatted"?a=Bi.fromString(a.toString()):e.type==="resolvedImage"?a=Is.build(a.toString()):od(a)===e.type||e.type==="enum"&&e.values[a]||(a=void 0),oc(a,r.default,e.default)}ms.register(Qn,{error:[{kind:"error"},[jr],(r,[e])=>{throw new Xn(e.evaluate(r))}],typeof:[jr,[Dr],(r,[e])=>oi(li(e.evaluate(r)))],"to-rgba":[Pi(ya,4),[Ys],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Pi(ya,4),[Ys],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ys,[ya,ya,ya],go],rgba:[Ys,[ya,ya,ya,ya],go],hsl:[Ys,[ya,ya,ya],op],hsla:[Ys,[ya,ya,ya,ya],op],has:{type:Mr,overloads:[[[jr],(r,[e])=>lp(e.evaluate(r),r.properties())],[[jr,id],(r,[e,a])=>lp(e.evaluate(r),a.evaluate(r))]]},get:{type:Dr,overloads:[[[jr],(r,[e])=>xd(e.evaluate(r),r.properties())],[[jr,id],(r,[e,a])=>xd(e.evaluate(r),a.evaluate(r))]]},"feature-state":[Dr,[jr],(r,[e])=>xd(e.evaluate(r),r.featureState||{})],properties:[id,[],r=>r.properties()],"geometry-type":[jr,[],r=>r.geometryType()],worldview:[jr,[],r=>r.globals.worldview||""],"is-active-floor":[Mr,dl(jr),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const a=r.globals.activeFloors;return e.some(s=>{const c=s.evaluate(r);return a.has(c)})}],id:[Dr,[],r=>r.id()],zoom:[ya,[],r=>r.globals.zoom],pitch:[ya,[],r=>r.globals.pitch||0],"distance-from-center":[ya,[],r=>r.distanceFromCenter()],"measure-light":[ya,[jr],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[ya,[],r=>r.globals.heatmapDensity||0],"line-progress":[ya,[],r=>r.globals.lineProgress||0],"raster-value":[ya,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[ya,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[ya,[],r=>r.globals.skyRadialProgress||0],accumulated:[Dr,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ya,dl(ya),(r,e)=>{let a=0;for(const s of e)a+=s.evaluate(r);return a}],"*":[ya,dl(ya),(r,e)=>{let a=1;for(const s of e)a*=s.evaluate(r);return a}],"-":{type:ya,overloads:[[[ya,ya],(r,[e,a])=>e.evaluate(r)-a.evaluate(r)],[[ya],(r,[e])=>-e.evaluate(r)]]},"/":[ya,[ya,ya],(r,[e,a])=>e.evaluate(r)/a.evaluate(r)],"%":[ya,[ya,ya],(r,[e,a])=>e.evaluate(r)%a.evaluate(r)],ln2:[ya,[],()=>Math.LN2],pi:[ya,[],()=>Math.PI],e:[ya,[],()=>Math.E],"^":[ya,[ya,ya],(r,[e,a])=>Math.pow(e.evaluate(r),a.evaluate(r))],sqrt:[ya,[ya],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[ya,[ya],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[ya,[ya],(r,[e])=>Math.log(e.evaluate(r))],log2:[ya,[ya],(r,[e])=>Math.log2(e.evaluate(r))],sin:[ya,[ya],(r,[e])=>Math.sin(e.evaluate(r))],cos:[ya,[ya],(r,[e])=>Math.cos(e.evaluate(r))],tan:[ya,[ya],(r,[e])=>Math.tan(e.evaluate(r))],asin:[ya,[ya],(r,[e])=>Math.asin(e.evaluate(r))],acos:[ya,[ya],(r,[e])=>Math.acos(e.evaluate(r))],atan:[ya,[ya],(r,[e])=>Math.atan(e.evaluate(r))],min:[ya,dl(ya),(r,e)=>Math.min(...e.map(a=>a.evaluate(r)))],max:[ya,dl(ya),(r,e)=>Math.max(...e.map(a=>a.evaluate(r)))],abs:[ya,[ya],(r,[e])=>Math.abs(e.evaluate(r))],round:[ya,[ya],(r,[e])=>{const a=e.evaluate(r);return a<0?-Math.round(-a):Math.round(a)}],floor:[ya,[ya],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[ya,[ya],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Mr,[jr,Dr],(r,[e,a])=>r.properties()[e.value]===a.value],"filter-id-==":[Mr,[Dr],(r,[e])=>r.id()===e.value],"filter-type-==":[Mr,[jr],(r,[e])=>r.geometryType()===e.value],"filter-<":[Mr,[jr,Dr],(r,[e,a])=>{const s=r.properties()[e.value],c=a.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Mr,[Dr],(r,[e])=>{const a=r.id(),s=e.value;return typeof a==typeof s&&a<s}],"filter->":[Mr,[jr,Dr],(r,[e,a])=>{const s=r.properties()[e.value],c=a.value;return typeof s==typeof c&&s>c}],"filter-id->":[Mr,[Dr],(r,[e])=>{const a=r.id(),s=e.value;return typeof a==typeof s&&a>s}],"filter-<=":[Mr,[jr,Dr],(r,[e,a])=>{const s=r.properties()[e.value],c=a.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Mr,[Dr],(r,[e])=>{const a=r.id(),s=e.value;return typeof a==typeof s&&a<=s}],"filter->=":[Mr,[jr,Dr],(r,[e,a])=>{const s=r.properties()[e.value],c=a.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Mr,[Dr],(r,[e])=>{const a=r.id(),s=e.value;return typeof a==typeof s&&a>=s}],"filter-has":[Mr,[Dr],(r,[e])=>e.value in r.properties()],"filter-has-id":[Mr,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Mr,[Pi(jr)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Mr,[Pi(Dr)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Mr,[jr,Pi(Dr)],(r,[e,a])=>a.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Mr,[jr,Pi(Dr)],(r,[e,a])=>function(s,c,p,m){for(;p<=m;){const x=p+m>>1;if(c[x]===s)return!0;c[x]>s?m=x-1:p=x+1}return!1}(r.properties()[e.value],a.value,0,a.value.length-1)],all:{type:Mr,overloads:[[[Mr,Mr],(r,[e,a])=>e.evaluate(r)&&a.evaluate(r)],[dl(Mr),(r,e)=>{for(const a of e)if(!a.evaluate(r))return!1;return!0}]]},any:{type:Mr,overloads:[[[Mr,Mr],(r,[e,a])=>e.evaluate(r)||a.evaluate(r)],[dl(Mr),(r,e)=>{for(const a of e)if(a.evaluate(r))return!0;return!1}]]},"!":[Mr,[Mr],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Mr,[jr],(r,[e])=>{const a=r.globals&&r.globals.isSupportedScript;return!a||a(e.evaluate(r))}],upcase:[jr,[jr],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[jr,[jr],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[jr,dl(Dr),(r,e)=>e.map(a=>El(a.evaluate(r))).join("")],"resolved-locale":[jr,[rh],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[ya,[ya,ya,Dr],(r,e)=>{const[a,s,c]=e.map(m=>m.evaluate(r));if(a>s||a===s)return a;let p;if(typeof c=="string")p=function(m){let x=0;if(m.length===0)return x;for(let L=0;L<m.length;L++)x=(x<<5)-x+m.charCodeAt(L),x|=0;return x}(c);else{if(typeof c!="number")throw new Xn(`Invalid seed input: ${c}`);p=c}return a+ao(p)()*(s-a)}]});class bd{constructor(e,a,s,c,p){this.expression=e,this._warningHistory={},this._scope=s,this._options=c,this._iconImageUseTheme=p,this._evaluator=new _i(s,c,p),this._defaultValue=a?function(m){return m.type==="color"&&(Nh(m.default)||Array.isArray(m.default))?new Or(0,0,0,0):m.type==="color"?Or.parse(m.default)||null:m.default===void 0?null:m.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=wd(e),this.isIndoorDependent=Zu(e)}evaluateWithoutErrorHandling(e,a,s,c,p,m,x,L){return this._evaluator.globals=e,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=L||null,this.expression.evaluate(this._evaluator)}evaluate(e,a,s,c,p,m,x,L,N){this._evaluator||(this._evaluator=new _i(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=L||null,this._evaluator.iconImageUseTheme=N||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Xn(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${R.message}`)),this._defaultValue}}}function Ld(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Qn}function Js(r,e,a,s,c){const p=new Fc(Qn,[],e?function(x){const L={color:Ys,string:jr,number:ya,enum:jr,boolean:Mr,formatted:uu,resolvedImage:nh};return x.type==="array"?Pi(L[x.value]||Dr,x.length):L[x.type]}(e):void 0,void 0,void 0,a,s,c),m=p.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Pc(new bd(m,e,a,s,c)):_o(p.errors)}class Zs{constructor(e,a,s,c){this.kind=e,this._styleExpression=a,this.isLightConstant=s,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!gh(a.expression),this.configDependencies=wd(a.expression),this.isIndoorDependent=Zu(a.expression)}evaluateWithoutErrorHandling(e,a,s,c,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,a,s,c,p,m)}evaluate(e,a,s,c,p,m,x){return this._styleExpression.evaluate(e,a,s,c,p,m,void 0,void 0,x)}}class ro{constructor(e,a,s,c,p,m){this.kind=e,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=e!=="camera"&&!gh(a.expression),this.isIndoorDependent=Zu(a.expression),this.isLightConstant=p,this.isLineProgressConstant=m,this.configDependencies=wd(a.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,a,s,c,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,a,s,c,p,m)}evaluate(e,a,s,c,p,m){return this._styleExpression.evaluate(e,a,s,c,p,m)}interpolationFactor(e,a,s){return this.interpolationType?to.interpolationFactor(this.interpolationType,e,a,s):0}}function Sh(r,e,a,s,c){if((r=Js(r,e,a,s,c)).result==="error")return r;const p=r.value.expression,m=xu(p);if(!m&&!ff(e))return _o([new Vo("","data expressions not supported")]);const x=hd(p,["zoom","pitch","distance-from-center"]);if(!x&&!vd(e))return _o([new Vo("","zoom expressions not supported")]);const L=hd(p,["measure-light"]);if(!L&&!Nu(e))return _o([new Vo("","measure-light expression not supported")]);const N=hd(p,["line-progress"]);if(!N&&!function(V){return jh(V.expression,"line-progress")}(e))return _o([new Vo("","line-progress expression not supported")]);const R=e.expression&&e.expression.relaxZoomRestriction,T=ko(p);return T||x||R?T instanceof Vo?_o([T]):T instanceof to&&!Zh(e)?_o([new Vo("",'"interpolate" expressions cannot be used with this property')]):Pc(T?new ro(m&&N?"camera":"composite",r.value,T.labels,T instanceof to?T.interpolation:void 0,L,N):new Zs(m&&N?"constant":"source",r.value,L,N)):_o([new Vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class zh{constructor(e,a){this._parameters=e,this._specification=a,Object.assign(this,Eh(this._parameters,this._specification))}static deserialize(e){return new zh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ko(r){let e=null;if(r instanceof mo)e=ko(r.result);else if(r instanceof yd){for(const a of r.args)if(e=ko(a),e)break}else(r instanceof _h||r instanceof to)&&r.input instanceof ms&&r.input.name==="zoom"&&(e=r);return e instanceof Vo||r.eachChild(a=>{const s=ko(a);s instanceof Vo?e=s:e&&s&&e!==s&&(e=new Vo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Jo,jd,up=function(){if(jd)return Jo;jd=1,Jo=e;var r=3;function e(a,s,c){var p=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var m=new Int32Array(this.arrayBuffer);a=m[0],this.d=(s=m[1])+2*(c=m[2]);for(var x=0;x<this.d*this.d;x++){var L=m[r+x],N=m[r+x+1];p.push(L===N?null:m.subarray(L,N))}var R=m[r+p.length+1];this.keys=m.subarray(m[r+p.length],R),this.bboxes=m.subarray(R),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var T=0;T<this.d*this.d;T++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var V=c/s*a;this.min=-V,this.max=a+V}return e.prototype.insert=function(a,s,c,p,m){this._forEachCell(s,c,p,m,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(a,s,c,p,m,x){this.cells[m].push(x)},e.prototype.query=function(a,s,c,p,m){var x=this.min,L=this.max;if(a<=x&&s<=x&&L<=c&&L<=p&&!m)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(a,s,c,p,this._queryCell,N,{},m),N},e.prototype._queryCell=function(a,s,c,p,m,x,L,N){var R=this.cells[m];if(R!==null)for(var T=this.keys,V=this.bboxes,F=0;F<R.length;F++){var O=R[F];if(L[O]===void 0){var Q=4*O;(N?N(V[Q+0],V[Q+1],V[Q+2],V[Q+3]):a<=V[Q+2]&&s<=V[Q+3]&&c>=V[Q+0]&&p>=V[Q+1])?(L[O]=!0,x.push(T[O])):L[O]=!1}}},e.prototype._forEachCell=function(a,s,c,p,m,x,L,N){for(var R=this._convertToCellCoord(a),T=this._convertToCellCoord(s),V=this._convertToCellCoord(c),F=this._convertToCellCoord(p),O=R;O<=V;O++)for(var Q=T;Q<=F;Q++){var $=this.d*Q+O;if((!N||N(this._convertFromCellCoord(O),this._convertFromCellCoord(Q),this._convertFromCellCoord(O+1),this._convertFromCellCoord(Q+1)))&&m.call(this,a,s,c,p,$,x,L,N))return}},e.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},e.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=r+this.cells.length+1+1,c=0,p=0;p<this.cells.length;p++)c+=this.cells[p].length;var m=new Int32Array(s+c+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=s,L=0;L<a.length;L++){var N=a[L];m[r+L]=x,m.set(N,x),x+=N.length}return m[r+a.length]=x,m.set(this.keys,x),m[r+a.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer},Jo}(),Fs=Yu(up);const wo={};function na(r,e,a={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),wo[e]={klass:r,omit:a.omit||[]}}na(Object,"Object"),Fs.serialize=function(r,e){const a=r.toArrayBuffer();return e&&e.add(a),{buffer:a}},Fs.deserialize=function(r){return new Fs(r.buffer)},Object.defineProperty(Fs,"name",{value:"Grid"}),na(Fs,"Grid"),delete St.prototype.constructor,typeof DOMMatrix<"u"&&na(DOMMatrix,"DOMMatrix"),na(Or,"Color"),na(Error,"Error"),na(Bi,"Formatted"),na(sh,"FormattedSection"),na(nu,"AJAXError"),na(Is,"ResolvedImage"),na(zh,"StylePropertyFunction"),na(bd,"StyleExpression",{omit:["_evaluator"]}),na(xn,"ImageId"),na(Kl,"ImageVariant"),na(ro,"ZoomDependentExpression"),na(Zs,"ZoomConstantExpression"),na(ms,"CompoundExpression",{omit:["_evaluate"]});for(const r in Qn)wo[Qn[r]._classRegistryKey]||na(Qn[r],`Expression${r}`);function yf(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Fo(r){return self.ImageBitmap&&r instanceof ImageBitmap}function lc(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(yf(r)||Fo(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const a=[];for(const s of r)a.push(lc(s,e));return a}if(r instanceof Map){const a={$name:"Map",entries:[]};for(const[s,c]of r.entries())a.entries.push(lc(s),lc(c,e));return a}if(r instanceof Set){const a={$name:"Set"};let s=0;for(const c of r.values())a[++s]=lc(c);return a}if(r instanceof DOMMatrix){const a={$name:"DOMMatrix"},s=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of s)a[c]=r[c];return a}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const a=r.constructor,s=a._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const c=a.serialize?a.serialize(r,e):{};if(!a.serialize){for(const p in r)r.hasOwnProperty(p)&&(wo[s].omit.indexOf(p)>=0||(c[p]=lc(r[p],e)));r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof r)}function Oo(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||yf(r)||Fo(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Oo);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const c=r.entries||[],p=new Map;for(let m=0;m<c.length;m+=2)p.set(Oo(c[m]),Oo(c[m+1]));return p}if(e==="Set"){const c=new Set;for(const p of Object.keys(r))p!=="$name"&&c.add(Oo(r[p]));return c}if(e==="DOMMatrix"){let c;return c=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(r.value);const{klass:a}=wo[e];if(!a)throw new Error(`Can't deserialize unregistered class "${e}".`);if(a.deserialize)return a.deserialize(r);const s=Object.create(a.prototype);for(const c of Object.keys(r))c!=="$name"&&(s[c]=Oo(r[c]));return s}throw new Error("can't deserialize object of type "+typeof r)}const xa={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Eu(r){for(const e of r)if(Nd(e.charCodeAt(0)))return!0;return!1}function Zd(r){for(const e of r)if(!Ml(e.charCodeAt(0)))return!1;return!0}function Ml(r){return!(xa.Arabic(r)||xa["Arabic Supplement"](r)||xa["Arabic Extended-A"](r)||xa["Arabic Presentation Forms-A"](r)||xa["Arabic Presentation Forms-B"](r))}function Nd(r){return!(r!==746&&r!==747&&(r<4352||!(xa["Bopomofo Extended"](r)||xa.Bopomofo(r)||xa["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||xa["CJK Compatibility Ideographs"](r)||xa["CJK Compatibility"](r)||xa["CJK Radicals Supplement"](r)||xa["CJK Strokes"](r)||!(!xa["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||xa["CJK Unified Ideographs Extension A"](r)||xa["CJK Unified Ideographs"](r)||xa["Enclosed CJK Letters and Months"](r)||xa["Hangul Compatibility Jamo"](r)||xa["Hangul Jamo Extended-A"](r)||xa["Hangul Jamo Extended-B"](r)||xa["Hangul Jamo"](r)||xa["Hangul Syllables"](r)||xa.Hiragana(r)||xa["Ideographic Description Characters"](r)||xa.Kanbun(r)||xa["Kangxi Radicals"](r)||xa["Katakana Phonetic Extensions"](r)||xa.Katakana(r)&&r!==12540||!(!xa["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!xa["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||xa["Unified Canadian Aboriginal Syllabics"](r)||xa["Unified Canadian Aboriginal Syllabics Extended"](r)||xa["Vertical Forms"](r)||xa["Yijing Hexagram Symbols"](r)||xa["Yi Syllables"](r)||xa["Yi Radicals"](r))))}function Uc(r){return!(Nd(r)||function(e){return!!(xa["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||xa["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||xa["Letterlike Symbols"](e)||xa["Number Forms"](e)||xa["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||xa["Control Pictures"](e)&&e!==9251||xa["Optical Character Recognition"](e)||xa["Enclosed Alphanumerics"](e)||xa["Geometric Shapes"](e)||xa["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||xa["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||xa["CJK Symbols and Punctuation"](e)||xa.Katakana(e)||xa["Private Use Area"](e)||xa["CJK Compatibility Forms"](e)||xa["Small Form Variants"](e)||xa["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function gf(r){return xa.Arabic(r)||xa["Arabic Supplement"](r)||xa["Arabic Extended-A"](r)||xa["Arabic Presentation Forms-A"](r)||xa["Arabic Presentation Forms-B"](r)}function _f(r){return r>=1424&&r<=2303||xa["Arabic Presentation Forms-A"](r)||xa["Arabic Presentation Forms-B"](r)}function xi(r,e){return!(!e&&_f(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||xa.Khmer(r))}function xf(r){for(const e of r)if(_f(e.charCodeAt(0)))return!0;return!1}const Ns={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Ah=null,Hi=Ns.unavailable,Bl=null;const Wc=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Hi=Ns.error),Ah&&Ah(r)};function fi(){ki.fire(new js("pluginStateChange",{pluginStatus:Hi,pluginURL:Bl}))}const ki=new Nl,Ui=function(){return Hi},Ed=function(){if(Hi!==Ns.deferred||!Bl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Hi=Ns.loading,fi(),Bl&&iu({url:Bl},r=>{r?Wc(r):(Hi=Ns.loaded,fi())})},ns={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Hi===Ns.loaded||ns.applyArabicShaping!=null,isLoading:()=>Hi===Ns.loading,setState(r){Hi=r.pluginStatus,Bl=r.pluginURL},isParsing:()=>Hi===Ns.parsing,isParsed:()=>Hi===Ns.parsed,getPluginURL:()=>Bl};class $r{constructor(e,a){this.zoom=e,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview,this.activeFloors=a.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(a,s){for(const c of a)if(!xi(c.charCodeAt(0),s))return!1;return!0}(e,ns.isLoaded())}}class Rh{constructor(e,a,s,c,p){this.property=e,this.value=a,this.expression=function(m,x,L,N,R){if(Nh(m))return new zh(m,x);if(Ld(m)||Array.isArray(m)&&m.length>0){const T=Sh(m,x,L,N,R);if(T.result==="error")throw new Error(T.value.map(V=>`${V.key}: ${V.message}`).join(", "));return T.value}{let T=m;return typeof m=="string"&&x.type==="color"&&(T=Or.parse(m)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>T}}}(a===void 0?e.specification.default:a,e.specification,s,c,p)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,a,s,c){return this.property.possiblyEvaluate(this,e,a,s,c)}}class Ji{constructor(e,a,s,c){this.property=e,this.value=new Rh(e,void 0,a,s,c)}transitioned(e,a){return new vf(this.property,this.value,a,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new vf(this.property,this.value,null,{},0)}}class wf{constructor(e,a,s,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=a,this._options=s,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return ha(this._values[e].value.value)}setValue(e,a){this._values.hasOwnProperty(e)||(this._values[e]=new Ji(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Rh(this._values[e].property,a===null?void 0:ha(a),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,a){a&&(this._options=a);const s=this._properties.properties;if(e)for(const c in e){const p=e[c];if(c.endsWith("-transition")){const m=c.slice(0,-11);s[m]&&this.setTransition(m,p)}else s.hasOwnProperty(c)&&this.setValue(c,p)}}getTransition(e){return ha(this._values[e].transition)}setTransition(e,a){this._values.hasOwnProperty(e)||(this._values[e]=new Ji(this._values[e].property)),this._values[e].transition=ha(a)||void 0}serialize(){const e={};for(const a of Object.keys(this._values)){const s=this.getValue(a);s!==void 0&&(e[a]=s);const c=this.getTransition(a);c!==void 0&&(e[`${a}-transition`]=c)}return e}transitioned(e,a){const s=new hl(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,a._values[c]);return s}untransitioned(){const e=new hl(this._properties);for(const a of Object.keys(this._values))e._values[a]=this._values[a].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class vf{constructor(e,a,s,c,p){const m=c.delay||0,x=c.duration||0;p=p||0,this.property=e,this.value=a,this.begin=p+m,this.end=this.begin+x,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,a,s){const c=e.now||0,p=this.value.possiblyEvaluate(e,a,s),m=this.prior;if(m){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return m.possiblyEvaluate(e,a,s);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,a,s),p,Lc(x))}}return p}}class hl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,a,s){const c=new fl(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,a,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Do{constructor(e,a,s,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=a,this._options=s,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return ha(this._values[e].value)}setValue(e,a){this._values[e]=new Rh(this._values[e].property,a===null?void 0:ha(a),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const a of Object.keys(this._values)){const s=this.getValue(a);s!==void 0&&(e[a]=s)}return e}possiblyEvaluate(e,a,s,c){const p=new fl(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(e,a,s,c);return p}isIndoorDependent(){return this._isIndoorDependent}}class wi{constructor(e,a,s,c){this.property=e,this.value=a,this.parameters=s,this.iconImageUseTheme=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,a,s,c){return this.property.evaluate(this.value,this.parameters,e,a,s,c,this.iconImageUseTheme)}}class fl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,a){return e.expression.evaluate(a)}interpolate(e,a,s){const c=ql[this.specification.type];return c?c(e,a,s):e}}class Kt{constructor(e,a){this.specification=e,this.overrides=a}possiblyEvaluate(e,a,s,c,p){return e.expression.kind==="constant"||e.expression.kind==="camera"?new wi(this,{kind:"constant",value:e.expression.evaluate(a,null,{},s,c,void 0,p)},a):new wi(this,e.expression,a,p)}interpolate(e,a,s){if(e.value.kind!=="constant"||a.value.kind!=="constant")return e;if(e.value.value===void 0||a.value.value===void 0)return new wi(this,{kind:"constant",value:void 0},e.parameters);const c=ql[this.specification.type];return c?new wi(this,{kind:"constant",value:c(e.value.value,a.value.value,s)},e.parameters):e}evaluate(e,a,s,c,p,m,x){return e.kind==="constant"?e.value:e.evaluate(a,s,c,p,m,void 0,x)}}class Su{constructor(e){this.specification=e}possiblyEvaluate(e,a,s,c){return!!e.expression.evaluate(a,null,{},s,c)}interpolate(){return!1}}class Mn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new $r(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new Rh(c,void 0),m=this.defaultTransitionablePropertyValues[s]=new Ji(c);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(a)}}}na(Kt,"DataDrivenProperty"),na(Tt,"DataConstantProperty"),na(Su,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function bf(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function zu(r){if(Array.isArray(r))return r.map(zu);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const a in r)e[a]=zu(r[a]);return e}return bf(r)}function Au(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Au(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Th(r,e="",a=null,s="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Au(r)||(r=Os(r));const c=r;let p=!0;try{p=function(R){if(!Ru(R))return R;let T=zu(R);return Il(T),T=Vh(T),T}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let m=null,x=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){x=Ue[`filter_${s}`];const R=Js(p,x,e,a);if(R.result==="error")throw new Error(R.value.map(T=>`${T.key}: ${T.message}`).join(", "));m=(T,V,F)=>R.value.evaluate(T,V,{},F)}let L=null,N=null;if(p!==c){const R=Js(c,x,e,a);if(R.result==="error")throw new Error(R.value.map(T=>`${T.key}: ${T.message}`).join(", "));L=(T,V,F,O,Q)=>R.value.evaluate(T,V,{},F,void 0,void 0,O,Q),N=!xu(R.value.expression)}return{filter:m,dynamicFilter:L||void 0,needGeometry:dp(p),needFeature:!!N}}function Vh(r){if(!Array.isArray(r))return r;const e=function(a){if(Lf.has(a[0])){for(let s=1;s<a.length;s++)if(Ru(a[s]))return!0}return a}(r);return e===!0?e:e.map(a=>Vh(a))}function Il(r){let e=!1;const a=[];if(r[0]==="case"){for(let s=1;s<r.length-1;s+=2)e=e||Ru(r[s]),a.push(r[s+1]);a.push(r[r.length-1])}else if(r[0]==="match"){e=e||Ru(r[1]);for(let s=2;s<r.length-1;s+=2)a.push(r[s+1]);a.push(r[r.length-1])}else if(r[0]==="step"){e=e||Ru(r[1]);for(let s=1;s<r.length-1;s+=2)a.push(r[s+1])}e&&(r.length=0,r.push("any",...a));for(let s=1;s<r.length;s++)Il(r[s])}function Ru(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let a=1;a<r.length;a++)if(Ru(r[a]))return!0;return!1}const Lf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Mh(r,e){return r<e?-1:r>e?1:0}function dp(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(dp(r[e]))return!0;return!1}function Os(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?jf(r[1],r[2],"=="):e==="!="?Bh(jf(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?jf(r[1],r[2],e):e==="any"?(a=r.slice(1),["any"].concat(a.map(Os))):e==="all"?["all"].concat(r.slice(1).map(Os)):e==="none"?["all"].concat(r.slice(1).map(Os).map(Bh)):e==="in"?Zf(r[1],r.slice(2)):e==="!in"?Bh(Zf(r[1],r.slice(2))):e==="has"?hp(r[1]):e!=="!has"||Bh(hp(r[1]));var a}function jf(r,e,a){switch(r){case"$type":return[`filter-type-${a}`,e];case"$id":return[`filter-id-${a}`,e];default:return[`filter-${a}`,r,e]}}function Zf(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(a=>typeof a!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Mh)]]:["filter-in-small",r,["literal",e]]}}function hp(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Bh(r){return["!",r]}const Tu="";function Xc(r,e){return e?`${r}${Tu}${e}`:r}let fp;const pp=()=>fp||(fp=new Mn({"icon-size":new Kt(Ue.layout_symbol["icon-size"]),"icon-image":new Kt(Ue.layout_symbol["icon-image"]),"icon-rotate":new Kt(Ue.layout_symbol["icon-rotate"]),"icon-offset":new Kt(Ue.layout_symbol["icon-offset"])}));class fy{constructor(e,a,s,c,p,m){this.cachedIconPrimary=null;const x=Js(e,Ue.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=a,s){this.properties=new fl(pp()),this.unevaluatedLayout=new Do(pp(),c,p,m);for(const L in s)this.unevaluatedLayout.setValue(L,s[L])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,a,s){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,a,s))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const mp="-transition",py=new Set(["fill","line","background","hillshade","raster"]);class gs extends Nl{constructor(e,a,s,c,p,m){if(super(),this.id=e.id,this.fqid=Xc(this.id,s),this.type=e.type,this.scope=s,this.lut=c,this.options=p,this.iconImageUseTheme=m,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=Js(this.filter,Ue[`filter_${e.type}`]);x.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...x.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||x.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),a.layout&&(this._unevaluatedLayout=new Do(a.layout,this.scope,p,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),a.paint){this._transitionablePaint=new wf(a.paint,this.scope,p);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fl(a.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&py.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,a){if(this.type==="custom"&&e==="visibility")return void(this.visibility=a);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(a=>{this.appearances.push(new fy(a.condition,a.name,a.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(mp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,a){const s=this._transitionablePaint,c=s._properties.properties;if(e.endsWith(mp)){const T=e.slice(0,-11);return c[T]&&s.setTransition(T,a||void 0),!1}if(!c[e])return!1;const p=s._values[e],m=p.value.isDataDriven(),x=p.value;s.setValue(e,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const L=s._values[e].value,N=L.isDataDriven(),R=e.endsWith("pattern")||e==="line-dasharray";return N||m||R||this._handleOverridablePaintPropertyUpdate(e,x,L)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,a,s){return null}_handleOverridablePaintPropertyUpdate(e,a,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,a)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(a=>a.serialize())),Nt(e,(a,s)=>!(a===void 0||s==="layout"&&!Object.keys(a).length||s==="paint"&&!Object.keys(a).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const a=this.paint.get(e);if(a instanceof wi&&ff(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}for(const e of this.appearances)if(!gh(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Th(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,a,s){return{}}queryRadius(e){}queryIntersectsFeature(e,a,s,c,p,m,x,L,N){}}const cm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sd{constructor(e,a){this._structArray=e,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,a){return e._trim(),a&&a.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const a=Object.create(this.prototype);return a.arrayBuffer=e.arrayBuffer,a.length=e.length,a.capacity=e.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function tr(r,e=1){let a=0,s=0;return{members:r.map(c=>{const p=cm[c.type].BYTES_PER_ELEMENT,m=a=yp(a,Math.max(e,p)),x=c.components||1;return s=Math.max(s,p),a+=p*x,{name:c.name,type:c.type,components:x,offset:m}}),size:yp(a,Math.max(s,e)),alignment:e}}function yp(r,e){return Math.ceil(r/e)*e}class Ds extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,a)}emplace(e,a,s){const c=2*e;return this.int16[c+0]=a,this.int16[c+1]=s,e}}Ds.prototype.bytesPerElement=4,na(Ds,"StructArrayLayout2i4");class Vu extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,a,s)}emplace(e,a,s,c){const p=3*e;return this.int16[p+0]=a,this.int16[p+1]=s,this.int16[p+2]=c,e}}Vu.prototype.bytesPerElement=6,na(Vu,"StructArrayLayout3i6");class Es extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,a,s,c)}emplace(e,a,s,c,p){const m=4*e;return this.int16[m+0]=a,this.int16[m+1]=s,this.int16[m+2]=c,this.int16[m+3]=p,e}}Es.prototype.bytesPerElement=8,na(Es,"StructArrayLayout4i8");class pl extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.float32[1*e+0]=a,e}}pl.prototype.bytesPerElement=4,na(pl,"StructArrayLayout1f4");class zd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,a,s)}emplace(e,a,s,c){const p=4*e,m=2*e;return this.int16[p+0]=a,this.int16[p+1]=s,this.float32[m+1]=c,e}}zd.prototype.bytesPerElement=8,na(zd,"StructArrayLayout2i1f8");class Nf extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,a,s)}emplace(e,a,s,c){const p=4*e;return this.int16[p+0]=a,this.int16[p+1]=s,this.int16[p+2]=c,e}}Nf.prototype.bytesPerElement=8,na(Nf,"StructArrayLayout3i8");class Ih extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,a,s,c,p)}emplace(e,a,s,c,p,m){const x=5*e;return this.int16[x+0]=a,this.int16[x+1]=s,this.int16[x+2]=c,this.int16[x+3]=p,this.int16[x+4]=m,e}}Ih.prototype.bytesPerElement=10,na(Ih,"StructArrayLayout5i10");class kh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x){const L=this.length;return this.resize(L+1),this.emplace(L,e,a,s,c,p,m,x)}emplace(e,a,s,c,p,m,x,L){const N=6*e,R=12*e,T=3*e;return this.int16[N+0]=a,this.int16[N+1]=s,this.uint8[R+4]=c,this.uint8[R+5]=p,this.uint8[R+6]=m,this.uint8[R+7]=x,this.float32[T+2]=L,e}}kh.prototype.bytesPerElement=12,na(kh,"StructArrayLayout2i4ub1f12");class Cs extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,a,s)}emplace(e,a,s,c){const p=3*e;return this.float32[p+0]=a,this.float32[p+1]=s,this.float32[p+2]=c,e}}Cs.prototype.bytesPerElement=12,na(Cs,"StructArrayLayout3f12");class vo extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,a,s,c,p)}emplace(e,a,s,c,p,m){const x=6*e,L=3*e;return this.uint16[x+0]=a,this.uint16[x+1]=s,this.uint16[x+2]=c,this.uint16[x+3]=p,this.float32[L+2]=m,e}}vo.prototype.bytesPerElement=12,na(vo,"StructArrayLayout4ui1f12");class cc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,a,s,c)}emplace(e,a,s,c,p){const m=4*e;return this.uint16[m+0]=a,this.uint16[m+1]=s,this.uint16[m+2]=c,this.uint16[m+3]=p,e}}cc.prototype.bytesPerElement=8,na(cc,"StructArrayLayout4ui8");class Ad extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,a,s,c,p,m)}emplace(e,a,s,c,p,m,x){const L=6*e;return this.int16[L+0]=a,this.int16[L+1]=s,this.int16[L+2]=c,this.int16[L+3]=p,this.int16[L+4]=m,this.int16[L+5]=x,e}}Ad.prototype.bytesPerElement=12,na(Ad,"StructArrayLayout6i12");class Ef extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x,L,N,R,T,V){const F=this.length;return this.resize(F+1),this.emplace(F,e,a,s,c,p,m,x,L,N,R,T,V)}emplace(e,a,s,c,p,m,x,L,N,R,T,V,F){const O=12*e;return this.int16[O+0]=a,this.int16[O+1]=s,this.int16[O+2]=c,this.int16[O+3]=p,this.uint16[O+4]=m,this.uint16[O+5]=x,this.uint16[O+6]=L,this.uint16[O+7]=N,this.int16[O+8]=R,this.int16[O+9]=T,this.int16[O+10]=V,this.int16[O+11]=F,e}}Ef.prototype.bytesPerElement=24,na(Ef,"StructArrayLayout4i4ui4i24");class Mu extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,a,s,c,p,m)}emplace(e,a,s,c,p,m,x){const L=10*e,N=5*e;return this.int16[L+0]=a,this.int16[L+1]=s,this.int16[L+2]=c,this.float32[N+2]=p,this.float32[N+3]=m,this.float32[N+4]=x,e}}Mu.prototype.bytesPerElement=20,na(Mu,"StructArrayLayout3i3f20");class uc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,a,s,c)}emplace(e,a,s,c,p){const m=4*e;return this.float32[m+0]=a,this.float32[m+1]=s,this.float32[m+2]=c,this.float32[m+3]=p,e}}uc.prototype.bytesPerElement=16,na(uc,"StructArrayLayout4f16");class Sf extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.uint32[1*e+0]=a,e}}Sf.prototype.bytesPerElement=4,na(Sf,"StructArrayLayout1ul4");class bo extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,a)}emplace(e,a,s){const c=2*e;return this.uint16[c+0]=a,this.uint16[c+1]=s,e}}bo.prototype.bytesPerElement=4,na(bo,"StructArrayLayout2ui4");class zf extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x,L,N,R,T,V,F){const O=this.length;return this.resize(O+1),this.emplace(O,e,a,s,c,p,m,x,L,N,R,T,V,F)}emplace(e,a,s,c,p,m,x,L,N,R,T,V,F,O){const Q=20*e,$=10*e;return this.int16[Q+0]=a,this.int16[Q+1]=s,this.int16[Q+2]=c,this.int16[Q+3]=p,this.int16[Q+4]=m,this.float32[$+3]=x,this.float32[$+4]=L,this.float32[$+5]=N,this.float32[$+6]=R,this.int16[Q+14]=T,this.uint32[$+8]=V,this.uint16[Q+18]=F,this.uint16[Q+19]=O,e}}zf.prototype.bytesPerElement=40,na(zf,"StructArrayLayout5i4f1i1ul2ui40");class Af extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x){const L=this.length;return this.resize(L+1),this.emplace(L,e,a,s,c,p,m,x)}emplace(e,a,s,c,p,m,x,L){const N=8*e;return this.int16[N+0]=a,this.int16[N+1]=s,this.int16[N+2]=c,this.int16[N+4]=p,this.int16[N+5]=m,this.int16[N+6]=x,this.int16[N+7]=L,e}}Af.prototype.bytesPerElement=16,na(Af,"StructArrayLayout3i2i2i16");class Yi extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,a,s,c,p)}emplace(e,a,s,c,p,m){const x=4*e,L=8*e;return this.float32[x+0]=a,this.float32[x+1]=s,this.float32[x+2]=c,this.int16[L+6]=p,this.int16[L+7]=m,e}}Yi.prototype.bytesPerElement=16,na(Yi,"StructArrayLayout2f1f2i16");class Wi extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,a,s,c,p,m)}emplace(e,a,s,c,p,m,x){const L=20*e,N=5*e;return this.uint8[L+0]=a,this.uint8[L+1]=s,this.float32[N+1]=c,this.float32[N+2]=p,this.float32[N+3]=m,this.float32[N+4]=x,e}}Wi.prototype.bytesPerElement=20,na(Wi,"StructArrayLayout2ub4f20");class gn extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,a,s)}emplace(e,a,s,c){const p=3*e;return this.uint16[p+0]=a,this.uint16[p+1]=s,this.uint16[p+2]=c,e}}gn.prototype.bytesPerElement=6,na(gn,"StructArrayLayout3ui6");class Bu extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie,le,de,Ee){const Le=this.length;return this.resize(Le+1),this.emplace(Le,e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie,le,de,Ee)}emplace(e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie,le,de,Ee,Le){const Ae=30*e,Me=15*e,Je=60*e;return this.int16[Ae+0]=a,this.int16[Ae+1]=s,this.int16[Ae+2]=c,this.float32[Me+2]=p,this.float32[Me+3]=m,this.uint16[Ae+8]=x,this.uint16[Ae+9]=L,this.uint32[Me+5]=N,this.uint32[Me+6]=R,this.uint32[Me+7]=T,this.uint16[Ae+16]=V,this.uint16[Ae+17]=F,this.uint16[Ae+18]=O,this.float32[Me+10]=Q,this.float32[Me+11]=$,this.uint8[Je+48]=K,this.uint8[Je+49]=ie,this.uint8[Je+50]=le,this.uint32[Me+13]=de,this.int16[Ae+28]=Ee,this.uint8[Je+58]=Le,e}}Bu.prototype.bytesPerElement=60,na(Bu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Rf extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie,le,de,Ee,Le,Ae,Me,Je,ot,We,ut,_t,Zt,Pt,At,xt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie,le,de,Ee,Le,Ae,Me,Je,ot,We,ut,_t,Zt,Pt,At,xt)}emplace(e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie,le,de,Ee,Le,Ae,Me,Je,ot,We,ut,_t,Zt,Pt,At,xt,zt){const nt=20*e,rt=40*e,Et=80*e;return this.float32[nt+0]=a,this.float32[nt+1]=s,this.int16[rt+4]=c,this.int16[rt+5]=p,this.int16[rt+6]=m,this.int16[rt+7]=x,this.int16[rt+8]=L,this.int16[rt+9]=N,this.int16[rt+10]=R,this.int16[rt+11]=T,this.int16[rt+12]=V,this.uint16[rt+13]=F,this.uint16[rt+14]=O,this.uint16[rt+15]=Q,this.uint16[rt+16]=$,this.uint16[rt+17]=K,this.uint16[rt+18]=ie,this.uint16[rt+19]=le,this.uint16[rt+20]=de,this.uint16[rt+21]=Ee,this.uint16[rt+22]=Le,this.uint16[rt+23]=Ae,this.uint16[rt+24]=Me,this.uint16[rt+25]=Je,this.uint16[rt+26]=ot,this.uint16[rt+27]=We,this.uint32[nt+14]=ut,this.float32[nt+15]=_t,this.float32[nt+16]=Zt,this.float32[nt+17]=Pt,this.float32[nt+18]=At,this.uint8[Et+76]=xt,this.uint16[rt+39]=zt,e}}Rf.prototype.bytesPerElement=80,na(Rf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Tf extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,a,s,c,p,m)}emplace(e,a,s,c,p,m,x){const L=6*e;return this.float32[L+0]=a,this.float32[L+1]=s,this.float32[L+2]=c,this.float32[L+3]=p,this.float32[L+4]=m,this.float32[L+5]=x,e}}Tf.prototype.bytesPerElement=24,na(Tf,"StructArrayLayout6f24");class Qc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,a,s,c,p)}emplace(e,a,s,c,p,m){const x=5*e;return this.float32[x+0]=a,this.float32[x+1]=s,this.float32[x+2]=c,this.float32[x+3]=p,this.float32[x+4]=m,e}}Qc.prototype.bytesPerElement=20,na(Qc,"StructArrayLayout5f20");class Jh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x){const L=this.length;return this.resize(L+1),this.emplace(L,e,a,s,c,p,m,x)}emplace(e,a,s,c,p,m,x,L){const N=7*e;return this.float32[N+0]=a,this.float32[N+1]=s,this.float32[N+2]=c,this.float32[N+3]=p,this.float32[N+4]=m,this.float32[N+5]=x,this.float32[N+6]=L,e}}Jh.prototype.bytesPerElement=28,na(Jh,"StructArrayLayout7f28");class Rd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x,L,N,R,T){const V=this.length;return this.resize(V+1),this.emplace(V,e,a,s,c,p,m,x,L,N,R,T)}emplace(e,a,s,c,p,m,x,L,N,R,T,V){const F=11*e;return this.float32[F+0]=a,this.float32[F+1]=s,this.float32[F+2]=c,this.float32[F+3]=p,this.float32[F+4]=m,this.float32[F+5]=x,this.float32[F+6]=L,this.float32[F+7]=N,this.float32[F+8]=R,this.float32[F+9]=T,this.float32[F+10]=V,e}}Rd.prototype.bytesPerElement=44,na(Rd,"StructArrayLayout11f44");class Fh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x,L,N){const R=this.length;return this.resize(R+1),this.emplace(R,e,a,s,c,p,m,x,L,N)}emplace(e,a,s,c,p,m,x,L,N,R){const T=9*e;return this.float32[T+0]=a,this.float32[T+1]=s,this.float32[T+2]=c,this.float32[T+3]=p,this.float32[T+4]=m,this.float32[T+5]=x,this.float32[T+6]=L,this.float32[T+7]=N,this.float32[T+8]=R,e}}Fh.prototype.bytesPerElement=36,na(Fh,"StructArrayLayout9f36");class dc extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,a)}emplace(e,a,s){const c=2*e;return this.float32[c+0]=a,this.float32[c+1]=s,e}}dc.prototype.bytesPerElement=8,na(dc,"StructArrayLayout2f8");class Vf extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,a,s,c)}emplace(e,a,s,c,p){const m=6*e;return this.uint32[3*e+0]=a,this.uint16[m+2]=s,this.uint16[m+3]=c,this.uint16[m+4]=p,e}}Vf.prototype.bytesPerElement=12,na(Vf,"StructArrayLayout1ul3ui12");class Td extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.uint16[1*e+0]=a,e}}Td.prototype.bytesPerElement=2,na(Td,"StructArrayLayout1ui2");class Vd extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$){const K=this.length;return this.resize(K+1),this.emplace(K,e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$)}emplace(e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K){const ie=16*e;return this.float32[ie+0]=a,this.float32[ie+1]=s,this.float32[ie+2]=c,this.float32[ie+3]=p,this.float32[ie+4]=m,this.float32[ie+5]=x,this.float32[ie+6]=L,this.float32[ie+7]=N,this.float32[ie+8]=R,this.float32[ie+9]=T,this.float32[ie+10]=V,this.float32[ie+11]=F,this.float32[ie+12]=O,this.float32[ie+13]=Q,this.float32[ie+14]=$,this.float32[ie+15]=K,e}}Vd.prototype.bytesPerElement=64,na(Vd,"StructArrayLayout16f64");class Iu extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,s,c,p,m,x){const L=this.length;return this.resize(L+1),this.emplace(L,e,a,s,c,p,m,x)}emplace(e,a,s,c,p,m,x,L){const N=10*e,R=5*e;return this.uint16[N+0]=a,this.uint16[N+1]=s,this.uint16[N+2]=c,this.uint16[N+3]=p,this.float32[R+2]=m,this.float32[R+3]=x,this.float32[R+4]=L,e}}Iu.prototype.bytesPerElement=20,na(Iu,"StructArrayLayout4ui3f20");class Oh extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.int16[1*e+0]=a,e}}Oh.prototype.bytesPerElement=2,na(Oh,"StructArrayLayout1i2");class ku extends dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.uint8[1*e+0]=a,e}}ku.prototype.bytesPerElement=1,na(ku,"StructArrayLayout1ub1");class gp extends Sd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gp.prototype.size=40;class _p extends zf{get(e){return new gp(this,e)}}na(_p,"CollisionBoxArray");class Md extends Sd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Md.prototype.size=60;class Bd extends Bu{get(e){return new Md(this,e)}}na(Bd,"PlacedSymbolArray");class Id extends Sd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Id.prototype.size=80;class kl extends Rf{get(e){return new Id(this,e)}}na(kl,"SymbolInstanceArray");class xp extends pl{getoffsetX(e){return this.float32[1*e+0]}}na(xp,"GlyphOffsetArray");class wp extends Ds{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}na(wp,"SymbolLineVertexArray");class kd extends Sd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kd.prototype.size=12;class vp extends Vf{get(e){return new kd(this,e)}}na(vp,"FeatureIndexArray");class bp extends bo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}na(bp,"FillExtrusionCentroidArray");class Jd extends Sd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Jd.prototype.size=6;class _s extends Vu{get(e){return new Jd(this,e)}}na(_s,"FillExtrusionWallArray");const um=tr([{name:"a_pos",components:2,type:"Int16"}],4),my=tr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Mf=tr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ar{constructor(e=[]){this.segments=e}_prepareSegment(e,a,s,c){let p=this.segments[this.segments.length-1];return e>Ar.MAX_VERTEX_ARRAY_LENGTH&&Za(`Max vertices per segment is ${Ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Ar.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c)&&(p={vertexOffset:a,primitiveOffset:s,vertexLength:0,primitiveLength:0},c!==void 0&&(p.sortKey=c),this.segments.push(p)),p}prepareSegment(e,a,s,c){return this._prepareSegment(e,a.length,s.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const a in e.vaos)e.vaos[a].destroy()}static simpleSegment(e,a,s,c){return new Ar([{vertexOffset:e,primitiveOffset:a,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function dm(r,e){return 256*(r=re(Math.floor(r),0,255))+re(Math.floor(e),0,255)}Ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,na(Ar,"SegmentVector");const qa=tr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Fd=tr([{name:"a_pattern_b",components:4,type:"Uint16"}]),Lp=tr([{name:"a_dash",components:4,type:"Uint16"}]);class Od{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,a,s,c){this.ids.push(Dh(e)),this.positions.push(a,s,c)}eachPosition(e,a){const s=Dh(e);let c=0,p=this.ids.length-1;for(;c<p;){const m=c+p>>1;this.ids[m]>=s?p=m:c=m+1}for(;this.ids[c]===s;)a(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,a){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Ju(s,c,0,s.length-1),a&&(a.add(s.buffer),a.add(c.buffer)),{ids:s,positions:c}}static deserialize(e){const a=new Od;let s;a.ids=e.ids,a.positions=e.positions;for(const c of a.ids)c!==s&&a.uniqueIds.push(c),s=c;return a.indexed=!0,a}}function Dh(r){const e=+r;return Number.isSafeInteger(e)?e:lu(String(r))}function Ju(r,e,a,s){for(;a<s;){const c=r[a+s>>1];let p=a-1,m=s+1;for(;;){do p++;while(r[p]<c);do m--;while(r[m]>c);if(p>=m)break;Fu(r,p,m),Fu(e,3*p,3*m),Fu(e,3*p+1,3*m+1),Fu(e,3*p+2,3*m+2)}m-a<s-m?(Ju(r,e,a,m),a=m+1):(Ju(r,e,m+1,s),s=m)}}function Fu(r,e,a){const s=r[e];r[e]=r[a],r[a]=s}na(Od,"FeaturePositionMap");class no{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,a),this.initialized=!0),!!this.location}set(e,a,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ch extends no{constructor(e){super(e),this.current=0}set(e,a,s){this.fetchUniformLocation(e,a)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class qn extends no{constructor(e){super(e),this.current=0}set(e,a,s){this.fetchUniformLocation(e,a)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ml extends no{constructor(e){super(e),this.current=[0,0]}set(e,a,s){this.fetchUniformLocation(e,a)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Hc extends no{constructor(e){super(e),this.current=[0,0,0]}set(e,a,s){this.fetchUniformLocation(e,a)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Ou extends no{constructor(e){super(e),this.current=[0,0,0,0]}set(e,a,s){this.fetchUniformLocation(e,a)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class $i extends no{constructor(e){super(e),this.current=Or.transparent.toPremultipliedRenderColor(null)}set(e,a,s){this.fetchUniformLocation(e,a)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Co=new Float32Array(16);class Po extends no{constructor(e){super(e),this.current=Co}set(e,a,s){if(this.fetchUniformLocation(e,a)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const hm=new Float32Array(9),jp=new Float32Array(4);class Lo extends no{constructor(e){super(e),this.current=jp}set(e,a,s){if(this.fetchUniformLocation(e,a)){for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Bf(r){return[dm(255*r.r,255*r.g),dm(255*r.b,255*r.a)]}function jo(r,e,a,s,c,p,m,x){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new $r(0,{brightness:p,worldview:x}),e,a,c,s,m)==="none":r.value==="none")}class If{constructor(e,a,s,c){this.value=e,this.uniformNames=a.map(p=>`u_${p}`),this.type=s,this.context=c}setUniform(e,a,s,c,p){const m=c.constantOr(this.value);a.set(e,p,m instanceof Or?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,a){return this.type==="color"?new $i(e):new qn(e)}}class Dd{constructor(e,a){this.uniformNames=a.map(s=>`u_${s}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,a){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(e,a,s,c,p){let m=null;p!=="u_pattern"&&p!=="u_dash"||(m=this.pattern),p==="u_pattern_b"&&(m=this.patternTransition),p==="u_pixel_ratio"&&(m=this.pixelRatio),m&&a.set(e,p,m)}getBinding(e,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new Ou(e):new qn(e)}}class Jl{constructor(e,a,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,a,s,c,p,m,x,L){const N=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new $r(0,{brightness:m,worldview:L}),a,{},p,c,x):this.expression.kind==="constant"&&this.expression.value,T=jo(this.lutExpression,a,{},c,p,m,x,L);this.paintVertexArray.resize(e),this._setPaintValue(N,e,R,T?null:this.context.lut)}updatePaintArray(e,a,s,c,p,m,x,L){const N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:L},s,c,void 0,p):this.expression.kind==="constant"&&this.expression.value,R=jo(this.lutExpression,s,c,p,void 0,x,void 0,L);this._setPaintValue(e,a,N,R?null:this.context.lut)}_setPaintValue(e,a,s,c){if(this.type==="color"){const p=Bf(s.toPremultipliedRenderColor(c));for(let m=e;m<a;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<a;p++)this.paintVertexArray.emplace(p,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Go{constructor(e,a,s,c,p,m){this.expression=e,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=s,this.useIntegerZoom=c,this.context=p,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,a,s,c,p,m,x,L){const N=this.expression.evaluate(new $r(this.context.zoom,{brightness:m,worldview:L}),a,{},p,c,x),R=this.expression.evaluate(new $r(this.context.zoom+1,{brightness:m,worldview:L}),a,{},p,c,x),T=jo(this.lutExpression,a,{},c,p,m,x,L),V=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(V,e,N,R,T?null:this.context.lut)}updatePaintArray(e,a,s,c,p,m,x,L){const N=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:L},s,c,void 0,p),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:L},s,c,void 0,p),T=jo(this.lutExpression,s,c,p,void 0,x,void 0,L);this._setPaintValue(e,a,N,R,T?null:this.context.lut)}_setPaintValue(e,a,s,c,p){if(this.type==="color"){const m=Bf(s.toPremultipliedRenderColor(p)),x=Bf(s.toPremultipliedRenderColor(p));for(let L=e;L<a;L++)this.paintVertexArray.emplace(L,m[0],m[1],x[0],x[1])}else{for(let m=e;m<a;m++)this.paintVertexArray.emplace(m,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,a,s,c,p){const m=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,x=re(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);a.set(e,p,x)}getBinding(e,a){return new qn(e)}}class qi{constructor(e,a,s,c,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(s==="array"?Lp:qa).members;for(let m=0;m<a.length;++m);this.paintVertexArray=new c,this.paintTransitionVertexArray=new cc}populatePaintArray(e,a,s,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,a.patterns&&a.patterns[this.layerId],s)}updatePaintArray(e,a,s,c,p,m,x){this._setPaintValues(e,a,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,a,s,c){if(!c||!s)return;const p=c[s[0]],m=c[s[1]];if(p){if(p){const{tl:x,br:L,pixelRatio:N}=p;for(let R=e;R<a;R++)this.paintVertexArray.emplace(R,x[0],x[1],L[0],L[1],N)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:L}=m;for(let N=e;N<a;N++)this.paintTransitionVertexArray.emplace(N,x[0],x[1],L[0],L[1])}}}upload(e){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Fd.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class hc{constructor(e,a,s=()=>!0){this.binders={},this._buffers=[],this.context=a;const c=[];for(const p in e.paint._values){const m=e.paint.get(p);if(p.endsWith("-use-theme")||!s(p)||!(m instanceof wi&&ff(m.property.specification)))continue;const x=Uo(p,e.type),L=m.value,N=m.property.specification.type,R=!!m.property.useIntegerZoom,T=p==="line-dasharray"||p.endsWith("pattern"),V=e.paint.get(`${p}-use-theme`),F=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||V&&V.value.kind!=="constant";if(L.kind!=="constant"||F)if(L.kind==="source"||F||T){const O=Ei(p,N,"source");this.binders[p]=T?new qi(L,x,N,O,e.id):new Jl(L,x,N,O),c.push(`/a_${p}`)}else{const O=Ei(p,N,"composite");this.binders[p]=new Go(L,x,N,R,a,O),c.push(`/z_${p}`)}else this.binders[p]=T?new Dd(L.value,x):new If(L.value,x,N,a),c.push(`/u_${p}`);V&&(this.binders[p].lutExpression=V.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const a=this.binders[e];return a instanceof Jl||a instanceof Go?a.maxValue:0}populatePaintArrays(e,a,s,c,p,m,x,L){for(const N in this.binders){const R=this.binders[N];R.context=this.context,(R instanceof Jl||R instanceof Go||R instanceof qi)&&R.populatePaintArray(e,a,s,c,p,m,x,L)}}setConstantPatternPositions(e,a){for(const s in this.binders){const c=this.binders[s];c instanceof Dd&&c.setConstantPatternPositions(e,a)}}getPatternTransitionVertexBuffer(e){const a=this.binders[e];return a instanceof qi?a.paintTransitionVertexBuffer:null}updatePaintArrays(e,a,s,c,p,m,x,L,N,R){let T=!1;const V=Object.keys(e),F=V.length!==0&&!L,O=F?V:a.uniqueIds;this.context.lut=p.lut;for(const Q in this.binders){const $=this.binders[Q];if($.context=this.context,($ instanceof Jl||$ instanceof Go||$ instanceof qi)&&$.expression&&$.expression.kind&&$.expression.kind!=="constant"&&($.expression.isStateDependent===!0||$.expression.isLightConstant===!1)){const K=p.paint.get(Q);$.expression=K.value;for(const ie of O){const le=e[ie.toString()];a.eachPosition(ie,(de,Ee,Le)=>{const Ae=c.feature(de);$.updatePaintArray(Ee,Le,Ae,le,m,x,N,R)})}if(!F)for(const ie of s.uniqueIds){const le=e[ie.toString()];s.eachPosition(ie,(de,Ee,Le)=>{const Ae=c.feature(de);$.updatePaintArray(Ee,Le,Ae,le,m,x,N,R)})}T=!0}}return T}defines(){const e=[];for(const a in this.binders){const s=this.binders[a];(s instanceof If||s instanceof Dd)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const a=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof If||c instanceof Dd||c instanceof Go)for(const p of c.uniformNames)a.push({name:p,property:s,binding:c.getBinding(e,p)})}return a}setUniforms(e,a,s,c,p){for(const{name:m,property:x,binding:L}of s)this.binders[x].setUniform(e,L,p,c.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const a=this.binders[e];(a instanceof Jl||a instanceof Go||a instanceof qi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof qi&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(e){for(const a in this.binders){const s=this.binders[a];(s instanceof Jl||s instanceof Go||s instanceof qi)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const a=this.binders[e];(a instanceof Jl||a instanceof Go||a instanceof qi)&&a.destroy()}}}class io{constructor(e,a,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new hc(c,a,s);this.needsUpload=!1,this._featureMap=new Od,this._featureMapWithoutIds=new Od,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,a,s,c,p,m,x,L,N){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(e,a,c,p,m,x,L,N);a.id!==void 0?this._featureMap.add(a.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,a,s,c,p,m,x,L){for(const N of s)this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,a,N,c,p,m,x||0,L)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Zp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Uo(r,e){return Zp[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const An={"line-pattern":{source:vo,composite:vo},"fill-pattern":{source:vo,composite:vo},"fill-extrusion-pattern":{source:vo,composite:vo},"line-dasharray":{source:cc,composite:cc}},is={color:{source:dc,composite:uc},number:{source:pl,composite:dc}};function Ei(r,e,a){const s=An[r];return s&&s[a]||is[e][a]}na(If,"ConstantBinder"),na(Dd,"PatternConstantBinder"),na(Jl,"SourceExpressionBinder"),na(qi,"PatternCompositeBinder"),na(Go,"CompositeExpressionBinder"),na(hc,"ProgramConfiguration",{omit:["_buffers"]}),na(io,"ProgramConfigurationSet");const On=Dt/Math.PI/2,h=5,t=6,i=16383,f=64,_=[f,32,16],w=-On,b=On;function E(r,e,a,s=On){return a=fr(a),[r*Math.sin(a)*s,-e*s,r*Math.cos(a)*s]}function A(r,e,a){return E(Math.cos(fr(r)),Math.sin(fr(r)),e,a)}const M=63710088e-1,I=2*Math.PI*M;class C{constructor(e,a){if(isNaN(e)||isNaN(a))throw new Error(`Invalid LngLat object: (${e}, ${a})`);if(this.lng=+e,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new C(Ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const a=Math.PI/180,s=this.lat*a,c=e.lat*a,p=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*a);return M*Math.acos(Math.min(p,1))}toBounds(e=0){const a=360*e/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new J({lng:this.lng-s,lat:this.lat-a},{lng:this.lng+s,lat:this.lat+a})}toEcef(e){return A(this.lat,this.lng,On+e*On/M)}static convert(e){if(e instanceof C)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new C(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new C(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class J{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof C?new C(e.lng,e.lat):C.convert(e),this}setSouthWest(e){return this._sw=e instanceof C?new C(e.lng,e.lat):C.convert(e),this}extend(e){const a=this._sw,s=this._ne;let c,p;if(e instanceof C)c=e,p=e;else{if(!(e instanceof J))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(J.convert(e)):this.extend(C.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(C.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return a||s?(a.lng=Math.min(c.lng,a.lng),a.lat=Math.min(c.lat,a.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new C(c.lng,c.lat),this._ne=new C(p.lng,p.lat)),this}getCenter(){return new C((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new C(this.getWest(),this.getNorth())}getSouthEast(){return new C(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:s}=C.convert(e);let c=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){if(e)return e instanceof J?e:new J(e)}}const U=0,H=25.5;function q(r){return I*Math.cos(r*Math.PI/180)}function ne(r){return(180+r)/360}function ae(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function se(r,e){return r/q(e)}function he(r){return 360*r-180}function ce(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Ze(r,e){return r*q(ce(e))}const me=85.051129;function Ne(r){return Math.cos(fr(re(r,-me,me)))}function we(r,e){const a=re(e,U,H),s=Math.pow(2,a);return Ne(r)*I/(512*s)}function ge(r){return 1/Math.cos(r*Math.PI/180)}function Se(r,e=0){const a=Math.exp(Math.PI*(1-(r.y+e/Dt)/(1<<r.z)*2));return 80150034*a/(a*a+1)/Dt/(1<<r.z)}class Pe{constructor(e,a,s=0){this.x=+e,this.y=+a,this.z=+s}static fromLngLat(e,a=0){const s=C.convert(e);return new Pe(ne(s.lng),ae(s.lat),se(a,s.lat))}toLngLat(){return new C(he(this.x),ce(this.y))}toAltitude(){return Ze(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/I*ge(ce(this.y))}}function Fe(r,e,a,s,c,p,m,x,L){const N=(e+s)/2,R=(a+c)/2,T=new St(N,R);x(T),function(V,F,O,Q,$,K){const ie=O-$,le=Q-K;return Math.abs((Q-F)*ie-(O-V)*le)/Math.hypot(ie,le)}(T.x,T.y,p.x,p.y,m.x,m.y)>=L?(Fe(r,e,a,N,R,p,T,x,L),Fe(r,N,R,s,c,T,m,x,L)):r.push(m)}function it(r,e,a){let s=r[0],c=s.x,p=s.y;e(s);const m=[s];for(let x=1;x<r.length;x++){const L=r[x],{x:N,y:R}=L;e(L),Fe(m,c,p,N,R,s,L,e,a),c=N,p=R,s=L}return m}function qe(r,e,a,s){if(s(e,a)){const c=e.add(a)._mult(.5);qe(r,e,c,s),qe(r,c,a,s)}else r.push(a)}function dt(r,e){let a=r[0];const s=[a];for(let c=1;c<r.length;c++){const p=r[c];qe(s,a,p,e),a=p}return s}const Mt=Math.pow(2,14)-1,Xe=-Mt-1;function Ie(r,e){const a=Math.round(r.x*e),s=Math.round(r.y*e);return r.x=re(a,Xe,Mt),r.y=re(s,Xe,Mt),(a<r.x||a>r.x+1||s<r.y||s>r.y+1)&&Za("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function ct(r,e,a){const s=r.loadGeometry(),c=r.extent,p=Dt/c;if(e&&a&&a.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:x,x:L,y:N,projection:R}=a,T=V=>{const F=he((e.x+V.x/c)/m),O=ce((e.y+V.y/c)/m),Q=R.project(F,O);V.x=(Q.x*x-L)*c,V.y=(Q.y*x-N)*c};for(let V=0;V<s.length;V++)if(r.type!==1)s[V]=it(s[V],T,1);else{const F=[];for(const O of s[V])O.x<0||O.x>=c||O.y<0||O.y>=c||(T(O),F.push(O));s[V]=F}}for(const m of s)for(const x of m)Ie(x,p);return s}function et(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?ct(r):[]}}class jt{constructor(e,a,s,c,p){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=p,e.readFields(Ct,this,a)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const a=e.readVarint()+e.pos,s=[];let c,p=1,m=0,x=0,L=0;for(;e.pos<a;){if(m<=0){const N=e.readVarint();p=7&N,m=N>>3}if(m--,p===1||p===2)x+=e.readSVarint(),L+=e.readSVarint(),p===1&&(c&&s.push(c),c=[]),c&&c.push(new St(x,L));else{if(p!==7)throw new Error(`unknown command ${p}`);c&&c.push(c[0].clone())}}return c&&s.push(c),s}bbox(){const e=this._pbf;e.pos=this._geometry;const a=e.readVarint()+e.pos;let s=1,c=0,p=0,m=0,x=1/0,L=-1/0,N=1/0,R=-1/0;for(;e.pos<a;){if(c<=0){const T=e.readVarint();s=7&T,c=T>>3}if(c--,s===1||s===2)p+=e.readSVarint(),m+=e.readSVarint(),p<x&&(x=p),p>L&&(L=p),m<N&&(N=m),m>R&&(R=m);else if(s!==7)throw new Error(`unknown command ${s}`)}return[x,N,L,R]}toGeoJSON(e,a,s){const c=this.extent*Math.pow(2,s),p=this.extent*e,m=this.extent*a,x=this.loadGeometry();function L(V){return[360*(V.x+p)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(V.y+m)/c)*Math.PI))-90]}function N(V){return V.map(L)}let R;if(this.type===1){const V=[];for(const O of x)V.push(O[0]);const F=N(V);R=V.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const V=x.map(N);R=V.length===1?{type:"LineString",coordinates:V[0]}:{type:"MultiLineString",coordinates:V}}else{if(this.type!==3)throw new Error("unknown feature type");{const V=function(O){const Q=O.length;if(Q<=1)return[O];const $=[];let K,ie;for(let le=0;le<Q;le++){const de=oa(O[le]);de!==0&&(ie===void 0&&(ie=de<0),ie===de<0?(K&&$.push(K),K=[O[le]]):K&&K.push(O[le]))}return K&&$.push(K),$}(x),F=[];for(const O of V)F.push(O.map(N));R=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const T={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(T.id=this.id),T}}function Ct(r,e,a){r===1?e.id=a.readVarint():r===2?function(s,c){const p=s.readVarint()+s.pos;for(;s.pos<p;){const m=c._keys[s.readVarint()],x=c._values[s.readVarint()];c.properties[m]=x}}(a,e):r===3?e.type=a.readVarint():r===4&&(e._geometry=a.pos)}function oa(r){let e=0;for(let a,s,c=0,p=r.length,m=p-1;c<p;m=c++)a=r[c],s=r[m],e+=(s.x-a.x)*(a.y+s.y);return e}jt.types=["Unknown","Point","LineString","Polygon"];class Bt{constructor(e,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ot,this,a),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const a=this._pbf.readVarint()+this._pbf.pos;return new jt(this._pbf,a,this.extent,this._keys,this._values)}}function Ot(r,e,a){r===15?e.version=a.readVarint():r===1?e.name=a.readString():r===5?e.extent=a.readVarint():r===2?e._features.push(a.pos):r===3?e._keys.push(a.readString()):r===4&&e._values.push(function(s){let c=null;const p=s.readVarint()+s.pos;for(;s.pos<p;){const m=s.readVarint()>>3;c=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c}(a))}class la{constructor(e,a){this.layers=e.readFields(ra,{},a)}}function ra(r,e,a){if(r===3){const s=new Bt(a,a.readVarint()+a.pos);s.length&&(e[s.name]=s)}}const Ht="3d_elevation_id",ia="level";class va{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,a){return this._valid&&e(a(this._geometry)),this}require(e,a,s){return this.get(e,!0,a,s)}optional(e,a,s){return this.get(e,!1,a,s)}success(){return this._valid}get(e,a,s,c){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?s(c?c(p):p):a&&(this._valid=!1),this}}class ir{constructor(e,a){this.featureFunc=e,this.vertexFunc=a}parseFeature(e,a,s){return this.featureFunc(e,a,s)}parseVertex(e,a,s){return this.vertexFunc(e,a,s)}}const Oa=new ir((r,e,a)=>r.reset(e).require(Ht,s=>{a.id=s}).optional("fixed_height_relative",s=>{a.constantHeight=s},Ta.decodeRelativeHeight).geometry(s=>{a.bounds=s},ec).success(),(r,e,a)=>r.reset(e).require(Ht,s=>{a.id=s}).require("elevation_idx",s=>{a.idx=s}).require("extent",s=>{a.extent=s}).require("height_relative",s=>{a.height=s},Ta.decodeRelativeHeight).geometry(s=>{a.position=s},Ta.getPoint).success()),Qr=new ir((r,e,a)=>r.reset(e).require(Ht,s=>{a.id=s}).optional("fixed_height",s=>{a.constantHeight=s},Ta.decodeMetricHeight).geometry(s=>{a.bounds=s},ec).success(),(r,e,a)=>r.reset(e).require(Ht,s=>{a.id=s}).require("elevation_idx",s=>{a.idx=s}).require("extent",s=>{a.extent=s}).require("height",s=>{a.height=s},Ta.decodeMetricHeight).geometry(s=>{a.position=s},Ta.getPoint).success());class Ta{static getPoint(e){return co(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Qr:void 0:Oa}static parse(e){const a=[],s=[],c=e.length,p=new va;for(let m=0;m<c;m++){const x=e.feature(m),L=x.properties.version,N=Ta.getVersionSchema(L);if(N===void 0){Za(`Unknown elevation feature version number ${L||"(unknown)"}`);continue}const R=x.properties.type;if(!R)continue;const T=jt.types[x.type];if(T==="Point"&&R==="curve_point"){const V={};N.parseVertex(p,x,V)&&a.push(V)}else if(T==="Polygon"&&R==="curve_meta"){const V={};N.parseFeature(p,x,V)&&s.push(V)}}return{vertices:a,features:s}}}class pr{constructor(e,a){this.pos=e,this.dir=a}intersectsPlane(e,a,s){const c=zo(a,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((e[0]-this.pos[0])*a[0]+(e[1]-this.pos[1])*a[1])/c;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,!0}}class Ua{constructor(e,a){this.pos=e,this.dir=a}intersectsPlane(e,a,s){const c=gr(a,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((e[0]-this.pos[0])*a[0]+(e[1]-this.pos[1])*a[1]+(e[2]-this.pos[2])*a[2])/c;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,a,s){if(function(F,O){var Q=F[0],$=F[1],K=F[2],ie=O[0],le=O[1],de=O[2];return Math.abs(Q-ie)<=B*Math.max(1,Math.abs(Q),Math.abs(ie))&&Math.abs($-le)<=B*Math.max(1,Math.abs($),Math.abs(le))&&Math.abs(K-de)<=B*Math.max(1,Math.abs(K),Math.abs(de))}(this.pos,e)||a===0)return s[0]=s[1]=s[2]=0,!1;const[c,p,m]=this.dir,x=this.pos[0]-e[0],L=this.pos[1]-e[1],N=this.pos[2]-e[2],R=c*c+p*p+m*m,T=2*(x*c+L*p+N*m),V=T*T-4*R*(x*x+L*L+N*N-a*a);if(V<0){const F=Math.max(-T/2,0),O=x+c*F,Q=L+p*F,$=N+m*F,K=Math.hypot(O,Q,$);return s[0]=O*a/K,s[1]=Q*a/K,s[2]=$*a/K,!1}{const F=(-T-Math.sqrt(V))/(2*R);if(F<0){const O=Math.hypot(x,L,N);return s[0]=x*a/O,s[1]=L*a/O,s[2]=N*a/O,!1}return s[0]=x+c*F,s[1]=L+p*F,s[2]=N+m*F,!0}}}class Cr{constructor(e,a,s,c,p){this.TL=e,this.TR=a,this.BR=s,this.BL=c,this.horizon=p}static fromInvProjectionMatrix(e,a,s){const c=[-1,1,1],p=[1,1,1],m=[1,-1,1],x=[-1,-1,1],L=ln(c,c,e),N=ln(p,p,e),R=ln(m,m,e),T=ln(x,x,e);return new Cr(L,N,R,T,a/s)}}function mr(r,e,a){let s=1/0,c=-1/0;const p=[];for(const m of r){Sr(p,m,e);const x=gr(p,a);s=Math.min(s,x),c=Math.max(c,x)}return[s,c]}function Kr(r,e){let a=!0;for(let s=0;s<r.planes.length;s++){const c=r.planes[s];let p=0;for(let m=0;m<e.length;m++)p+=+(gr(c,e[m])+c[3]>=0);if(p===0)return 0;p!==e.length&&(a=!1)}return a?2:1}function sr(r,e){for(const a of r.projections){const s=mr(e,r.points[0],a.axis);if(a.projection[1]<s[0]||a.projection[0]>s[1])return 0}return 1}function Ga(r,e){let a=0;const s=[0,0,0,0];for(let m=0;m<r.length;m++)s[0]=r[m][0],s[1]=r[m][1],s[2]=r[m][2],s[3]=1,(c=s)[0]*(p=e)[0]+c[1]*p[1]+c[2]*p[2]+c[3]*p[3]>=0&&a++;var c,p;return a}class Rr{constructor(e,a){this.points=e||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Ca.fromPoints(this.points),this.projections=[],this.frustumEdges=[Sr([],this.points[2],this.points[3]),Sr([],this.points[0],this.points[3]),Sr([],this.points[4],this.points[0]),Sr([],this.points[5],this.points[1]),Sr([],this.points[6],this.points[2]),Sr([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const c=[0,-s[2],s[1]],p=[s[2],0,-s[0]];this.projections.push({axis:c,projection:mr(this.points,this.points[0],c)}),this.projections.push({axis:p,projection:mr(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,a,s,c){const p=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>{const R=Xi([],N,e),T=1/R[3]/a*p;return(V=R)[0]=(F=R)[0]*(O=[T,T,c?1/R[3]:T,T])[0],V[1]=F[1]*O[1],V[2]=F[2]*O[2],V[3]=F[3]*O[3],V;var V,F,O}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(N=>{const R=ka([],Pn([],Sr([],m[N[0]],m[N[1]]),Sr([],m[N[2]],m[N[1]]))),T=-gr(R,m[N[1]]);return R.concat(T)}),L=[];for(let N=0;N<m.length;N++)L.push([m[N][0],m[N][1],m[N][2]]);return new Rr(L,x)}intersectsPrecise(e,a,s){for(let c=0;c<a.length;c++)if(!Ga(e,a[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!Ga(e,this.planes[c]))return 0;for(const c of s)for(const p of this.frustumEdges){const m=Pn([],c,p),x=ht(m);if(x===0)continue;Be(m,m,1/x);const L=mr(this.points,this.points[0],m),N=mr(e,this.points[0],m);if(L[0]>N[1]||N[0]>L[1])return 0}return 1}containsPoint(e){for(const a of this.planes){const s=a[3];if(gr([a[0],a[1],a[2]],e)+s<0)return!1}return!0}}class Ca{static fromPoints(e){const a=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const c of e)Ye(a,a,c),wt(s,s,c);return new Ca(a,s)}static fromTileIdAndHeight(e,a,s){const c=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new Ca([p/c,m/c,a],[(p+1)/c,(m+1)/c,s])}static applyTransform(e,a){const s=e.getCorners();for(let c=0;c<s.length;++c)ln(s[c],s[c],a);return Ca.fromPoints(s)}static applyTransformFast(e,a){const s=[a[12],a[13],a[14]],c=[...s];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const x=a[4*m+p],L=x*e.min[m],N=x*e.max[m];s[p]+=Math.min(L,N),c[p]+=Math.max(L,N)}return new Ca(s,c)}static projectAabbCorners(e,a){const s=e.getCorners();for(let c=0;c<s.length;++c)ln(s[c],s[c],a);return s}constructor(e,a){this.min=e,this.max=a,this.center=Be([],Lt([],this.min,this.max),.5)}quadrant(e){const a=[e%2==0,e<2],s=st(this.min),c=st(this.max);for(let p=0;p<a.length;p++)s[p]=a[p]?this.min[p]:this.center[p],c[p]=a[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new Ca(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,a=this.max;return[[e[0],e[1],e[2]],[a[0],e[1],e[2]],[a[0],a[1],e[2]],[e[0],a[1],e[2]],[e[0],e[1],a[2]],[a[0],e[1],a[2]],[a[0],a[1],a[2]],[e[0],a[1],a[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Kr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Kr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,a){return a||this.intersects(e)?sr(e,this.getCorners()):0}intersectsPreciseFlat(e,a){return a||this.intersectsFlat(e)?sr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let a=0;a<3;++a)if(this.min[a]>e.max[a]||e.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],e.min[a]),this.max[a]=Math.max(this.max[a],e.max[a])}encapsulatePoint(e){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],e[a]),this.max[a]=Math.max(this.max[a],e[a])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}na(Ca,"Aabb");class en{constructor(e,a){this.feature=e,this.metersToTile=a,this.index=0}get(){const e=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,s=a[1],c=-a[0],p=(e.extent+1)*this.metersToTile;return[new St(Math.trunc(e.position[0]+s*p),Math.trunc(e.position[1]+c*p)),new St(Math.trunc(e.position[0]-s*p),Math.trunc(e.position[1]-c*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class _r{constructor(e,a,s,c,p,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[kn(),kn(),kn(),kn(),kn(),kn(),kn()],this.id=e,this.heightRange={min:s,max:s},this.safeArea=a,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=p,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((L=this.vertices[x.a].position)[0]===(N=this.vertices[x.b].position)[0]&&L[1]===N[1]);var L,N}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:co(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const L=this.vertices[x.a].position,N=this.vertices[x.b].position,R=yi(kn(),N,L),T=Ln(R),V=Us(kn(),R,1/T);this.edgeProps.push({vec:R,dir:V,len:T});const F=this.vertexProps[x.a].dir,O=this.vertexProps[x.b].dir;ts(F,F,V),ts(O,O,V)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||gi(x.dir,x.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(e);if(a==null)return 0;const[s,c]=a;return Sa(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,c)}computeSlopeNormal(e,a){const s=this.getClosestEdge(e);if(!s)return Wt(0,0,1);const c=s[0],p=this.edges[c],m=this.edgeProps[c].vec,x=Wt(m[0],m[1],(this.vertices[p.b].height-this.vertices[p.a].height)*a),L=Wt(x[1],-x[0],0);Pn(L,L,x);const N=ht(L);return N>0?Be(L,L,1/N):qt(L,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let a=0,s=Number.POSITIVE_INFINITY,c=0;const[p,m,x,L,N,R,T]=this._tmpVec2;Zi(T,e.x,e.y);const V=new pr(T,null);for(let F=0;F<this.edges.length;F++){const O=this.edges[F],Q=this.edgeProps[F].dir;V.dir=Q;const $=this.vertices[O.a].position,K=this.vertices[O.b].position,ie=V.intersectsPlane($,this.vertexProps[O.a].dir,p),le=V.intersectsPlane(K,this.vertexProps[O.b].dir,m);if(!ie||!le)continue;yi(x,m,p),yi(L,T,p);const de=zo(x,x),Ee=de>0?zo(L,x)/de:0,Le=re(Ee,0,1),Ae=Math.abs((Ee-Le)*this.edgeProps[F].len);yi(N,T,$),Zi(R,Q[1],-Q[0]);const Me=Ae+Math.abs(zo(N,R));Me<s&&(a=F,s=Me,c=Le)}return[a,c]}tessellate(e){const a=Ke(),s=Ke(),c=Ke(),p=Ke();for(let m=this.edges.length-1;m>=0;--m){const x=this.edges[m].a,L=this.edges[m].b,{position:N,height:R,extent:T}=this.vertices[x],{position:V,height:F,extent:O}=this.vertices[L],Q=this.vertexProps[x].dir,$=this.vertexProps[L].dir;if(qt(a,N[0]/e,N[1]/e,R),qt(s,V[0]/e,V[1]/e,F),qt(c,Q[1],-Q[0],0),Be(c,c,T),qt(p,$[1],-$[0],0),Be(p,p,O),this.distSqLines(Wt(a[0]+.5*c[0],a[1]+.5*c[1],a[2]+.5*c[2]),Wt(s[0]-.5*p[0],s[1]-.5*p[1],s[2]-.5*p[2]),Wt(a[0]-.5*c[0],a[1]-.5*c[1],a[2]-.5*c[2]),Wt(s[0]+.5*p[0],s[1]+.5*p[1],s[2]+.5*p[2]))<=.0025000000000000005)continue;const K=this.vertices.length,ie=ts(kn(),N,V);this.vertices.push({position:Us(ie,ie,.5),height:.5*(R+F),extent:.5*(T+O)});const le=ts(kn(),Q,$);this.vertexProps.push({dir:gi(le,le)}),this.edges.splice(m,1),this.edgeProps.splice(m,1),this.edges.push({a:x,b:K}),this.edges.push({a:K,b:L});const de=yi(kn(),this.vertices[K].position,N),Ee=Ln(de),Le={vec:de,dir:Us(kn(),de,1/Ee),len:Ee};this.edgeProps.push(Le),this.edgeProps.push(Le)}}distSqLines(e,a,s,c){const p=mt(Ke(),a,e),m=mt(Ke(),c,s),x=mt(Ke(),e,s),L=gr(p,p),N=gr(p,m),R=gr(p,x),T=gr(m,m),V=gr(m,x),F=L*T-N*N;if(F===0)return Ja(qo(p,s,c,gr(x,m)/gr(m,m)),e);const O=(L*V-N*R)/F;return Ja(qo(p,e,a,(N*V-R*T)/F),qo(m,s,c,O))}}class Va{static parseFrom(e,a){const s=Ta.parse(e);if(!s)return[];let{vertices:c,features:p}=s;const m=1/Se(a);p.sort((R,T)=>R.id-T.id),c.sort((R,T)=>R.id-T.id||R.idx-T.idx),c=c.filter((R,T,V)=>T===V.findIndex(F=>F.id===R.id&&F.idx===R.idx));const x=new Array;let L=0;const N=c.length;for(const R of p){if(R.constantHeight){x.push(new _r(R.id,R.bounds,R.constantHeight));continue}for(;L!==N&&c[L].id<R.id;)L++;if(L===N||c[L].id!==R.id)continue;const T=new Array,V=new Array,F=L;for(;L!==N&&c[L].id===R.id;){const O=c[L];if(T.push({position:O.position,height:O.height,extent:O.extent}),L!==F&&c[L-1].idx===O.idx-1){const Q=L-F;V.push({a:Q-1,b:Q})}L++}x.push(new _r(R.id,R.bounds,void 0,T,V,m))}return x}static getElevationFeature(e,a){if(!a)return;const s=+e.properties[Ht];return Number.isNaN(s)?void 0:a.find(c=>c.id===s)}}class yr{constructor(e,a){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(a)||(this.zScale=Math.pow(2,a.z-e.z),this.xOffset=(e.x*this.zScale-a.x)*Dt,this.yOffset=(e.y*this.zScale-a.y)*Dt)}constantElevation(e,a){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,a)}pointElevation(e,a,s){const c=this.constantElevation(a,s);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(e),s))}computeBiasedHeight(e,a){return a<=0?e:e+a*xe(0,a,e>=0?e:Math.abs(.5*e))}}na(_r,"ElevationFeature");class _n{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ds,this.indexArray=new gn,this.segments=new Ar,this.programConfigurations=new io(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new pl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,a){}updateAppearances(e,a,s,c){}populate(e,a,s,c){const p=this.layers[0],m=[];let x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(const{feature:N,id:R,index:T,sourceLayerIndex:V}of e){const F=this.layers[0]._featureFilter.needGeometry,O=et(N,F);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),O,s))continue;const Q=x?x.evaluate(O,{},s):void 0,$={id:R,properties:N.properties,type:N.type,sourceLayerIndex:V,index:T,geometry:F?O.geometry:ct(N,s,c),patterns:{},sortKey:Q};m.push($)}x&&m.sort((N,R)=>N.sortKey-R.sortKey);let L=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Ad,L=c.projection);for(const N of m){const{geometry:R,index:T,sourceLayerIndex:V}=N,F=e[T].feature;this.addFeature(N,R,T,a.availableImages,s,L,a.brightness,a.elevationFeatures),a.featureIndex.insert(F,R,T,V,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,a,s,c,p,m,x){this.programConfigurations.updatePaintArrays(e,a,p,s,c,m,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,um.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Mf.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,my.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,a,s,c,p,m,x,L){let N;this.elevationMode!=="none"&&(N=Va.getElevationFeature(e,L));for(const R of a)for(const T of R){const V=T.x,F=T.y;if(V<0||V>=Dt||F<0||F>=Dt)continue;if(m){const $=m.projectTilePoint(V,F,p),K=m.upVector(p,V,F);this.addGlobeExtVertex($,K),this.addGlobeExtVertex($,K),this.addGlobeExtVertex($,K),this.addGlobeExtVertex($,K)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Q=O.vertexLength;if(this.addCircleVertex(V,F,-1,-1),this.addCircleVertex(V,F,1,-1),this.addCircleVertex(V,F,1,1),this.addCircleVertex(V,F,-1,1),this.elevationMode!=="none"){const $=N?N.pointElevation(new St(V,F)):0;this.hasElevation=this.hasElevation||$!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack($)}this.indexArray.emplaceBack(Q,Q+1,Q+2),this.indexArray.emplaceBack(Q,Q+2,Q+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,p,x,void 0,this.worldview)}addCircleVertex(e,a,s,c){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*a+(c+1)/2)}addGlobeExtVertex(e,a){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function Hn(r,e){for(let a=0;a<r.length;a++)if(vi(e,r[a]))return!0;for(let a=0;a<e.length;a++)if(vi(r,e[a]))return!0;return!!xs(r,e)}function wn(r,e,a){return!!vi(r,e)||!!Oi(e,r,a)}function Dn(r,e){if(r.length===1)return No(e,r[0]);for(let a=0;a<e.length;a++){const s=e[a];for(let c=0;c<s.length;c++)if(vi(r,s[c]))return!0}for(let a=0;a<r.length;a++)if(No(e,r[a]))return!0;for(let a=0;a<e.length;a++)if(xs(r,e[a]))return!0;return!1}function Ss(r,e,a){if(r.length>1){if(xs(r,e))return!0;for(let s=0;s<e.length;s++)if(Oi(e[s],r,a))return!0}for(let s=0;s<r.length;s++)if(Oi(r[s],e,a))return!0;return!1}function xs(r,e){if(r.length===0||e.length===0)return!1;for(let a=0;a<r.length-1;a++){const s=r[a],c=r[a+1];for(let p=0;p<e.length-1;p++)if(Si(s,c,e[p],e[p+1]))return!0}return!1}function Si(r,e,a,s){return $a(r,a,s)!==$a(e,a,s)&&$a(r,e,a)!==$a(r,e,s)}function Fi(r,e,a){return(r.x-a.x)*(e.y-a.y)-(r.y-a.y)*(e.x-a.x)}function so(r,e,a,s){const c=Fi(r,e,s),p=Fi(r,e,a);if(Math.sign(c)===Math.sign(p))return;const m=Fi(a,s,r),x=m+p-c;return Math.sign(m)!==Math.sign(x)?[m/(m-x),p/(p-c)]:void 0}function Oi(r,e,a){const s=a*a;if(e.length===1)return r.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Zo(r,e[c-1],e[c])<s)return!0;return!1}function Zo(r,e,a){const s=e.distSqr(a);if(s===0)return r.distSqr(e);const c=((r.x-e.x)*(a.x-e.x)+(r.y-e.y)*(a.y-e.y))/s;return r.distSqr(c<0?e:c>1?a:a.sub(e)._mult(c)._add(e))}function No(r,e){let a,s,c,p=!1;for(let m=0;m<r.length;m++){a=r[m];for(let x=0,L=a.length-1;x<a.length;L=x++)s=a[x],c=a[L],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(p=!p)}return p}function vi(r,e){let a=!1;for(let s=0,c=r.length-1;s<r.length;c=s++){const p=r[s],m=r[c];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(a=!a)}return a}function vn(r,e,a,s,c){for(const m of r)if(e<=m.x&&a<=m.y&&s>=m.x&&c>=m.y)return!0;const p=[new St(e,a),new St(e,c),new St(s,c),new St(s,a)];if(r.length>2){for(const m of p)if(vi(r,m))return!0}for(let m=0;m<r.length-1;m++)if(Cn(r[m],r[m+1],p))return!0;return!1}function Cn(r,e,a){const s=a[0],c=a[2];if(r.x<s.x&&e.x<s.x||r.x>c.x&&e.x>c.x||r.y<s.y&&e.y<s.y||r.y>c.y&&e.y>c.y)return!1;const p=$a(r,e,a[0]);return p!==$a(r,e,a[1])||p!==$a(r,e,a[2])||p!==$a(r,e,a[3])}function Gr(r,e,a,s,c,p){let m=e.y-r.y,x=r.x-e.x;if(p=p||0){const L=m*m+x*x;if(L===0)return!0;const N=Math.sqrt(L);m/=N,x/=N}return!((a.x-r.x)*m+(a.y-r.y)*x-p<0||(s.x-r.x)*m+(s.y-r.y)*x-p<0||(c.x-r.x)*m+(c.y-r.y)*x-p<0)}function Yn(r,e,a,s,c,p,m){return!(Gr(r,e,s,c,p,m)||Gr(e,a,s,c,p,m)||Gr(a,r,s,c,p,m)||Gr(s,c,r,e,a,m)||Gr(c,p,r,e,a,m)||Gr(p,s,r,e,a,m))}function Di(r,e,a){const s=e.paint.get(r).value;return s.kind==="constant"?s.value:a.programConfigurations.get(e.id).getMaxValue(r)}function bn(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Eo(r,e,a,s,c){if(!e[0]&&!e[1])return r;const p=St.convert(e)._mult(c);a==="viewport"&&p._rotate(-s);const m=[];for(let x=0;x<r.length;x++)m.push(r[x].sub(p));return m}function Fl(r,e,a,s){const c=St.convert(r)._mult(s);return e==="viewport"&&c._rotate(-a),c}let fc,pc;function y(r,e,a){var s=2*Math.PI*6378137/256/Math.pow(2,a);return[r*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}na(_n,"CircleBucket",{omit:["layers"]});class v{constructor(e,a,s){this.z=e,this.x=a,this.y=s,this.key=W(0,e,e,a,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const a=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>a&&e.y===this.y>>a}url(e,a){const s=function(p,m,x){var L=y(256*p,256*(m=Math.pow(2,x)-m-1),x),N=y(256*(p+1),256*(m+1),x);return L[0]+","+L[1]+","+N[0]+","+N[1]}(this.x,this.y,this.z),c=function(p,m,x){let L,N="";for(let R=p;R>0;R--)L=1<<R-1,N+=(m&L?1:0)+(x&L?2:0);return N}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class z{constructor(e,a){this.wrap=e,this.canonical=a,this.key=W(e,a.z,a.z,a.x,a.y)}}class k{constructor(e,a,s,c,p){this.overscaledZ=e,this.wrap=a,this.canonical=new v(s,+c,+p),this.key=a===0&&e===s?this.canonical.key:W(a,e,s,c,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const a=this.canonical.z-e;return e>this.canonical.z?new k(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new k(e,this.wrap,e,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(e,a=!0){if(this.overscaledZ===e&&a)return this.key;if(e>this.canonical.z)return W(this.wrap*+a,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return W(this.wrap*+a,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const a=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>a&&e.canonical.y===this.canonical.y>>a}children(e){if(this.overscaledZ>=e)return[new k(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new k(a,this.wrap,a,s,c),new k(a,this.wrap,a,s+1,c),new k(a,this.wrap,a,s,c+1),new k(a,this.wrap,a,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new k(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new k(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new z(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function W(r,e,a,s,c){const p=1<<Math.min(a,22);let m=p*(c%p)+s%p;return r&&a<22&&(m+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-a)))),16*(32*m+a)+(e-a)}const ee=[r=>{let e=r.canonical.x-1,a=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,a--),new k(r.overscaledZ,a,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,a=r.wrap;return e===1<<r.canonical.z&&(e=0,a++),new k(r.overscaledZ,a,r.canonical.z,e,r.canonical.y)},r=>new k(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new k(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];na(v,"CanonicalTileID"),na(k,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const be=tr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:He}=be,lt=tr([{name:"a_pos_3",components:3,type:"Int16"}]);var Ut=tr([{name:"a_pos",type:"Int16",components:2}]);function ga(r){return r*On/M}const wa=[new Ca([w,w,w],[b,b,b]),new Ca([w,w,w],[0,0,b]),new Ca([0,w,w],[b,0,b]),new Ca([w,0,w],[0,b,b]),new Ca([0,0,w],[b,b,b])];function _a(r,e,a,s=!0){const c=Be([],r._camera.position,r.worldSize),p=[e,a,1,1];Xi(p,p,r.pixelMatrixInverse),cs(p,p,1/p[3]);const m=ka([],Sr([],p,c)),x=r.globeMatrix,L=[x[12],x[13],x[14]],N=Sr([],L,c),R=ht(N),T=ka([],N),V=r.worldSize/(2*Math.PI),F=gr(T,m),O=Math.asin(V/R);if(O<Math.acos(F)){if(!s)return null;const ot=[],We=[];Be(ot,m,R/F),ka(We,Sr(We,ot,N)),ka(m,Lt(m,N,Be(m,We,Math.tan(O)*R)))}const Q=[];new Ua(c,m).closestPointOnSphere(L,V,Q);const $=ka([],cn(x,0)),K=ka([],cn(x,1)),ie=ka([],cn(x,2)),le=gr($,Q),de=gr(K,Q),Ee=gr(ie,Q),Le=Vi(Math.asin(-de/V));let Ae=Vi(Math.atan2(le,Ee));Ae=r.center.lng+function(ot,We){const ut=(We-ot+180)%360-180;return ut<-180?ut+360:ut}(r.center.lng,Ae);const Me=ne(Ae),Je=re(ae(Le),0,1);return new Pe(Me,Je)}class Ha{constructor(e,a,s){this.a=Sr([],e,s),this.b=Sr([],a,s),this.center=s;const c=ka([],this.a),p=ka([],this.b);this.angle=Math.acos(gr(c,p))}}function er(r,e){if(r.angle===0)return null;let a;return a=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),a<0||a>1?null:function(s,c,p,m){const x=Math.sin(p);return s*(Math.sin((1-m)*p)/x)+c*(Math.sin(m*p)/x)}(r.a[e],r.b[e],r.angle,re(a,0,1))+r.center[e]}function Wa(r){if(r.z<=1)return wa[r.z+2*r.y+r.x];const e=Na(kt(r));return Ca.fromPoints(e)}function ai(r,e,a){return Be(r,r,1-a),ba(r,r,e,a)}function Rt(r,e,a){for(const s of r)ln(s,s,e),Be(s,s,a)}function gt(r,e,a,s){const c=e/r.worldSize,p=r.globeMatrix;if(a.z<=1){const Je=Wa(a).getCorners();return Rt(Je,p,c),Ca.fromPoints(Je)}const m=kt(a,s),x=Na(m,On+ga(r._tileCoverLift));Rt(x,p,c);const L=Number.MAX_VALUE,N=[-L,-L,-L],R=[L,L,L];if(m.contains(r.center)){for(const We of x)Ye(R,R,We),wt(N,N,We);N[2]=0;const Je=r.point,ot=[Je.x*c,Je.y*c,0];return Ye(R,R,ot),wt(N,N,ot),new Ca(R,N)}if(r._tileCoverLift>0){for(const Je of x)Ye(R,R,Je),wt(N,N,Je);return new Ca(R,N)}const T=[p[12]*c,p[13]*c,p[14]*c],V=m.getCenter(),F=re(r.center.lat,-me,me),O=re(V.lat,-me,me),Q=ne(r.center.lng),$=ae(F);let K=Q-ne(V.lng);const ie=$-ae(O);K>.5?K-=1:K<-.5&&(K+=1);let le=0;Math.abs(K)>Math.abs(ie)?le=K>=0?1:3:(le=ie>=0?0:2,ba(T,T,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(fr(ie>=0?m.getSouth():m.getNorth()))*On));const de=x[le],Ee=x[(le+1)%4],Le=new Ha(de,Ee,T),Ae=[er(Le,0)||de[0],er(Le,1)||de[1],er(Le,2)||de[2]],Me=kf(r.zoom);if(Me>0){const Je=function({x:We,y:ut,z:_t},Zt,Pt,At,xt){const zt=1/(1<<_t);let nt=We*zt,rt=nt+zt,Et=ut*zt,Jt=Et+zt,vt=0;const sa=(nt+rt)/2-At;return sa>.5?vt=-1:sa<-.5&&(vt=1),nt=((nt+vt)*Zt-(At*=Zt))*Pt+At,rt=((rt+vt)*Zt-At)*Pt+At,Et=(Et*Zt-(xt*=Zt))*Pt+xt,Jt=(Jt*Zt-xt)*Pt+xt,[[nt,Jt,0],[rt,Jt,0],[rt,Et,0],[nt,Et,0]]}(a,e,r._pixelsPerMercatorPixel,Q,$);for(let We=0;We<x.length;We++)ai(x[We],Je[We],Me);const ot=Lt([],Je[le],Je[(le+1)%4]);Be(ot,ot,.5),ai(Ae,ot,Me)}for(const Je of x)Ye(R,R,Je),wt(N,N,Je);return R[2]=Math.min(de[2],Ee[2]),Ye(R,R,Ae),wt(N,N,Ae),new Ca(R,N)}function kt({x:r,y:e,z:a},s=!1){const c=1/(1<<a),p=new C(he(r*c),e===(1<<a)-1&&s?-90:ce((e+1)*c)),m=new C(he((r+1)*c),e===0&&s?90:ce(e*c));return new J(p,m)}function Na(r,e=On){const a=fr(r.getNorth()),s=fr(r.getSouth()),c=Math.cos(a),p=Math.cos(s),m=Math.sin(a),x=Math.sin(s),L=r.getWest(),N=r.getEast();return[E(p,x,L,e),E(p,x,N,e),E(c,m,N,e),E(c,m,L,e)]}function rr(r,e,a,s){const c=1<<a.z,p=(r/Dt+a.x)/c;return A(ce((e/Dt+a.y)/c),he(p),s)}function xr({min:r,max:e}){return i/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const br=new Float64Array(16);function Tr(r){const e=xr(r),a=Ft(br,[e,e,e]);return ye(a,a,or([],r.min))}function ss(r){const e=(s=r.min,(a=br)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=s[0],a[13]=s[1],a[14]=s[2],a[15]=1,a);var a,s;const c=1/xr(r);return $e(e,e,[c,c,c])}function Bn(r){const e=Dt/(2*Math.PI);return r/(2*Math.PI)/e}function Du(r,e){return Dt/(512*Math.pow(2,r))*xr(Wa(e))}function Vg(r,e,a,s,c){const p=Bn(a),m=[r,e,-a/(2*Math.PI)],x=pe(new Float64Array(16));return ye(x,x,m),$e(x,x,[p,p,p]),De(x,x,fr(-c)),Te(x,x,fr(-s)),x}function kf(r){return xe(h,t,r)}function Fv(r,e){const a=A(e.lat,e.lng),s=function(O){const Q=A(O._center.lat,O._center.lng);let $=Pn([],Wt(0,1,0),Q);const K=bt([],-O.angle,Q);$=ln($,$,K),bt(K,-O._pitch,$);const ie=ka([],Q);return Be(ie,ie,ga(O.cameraToCenterDistance/O.pixelsPerMeter)),ln(ie,ie,K),Lt([],Q,ie)}(r);return m=(c=mt([],s,a))[0],x=c[1],L=c[2],N=(p=a)[0],R=p[1],T=p[2],F=(V=Math.sqrt((m*m+x*x+L*L)*(N*N+R*R+T*T)))&&gr(c,p)/V,Math.acos(Math.min(Math.max(F,-1),1));var c,p,m,x,L,N,R,T,V,F}function L_(r,e){return Fv(r,e)>Math.PI/2*1.01}const Ov=fr(85),yE=Math.cos(Ov),gE=Math.sin(Ov),_E=ue(),Dv=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Cv(r,e,a,s,c,p,m,x,L){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(L*=r.pixelToTileUnitsFactor);const N=r.tileID.canonical,R=a.projection.upVectorScale(N,a.center.lat,a.worldSize).metersToTile;for(const T of e)for(const V of T){const F=V.add(x),O=c&&a.elevation?a.elevation.exaggeration()*c.getElevationAt(F.x,F.y,!0):0,Q=a.projection.projectTilePoint(F.x,F.y,N);if(O>0){const le=a.projection.upVector(N,F.x,F.y);Q.x+=le[0]*R*O,Q.y+=le[1]*R*O,Q.z+=le[2]*R*O}const $=p?F:xE(Q.x,Q.y,Q.z,s),K=p?r.tilespaceRays.map(le=>vE(le,O)):r.queryGeometry.screenGeometry,ie=Xi([],[Q.x,Q.y,Q.z,1],s);if(!m&&p?L*=ie[3]/a.cameraToCenterDistance:m&&!p&&(L*=a.cameraToCenterDistance/ie[3]),p){const le=ce((V.y/Dt+N.y)/(1<<N.z));L/=a.projection.pixelsPerMeter(le,1)/se(1,le)}if(wn(K,$,L))return!0}return!1}function xE(r,e,a,s){const c=Xi([],[r,e,a,1],s);return new St(c[0]/c[3],c[1]/c[3])}const Pv=Wt(0,0,0),wE=Wt(0,0,1);function vE(r,e){const a=Ke();return Pv[2]=e,r.intersectsPlane(Pv,wE,a),new St(a[0],a[1])}class Gv extends _n{}let Uv,Wv,Xv,Qv;function Hv(r,{width:e,height:a},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*a*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*a*s);return r.width=e,r.height=a,r.data=c,r}function Yv(r,e,a){const{width:s,height:c}=e;s===r.width&&c===r.height||(j_(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,s),height:Math.min(r.height,c)},a,null),r.width=s,r.height=c,r.data=e.data)}function j_(r,e,a,s,c,p,m,x){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||a.x>r.width-c.width||a.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const L=r.data,N=e.data,R=p===4&&x;for(let T=0;T<c.height;T++){const V=((a.y+T)*r.width+a.x)*p,F=((s.y+T)*e.width+s.x)*p;if(R)for(let O=0;O<c.width;O++){const Q=V+O*p+3,$=F+O*p;N[$+0]=255,N[$+1]=255,N[$+2]=255,N[$+3]=L[Q]}else if(m)for(let O=0;O<c.width;O++){const Q=V+O*p,$=F+O*p,K=new Or(L[Q+0]/255,L[Q+1]/255,L[Q+2]/255,L[Q+3]).toNonPremultipliedRenderColor(m).toArray();N[$+0]=K[0],N[$+1]=K[1],N[$+2]=K[2],N[$+3]=K[3]}else for(let O=0;O<c.width*p;O++)N[F+O]=L[V+O]}return e}na(Gv,"HeatmapBucket",{omit:["layers"]});class Jf{constructor(e,a){Hv(this,e,1,a)}resize(e){Yv(this,new Jf(e),1)}clone(){return new Jf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,a,s,c,p){j_(e,a,s,c,p,1,null)}}class zs{constructor(e,a){Hv(this,e,4,a)}resize(e){Yv(this,new zs(e),4)}replace(e,a){a?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new zs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,a,s,c,p,m,x){j_(e,a,s,c,p,4,m,x)}}class $v{constructor(e,a){this.width=e.width,this.height=e.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function yy(r){const e={},a=r.resolution||256,s=r.clips?r.clips.length:1,c=r.image||new zs({width:a,height:s}),p=(m,x,L)=>{e[r.evaluationKey]=L;const N=r.expression.evaluate(e),R=N?N.toNonPremultipliedRenderColor(null):null;R&&(c.data[m+x+0]=Math.floor(255*R.r),c.data[m+x+1]=Math.floor(255*R.g),c.data[m+x+2]=Math.floor(255*R.b),c.data[m+x+3]=Math.floor(255*R.a))};if(r.clips)for(let m=0,x=0;m<s;++m,x+=4*a)for(let L=0,N=0;L<a;L++,N+=4){const R=L/(a-1),{start:T,end:V}=r.clips[m];p(x,N,T*(1-R)+V*R)}else for(let m=0,x=0;m<a;m++,x+=4)p(0,x,m/(a-1));return c}na(Jf,"AlphaImage"),na(zs,"RGBAImage");const bE=tr([{name:"a_pos",components:2,type:"Int16"}],4),LE=tr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),jE=tr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),ZE=tr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function fm(r,e,a=2){const s=e&&e.length,c=s?e[0]*a:r.length;let p=qv(r,0,c,a,!0);const m=[];if(!p||p.next===p.prev)return m;let x,L,N;if(s&&(p=function(R,T,V,F){const O=[];for(let Q=0,$=T.length;Q<$;Q++){const K=qv(R,T[Q]*F,Q<$-1?T[Q+1]*F:R.length,F,!1);K===K.next&&(K.steiner=!0),O.push(VE(K))}O.sort(AE);for(let Q=0;Q<O.length;Q++)V=RE(O[Q],V);return V}(r,e,p,a)),r.length>80*a){x=r[0],L=r[1];let R=x,T=L;for(let V=a;V<c;V+=a){const F=r[V],O=r[V+1];F<x&&(x=F),O<L&&(L=O),F>R&&(R=F),O>T&&(T=O)}N=Math.max(R-x,T-L),N=N!==0?32767/N:0}return gy(p,m,a,x,L,N,0),m}function qv(r,e,a,s,c){let p;if(c===function(m,x,L,N){let R=0;for(let T=x,V=L-N;T<L;T+=N)R+=(m[V]-m[T])*(m[T+1]+m[V+1]),V=T;return R}(r,e,a,s)>0)for(let m=e;m<a;m+=s)p=ab(m/s|0,r[m],r[m+1],p);else for(let m=a-s;m>=e;m-=s)p=ab(m/s|0,r[m],r[m+1],p);return p&&pm(p,p.next)&&(wy(p),p=p.next),p}function Np(r,e){if(!r)return r;e||(e=r);let a,s=r;do if(a=!1,s.steiner||!pm(s,s.next)&&Ki(s.prev,s,s.next)!==0)s=s.next;else{if(wy(s),s=e=s.prev,s===s.next)break;a=!0}while(a||s!==e);return e}function gy(r,e,a,s,c,p,m){if(!r)return;!m&&p&&function(L,N,R,T){let V=L;do V.z===0&&(V.z=Z_(V.x,V.y,N,R,T)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==L);V.prevZ.nextZ=null,V.prevZ=null,function(F){let O,Q=1;do{let $,K=F;F=null;let ie=null;for(O=0;K;){O++;let le=K,de=0;for(let Le=0;Le<Q&&(de++,le=le.nextZ,le);Le++);let Ee=Q;for(;de>0||Ee>0&&le;)de!==0&&(Ee===0||!le||K.z<=le.z)?($=K,K=K.nextZ,de--):($=le,le=le.nextZ,Ee--),ie?ie.nextZ=$:F=$,$.prevZ=ie,ie=$;K=le}ie.nextZ=null,Q*=2}while(O>1)}(V)}(r,s,c,p);let x=r;for(;r.prev!==r.next;){const L=r.prev,N=r.next;if(p?EE(r,s,c,p):NE(r))e.push(L.i,r.i,N.i),wy(r),r=N.next,x=N.next;else if((r=N)===x){m?m===1?gy(r=SE(Np(r),e),e,a,s,c,p,2):m===2&&zE(r,e,a,s,c,p):gy(Np(r),e,a,s,c,p,1);break}}}function NE(r){const e=r.prev,a=r,s=r.next;if(Ki(e,a,s)>=0)return!1;const c=e.x,p=a.x,m=s.x,x=e.y,L=a.y,N=s.y,R=Math.min(c,p,m),T=Math.min(x,L,N),V=Math.max(c,p,m),F=Math.max(x,L,N);let O=s.next;for(;O!==e;){if(O.x>=R&&O.x<=V&&O.y>=T&&O.y<=F&&_y(c,x,p,L,m,N,O.x,O.y)&&Ki(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function EE(r,e,a,s){const c=r.prev,p=r,m=r.next;if(Ki(c,p,m)>=0)return!1;const x=c.x,L=p.x,N=m.x,R=c.y,T=p.y,V=m.y,F=Math.min(x,L,N),O=Math.min(R,T,V),Q=Math.max(x,L,N),$=Math.max(R,T,V),K=Z_(F,O,e,a,s),ie=Z_(Q,$,e,a,s);let le=r.prevZ,de=r.nextZ;for(;le&&le.z>=K&&de&&de.z<=ie;){if(le.x>=F&&le.x<=Q&&le.y>=O&&le.y<=$&&le!==c&&le!==m&&_y(x,R,L,T,N,V,le.x,le.y)&&Ki(le.prev,le,le.next)>=0||(le=le.prevZ,de.x>=F&&de.x<=Q&&de.y>=O&&de.y<=$&&de!==c&&de!==m&&_y(x,R,L,T,N,V,de.x,de.y)&&Ki(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;le&&le.z>=K;){if(le.x>=F&&le.x<=Q&&le.y>=O&&le.y<=$&&le!==c&&le!==m&&_y(x,R,L,T,N,V,le.x,le.y)&&Ki(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;de&&de.z<=ie;){if(de.x>=F&&de.x<=Q&&de.y>=O&&de.y<=$&&de!==c&&de!==m&&_y(x,R,L,T,N,V,de.x,de.y)&&Ki(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function SE(r,e){let a=r;do{const s=a.prev,c=a.next.next;!pm(s,c)&&eb(s,a,a.next,c)&&xy(s,c)&&xy(c,s)&&(e.push(s.i,a.i,c.i),wy(a),wy(a.next),a=r=c),a=a.next}while(a!==r);return Np(a)}function zE(r,e,a,s,c,p){let m=r;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&ME(m,x)){let L=tb(m,x);return m=Np(m,m.next),L=Np(L,L.next),gy(m,e,a,s,c,p,0),void gy(L,e,a,s,c,p,0)}x=x.next}m=m.next}while(m!==r)}function AE(r,e){let a=r.x-e.x;return a===0&&(a=r.y-e.y,a===0)&&(a=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),a}function RE(r,e){const a=function(c,p){let m=p;const x=c.x,L=c.y;let N,R=-1/0;if(pm(c,m))return m;do{if(pm(c,m.next))return m.next;if(L<=m.y&&L>=m.next.y&&m.next.y!==m.y){const Q=m.x+(L-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(Q<=x&&Q>R&&(R=Q,N=m.x<m.next.x?m:m.next,Q===x))return N}m=m.next}while(m!==p);if(!N)return null;const T=N,V=N.x,F=N.y;let O=1/0;m=N;do{if(x>=m.x&&m.x>=V&&x!==m.x&&Kv(L<F?x:R,L,V,F,L<F?R:x,L,m.x,m.y)){const Q=Math.abs(L-m.y)/(x-m.x);xy(m,c)&&(Q<O||Q===O&&(m.x>N.x||m.x===N.x&&TE(N,m)))&&(N=m,O=Q)}m=m.next}while(m!==T);return N}(r,e);if(!a)return e;const s=tb(a,r);return Np(s,s.next),Np(a,a.next)}function TE(r,e){return Ki(r.prev,r,e.prev)<0&&Ki(e.next,r,r.next)<0}function Z_(r,e,a,s,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-a)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function VE(r){let e=r,a=r;do(e.x<a.x||e.x===a.x&&e.y<a.y)&&(a=e),e=e.next;while(e!==r);return a}function Kv(r,e,a,s,c,p,m,x){return(c-m)*(e-x)>=(r-m)*(p-x)&&(r-m)*(s-x)>=(a-m)*(e-x)&&(a-m)*(p-x)>=(c-m)*(s-x)}function _y(r,e,a,s,c,p,m,x){return!(r===m&&e===x)&&Kv(r,e,a,s,c,p,m,x)}function ME(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(a,s){let c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==s.i&&c.next.i!==s.i&&eb(c,c.next,a,s))return!0;c=c.next}while(c!==a);return!1}(r,e)&&(xy(r,e)&&xy(e,r)&&function(a,s){let c=a,p=!1;const m=(a.x+s.x)/2,x=(a.y+s.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&m<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next;while(c!==a);return p}(r,e)&&(Ki(r.prev,r,e.prev)||Ki(r,e.prev,e))||pm(r,e)&&Ki(r.prev,r,r.next)>0&&Ki(e.prev,e,e.next)>0)}function Ki(r,e,a){return(e.y-r.y)*(a.x-e.x)-(e.x-r.x)*(a.y-e.y)}function pm(r,e){return r.x===e.x&&r.y===e.y}function eb(r,e,a,s){const c=Bg(Ki(r,e,a)),p=Bg(Ki(r,e,s)),m=Bg(Ki(a,s,r)),x=Bg(Ki(a,s,e));return c!==p&&m!==x||!(c!==0||!Mg(r,a,e))||!(p!==0||!Mg(r,s,e))||!(m!==0||!Mg(a,r,s))||!(x!==0||!Mg(a,e,s))}function Mg(r,e,a){return e.x<=Math.max(r.x,a.x)&&e.x>=Math.min(r.x,a.x)&&e.y<=Math.max(r.y,a.y)&&e.y>=Math.min(r.y,a.y)}function Bg(r){return r>0?1:r<0?-1:0}function xy(r,e){return Ki(r.prev,r,r.next)<0?Ki(r,e,r.next)>=0&&Ki(r,r.prev,e)>=0:Ki(r,e,r.prev)<0||Ki(r,r.next,e)<0}function tb(r,e){const a=N_(r.i,r.x,r.y),s=N_(e.i,e.x,e.y),c=r.next,p=e.prev;return r.next=e,e.prev=r,a.next=c,c.prev=a,s.next=a,a.prev=s,p.next=s,s.prev=p,s}function ab(r,e,a,s){const c=N_(r,e,a);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function wy(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function N_(r,e,a){return{i:r,x:e,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function vy(r,e){const a=r.length;if(a<=1)return[r];const s=[];let c,p;for(let m=0;m<a;m++){const x=ar(r[m]);x!==0&&(r[m].area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(c&&s.push(c),c=[r[m]]):c.push(r[m]))}if(c&&s.push(c),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(nl(s[m],e,1,s[m].length-1,BE),s[m]=s[m].slice(0,e));return s}function BE(r,e){return e.area-r.area}function rb(r,e,a=1){if(!r)return null;const s=typeof r=="string"?Is.from(r).getPrimary():r.getPrimary(),c=typeof r=="string"?null:r.getSecondary();for(const p of[s,c]){if(!p)continue;const m=p.id.toString();e.has(m)||e.set(m,[]),p.scaleSelf(a),e.get(m).push(p)}return{primary:s.toString(),secondary:c?c.toString():null}}function E_(r,e,a,s){const c=s.patternDependencies;let p=!1;for(const m of e){const x=m.paint.get(`${r}-pattern`);x.isConstant()||(p=!0),rb(x.constantOr(null),c,a)&&(p=!0)}return p}function S_(r,e,a,s,c,p){const m=p.patternDependencies;for(const x of e){const L=x.paint.get(`${r}-pattern`).value;if(L.kind!=="constant"){let N=L.evaluate({zoom:s},a,{},p.availableImages);N=N&&N.name?N.name:N;const R=rb(N,m,c);if(!R)continue;const{primary:T,secondary:V}=R;T&&(a.patterns[x.id]=[T,V].filter(Boolean))}}return a}class nb{constructor(){this.polygons=new Map}add(e,...a){const s=this.polygons.get(e);s?s.push(...a):this.polygons.set(e,a)}merge(e){for(const[a,s]of e.polygons)this.add(a,...s)}}class Ph{constructor(){this.portals=[]}static isOnBorder(e,a){return e<=0&&a<=0||e>=Dt&&a>=Dt}static evaluate(e){if(e.length===0)return new Ph;let a=[];for(const L of e)a.push(...L.portals);if(a.length===0)return new Ph;for(const L of a){const N=L.va,R=L.vb;(Ph.isOnBorder(N.x,R.x)||Ph.isOnBorder(N.y,R.y))&&(L.type="border")}const s=a.filter(L=>L.type!=="unevaluated"),c=a.filter(L=>L.type==="unevaluated");if(c.length===0)return new Ph;c.sort((L,N)=>L.hash===N.hash?L.isTunnel===N.isTunnel?0:L.isTunnel?-1:1:L.hash<N.hash?1:-1),a=s.concat(c);let p=s.length,m=p,x=p;do if(m++,m===a.length||a[p].hash!==a[m].hash){if(m-p==2){x<p&&(a[x]=a[p],a[p]=null);const L=a[x],N=a[m-1];L.type=L.isTunnel!==N.isTunnel?"tunnel":"polygon",L.connection={a:L.connection.a,b:N.connection.a},x++}p=m}while(p!==a.length);return a.splice(x),a.sort((L,N)=>L.hash<N.hash?1:-1),{portals:a}}}na(Ph,"ElevationPortalGraph"),na(nb,"ElevationPolygons");class IE{constructor(e,a,s){this.outPositions=e,this.outNormals=a,this.outIndices=s,this.vertexLookup=new Map}addVertex(e,a,s){let c=e[2];s!=null&&(c*=s);const p=`${e[0]},${e[1]},${e[2]},${a[0]},${a[1]},${a[2]}`,m=this.vertexLookup.get(p);if(m!=null)return m;const x=this.outPositions.length;this.vertexLookup.set(p,x);const L=Math.trunc(16384*a[0]),N=Math.trunc(16384*a[1]),R=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(L,N,R),x}addTriangle(e,a,s){this.outIndices.emplaceBack(e,a,s)}addTriangles(e,a,s){if(e.length===0)return;const c=s.length===1,p=Ke(),m=Ke();for(let x=0;x<e.length;x+=3){const L=a[e[x+0]],N=a[e[x+1]],R=a[e[x+2]],T=c?s[0]:s[e[x+1]],V=c?s[0]:s[e[x+2]];qt(p,L.x,L.y,c?s[0]:s[e[x+0]]);const F=this.addVertex(p,m);qt(p,N.x,N.y,T);const O=this.addVertex(p,m);qt(p,R.x,R.y,V);const Q=this.addVertex(p,m);this.outIndices.emplaceBack(F,O,Q)}}addQuad(e,a,s,c,p,m){const x=this.addVertex(e,p,m),L=this.addVertex(a,p,m),N=this.addVertex(s,p,m),R=this.addVertex(c,p,m);this.addTriangle(x,L,N),this.addTriangle(N,R,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class yl{constructor(e,a,s,c){this.unevaluatedPortals=new Ph,this.portalPolygons=new nb,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new zd,this.vertexNormals=new Nf,this.indexArray=new gn,this.tileToMeters=Se(e),this.bridgeProgramConfigurations=new io(a,{zoom:s,lut:c},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new io(a,{zoom:s,lut:c},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,a){const s=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(a[c]);return s}addTriangles(e,a,s){const c=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)c.push(p+a)}addRenderableRing(e,a,s,c,p,m){const x=[new St(p.min.x,p.min.y),new St(p.max.x,p.min.y),new St(p.max.x,p.max.y),new St(p.min.x,p.max.y)];for(let L=0;L<s-1;L++){const N=a+L,R=N+1,T=this.unevalVertices[N],V=this.unevalVertices[R];if(!(T.x>=p.min.x&&T.x<=p.max.x&&T.y>=p.min.y&&T.y<=p.max.y||V.x>=p.min.x&&V.x<=p.max.x&&V.y>=p.min.y&&V.y<=p.max.y||Cn(T,V,x))||this.isOnBorder(T.x,V.x)||this.isOnBorder(T.y,V.y))continue;const F=yl.computeEdgeHash(this.unevalVertices[N],this.unevalVertices[R]);let O,Q=this.vertexHashLookup.get(yl.computePosHash(T));Q!=null?O=Q.next:(Q=this.vertexHashLookup.get(yl.computePosHash(V)),O=Q!=null?Q.prev:F),this.unevalEdges.push({polygonIdx:e,a:N,b:R,hash:F,portalHash:O,isTunnel:c,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,a,s,c,p){if(a.length===0)return;this.portalPolygons.add(e,{geometry:a,zLevel:p});const m=a[0];this.vertexHashLookup.clear();let x=yl.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let L=0;L<m.length-1;L++){const N=m[L+0],R=m[L+1],T=co(R.x-N.x,R.y-N.y),V=Ln(T);if(V===0)continue;let F="unevaluated";const O=c.pointElevation(N),Q=c.pointElevation(R);Math.abs(O)<.01&&Math.abs(Q)<.01?F="entrance":(this.isOnBorder(N.x,R.x)||this.isOnBorder(N.y,R.y))&&(F="border");const $=yl.computeEdgeHash(N,R);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:N,vb:R,vab:T,length:V,hash:$,isTunnel:s,type:F});const K=yl.computePosHash(N);this.vertexHashLookup.set(K,{prev:x,next:$}),x=$}}construct(e){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=V=>{V.primitiveLength=this.indexArray.length-V.primitiveOffset},c=new IE(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=a(),m=a(),x=a(),L=(V,F)=>{V.sort((Q,$)=>Q.type===F&&$.type!==F?-1:Q.type!==F&&$.type===F?1:0);const O=V.findIndex(Q=>Q.type!==F);return O>=0?O:V.length};let N=0;this.unevalEdges.length>0&&(N=L(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},this.tileToMeters)),s(x);const R=a(),T=a();if(this.unevalEdges.length>0){const V=this.unevalEdges.splice(N),F=L(V,"tunnel")+N;this.unevalEdges.push(...V),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},{min:N,max:F})}s(R),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(T),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(m),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(p),this.maskSegments=Ar.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.depthSegments=Ar.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=Ar.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=Ar.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.shadowCasterSegments=Ar.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,a,s,c,p,m,x,L){this.bridgeProgramConfigurations.updatePaintArrays(e,a,p,s,c,m,x,L),this.tunnelProgramConfigurations.updatePaintArrays(e,a,p,s,c,m,x,L)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,jE.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,ZE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,a,s,c,p){const m=(x,L)=>{for(let N=0;N<L.length-1;N++){const R=L[N].featureIndex,T=L[N+1].vertexStart,V=e.feature(R);x.populatePaintArrays(T,V,R,{},s,a,c,void 0,p)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,a,s,c,p){const m=new Map;for(let x=c;x<p;x++){const L=s[x],N=L.a,R=L.b,T=yl.computePosHash(e[N]),V=yl.computePosHash(e[R]);let F=m.get(T);F||(F={},m.set(T,F));let O=m.get(V);O||(O={},m.set(V,O)),a[N]<=0&&a[R]<=0||(F.to=R,O.from=N)}return m}isTerminalVertex(e,a){const s=yl.computePosHash(this.unevalVertices[e]),c=a.get(s);return!c||!c.from||!c.to}constructBridgeStructures(e,a,s,c,p,m){e.clearVertexLookup();const x=this.computeVertexConnections(a,s,c,p.min,p.max),L=1/m,N=.5*L,R=(Pt,At)=>qt(Pt,a[At].x,a[At].y,s[At]*L),T=Ke(),V=Ke(),F=Ke(),O=Ke(),Q=Ke(),$=(Pt,At)=>{const xt=x.get(yl.computePosHash(a[At])),zt=xt.from,nt=xt.to;if(!zt||!nt)return;R(T,zt),R(V,At),R(F,nt),Gn(O),rn(T,V)||(Sr(Q,V,T),ka(O,Q)),rn(F,V)||(Sr(Q,F,V),Lt(O,O,ka(Q,Q)));const rt=di(O);return rt>0?Be(Pt,O,1/rt):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(c,p.min,p.max,(Pt,At)=>Pt.featureInfo.featureIndex-At.featureInfo.featureIndex);const ie=Ke(),le=Ke(),de=Ke(),Ee=Ke(),Le=Ke(),Ae=Ke(),Me=Ke(),Je=Ke(),ot=Ke(),We=[Ke(),Ke(),Ke(),Ke()],ut=[Ke(),Ke(),Ke(),Ke()],_t=[{coord:new St(0,0),height:0},{coord:new St(0,0),height:0}],Zt=(Pt,At)=>Pt>At;for(let Pt=p.min;Pt<p.max;Pt++){const At=c[Pt];if(!At.featureInfo.guardRailEnabled||!this.prepareEdgePoints(_t,a,s,At,Zt))continue;const[xt,zt]=_t;if(qt(ie,xt.coord.x,xt.coord.y,L*xt.height),qt(le,zt.coord.x,zt.coord.y,L*zt.height),rn(ie,le))continue;Sr(de,le,ie),ka(de,de);const nt=$(Je,At.a)||de,rt=$(ot,At.b)||de;qt(Ee,nt[1],-nt[0],0),ka(Ee,Ee),qt(Le,rt[1],-rt[0],0),ka(Le,Le),Pn(Je,Ee,nt),ka(Ae,Je),Pn(Je,Le,rt),ka(Me,Je),Lt(We[0],ie,Be(Je,Sr(Je,Ee,Ae),N)),Lt(We[1],ie,Be(Je,Lt(Je,Ee,Ae),N)),Lt(We[2],ie,Be(Je,Ae,N)),We[3]=ie,Lt(ut[0],le,Be(Je,Sr(Je,Le,Me),N)),Lt(ut[1],le,Be(Je,Lt(Je,Le,Me),N)),Lt(ut[2],le,Be(Je,Me,N)),ut[3]=le,K=this.addFeatureSection(At.featureInfo.featureIndex,K,this.bridgeFeatureSections,e);const Et=e.addVertex(We[0],Ee,m),Jt=e.addVertex(We[1],Ee,m),vt=e.addVertex(ut[0],Le,m),sa=e.addVertex(ut[1],Le,m);e.addTriangle(Et,Jt,vt),e.addTriangle(Jt,sa,vt);const ua=e.addVertex(We[1],Ae,m),ta=e.addVertex(We[2],Ae,m),Yt=e.addVertex(ut[1],Me,m),Fa=e.addVertex(ut[2],Me,m);e.addTriangle(ua,ta,Yt),e.addTriangle(ta,Fa,Yt),or(Ee,Ee),or(Le,Le);const ea=e.addVertex(We[2],Ee,m),ja=e.addVertex(We[3],Ee,m),Da=e.addVertex(ut[2],Le,m),nr=e.addVertex(ut[3],Le,m);e.addTriangle(ea,ja,Da),e.addTriangle(ja,nr,Da);const Zr=this.isTerminalVertex(At.a,x),Pa=this.isTerminalVertex(At.b,x);xt.height<.01&&Zr&&e.addQuad(We[3],We[2],We[1],We[0],or(nt,nt),m),zt.height<.01&&Pa&&e.addQuad(ut[0],ut[1],ut[2],ut[3],rt,m)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,a,s,c,p,m){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const L=(K,ie)=>K.featureInfo.featureIndex-ie.featureInfo.featureIndex;this.sortSubarray(c,p.min,p.max,L),this.sortSubarray(c,m.min,m.max,L);const N=K=>ka(K,K),R=[{coord:new St(0,0),height:0},{coord:new St(0,0),height:0}],T=(K,ie)=>K<ie,V=Ke(),F=Ke(),O=Ke(),Q=Ke(),$=Ke();for(let K=p.min;K<p.max;K++){if(!this.prepareEdgePoints(R,a,s,c[K],T))continue;const[ie,le]=R,de=N(qt($,-(le.coord.y-ie.coord.y),le.coord.x-ie.coord.x,0));x=this.addFeatureSection(c[K].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(qt(V,ie.coord.x,ie.coord.y,ie.height),qt(F,le.coord.x,le.coord.y,le.height),qt(O,le.coord.x,le.coord.y,c[K].isTunnel?-.1:0),qt(Q,ie.coord.x,ie.coord.y,c[K].isTunnel?-.1:0),de)}for(let K=m.min;K<m.max;K++){const ie=c[K];ie.isTunnel&&([ie.a,ie.b]=[ie.b,ie.a]);const le=a[ie.a],de=a[ie.b],Ee=N(qt($,-(de.y-le.y),de.x-le.x,0));x=this.addFeatureSection(ie.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(qt(V,de.x,de.y,0),qt(F,le.x,le.y,0),qt(O,le.x,le.y,s[ie.a]+4),qt(Q,de.x,de.y,s[ie.b]+4),Ee),e.addQuad(qt(V,le.x,le.y,0),qt(F,de.x,de.y,0),qt(O,de.x,de.y,s[ie.b]+4),qt(Q,le.x,le.y,s[ie.a]+4),Ee)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,a,s,c){e.coord.x=a,e.coord.y=s,e.height=c}prepareEdgePoints(e,a,s,c,p){let m=a[c.a].x,x=a[c.a].y,L=a[c.b].x,N=a[c.b].y,R=s[c.a],T=s[c.b];const V=p(R,0),F=p(T,0);if(V&&F)return this.setElevatedPoint(e[0],m,x,R),this.setElevatedPoint(e[1],L,N,T),!0;if(!V&&!F)return!1;if(V){if(!F){const O=T/(T-R);L=Sa(L,m,O),N=Sa(N,x,O),T=Sa(T,R,O)}}else{const O=R/(R-T);m=Sa(m,L,O),x=Sa(x,N,O),R=Sa(R,T,O)}return this.setElevatedPoint(e[0],m,x,R),this.setElevatedPoint(e[1],L,N,T),!0}prepareEdges(e,a){if(a.length===0)return;a.sort((x,L)=>x.hash===L.hash?L.polygonIdx-x.polygonIdx:L.hash>x.hash?1:-1);let s=0,c=0,p=0,m=a[s].polygonIdx;do c++,(c===a.length||a[s].hash!==a[c].hash)&&((c-s==1||a[c-1].polygonIdx!==m)&&(p<s&&(a[p]=a[s],a[s]=null),a[p].type="none",p++),s=c,s!==a.length&&(m=a[s].polygonIdx));while(s!==a.length);if(a.splice(p),a.length!==0&&e.length!==0){a.sort((N,R)=>N.portalHash<R.portalHash?1:-1);let x=0,L=0;for(;x!==a.length&&L!==e.length;){const N=a[x],R=e[L];N.portalHash>R.hash?x++:R.hash>N.portalHash?L++:(N.type=R.type,x++)}}}isOnBorder(e,a){return e<=0&&a<=0||e>=Dt&&a>=Dt}addFeatureSection(e,a,s,c){return e!==a&&(a=e,s.push({featureIndex:e,vertexStart:c.getVertexCount()}),c.clearVertexLookup()),a}sortSubarray(e,a,s,c){const p=e.slice(a,s);p.sort(c),e.splice(a,p.length,...p)}static computeEdgeHash(e,a){return(e.y===a.y&&e.x>a.x||e.y>a.y)&&([e,a]=[a,e]),BigInt(yl.computePosHash(e))<<32n|BigInt(yl.computePosHash(a))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var ib,sb={exports:{}},ob=(ib||(ib=1,function(r,e){(function(a){function s(je,_e){return je>_e?1:je<_e?-1:0}var c=function(je,_e){je===void 0&&(je=s),_e===void 0&&(_e=!1),this._compare=je,this._root=null,this._size=0,this._noDuplicates=!!_e},p={size:{configurable:!0}};function m(je,_e,ft,Xt,pt){var $t=pt-Xt;if($t>0){var pa=Xt+Math.floor($t/2),fa={key:_e[pa],data:ft[pa],parent:je};return fa.left=m(fa,_e,ft,Xt,pa),fa.right=m(fa,_e,ft,pa+1,pt),fa}return null}function x(je,_e,ft,Xt,pt){if(!(ft>=Xt)){for(var $t=je[ft+Xt>>1],pa=ft-1,fa=Xt+1;;){do pa++;while(pt(je[pa],$t)<0);do fa--;while(pt(je[fa],$t)>0);if(pa>=fa)break;var Xa=je[pa];je[pa]=je[fa],je[fa]=Xa,Xa=_e[pa],_e[pa]=_e[fa],_e[fa]=Xa}x(je,_e,ft,fa,pt),x(je,_e,fa+1,Xt,pt)}}c.prototype.rotateLeft=function(je){var _e=je.right;_e&&(je.right=_e.left,_e.left&&(_e.left.parent=je),_e.parent=je.parent),je.parent?je===je.parent.left?je.parent.left=_e:je.parent.right=_e:this._root=_e,_e&&(_e.left=je),je.parent=_e},c.prototype.rotateRight=function(je){var _e=je.left;_e&&(je.left=_e.right,_e.right&&(_e.right.parent=je),_e.parent=je.parent),je.parent?je===je.parent.left?je.parent.left=_e:je.parent.right=_e:this._root=_e,_e&&(_e.right=je),je.parent=_e},c.prototype._splay=function(je){for(;je.parent;){var _e=je.parent;_e.parent?_e.left===je&&_e.parent.left===_e?(this.rotateRight(_e.parent),this.rotateRight(_e)):_e.right===je&&_e.parent.right===_e?(this.rotateLeft(_e.parent),this.rotateLeft(_e)):_e.left===je&&_e.parent.right===_e?(this.rotateRight(_e),this.rotateLeft(_e)):(this.rotateLeft(_e),this.rotateRight(_e)):_e.left===je?this.rotateRight(_e):this.rotateLeft(_e)}},c.prototype.splay=function(je){for(var _e,ft,Xt,pt,$t;je.parent;)(ft=(_e=je.parent).parent)&&ft.parent?((Xt=ft.parent).left===ft?Xt.left=je:Xt.right=je,je.parent=Xt):(je.parent=null,this._root=je),pt=je.left,$t=je.right,je===_e.left?(ft&&(ft.left===_e?(_e.right?(ft.left=_e.right,ft.left.parent=ft):ft.left=null,_e.right=ft,ft.parent=_e):(pt?(ft.right=pt,pt.parent=ft):ft.right=null,je.left=ft,ft.parent=je)),$t?(_e.left=$t,$t.parent=_e):_e.left=null,je.right=_e,_e.parent=je):(ft&&(ft.right===_e?(_e.left?(ft.right=_e.left,ft.right.parent=ft):ft.right=null,_e.left=ft,ft.parent=_e):($t?(ft.left=$t,$t.parent=ft):ft.left=null,je.right=ft,ft.parent=je)),pt?(_e.right=pt,pt.parent=_e):_e.right=null,je.left=_e,_e.parent=je)},c.prototype.replace=function(je,_e){je.parent?je===je.parent.left?je.parent.left=_e:je.parent.right=_e:this._root=_e,_e&&(_e.parent=je.parent)},c.prototype.minNode=function(je){if(je===void 0&&(je=this._root),je)for(;je.left;)je=je.left;return je},c.prototype.maxNode=function(je){if(je===void 0&&(je=this._root),je)for(;je.right;)je=je.right;return je},c.prototype.insert=function(je,_e){var ft=this._root,Xt=null,pt=this._compare;if(this._noDuplicates)for(;ft;){if(Xt=ft,pt(ft.key,je)===0)return;ft=pt(ft.key,je)<0?ft.right:ft.left}else for(;ft;)Xt=ft,ft=pt(ft.key,je)<0?ft.right:ft.left;return ft={key:je,data:_e,left:null,right:null,parent:Xt},Xt?pt(Xt.key,ft.key)<0?Xt.right=ft:Xt.left=ft:this._root=ft,this.splay(ft),this._size++,ft},c.prototype.find=function(je){for(var _e=this._root,ft=this._compare;_e;){var Xt=ft(_e.key,je);if(Xt<0)_e=_e.right;else{if(!(Xt>0))return _e;_e=_e.left}}return null},c.prototype.contains=function(je){for(var _e=this._root,ft=this._compare;_e;){var Xt=ft(je,_e.key);if(Xt===0)return!0;_e=Xt<0?_e.left:_e.right}return!1},c.prototype.remove=function(je){var _e=this.find(je);if(!_e)return!1;if(this.splay(_e),_e.left)if(_e.right){var ft=this.minNode(_e.right);ft.parent!==_e&&(this.replace(ft,ft.right),ft.right=_e.right,ft.right.parent=ft),this.replace(_e,ft),ft.left=_e.left,ft.left.parent=ft}else this.replace(_e,_e.left);else this.replace(_e,_e.right);return this._size--,!0},c.prototype.removeNode=function(je){if(!je)return!1;if(this.splay(je),je.left)if(je.right){var _e=this.minNode(je.right);_e.parent!==je&&(this.replace(_e,_e.right),_e.right=je.right,_e.right.parent=_e),this.replace(je,_e),_e.left=je.left,_e.left.parent=_e}else this.replace(je,je.left);else this.replace(je,je.right);return this._size--,!0},c.prototype.erase=function(je){var _e=this.find(je);if(_e){this.splay(_e);var ft=_e.left,Xt=_e.right,pt=null;ft&&(ft.parent=null,pt=this.maxNode(ft),this.splay(pt),this._root=pt),Xt&&(ft?pt.right=Xt:this._root=Xt,Xt.parent=pt),this._size--}},c.prototype.pop=function(){var je=this._root,_e=null;if(je){for(;je.left;)je=je.left;_e={key:je.key,data:je.data},this.remove(je.key)}return _e},c.prototype.next=function(je){var _e=je;if(_e)if(_e.right)for(_e=_e.right;_e&&_e.left;)_e=_e.left;else for(_e=je.parent;_e&&_e.right===je;)je=_e,_e=_e.parent;return _e},c.prototype.prev=function(je){var _e=je;if(_e)if(_e.left)for(_e=_e.left;_e&&_e.right;)_e=_e.right;else for(_e=je.parent;_e&&_e.left===je;)je=_e,_e=_e.parent;return _e},c.prototype.forEach=function(je){for(var _e=this._root,ft=[],Xt=!1,pt=0;!Xt;)_e?(ft.push(_e),_e=_e.left):ft.length>0?(je(_e=ft.pop(),pt++),_e=_e.right):Xt=!0;return this},c.prototype.range=function(je,_e,ft,Xt){for(var pt=[],$t=this._compare,pa=this._root;pt.length!==0||pa;)if(pa)pt.push(pa),pa=pa.left;else{if($t((pa=pt.pop()).key,_e)>0)break;if($t(pa.key,je)>=0&&ft.call(Xt,pa))return this;pa=pa.right}return this},c.prototype.keys=function(){for(var je=this._root,_e=[],ft=[],Xt=!1;!Xt;)je?(_e.push(je),je=je.left):_e.length>0?(je=_e.pop(),ft.push(je.key),je=je.right):Xt=!0;return ft},c.prototype.values=function(){for(var je=this._root,_e=[],ft=[],Xt=!1;!Xt;)je?(_e.push(je),je=je.left):_e.length>0?(je=_e.pop(),ft.push(je.data),je=je.right):Xt=!0;return ft},c.prototype.at=function(je){for(var _e=this._root,ft=[],Xt=!1,pt=0;!Xt;)if(_e)ft.push(_e),_e=_e.left;else if(ft.length>0){if(_e=ft.pop(),pt===je)return _e;pt++,_e=_e.right}else Xt=!0;return null},c.prototype.load=function(je,_e,ft){if(je===void 0&&(je=[]),_e===void 0&&(_e=[]),ft===void 0&&(ft=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Xt=je.length;return ft&&x(je,_e,0,Xt-1,this._compare),this._root=m(null,je,_e,0,Xt),this._size=Xt,this},c.prototype.min=function(){var je=this.minNode(this._root);return je?je.key:null},c.prototype.max=function(){var je=this.maxNode(this._root);return je?je.key:null},c.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},c.createTree=function(je,_e,ft,Xt,pt){return new c(ft,pt).load(je,_e,Xt)},Object.defineProperties(c.prototype,p);var L=0,N=1,R=2,T=3,V=0,F=1,O=2,Q=3;function $(je,_e,ft){_e===null?(je.inOut=!1,je.otherInOut=!0):(je.isSubject===_e.isSubject?(je.inOut=!_e.inOut,je.otherInOut=_e.otherInOut):(je.inOut=!_e.otherInOut,je.otherInOut=_e.isVertical()?!_e.inOut:_e.inOut),_e&&(je.prevInResult=!K(_e,ft)||_e.isVertical()?_e.prevInResult:_e));var Xt=K(je,ft);je.resultTransition=Xt?function(pt,$t){var pa,fa=!pt.inOut,Xa=!pt.otherInOut;switch($t){case V:pa=fa&&Xa;break;case F:pa=fa||Xa;break;case Q:pa=fa^Xa;break;case O:pa=pt.isSubject?fa&&!Xa:Xa&&!fa}return pa?1:-1}(je,ft):0}function K(je,_e){switch(je.type){case L:switch(_e){case V:return!je.otherInOut;case F:return je.otherInOut;case O:return je.isSubject&&je.otherInOut||!je.isSubject&&!je.otherInOut;case Q:return!0}break;case R:return _e===V||_e===F;case T:return _e===O;case N:return!1}return!1}var ie=function(je,_e,ft,Xt,pt){this.left=_e,this.point=je,this.otherEvent=ft,this.isSubject=Xt,this.type=pt||L,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},le={inResult:{configurable:!0}};function de(je,_e){return je[0]===_e[0]&&je[1]===_e[1]}ie.prototype.isBelow=function(je){var _e=this.point,ft=this.otherEvent.point;return this.left?(_e[0]-je[0])*(ft[1]-je[1])-(ft[0]-je[0])*(_e[1]-je[1])>0:(ft[0]-je[0])*(_e[1]-je[1])-(_e[0]-je[0])*(ft[1]-je[1])>0},ie.prototype.isAbove=function(je){return!this.isBelow(je)},ie.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},le.inResult.get=function(){return this.resultTransition!==0},ie.prototype.clone=function(){var je=new ie(this.point,this.left,this.otherEvent,this.isSubject,this.type);return je.contourId=this.contourId,je.resultTransition=this.resultTransition,je.prevInResult=this.prevInResult,je.isExteriorRing=this.isExteriorRing,je.inOut=this.inOut,je.otherInOut=this.otherInOut,je},Object.defineProperties(ie.prototype,le);var Ee=11102230246251565e-32,Le=134217729,Ae=(3+8*Ee)*Ee;function Me(je,_e,ft,Xt,pt){var $t,pa,fa,Xa,Aa=_e[0],da=Xt[0],Vr=0,tn=0;da>Aa==da>-Aa?($t=Aa,Aa=_e[++Vr]):($t=da,da=Xt[++tn]);var Ma=0;if(Vr<je&&tn<ft)for(da>Aa==da>-Aa?(fa=$t-((pa=Aa+$t)-Aa),Aa=_e[++Vr]):(fa=$t-((pa=da+$t)-da),da=Xt[++tn]),$t=pa,fa!==0&&(pt[Ma++]=fa);Vr<je&&tn<ft;)da>Aa==da>-Aa?(fa=$t-((pa=$t+Aa)-(Xa=pa-$t))+(Aa-Xa),Aa=_e[++Vr]):(fa=$t-((pa=$t+da)-(Xa=pa-$t))+(da-Xa),da=Xt[++tn]),$t=pa,fa!==0&&(pt[Ma++]=fa);for(;Vr<je;)fa=$t-((pa=$t+Aa)-(Xa=pa-$t))+(Aa-Xa),Aa=_e[++Vr],$t=pa,fa!==0&&(pt[Ma++]=fa);for(;tn<ft;)fa=$t-((pa=$t+da)-(Xa=pa-$t))+(da-Xa),da=Xt[++tn],$t=pa,fa!==0&&(pt[Ma++]=fa);return $t===0&&Ma!==0||(pt[Ma++]=$t),Ma}function Je(je){return new Float64Array(je)}var ot=33306690738754716e-32,We=22204460492503146e-32,ut=11093356479670487e-47,_t=Je(4),Zt=Je(8),Pt=Je(12),At=Je(16),xt=Je(4);function zt(je,_e,ft){var Xt=function(pt,$t,pa,fa,Xa,Aa){var da=($t-Aa)*(pa-Xa),Vr=(pt-Xa)*(fa-Aa),tn=da-Vr;if(da===0||Vr===0||da>0!=Vr>0)return tn;var Ma=Math.abs(da+Vr);return Math.abs(tn)>=ot*Ma?tn:-function(Lr,an,Ur,Un,Zn,hn,qr){var kr,Qa,Jr,fn,Ra,Nr,Nn,Kn,ci,zi,En,bi,Wo,Li,_l,As,yc,Xo,xl=Lr-Zn,Rs=Ur-Zn,wl=an-hn,gc=Un-hn;_t[0]=(_l=(Kn=xl-(Nn=(Nr=Le*xl)-(Nr-xl)))*(zi=gc-(ci=(Nr=Le*gc)-(Nr-gc)))-((Li=xl*gc)-Nn*ci-Kn*ci-Nn*zi))-((En=_l-(yc=(Kn=wl-(Nn=(Nr=Le*wl)-(Nr-wl)))*(zi=Rs-(ci=(Nr=Le*Rs)-(Nr-Rs)))-((As=wl*Rs)-Nn*ci-Kn*ci-Nn*zi)))+(Ra=_l-En))+(Ra-yc),_t[1]=(Wo=Li-((bi=Li+En)-(Ra=bi-Li))+(En-Ra))-((En=Wo-As)+(Ra=Wo-En))+(Ra-As),_t[2]=bi-((Xo=bi+En)-(Ra=Xo-bi))+(En-Ra),_t[3]=Xo;var ls=function(Gf,Ud){for(var j0=Ud[0],Vm=1;Vm<4;Vm++)j0+=Ud[Vm];return j0}(0,_t),oo=We*qr;if(ls>=oo||-ls>=oo||(kr=Lr-(xl+(Ra=Lr-xl))+(Ra-Zn),Jr=Ur-(Rs+(Ra=Ur-Rs))+(Ra-Zn),Qa=an-(wl+(Ra=an-wl))+(Ra-hn),fn=Un-(gc+(Ra=Un-gc))+(Ra-hn),kr===0&&Qa===0&&Jr===0&&fn===0)||(oo=ut*qr+Ae*Math.abs(ls),(ls+=xl*fn+gc*kr-(wl*Jr+Rs*Qa))>=oo||-ls>=oo))return ls;xt[0]=(_l=(Kn=kr-(Nn=(Nr=Le*kr)-(Nr-kr)))*(zi=gc-(ci=(Nr=Le*gc)-(Nr-gc)))-((Li=kr*gc)-Nn*ci-Kn*ci-Nn*zi))-((En=_l-(yc=(Kn=Qa-(Nn=(Nr=Le*Qa)-(Nr-Qa)))*(zi=Rs-(ci=(Nr=Le*Rs)-(Nr-Rs)))-((As=Qa*Rs)-Nn*ci-Kn*ci-Nn*zi)))+(Ra=_l-En))+(Ra-yc),xt[1]=(Wo=Li-((bi=Li+En)-(Ra=bi-Li))+(En-Ra))-((En=Wo-As)+(Ra=Wo-En))+(Ra-As),xt[2]=bi-((Xo=bi+En)-(Ra=Xo-bi))+(En-Ra),xt[3]=Xo;var Gd=Me(4,_t,4,xt,Zt);xt[0]=(_l=(Kn=xl-(Nn=(Nr=Le*xl)-(Nr-xl)))*(zi=fn-(ci=(Nr=Le*fn)-(Nr-fn)))-((Li=xl*fn)-Nn*ci-Kn*ci-Nn*zi))-((En=_l-(yc=(Kn=wl-(Nn=(Nr=Le*wl)-(Nr-wl)))*(zi=Jr-(ci=(Nr=Le*Jr)-(Nr-Jr)))-((As=wl*Jr)-Nn*ci-Kn*ci-Nn*zi)))+(Ra=_l-En))+(Ra-yc),xt[1]=(Wo=Li-((bi=Li+En)-(Ra=bi-Li))+(En-Ra))-((En=Wo-As)+(Ra=Wo-En))+(Ra-As),xt[2]=bi-((Xo=bi+En)-(Ra=Xo-bi))+(En-Ra),xt[3]=Xo;var Pf=Me(Gd,Zt,4,xt,Pt);xt[0]=(_l=(Kn=kr-(Nn=(Nr=Le*kr)-(Nr-kr)))*(zi=fn-(ci=(Nr=Le*fn)-(Nr-fn)))-((Li=kr*fn)-Nn*ci-Kn*ci-Nn*zi))-((En=_l-(yc=(Kn=Qa-(Nn=(Nr=Le*Qa)-(Nr-Qa)))*(zi=Jr-(ci=(Nr=Le*Jr)-(Nr-Jr)))-((As=Qa*Jr)-Nn*ci-Kn*ci-Nn*zi)))+(Ra=_l-En))+(Ra-yc),xt[1]=(Wo=Li-((bi=Li+En)-(Ra=bi-Li))+(En-Ra))-((En=Wo-As)+(Ra=Wo-En))+(Ra-As),xt[2]=bi-((Xo=bi+En)-(Ra=Xo-bi))+(En-Ra),xt[3]=Xo;var Tm=Me(Pf,Pt,4,xt,At);return At[Tm-1]}(pt,$t,pa,fa,Xa,Aa,Ma)}(je[0],je[1],_e[0],_e[1],ft[0],ft[1]);return Xt>0?-1:Xt<0?1:0}function nt(je,_e){var ft=je.point,Xt=_e.point;return ft[0]>Xt[0]?1:ft[0]<Xt[0]?-1:ft[1]!==Xt[1]?ft[1]>Xt[1]?1:-1:function(pt,$t,pa,fa){return pt.left!==$t.left?pt.left?1:-1:zt(pa,pt.otherEvent.point,$t.otherEvent.point)!==0?pt.isBelow($t.otherEvent.point)?-1:1:!pt.isSubject&&$t.isSubject?1:-1}(je,_e,ft)}function rt(je,_e,ft){var Xt=new ie(_e,!1,je,je.isSubject),pt=new ie(_e,!0,je.otherEvent,je.isSubject);return de(je.point,je.otherEvent.point)&&console.warn("what is that, a collapsed segment?",je),Xt.contourId=pt.contourId=je.contourId,nt(pt,je.otherEvent)>0&&(je.otherEvent.left=!0,pt.left=!1),je.otherEvent.otherEvent=pt,je.otherEvent=Xt,ft.push(pt),ft.push(Xt),ft}function Et(je,_e){return je[0]*_e[1]-je[1]*_e[0]}function Jt(je,_e){return je[0]*_e[0]+je[1]*_e[1]}function vt(je,_e,ft){var Xt=function(Xa,Aa,da,Vr,tn){var Ma=[Aa[0]-Xa[0],Aa[1]-Xa[1]],Lr=[Vr[0]-da[0],Vr[1]-da[1]];function an(Nr,Nn,Kn){return[Nr[0]+Nn*Kn[0],Nr[1]+Nn*Kn[1]]}var Ur=[da[0]-Xa[0],da[1]-Xa[1]],Un=Et(Ma,Lr),Zn=Un*Un,hn=Jt(Ma,Ma);if(Zn>0){var qr=Et(Ur,Lr)/Un;if(qr<0||qr>1)return null;var kr=Et(Ur,Ma)/Un;return kr<0||kr>1?null:qr===0||qr===1?[an(Xa,qr,Ma)]:kr===0||kr===1?[an(da,kr,Lr)]:[an(Xa,qr,Ma)]}if((Zn=(Un=Et(Ur,Ma))*Un)>0)return null;var Qa=Jt(Ma,Ur)/hn,Jr=Qa+Jt(Ma,Lr)/hn,fn=Math.min(Qa,Jr),Ra=Math.max(Qa,Jr);return fn<=1&&Ra>=0?fn===1?[an(Xa,fn>0?fn:0,Ma)]:Ra===0?[an(Xa,Ra<1?Ra:1,Ma)]:[an(Xa,fn>0?fn:0,Ma),an(Xa,Ra<1?Ra:1,Ma)]:null}(je.point,je.otherEvent.point,_e.point,_e.otherEvent.point),pt=Xt?Xt.length:0;if(pt===0||pt===1&&(de(je.point,_e.point)||de(je.otherEvent.point,_e.otherEvent.point))||pt===2&&je.isSubject===_e.isSubject)return 0;if(pt===1)return de(je.point,Xt[0])||de(je.otherEvent.point,Xt[0])||rt(je,Xt[0],ft),de(_e.point,Xt[0])||de(_e.otherEvent.point,Xt[0])||rt(_e,Xt[0],ft),1;var $t=[],pa=!1,fa=!1;return de(je.point,_e.point)?pa=!0:nt(je,_e)===1?$t.push(_e,je):$t.push(je,_e),de(je.otherEvent.point,_e.otherEvent.point)?fa=!0:nt(je.otherEvent,_e.otherEvent)===1?$t.push(_e.otherEvent,je.otherEvent):$t.push(je.otherEvent,_e.otherEvent),pa&&fa||pa?(_e.type=N,je.type=_e.inOut===je.inOut?R:T,pa&&!fa&&rt($t[1].otherEvent,$t[0].point,ft),2):fa?(rt($t[0],$t[1].point,ft),3):$t[0]!==$t[3].otherEvent?(rt($t[0],$t[1].point,ft),rt($t[1],$t[2].point,ft),3):(rt($t[0],$t[1].point,ft),rt($t[3].otherEvent,$t[2].point,ft),3)}function sa(je,_e){if(je===_e)return 0;if(zt(je.point,je.otherEvent.point,_e.point)!==0||zt(je.point,je.otherEvent.point,_e.otherEvent.point)!==0)return de(je.point,_e.point)?je.isBelow(_e.otherEvent.point)?-1:1:je.point[0]===_e.point[0]?je.point[1]<_e.point[1]?-1:1:nt(je,_e)===1?_e.isAbove(je.point)?-1:1:je.isBelow(_e.point)?-1:1;if(je.isSubject!==_e.isSubject)return je.isSubject?-1:1;var ft=je.point,Xt=_e.point;return ft[0]===Xt[0]&&ft[1]===Xt[1]?(ft=je.otherEvent.point)[0]===(Xt=_e.otherEvent.point)[0]&&ft[1]===Xt[1]?0:je.contourId>_e.contourId?1:-1:nt(je,_e)===1?1:-1}var ua=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ta(je,_e,ft,Xt){var pt,$t=je+1,pa=_e[je].point,fa=_e.length;for($t<fa&&(pt=_e[$t].point);$t<fa&&pt[0]===pa[0]&&pt[1]===pa[1];){if(!ft[$t])return $t;++$t<fa&&(pt=_e[$t].point)}for($t=je-1;ft[$t]&&$t>Xt;)$t--;return $t}ua.prototype.isExterior=function(){return this.holeOf==null};var Yt=ea,Fa=ea;function ea(je,_e){if(!(this instanceof ea))return new ea(je,_e);if(this.data=je||[],this.length=this.data.length,this.compare=_e||ja,this.length>0)for(var ft=(this.length>>1)-1;ft>=0;ft--)this._down(ft)}function ja(je,_e){return je<_e?-1:je>_e?1:0}ea.prototype={push:function(je){this.data.push(je),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var je=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),je}},peek:function(){return this.data[0]},_up:function(je){for(var _e=this.data,ft=this.compare,Xt=_e[je];je>0;){var pt=je-1>>1,$t=_e[pt];if(ft(Xt,$t)>=0)break;_e[je]=$t,je=pt}_e[je]=Xt},_down:function(je){for(var _e=this.data,ft=this.compare,Xt=this.length>>1,pt=_e[je];je<Xt;){var $t=1+(je<<1),pa=$t+1,fa=_e[$t];if(pa<this.length&&ft(_e[pa],fa)<0&&($t=pa,fa=_e[pa]),ft(fa,pt)>=0)break;_e[je]=fa,je=$t}_e[je]=pt}},Yt.default=Fa;var Da=Math.max,nr=Math.min,Zr=0;function Pa(je,_e,ft,Xt,pt,$t){var pa,fa,Xa,Aa,da,Vr;for(pa=0,fa=je.length-1;pa<fa;pa++)if(Aa=je[pa+1],da=new ie(Xa=je[pa],!1,void 0,_e),Vr=new ie(Aa,!1,da,_e),da.otherEvent=Vr,Xa[0]!==Aa[0]||Xa[1]!==Aa[1]){da.contourId=Vr.contourId=ft,$t||(da.isExteriorRing=!1,Vr.isExteriorRing=!1),nt(da,Vr)>0?Vr.left=!0:da.left=!0;var tn=Xa[0],Ma=Xa[1];pt[0]=nr(pt[0],tn),pt[1]=nr(pt[1],Ma),pt[2]=Da(pt[2],tn),pt[3]=Da(pt[3],Ma),Xt.push(da),Xt.push(Vr)}}var Br=[];function Ir(je,_e,ft){typeof je[0][0][0]=="number"&&(je=[je]),typeof _e[0][0][0]=="number"&&(_e=[_e]);var Xt=function(Ma,Lr,an){var Ur=null;return Ma.length*Lr.length==0&&(an===V?Ur=Br:an===O?Ur=Ma:an!==F&&an!==Q||(Ur=Ma.length===0?Lr:Ma)),Ur}(je,_e,ft);if(Xt)return Xt===Br?null:Xt;var pt=[1/0,1/0,-1/0,-1/0],$t=[1/0,1/0,-1/0,-1/0],pa=function(Ma,Lr,an,Ur,Un){var Zn,hn,qr,kr,Qa,Jr,fn=new Yt(null,nt);for(qr=0,kr=Ma.length;qr<kr;qr++)for(Qa=0,Jr=(Zn=Ma[qr]).length;Qa<Jr;Qa++)(hn=Qa===0)&&Zr++,Pa(Zn[Qa],!0,Zr,fn,an,hn);for(qr=0,kr=Lr.length;qr<kr;qr++)for(Qa=0,Jr=(Zn=Lr[qr]).length;Qa<Jr;Qa++)hn=Qa===0,Un===O&&(hn=!1),hn&&Zr++,Pa(Zn[Qa],!1,Zr,fn,Ur,hn);return fn}(je,_e,pt,$t,ft);if(Xt=function(Ma,Lr,an,Ur,Un){var Zn=null;return(an[0]>Ur[2]||Ur[0]>an[2]||an[1]>Ur[3]||Ur[1]>an[3])&&(Un===V?Zn=Br:Un===O?Zn=Ma:Un!==F&&Un!==Q||(Zn=Ma.concat(Lr))),Zn}(je,_e,pt,$t,ft))return Xt===Br?null:Xt;for(var fa=function(Ma){var Lr,an,Ur=function(qr){var kr,Qa,Jr,fn,Ra=[];for(Qa=0,Jr=qr.length;Qa<Jr;Qa++)((kr=qr[Qa]).left&&kr.inResult||!kr.left&&kr.otherEvent.inResult)&&Ra.push(kr);for(var Nr=!1;!Nr;)for(Nr=!0,Qa=0,Jr=Ra.length;Qa<Jr;Qa++)Qa+1<Jr&&nt(Ra[Qa],Ra[Qa+1])===1&&(fn=Ra[Qa],Ra[Qa]=Ra[Qa+1],Ra[Qa+1]=fn,Nr=!1);for(Qa=0,Jr=Ra.length;Qa<Jr;Qa++)(kr=Ra[Qa]).otherPos=Qa;for(Qa=0,Jr=Ra.length;Qa<Jr;Qa++)(kr=Ra[Qa]).left||(fn=kr.otherPos,kr.otherPos=kr.otherEvent.otherPos,kr.otherEvent.otherPos=fn);return Ra}(Ma),Un={},Zn=[],hn=function(){if(!Un[Lr]){var qr=Zn.length,kr=function(Ra,Nr,Nn){var Kn=new ua;if(Ra.prevInResult!=null){var ci=Ra.prevInResult,zi=ci.outputContourId;if(ci.resultTransition>0){var En=Nr[zi];if(En.holeOf!=null){var bi=En.holeOf;Nr[bi].holeIds.push(Nn),Kn.holeOf=bi,Kn.depth=Nr[zi].depth}else Nr[zi].holeIds.push(Nn),Kn.holeOf=zi,Kn.depth=Nr[zi].depth+1}else Kn.holeOf=null,Kn.depth=Nr[zi].depth}else Kn.holeOf=null,Kn.depth=0;return Kn}(Ur[Lr],Zn,qr),Qa=function(Ra){Un[Ra]=!0,Ra<Ur.length&&Ur[Ra]&&(Ur[Ra].outputContourId=qr)},Jr=Lr,fn=Lr;for(kr.points.push(Ur[Lr].point);Qa(Jr),Qa(Jr=Ur[Jr].otherPos),kr.points.push(Ur[Jr].point),!((Jr=ta(Jr,Ur,Un,fn))==fn||Jr>=Ur.length)&&Ur[Jr];);Zn.push(kr)}};for(Lr=0,an=Ur.length;Lr<an;Lr++)hn();return Zn}(function(Ma,Lr,an,Ur,Un,Zn){for(var hn,qr,kr,Qa=new c(sa),Jr=[],fn=Math.min(Ur[2],Un[2]);Ma.length!==0;){var Ra=Ma.pop();if(Jr.push(Ra),Zn===V&&Ra.point[0]>fn||Zn===O&&Ra.point[0]>Ur[2])break;if(Ra.left){qr=hn=Qa.insert(Ra),hn=hn!==(kr=Qa.minNode())?Qa.prev(hn):null,qr=Qa.next(qr);var Nr=hn?hn.key:null;if($(Ra,Nr,Zn),qr&&vt(Ra,qr.key,Ma)===2&&($(Ra,Nr,Zn),$(qr.key,Ra,Zn)),hn&&vt(hn.key,Ra,Ma)===2){var Nn=hn;$(Nr,(Nn=Nn!==kr?Qa.prev(Nn):null)?Nn.key:null,Zn),$(Ra,Nr,Zn)}}else qr=hn=Qa.find(Ra=Ra.otherEvent),hn&&qr&&(hn=hn!==kr?Qa.prev(hn):null,qr=Qa.next(qr),Qa.remove(Ra),qr&&hn&&vt(hn.key,qr.key,Ma))}return Jr}(pa,0,0,pt,$t,ft)),Xa=[],Aa=0;Aa<fa.length;Aa++){var da=fa[Aa];if(da.isExterior()){for(var Vr=[da.points],tn=0;tn<da.holeIds.length;tn++)Vr.push(fa[da.holeIds[tn]].points);Xa.push(Vr)}}return Xa}var In={UNION:F,DIFFERENCE:O,INTERSECTION:V,XOR:Q};a.diff=function(je,_e){return Ir(je,_e,O)},a.intersection=function(je,_e){return Ir(je,_e,V)},a.operations=In,a.union=function(je,_e){return Ir(je,_e,F)},a.xor=function(je,_e){return Ir(je,_e,Q)},Object.defineProperty(a,"__esModule",{value:!0})})(e)}(0,sb.exports)),sb.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ig(r,e,a,s){const c=[],p=s===0?(m,x,L,N,R,T)=>{m.push(new St(T,L+(T-x)/(N-x)*(R-L)))}:(m,x,L,N,R,T)=>{m.push(new St(x+(T-L)/(R-L)*(N-x),T))};for(const m of r){const x=[];for(const L of m){if(L.length<=2)continue;const N=[];for(let V=0;V<L.length-1;V++){const F=L[V].x,O=L[V].y,Q=L[V+1].x,$=L[V+1].y,K=s===0?F:O,ie=s===0?Q:$;K<e?ie>e&&p(N,F,O,Q,$,e):K>a?ie<a&&p(N,F,O,Q,$,a):N.push(L[V]),ie<e&&K>=e&&p(N,F,O,Q,$,e),ie>a&&K<=a&&p(N,F,O,Q,$,a)}let R=L[L.length-1];const T=s===0?R.x:R.y;T>=e&&T<=a&&N.push(R),N.length&&(R=N[N.length-1],N[0].x===R.x&&N[0].y===R.y||N.push(N[0]),x.push(N))}x.length&&c.push(x)}return c}function kE(r,e){const a=z_(r),s=z_([e]),c=ob.intersection(a,s);return c==null?[]:lb(c)}function JE(r,e){let s=z_(r,65536);const c=[];for(;e.valid();e.next()){const[p,m]=e.get(),x=p.x*65536,L=p.y*65536,N=m.x*65536,R=m.y*65536,T=N-x,V=R-L,F=Math.hypot(T,V);if(F===0)continue;const O=Math.trunc(V/F*3),Q=-Math.trunc(T/F*3);c.push([[[x,L],[N,R],[N+O,R+Q],[x+O,L+Q],[x,L]]])}return c.length>0&&(s=ob.diff(s,c)),lb(s,1/65536)}function z_(r,e=1){return[r.map(a=>a.map(s=>[s.x*e,s.y*e]))]}function lb(r,e=1){return r.map(a=>a.map((s,c)=>{const p=s.map(m=>new St(m[0]*e,m[1]*e).round());return c>0&&p.reverse(),p}))}class A_{constructor(e,a){this.layoutVertexArray=new Ds,this.indexArray=new gn,this.lineIndexArray=new bo,this.triangleSegments=new Ar,this.lineSegments=new Ar,this.programConfigurations=new io(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new pl)}update(e,a,s,c,p,m,x,L){this.programConfigurations.updatePaintArrays(e,a,p,s,c,m,x,L)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,LE.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,a,s,c,p,m,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,s,c,p,m,void 0,x)}}class R_{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new A_(e,!1),this.elevationBufferData=new A_(e,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,a){}updateAppearances(e,a,s,c){}populate(e,a,s,c){this.hasPattern=E_("fill",this.layers,this.pixelRatio,a);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:L,index:N,sourceLayerIndex:R}of e){const T=this.layers[0]._featureFilter.needGeometry,V=et(x,T);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),V,s))continue;const F=p?p.evaluate(V,{},s,a.availableImages):void 0,O={id:L,properties:x.properties,type:x.type,sourceLayerIndex:R,index:N,geometry:T?V.geometry:ct(x,s,c),patterns:{},sortKey:F};m.push(O)}p&&m.sort((x,L)=>x.sortKey-L.sortKey);for(const x of m){const{geometry:L,index:N,sourceLayerIndex:R}=x;if(this.hasPattern){const T=S_("fill",this.layers,x,this.zoom,this.pixelRatio,a);this.patternFeatures.push(T)}else this.addFeature(x,L,N,s,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(e[N].feature,L,N,R,this.index)}}update(e,a,s,c,p,m,x){this.bufferData.update(e,a,s,c,p,m,x,this.worldview),this.elevationBufferData.update(e,a,s,c,p,m,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,a,s,c,p,m,x,this.worldview)}addFeatures(e,a,s,c,p,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,s,c,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,a,s,c,p,m=[],x,L){const N=vy(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,N,c,s,L):this.addGeometry(N,this.bufferData),this.bufferData.populatePaintArrays(e,s,p,m,c,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,p,m,c,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,a,s,c,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(a,s,c,p,this.worldview))}addElevatedRoadFeature(e,a,s,c,p){const m=new Array,x=Va.getElevationFeature(e,p);if(!x)return void this.addGeometry(a,this.bufferData);{const N=this.clipPolygonsToTile(a,1);N.length>0&&m.push({polygons:N,elevationFeature:x,elevationTileID:s})}const L={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:c};for(const N of m)if(N.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new yl(N.elevationTileID,this.layers,this.zoom,this.lut));const T=N.elevationFeature.isTunnel();let V=0;e.properties.hasOwnProperty(ia)&&(V=+e.properties[ia]);for(const F of N.polygons)this.elevatedStructures.addPortalCandidates(N.elevationFeature.id,F,T,N.elevationFeature,V)}N.elevationFeature.constantHeight==null&&(N.polygons=this.prepareElevatedPolygons(N.polygons,N.elevationFeature,N.elevationTileID));const R=new yr(s,N.elevationTileID);this.addElevatedGeometry(N.polygons,R,N.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c,L)}}addElevatedGeometry(e,a,s,c,p,m){const x={elevation:s,elevationSampler:a,bias:c,index:p,featureInfo:m},[L,N]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:L,max:N}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,L),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,N))}addGeometry(e,a,s){let c=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=null;s&&(m=s.elevationSampler.constantElevation(s.elevation,s.bias),m!=null&&(c=m,p=m));const x=(L,N,R)=>{if(s!=null)if(N.push(L),m!=null)a.elevatedLayoutVertexArray.emplaceBack(m),R.push(m);else{const T=s.elevationSampler.pointElevation(L,s.elevation,s.bias);a.elevatedLayoutVertexArray.emplaceBack(T),R.push(T),c=Math.min(c,T),p=Math.max(p,T)}};for(const L of e){let N=0;for(const le of L)N+=le.length;const R=a.triangleSegments.prepareSegment(N,a.layoutVertexArray,a.indexArray),T=R.vertexLength,V=[],F=[],O=[],Q=[],$=[],K=a.layoutVertexArray.length;for(const le of L){if(le.length===0)continue;le!==L[0]&&F.push(V.length/2);const de=a.lineSegments.prepareSegment(le.length,a.layoutVertexArray,a.lineIndexArray),Ee=de.vertexLength;s&&$.push(a.layoutVertexArray.length-K),x(le[0],O,Q),a.layoutVertexArray.emplaceBack(le[0].x,le[0].y),a.lineIndexArray.emplaceBack(Ee+le.length-1,Ee),V.push(le[0].x),V.push(le[0].y);for(let Le=1;Le<le.length;Le++)x(le[Le],O,Q),a.layoutVertexArray.emplaceBack(le[Le].x,le[Le].y),a.lineIndexArray.emplaceBack(Ee+Le-1,Ee+Le),V.push(le[Le].x),V.push(le[Le].y);de.vertexLength+=le.length,de.primitiveLength+=le.length}const ie=fm(V,F);for(let le=0;le<ie.length;le+=3)a.indexArray.emplaceBack(T+ie[le],T+ie[le+1],T+ie[le+2]);if(ie.length>0&&s&&this.elevationMode==="hd-road-base"){const le=s.elevation.isTunnel(),de=s.elevation.safeArea,Ee=this.elevatedStructures.addVertices(O,Q);this.elevatedStructures.addTriangles(ie,Ee,le);const Le=$.length;if(Le>0){for(let Ae=0;Ae<Le-1;Ae++)this.elevatedStructures.addRenderableRing(s.index,$[Ae]+Ee,$[Ae+1]-$[Ae],le,de,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,$[Le-1]+Ee,O.length-$[Le-1],le,de,s.featureInfo)}}R.vertexLength+=N,R.primitiveLength+=ie.length/3}return[c,p]}prepareElevatedPolygons(e,a,s){const c=1/Se(s),p=[];for(const m of e){const x=JE(m,new en(a,c));p.push(...x)}return p}clipPolygonsToTile(e,a){const s=-a,c=-a,p=Dt+a,m=Dt+a;let x=0;const L=[],N=[];for(;x<e.length;x++){const V=e[x],F=ec(V);(F.min.x>=s&&F.max.x<=p&&F.min.y>=c&&F.max.y<=m?L:N).push(V)}if(L.length===e.length)return e;const R=[new St(s,c),new St(p,c),new St(p,m),new St(s,m),new St(s,c)],T=L;for(const V of N)T.push(...kE(V,R));return T}}let cb,ub,db,hb;na(R_,"FillBucket",{omit:["layers","patternFeatures"]}),na(A_,"FillBufferData"),na(yl,"ElevatedStructures");class kg{constructor(e,a,s,c){if(this.triangleCount=a.length/3,this.min=new St(0,0),this.max=new St(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,m]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){const V=e[T];p.x=Math.min(p.x,V.x),p.y=Math.min(p.y,V.y),m.x=Math.max(m.x,V.x),m.y=Math.max(m.y,V.y)}if(c){const T=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/c);s=Math.max(s,T)}if(s===0)return;this.min=p,this.max=m;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const L=Math.max(x.x,x.y)/s;this.cellsX=Math.max(1,Math.ceil(x.x/L)),this.cellsY=Math.max(1,Math.ceil(x.y/L)),this.xScale=1/L,this.yScale=1/L;const N=[];for(let T=0;T<this.triangleCount;T++){const V=e[a[3*T+0]].sub(this.min),F=e[a[3*T+1]].sub(this.min),O=e[a[3*T+2]].sub(this.min),Q=Cd(Math.floor(Math.min(V.x,F.x,O.x)),this.xScale,this.cellsX),$=Cd(Math.floor(Math.max(V.x,F.x,O.x)),this.xScale,this.cellsX),K=Cd(Math.floor(Math.min(V.y,F.y,O.y)),this.yScale,this.cellsY),ie=Cd(Math.floor(Math.max(V.y,F.y,O.y)),this.yScale,this.cellsY),le=new St(0,0),de=new St(0,0),Ee=new St(0,0),Le=new St(0,0);for(let Ae=K;Ae<=ie;++Ae){le.y=de.y=Ae*L,Ee.y=Le.y=(Ae+1)*L;for(let Me=Q;Me<=$;++Me)le.x=Ee.x=Me*L,de.x=Le.x=(Me+1)*L,(Yn(V,F,O,le,de,Le)||Yn(V,F,O,le,Le,Ee))&&N.push({cellIdx:Ae*this.cellsX+Me,triIdx:T})}}if(N.length===0)return;N.sort((T,V)=>T.cellIdx-V.cellIdx||T.triIdx-V.triIdx);let R=0;for(;R<N.length;){const T=N[R].cellIdx,V={start:this.payload.length,len:0};for(;R<N.length&&N[R].cellIdx===T;)++V.len,this.payload.push(N[R++].triIdx);this.cells[T]=V}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Cd(e.x-this.min.x,this.xScale,this.cellsX),c=Cd(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[c*this.cellsX+s];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const x=this.payload[p.start+m],L=Math.floor(x/8),N=1<<x%8;if(!(this.lookup[L]&N)&&(this.lookup[L]|=N,a.push(x),a.length===this.triangleCount))return}}}query(e,a,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>a.x||e.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const c=Cd(e.x-this.min.x,this.xScale,this.cellsX),p=Cd(a.x-this.min.x,this.xScale,this.cellsX),m=Cd(e.y-this.min.y,this.yScale,this.cellsY),x=Cd(a.y-this.min.y,this.yScale,this.cellsY);for(let L=m;L<=x;L++)for(let N=c;N<=p;N++){const R=this.cells[L*this.cellsX+N];if(R)for(let T=0;T<R.len;T++){const V=this.payload[R.start+T],F=Math.floor(V/8),O=1<<V%8;if(!(this.lookup[F]&O)&&(this.lookup[F]|=O,s.push(V),s.length===this.triangleCount))return}}}}function Cd(r,e,a){return Math.max(0,Math.min(a-1,Math.floor(r*e)))}na(kg,"TriangleGridIndex");class fb{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,a){for(const s of this.footprints)a.push({footprint:s,id:e})}updateAppearances(e,a,s,c){}populate(e,a,s,c){const p=[];for(const{feature:m,id:x,index:L,sourceLayerIndex:N}of e){const R=this.layers[0]._featureFilter.needGeometry,T=et(m,R);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),T,s))continue;const V={id:x,properties:m.properties,type:m.type,sourceLayerIndex:N,index:L,geometry:R?T.geometry:ct(m,s,c),patterns:{}};p.push(V)}for(const m of p){const{geometry:x,index:L,sourceLayerIndex:N}=m;this.addFeature(m,x,L,s,{},a.availableImages,a.brightness),a.featureIndex.insert(e[L].feature,x,L,N,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,a,s,c,p,m,x){}destroy(){}addFeature(e,a,s,c,p,m=[],x){for(const L of vy(a,2)){const N=[],R=[],T=[],V=new St(1/0,1/0),F=new St(-1/0,-1/0);for(const $ of L)if($.length!==0){$!==L[0]&&T.push(R.length/2);for(let K=0;K<$.length;K++)R.push($[K].x),R.push($[K].y),N.push($[K]),V.x=Math.min(V.x,$[K].x),V.y=Math.min(V.y,$[K].y),F.x=Math.max(F.x,$[K].x),F.y=Math.max(F.y,$[K].y)}const O=fm(R,T),Q=new kg(N,O,8,256);this.footprints.push({vertices:N,indices:O,grid:Q,min:V,max:F})}}}na(fb,"ClipBucket",{omit:["layers"]});const FE=tr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),OE=tr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),DE=tr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),CE=tr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),PE=tr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),GE=tr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),UE=tr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:WE}=FE,by=Number.MAX_SAFE_INTEGER,pb=by-1;function mb(r,e,a,s){return r.order<e||r.order===by||!(r.clipMask&a)||function(c,p){return p.length!==0&&p.find(m=>m===c)===void 0}(s,r.clipScope)}function Jg(r,e){return r.x-e.x||r.y-e.y}function yb(r,e){return Jg(r.min,e.min)===0&&Jg(r.max,e.max)===0}function T_(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function Fg(r,e){if(r.length!==e.length)return!1;for(let a=0;a<r.length;a++)if(r[a].sourceId!==e[a].sourceId||!yb(r[a],e[a])||r[a].order!==e[a].order||r[a].clipMask!==e[a].clipMask||!uo(r[a].clipScope,e[a].clipScope))return!1;return!0}function gb(r,e,a){const s=1/Dt,c=1/(1<<a.canonical.z),p=(e.x*s+a.canonical.x)*c+a.wrap,m=(e.y*s+a.canonical.y)*c;return{min:new St((r.x*s+a.canonical.x)*c+a.wrap,(r.y*s+a.canonical.y)*c),max:new St(p,m)}}function XE(r,e,a){const s=1<<a.canonical.z,c=((e.x-a.wrap)*s-a.canonical.x)*Dt,p=(e.y*s-a.canonical.y)*Dt;return{min:new St(((r.x-a.wrap)*s-a.canonical.x)*Dt,(r.y*s-a.canonical.y)*Dt),max:new St(c,p)}}function V_(r,e,a,s,c,p,m){const x=r.indices,L=r.vertices,N=[];for(let R=s;R<s+c;R+=3){const T=e[a[R+0]+p],V=e[a[R+1]+p],F=e[a[R+2]+p],O=Math.min(T.x,V.x,F.x),Q=Math.max(T.x,V.x,F.x),$=Math.min(T.y,V.y,F.y),K=Math.max(T.y,V.y,F.y);N.length=0,r.grid.query(new St(O,$),new St(Q,K),N);for(let ie=0;ie<N.length;ie++){const le=N[ie];if(Yn(L[x[3*le+0]],L[x[3*le+1]],L[x[3*le+2]],T,V,F,m))return!0}}return!1}function _b(r,e,a,s){if(!r||!a)return!1;let c=r.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(a.vertices.length<r.vertices.length)return _b(a,s,r,e);const p=e.canonical,m=s.canonical,x=Math.pow(2,m.z-p.z);c=r.vertices.map(L=>new St((L.x+p.x*Dt)*x-m.x*Dt,(L.y+p.y*Dt)*x-m.y*Dt))}return V_(a,c,r.indices,0,r.indices.length,0,0)}function xb(r,e,a,s){const c=Math.pow(2,s.z-a.z);return new St((r+a.x*Dt)*c-s.x*Dt,(e+a.y*Dt)*c-s.y*Dt)}function M_(r,e){const a=[];e.grid.queryPoint(r,a);const s=e.indices,c=e.vertices;for(let p=0;p<a.length;p++){const m=a[p];if(vi([c[s[3*m+0]],c[s[3*m+1]],c[s[3*m+2]]],r))return!0}return!1}const B_=[new St(0,0),new St(Dt,0),new St(Dt,Dt),new St(0,Dt)];function wb(r,e){const a=[];let s=[];if(!e||r.length<2)return[r];if(r.length===2)return Cn(r[0],r[1],B_)?[r]:[];for(let c=0;c<r.length+2;c++){const p=r[c%r.length],m=r[(c+1)%r.length],x=Cn(c===0?r[r.length-1]:r[(c-1)%r.length],p,B_),L=Cn(p,m,B_),N=x||L;N&&s.push(p),N&&L||s.length>0&&(s.length>1&&a.push(s),s=[])}return s.length>1&&a.push(s),a}const I_=jt.types,QE=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],HE=["fill-extrusion-flood-light-ground-radius"],YE=Math.pow(2,13),$E=Math.pow(2,15)-1,vb=new St(0,1),Ff=2147483648,bb=7,Lb=450;function Ly(r,e,a,s,c,p,m,x){r.emplaceBack((e<<1)+m,(a<<1)+p,(Math.floor(s*YE)<<1)+c,Math.round(x))}function jy(r,e,a){r.emplaceBack(e.x*Dt,e.y*Dt,a?1:0)}function Og(r,e,a,s,c,p){r.emplaceBack(e.x,e.y,(a.x<<1)+s,(a.y<<1)+c,p)}function Zy(r,e,a){r.emplaceBack(e.x,e.y,e.z,a[0]*16384,a[1]*16384,a[2]*16384)}class jb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Zb{constructor(){this.centroidXY=new St(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new St(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new St(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new St(this.max.x-this.min.x,this.max.y-this.min.y)}}class Nb{constructor(){this.acc=new St(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,a){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=a.x,e.min.y=e.max.y=a.y)}appendEdge(e,a,s){this.accCount++,this.acc._add(a);let c=!!this.borders;a.x<e.min.x?(e.min.x=a.x,c=!0):a.x>e.max.x&&(e.max.x=a.x,c=!0),a.y<e.min.y?(e.min.y=a.y,c=!0):a.y>e.max.y&&(e.max.y=a.y,c=!0),((a.x===0||a.x===Dt)&&a.x===s.x)!=((a.y===0||a.y===Dt)&&a.y===s.y)&&this.processBorderOverlap(a,s),c&&this.checkBorderIntersection(a,s)}checkBorderIntersection(e,a){a.x<0!=e.x<0&&this.addBorderIntersection(0,Sa(a.y,e.y,(0-a.x)/(e.x-a.x))),a.x>Dt!=e.x>Dt&&this.addBorderIntersection(1,Sa(a.y,e.y,(Dt-a.x)/(e.x-a.x))),a.y<0!=e.y<0&&this.addBorderIntersection(2,Sa(a.x,e.x,(0-a.y)/(e.y-a.y))),a.y>Dt!=e.y>Dt&&this.addBorderIntersection(3,Sa(a.x,e.x,(Dt-a.y)/(e.y-a.y)))}addBorderIntersection(e,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];a<s[0]&&(s[0]=a),a>s[1]&&(s[1]=a)}processBorderOverlap(e,a){if(e.x===a.x){if(e.y===a.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,a.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,a.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new St(0,0):new St(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,a)=>e+ +(a[0]!==Number.MAX_VALUE),0):0}}function Eb(r,e){const a=r.add(e)._unit(),s=re(r.x*a.x+r.y*a.y,-1,1);var c,p,m;return c=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(c)))/4*$E*((p=r).x*(m=e).y-p.y*m.x<0?-1:1)}const qE=[r=>r.x<0,r=>r.x>Dt,r=>r.y<0,r=>r.y>Dt];function KE(r,e,a,s){const c=[4];if(s===0)return c;a._mult(s);const p=r.sub(a),m=e.sub(a),x=[r,e,p,m];for(let L=0;L<4;L++)for(const N of x)if(qE[L](N)){c.push(L);break}return c}class k_{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Ih,this.indexArray=new gn,this.programConfigurations=new io(e.layers,{zoom:e.zoom,lut:e.lut},a=>HE.includes(a)),this._segments=new Ar,this.hiddenByLandmarkVertexArray=new ku,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ar}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,a,s,c=!1){const p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let L;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const N=e[0],R=e[1];L=Eb(N.sub(e[p-1])._perp()._unit(),R.sub(N)._perp()._unit())}for(let N=0;N<p;N++){const R=N===p-1?0:N+1,T=e[N],V=e[R],F=e[R===p-1?0:R+1],O=V.sub(T)._perp()._unit(),Q=Eb(O,F.sub(V)._perp()._unit()),$=L,K=Q;if(J_(T,V,a)||c&&Ab(T,a)&&Ab(V,a)){L=Q;continue}const ie=x.vertexLength;Og(this.vertexArray,T,V,1,1,$),Og(this.vertexArray,T,V,1,0,$),Og(this.vertexArray,T,V,0,1,K),Og(this.vertexArray,T,V,0,0,K),x.vertexLength+=4;const le=KE(T,V,O,s);for(const de of le)this._segmentToGroundQuads[m].push({id:ie,region:de}),this._segmentToRegionTriCounts[m][de]+=2,x.primitiveLength+=2;L=Q}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),a=e.length;for(let s=0;s<a;s++)this._segmentToGroundQuads[s].sort((c,p)=>c.region-p.region);for(let s=0;s<a;s++){const c=this._segmentToGroundQuads[s],p=e[s],m=this._segmentToRegionTriCounts[s];m.reduce((L,N)=>L+N,0);let x=0;for(let L=0;L<=4;L++){const N=m[L];if(N!==0){let R=this.regionSegments[L];R||(R=this.regionSegments[L]=new Ar);const T={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+x,vertexLength:p.vertexLength,primitiveLength:N};R.get().push(T)}x+=N}for(let L=0;L<c.length;L++){const N=c[L].id;this.indexArray.emplaceBack(N,N+1,N+3),this.indexArray.emplaceBack(N,N+3,N+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,a,s,c,p,m,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,a,s,c,p,m,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,OE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,DE.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,a,s,c,p,m,x,L){this.hasData()&&this.programConfigurations.updatePaintArrays(e,a,s,c,p,m,x,L)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Ff))}updateHiddenByLandmarkRange(e,a,s){if(!this.hasData())return;const c=a+e;if(a!==0){for(let p=e;p<c;++p)this.hiddenByLandmarkVertexArray.emplace(p,s?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,GE.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const a=this.regionSegments[e];a&&a.destroy()}}}}class Dg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new gn,this.footprintVertices=new Ds,this.footprintSegments=[],this.layoutVertexArray=new Es,this.centroidVertexArray=new bp,this.wallVertexArray=new _s,this.indexArray=new gn,this.programConfigurations=new io(e.layers,{zoom:e.zoom,lut:e.lut},a=>QE.includes(a)),this.segments=new Ar,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new k_(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,a){}updateAppearances(e,a,s,c){}populate(e,a,s,c){this.features=[],this.hasPattern=E_("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Se(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:x,sourceLayerIndex:L}of e){const N=this.layers[0]._featureFilter.needGeometry,R=et(p,N);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),R,s))continue;const T={id:m,sourceLayerIndex:L,index:x,geometry:N?R.geometry:ct(p,s,c),properties:p.properties,type:p.type,patterns:{}},V=this.layoutVertexArray.length,F=I_[T.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:S_("fill-extrusion",this.layers,T,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const O of T.geometry)for(const Q of wb(O,F))this.addFeature(p.id,T,[Q],x,s,{},a.availableImages,c,a.brightness);else this.addFeature(p.id,T,T.geometry,x,s,{},a.availableImages,c,a.brightness);a.featureIndex.insert(p,T.geometry,x,L,this.index,V)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,a,s,c,p,m){for(const{featureId:x,feature:L}of this.features){const N=I_[L.type]==="Polygon",{geometry:R}=L;if(this.wallMode)for(const T of R)for(const V of wb(T,N))this.addFeature(x,L,[V],L.index,a,s,c,p,m);else this.addFeature(x,L,R,L.index,a,s,c,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,a,s,c,p,m,x){this.programConfigurations.updatePaintArrays(e,a,p,s,c,m,x,this.worldview),this.groundEffect.update(e,a,p,s,c,m,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,PE.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,UE.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,CE.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,a,s,c,p,m,x,L,N){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,T=[new St(0,0),new St(Dt,Dt)],V=L.projection,F=V.name==="globe",O=this.wallMode||I_[a.type]==="Polygon",Q=new Nb;Q.centroidDataIndex=this.centroidData.length;const $=new Zb;$.buildingId=e,a.properties&&a.properties.hasOwnProperty("building_id")&&($.buildingId=a.properties.building_id);const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},p)<=0,ie=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},p);let le;if($.height=ie,$.vertexArrayOffset=this.layoutVertexArray.length,$.groundVertexArrayOffset=this.groundEffect.vertexArray.length,F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ad),this.wallMode){if(F)return void Za("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;le=function(We){const ut=We[0].x===We[We.length-1].x&&We[0].y===We[We.length-1].y;(function(ta){let Yt=0;const Fa=ta.length;for(let ea=0;ea<Fa;ea++)Yt+=(ta[(ea+1)%Fa].x-ta[ea].x)*(ta[(ea+1)%Fa].y+ta[ea].y);return Yt>=0})(We)||(We=We.reverse());const Zt={geometry:[],joinNormals:[],indices:[]},Pt=[],At=[],xt=[];let zt=We.length;for(;zt>=2&&We[zt-1].equals(We[zt-2]);)zt--;if(zt<(ut?3:2))return Zt;let nt,rt,Et,Jt,vt,sa=0;for(;sa<zt-1&&We[sa].equals(We[sa+1]);)sa++;ut&&(nt=We[zt-2],vt=We[sa].sub(nt)._unit()._perp());for(let ta=sa;ta<zt;ta++){if(Et=ta===zt-1?ut?We[sa+1]:void 0:We[ta+1],Et&&We[ta].equals(Et))continue;vt&&(Jt=vt),nt&&(rt=nt),nt=We[ta],vt=Et?Et.sub(nt)._unit()._perp():Jt,Jt=Jt||vt;let Yt=Jt.add(vt);Yt.x===0&&Yt.y===0||Yt._unit();const Fa=Yt.x*vt.x+Yt.y*vt.y,ea=Fa!==0?1/Fa:1/0,ja=Jt.x*vt.y-Jt.y*vt.x>0;let Da="miter";const nr=2;Da==="miter"&&ea>nr&&(Da="bevel"),Da==="bevel"&&(ea>100&&(Da="flipbevel"),ea<nr&&(Da="miter"));const Zr=(Pa,Br,Ir,In)=>{const je=new St(Pa.x,Pa.y),_e=new St(Pa.x,Pa.y);je.x+=Br.x*In,je.y+=Br.y*In,_e.x-=Br.x*Math.max(Ir,1),_e.y-=Br.y*Math.max(Ir,1),xt.push(Br),Pt.push(je),At.push(_e)};if(Da==="miter")Yt._mult(ea),Zr(nt,Yt,0,0);else if(Da==="flipbevel")Yt=vt.mult(-1),Zr(nt,Yt,0,0),Zr(nt,Yt.mult(-1),0,0);else{const Pa=-Math.sqrt(ea*ea-1),Br=ja?Pa:0,Ir=ja?0:Pa;rt&&Zr(nt,Jt,Br,Ir),Et&&Zr(nt,vt,Br,Ir)}}Zt.geometry=[...Pt,...At.reverse(),Pt[0]],Zt.joinNormals=[...xt,...xt.reverse(),xt[xt.length-1]];const ua=Zt.geometry.length-1;for(let ta=0;ta<ua/2;ta++)if(ta+1<ua/2){let Yt=ta,Fa=ta+1,ea=ua-1-ta,ja=ua-2-ta;Yt=Yt===0?ua-1:Yt-1,Fa=Fa===0?ua-1:Fa-1,ea=ea===0?ua-1:ea-1,ja=ja===0?ua-1:ja-1,Zt.indices.push(ea),Zt.indices.push(Fa),Zt.indices.push(Yt),Zt.indices.push(ea),Zt.indices.push(ja),Zt.indices.push(Fa)}return Zt}(s[0]),s=[le.geometry]}const de=(We,ut)=>We<(ut.length-1)/2||We===ut.length-1,Ee=this.wallMode?[s]:vy(s,500);for(let We=Ee.length-1;We>=0;We--){const ut=Ee[We];(ut.length===0||(Le=ut[0]).every(_t=>_t.x<=0)||Le.every(_t=>_t.x>=Dt)||Le.every(_t=>_t.y<=0)||Le.every(_t=>_t.y>=Dt))&&Ee.splice(We,1)}var Le;let Ae;if(F)Ae=Mb(Ee,T,p);else{Ae=[];for(const We of Ee)Ae.push({polygon:We,bounds:T})}const Me=O?this.edgeRadius:0,Je=Me>0&&this.zoom<17,ot=(We,ut)=>{if(We.length===0)return!1;const _t=We[We.length-1];return ut.x===_t.x&&ut.y===_t.y};for(const{polygon:We,bounds:ut}of Ae){let _t=0,Zt=0;for(const zt of We)O&&!zt[0].equals(zt[zt.length-1])&&zt.push(zt[0]),Zt+=O?zt.length-1:zt.length;const Pt=this.segments.prepareSegment((O?5:4)*Zt,this.layoutVertexArray,this.indexArray);$.footprintSegIdx<0&&($.footprintSegIdx=this.footprintSegments.length),$.polygonSegIdx<0&&($.polygonSegIdx=this.polygonSegments.length);const At={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xt=new jb;if(xt.vertexOffset=this.footprintVertices.length,xt.indexOffset=3*this.footprintIndices.length,xt.ringIndices=[],O){const zt=[],nt=[];_t=Pt.vertexLength;for(let Et=0;Et<We.length;Et++){const Jt=We[Et];Jt.length&&Et!==0&&nt.push(zt.length/2);const vt=[];let sa,ua;sa=Jt[1].sub(Jt[0])._perp()._unit(),xt.ringIndices.push(Jt.length-1);for(let ta=1;ta<Jt.length;ta++){const Yt=Jt[ta],Fa=Jt[ta===Jt.length-1?1:ta+1],ea=Yt.clone();if(Me){ua=Fa.sub(Yt)._perp()._unit();const ja=sa.add(ua)._unit(),Da=Me*Math.min(4,1/(sa.x*ja.x+sa.y*ja.y));ea.x+=Da*ja.x,ea.y+=Da*ja.y,ea.x=Math.round(ea.x),ea.y=Math.round(ea.y),sa=ua}if(!K||Me!==0&&!Je||ot(vt,ea)||vt.push(ea),Ly(this.layoutVertexArray,ea.x,ea.y,0,0,1,1,0),this.wallMode){const ja=de(ta,Jt);jy(this.wallVertexArray,le.joinNormals[ta],!ja)}Pt.vertexLength++,this.footprintVertices.emplaceBack(Yt.x,Yt.y),zt.push(Yt.x,Yt.y),F&&Zy(this.layoutVertexExtArray,V.projectTilePoint(ea.x,ea.y,p),V.upVector(p,ea.x,ea.y))}K&&(Me===0||Je)&&(vt.length!==0&&ot(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,ut,R))}const rt=this.wallMode?le.indices:fm(zt,nt);for(let Et=0;Et<rt.length;Et+=3)this.footprintIndices.emplaceBack(xt.vertexOffset+rt[Et+0],xt.vertexOffset+rt[Et+1],xt.vertexOffset+rt[Et+2]),this.indexArray.emplaceBack(_t+rt[Et],_t+rt[Et+2],_t+rt[Et+1]),Pt.primitiveLength++;xt.indexCount+=rt.length,xt.vertexCount+=this.footprintVertices.length-xt.vertexOffset}for(let zt=0;zt<We.length;zt++){const nt=We[zt];Q.startRing($,nt[0]);let rt=nt.length>4&&Rb(nt[nt.length-2],nt[0],nt[1]),Et=Me?eS(nt[nt.length-2],nt[0],nt[1],Me):0;const Jt=[];let vt,sa,ua;sa=nt[1].sub(nt[0])._perp()._unit();let ta=!0;for(let Yt=1,Fa=0;Yt<nt.length;Yt++){let ea=nt[Yt-1],ja=nt[Yt];const Da=nt[Yt===nt.length-1?1:Yt+1];if(Q.appendEdge($,ja,ea),J_(ja,ea,ut)){Me&&(sa=Da.sub(ja)._perp()._unit(),ta=!ta);continue}const nr=ja.sub(ea)._perp(),Zr=nr.x/(Math.abs(nr.x)+Math.abs(nr.y)),Pa=nr.y>0?1:0,Br=ea.dist(ja);if(Fa+Br>32768&&(Fa=0),Me){ua=Da.sub(ja)._perp()._unit();let _e=zb(ea,ja,Da,Sb(sa,ua),Me);isNaN(_e)&&(_e=0);const ft=ja.sub(ea)._unit();ea=ea.add(ft.mult(Et))._round(),ja=ja.add(ft.mult(-_e))._round(),Et=_e,sa=ua,K&&this.zoom>=17&&(ot(Jt,ea)||Jt.push(ea),ot(Jt,ja)||Jt.push(ja))}const Ir=Pt.vertexLength,In=nt.length>4&&Rb(ea,ja,Da);let je=Tb(Fa,rt,ta);if(Ly(this.layoutVertexArray,ea.x,ea.y,Zr,Pa,0,0,je),Ly(this.layoutVertexArray,ea.x,ea.y,Zr,Pa,0,1,je),this.wallMode){const _e=de(Yt-1,nt),ft=le.joinNormals[Yt-1];jy(this.wallVertexArray,ft,_e),jy(this.wallVertexArray,ft,_e)}if(Fa+=Br,je=Tb(Fa,In,!ta),rt=In,Ly(this.layoutVertexArray,ja.x,ja.y,Zr,Pa,0,0,je),Ly(this.layoutVertexArray,ja.x,ja.y,Zr,Pa,0,1,je),this.wallMode){const _e=de(Yt,nt),ft=le.joinNormals[Yt];jy(this.wallVertexArray,ft,_e),jy(this.wallVertexArray,ft,_e)}if(Pt.vertexLength+=4,this.indexArray.emplaceBack(Ir+0,Ir+1,Ir+2),this.indexArray.emplaceBack(Ir+1,Ir+3,Ir+2),Pt.primitiveLength+=2,Me){const _e=_t+(Yt===1?nt.length-2:Yt-2),ft=Yt===1?_t:_e+1;if(this.indexArray.emplaceBack(Ir+1,_e,Ir+3),this.indexArray.emplaceBack(_e,ft,Ir+3),Pt.primitiveLength+=2,vt===void 0&&(vt=Ir),!J_(Da,nt[Yt],ut)){const Xt=Yt===nt.length-1?vt:Pt.vertexLength;this.indexArray.emplaceBack(Ir+2,Ir+3,Xt),this.indexArray.emplaceBack(Ir+3,Xt+1,Xt),this.indexArray.emplaceBack(Ir+3,ft,Xt+1),Pt.primitiveLength+=3}ta=!ta}if(F){const _e=this.layoutVertexExtArray,ft=V.projectTilePoint(ea.x,ea.y,p),Xt=V.projectTilePoint(ja.x,ja.y,p),pt=V.upVector(p,ea.x,ea.y),$t=V.upVector(p,ja.x,ja.y);Zy(_e,ft,pt),Zy(_e,ft,pt),Zy(_e,Xt,$t),Zy(_e,Xt,$t)}}O&&(_t+=nt.length-1),K&&Me&&this.zoom>=17&&(Jt.length!==0&&ot(Jt,Jt[0])&&Jt.pop(),this.groundEffect.addData(Jt,ut,R,Me>0))}this.footprintSegments.push(xt),At.triangleCount=this.indexArray.length-At.triangleArrayOffset,this.polygonSegments.push(At),++$.footprintSegLen,++$.polygonSegLen}if($.vertexCount=this.layoutVertexArray.length-$.vertexArrayOffset,$.groundVertexCount=this.groundEffect.vertexArray.length-$.groundVertexArrayOffset,$.vertexCount!==0){if($.centroidXY=Q.borders?vb:this.encodeCentroid(Q,$),this.centroidData.push($),Q.borders){this.featuresOnBorder.push(Q);const We=this.featuresOnBorder.length-1;for(let ut=0;ut<Q.borders.length;ut++)Q.borders[ut][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ut].push(We)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,m,x,p,N,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,c,m,x,p,N,this.worldview),this.maxHeight=Math.max(this.maxHeight,ie)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((a,s)=>this.featuresOnBorder[a].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const L=this.centroidData[x],N=+(L.min.y+L.max.y>Dt),R=2*N+(+(L.min.x+L.max.x>Dt)^N);for(let T=0;T<L.polygonSegLen;T++){const V=L.polygonSegIdx+T;e.push({centroidIdx:x,subtile:R,polygonSegmentIdx:V,triangleSegmentIdx:this.polygonSegments[V].triangleSegIdx})}}const a=new gn;e.sort((x,L)=>x.triangleSegmentIdx===L.triangleSegmentIdx?x.subtile-L.subtile:x.triangleSegmentIdx-L.triangleSegmentIdx);let s=0,c=0,p=0;for(const x of e){if(x.triangleSegmentIdx!==s)break;p++}const m=e.length;for(;c!==e.length;){s=e[c].triangleSegmentIdx;let x=0,L=c,N=c;for(let R=L;R<p&&e[R].subtile===x;R++)N++;for(;L!==p;){const R=e[L];x=R.subtile;const T=this.centroidData[R.centroidIdx].min.clone(),V=this.centroidData[R.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=L;O<N;O++){const Q=e[O],$=this.polygonSegments[Q.polygonSegmentIdx],K=this.centroidData[Q.centroidIdx].min,ie=this.centroidData[Q.centroidIdx].max,le=this.indexArray.uint16;for(let de=$.triangleArrayOffset;de<$.triangleArrayOffset+$.triangleCount;de++)a.emplaceBack(le[3*de],le[3*de+1],le[3*de+2]);F.primitiveLength+=$.triangleCount,T.x=Math.min(T.x,K.x),T.y=Math.min(T.y,K.y),V.x=Math.max(V.x,ie.x),V.y=Math.max(V.y,ie.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:T,max:V}),L=N;for(let O=L;O<p&&e[O].subtile===e[L].subtile;O++)N++}c=p;for(let R=c;R<m&&e[R].triangleSegmentIdx===e[c].triangleSegmentIdx;R++)p++}a._trim(),this.indexArray=a}getVisibleSegments(e,a,s){const c=new Ar;if(this.wallMode){for(const Q of this.triangleSubSegments)c.segments.push(Q.segment);return c}let p=0,m=0;const x=1<<e.canonical.z;if(a){const Q=a.getMinMaxForTile(e);Q&&(p=Q.min,m=Q.max)}m+=this.maxHeight;const L=e.toUnwrapped();let N;const R=[L.canonical.x/x+L.wrap,L.canonical.y/x],T=[(L.canonical.x+1)/x+L.wrap,(L.canonical.y+1)/x],V=(Q,$,K)=>[Q[0]*(1-K[0])+$[0]*K[0],Q[1]*(1-K[1])+$[1]*K[1]],F=[],O=[];for(const Q of this.triangleSubSegments){F[0]=Q.min.x/Dt,F[1]=Q.min.y/Dt,O[0]=Q.max.x/Dt,O[1]=Q.max.y/Dt;const $=V(R,T,F),K=V(R,T,O);if(new Ca([$[0],$[1],p],[K[0],K[1],m]).intersectsPrecise(s)===0){N&&(c.segments.push(N),N=void 0);continue}const ie=Q.segment;N&&N.vertexOffset!==ie.vertexOffset&&(c.segments.push(N),N=void 0),N?(N.vertexLength+=ie.vertexLength,N.primitiveLength+=ie.primitiveLength):N={vertexOffset:ie.vertexOffset,primitiveLength:ie.primitiveLength,vertexLength:ie.vertexLength,primitiveOffset:ie.primitiveOffset,sortKey:void 0,vaos:{}}}return N&&c.segments.push(N),c}encodeCentroid(e,a){const s=e.centroid(),c=a.span(),p=Math.min(7,Math.round(c.x*this.tileToMeter/10)),m=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new St(re(s.x,1,Dt-1)<<3|p,re(s.y,1,Dt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new St(0,0);const a=e.borders,s=Number.MAX_VALUE;if(a[0][0]!==s||a[1][0]!==s){const c=a[0][0]!==s?0:1;return new St(6|(a[0][0]!==s?0:65528),(a[c][0]+a[c][1])/2<<3|6)}{const c=a[2][0]!==s?2:3;return new St((a[c][0]+a[c][1])/2<<3|6,6|(a[2][0]!==s?0:65528))}}showCentroid(e){const a=this.centroidData[e.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const a=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,c=e.flags&Ff?vb:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==c.y||p!==c.x){for(let m=a;m<s;++m)this.centroidVertexArray.emplace(m,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,a,s){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const c=a.getReplacementRegionsForTile(e.toUnwrapped());if(Fg(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<s)continue;const x=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));if(m.footprint.buildingId){const L=m.footprint.buildingId;for(const N of this.centroidData)N.buildingId===L&&(N.flags|=Ff)}else for(const L of this.centroidData)if(!(L.flags&Ff||m.min.x>L.max.x||L.min.x>m.max.x||m.min.y>L.max.y||L.min.y>m.max.y))for(let N=0;N<L.footprintSegLen;N++){const R=this.footprintSegments[L.footprintSegIdx+N];if(p.length=0,tS(this.footprintVertices,R.vertexOffset,R.vertexCount,m.footprintTileId.canonical,e.canonical,p),V_(m.footprint,p,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-x)){L.flags|=Ff;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,a,s){let c=!1;for(let p=0;p<s.footprintSegLen;p++){const m=this.footprintSegments[s.footprintSegIdx+p];let x=0;for(const L of m.ringIndices){for(let N=x,R=L+x-1;N<L+x;R=N++){const T=this.footprintVertices.int16[2*(N+m.vertexOffset)+0],V=this.footprintVertices.int16[2*(N+m.vertexOffset)+1],F=this.footprintVertices.int16[2*(R+m.vertexOffset)+1];V>a!=F>a&&e<(this.footprintVertices.int16[2*(R+m.vertexOffset)+0]-T)*(a-V)/(F-V)+T&&(c=!c)}x=L}}return c}getHeightAtTileCoord(e,a){let s=Number.NEGATIVE_INFINITY,c=!0;const p=4*(e+Dt)*Dt+(a+Dt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&Ff)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||a>m.max.y||m.min.y>a||m.height<=s||this.footprintContainsPoint(e,a,m)&&(s=m.height,this.partLookup[p]=m,c=!!(m.flags&Ff));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:c};this.partLookup[p]=void 0}}function Sb(r,e){const a=r.add(e)._unit();return r.x*a.x+r.y*a.y}function eS(r,e,a,s){const c=e.sub(r)._perp()._unit(),p=a.sub(e)._perp()._unit();return zb(r,e,a,Sb(c,p),s)}function zb(r,e,a,s,c){const p=Math.sqrt(1-s*s);return Math.min(r.dist(e)/3,e.dist(a)/3,c*p/s)}function J_(r,e,a){return r.x<a[0].x&&e.x<a[0].x||r.x>a[1].x&&e.x>a[1].x||r.y<a[0].y&&e.y<a[0].y||r.y>a[1].y&&e.y>a[1].y}function Ab(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function Rb(r,e,a){if(r.x<0||r.x>=Dt||e.x<0||e.x>=Dt||a.x<0||a.x>=Dt)return!1;const s=a.sub(e),c=s.perp(),p=r.sub(e);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&c.x*p.x+c.y*p.y<0}function Tb(r,e,a){const s=e?2|r:-3&r;return a?1|s:-2&s}function Vb(){const r=Math.PI/32,e=Math.tan(r),a=M;return a*Math.sqrt(1+2*e*e)-a}function Mb(r,e,a){const s=1<<a.z,c=he(a.x/s),p=he((a.x+1)/s),m=ce(a.y/s),x=ce((a.y+1)/s);return function(L,N,R,T,V=0,F){const O=[];if(!L.length||!R||!T)return O;const Q=(Le,Ae)=>{for(const Me of Le)O.push({polygon:Me,bounds:Ae})},$=Math.ceil(Math.log2(R)),K=Math.ceil(Math.log2(T)),ie=$-K,le=[];for(let Le=0;Le<Math.abs(ie);Le++)le.push(ie>0?0:1);for(let Le=0;Le<Math.min($,K);Le++)le.push(0),le.push(1);let de=L;if(de=Ig(de,N[0].y-V,N[1].y+V,1),de=Ig(de,N[0].x-V,N[1].x+V,0),!de.length)return O;const Ee=[];for(le.length?Ee.push({polygons:de,bounds:N,depth:0}):Q(de,N);Ee.length;){const Le=Ee.pop(),Ae=Le.depth,Me=le[Ae],Je=Le.bounds[0],ot=Le.bounds[1],We=Me===0?Je.x:Je.y,ut=Me===0?ot.x:ot.y,_t=F?F(Me,We,ut):.5*(We+ut),Zt=Ig(Le.polygons,We-V,_t+V,Me),Pt=Ig(Le.polygons,_t-V,ut+V,Me);if(Zt.length){const At=[Je,new St(Me===0?_t:ot.x,Me===1?_t:ot.y)];le.length>Ae+1?Ee.push({polygons:Zt,bounds:At,depth:Ae+1}):Q(Zt,At)}if(Pt.length){const At=[new St(Me===0?_t:Je.x,Me===1?_t:Je.y),ot];le.length>Ae+1?Ee.push({polygons:Pt,bounds:At,depth:Ae+1}):Q(Pt,At)}}return O}(r,e,Math.ceil((p-c)/11.25),Math.ceil((m-x)/11.25),1,(L,N,R)=>{if(L===0)return .5*(N+R);{const T=ce((a.y+N/Dt)/s);return(ae(.5*(ce((a.y+R/Dt)/s)+T))*s-a.y)*Dt}})}function tS(r,e,a,s,c,p){const m=Math.pow(2,s.z-c.z);for(let x=0;x<a;x++){let L=r.int16[2*(x+e)+0],N=r.int16[2*(x+e)+1];L=(L+c.x*Dt)*m-s.x*Dt,N=(N+c.y*Dt)*m-s.y*Dt,p.push(new St(L,N))}}let Bb,Ib;na(Dg,"FillExtrusionBucket",{omit:["layers","features"]}),na(Zb,"PartData"),na(jb,"FootprintSegment"),na(Nb,"BorderCentroidData"),na(k_,"GroundEffect");class Ep extends St{constructor(e,a,s){super(e,a),this.z=s}}class kb extends Ep{constructor(e,a,s,c){super(e,a,s),this.w=c}}function Jb(r,e,a,s){const c=a==="x"?"y":"x",p=(s-r[a])/(e[a]-r[a]);r[c]=Math.round(r[c]+(e[c]-r[c])*p),r[a]=s,r.hasOwnProperty("z")&&(r.z=Sa(r.z,e.z,p)),r.hasOwnProperty("w")&&(r.w=Sa(r.w,e.w,p))}function Fb(r,e,a,s){const c=a,p=s;for(const m of["x","y"]){let x=r,L=e;x[m]>=L[m]&&(x=e,L=r),x[m]<c&&L[m]>c&&Jb(x,L,m,c),x[m]<p&&L[m]>p&&Jb(L,x,m,p)}}function Cg(r,e,a,s,c,p){const m=[];for(let x=0;x<r.length;x++){const L=r[x];let N;const R=m.length;let T=0;for(let V=0;V<L.length-1;V++){let F=L[V],O=L[V+1],Q=0;const $=T;let K,ie;p&&(Q=Math.hypot(O.x-F.x,O.y-F.y),T+=Q,K=F,ie=O),F.x<e&&O.x<e||(F.x<e?F=new St(e,F.y+(e-F.x)/(O.x-F.x)*(O.y-F.y))._round():O.x<e&&(O=new St(e,F.y+(e-F.x)/(O.x-F.x)*(O.y-F.y))._round()),F.y<a&&O.y<a||(F.y<a?F=new St(F.x+(a-F.y)/(O.y-F.y)*(O.x-F.x),a)._round():O.y<a&&(O=new St(F.x+(a-F.y)/(O.y-F.y)*(O.x-F.x),a)._round()),F.x>=s&&O.x>=s||(F.x>=s?F=new St(s,F.y+(s-F.x)/(O.x-F.x)*(O.y-F.y))._round():O.x>=s&&(O=new St(s,F.y+(s-F.x)/(O.x-F.x)*(O.y-F.y))._round()),F.y>=c&&O.y>=c||(F.y>=c?F=new St(F.x+(c-F.y)/(O.y-F.y)*(O.x-F.x),c)._round():O.y>=c&&(O=new St(F.x+(c-F.y)/(O.y-F.y)*(O.x-F.x),c)._round()),N&&F.equals(N[N.length-1])||(N=[F],m.push(N),p&&p.push({progress:{min:$+Ob(K,ie,F)*Q,max:1},parentIndex:x,prevPoint:K,nextPoint:ie})),N.push(O),p&&(p[p.length-1].progress.max=$+Ob(K,ie,O)*Q,p[p.length-1].nextPoint=ie)))))}if(p&&T>0)for(let V=R;V<m.length;V++)p[V].progress.min/=T,p[V].progress.max/=T}return m}function aS(r,e,a,s,c){if(r.length<2)return void s.push(r);const p=[];for(;e.valid();){const[N,R]=e.get();for(let T=0;T<r.length-1;T++){const V=r[T],F=r[T+1],O=so(V,F,N,R);if(O){const[Q]=O,$=new St(Sa(V.x,F.x,Q),Sa(V.y,F.y,Q));p.push({t:T+Q,distance:0,point:$})}}e.next()}if(p.length===0)return void s.push(r);p.sort((N,R)=>N.t-R.t);let m=0,x=0,L=[];for(s.push(L);m!==r.length;){if(x===p.length){for(;m!==r.length;)L.length!==0&&L[L.length-1].equals(r[m])||L.push(r[m]),m++;break}p[x].t<=m?(L.length!==0&&L[L.length-1].equals(p[x].point)||L.push(p[x].point),Math.trunc(p[x].t),x++):(L.length!==0&&L[L.length-1].equals(r[m])||L.push(r[m]),m++)}}function Ob(r,e,a){return r.x!==e.x?(a.x-r.x)/(e.x-r.x):r.y!==e.y?(a.y-r.y)/(e.y-r.y):0}function Ny(r,e){return r.x*e.x+r.y*e.y}function Db(r,e){if(r.length===1){let a=0;const s=e[a++];let c;for(;!c||s.equals(c);)if(c=e[a++],!c)return 1/0;for(;a<e.length;a++){const p=e[a],m=r[0],x=c.sub(s),L=p.sub(s),N=m.sub(s),R=Ny(x,x),T=Ny(x,L),V=Ny(L,L),F=Ny(N,x),O=Ny(N,L),Q=R*V-T*T,$=(V*F-T*O)/Q,K=(R*O-T*F)/Q,ie=s.z*(1-$-K)+c.z*$+p.z*K;if(isFinite(ie))return ie}return 1/0}{let a=1/0;for(const s of e)a=Math.min(a,s.z);return a}}function Cb(r,e,a){let s=1/0;Dn(a,e)&&(s=Db(a,e[0]));for(let c=0;c<e.length;c++){const p=e[c],m=r[c];for(let x=0;x<p.length-1;x++){const L=p[x],N=[L,p[x+1],m[x+1],m[x],L];Hn(a,N)&&(s=Math.min(s,Db(a,N)))}}return s!==1/0&&s}function Pb(r,e,a,s,c,p,m,x,L,N,R){return r.projection.name==="globe"?function(T,V,F,O,Q,$,K,ie,le,de,Ee){const Le=[],Ae=[],Me=T.projection.upVectorScale(Ee,T.center.lat,T.worldSize).metersToTile,Je=[0,0,0,1],ot=[0,0,0,1],We=(_t,Zt,Pt,At)=>{_t[0]=Zt,_t[1]=Pt,_t[2]=At,_t[3]=1},ut=Vb();F>0&&(F+=ut),O+=ut;for(const _t of V){const Zt=[],Pt=[];for(const At of _t){const xt=At.x+Q.x,zt=At.y+Q.y,nt=T.projection.projectTilePoint(xt,zt,Ee),rt=T.projection.upVector(Ee,At.x,At.y);let Et=F,Jt=O;if(K){const vt=Gb(xt,zt,F,O,K,ie,le,de);Et+=vt.base,Jt+=vt.top}F!==0?We(Je,nt.x+rt[0]*Me*Et,nt.y+rt[1]*Me*Et,nt.z+rt[2]*Me*Et):We(Je,nt.x,nt.y,nt.z),We(ot,nt.x+rt[0]*Me*Jt,nt.y+rt[1]*Me*Jt,nt.z+rt[2]*Me*Jt),ln(Je,Je,$),ln(ot,ot,$),Zt.push(new Ep(Je[0],Je[1],Je[2])),Pt.push(new Ep(ot[0],ot[1],ot[2]))}Le.push(Zt),Ae.push(Pt)}return[Le,Ae]}(r,e,a,s,c,p,m,x,L,N,R):m?function(T,V,F,O,Q,$,K,ie,le){const de=[],Ee=[],Le=[0,0,0,1];for(const Ae of T){const Me=[],Je=[];for(const ot of Ae){const We=ot.x+O.x,ut=ot.y+O.y,_t=Gb(We,ut,V,F,$,K,ie,le);Le[0]=We,Le[1]=ut,Le[2]=_t.base,Le[3]=1,Xi(Le,Le,Q),Le[3]=Math.max(Le[3],1e-5);const Zt=new Ep(Le[0]/Le[3],Le[1]/Le[3],Le[2]/Le[3]);Le[0]=We,Le[1]=ut,Le[2]=_t.top,Le[3]=1,Xi(Le,Le,Q),Le[3]=Math.max(Le[3],1e-5);const Pt=new Ep(Le[0]/Le[3],Le[1]/Le[3],Le[2]/Le[3]);Me.push(Zt),Je.push(Pt)}de.push(Me),Ee.push(Je)}return[de,Ee]}(e,a,s,c,p,m,x,L,N):function(T,V,F,O,Q){const $=[],K=[],ie=Q[8]*V,le=Q[9]*V,de=Q[10]*V,Ee=Q[11]*V,Le=Q[8]*F,Ae=Q[9]*F,Me=Q[10]*F,Je=Q[11]*F;for(const ot of T){const We=[],ut=[];for(const _t of ot){const Zt=_t.x+O.x,Pt=_t.y+O.y,At=Q[0]*Zt+Q[4]*Pt+Q[12],xt=Q[1]*Zt+Q[5]*Pt+Q[13],zt=Q[2]*Zt+Q[6]*Pt+Q[14],nt=Q[3]*Zt+Q[7]*Pt+Q[15],rt=At+ie,Et=xt+le,Jt=zt+de,vt=Math.max(nt+Ee,1e-5),sa=At+Le,ua=xt+Ae,ta=zt+Me,Yt=Math.max(nt+Je,1e-5);We.push(new Ep(rt/vt,Et/vt,Jt/vt)),ut.push(new Ep(sa/Yt,ua/Yt,ta/Yt))}$.push(We),K.push(ut)}return[$,K]}(e,a,s,c,p)}function Gb(r,e,a,s,c,p,m,x){const L=m*c.getElevationAt(r,e,!0,!0),N=p[0]!==0,R=N?p[1]===0?m*(p[0]/bb-Lb):m*function(T,V,F){const O=Math.floor(V[0]/8),Q=Math.floor(V[1]/8),$=10*(V[0]-8*O),K=10*(V[1]-8*Q),ie=T.getElevationAt(O,Q,!0,!0),le=T.getMeterToDEM(F),de=Math.floor(.5*($*le-1)),Ee=Math.floor(.5*(K*le-1)),Le=T.tileCoordToPixel(O,Q),Ae=2*de+1,Me=2*Ee+1,Je=function(Pt,At,xt,zt,nt){return[Pt.getElevationAtPixel(At,xt,!0),Pt.getElevationAtPixel(At+nt,xt,!0),Pt.getElevationAtPixel(At,xt+nt,!0),Pt.getElevationAtPixel(At+zt,xt+nt,!0)]}(T,Le.x-de,Le.y-Ee,Ae,Me),ot=Math.abs(Je[0]-Je[1]),We=Math.abs(Je[2]-Je[3]),ut=Math.abs(Je[0]-Je[2])+Math.abs(Je[1]-Je[3]),_t=Math.min(.25,.5*le*(ot+We)/Ae),Zt=Math.min(.25,.5*le*ut/Me);return ie+Math.max(_t*$,Zt*K)}(c,p,x):L;return{base:L+(a===0?-1:a),top:N?Math.max(R+s,L+a+2):L+s}}class rS{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nS{constructor(){this.tasks={},this.taskQueue=[],tt(["process"],this),this.invoker=new rS(this.process),this.nextId=0}add(e,a){const s=this.nextId++,c=function({type:p,isSymbolTile:m,zoom:x}){return x=x||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-x:p==="maybePrepare"&&m?400-x:500:200-x:100-x}(a);if(c===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:a,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const a=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let e=null,a=1/0;for(let c=0;c<this.taskQueue.length;c++){const p=this.tasks[this.taskQueue[c]];p.priority<a&&(a=p.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Ub{constructor(e,a,s){this.target=e,this.parent=a,this.mapId=s,this.callbacks={},this.cancelCallbacks={},tt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nS}send(e,a,s,c,p=!1,m){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=m,this.callbacks[x]=s);const L=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!s,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:lc(a,L)},L),{cancel:()=>{s&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const a=e.data;if(!a)return;const s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(a.mustQueue||Jn(self)){const c=this.callbacks[s],p=this.scheduler.add(()=>this.processTask(s,a),c&&c.metadata||{type:"message"});p&&(this.cancelCallbacks[s]=p)}else this.processTask(s,a)}processTask(e,a){if(delete this.cancelCallbacks[e],a.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(a.error?s(Oo(a.error)):s(null,Oo(a.data)))}else{const s=new Set,c=a.hasCallback?(m,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?lc(m):null,data:lc(x,s)},s)}:()=>{},p=Oo(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,p,c);else if(this.parent.getWorkerSource){const m=a.type.split("."),{source:x,scope:L}=p;this.parent.getWorkerSource(a.sourceMapId,m[0],x,L)[m[1]](p,c)}else c(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ey={workerUrl:"",workerClass:null,workerParams:void 0};const F_="mapboxgl_preloaded_worker_pool";class Sp{constructor(){this.active={}}acquire(e,a=Sp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(Ey.workerClass!=null?new Ey.workerClass:new self.Worker(Ey.workerUrl,Ey.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[F_]}numActive(){return Object.keys(this.active).length}}Sp.workerCount=2;class mm{constructor(e,a,s="Worker",c=Sp.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=at();const p=this.workerPool.acquire(this.id,c);for(let m=0;m<p.length;m++){const x=new mm.Actor(p[m],a,this.id);x.name=`${s} ${m}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,a,s){Re(this.actors,(c,p)=>{c.send(e,a,p)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Sy,O_;function Pg(){return Sy||(Sy=new Sp),Sy}mm.Actor=Ub;class iS{constructor(e){this.module=e}createIntArray(e){const a=new Int32Array(e),s=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,s/a.BYTES_PER_ELEMENT),s}createFloatArray(e){const a=new Float32Array(e),s=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,s/a.BYTES_PER_ELEMENT),s}createStringBuffer(e){const a=this.module.malloc(e.length+1);for(let s=0;s<e.length;++s)this.module.heapU8[a+s]=e.charCodeAt(s);return this.module.heapU8[a+e.length]=0,a}readStringBuffer(e){let a="";for(;this.module.heapU8[e]!==0;)a+=String.fromCharCode(this.module.heapU8[e]),++e;return a}setStyle(e){const a=e.entranceColorRgb,s=e.facadeGlazingColorRgb,c=e.roofColorRgb,p=e.wallColorRgb,m=e.normalScale;this.module.setStyle(a[0],a[1],a[2],s[0],s[1],s[2],c[0],c[1],c[2],p[0],p[1],p[2],m[0],m[1],m[2],e.tileToMeters)}setAOOptions(e,a){this.module.setAOOptions(e?1:0,a)}setMetricOptions(e,a){this.module.setMetricOptions(e?1:0,a)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,a){this.module.setFacadeOptions(e,a?1:0)}setFauxFacadeOptions(e,a,s){this.module.setFauxFacadeOptions(e?1:0,a?1:0,s)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,a){for(const x of e){const L=this.createStringBuffer(x.roofType),N=[0],R=[];for(const F of x.coordinates)if(Array.isArray(F)){for(const O of F)R.push(O.x),R.push(O.y);N.push(R.length)}const T=this.createIntArray(N),V=this.createFloatArray(R);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,L,x.roofType.length,V,T,N.length-1),this.module.free(L),this.module.free(T),this.module.free(V)}for(const x of a){let L;L=x.entrances?JSON.parse(x.entrances):[];const N=this.createFloatArray(L),R=[];for(const V of x.coordinates)R.push(V.x),R.push(V.y);const T=this.createFloatArray(R);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,N,L.length,T,R.length),this.module.free(N),this.module.free(T)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const s=this.module.getMeshCount(),c=new Array(s);for(let x=0;x<s;x++){const L=this.module.getPositionsPtr(x),N=this.module.getPositionsLength(x),R=new Float32Array(this.module.heapF32.buffer,L,N),T=this.module.getNormalsPtr(x),V=this.module.getNormalsLength(x),F=new Float32Array(this.module.heapF32.buffer,T,V),O=this.module.getColorsPtr(x),Q=this.module.getColorsLength(x),$=new Uint8Array(this.module.heapU8.buffer,O,Q),K=this.module.getAOPtr(x),ie=this.module.getAOLength(x),le=new Float32Array(this.module.heapF32.buffer,K,ie),de=this.module.getUVPtr(x),Ee=this.module.getUVLength(x),Le=new Float32Array(this.module.heapF32.buffer,de,Ee),Ae=this.module.getFauxFacadePtr(x),Me=this.module.getFauxFacadeLength(x),Je=new Uint8Array(this.module.heapU8.buffer,Ae,Me),ot=this.module.getIndicesPtr(x),We=this.module.getIndicesLength(x),ut=new Int32Array(this.module.heap32.buffer,ot,We),_t=this.module.getBuildingPart(x),Zt=this.readStringBuffer(_t);c[x]={positions:R,normals:F,colors:$,ao:le,uv:Le,isFauxFacade:Je,indices:ut,buildingPart:Zt}}const p=this.module.getRingCount(),m=[];for(let x=0;x<p;x++){const L=this.module.getRingPtr(x),N=this.module.getRingLength(x),R=new Float32Array(this.module.heapF32.buffer,L,N);m.push(R)}return{meshes:c,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:m}}}let zy,D_,Cu,ym,C_,gm=null,_m=null,Wb=null,Gg=null;function Xb(){return Jn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:D_||sn.DRACO_URL}function Qb(){if(Jn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ym)return ym;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ym=WebAssembly.validate(r)?sn.MESHOPT_SIMD_URL:sn.MESHOPT_URL,ym}function sS(){return Gg}const Ug={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},oS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ay={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Hb(r,e,a){const s=a.json.bufferViews.length,c=a.buffers.length;e.bufferView=s,a.json.bufferViews[s]={buffer:c,byteLength:r.byteLength},a.buffers[c]=r}const P_="KHR_draco_mesh_compression";function lS(r,e){const a=r.extensions&&r.extensions[P_];if(!a)return;const s=new Cu.Decoder,c=Kb(e,a.bufferView),p=new Cu.Mesh;if(!s.DecodeArrayToMesh(c,c.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[r.indices],x=Ug[m.componentType],L=m.count*x.BYTES_PER_ELEMENT,N=Cu._malloc(L);x===Uint16Array?s.GetTrianglesUInt16Array(p,L,N):s.GetTrianglesUInt32Array(p,L,N),Hb(Cu.memory.buffer.slice(N,N+L),m,e),Cu._free(N);for(const R of Object.keys(a.attributes)){const T=s.GetAttributeByUniqueId(p,a.attributes[R]),V=e.json.accessors[r.attributes[R]],F=oS[V.componentType],O=V.count*Ay[V.type]*Ug[V.componentType].BYTES_PER_ELEMENT,Q=Cu._malloc(O);s.GetAttributeDataArrayForAllPoints(p,T,Cu[F],O,Q),Hb(Cu.memory.buffer.slice(Q,Q+O),V,e),Cu._free(Q)}s.destroy(),p.destroy(),delete r.extensions[P_]}const Wg="EXT_meshopt_compression";function cS(r,e){if(!r.extensions||!r.extensions[Wg])return;const a=r.extensions[Wg],s=new Uint8Array(e.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),c=new Uint8Array(a.count*a.byteStride);C_.decodeGltfBuffer(c,a.count,a.byteStride,s,a.mode,a.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=c.buffer,delete r.extensions[Wg]}const Yb=1179937895,$b=new TextDecoder("utf8");function qb(r,e){return new URL(r,e).href}function uS(r,e,a,s){return fetch(qb(r.uri,s)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[a]=c})}function Kb(r,e){const a=r.json.bufferViews[e];return new Uint8Array(r.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function dS(r,e,a,s){if(r.uri){const c=qb(r.uri,s);return fetch(c).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[a]=p})}if(r.bufferView!==void 0){const c=Kb(e,r.bufferView),p=new Blob([c],{type:r.mimeType});return createImageBitmap(p).then(m=>{e.images[a]=m})}}function e1(r,e=0,a){const s={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===Yb){const R=new Uint32Array(r,e);let T=2;const V=(R[T++]>>2)-3,F=R[T++]>>2;if(T++,s.json=JSON.parse($b.decode(R.subarray(T,T+F))),T+=F,T<V){const O=R[T++];T++;const Q=e+(T<<2);s.buffers[0]=r.slice(Q,Q+O)}}else s.json=JSON.parse($b.decode(new Uint8Array(r,e)));const{buffers:c,images:p,meshes:m,extensionsUsed:x,bufferViews:L}=s.json;let N=Promise.resolve();if(c){const R=[];for(let T=0;T<c.length;T++){const V=c[T];V.uri?R.push(uS(V,s,T,a)):s.buffers[T]||(s.buffers[T]=null)}N=Promise.all(R)}return N.then(()=>{const R=[],T=x&&x.includes(P_),V=x&&x.includes(Wg);if(T&&R.push(function(){if(!Cu)return zy??(zy=function(F){let O,Q=null;function $(){O=new Uint8Array(Q.buffer)}function K(){throw new Error("Unexpected Draco error.")}const ie={a:{a:K,d:function(le,de,Ee){return O.copyWithin(le,de,de+Ee)},c:function(le){const de=O.length,Ee=Math.max(le>>>0,Math.ceil(1.2*de)),Le=Math.ceil((Ee-de)/65536);try{return Q.grow(Le),$(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,ie):F.then(le=>le.arrayBuffer()).then(le=>WebAssembly.instantiate(le,ie))).then(le=>{const{Rb:de,Qb:Ee,P:Le,T:Ae,X:Me,Ja:Je,La:ot,Qa:We,Va:ut,Wa:_t,eb:Zt,jb:Pt,f:At,e:xt,yb:zt,zb:nt,Ab:rt,Bb:Et,Db:Jt,Gb:vt}=le.instance.exports;Q=xt;const sa=(()=>{let ua=0,ta=0,Yt=0,Fa=0;return ea=>{Yt&&(de(Fa),de(ua),ta+=Yt,Yt=ua=0),ua||(ta+=128,ua=Ee(ta));const ja=ea.length+7&-8;let Da=ua;ja>=ta&&(Yt=ja,Da=Fa=Ee(ja));for(let nr=0;nr<ea.length;nr++)O[Da+nr]=ea[nr];return Da}})();return $(),At(),{memory:xt,_free:de,_malloc:Ee,Mesh:class{constructor(){this.ptr=Le()}destroy(){Ae(this.ptr)}},Decoder:class{constructor(){this.ptr=Je()}destroy(){Pt(this.ptr)}DecodeArrayToMesh(ua,ta,Yt){const Fa=sa(ua),ea=ot(this.ptr,Fa,ta,Yt.ptr);return!!Me(ea)}GetAttributeByUniqueId(ua,ta){return{ptr:We(this.ptr,ua.ptr,ta)}}GetTrianglesUInt16Array(ua,ta,Yt){ut(this.ptr,ua.ptr,ta,Yt)}GetTrianglesUInt32Array(ua,ta,Yt){_t(this.ptr,ua.ptr,ta,Yt)}GetAttributeDataArrayForAllPoints(ua,ta,Yt,Fa,ea){Zt(this.ptr,ua.ptr,ta.ptr,Yt,Fa,ea)}},DT_INT8:zt(),DT_UINT8:nt(),DT_INT16:rt(),DT_UINT16:Et(),DT_UINT32:Jt(),DT_FLOAT32:vt()}})}(fetch(Xb())),zy.then(F=>{Cu=F,zy=void 0}))}()),V&&R.push(function(){if(C_)return;const F=function(O){let Q;const $=WebAssembly.instantiateStreaming(O,{}).then(le=>{Q=le.instance,Q.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ie={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(le,de,Ee,Le,Ae,Me){(function(Je,ot,We,ut,_t,Zt,Pt){const At=Je.exports.sbrk,xt=ut+3&-4,zt=At(xt*_t),nt=At(Zt.length),rt=new Uint8Array(Je.exports.memory.buffer);rt.set(Zt,nt);const Et=ot(zt,ut,_t,nt,Zt.length);if(Et===0&&Pt&&Pt(zt,xt,_t),We.set(rt.subarray(zt,zt+ut*_t)),At(zt-At(0)),Et!==0)throw new Error(`Malformed buffer data: ${Et}`)})(Q,Q.exports[ie[Ae]],le,de,Ee,Le,Q.exports[K[Me]])}}}(fetch(Qb()));return F.ready.then(()=>{C_=F})}()),p)for(let F=0;F<p.length;F++)R.push(dS(p[F],s,F,a));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(T&&m)for(const{primitives:F}of m)for(const O of F)lS(O,s);if(V&&m&&L)for(const F of L)cS(F,s);return s})})}function t1(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>e1(e,0,r))}function G_(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function U_(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class W_{constructor(e,a,s,c){this.context=e,this.format=s,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(a,{premultiply:c&&c.premultiply})}update(e,a){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:m}=p,{x,y:L}=a&&a.position?a.position:{x:0,y:0},N=x+s,R=L+c;!this.size||this.size[0]===N&&this.size[1]===R||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!a||a.premultiply!==!1));const T=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&N>0&&R>0){const V=this.useMipmap?Math.floor(Math.log2(Math.max(N,R)))+1:1;m.texStorage2D(m.TEXTURE_2D,V,this.format,N,R),this.size=[N,R]}this.size&&(T?m.texSubImage2D(m.TEXTURE_2D,0,x,L,G_(this.format),U_(this.format),e):"data"in e&&e.data&&m.texSubImage2D(m.TEXTURE_2D,0,x,L,s,c,G_(this.format),U_(this.format),e.data)),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,a,s=!1){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(e,a,s,c,p){const{context:m}=this,{gl:x}=m;x.bindTexture(x.TEXTURE_2D,this.texture),a!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),this.magFilter=a),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,s),this.wrapS=s),c!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrapT=c),p!==this.compareMode&&(p?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,p)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ry{constructor(e,a){this.context=e,this.texture=a}bind(e,a){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),a!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,a),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,a),this.wrapS=a)}}const hS=tr([{name:"a_pos_3f",components:3,type:"Float32"}]),fS=tr([{name:"a_color_3f",components:3,type:"Float32"}]),pS=tr([{name:"a_color_4f",components:4,type:"Float32"}]),mS=tr([{name:"a_uv_2f",components:2,type:"Float32"}]),yS=tr([{name:"a_normal_3f",components:3,type:"Float32"}]),gS=tr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),_S=tr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function a1(r,e){const a=Xg(r.projection,r.zoom,r.width,r.height),s=function(p,m,x,L,N){const R=new C(x.lng-180*Of,x.lat),T=new C(x.lng+180*Of,x.lat),V=p.project(R.lng,R.lat),F=p.project(T.lng,T.lat),O=-Math.atan2(F.y-V.y,F.x-V.x),Q=Pe.fromLngLat(x);Q.y=re(Q.y,-1+Of,1-Of);const $=Q.toLngLat(),K=p.project($.lng,$.lat),ie=Pe.fromLngLat($);ie.x+=Of;const le=ie.toLngLat(),de=p.project(le.lng,le.lat),Ee=n1(de.x-K.x,de.y-K.y,O),Le=Pe.fromLngLat($);Le.y+=Of;const Ae=Le.toLngLat(),Me=p.project(Ae.lng,Ae.lat),Je=n1(Me.x-K.x,Me.y-K.y,O),ot=Math.abs(Ee.x)/Math.abs(Je.y),We=pe([]);Qe(We,We,-O*(1-(N?0:L)));const ut=pe([]);return $e(ut,ut,[1,1-(1-ot)*L,1]),ut[4]=-Je.x/Je.y*L,Qe(ut,ut,O),ke(ut,We,ut),ut}(r.projection,0,r.center,a,e),c=r1(r);return $e(s,s,[c,c,1]),s}function r1(r){const e=r.projection,a=Xg(r.projection,r.zoom,r.width,r.height),s=X_(e,r.center),c=X_(e,C.convert(e.center));return Math.pow(2,s*a+(1-a)*c)}function Xg(r,e,a,s,c=1/0){const p=r.range;if(!p)return 0;const m=Math.min(c,Math.max(a,s)),x=Math.log2(m/1024);return xe(p[0]+x,p[1]+x,e)}const Of=1/4e4;function X_(r,e){const a=re(e.lat,-me,me),s=new C(e.lng-180*Of,a),c=new C(e.lng+180*Of,a),p=r.project(s.lng,a),m=r.project(c.lng,a),x=Pe.fromLngLat(s),L=Pe.fromLngLat(c),N=m.x-p.x,R=m.y-p.y,T=L.x-x.x,V=L.y-x.y,F=Math.sqrt((T*T+V*V)/(N*N+R*R));return Math.log2(F)}function n1(r,e,a){const s=Math.cos(a),c=Math.sin(a);return{x:r*s-e*c,y:r*c+e*s}}function i1(r,e,a){pe(r),Qe(r,r,fr(e[2])),De(r,r,fr(e[0])),Te(r,r,fr(e[1])),$e(r,r,a),ke(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Qg(r,e,a,s,c,p,m,x){const L=[a[0]-e[0],a[1]-e[1],0],N=[s[0]-e[0],s[1]-e[1],0];if(ht(L)<1e-12||ht(N)<1e-12)return aa(r);const R=Pn([],L,N);ka(R,R),mt(N,s,e),L[2]=(p-c)*x,N[2]=(m-c)*x;const T=L;return Pn(T,L,N),ka(T,T),us(r,R,T)}function Hg(r,e,a=!1){const s=kf(e.zoom),c=function(p,m,x){const L=m.worldSize,N=[p[12],p[13],p[14]],R=ce(N[1]/L),T=he(N[0]/L),V=pe([]),F=se(1,R)*L,O=se(1,0)*L*we(R,m.zoom),Q=1/Bn(L);let $=O*Q;if(x){const de=Xg(m.projection,m.zoom,m.width,m.height,1024);$=Q*m.projection.pixelSpaceConversion(m.center.lat,L,de)}const K=A(R,T);Lt(K,K,Be([],ka([],K),F*$*N[2]));const ie=function(de){const Ee=[de[0],de[1],de[2]];let Le=[0,1,0];const Ae=Pn([],Le,Ee);return Pn(Le,Ee,Ae),Er(Le)===0&&(Le=[0,1,0],Pn(Ae,Ee,Le)),ka(Ae,Ae),ka(Le,Le),ka(Ee,Ee),[Ae[0],Ae[1],Ae[2],0,Le[0],Le[1],Le[2],0,Ee[0],Ee[1],Ee[2],0,de[0],de[1],de[2],1]}(K);$e(V,V,[$,$,$*F]),ye(V,V,[-N[0],-N[1],-N[2]]);const le=ke([],m.globeMatrix,ie);return ke(le,le,V),ke(le,le,p),le}(r,e,a);if(s>0){const p=function(m,x){const L=x.worldSize,N=se(1,0)*L*we(x.center.lat,x.zoom)/Bn(L),R=se(1,x.center.lat)*L,T=pe([]);Te(T,T,fr(x.center.lng)),De(T,T,fr(x.center.lat)),ye(T,T,[0,0,On]),$e(T,T,[N,N,N*R]);const V=x.point;return ye(T,T,[-V.x,-V.y,0]),ke(T,T,m),ke(T,x.globeMatrix,T)}(r,e);return function(m,x,L){const N=(O,Q,$)=>{const K=ht(O),ie=ht(Q),le=ai(O,Q,$);return Be(le,le,1/ht(le)*Sa(K,ie,$))},R=N([m[0],m[1],m[2]],[x[0],x[1],x[2]],L),T=N([m[4],m[5],m[6]],[x[4],x[5],x[6]],L),V=N([m[8],m[9],m[10]],[x[8],x[9],x[10]],L),F=ai([m[12],m[13],m[14]],[x[12],x[13],x[14]],L);return[R[0],R[1],R[2],0,T[0],T[1],T[2],0,V[0],V[1],V[2],0,F[0],F[1],F[2],1]}(c,p,s)}return c}function Q_(r,e,a,s){const c=Ca.projectAabbCorners(s,a);let p=Number.MAX_VALUE;for(let x=0;x<c.length;++x){const L=c[x];L[0]=(.5*L[0]+.5)*e.width,L[1]=(.5-.5*L[1])*e.height,L[2]<p&&(p=L[2])}const m=function(x){const L=[];let N=0;for(let F=1;F<x.length;F++)(x[F][0]<x[N][0]||x[F][0]===x[N][0]&&x[F][1]<x[N][1])&&(N=F);let R,T=N;const V=new Uint8Array(x.length);do{if(V[T])break;L.push(new St(x[T][0],x[T][1])),V[T]=1,R=(T+1)%x.length;for(let F=0;F<x.length;F++){if(x[F][0]===x[R][0]&&x[F][1]===x[R][1]||x[F][0]===x[T][0]&&x[F][1]===x[T][1])continue;const O=[x[F][0]-x[T][0],x[F][1]-x[T][1]],Q=[x[R][0]-x[T][0],x[R][1]-x[T][1]],$=O[0]*Q[1]-O[1]*Q[0];($>0||$===0&&O[0]*Q[0]+O[1]*Q[1]>=0&&O[0]*O[0]+O[1]*O[1]>Q[0]*Q[0]+Q[1]*Q[1])&&(R=F)}T=R}while(T!==N);return L.length>0&&L.push(L[0]),L}(c);if(Hn(r,m))return p}const zp=64,xm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Yg(r,e,a,s,c,p,m,x,L,N=!1){const R=a.zoom,T=a.project(s),V=we(s.lat,R),F=1/V;pe(r),ye(r,r,[T.x+m[0]*F,T.y+m[1]*F,m[2]]);let O=1,Q=1;const $=a.worldSize;if(N){if(a.projection.name==="mercator"){let de=0;a.elevation&&(de=a.elevation.getAtPointOrZero(new Pe(T.x/$,T.y/$),0));const Ee=Xi([],[T.x,T.y,de,1],a.projMatrix)[3]/a.cameraToCenterDistance;O=Ee,Q=Ee*we(a.center.lat,R)}else if(a.projection.name==="globe"){const de=Hg(r,a),Ee=[0,0,0,1];Xi(Ee,Ee,ke([],a.projMatrix,de));const Le=Ee[3]/a.cameraToCenterDistance,Ae=kf(R),Me=a.projection.pixelsPerMeter(s.lat,$)*we(s.lat,R),Je=a.projection.pixelsPerMeter(a.center.lat,$)*we(a.center.lat,R);O=Le/Sa(Me,Ne(a.center.lat),Ae),Q=Le*V/Me,O*=Je,Q*=Je}}else O=F;$e(r,r,[O,O,Q]);const K=[...r],ie=e.orientation,le=[];if(i1(le,[ie[0]+(c?c[0]:0),ie[1]+(c?c[1]:0),ie[2]+(c?c[2]:0)],p),ke(r,K,le),x&&a.elevation){let de=0;const Ee=[];if(L&&a.elevation){de=function(Ae,Me,Je,ot,We){const ut=Me.elevation;if(!ut)return 0;const _t=Ca.projectAabbCorners(Je,ot),Zt=se(1,We.lat)*Me.worldSize,Pt=function(ta,Yt){const Fa=[0,0,1],ea=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ja of ea){const Da=ta[ja.corners[0]],nr=ta[ja.corners[1]],Zr=ta[ja.corners[2]],Pa=[nr[0]-Da[0],nr[1]-Da[1],Yt*(nr[2]-Da[2])],Br=Pn(Pa,Pa,[Zr[0]-Da[0],Zr[1]-Da[1],Yt*(Zr[2]-Da[2])]);ka(Br,Br),ja.dotProductWithUp=gr(Br,Fa)}return ea.sort((ja,Da)=>ja.dotProductWithUp-Da.dotProductWithUp),ea[0].corners}(_t,Zt),At=_t[Pt[0]],xt=_t[Pt[1]],zt=_t[Pt[2]],nt=_t[Pt[3]],rt=ut.getAtPointOrZero(new Pe(At[0]/Me.worldSize,At[1]/Me.worldSize),0),Et=ut.getAtPointOrZero(new Pe(xt[0]/Me.worldSize,xt[1]/Me.worldSize),0),Jt=ut.getAtPointOrZero(new Pe(zt[0]/Me.worldSize,zt[1]/Me.worldSize),0),vt=ut.getAtPointOrZero(new Pe(nt[0]/Me.worldSize,nt[1]/Me.worldSize),0),sa=(rt+vt)/2,ua=(Et+Jt)/2;return sa>ua?Et<Jt?Qg(Ae,xt,nt,At,Et,vt,rt,Zt):Qg(Ae,zt,At,nt,Jt,rt,vt,Zt):rt<vt?Qg(Ae,At,xt,zt,rt,Et,Jt,Zt):Qg(Ae,nt,zt,xt,vt,Jt,Et,Zt),Math.max(sa,ua)}(Ee,a,e.aabb,r,s);const Le=ke([],Gt([],Ee),le);ke(r,K,Le)}else de=a.elevation.getAtPointOrZero(new Pe(T.x/$,T.y/$),0);de!==0&&(r[14]+=de)}}class s1{constructor(e,a,s,c,p){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=a,this.position=s!=null?new C(s[0],s[1]):new C(0,0),this.orientation=c??[0,0,0],this.nodes=p,this.uploaded=!1,this.aabb=new Ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,a){ke(e.globalMatrix,a,e.localMatrix);const s=this.nodeOverrides.get(e.name);if(s!==void 0){const m=[];p=s.orientation,pe(c=m),Te(c,c,fr(p[1])),Qe(c,c,fr(p[2])),De(c,c,fr(p[0])),ke(e.globalMatrix,e.globalMatrix,m)}var c,p;if(e.meshes)for(const m of e.meshes){const x=Ca.applyTransformFast(m.aabb,e.globalMatrix);this.aabb.encapsulate(x)}if(e.children)for(const m of e.children)this._applyTransformations(m,e.globalMatrix)}computeBoundsAndApplyParent(){const e=pe([]);this.aabb=new Ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.nodes)this._applyTransformations(a,e)}computeModelMatrix(e,a,s,c,p,m,x=!1){Yg(this.matrix,this,e.transform,this.position,a,s,c,p,m,x)}upload(e){if(!this.uploaded){for(const a of this.nodes)H_(a,e);for(const a of this.nodes)$g(a);this.uploaded=!0}}destroy(){for(const e of this.nodes)Y_(e)}}function Ty(r,e,a=!1){r.uploaded||(r.gfxTexture=new W_(e,r.image,a?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function xS(r,e,a){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,hS.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,yS.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,mS.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?fS:pS).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,_S.members,!0)),r.segments=Ar.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const s=r.material;s.pbrMetallicRoughness.baseColorTexture&&Ty(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Ty(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Ty(s.normalTexture,e),s.occlusionTexture&&Ty(s.occlusionTexture,e,a),s.emissionTexture&&Ty(s.emissionTexture,e)}function H_(r,e,a){if(r.meshes)for(const s of r.meshes)xS(s,e,a);if(r.children)for(const s of r.children)H_(s,e,a)}function $g(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)$g(e)}function Y_(r){if(r.meshes)for(const a of r.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((e=a.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const a of r.children)Y_(a)}function Ap(r,e){const a=r.json.bufferViews[e.bufferView],s=Ug[e.componentType];return new s(r.buffers[a.buffer],(e.byteOffset||0)+(a.byteOffset||0),e.count*(a.byteStride&&a.byteStride!==Ay[e.type]*s.BYTES_PER_ELEMENT?a.byteStride/s.BYTES_PER_ELEMENT:Ay[e.type]))}function $_(r,e,a,s){const c=Ug[e.componentType],p=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),m=r.json.bufferViews[e.bufferView],x=m.byteStride?m.byteStride/c.BYTES_PER_ELEMENT:Ay[e.type],L=a.float32,N=L.length/a.capacity;for(let R=0,T=0;R<e.count*x;R+=x,T+=N)for(let V=0;V<N;V++)L[T+V]=s[R+V]*p;a._trim()}function wS(r,e,a){const s=r.indices,c=r.attributes,p={};p.indexArray=new gn;const m=e.json.accessors[s],x=m.count/3;p.indexArray.reserve(x);const L=Ap(e,m);for(let V=0;V<x;V++)p.indexArray.emplaceBack(L[3*V],L[3*V+1],L[3*V+2]);p.indexArray._trim(),p.vertexArray=new Cs;const N=e.json.accessors[c.POSITION];p.vertexArray.reserve(N.count);const R=Ap(e,N);for(let V=0;V<N.count;V++)p.vertexArray.emplaceBack(R[3*V],R[3*V+1],R[3*V+2]);if(p.vertexArray._trim(),p.aabb=new Ca(N.min,N.max),p.centroid=function(V,F){const O=[0,0,0],Q=V.length;if(Q>0){for(let $=0;$<Q;$++){const K=3*V[$];O[0]+=F[K],O[1]+=F[K+1],O[2]+=F[K+2]}O[0]/=Q,O[1]/=Q,O[2]/=Q}return O}(L,R),c.COLOR_0!==void 0){const V=e.json.accessors[c.COLOR_0],F=Ay[V.type],O=Ap(e,V);p.colorArray=F===3?new Cs:new uc,p.colorArray.resize(V.count),$_(e,V,p.colorArray,O)}if(c.NORMAL!==void 0){p.normalArray=new Cs;const V=e.json.accessors[c.NORMAL];p.normalArray.resize(V.count);const F=Ap(e,V);$_(e,V,p.normalArray,F)}if(c.TEXCOORD_0!==void 0&&a.length>0){p.texcoordArray=new dc;const V=e.json.accessors[c.TEXCOORD_0];p.texcoordArray.resize(V.count);const F=Ap(e,V);$_(e,V,p.texcoordArray,F)}if(c._FEATURE_ID_RGBA4444!==void 0){const V=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Ap(e,V))}c._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Ap(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const T=r.material;return p.material=function(V,F){const{emissiveFactor:O=[0,0,0],alphaMode:Q="OPAQUE",alphaCutoff:$=.5,normalTexture:K,occlusionTexture:ie,emissiveTexture:le,doubleSided:de,name:Ee}=V,{baseColorFactor:Le=[1,1,1,1],metallicFactor:Ae=1,roughnessFactor:Me=1,baseColorTexture:Je,metallicRoughnessTexture:ot}=V.pbrMetallicRoughness||{},We=ie?F[ie.index]:void 0;if(ie&&ie.extensions&&ie.extensions.KHR_texture_transform&&We){const ut=ie.extensions.KHR_texture_transform;We.offsetScale=[ut.offset[0],ut.offset[1],ut.scale[0],ut.scale[1]]}return{name:Ee,pbrMetallicRoughness:{baseColorFactor:new Or(...Le),metallicFactor:Ae,roughnessFactor:Me,baseColorTexture:Je?F[Je.index]:void 0,metallicRoughnessTexture:ot?F[ot.index]:void 0},doubleSided:de,emissiveFactor:new Or(...O),alphaMode:Q,alphaCutoff:$,normalTexture:K?F[K.index]:void 0,occlusionTexture:We,emissionTexture:le?F[le.index]:void 0,defined:V.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},a),p}function o1(r,e,a){const{matrix:s,rotation:c,translation:p,scale:m,mesh:x,extras:L,children:N,name:R}=r,T={};if(T.name=R,T.localMatrix=s||function(V,F,O,Q){var $=F[0],K=F[1],ie=F[2],le=F[3],de=$+$,Ee=K+K,Le=ie+ie,Ae=$*de,Me=$*Ee,Je=$*Le,ot=K*Ee,We=K*Le,ut=ie*Le,_t=le*de,Zt=le*Ee,Pt=le*Le,At=Q[0],xt=Q[1],zt=Q[2];return V[0]=(1-(ot+ut))*At,V[1]=(Me+Pt)*At,V[2]=(Je-Zt)*At,V[3]=0,V[4]=(Me-Pt)*xt,V[5]=(1-(Ae+ut))*xt,V[6]=(We+_t)*xt,V[7]=0,V[8]=(Je+Zt)*zt,V[9]=(We-_t)*zt,V[10]=(1-(Ae+ot))*zt,V[11]=0,V[12]=O[0],V[13]=O[1],V[14]=O[2],V[15]=1,V}([],c||[0,0,0,1],p||[0,0,0],m||[1,1,1]),T.globalMatrix=oe(T.localMatrix),x!==void 0){T.meshes=a[x];const V=T.anchor=[0,0];for(const F of T.meshes){const{min:O,max:Q}=F.aabb;V[0]+=O[0]+Q[0],V[1]+=O[1]+Q[1]}V[0]=Math.floor(V[0]/T.meshes.length/2),V[1]=Math.floor(V[1]/T.meshes.length/2)}if(L&&(L.id&&(T.id=L.id),L.lights&&(T.lights=function(V){if(!V.length)return[];const F=function(ie){const le=atob(ie),de=new Uint8Array(le.length);for(let Ee=0;Ee<le.length;Ee++)de[Ee]=le.codePointAt(Ee);return de}(V),O=[],Q=F.length/24,$=new Uint16Array(F.buffer),K=new Float32Array(F.buffer);for(let ie=0;ie<Q;ie++){const le=$[2*ie*6]/30,de=$[2*ie*6+1]/30,Ee=$[2*ie*6+10]/100,Le=K[6*ie+1],Ae=K[6*ie+2],Me=K[6*ie+3],Je=K[6*ie+4],ot=Me-Le,We=Je-Ae,ut=Math.hypot(ot,We);O.push({pos:[Le+.5*ot,Ae+.5*We,de],normal:[We/ut,-ot/ut,0],width:ut,height:le,depth:Ee,points:[Le,Ae,Me,Je]})}return O}(L.lights)),L.MAPBOX_geometry_bloom&&(T.isGeometryBloom=L.MAPBOX_geometry_bloom)),N){const V=[];for(const F of N)V.push(o1(e.json.nodes[F],e,a));T.children=V}return T}function vS(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new kg(r.vertices,r.indices,8,256),[a,s]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:a,max:s}}function bS(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const a=e[0];if(!a||!Array.isArray(a)||a.length===0)return null;const s=[];for(const m of a){if(!Array.isArray(m)||m.length!==2)continue;const x=m[0],L=m[1];typeof x=="number"&&typeof L=="number"&&s.push(new St(x,L))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let c=0;for(let m=0;m<s.length;m++){const x=s[m],L=s[(m+1)%s.length],N=s[(m+2)%s.length];c+=(x.x-L.x)*(N.y-L.y)-(N.x-L.x)*(x.y-L.y)}c>0&&s.reverse();const p=fm(s.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:s,indices:p}}function LS(r,e){const a=[],s=[];let c=0;const p=[];for(const m of r){c=a.length;const x=m.vertexArray.float32,L=m.indexArray.uint16;for(let N=0;N<m.vertexArray.length;N++)p[0]=x[3*N+0],p[1]=x[3*N+1],p[2]=x[3*N+2],ln(p,p,e),a.push(new St(p[0],p[1]));for(let N=0;N<3*m.indexArray.length;N++)s.push(L[N]+c)}if(s.length%3!=0)return null;for(let m=0;m<s.length;m+=3){const x=a[s[m+0]],L=a[s[m+1]],N=a[s[m+2]];(x.x-L.x)*(N.y-L.y)-(N.x-L.x)*(x.y-L.y)>0&&([s[m+1],s[m+2]]=[s[m+2],s[m+1]])}return{vertices:a,indices:s}}function q_(r){const e=function(L,N){const R=[],T=WebGL2RenderingContext;if(L.json.textures)for(const V of L.json.textures){const F={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};V.sampler!==void 0&&Object.assign(F,L.json.samplers[V.sampler]),R.push({image:N[V.source],sampler:F,uploaded:!1})}return R}(r,r.images),a=function(L,N){const R=[];for(const T of L.json.meshes){const V=[];for(const F of T.primitives)V.push(wS(F,L,N));R.push(V)}return R}(r,e),{scenes:s,scene:c,nodes:p}=r.json,m=s?s[c||0].nodes:[...p.keys()],x=[];for(const L of m)x.push(o1(p[L],r,a));return function(L,N,R){const T={},V=new Set;for(let F=0;F<L.length;F++){const O=R[N[F]];if(!O.extras)continue;const Q=O.extras["mapbox:footprint:version"],$=O.extras["mapbox:footprint:id"];(Q||$)&&V.add(F),Q==="1.0.0"&&$&&(T[$]=F)}for(let F=0;F<L.length;F++){if(V.has(F))continue;const O=L[F],Q=R[N[F]];if(!Q.extras)continue;let $=null;O.id in T&&($=LS(L[T[O.id]].meshes,O.localMatrix)),$||($=bS(Q)),$&&(O.footprint=vS($))}if(V.size>0){const F=Array.from(V.values()).sort((O,Q)=>O-Q);for(let O=F.length-1;O>=0;O--)L.splice(F[O],1)}}(x,m,r.json.nodes),x}function jS(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,a=r.aabb.min[0]-1,s=r.aabb.min[1]-1,c=zp/(r.aabb.max[0]-a+2),p=zp/(r.aabb.max[1]-s+2);for(let m=0;m<e.length;m+=3){const x=e[m+2],L=(e[m+0]-a)*c|0,N=(e[m+1]-s)*p|0;x>r.heightmap[N*zp+L]&&(r.heightmap[N*zp+L]=x)}}function l1(r,e,a,s,c){a.reserve(a.length+4*r.length),s.reserve(s.length+10*r.length),c.reserve(c.length+10*r.length);let p=s.length;for(const m of r){const x=Math.min(10,Math.max(4,1.3*m.height))*e,L=[-m.normal[1],m.normal[0],0],N=Math.min(.29,.1*m.width/m.depth),R=m.width-2*m.depth*e*(N+.01),T=ba([],m.pos,L,R/2),V=ba([],m.pos,L,-R/2),F=[T[0],T[1],T[2]+m.height],O=[V[0],V[1],V[2]+m.height],Q=ba([],m.normal,L,N);Be(Q,Q,x);const $=ba([],m.normal,L,-N);Be($,$,x),Lt(Q,T,Q),Lt($,V,$),T[2]+=.1,V[2]+=.1,s.emplaceBack(Q[0],Q[1],Q[2]),s.emplaceBack($[0],$[1],$[2]),s.emplaceBack(T[0],T[1],T[2]),s.emplaceBack(V[0],V[1],V[2]),s.emplaceBack(F[0],F[1],F[2]),s.emplaceBack(O[0],O[1],O[2]),s.emplaceBack(T[0],T[1],T[2]),s.emplaceBack(V[0],V[1],V[2]),s.emplaceBack(Q[0],Q[1],Q[2]),s.emplaceBack($[0],$[1],$[2]);const K=R/x/2;c.emplaceBack(-K-N,-1,K,.8),c.emplaceBack(K+N,-1,K,.8),c.emplaceBack(-K,0,K,1.3),c.emplaceBack(K,0,K,1.3),c.emplaceBack(K+N,-.8,K,.7),c.emplaceBack(K+N,-.8,K,.7),c.emplaceBack(0,0,K,1.3),c.emplaceBack(0,0,K,1.3),c.emplaceBack(K+N,-1.2,K,.8),c.emplaceBack(K+N,-1.2,K,.8),a.emplaceBack(6+p,4+p,8+p),a.emplaceBack(7+p,9+p,5+p),a.emplaceBack(0+p,1+p,2+p),a.emplaceBack(1+p,3+p,2+p),p+=10}}function ZS(r,e){const a={};a.indexArray=new gn,a.vertexArray=new Cs,a.colorArray=new uc,l1(r,e,a.indexArray,a.vertexArray,a.colorArray);const s={defined:!0};s.emissiveFactor=Or.black;const c={};return c.baseColorFactor=Or.white,s.pbrMetallicRoughness=c,a.material=s,a.aabb=new Ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const c1=tr([{name:"a_pos_3f",components:3,type:"Float32"}]),NS=tr([{name:"a_normal_3",components:3,type:"Int16"}]),ES=tr([{name:"a_centroid_3",components:3,type:"Int16"}]),u1=tr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),SS=tr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),zS=tr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),AS=tr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),RS=tr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),TS=tr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),d1=jt.types,qg=32767;function VS(r,e){const a=Dt+e;for(const s of r)for(const c of s)if(c.x<-e||c.x>a||c.y<-e||c.y>a)return!1;return!0}class h1{constructor(){this.layoutVertexArray=new Cs,this.layoutAttenuationArray=new uc,this.layoutColorArray=new bo,this.indexArray=new gn,this.indexArrayForConflation=new gn,this.segmentsBucket=new Ar}}class K_{constructor(){this.layoutVertexArray=new Cs,this.layoutNormalArray=new Vu,this.layoutCentroidArray=new Vu,this.layoutColorArray=new bo,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new Td,this.layoutAOArray=new pl,this.indexArray=new gn,this.indexArrayForConflation=new gn,this.segmentsBucket=new Ar,this.entranceBloom=new h1}}class f1{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new K_,this.buildingWithFacade=new K_,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new bo,this.buildingWithFacade.layoutFacadeDataArray=new cc,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new bo,this.programConfigurations=new io(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=e.projection,this.groundEffect=new k_(e),this.groundEffect.groundRadiusArray=new pl,this.hasAppearances=null}updateFootprints(e,a){for(const s of this.footprints)a.push({footprint:s,id:e})}updateAppearances(e,a,s,c){}prepare(){return function(){if(Gg!=null||Wb!=null)return null;if(_m!=null)return _m;const e=fetch(sn.BUILDING_GEN_URL);return _m=function(a){let s,c,p,m;function x(){s=new Uint8Array(m.buffer),c=new Int32Array(m.buffer),p=new Float32Array(m.buffer)}function L(){throw new Error("Unexpected BuildingGen error.")}const N=()=>{},R={a:{a:L,f:function(T){const V=s.length,F=Math.max(T>>>0,Math.ceil(1.2*V)),O=Math.ceil((F-V)/65536);try{return m.grow(O),x(),!0}catch{return!1}},g:L,b:N,c:N,d:N,e:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,R):a.then(T=>T.arrayBuffer()).then(T=>WebAssembly.instantiate(T,R))).then(T=>{const V=T.instance.exports;return(0,V.g)(),m=V.f,x(),new iS({setStyle:V.h,setAOOptions:V.i,setMetricOptions:V.j,setStructuralOptions:V.k,setFacadeOptions:V.l,setFauxFacadeOptions:V.m,setFacadeClassifierOptions:V.n,addFeature:V.o,addFacade:V.p,generateMesh:V.q,getLastError:V.r,getOuterRingLength:V.s,getMeshCount:V.t,getPositionsPtr:V.u,getPositionsLength:V.v,getNormalsPtr:V.w,getNormalsLength:V.x,getColorsPtr:V.y,getColorsLength:V.z,getAOPtr:V.A,getAOLength:V.B,getUVPtr:V.C,getUVLength:V.D,getFauxFacadePtr:V.E,getFauxFacadeLength:V.F,getIndicesPtr:V.G,getIndicesLength:V.H,getBuildingPart:V.I,getRingCount:V.J,getRingPtr:V.K,getRingLength:V.L,free:V.M,malloc:V.N,heapU8:s,heap32:c,heapF32:p})})}(e).then(a=>(_m=null,Gg=a,Gg)).catch(a=>{Za("Could not load building-gen"),_m=null,Wb=a}),_m}()}populate(e,a,s,c){const p=sS();if(!p)return;const m=Se(s);this.tileToMeter=m,this.brightness=a.brightness,p.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,m],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:m,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeClassifierOptions(3);const x=new Map,L=new Map;for(const{feature:N}of e){if(d1[N.type]!=="LineString"){x.set(N.id,N.properties.source_id);continue}const R=this.layers[0]._featureFilter.needGeometry,T=et(N,R);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom),T,s))continue;const V=R?T.geometry:ct(N,s,c),F=[];for(const K of V)for(const ie of K)F.push({x:ie.x,y:ie.y});const O={coordinates:F,crossPerc:N.properties.cross_perc,distanceToRoad:N.properties.distance_to_road,entrances:N.properties.entrances,sourceId:0},Q=N.properties.source_id;let $=L.get(Q);$||($=[],L.set(Q,$)),$.push(O)}this.maxHeight=0;for(const{feature:N,id:R,index:T,sourceLayerIndex:V}of e){if(d1[N.type]==="LineString")continue;const F=this.layers[0]._featureFilter.needGeometry,O=et(N,F);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom),O,s))continue;const Q=F?O.geometry:ct(N,s,c),$=vy(Q,500);if(!VS(Q,163))continue;const K=this.layers[0],ie=K.layout.get("building-roof-shape").evaluate(N,{},s);if(ie==="flat")continue;const le=K.layout.get("building-base").evaluate(N,{},s),de=K.layout.get("building-height").evaluate(N,{},s),Ee=K.layout.get("building-flood-light-ground-radius").evaluate(N,{},s),Le=K.paint.get("building-ambient-occlusion-intensity"),Ae=Ee/this.tileToMeter;let Me=K.layout.get("building-flood-light-wall-radius").evaluate(N,{},s);Me=re(Me,0,2048);const Je=Me/2048*qg,ot=x.get(R);let We;We=L.has(ot)?L.get(ot):[];const ut=We.length!==0&&K.layout.get("building-facade").evaluate(N,{},s);p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(ut,!1,1);let _t=0,Zt=0,Pt=0,At=0,xt=0,zt=0;if(ut){let pt=Math.round(K.layout.get("building-facade-floors").evaluate(N,{},s));if(le===0){pt=Math.max(1,pt-(We.length>0?1:0));let pa=4;if(de>100){const fa=[10,13,15];pa=fa[N.id?N.id%fa.length:0],p.setFacadeOptions(pa,!0)}xt=1.6803*pa/m}else xt=le/m;zt=de/m,xt=Math.min(xt,zt),Pt=K.layout.get("building-facade-unit-width").evaluate(N,{},s)/m,At=(zt-xt)/pt,p.setFauxFacadeOptions(!0,!0,Pt);const $t=K.layout.get("building-facade-window").evaluate(N,{},s);_t=$t[0],Zt=$t[1]}const nt=[],rt=new St(1/0,1/0),Et=new St(-1/0,-1/0),Jt=new St(0,0);let vt=0;for(const pt of $)if(pt.length>0){const $t=[];for(const pa of pt){const fa=[];for(let Xa=pa.length-1;Xa>=0;Xa--){const Aa=pa[Xa];fa.push({x:Aa.x,y:Aa.y}),rt.x=Math.min(rt.x,Aa.x),rt.y=Math.min(rt.y,Aa.y),Et.x=Math.max(Et.x,Aa.x),Et.y=Math.max(Et.y,Aa.y),Jt.x+=Aa.x,Jt.y+=Aa.y,vt++}$t.push(fa)}nt.push({id:N.id?N.id:0,height:de,minHeight:le,sourceId:0,roofType:ie,coordinates:$t})}Jt.x/=vt||1,Jt.y/=vt||1;const sa=p.generateMesh(nt,We);if(typeof sa=="string"){Za(`Unable to generate building ${N.id}: ${sa}`);continue}if(sa.meshes.length===0||sa.modifiedPolygonRings.length===0)continue;let ua=0;for(const pt of sa.meshes)ua+=pt.positions.length/3;const ta=ut?this.buildingWithFacade:this.buildingWithoutFacade,Yt=ta.segmentsBucket.prepareSegment(ua,ta.layoutVertexArray,ta.indexArray),Fa=[];let ea=null,ja=0,Da=-1;const nr=ta.layoutVertexArray.length,Zr=ta.indexArray.length;let Pa=0;for(const pt of sa.meshes){const $t=ta.layoutVertexArray.length;if(pt.buildingPart==="entrance"){const da=new Array;for(let Lr=0;Lr<pt.positions.length;Lr+=12){const an=pt.positions[Lr+0],Ur=pt.positions[Lr+1],Un=pt.positions[Lr+3],Zn=pt.positions[Lr+4],hn=pt.positions[Lr+2],qr=pt.positions[Lr+8]-hn,kr=1,Qa=Un-an,Jr=Zn-Ur,fn=Math.hypot(Qa,Jr);da.push({pos:[an+.5*Qa,Ur+.5*Jr,hn],normal:[Jr/fn,-Qa/fn,0],width:fn,height:qr,depth:kr,points:[an,Ur,Un,Zn]})}const Vr=ta.entranceBloom.segmentsBucket.prepareSegment(10*da.length,ta.entranceBloom.layoutVertexArray,ta.entranceBloom.indexArray),tn=ta.entranceBloom.layoutVertexArray.length;ja=ta.entranceBloom.indexArray.length,l1(da,.5/this.tileToMeter,ta.entranceBloom.indexArray,ta.entranceBloom.layoutVertexArray,ta.entranceBloom.layoutAttenuationArray);const Ma=ta.entranceBloom.layoutVertexArray.length-tn;Da=ta.entranceBloom.indexArray.length-ja;for(let Lr=0;Lr<Ma;Lr++)ta.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Vr.vertexLength+=Ma,Vr.primitiveLength+=Da,ea={part:pt.buildingPart,vertexOffset:tn,vertexLength:Ma}}for(let da=0;da<pt.positions.length;da+=3)Pa=Math.max(Pa,pt.positions[da+2]),ta.layoutVertexArray.emplaceBack(pt.positions[da],pt.positions[da+1],pt.positions[da+2]);const pa=Math.floor(Jt.x),fa=Math.floor(Jt.y),Xa=Math.floor(Pa);for(let da=0;da<pt.positions.length;da+=3)ta.layoutCentroidArray.emplaceBack(pa,fa,Xa),ta.layoutFloodLightDataArray.emplaceBack(pt.buildingPart==="wall"?Je:0);for(let da=0;da<pt.normals.length;da+=3)ta.layoutNormalArray.emplaceBack(pt.normals[da+0]*qg,pt.normals[da+1]*qg,pt.normals[da+2]*qg);for(let da=0;da<pt.ao.length;da++)ta.layoutAOArray.emplaceBack(pt.ao[da]);for(let da=0;da<pt.colors.length;da+=3){const Vr=1+(pt.ao[da/3]-1)*Le;ta.layoutColorArray.emplaceBack(pt.colors[da]*Vr<<8|pt.colors[da+1]*Vr,pt.colors[da+2]*Vr<<8)}if(ut){for(let da=0;da<pt.positions.length;da+=3)ta.layoutFacadePaintArray.emplaceBack(65535,255);for(let da=0;da<pt.isFauxFacade.length;da++)if(pt.isFauxFacade[da]){const Vr=1|Math.min(65535,Math.floor(pt.uv[2*da]*sa.outerRingLength)),tn=Math.floor(255*_t)<<8|Math.floor(255*Zt),Ma=Math.floor(65535*Math.min(1,Pt/Dt)),Lr=Math.floor(65535*Math.min(1,At/Dt));ta.layoutFacadeDataArray.emplaceBack(Vr,tn,Ma,Lr);const an=Math.floor(65535*Math.min(1,xt/Dt)),Ur=Math.floor(65535*Math.min(1,zt/Dt));ta.layoutFacadeVerticalRangeArray.emplaceBack(an,Ur)}else ta.layoutFacadeDataArray.emplaceBack(0,0,0,0),ta.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Aa=Yt.vertexLength;for(let da=0;da<pt.indices.length;da+=3)ta.indexArray.emplaceBack(Aa+pt.indices[da],Aa+pt.indices[da+1],Aa+pt.indices[da+2]);Yt.vertexLength+=pt.positions.length/3,Yt.primitiveLength+=pt.indices.length/3,(pt.buildingPart==="roof"||pt.buildingPart==="wall"||pt.buildingPart==="facade_glazing"||pt.buildingPart==="entrance")&&Fa.push({part:pt.buildingPart,vertexOffset:$t,vertexLength:pt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Pa),this.buildingFeatures.push({promoteId:R,feature:O,hasFauxFacade:ut,segment:Yt,parts:Fa,buildingBloom:ea});const Br=ta.indexArray.length-Zr,Ir=[],In=[],je=new St(1/0,1/0),_e=new St(-1/0,-1/0),ft=this.groundEffect.vertexArray.length;for(const pt of sa.modifiedPolygonRings){const $t=[],pa=new St(1/0,1/0),fa=new St(-1/0,-1/0);for(let Xa=0;Xa<pt.length;Xa+=2){const Aa=pt.length-Xa-2;pa.x=Math.min(pa.x,pt[Aa]),pa.y=Math.min(pa.y,pt[Aa+1]),fa.x=Math.max(fa.x,pt[Aa]),fa.y=Math.max(fa.y,pt[Aa+1]);const da=new St(pt[Aa],pt[Aa+1]);$t.push(da),Ir.push(da.x,da.y),In.push(da.clone())}je.x=Math.min(je.x,pa.x),je.y=Math.min(je.y,pa.y),_e.x=Math.max(_e.x,fa.x),_e.y=Math.max(_e.y,fa.y),this.groundEffect.addData($t,[pa,fa],Ae)}const Xt=this.groundEffect.vertexArray.length-ft;for(let pt=0;pt<Xt;pt++)this.groundEffect.groundRadiusArray.emplaceBack(Ee);(rt.x<0||Et.x>Dt||rt.y<0||Et.y>Dt)&&this.featuresOnBorder.push({featureId:N.id,footprintIndex:this.footprints.length});{const pt=fm(Ir,null,2),$t=new kg(In,pt,8,256);let pa=N.id;N.properties&&N.properties.hasOwnProperty("building_id")&&(pa=N.properties.building_id);const fa={vertices:In,indices:pt,grid:$t,min:je,max:_e,buildingId:pa,hiddenFlags:0,indicesOffset:Zr,indicesLength:Br,bloomIndicesOffset:ja,bloomIndicesLength:Da,groundEffectVertexOffset:ft,groundEffectVertexLength:Xt,hasFauxFacade:ut,segment:Yt,height:Pa};N.id!==void 0&&this.featureFootprintLookup.set(N.id,this.footprints.length),this.footprints.push(fa)}this.programConfigurations.populatePaintArrays(ta.layoutVertexArray.length,N,T,{},a.availableImages,s,a.brightness),this.groundEffect.addPaintPropertiesData(N,T,{},a.availableImages,s,a.brightness),a.featureIndex.insert(N,Q,T,V,this.index,nr)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,a,s,c,p,m,x){this.programConfigurations.updatePaintArrays(e,a,p,s,c,m,x),this.groundEffect.update(e,a,p,s,c,m,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const a=s=>{s.layoutVertexBuffer=e.createVertexBuffer(s.layoutVertexArray,c1.members),s.layoutNormalBuffer=e.createVertexBuffer(s.layoutNormalArray,NS.members),s.layoutCentroidBuffer=e.createVertexBuffer(s.layoutCentroidArray,ES.members),s.layoutFloodLightDataBuffer=e.createVertexBuffer(s.layoutFloodLightDataArray,TS.members),s.layoutFacadeDataArray&&s.layoutFacadeDataArray.length&&(s.layoutFacadeDataBuffer=e.createVertexBuffer(s.layoutFacadeDataArray,zS.members)),s.layoutFacadeVerticalRangeArray&&s.layoutFacadeVerticalRangeArray.length&&(s.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(s.layoutFacadeVerticalRangeArray,AS.members)),s.entranceBloom.layoutVertexArray.length&&(s.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(s.entranceBloom.layoutVertexArray,c1.members),s.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(s.entranceBloom.layoutAttenuationArray,RS.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,a,s=!0){let c=!1;const p=s?a:0,m=0|(s?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const L=this.footprints[x],N=L.hiddenFlags&m|p;L.hiddenFlags!==N&&(L.hiddenFlags=N,c=!0,this.groundEffect.updateHiddenByLandmarkRange(L.groundEffectVertexOffset,L.groundEffectVertexLength,L.hiddenFlags!==0))}return c&&(this.indexArrayForConflationUploaded=!1),c}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const a=c=>{c.indexArray.length!==0&&(c.indexArrayForConflation.resize(c.indexArray.length),c.indexArrayForConflation.uint16.set(c.indexArray.uint16),c.entranceBloom.indexArrayForConflation.resize(c.entranceBloom.indexArray.length),c.entranceBloom.indexArrayForConflation.uint16.set(c.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const c of this.footprints){const p=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,m=c.indicesOffset+c.indicesLength;if(c.hiddenFlags!==0){for(let L=c.indicesOffset;L<m;L++)p.indexArrayForConflation.uint16[3*L+0]=0,p.indexArrayForConflation.uint16[3*L+1]=0,p.indexArrayForConflation.uint16[3*L+2]=0;const x=c.bloomIndicesOffset+c.bloomIndicesLength;for(let L=c.bloomIndicesOffset;L<x;L++)p.entranceBloom.indexArrayForConflation.uint16[3*L+0]=0,p.entranceBloom.indexArrayForConflation.uint16[3*L+1]=0,p.entranceBloom.indexArrayForConflation.uint16[3*L+2]=0}}const s=c=>{c.indexArray.length!==0&&(c.indexBuffer?c.indexBuffer.updateData(c.indexArrayForConflation):c.indexBuffer=e.createIndexBuffer(c.indexArrayForConflation,!0),c.entranceBloom.indexBuffer?c.entranceBloom.indexBuffer.updateData(c.entranceBloom.indexArrayForConflation):c.entranceBloom.indexBuffer=e.createIndexBuffer(c.entranceBloom.indexArrayForConflation,!0))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const a=s=>{s.layoutColorBuffer?s.layoutColorBuffer.updateData(s.layoutColorArray):s.layoutColorBuffer=e.createVertexBuffer(s.layoutColorArray,u1.members,!0),s.layoutFacadePaintArray&&(s.layoutFacadePaintBuffer?s.layoutFacadePaintBuffer.updateData(s.layoutFacadePaintArray):s.layoutFacadePaintBuffer=e.createVertexBuffer(s.layoutFacadePaintArray,SS.members,!0)),s.entranceBloom.layoutColorBuffer?s.entranceBloom.layoutColorBuffer.updateData(s.entranceBloom.layoutColorArray):s.entranceBloom.layoutColorBuffer=e.createVertexBuffer(s.entranceBloom.layoutColorArray,u1.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,a){const s=e.paint.get("building-ambient-occlusion-intensity");for(const c of this.buildingFeatures){const p=a[c.promoteId],m=c.feature;m.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),L=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="wall";const N=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),R=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="window";const T=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),V=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="door";const F=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),O=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical),Q=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const K of c.parts){let ie,le=x;K.part==="roof"?(le=x,ie=L):K.part==="wall"?(le=N,ie=R):K.part==="facade_glazing"?(le=T,ie=V):K.part==="entrance"&&(le=F,ie=O),ie=re(ie,0,1);for(let de=0;de<K.vertexLength;de++){const Ee=K.vertexOffset+de,Le=1+(Q.layoutAOArray.float32[Ee]-1)*s;Q.layoutColorArray.emplace(Ee,le.r*Le*255<<8|le.g*Le*255,le.b*Le*255<<8|255*ie),c.hasFauxFacade&&Q.layoutFacadePaintArray.emplace(Ee,255*T.r<<8|255*T.g,255*T.b<<8|255*V)}}const $=c.buildingBloom;if($)for(let K=0;K<$.vertexLength;K++)Q.entranceBloom.layoutColorArray.emplace($.vertexOffset+K,255*F.r<<8|255*F.g,255*F.b<<8|51*O)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,a,s){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const c=a.getReplacementRegionsForTile(e.toUnwrapped());if(Fg(this.activeReplacements,c))return;this.activeReplacements=c;for(const m of this.footprints)m.hiddenFlags&=-2;const p=[];for(const m of this.activeReplacements){if(m.order<=pb)continue;const x=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const L of this.footprints)L.min.x>m.max.x||L.max.x<m.min.x||L.min.y>m.max.y||L.max.y<m.min.y||(p.length=0,MS(L.vertices,0,L.vertices.length,m.footprintTileId.canonical,e.canonical,p),V_(m.footprint,p,L.indices,0,L.indices.length,0,-x)&&(L.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(m.groundEffectVertexOffset,m.groundEffectVertexLength,m.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const a=this.featureFootprintLookup.get(e.id);return this.footprints[a]}return null}getHeightAtTileCoord(e,a){let s=Number.NEGATIVE_INFINITY,c=!0;const p=4*(e+Dt)*Dt+(a+Dt);if(this.footprintLookup.hasOwnProperty(p)){const x=this.footprintLookup[p];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const m=new St(e,a);for(const x of this.footprints)e>x.max.x||x.min.x>e||a>x.max.y||x.min.y>a||x.height<=s||M_(m,x)&&(s=x.height,this.footprintLookup[p]=x,c=x.hiddenFlags!==0);if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:c};this.footprintLookup[p]=void 0}}function MS(r,e,a,s,c,p){const m=Math.pow(2,s.z-c.z);for(let x=0;x<a;x++){let L=r[x+e].x,N=r[x+e].y;L=(L+c.x*Dt)*m-s.x*Dt,N=(N+c.y*Dt)*m-s.y*Dt,p.push(new St(L,N))}}let p1,m1;na(f1,"BuildingBucket",{omit:["layers"]}),na(K_,"BuildingGeometry"),na(h1,"BuildingBloomGeometry");const BS=tr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),IS=tr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:kS}=BS,JS=tr([{name:"a_packed",components:3,type:"Float32"}]),{members:FS}=JS,OS=tr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:DS}=OS;class y1{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.image=new Jf({width:e,height:a}),this.positions={},this.uploaded=!1}getDash(e,a){const s=this.getKey(e,a);return this.positions[s]}trim(){const e=this.width,a=this.height=Ce(this.nextRow);this.image.resize({width:e,height:a})}getKey(e,a){return e.join(",")+a}getDashRanges(e,a,s){const c=[];let p=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,x=!0;c.push({left:p,right:m,isDash:x,zeroLength:e[0]===0});let L=e[0];for(let N=1;N<e.length;N++){x=!x;const R=e[N];p=L*s,L+=R,m=L*s,c.push({left:p,right:m,isDash:x,zeroLength:R===0})}return c}addRoundDash(e,a,s){const c=a/2;for(let p=-s;p<=s;p++){const m=this.width*(this.nextRow+s+p);let x=0,L=e[x];for(let N=0;N<this.width;N++){N/L.right>1&&(L=e[++x]);const R=Math.abs(N-L.left),T=Math.abs(N-L.right),V=Math.min(R,T);let F;const O=p/s*(c+1);if(L.isDash){const Q=c-Math.abs(O);F=Math.sqrt(V*V+Q*Q)}else F=c-Math.sqrt(V*V+O*O);this.image.data[m+N]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,a){for(let L=e.length-1;L>=0;--L){const N=e[L],R=e[L+1];N.zeroLength?e.splice(L,1):R&&R.isDash===N.isDash&&(R.left=N.left,e.splice(L,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const p=this.width*this.nextRow;let m=0,x=e[m];for(let L=0;L<this.width;L++){L/x.right>1&&(x=e[++m]);const N=Math.abs(L-x.left),R=Math.abs(L-x.right),T=Math.min(N,R);this.image.data[p+L]=Math.max(0,Math.min(255,(x.isDash?T:-T)+a+128))}}addDash(e,a){const s=this.getKey(e,a);if(this.positions[s])return this.positions[s];const c=a==="round",p=c?7:0,m=2*p+1;if(this.nextRow+m>this.height)return Za("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let R=0;R<e.length;R++)e[R]<0&&(Za("Negative value is found in line dasharray, replacing values with 0"),e[R]=0),x+=e[R];if(x!==0){const R=this.width/x,T=this.getDashRanges(e,this.width,R);c?this.addRoundDash(T,R,p):this.addRegularDash(T,a==="square"?.5*R:0)}const L=this.nextRow+p;this.nextRow+=m;const N={tl:[L,p],br:[x,0]};return this.positions[s]=N,N}}na(y1,"LineAtlas");const CS=jt.types,PS=Math.cos(Math.PI/180*37.5),GS=Math.cos(Math.PI/180*5);class ex{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new kh,this.layoutVertexArray2=new Cs,this.patternVertexArray=new Cs,this.indexArray=new gn,this.programConfigurations=new io(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ar,this.maxLineLength=0,this.zOffsetVertexArray=new Cs,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Dt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,a){}updateAppearances(e,a,s,c){}populate(e,a,s,c){this.hasPattern=E_("line",this.layers,this.pixelRatio,a);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Se(s);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const V=this.layers[0].layout.get("line-z-offset"),F=V.isConstant()&&!V.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&F?"none":"offset",this.elevationType==="offset"&&m==="none"&&Za(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const L=[];for(const{feature:V,id:F,index:O,sourceLayerIndex:Q}of e){const $=this.layers[0]._featureFilter.needGeometry,K=et(V,$);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),K,s))continue;const ie=p?p.evaluate(K,{},s):void 0,le={id:F,properties:V.properties,type:V.type,sourceLayerIndex:Q,index:O,geometry:$?K.geometry:ct(V,s,c),patterns:{},sortKey:ie};L.push(le)}p&&L.sort((V,F)=>V.sortKey-F.sortKey);const{lineAtlas:N,featureIndex:R}=a,T=this.addConstantDashes(N);for(const V of L){const{geometry:F,index:O,sourceLayerIndex:Q}=V;if(T&&this.addFeatureDashes(V,N),this.hasPattern){const $=S_("line",this.layers,V,this.zoom,this.pixelRatio,a);this.patternFeatures.push($)}else this.addFeature(V,F,O,s,N.positions,a.availableImages,a.brightness,a.elevationFeatures);R.insert(e[O].feature,F,O,Q,this.index)}}addConstantDashes(e){let a=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if(c.kind!=="constant"||p.kind!=="constant")a=!0;else{const m=p.value,x=c.value;if(!x)continue;e.addDash(x,m)}}return a}addFeatureDashes(e,a){const s=this.zoom;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let x,L;if(p.kind==="constant"){if(x=p.value,!x)continue}else x=p.evaluate({zoom:s},e);L=m.kind==="constant"?m.value:m.evaluate({zoom:s},e),a.addDash(x,L),e.patterns[c.id]=[a.getKey(x,L)]}}update(e,a,s,c,p,m,x,L){this.programConfigurations.updatePaintArrays(e,a,p,s,c,m,x,L)}addFeatures(e,a,s,c,p,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,s,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,FS)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,DS)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,IS.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kS),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,a){let s,c;if(a&&a>0?(s=`mapbox_clip_start_${a}`,c=`mapbox_clip_end_${a}`):(s="mapbox_clip_start",c="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(s)&&e.properties.hasOwnProperty(c))return{start:+e.properties[s],end:+e.properties[c]}}addFeature(e,a,s,c,p,m,x,L){const N=this.layers[0].layout,R=N.get("line-join").evaluate(e,{}),T=N.get("line-cap").evaluate(e,{}),V=N.get("line-miter-limit"),F=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const O=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=N.get("line-z-offset").value;const Q=this.layers[0].paint.get("line-width").value;if(Q.kind!=="constant"&&Q.isLineProgressConstant===!1&&(this.variableWidthValue=Q),this.elevationType==="road"){const $=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,a,c,L,R,T,V,F)){const[K,ie]=this.clipRuntimeLinesToTile(a,1);for(let le=0;le<K.length;le++){const de=K[le],Ee=ie[le],Le={progress:{min:Ee.progress.min,max:Ee.progress.max},nextDir:this.computeSegNextDir(Ee,de),prevDir:this.computeSegPrevDir(Ee,de)};this.addLine(de,e,c,R,T,V,F,Le,O&&Ee.parentIndex>0?Ee.parentIndex:null)}this.fillNonElevatedRoadSegment($)}}else for(let $=0;$<a.length;$++)this.addLine(a[$],e,c,R,T,V,F,void 0,O&&$>0?$:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,m,c,x,void 0,this.worldview)}computeSegNextDir(e,a){return e.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(e,a){return a[1].sub(e.prevPoint).unit()}clipLinesToTile(e,a){return Cg(e,-a,-a,Dt+a,Dt+a)}clipRuntimeLinesToTile(e,a){const s=[];return[Cg(e,-a,-a,Dt+a,Dt+a,s),s]}addElevatedRoadFeature(e,a,s,c,p,m,x,L){const N=[],R=Va.getElevationFeature(e,c);if(R){const T=this.clipLinesToTile(a,1),V=this.prepareElevatedLines(T,R,s);for(const F of V)N.push({geometry:F,elevation:R,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(N.length===0)return!1;for(const T of N){const V=this.layoutVertexArray.length;this.addLine(T.geometry,e,s,p,m,x,L);const F=new yr(s,T.elevationTileID);if(T.elevation)for(let O=V;O<this.layoutVertexArray.length;O++){const Q=new St(this.layoutVertexArray.int16[6*O]>>1,this.layoutVertexArray.int16[6*O+1]>>1),$=F.pointElevation(Q,T.elevation,.05);this.updateHeightRange($),this.zOffsetVertexArray.emplaceBack($,0,0)}else this.fillNonElevatedRoadSegment(V)}return!0}prepareElevatedLines(e,a,s){if(a.constantHeight!=null)return e;const c=[],p=1/Se(s);for(const m of e)aS(m,new en(a,p),0,c);return c}fillNonElevatedRoadSegment(e){for(let a=e;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,a,s,c,p,m,x,L,N){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=N?this.lineFeatureClips(a,N):this.lineClips;const R=c==="none";this.patternJoinNone=this.hasPattern&&R,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const T=L&&L.progress.min>0,V=L&&L.progress.max<1;if(this.lineClips){let Je={min:this.lineClips.start,max:this.lineClips.end},ot=1;if(L){const _t=this.lineClips.end-this.lineClips.start;Je=function(Zt,Pt,At){return{min:Yr(Zt.min,Pt,At),max:Yr(Zt.max,Pt,At)}}(L.progress,{min:0,max:1},Je),_t>0&&(ot=(Je.max-Je.min)/_t)}const We=+a.properties.mapbox_clip_feature_len,ut=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(We)||Number.isNaN(ut)){for(let Zt=0;Zt<e.length-1;Zt++)this.totalDistance+=e[Zt].dist(e[Zt+1]);const _t=this.totalDistance/(Je.max-Je.min);this.totalFeatureLength=Number.isFinite(_t)?_t:0,this.lineClips.start=Je.min,this.lineClips.end=Je.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=We,this.distance=ut*ot,this.lineClips.start=Je.min,this.lineClips.end=Je.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const F=CS[a.type]==="Polygon";let O=e.length;for(;O>=2&&e[O-1].equals(e[O-2]);)O--;let Q=0;for(;Q<O-1&&e[Q].equals(e[Q+1]);)Q++;if(O<(F?3:2))return;c==="bevel"&&(m=1.05);const $=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let K,ie,le,de,Ee,Le,Ae,Me;L&&L.prevDir&&(Le=L.prevDir.perp()),L&&L.nextDir&&(Ae=L.nextDir.perp()),this.e1=this.e2=-1,F&&(K=e[O-2],Ee=e[Q].sub(K)._unit()._perp());for(let Je=Q;Je<O;Je++){if(le=Je===O-1?F?e[Q+1]:void 0:e[Je+1],le&&e[Je].equals(le))continue;Ee&&(de=Ee),K&&(ie=K),K=e[Je],Me=this.evaluateLineProgressFeatures(ie?ie.dist(K):0),Ee=le?le.sub(K)._unit()._perp():de,de=de||Ee;const ot=ie&&le;let We=ot?c:F||R?"butt":p;const ut=de.x*Ee.x+de.y*Ee.y;if(R){const rt=function(Et){if(Et.patternJoinNone){const Jt=Et.segmentPoints.length/2,vt=Et.lineSoFar-Et.segmentStart;for(let sa=0;sa<Jt;++sa){const ua=Et.segmentPoints[2*sa+1],ta=Math.round(Et.segmentPoints[2*sa])+.5+.25*ua;Et.patternVertexArray.emplaceBack(ta,vt,Et.segmentStart),Et.patternVertexArray.emplaceBack(ta,vt,Et.segmentStart)}Et.segmentPoints.length=0}Et.e1=Et.e2=-1};if(ot&&ut<GS){this.updateDistance(ie,K),this.addCurrentVertex(K,de,1,1,$,Me),rt(this),this.addCurrentVertex(K,Ee,-1,-1,$,Me);continue}if(ie){if(!le){this.updateDistance(ie,K),this.addCurrentVertex(K,de,1,1,$,Me),rt(this);continue}We="miter"}}let _t=de.add(Ee);_t.x===0&&_t.y===0||_t._unit();const Zt=_t.x*Ee.x+_t.y*Ee.y,Pt=Zt!==0?1/Zt:1/0,At=2*Math.sqrt(2-2*Zt),xt=Zt<PS&&ie&&le,zt=de.x*Ee.y-de.y*Ee.x>0,nt=this.overscaling<=16?15*Dt/(512*this.overscaling):0;if(ot&&We==="round"){if(Pt<x)We="miter";else if(Pt<=2){const rt=tx(K,-10,Dt+10);We=this.elevationType==="offset"&&(rt||this.hasCrossSlope)?"miter":"fakeround"}}if(We==="miter"&&Pt>m&&(We="bevel"),We==="bevel"&&(Pt>2&&(We="flipbevel"),Pt<m&&(We="miter")),ie&&!(We==="miter"&&xt)&&this.updateDistance(ie,K),We==="miter")if(xt){const rt=K.dist(ie);if(rt>2*nt){const Jt=K.sub(K.sub(ie)._mult(nt/rt)._round());this.updateDistance(ie,Jt),this.addCurrentVertex(Jt,de,0,0,$,Me),ie=Jt}this.updateDistance(ie,K),_t._mult(Pt),this.addCurrentVertex(K,_t,0,0,$,Me);const Et=K.dist(le);if(Et>2*nt){const Jt=K.add(le.sub(K)._mult(nt/Et)._round());this.updateDistance(K,Jt),this.addCurrentVertex(Jt,Ee,0,0,$,Me),K=Jt}}else _t._mult(Pt),this.addCurrentVertex(K,_t,0,0,$,Me);else if(We==="flipbevel"){if(Pt>100)_t=Ee.mult(-1);else{const rt=Pt*de.add(Ee).mag()/de.sub(Ee).mag();_t._perp()._mult(rt*(zt?-1:1))}this.addCurrentVertex(K,_t,0,0,$,Me),this.addCurrentVertex(K,_t.mult(-1),0,0,$,Me)}else if(We==="bevel"||We==="fakeround"){Me!=null&&ie&&this.addCurrentVertex(K,Ae||de,-1,-1,$,Me);const rt=K.dist(ie)<=2*nt&&We!=="bevel",Et=_t.mult(zt?1:-1);Et._mult(Pt);const Jt=Ee.mult(zt?-1:1),vt=de.mult(zt?-1:1),sa=this.evaluateLineProgressFeatures(this.distance);if(Me==null&&(this.addHalfVertex(K,Et.x,Et.y,!1,!zt,0,$,sa),rt||this.addHalfVertex(K,Et.x+2*vt.x,Et.y+2*vt.y,!1,zt,0,$,sa)),We==="fakeround"){const ua=Math.round(180*At/Math.PI/20);this.addHalfVertex(K,vt.x,vt.y,!1,zt,0,$,sa);for(let ta=0;ta<ua;ta++){let Yt=ta/ua;if(Yt!==.5){const ea=Yt-.5;Yt+=Yt*ea*(Yt-1)*((1.0904+ut*(ut*(3.55645-1.43519*ut)-3.2452))*ea*ea+(.848013+ut*(.215638*ut-1.06021)))}const Fa=Jt.sub(vt)._mult(Yt)._add(vt)._unit();this.addHalfVertex(K,Fa.x,Fa.y,!1,zt,0,$,sa)}this.addHalfVertex(K,Jt.x,Jt.y,!1,zt,0,$,sa)}rt||Me!=null||this.addHalfVertex(K,Et.x+2*Jt.x,Et.y+2*Jt.y,!1,zt,0,$,sa),Me!=null&&le&&this.addCurrentVertex(K,Le||Ee,1,1,$,Me)}else if(We==="butt")this.addCurrentVertex(K,_t,0,0,$,Me);else if(We==="square"){if(!ie){const rt=T?0:-1;this.addCurrentVertex(K,_t,rt,rt,$,Me)}if(this.addCurrentVertex(K,_t,0,0,$,Me),ie){const rt=V?0:1;this.addCurrentVertex(K,_t,rt,rt,$,Me)}}else if(We==="round"){if(ie){const rt=!ot&&Ae?Ae:de;this.addCurrentVertex(K,rt,0,0,$,Me),!ot&&V||this.addCurrentVertex(K,rt,1,1,$,Me,!0)}if(le){const rt=!ot&&Le?Le:Ee;!ot&&T||this.addCurrentVertex(K,rt,-1,-1,$,Me,!0),this.addCurrentVertex(K,rt,0,0,$,Me)}}}}addVerticesTo(e,a,s,c,p,m,x,L,N,R){const T=(a.w-e.w)/this.tessellationStep|0;let V=0;const F=this.scaledDistance;if(T>1){this.lineSoFar=e.w;const Q=(a.x-e.x)/T,$=(a.y-e.y)/T,K=(a.z-e.z)/T,ie=(a.w-e.w)/T;for(let le=1;le<T;++le){e.x+=Q,e.y+=$,e.z+=K,this.lineSoFar+=ie,V+=ie;const de=this.evaluateLineProgressFeatures(this.prevDistance+V);this.scaledDistance=(this.prevDistance+V)/this.totalDistance,this.addHalfVertex(e,s,c,R,!1,x,N,de),this.addHalfVertex(e,p,m,R,!0,-L,N,de)}}this.lineSoFar=a.w,this.scaledDistance=F;const O=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,s,c,R,!1,x,N,O),this.addHalfVertex(a,p,m,R,!0,-L,N,O)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Za(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(e,a,s,c,p,m,x=!1){const L=a.x+a.y*s,N=a.y-a.x*s,R=a.y*c-a.x,T=-a.y-a.x*c;if(m!=null){const V=this.elevationType==="offset",F=-10,O=Dt+10,Q=m.zOffset,$=new kb(e.x,e.y,Q,this.lineSoFar),K=!!V&&tx(e,F,O),ie=this.lineSoFar,le=this.distance;if(this.currentVertex)if(K){const de=this.currentVertexIsOutside,Ee=this.currentVertex,Le=new kb(e.x,e.y,Q,this.lineSoFar);if(Fb(Ee,Le,F,O),!tx(Le,F,O)){if(de){this.e1=this.e2=-1,this.distance-=Ee.dist($),this.lineSoFar=Ee.w;const Ae=this.evaluateLineProgressFeatures(Ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ee,L,N,x,!1,s,p,Ae),this.addHalfVertex(Ee,R,T,x,!0,-c,p,Ae),this.prevDistance=this.distance}this.distance=this.prevDistance+Ee.dist(Le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ee,Le,L,N,R,T,s,c,p,x),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const de=this.currentVertex;if(this.currentVertexIsOutside){Fb(de,$,F,O),this.e1=this.e2=-1,this.distance-=de.dist($),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=de.w;const Ee=this.evaluateLineProgressFeatures(de.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(de,L,N,x,!1,s,p,Ee),this.addHalfVertex(de,R,T,x,!0,-c,p,Ee),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(de,$,L,N,R,T,s,c,p,x)}else K||(this.addHalfVertex(e,L,N,x,!1,s,p,m),this.addHalfVertex(e,R,T,x,!0,-c,p,m));this.currentVertex=$,this.currentVertexIsOutside=K,this.lineSoFar=ie}else this.addHalfVertex(e,L,N,x,!1,s,p,m),this.addHalfVertex(e,R,T,x,!0,-c,p,m)}addHalfVertex({x:e,y:a},s,c,p,m,x,L,N){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(a<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const T=Sa(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,T)}const R=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),L.primitiveLength++),m?this.e2=R:this.e1=R,N!=null&&this.zOffsetVertexArray.emplaceBack(N.zOffset,N.variableWidth,N.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,a){this.prevDistance=this.distance,this.distance+=e.dist(a),this.updateScaledDistance()}}function tx(r,e,a){return r.x<e||r.x>a||r.y<e||r.y>a}let g1,_1;function x1(r,e,a){return e*(Dt/(r.tileSize*Math.pow(2,a-r.tileID.overscaledZ)))}na(ex,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const w1=(r,e,a)=>(1-a)*r+a*e;function v1(r,e){return 1/x1(r,1,e.tileZoom)}function b1(r,e,a,s){return r.translatePosMatrix(s||e.tileID.projMatrix,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const L1=r=>{const e=[];j1(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const a=r.paint.get("line-trim-offset");a[0]===0&&a[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=r.layout.get("line-join").constantOr("miter")==="none",c=!!r.paint.get("line-pattern").constantOr(1);return s&&c&&e.push("LINE_JOIN_NONE"),e};function j1(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let ax;const Z1=()=>ax||(ax={layout:g1||(g1=new Mn({"line-cap":new Kt(Ue.layout_line["line-cap"]),"line-join":new Kt(Ue.layout_line["line-join"]),"line-miter-limit":new Tt(Ue.layout_line["line-miter-limit"]),"line-round-limit":new Tt(Ue.layout_line["line-round-limit"]),"line-sort-key":new Kt(Ue.layout_line["line-sort-key"]),"line-z-offset":new Kt(Ue.layout_line["line-z-offset"]),"line-elevation-reference":new Tt(Ue.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt(Ue.layout_line["line-cross-slope"]),visibility:new Tt(Ue.layout_line.visibility),"line-width-unit":new Tt(Ue.layout_line["line-width-unit"])})),paint:_1||(_1=new Mn({"line-opacity":new Kt(Ue.paint_line["line-opacity"]),"line-color":new Kt(Ue.paint_line["line-color"]),"line-translate":new Tt(Ue.paint_line["line-translate"]),"line-translate-anchor":new Tt(Ue.paint_line["line-translate-anchor"]),"line-width":new Kt(Ue.paint_line["line-width"]),"line-gap-width":new Kt(Ue.paint_line["line-gap-width"]),"line-offset":new Kt(Ue.paint_line["line-offset"]),"line-blur":new Kt(Ue.paint_line["line-blur"]),"line-dasharray":new Kt(Ue.paint_line["line-dasharray"]),"line-pattern":new Kt(Ue.paint_line["line-pattern"]),"line-pattern-cross-fade":new Tt(Ue.paint_line["line-pattern-cross-fade"]),"line-gradient":new Su(Ue.paint_line["line-gradient"]),"line-trim-offset":new Tt(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new Tt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new Kt(Ue.paint_line["line-border-width"]),"line-border-color":new Kt(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt(Ue.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},ax);class US extends Kt{possiblyEvaluate(e,a){return a=new $r(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(e,a)}evaluate(e,a,s,c){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(e,a,s,c)}}let Vy;function N1(r,e){return e>0?e+2*r:r}const WS=tr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),XS=tr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QS=tr([{name:"a_projected_pos",components:4,type:"Float32"}],4);tr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const HS=tr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),YS=tr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),$S=tr([{name:"a_texb",components:2,type:"Uint16"}]),qS=tr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),KS=tr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);tr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const E1=tr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ez=tr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);tr([{name:"triangle",components:3,type:"Uint16"}]),tr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),tr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),tr([{type:"Float32",name:"offsetX"}]),tr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var os=24;function tz(r,e,a){return r.sections.forEach(s=>{s.text=function(c,p,m){const x=p.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),ns.applyArabicShaping&&(c=ns.applyArabicShaping(c)),c}(s.text,e,a)}),r}const My={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function az(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function rz(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const rx=4294967296,S1=1/rx,z1=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Kg=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,a=this.length){for(;this.pos<a;){const s=this.readVarint(),c=s>>3,p=this.pos;this.type=7&s,r(c,e,this),this.pos===p&&this.skip(s)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*rx;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*rx;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let a,s;return s=e[this.pos++],a=127&s,s<128?a:(s=e[this.pos++],a|=(127&s)<<7,s<128?a:(s=e[this.pos++],a|=(127&s)<<14,s<128?a:(s=e[this.pos++],a|=(127&s)<<21,s<128?a:(s=e[this.pos],a|=(15&s)<<28,function(c,p,m){const x=m.buf;let L,N;if(N=x[m.pos++],L=(112&N)>>4,N<128||(N=x[m.pos++],L|=(127&N)<<3,N<128)||(N=x[m.pos++],L|=(127&N)<<10,N<128)||(N=x[m.pos++],L|=(127&N)<<17,N<128)||(N=x[m.pos++],L|=(127&N)<<24,N<128)||(N=x[m.pos++],L|=(1&N)<<31,N<128))return wm(c,L,p);throw new Error("Expected varint not more than 10 bytes")}(a,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&z1?z1.decode(this.buf.subarray(e,r)):function(a,s,c){let p="",m=s;for(;m<c;){const x=a[m];let L,N,R,T=null,V=x>239?4:x>223?3:x>191?2:1;if(m+V>c)break;V===1?x<128&&(T=x):V===2?(L=a[m+1],(192&L)==128&&(T=(31&x)<<6|63&L,T<=127&&(T=null))):V===3?(L=a[m+1],N=a[m+2],(192&L)==128&&(192&N)==128&&(T=(15&x)<<12|(63&L)<<6|63&N,(T<=2047||T>=55296&&T<=57343)&&(T=null))):V===4&&(L=a[m+1],N=a[m+2],R=a[m+3],(192&L)==128&&(192&N)==128&&(192&R)==128&&(T=(15&x)<<18|(63&L)<<12|(63&N)<<6|63&R,(T<=65535||T>=1114112)&&(T=null))),T===null?(T=65533,V=1):T>65535&&(T-=65536,p+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),p+=String.fromCharCode(T),m+=V}return p}(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const a=new Uint8Array(e);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*S1),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*S1),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?function(e,a){let s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(s=~(-e%4294967296),c=~(-e/4294967296),4294967295^s?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(p,m,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)}(s,0,a),function(p,m){const x=(7&p)<<4;m.buf[m.pos++]|=x|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(c,a)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=function(s,c,p){for(let m,x,L=0;L<c.length;L++){if(m=c.charCodeAt(L),m>55295&&m<57344){if(!x){m>56319||L+1===c.length?(s[p++]=239,s[p++]=191,s[p++]=189):x=m;continue}if(m<56320){s[p++]=239,s[p++]=191,s[p++]=189,x=m;continue}m=x-55296<<10|m-56320|65536,x=null}else x&&(s[p++]=239,s[p++]=191,s[p++]=189,x=null);m<128?s[p++]=m:(m<2048?s[p++]=m>>6|192:(m<65536?s[p++]=m>>12|224:(s[p++]=m>>18|240,s[p++]=m>>12&63|128),s[p++]=m>>6&63|128),s[p++]=63&m|128)}return p}(this.buf,r,this.pos);const a=this.pos-e;a>=128&&A1(e,a,this),this.pos=e-1,this.writeVarint(a),this.pos+=a}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let a=0;a<e;a++)this.buf[this.pos++]=r[a]}writeRawMessage(r,e){this.pos++;const a=this.pos;r(e,this);const s=this.pos-a;s>=128&&A1(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s}writeMessage(r,e,a){this.writeTag(r,2),this.writeRawMessage(e,a)}writePackedVarint(r,e){e.length&&this.writeMessage(r,nz,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,iz,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,lz,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,sz,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,oz,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,cz,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,uz,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,dz,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,hz,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function wm(r,e,a){return a?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function A1(r,e,a){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));a.realloc(s);for(let c=a.pos-1;c>=r;c--)a.buf[c+s]=a.buf[c]}function nz(r,e){for(let a=0;a<r.length;a++)e.writeVarint(r[a])}function iz(r,e){for(let a=0;a<r.length;a++)e.writeSVarint(r[a])}function sz(r,e){for(let a=0;a<r.length;a++)e.writeFloat(r[a])}function oz(r,e){for(let a=0;a<r.length;a++)e.writeDouble(r[a])}function lz(r,e){for(let a=0;a<r.length;a++)e.writeBoolean(r[a])}function cz(r,e){for(let a=0;a<r.length;a++)e.writeFixed32(r[a])}function uz(r,e){for(let a=0;a<r.length;a++)e.writeSFixed32(r[a])}function dz(r,e){for(let a=0;a<r.length;a++)e.writeFixed64(r[a])}function hz(r,e){for(let a=0;a<r.length;a++)e.writeSFixed64(r[a])}const nx=3;function fz(r,e,a){e.glyphs=[],r===1&&a.readMessage(pz,e)}function pz(r,e,a){if(r===3){const{id:s,bitmap:c,width:p,height:m,left:x,top:L,advance:N}=a.readMessage(mz,{});e.glyphs.push({id:s,bitmap:new Jf({width:p+2*nx,height:m+2*nx},c),metrics:{width:p,height:m,left:x,top:L,advance:N}})}else r===4?e.ascender=a.readSVarint():r===5&&(e.descender=a.readSVarint())}function mz(r,e,a){r===1?e.id=a.readVarint():r===2?e.bitmap=a.readBytes():r===3?e.width=a.readVarint():r===4?e.height=a.readVarint():r===5?e.left=a.readSVarint():r===6?e.top=a.readSVarint():r===7&&(e.advance=a.readVarint())}const R1=nx,gl={horizontal:1,vertical:2,horizontalOnly:3};class By{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,a){const s=new By;return s.scale=e||1,s.fontStack=a,s}static forImage(e){const a=new By;return a.image=e,a}}class vm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,a,s){const c=new vm;for(let p=0;p<e.sections.length;p++){const m=e.sections[p];m.image?c.addImageSection(m,s):c.addTextSection(m,a)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(a,s){let c="";for(let p=0;p<a.length;p++){const m=a.charCodeAt(p+1)||null,x=a.charCodeAt(p-1)||null;c+=!s&&(m&&Uc(m)&&!My[a[p+1]]||x&&Uc(x)&&!My[a[p-1]])||!My[a[p]]?a[p]:My[a[p]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&e0[this.text.charCodeAt(s)];s++)e++;let a=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&e0[this.text.charCodeAt(s)];s--)a--;this.text=this.text.substring(e,a),this.sectionIndex=this.sectionIndex.slice(e,a)}substring(e,a){const s=new vm;return s.text=this.text.substring(e,a),s.sectionIndex=this.sectionIndex.slice(e,a),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,a)=>Math.max(e,this.sections[a].scale),0)}addTextSection(e,a){this.text+=e.text,this.sections.push(By.forText(e.scale,e.fontStack||a));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e,a){const s=e.image?e.image.getPrimary():null;if(!s)return void Za("Can't add FormattedSection with an empty image.");s.scaleSelf(a);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(By.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Za("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ix(r,e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q=1){const $=vm.fromFeature(r,c,Q);T===gl.vertical&&$.verticalizePunctuation(V);let K=[];const ie=function(Ae,Me,Je,ot,We,ut){if(!Ae)return[];const _t=[],Zt=function(zt,nt,rt,Et,Jt,vt){let sa=0;for(let ua=0;ua<zt.length();ua++){const ta=zt.getSection(ua);sa+=T1(zt.getCodePoint(ua),ta,Et,Jt,nt,vt)}return sa/Math.max(1,Math.ceil(sa/rt))}(Ae,Me,Je,ot,We,ut),Pt=Ae.text.indexOf("")>=0;let At=0;for(let zt=0;zt<Ae.length();zt++){const nt=Ae.getSection(zt),rt=Ae.getCodePoint(zt);if(e0[rt]||(At+=T1(rt,nt,ot,We,Me,ut)),zt<Ae.length()-1){const Et=!((xt=rt)<11904||!(xa["Bopomofo Extended"](xt)||xa.Bopomofo(xt)||xa["CJK Compatibility Forms"](xt)||xa["CJK Compatibility Ideographs"](xt)||xa["CJK Compatibility"](xt)||xa["CJK Radicals Supplement"](xt)||xa["CJK Strokes"](xt)||xa["CJK Symbols and Punctuation"](xt)||xa["CJK Unified Ideographs Extension A"](xt)||xa["CJK Unified Ideographs"](xt)||xa["Enclosed CJK Letters and Months"](xt)||xa["Halfwidth and Fullwidth Forms"](xt)||xa.Hiragana(xt)||xa["Ideographic Description Characters"](xt)||xa["Kangxi Radicals"](xt)||xa["Katakana Phonetic Extensions"](xt)||xa.Katakana(xt)||xa["Vertical Forms"](xt)||xa["Yi Radicals"](xt)||xa["Yi Syllables"](xt)));(yz[rt]||Et||nt.image)&&_t.push(M1(zt+1,At,Zt,_t,gz(rt,Ae.getCodePoint(zt+1),Et&&Pt),!1))}}var xt;return B1(M1(Ae.length(),At,Zt,_t,0,!0))}($,N,p,e,s,F),{processBidirectionalText:le,processStyledBidirectionalText:de}=ns;if(le&&$.sections.length===1){const Ae=le($.toString(),ie);for(const Me of Ae){const Je=new vm;Je.text=Me,Je.sections=$.sections;for(let ot=0;ot<Me.length;ot++)Je.sectionIndex.push(0);K.push(Je)}}else if(de){const Ae=de($.text,$.sectionIndex,ie);for(const Me of Ae){const Je=new vm;Je.text=Me[0],Je.sectionIndex=Me[1],Je.sections=$.sections,K.push(Je)}}else K=function(Ae,Me){const Je=[],ot=Ae.text;let We=0;for(const ut of Me)Je.push(Ae.substring(We,ut)),We=ut;return We<ot.length&&Je.push(Ae.substring(We,ot.length)),Je}($,ie);const Ee=[],Le={positionedLines:Ee,text:$.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ae,Me,Je,ot,We,ut,_t,Zt,Pt,At,xt,zt){let nt=0,rt=0,Et=0;const Jt=Zt==="right"?1:Zt==="left"?0:.5;let vt=!1;for(const ea of We){const ja=ea.getSections();for(const Da of ja){if(Da.image)continue;const nr=Me[Da.fontStack];if(nr&&(vt=nr.ascender!==void 0&&nr.descender!==void 0,!vt))break}if(!vt)break}let sa=0;for(const ea of We){ea.trim();const ja=ea.getMaxScale(),Da=(ja-1)*os,nr={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[sa]=nr;const Zr=nr.positionedGlyphs;let Pa=0;if(!ea.length()){rt+=ut,++sa;continue}let Br=0,Ir=0;for(let je=0;je<ea.length();je++){const _e=ea.getSection(je),ft=ea.getSectionIndex(je),Xt=ea.getCodePoint(je);let pt=_e.scale,$t=null,pa=null,fa=null,Xa=os,Aa=0,da=Pt;da===gl.vertical&&((ua=Xt)===12312||ua===12313||ua===12316||ua===12540||ua===12448)&&(da=gl.horizontal);const Vr=!(da===gl.horizontal||!xt&&!Nd(Xt)||xt&&(e0[Xt]||gf(Xt)));if(_e.image){const tn=ot.get(_e.image.toString());if(!tn)continue;fa=_e.image,Ae.iconsInText=Ae.iconsInText||!0,pa=tn.paddedRect;const Ma=tn.displaySize;pt=pt*os/zt,$t={width:Ma[0],height:Ma[1],left:0,top:-R1,advance:Vr?Ma[1]:Ma[0],localGlyph:!1},Aa=vt?-$t.height*pt:ja*os-17-Ma[1]*pt,Xa=$t.advance;const Lr=(Vr?Ma[0]:Ma[1])*pt-os*ja;Lr>0&&Lr>Pa&&(Pa=Lr)}else{const tn=Je[_e.fontStack];if(!tn)continue;tn[Xt]&&(pa=tn[Xt]);const Ma=Me[_e.fontStack];if(!Ma)continue;const Lr=Ma.glyphs[Xt];if(!Lr)continue;if($t=Lr.metrics,Xa=Xt!==8203?os:0,vt){const an=Ma.ascender!==void 0?Math.abs(Ma.ascender):0,Ur=Ma.descender!==void 0?Math.abs(Ma.descender):0,Un=(an+Ur)*pt;Br<Un&&(Br=Un,Ir=(an-Ur)/2*pt),Aa=-an*pt}else Aa=(ja-pt)*os-17}Vr?(Ae.verticalizable=!0,Zr.push({glyph:Xt,image:fa,x:nt,y:rt+Aa,vertical:Vr,scale:pt,localGlyph:$t.localGlyph,fontStack:_e.fontStack,sectionIndex:ft,metrics:$t,rect:pa}),nt+=Xa*pt+At):(Zr.push({glyph:Xt,image:fa,x:nt,y:rt+Aa,vertical:Vr,scale:pt,localGlyph:$t.localGlyph,fontStack:_e.fontStack,sectionIndex:ft,metrics:$t,rect:pa}),nt+=$t.advance*pt+At)}Zr.length!==0&&(Et=Math.max(nt-At,Et),vt?I1(Zr,Jt,Pa,Ir,ut*ja/2):I1(Zr,Jt,Pa,0,ut/2)),nt=0;const In=ut*ja+Pa;nr.lineOffset=Math.max(Pa,Da),rt+=In,++sa}var ua;const ta=rt,{horizontalAlign:Yt,verticalAlign:Fa}=sx(_t);(function(ea,ja,Da,nr,Zr,Pa){const Br=(ja-Da)*Zr,Ir=-Pa*nr;for(const In of ea)for(const je of In.positionedGlyphs)je.x+=Br,je.y+=Ir})(Ae.positionedLines,Jt,Yt,Fa,Et,ta),Ae.top+=-Fa*ta,Ae.bottom=Ae.top+ta,Ae.left+=-Yt*Et,Ae.right=Ae.left+Et,Ae.hasBaseline=vt}(Le,e,a,s,K,m,x,L,T,N,V,O),!function(Ae){for(const Me of Ae)if(Me.positionedGlyphs.length!==0)return!1;return!0}(Ee))return Le}const e0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function T1(r,e,a,s,c,p){if(e.image){const m=s.get(e.image.toString());return m?m.displaySize[0]*e.scale*os/p+c:0}{const m=a[e.fontStack],x=m&&m.glyphs[r];return x?x.metrics.advance*e.scale+c:0}}function V1(r,e,a,s){const c=Math.pow(r-e,2);return s?r<e?c/2:2*c:c+Math.abs(a)*a}function gz(r,e,a){let s=0;return r===10&&(s-=1e4),a&&(s+=150),r!==40&&r!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function M1(r,e,a,s,c,p){let m=null,x=V1(e,a,c,p);for(const L of s){const N=V1(e-L.x,a,c,p)+L.badness;N<=x&&(m=L,x=N)}return{index:r,x:e,priorBreak:m,badness:x}}function B1(r){return r?B1(r.priorBreak).concat(r.index):[]}function sx(r){let e=.5,a=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:e,verticalAlign:a}}function I1(r,e,a,s,c){if(!(e||a||s||c))return;const p=r.length-1,m=r[p],x=(m.x+m.metrics.advance*m.scale)*e;for(let L=0;L<=p;L++)r[L].x-=x,r[L].y+=a+s+c}function k1(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function t0(r,e,a,s){const{horizontalAlign:c,verticalAlign:p}=sx(s),m=a[0]-r.displaySize[0]*c,x=a[1]-r.displaySize[1]*p;return{imagePrimary:r,imageSecondary:e,top:x,bottom:x+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function ox(r,e,a,s,c,p){const m=r.imagePrimary;let x;if(m.content){const $=m.content,K=m.pixelRatio||1;x=[$[0]/K,$[1]/K,m.displaySize[0]-$[2]/K,m.displaySize[1]-$[3]/K]}const L=e.left*p,N=e.right*p;let R,T,V,F;a==="width"||a==="both"?(F=c[0]+L-s[3],T=c[0]+N+s[1]):(F=c[0]+(L+N-m.displaySize[0])/2,T=F+m.displaySize[0]);const O=e.top*p,Q=e.bottom*p;return a==="height"||a==="both"?(R=c[1]+O-s[0],V=c[1]+Q+s[2]):(R=c[1]+(O+Q-m.displaySize[1])/2,V=R+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:R,right:T,bottom:V,left:F,collisionPadding:x}}function J1(r){return!r.imagePrimary.stretchX}function F1(r){return!r.imagePrimary.stretchY}function O1(r){return{width:r.right-r.left,height:r.bottom-r.top}}const Pu=128;function bm(r,e,a){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new $r(r+1,{worldview:a}))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let m=0;for(;m<c.length&&c[m]<=r;)m++;m=Math.max(0,m-1);let x=m;for(;x<c.length&&c[x]<r+1;)x++;x=Math.min(c.length-1,x);const L=c[m],N=c[x];return s.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:N,interpolationType:p}:{kind:"camera",minZoom:L,maxZoom:N,minSize:s.evaluate(new $r(L,{worldview:a})),maxSize:s.evaluate(new $r(N,{worldview:a})),interpolationType:p}}}function lx(r,{uSize:e,uSizeT:a},{lowerSize:s,upperSize:c}){return r.kind==="source"?s/Pu:r.kind==="composite"?Sa(s/Pu,c/Pu,a):e}function Lm(r,e,a=1){let s=0,c=0;if(r.kind==="constant")c=r.layoutSize*a;else if(r.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:x}=r,L=p?re(to.interpolationFactor(p,e,m,x),0,1):0;r.kind==="camera"?c=Sa(r.minSize,r.maxSize,L)*a:s=L*a}return{uSizeT:s,uSize:c}}class Gh extends St{constructor(e,a,s,c,p){super(e,a),this.angle=c,this.z=s,p!==void 0&&(this.segment=p)}clone(){return new Gh(this.x,this.y,this.z,this.angle,this.segment)}}function D1(r,e,a,s,c){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,x=0;for(;x>-a/2;){if(m--,m<0)return!1;x-=r[m].dist(p),p=r[m]}x+=r[m].dist(r[m+1]),m++;const L=[];let N=0;for(;x<a/2;){const R=r[m],T=r[m+1];if(!T)return!1;let V=r[m-1].angleTo(R)-R.angleTo(T);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:x,angleDelta:V}),N+=V;x-L[0].distance>s;)N-=L.shift().angleDelta;if(N>c)return!1;m++,x+=R.dist(T)}return!0}function C1(r){let e=0;for(let a=0;a<r.length-1;a++)e+=r[a].dist(r[a+1]);return e}function P1(r,e,a){return r?.6*e*a:0}function G1(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function _z(r,e,a,s,c,p){const m=P1(a,c,p),x=G1(a,s)*p;let L=0;const N=C1(r)/2;for(let R=0;R<r.length-1;R++){const T=r[R],V=r[R+1],F=T.dist(V);if(L+F>N){const O=(N-L)/F,Q=Sa(T.x,V.x,O),$=Sa(T.y,V.y,O),K=new Gh(Q,$,0,V.angleTo(T),R);return!m||D1(r,K,x,m,e)?K:void 0}L+=F}}function xz(r,e,a,s,c,p,m,x,L){const N=P1(s,p,m),R=G1(s,c),T=R*m,V=r[0].x===0||r[0].x===L||r[0].y===0||r[0].y===L;return e-T<e/4&&(e=T+e/4),U1(r,V?e/2*x%e:(R/2+2*p)*m*x%e,e,N,a,T,V,!1,L)}function U1(r,e,a,s,c,p,m,x,L){const N=p/2,R=C1(r);let T=0,V=e-a,F=[];for(let O=0;O<r.length-1;O++){const Q=r[O],$=r[O+1],K=Q.dist($),ie=$.angleTo(Q);for(;V+a<T+K;){V+=a;const le=(V-T)/K,de=Sa(Q.x,$.x,le),Ee=Sa(Q.y,$.y,le);if(de>=0&&de<L&&Ee>=0&&Ee<L&&V-N>=0&&V+N<=R){const Le=new Gh(de,Ee,0,ie,O);s&&!D1(r,Le,p,s,c)||F.push(Le)}}T+=K}return x||F.length||m||(F=U1(r,T/2,a,s,c,p,m,!0,L)),F}function W1(r){let e=0,a=0;for(const m of r)e+=m.w*m.h,a=Math.max(a,m.w);r.sort((m,x)=>x.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),a),h:1/0}];let c=0,p=0;for(const m of r)for(let x=s.length-1;x>=0;x--){const L=s[x];if(!(m.w>L.w||m.h>L.h)){if(m.x=L.x,m.y=L.y,p=Math.max(p,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===L.w&&m.h===L.h){const N=s.pop();N&&x<s.length&&(s[x]=N)}else m.h===L.h?(L.x+=m.w,L.w-=m.w):m.w===L.w?(L.y+=m.h,L.h-=m.h):(s.push({x:L.x+m.w,y:L.y,w:L.w-m.w,h:m.h}),L.y+=m.h,L.h-=m.h);break}}return{w:c,h:p,fill:e/(c*p)||0}}na(Gh,"Anchor");const Rp=1;class Iy{static getImagePositionScale(e,a,s){if(a&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:s,y:s}}constructor(e,a,s,c){this.paddedRect=e;const{pixelRatio:p,version:m,stretchX:x,stretchY:L,content:N,sdf:R,usvg:T}=a;this.pixelRatio=p,this.stretchX=x,this.stretchY=L,this.content=N,this.version=m,this.padding=s,this.sdf=R,this.usvg=T,this.scale=Iy.getImagePositionScale(c,T,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function cx(r,e,a){const s=Kl.parse(r),c=function(p,m,x=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*x[0])+2*m,h:(p.data?p.data.height:p.height*x[1])+2*m}}(e,a,[s.options.transform.a,s.options.transform.d]);return{bin:c,imagePosition:new Iy(c,e,a,s),imageVariant:s}}class X1{constructor(e,a,s){const c=new Map,p=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,c,Rp,m),this.addImages(a,p,2,m);const{w:x,h:L}=W1(m),N=new zs({width:x||1,height:L||1});for(const[R,T]of e.entries()){const V=c.get(R).paddedRect;zs.copy(T.data,N,{x:0,y:0},{x:V.x+Rp,y:V.y+Rp},T.data,null,T.sdf)}for(const[R,T]of a.entries()){const V=p.get(R),F=V.paddedRect;let O=V.padding;const Q=F.x+O,$=F.y+O,K=T.data.width,ie=T.data.height;O=O>1?O-1:O,zs.copy(T.data,N,{x:0,y:0},{x:Q,y:$},T.data,s),zs.copy(T.data,N,{x:0,y:ie-O},{x:Q,y:$-O},{width:K,height:O},s),zs.copy(T.data,N,{x:0,y:0},{x:Q,y:$+ie},{width:K,height:O},s),zs.copy(T.data,N,{x:K-O,y:0},{x:Q-O,y:$},{width:O,height:ie},s),zs.copy(T.data,N,{x:0,y:0},{x:Q+K,y:$},{width:O,height:ie},s),zs.copy(T.data,N,{x:K-O,y:ie-O},{x:Q-O,y:$-O},{width:O,height:O},s),zs.copy(T.data,N,{x:0,y:ie-O},{x:Q+K,y:$-O},{width:O,height:O},s),zs.copy(T.data,N,{x:0,y:0},{x:Q+K,y:$+ie},{width:O,height:O},s),zs.copy(T.data,N,{x:K-O,y:0},{x:Q-O,y:$+ie},{width:O,height:O},s)}this.lut=s,this.image=N,this.iconPositions=c,this.patternPositions=p}addImages(e,a,s,c){for(const[p,m]of e.entries()){const{bin:x,imagePosition:L,imageVariant:N}=cx(p,m,s);a.set(p,L),c.push(x),m.hasRenderCallback&&this.haveRenderCallbacks.push(N.id)}}patchUpdatedImages(e,a,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const c of e.getUpdatedImages(s)){for(const p of this.iconPositions.keys()){const m=Kl.parse(p);if(xn.isEqual(m.id,c)){const x=e.getImage(c,s);this.patchUpdatedImage(this.iconPositions.get(p),x,a,null)}}for(const p of this.patternPositions.keys()){const m=Kl.parse(p);if(xn.isEqual(m.id,c)){const x=e.getImage(c,s);this.patchUpdatedImage(this.patternPositions.get(p),x,a,this.lut)}}}}patchUpdatedImage(e,a,s,c=null){if(!e||!a||e.version===a.version)return;e.version=a.version;const[p,m]=e.tl,x=e.sdf;if(this.lut||x){const L={width:a.data.width,height:a.data.height},N=new zs(L);zs.copy(a.data,N,{x:0,y:0},{x:0,y:0},L,c,x),s.update(N,{position:{x:p,y:m}})}else s.update(a.data,{position:{x:p,y:m}})}}na(Iy,"ImagePosition"),na(X1,"ImageAtlas");const ky=1e20;function Q1(r,e,a,s,c,p,m,x,L){for(let N=e;N<e+s;N++)H1(r,a*p+N,p,c,m,x,L);for(let N=a;N<a+c;N++)H1(r,N*p+e,1,s,m,x,L)}function H1(r,e,a,s,c,p,m){p[0]=0,m[0]=-ky,m[1]=ky,c[0]=r[e];for(let x=1,L=0,N=0;x<s;x++){c[x]=r[e+x*a];const R=x*x;do{const T=p[L];N=(c[x]-c[T]+R-T*T)/(x-T)/2}while(N<=m[L]&&--L>-1);L++,p[L]=x,m[L]=N,m[L+1]=ky}for(let x=0,L=0;x<s;x++){for(;m[L+1]<x;)L++;const N=p[L],R=x-N;r[e+x*a]=c[N]+R*R}}const Gu=2,ux={none:0,ideographs:1,all:2};class jm{constructor(e,a,s){this.requestManager=e,this.localGlyphMode=a,this.localFontFamily=s,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,a){const s=[],c=this.url||sn.GLYPHS_URL;for(const p in e)for(const m of e[p])s.push({stack:p,id:m});Re(s,({stack:p,id:m},x)=>{let L=this.entries[p];L||(L=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=L.glyphs[m];if(N!==void 0)return void x(null,{stack:p,id:m,glyph:N});if(N=this._tinySDF(L,p,m),N)return L.glyphs[m]=N,void x(null,{stack:p,id:m,glyph:N});const R=Math.floor(m/256);if(256*R>65535)return Za("glyphs > 65535 not supported"),void x(null,{stack:p,id:m,glyph:N});if(L.ranges[R])return void x(null,{stack:p,id:m,glyph:N});let T=L.requests[R];T||(T=L.requests[R]=[],jm.loadGlyphRange(p,R,c,this.requestManager,(V,F)=>{if(F){L.ascender=F.ascender,L.descender=F.descender;for(const O in F.glyphs)this._doesCharSupportLocalGlyph(+O)||(L.glyphs[+O]=F.glyphs[+O]);L.ranges[R]=!0}for(const O of T)O(V,F);delete L.requests[R]})),T.push((V,F)=>{V?x(V):F&&x(null,{stack:p,id:m,glyph:F.glyphs[m]||null})})},(p,m)=>{if(p)a(p);else if(m){const x={};for(const{stack:L,id:N,glyph:R}of m)x[L]===void 0&&(x[L]={}),x[L].glyphs===void 0&&(x[L].glyphs={}),x[L].glyphs[N]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},x[L].ascender=this.entries[L].ascender,x[L].descender=this.entries[L].descender;a(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ux.none&&(this.localGlyphMode===ux.all?!!this.localFontFamily:!!this.localFontFamily&&(xa["CJK Unified Ideographs"](e)||xa["Hangul Syllables"](e)||xa.Hiragana(e)||xa.Katakana(e)||xa["CJK Symbols and Punctuation"](e)||xa["CJK Unified Ideographs Extension A"](e)||xa["CJK Unified Ideographs Extension B"](e)||xa.Osage(e)))}_tinySDF(e,a,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let Q="400";/bold/i.test(a)?Q="900":/medium/i.test(a)?Q="500":/light/i.test(a)&&(Q="200"),p=e.tinySDF=new jm.TinySDF({fontFamily:c,fontWeight:Q,fontSize:24*Gu,buffer:3*Gu,radius:8*Gu}),p.fontWeight=Q}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const m=String.fromCodePoint(s),{data:x,width:L,height:N,glyphWidth:R,glyphHeight:T,glyphLeft:V,glyphTop:F,glyphAdvance:O}=p.draw(m);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new Jf({width:L,height:N},x),metrics:{width:R/Gu,height:T/Gu,left:V/Gu,top:F/Gu-27,advance:O/Gu,localGlyph:!0}}}}jm.loadGlyphRange=function(r,e,a,s,c){const p=256*e,m=p+255,x=s.transformRequest(s.normalizeGlyphsURL(a).replace("{fontstack}",r).replace("{range}",`${p}-${m}`),rl.Glyphs);iu(x,(L,N)=>{if(L)c(L);else if(N){const R={},T=function(V){return new Kg(V).readFields(fz,{})}(N);for(const V of T.glyphs)R[V.id]=V;c(null,{glyphs:R,ascender:T.ascender,descender:T.descender})}})},jm.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:a=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:m="normal",lang:x=null}={}){this.buffer=e,this.cutoff=s,this.radius=a,this.lang=x;const L=this.size=r+4*e,N=this._createCanvas(L),R=this.ctx=N.getContext("2d",{willReadFrequently:!0});R.font=`${m} ${p} ${r}px ${c}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(r),m=Math.ceil(a),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),L=Math.min(this.size-this.buffer,m+Math.ceil(s)),N=x+2*this.buffer,R=L+2*this.buffer,T=Math.max(N*R,0),V=new Uint8ClampedArray(T),F={data:V,width:N,height:R,glyphWidth:x,glyphHeight:L,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(x===0||L===0)return F;const{ctx:O,buffer:Q,gridInner:$,gridOuter:K}=this;this.lang&&(O.lang=this.lang),O.clearRect(Q,Q,x,L),O.fillText(r,Q,Q+m);const ie=O.getImageData(Q,Q,x,L);K.fill(ky,0,T),$.fill(0,0,T);for(let le=0;le<L;le++)for(let de=0;de<x;de++){const Ee=ie.data[4*(le*x+de)+3]/255;if(Ee===0)continue;const Le=(le+Q)*N+de+Q;if(Ee===1)K[Le]=0,$[Le]=ky;else{const Ae=.5-Ee;K[Le]=Ae>0?Ae*Ae:0,$[Le]=Ae<0?Ae*Ae:0}}Q1(K,0,0,N,R,N,this.f,this.v,this.z),Q1($,Q,Q,x,L,N,this.f,this.v,this.z);for(let le=0;le<T;le++){const de=Math.sqrt(K[le])-Math.sqrt($[le]);V[le]=Math.round(255-255*(de/this.radius+this.cutoff))}return F}};const Pd=Rp;function Y1(r,e){return r+e[1]-e[0]}function dx(r,e,a,s,c=1){const p=[],m=r.imagePrimary,x=m.pixelRatio,L=m.paddedRect.w-2*Pd,N=m.paddedRect.h-2*Pd,R=(r.right-r.left)*c,T=(r.bottom-r.top)*c,V=m.stretchX||[[0,L]],F=m.stretchY||[[0,N]],O=V.reduce(Y1,0),Q=F.reduce(Y1,0),$=L-O,K=N-Q;let ie=0,le=O,de=0,Ee=Q,Le=0,Ae=$,Me=0,Je=K;if(m.content&&s){const We=m.content;ie=a0(V,0,We[0]),de=a0(F,0,We[1]),le=a0(V,We[0],We[2]),Ee=a0(F,We[1],We[3]),Le=We[0]-ie,Me=We[1]-de,Ae=We[2]-We[0]-le,Je=We[3]-We[1]-Ee}const ot=(We,ut,_t,Zt)=>{const Pt=r0(We.stretch-ie,le,R,r.left*c),At=n0(We.fixed-Le,Ae,We.stretch,O),xt=r0(ut.stretch-de,Ee,T,r.top*c),zt=n0(ut.fixed-Me,Je,ut.stretch,Q),nt=r0(_t.stretch-ie,le,R,r.left*c),rt=n0(_t.fixed-Le,Ae,_t.stretch,O),Et=r0(Zt.stretch-de,Ee,T,r.top*c),Jt=n0(Zt.fixed-Me,Je,Zt.stretch,Q),vt=new St(Pt,xt),sa=new St(nt,xt),ua=new St(nt,Et),ta=new St(Pt,Et),Yt=new St(At/x,zt/x),Fa=new St(rt/x,Jt/x),ea=e*Math.PI/180;if(ea){const Br=Math.sin(ea),Ir=Math.cos(ea),In=[Ir,-Br,Br,Ir];vt._matMult(In),sa._matMult(In),ta._matMult(In),ua._matMult(In)}const ja=We.stretch+We.fixed,Da=_t.stretch+_t.fixed,nr=ut.stretch+ut.fixed,Zr=Zt.stretch+Zt.fixed,Pa=r.imageSecondary;return{tl:vt,tr:sa,bl:ta,br:ua,texPrimary:{x:m.paddedRect.x+Pd+ja,y:m.paddedRect.y+Pd+nr,w:Da-ja,h:Zr-nr},texSecondary:Pa?{x:Pa.paddedRect.x+Pd+ja,y:Pa.paddedRect.y+Pd+nr,w:Da-ja,h:Zr-nr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:Fa,minFontScaleX:Ae/x/R,minFontScaleY:Je/x/T,isSDF:a}};if(s&&(m.stretchX||m.stretchY)){const We=$1(V,$,O),ut=$1(F,K,Q);for(let _t=0;_t<We.length-1;_t++){const Zt=We[_t],Pt=We[_t+1];for(let At=0;At<ut.length-1;At++)p.push(ot(Zt,ut[At],Pt,ut[At+1]))}}else p.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:N+1}));return p}function wz(r,e){const a=r.stretchY||[[0,r.paddedRect.h-2*Pd]];return e&&(r.stretchX||r.stretchY)?q1(r.stretchX||[[0,r.paddedRect.w-2*Pd]])*q1(a):1}function a0(r,e,a){let s=0;for(const c of r)s+=Math.max(e,Math.min(a,c[1]))-Math.max(e,Math.min(a,c[0]));return s}function $1(r,e,a){const s=[{fixed:-Pd,stretch:0}];for(const[c,p]of r){const m=s[s.length-1];s.push({fixed:c-m.stretch,stretch:m.stretch}),s.push({fixed:c-m.stretch,stretch:m.stretch+(p-c)})}return s.push({fixed:e+Pd,stretch:a}),s}function q1(r){return 2*r.length+1}function r0(r,e,a,s){return r/e*a+s}function n0(r,e,a,s){return r-e*a/s}function vz(r,e,a,s){const c=e+r.positionedLines[s].lineOffset;return s===0?a+c/2:a+(c+(e+r.positionedLines[s-1].lineOffset))/2}function bz(r,e=1,a=!1){let s=1/0,c=1/0,p=-1/0,m=-1/0;const x=r[0];for(let F=0;F<x.length;F++){const O=x[F];(!F||O.x<s)&&(s=O.x),(!F||O.y<c)&&(c=O.y),(!F||O.x>p)&&(p=O.x),(!F||O.y>m)&&(m=O.y)}const L=Math.min(p-s,m-c);let N=L/2;const R=new hh([],Lz);if(L===0)return new St(s,c);for(let F=s;F<p;F+=L)for(let O=c;O<m;O+=L)R.push(new Zm(F+N,O+N,N,r));let T=function(F){let O=0,Q=0,$=0;const K=F[0];for(let ie=0,le=K.length,de=le-1;ie<le;de=ie++){const Ee=K[ie],Le=K[de],Ae=Ee.x*Le.y-Le.x*Ee.y;Q+=(Ee.x+Le.x)*Ae,$+=(Ee.y+Le.y)*Ae,O+=3*Ae}return new Zm(Q/O,$/O,0,F)}(r),V=R.length;for(;R.length;){const F=R.pop();(F.d>T.d||!T.d)&&(T=F,a&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,V)),F.max-T.d<=e||(N=F.h/2,R.push(new Zm(F.p.x-N,F.p.y-N,N,r)),R.push(new Zm(F.p.x+N,F.p.y-N,N,r)),R.push(new Zm(F.p.x-N,F.p.y+N,N,r)),R.push(new Zm(F.p.x+N,F.p.y+N,N,r)),V+=4)}return a&&(console.log(`num probes: ${V}`),console.log(`best distance: ${T.d}`)),T.p}function Lz(r,e){return e.max-r.max}class Zm{constructor(e,a,s,c){this.p=new St(e,a),this.h=s,this.d=function(p,m){let x=!1,L=1/0;for(let N=0;N<m.length;N++){const R=m[N];for(let T=0,V=R.length,F=V-1;T<V;F=T++){const O=R[T],Q=R[F];O.y>p.y!=Q.y>p.y&&p.x<(Q.x-O.x)*(p.y-O.y)/(Q.y-O.y)+O.x&&(x=!x),L=Math.min(L,Zo(p,O,Q))}}return(x?1:-1)*Math.sqrt(L)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const jz=Object.keys,hx=Number.POSITIVE_INFINITY,Zz=Math.sqrt(2);function i0(r,e,a,s){const c=r.collisionPadding||[0,0,0,0],p={top:r.top-c[1],bottom:r.bottom+c[3],left:r.left-c[0],right:r.right+c[2],scaled:!1};return s!==void 0&&function(m,x){m.top*=x,m.bottom*=x,m.left*=x,m.right*=x,m.scaled=!0}(p,s),a&&function(m,x){if(!x)return;const L=fr(x),N=new St(m.left,m.top),R=new St(m.right,m.top),T=new St(m.left,m.bottom),V=new St(m.right,m.bottom);N._rotateAround(L,new St(0,0)),R._rotateAround(L,new St(0,0)),T._rotateAround(L,new St(0,0)),V._rotateAround(L,new St(0,0)),m.left=Math.min(N.x,R.x,T.x,V.x),m.right=Math.max(N.x,R.x,T.x,V.x),m.top=Math.min(N.y,R.y,T.y,V.y),m.bottom=Math.max(N.y,R.y,T.y,V.y)}(p,a),e?{top:Math.min(e.top,p.top),bottom:Math.max(e.bottom,p.bottom),left:Math.min(e.left,p.left),right:Math.max(e.right,p.right),scaled:e.scaled||p.scaled}:p}function K1(r,[e,a]){let s=0,c=0;if(a===hx){e<0&&(e=0);const p=e/Zz;switch(r){case"top-right":case"top-left":c=p-7;break;case"bottom-right":case"bottom-left":c=7-p;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(r){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),a=Math.abs(a),r){case"top-right":case"top-left":case"top":c=a-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-a}switch(r){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,c]}function Nz(r,e,a,s,c,p,m,x,L,N,R){const T=r.layers[0],V=T.appearances;if(V.length===0)return{iconBBox:null,iconVerticalBBox:null};let F=null,O=null;const Q=s.get("icon-rotate").evaluate(c,{},p);e&&(F=i0(e,F,Q,m),a)&&(O=i0(a,O,Q+90,m));const[$,K]=s.get("icon-size-scale-range"),ie=re(1,$,K);for(const le of V){const de=le.getUnevaluatedProperties(),Ee=de._values["icon-image"].value!==void 0,Le=de._values["icon-size"].value!==void 0,Ae=de._values["icon-offset"].value!==void 0,Me=de._values["icon-rotate"].value!==void 0;if(Ee||Le||Ae||Me){const Je=Ae?T.getAppearanceValueAndResolveTokens(le,"icon-offset",c,p,[]):null,ot=Je&&Array.isArray(Je)?Je:x,We=Me?T.getAppearanceValueAndResolveTokens(le,"icon-rotate",c,p,[]):null,ut=typeof We=="number"?We:Q,_t=Le?T.getAppearanceValueAndResolveTokens(le,"icon-size",c,p,[]):null,Zt=typeof _t=="number"?_t*L.iconScaleFactor:m;let Pt=null,At=null,xt=null;if(Ee){const zt=T.getAppearanceValueAndResolveTokens(le,"icon-image",c,p,[]);if(zt){const nt=r.getResolvedImageFromTokens(zt),rt=de._values["icon-size"],Et=Jy(nt,bm(r.zoom,rt,r.worldview),rt,p,r.zoom,c,r.pixelRatio,ie,r.worldview);xt=N.get(Et.iconPrimary.toString())}}else e&&(xt=e.imagePrimary);xt&&(Pt=t0(xt,null,ot,R),r.allowVerticalPlacement&&(At=t0(xt,null,ot,R))),Pt&&(F=i0(Pt,F,ut,Zt)),At&&(O=i0(At,O,ut+90,Zt))}}return{iconBBox:F,iconVerticalBBox:O}}function s0(r,e,a,s,c,p,m,x,L){if(!e||!e.usvg)return;const N=O1(s),R=O1(c),T=p!=="both"&&p!=="width"||!J1(s)?1:R.width/N.width,V=p!=="both"&&p!=="height"||!F1(s)?1:R.height/N.height;a.scaleSelf(T,V);const F=a.toString();m.set(F,a),x.set(F,e);const{imagePosition:O}=cx(F,e,Rp);L.set(F,O)}function e2(r,e,a,s,c,p,m,x,L){if(!r)return;const N=function(R,T,V,F,O,Q){if(R.kind==="camera")return R.maxSize;if(R.kind==="composite"){const $=T.possiblyEvaluate(new $r(R.maxZoom,{worldview:Q}),V).evaluate(O,{},V),K=T.possiblyEvaluate(new $r(R.minZoom,{worldview:Q}),V).evaluate(O,{},V);return Math.max($,K)}return T.possiblyEvaluate(new $r(F,{worldview:Q})).evaluate(O,{},V)}(e,a,s,c,p,L);return r.scaleSelf(N*x*m)}function Jy(r,e,a,s,c,p,m,x,L){return{iconPrimary:e2(r.getPrimary(),e,a,s,c,p,m,x,L),iconSecondary:e2(r.getSecondary(),e,a,s,c,p,m,x,L)}}function Ez(r,e,a){if(!e)return;const s=a.get(r.toString()),c=a.get(e.toString());s&&c&&(s.paddedRect.w===c.paddedRect.w&&s.paddedRect.h===c.paddedRect.h||Za(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),s.usvg!==c.usvg&&Za(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function t2(r,e,a,s){if(!r)return;const c=e.get(a.toString());if(r.imagePrimary=c,s){const p=e.get(s.toString());r.imageSecondary=p}}function Sz(r,e){for(const a in r.horizontal)a2(r.horizontal[a],e);a2(r.vertical,e)}function a2(r,e){if(r){for(const a of r.positionedLines)for(const s of a.positionedGlyphs)if(s.image!==null){const c=s.image.toString();s.rect=e.get(c).paddedRect}}}function fx(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zz(r,e,a,s,c,p,m,x,L){const N=px(p.horizontal)||p.vertical,R=a.get("icon-text-fit-padding").evaluate(s,{},c);let T,V=e;return e&&L!=="none"&&(r.allowVerticalPlacement&&p.vertical&&(T=ox(e,p.vertical,L,R,x,m)),N&&(V=ox(e,N,L,R,x,m))),{defaultShapedIcon:V,verticallyShapedIcon:T}}function Az(r,e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie,le,de,Ee){let Le=m.textMaxSize.evaluate(e,{},V);Le===void 0?Le=x*m.textScaleFactor:Le*=m.textScaleFactor;const Ae=r.layers[0].layout,Me=os,Je=x*m.textScaleFactor/Me,ot=px(a.horizontal)||a.vertical;if($!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){const vt=r.appearanceFeatureData[e.index];vt&&(vt.textShaping=ot,vt.iconTextFitPadding=Ae.get("icon-text-fit-padding").evaluate(e,{},V),vt.fontScale=Je)}const We=F.name==="globe",ut=r.tilePixelRatio*Le/Me,_t=(nt=r.overscaling,r.zoom>18&&nt>2&&(nt>>=1),Math.max(Dt/(512*nt),1)*Ae.get("symbol-spacing")),Zt=Ae.get("text-padding")*r.tilePixelRatio,Pt=Ae.get("icon-padding")*r.tilePixelRatio,At=fr(Ae.get("text-max-angle")),xt=Ae.get("icon-rotation-alignment")==="map"&&le!=="point",zt=_t/2;var nt;r.hasAnyIconTextFit===!1&&$!=="none"&&(r.hasAnyIconTextFit=!0);const rt=e.properties?+e.properties[Ht]:null,Et=rt&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(rt):65535,Jt=(vt,sa,ua)=>{if(sa.x<0||sa.x>=Dt||sa.y<0||sa.y>=Dt)return;let ta=null;if(We){const{x:Yt,y:Fa,z:ea}=F.projectTilePoint(sa.x,sa.y,ua);ta={anchor:new Gh(Yt,Fa,ea,0,void 0),up:F.upVector(ua,sa.x,sa.y)}}(function(Yt,Fa,ea,ja,Da,nr,Zr,Pa,Br,Ir,In,je,_e,ft,Xt,pt,$t,pa,fa,Xa,Aa,da,Vr,tn,Ma,Lr,an,Ur,Un,Zn,hn){const qr=Yt.addToLineVertexArray(Fa,ja);let kr,Qa,Jr,fn,Ra,Nr,Nn,Kn=0,ci=0,zi=0,En=0,bi=-1,Wo=-1;const Li={};let _l=lu("");const As=ea?ea.anchor:Fa,yc=Ur!=="none";let Xo=0,xl=0;if(Br._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ls=Br.layout.get("text-offset").evaluate(Aa,{},Ma);Xo=ls[0]*os,xl=ls[1]*os}else Xo=Br.layout.get("text-radial-offset").evaluate(Aa,{},Ma)*os,xl=hx;if(Yt.allowVerticalPlacement&&Da.vertical){const ls=Da.vertical;if(Xt)Nr=mx(ls),Pa&&(Nn=mx(Pa));else{const oo=Br.layout.get("text-rotate").evaluate(Aa,{},Ma)+90;Jr=o0(Ir,As,Fa,In,je,_e,ls,ft,oo,pt),Pa&&(fn=o0(Ir,As,Fa,In,je,_e,Pa,pa,oo,null,hn))}}if(nr){const ls=Yt.iconSizeData,oo=Br.layout.get("icon-rotate").evaluate(Aa,{},Ma),Gd=dx(nr,oo,Vr,yc,da.iconScaleFactor),Pf=Pa?dx(Pa,oo,Vr,yc,da.iconScaleFactor):void 0;Qa=o0(Ir,As,Fa,In,je,_e,nr,pa,oo,null,Zn);const Tm=function(Ud,j0,Vm,PA,v3,b3,GA,UA){const L3=Ud.layers[0],j3=L3.appearances;let Mm=j0.length;if(Vm&&(Mm=Math.max(Mm,Vm.length)),j3.length===0)return Mm;const[WA,XA]=PA.get("icon-size-scale-range"),QA=re(1,WA,XA);for(const Z3 of j3){const N3=Z3.getUnevaluatedProperties();if(N3._values["icon-image"].value!==void 0){const E3=L3.getAppearanceValueAndResolveTokens(Z3,"icon-image",v3,b3,[]);if(E3){const S3=Ud.getResolvedImageFromTokens(E3);if(S3){const z3=N3._values["icon-size"],HA=Jy(S3,bm(Ud.zoom,z3,Ud.worldview),z3,b3,Ud.zoom,v3,Ud.pixelRatio,QA,Ud.worldview),YA=GA.get(HA.iconPrimary.toString());Mm=Math.max(Mm,wz(YA,UA))}}}}return Mm}(Yt,Gd,Pf,Br.layout,Aa,Ma,Yt.iconAtlasPositions,yc);Kn=4*Tm;let Gf=null;ls.kind==="source"?(Gf=[Pu*Br.layout.get("icon-size").evaluate(Aa,{},Ma)*da.iconScaleFactor],Gf[0]>Uh&&Za(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${Fy}. Reduce your "icon-size".`)):ls.kind==="composite"&&(Gf=[Pu*da.compositeIconSizes[0].evaluate(Aa,{},Ma)*da.iconScaleFactor,Pu*da.compositeIconSizes[1].evaluate(Aa,{},Ma)*da.iconScaleFactor],(Gf[0]>Uh||Gf[1]>Uh)&&Za(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${Fy}. Reduce your "icon-size".`)),Yt.addSymbols(Yt.icon,Gd,Gf,Xa,fa,Aa,void 0,ea,Fa,qr.lineStartIndex,qr.lineLength,-1,tn,Ma,Lr,an,Yt.symbolInstances.length,Tm),bi=Yt.icon.placedSymbolArray.length-1,Pf&&(ci=4*Tm,Yt.addSymbols(Yt.icon,Pf,Gf,Xa,fa,Aa,gl.vertical,ea,Fa,qr.lineStartIndex,qr.lineLength,-1,tn,Ma,Lr,an,Yt.symbolInstances.length,Tm),Wo=Yt.icon.placedSymbolArray.length-1)}for(const ls in Da.horizontal){const oo=ls,Gd=Da.horizontal[oo];kr||(_l=lu(Gd.text),Xt?Ra=mx(Gd):kr=o0(Ir,As,Fa,In,je,_e,Gd,ft,Br.layout.get("text-rotate").evaluate(Aa,{},Ma),pt));const Pf=Gd.positionedLines.length===1;if(zi+=r2(Yt,ea,Fa,Gd,Zr,Br,Xt,Aa,pt,qr,Da.vertical?gl.horizontal:gl.horizontalOnly,Pf?jz(Da.horizontal):[oo],Li,bi,da,tn,Ma,Yt.symbolInstances.length,Lr),Pf)break}Da.vertical&&(En+=r2(Yt,ea,Fa,Da.vertical,Zr,Br,Xt,Aa,pt,qr,gl.vertical,["vertical"],Li,Wo,da,tn,Ma,Yt.symbolInstances.length,Lr));let Rs=-1;const wl=(ls,oo)=>ls?Math.max(ls,oo):oo;Rs=wl(Ra,Rs),Rs=wl(Nr,Rs),Rs=wl(Nn,Rs);const gc=Rs>-1?1:0;Yt.glyphOffsetArray.length>=65535&&Za("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Aa.sortKey!==void 0&&Yt.addToSortKeyRanges(Yt.symbolInstances.length,Aa.sortKey),Yt.symbolInstances.emplaceBack(Fa.x,Fa.y,As.x,As.y,As.z,Li.right>=0?Li.right:-1,Li.center>=0?Li.center:-1,Li.left>=0?Li.left:-1,Li.vertical>=0?Li.vertical:-1,bi,Wo,_l,kr!==void 0?kr:Yt.collisionBoxArray.length,kr!==void 0?kr+1:Yt.collisionBoxArray.length,Jr!==void 0?Jr:Yt.collisionBoxArray.length,Jr!==void 0?Jr+1:Yt.collisionBoxArray.length,Qa!==void 0?Qa:Yt.collisionBoxArray.length,Qa!==void 0?Qa+1:Yt.collisionBoxArray.length,fn||Yt.collisionBoxArray.length,fn?fn+1:Yt.collisionBoxArray.length,In,zi,En,Kn,ci,gc,0,Xo,xl,Rs,0,yc?1:0,Un)})(r,sa,ta,vt,a,s,p,c,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Zt,ie,N,0,Pt,xt,K,e,m,R,T,V,O,Q,$,Et,de,Ee)};if(le==="line")for(const vt of Cg(e.geometry,0,0,Dt,Dt)){const sa=xz(vt,_t,At,a.vertical||ot,s,Me,ut,r.overscaling,Dt);for(const ua of sa)ot&&Rz(r,ot.text,zt,ua)||Jt(vt,ua,V)}else if(le==="line-center"){for(const vt of e.geometry)if(vt.length>1){const sa=_z(vt,At,a.vertical||ot,s,Me,ut);sa&&Jt(vt,sa,V)}}else if(e.type==="Polygon")for(const vt of vy(e.geometry,0)){const sa=bz(vt,16);Jt(vt[0],new Gh(sa.x,sa.y,0,0,void 0),V)}else if(e.type==="LineString")for(const vt of e.geometry)Jt(vt,new Gh(vt[0].x,vt[0].y,0,0,void 0),V);else if(e.type==="Point")for(const vt of e.geometry)for(const sa of vt)Jt([sa],new Gh(sa.x,sa.y,0,0,void 0),V)}const Fy=255,Uh=Fy*Pu;function r2(r,e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie){const le=function(Le,Ae,Me,Je,ot,We,ut,_t){const Zt=[];if(Ae.positionedLines.length===0)return Zt;const Pt=Je.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,At=function(Et){const Jt=Et[0],vt=Et[1],sa=Jt*vt;return sa>0?[Jt,-vt]:sa<0?[-Jt,vt]:Jt===0?[vt,Jt]:[vt,-Jt]}(Me);let xt=Math.abs(Ae.top-Ae.bottom);for(const Et of Ae.positionedLines)xt-=Et.lineOffset;const zt=Ae.positionedLines.length,nt=xt/zt;let rt=Ae.top-Me[1];for(let Et=0;Et<zt;++Et){const Jt=Ae.positionedLines[Et];rt=vz(Ae,nt,rt,Et);for(const vt of Jt.positionedGlyphs){if(!vt.rect)continue;const sa=vt.rect||{};let ua=R1+1,ta=!0,Yt=1,Fa=0;if(vt.image){const fa=ut.get(vt.image.toString());if(!fa)continue;if(fa.sdf){Za("SDF images are not supported in formatted text and will be ignored.");continue}ta=!1,Yt=fa.pixelRatio,ua=Rp/Yt}const ea=(ot||_t)&&vt.vertical,ja=vt.metrics.advance*vt.scale/2,Da=vt.metrics,nr=vt.rect;if(nr===null)continue;_t&&Ae.verticalizable&&(Fa=vt.image?ja-vt.metrics.width*vt.scale/2:0);const Zr=ot?[vt.x+ja,vt.y]:[0,0];let Pa=[0,0],Br=[0,0],Ir=!1;ot||(ea?(Br=[vt.x+ja+At[0],vt.y+At[1]-Fa],Ir=!0):Pa=[vt.x+ja+Me[0],vt.y+Me[1]-Fa]);const In=nr.w*vt.scale/(Yt*(vt.localGlyph?Gu:1)),je=nr.h*vt.scale/(Yt*(vt.localGlyph?Gu:1));let _e,ft,Xt,pt;if(ea){const fa=vt.y-rt,Xa=new St(-ja,ja-fa),Aa=-Math.PI/2,da=new St(...Br);_e=new St(-ja+Pa[0],Pa[1]),_e._rotateAround(Aa,Xa)._add(da),_e.x+=-fa+ja,_e.y-=(Da.left-ua)*vt.scale;const Vr=vt.image?Da.advance*vt.scale:os*vt.scale,tn=String.fromCodePoint(vt.glyph);az(tn)?_e.x+=(1-ua)*vt.scale:rz(tn)?_e.x+=Vr-Da.height*vt.scale+(-ua-1)*vt.scale:_e.x+=vt.image||Da.width+2*ua===nr.w&&Da.height+2*ua===nr.h?(Vr-je)/2:(Vr-(Da.height+2*ua)*vt.scale)/2,ft=new St(_e.x,_e.y-In),Xt=new St(_e.x+je,_e.y),pt=new St(_e.x+je,_e.y-In)}else{const fa=(Da.left-ua)*vt.scale-ja+Pa[0],Xa=(-Da.top-ua)*vt.scale+Pa[1],Aa=fa+In,da=Xa+je;_e=new St(fa,Xa),ft=new St(Aa,Xa),Xt=new St(fa,da),pt=new St(Aa,da)}if(Pt){let fa;fa=ot?new St(0,0):Ir?new St(At[0],At[1]):new St(Me[0],Me[1]),_e._rotateAround(Pt,fa),ft._rotateAround(Pt,fa),Xt._rotateAround(Pt,fa),pt._rotateAround(Pt,fa)}const $t=new St(0,0),pa=new St(0,0);Zt.push({tl:_e,tr:ft,bl:Xt,br:pt,texPrimary:sa,texSecondary:void 0,writingMode:Ae.writingMode,glyphOffset:Zr,sectionIndex:vt.sectionIndex,isSDF:ta,pixelOffsetTL:$t,pixelOffsetBR:pa,minFontScaleX:0,minFontScaleY:0})}}return Zt}(0,s,L,p,m,x,c,r.allowVerticalPlacement),de=r.textSizeData;let Ee=null;de.kind==="source"?(Ee=[Pu*p.layout.get("text-size").evaluate(x,{},$)*O.textScaleFactor],Ee[0]>Uh&&Za(`${r.layerIds[0]}: Value for "text-size" is >= ${Fy}. Reduce your "text-size".`)):de.kind==="composite"&&(Ee=[Pu*O.compositeTextSizes[0].evaluate(x,{},$)*O.textScaleFactor,Pu*O.compositeTextSizes[1].evaluate(x,{},$)*O.textScaleFactor],(Ee[0]>Uh||Ee[1]>Uh)&&Za(`${r.layerIds[0]}: Value for "text-size" is >= ${Fy}. Reduce your "text-size".`)),r.addSymbols(r.text,le,Ee,L,m,x,R,e,a,N.lineStartIndex,N.lineLength,F,Q,$,ie,!1,K,le.length);for(const Le of T)V[Le]=r.text.placedSymbolArray.length-1;return 4*le.length}function px(r){for(const e in r)return r[e];return null}function o0(r,e,a,s,c,p,m,x,L,N,R){let T,V,F,O;if(T=R?R.top:m.top,V=R?R.bottom:m.bottom,F=R?R.left:m.left,O=R?R.right:m.right,k1(m)&&m.collisionPadding){const Q=m.collisionPadding;F-=Q[0],T-=Q[1],O+=Q[2],V+=Q[3]}if(L){const Q=new St(F,T),$=new St(O,T),K=new St(F,V),ie=new St(O,V),le=fr(L);let de=new St(0,0);N&&(de=new St(N[0],N[1])),Q._rotateAround(le,de),$._rotateAround(le,de),K._rotateAround(le,de),ie._rotateAround(le,de),F=Math.min(Q.x,$.x,K.x,ie.x),O=Math.max(Q.x,$.x,K.x,ie.x),T=Math.min(Q.y,$.y,K.y,ie.y),V=Math.max(Q.y,$.y,K.y,ie.y)}return r.emplaceBack(e.x,e.y,e.z,a.x,a.y,F,T,O,V,x,s,c,p),r.length-1}function mx(r){k1(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Rz(r,e,a,s){const c=r.compareText;if(e in c){const p=c[e];for(let m=p.length-1;m>=0;m--)if(s.dist(p[m])<a)return!0}else c[e]=[];return c[e].push(s),!1}function n2(r,e){const a=r.fovAboveCenter,s=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,c=(r._camera.position[2]*r.worldSize-s)/Math.cos(r._pitch),p=Math.sin(a)*c/Math.sin(Math.max(Math.PI/2-r._pitch-a,.01));let m=Math.sin(r._pitch)*p+c;const x=c*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let L=Math.max(r.zoom-17,0);r.isOrthographic&&(L/=10),m*=1+L}return Math.min(1.01*m,x)}function Oy(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const a=Math.pow(2,-r.z),s=r.x*a,c=(r.x+1)*a,p=r.y*a,m=(r.y+1)*a,x=he(s),L=he(c),N=ce(p),R=ce(m),T=e.project(x,N),V=e.project(L,N),F=e.project(L,R),O=e.project(x,R);let Q=Math.min(T.x,V.x,F.x,O.x),$=Math.min(T.y,V.y,F.y,O.y),K=Math.max(T.x,V.x,F.x,O.x),ie=Math.max(T.y,V.y,F.y,O.y);const le=a/16;function de(Le,Ae,Me,Je,ot,We){const ut=(Me+ot)/2,_t=(Je+We)/2,Zt=e.project(he(ut),ce(_t)),Pt=Math.max(0,Q-Zt.x,$-Zt.y,Zt.x-K,Zt.y-ie);Q=Math.min(Q,Zt.x),K=Math.max(K,Zt.x),$=Math.min($,Zt.y),ie=Math.max(ie,Zt.y),Pt>le&&(de(Le,Zt,Me,Je,ut,_t),de(Zt,Ae,ut,_t,ot,We))}de(T,V,s,p,c,p),de(V,F,c,p,c,m),de(F,O,c,m,s,m),de(O,T,s,m,s,p),Q-=le,$-=le,K+=le,ie+=le;const Ee=1/Math.max(K-Q,ie-$);return{scale:Ee,x:Q*Ee,y:$*Ee,x2:K*Ee,y2:ie*Ee,projection:e}}function i2(r,{x:e,y:a},s=0){return new St(((e-s)*r.scale-r.x)*Dt,(a*r.scale-r.y)*Dt)}const Tz=pe(new Float32Array(16));class Df{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,a){return{x:0,y:0,z:0}}unproject(e,a){return new C(0,0)}projectTilePoint(e,a,s){return{x:e,y:a,z:0}}locationPoint(e,a,s,c=!0){return e._coordinatePoint(e.locationCoordinate(a,s),c)}pixelsPerMeter(e,a){return se(1,e)*a}pixelSpaceConversion(e,a,s){return 1}farthestPixelDistance(e){return n2(e,e.pixelsPerMeter)}pointCoordinate(e,a,s,c){const p=e.horizonLineFromTop(!1),m=new St(a,Math.max(p,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,c))}pointCoordinate3D(e,a,s){const c=new St(a,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const p=this.pointCoordinate(e,c.x,c.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,a){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,a.x,a.y);const s=e.horizonLineFromTop();return a.y<s}createInversionMatrix(e,a){return Tz}createTileMatrix(e,a,s){let c,p,m;const x=s.canonical,L=pe(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=Oy(x,this);c=1,p=N.x+s.wrap*N.scale,m=N.y,$e(L,L,[c/N.scale,c/N.scale,e.pixelsPerMeter/a])}else c=a/e.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*s.wrap)*c,m=x.y*c;return ye(L,L,[p,m,0]),$e(L,L,[c/Dt,c/Dt,1]),L}upVector(e,a,s){return[0,0,1]}upVectorScale(e,a,s){return{metersToTile:1}}}class Vz extends Df{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[a,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(fr(a));this.n=(c+Math.sin(fr(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,a){const{n:s,c,r0:p}=this,m=fr(e-this.center[0]),x=fr(a),L=Math.sqrt(c-2*s*Math.sin(x))/s;return{x:L*Math.sin(m*s),y:L*Math.cos(m*s)-p,z:0}}unproject(e,a){const{n:s,c,r0:p}=this,m=p+a;let x=Math.atan2(e,Math.abs(m))*Math.sign(m);m*s<0&&(x-=Math.PI*Math.sign(e)*Math.sign(m));const L=fr(this.center[0])*s;x=Ve(x,-Math.PI-L,Math.PI-L);const N=re(Vi(x/s)+this.center[0],-180,180),R=Math.asin(re((c-(e*e+m*m)*s*s)/(2*s),-1,1)),T=re(Vi(R),-me,me);return new C(N,T)}}const Dy=1.340264,Cy=-.081106,Py=893e-6,Gy=.003796,l0=Math.sqrt(3)/2;class Mz extends Df{project(e,a){a=a/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(l0*Math.sin(a)),c=s*s,p=c*c*c;return{x:.5*(e*Math.cos(s)/(l0*(Dy+3*Cy*c+p*(7*Py+9*Gy*c)))/Math.PI+.5),y:1-.5*(s*(Dy+Cy*c+p*(Py+Gy*c))/Math.PI+1),z:0}}unproject(e,a){e=(2*e-.5)*Math.PI;let s=a=(2*(1-a)-1)*Math.PI,c=s*s,p=c*c*c;for(let R,T,V,F=0;F<12&&(T=s*(Dy+Cy*c+p*(Py+Gy*c))-a,V=Dy+3*Cy*c+p*(7*Py+9*Gy*c),R=T/V,s=re(s-R,-Math.PI/3,Math.PI/3),c=s*s,p=c*c*c,!(Math.abs(R)<1e-12));++F);const m=l0*e*(Dy+3*Cy*c+p*(7*Py+9*Gy*c))/Math.cos(s),x=Math.asin(Math.sin(s)/l0),L=re(180*m/Math.PI,-180,180),N=re(180*x/Math.PI,-me,me);return new C(L,N)}}class Bz extends Df{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,a){return{x:.5+e/360,y:.5-a/360,z:0}}unproject(e,a){const s=360*(e-.5),c=re(360*(.5-a),-me,me);return new C(s,c)}}const Nm=Math.PI/2;function c0(r){return Math.tan((Nm+r)/2)}class Iz extends Df{constructor(e){super(e),this.center=e.center||[0,30];const[a,s]=this.parallels=e.parallels||[30,30];let c=fr(a),p=fr(s);this.southernCenter=c+p<0,this.southernCenter&&(c=-c,p=-p);const m=Math.cos(c),x=c0(c);this.n=c===p?Math.sin(c):Math.log(m/Math.cos(p))/Math.log(c0(p)/x),this.f=m*Math.pow(c0(c),this.n)/this.n}project(e,a){a=fr(a),this.southernCenter&&(a=-a),e=fr(e-this.center[0]);const s=1e-6,{n:c,f:p}=this;p>0?a<-Nm+s&&(a=-Nm+s):a>Nm-s&&(a=Nm-s);const m=p/Math.pow(c0(a),c);let x=m*Math.sin(c*e),L=p-m*Math.cos(c*e);return x=.5*(x/Math.PI+.5),L=.5*(L/Math.PI+.5),{x,y:this.southernCenter?L:1-L,z:0}}unproject(e,a){e=(2*e-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:s,f:c}=this,p=c-a,m=Math.sign(p),x=Math.sign(s)*Math.sqrt(e*e+p*p);let L=Math.atan2(e,Math.abs(p))*m;p*s<0&&(L-=Math.PI*Math.sign(e)*m);const N=re(Vi(L/s)+this.center[0],-180,180),R=re(Vi(2*Math.atan(Math.pow(c/x,1/s))-Nm),-me,me);return new C(N,this.southernCenter?-R:R)}}class s2 extends Df{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,a){return{x:ne(e),y:ae(a),z:0}}unproject(e,a){const s=he(e),c=ce(a);return new C(s,c)}}const o2=fr(me);class kz extends Df{project(e,a){const s=(a=fr(a))*a,c=s*s;return{x:.5*((e=fr(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,a){e=(2*e-.5)*Math.PI;let s=a=(2*(1-a)-1)*Math.PI,c=25,p=0,m=s*s;do{m=s*s;const N=m*m;p=(s*(1.007226+m*(.015085+N*(.028874*m-.044475-.005916*N)))-a)/(1.007226+m*(.045255+N*(.259866*m-.311325-.005916*11*N))),s=re(s-p,-o2,o2)}while(Math.abs(p)>1e-6&&--c>0);m=s*s;const x=re(Vi(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),L=Vi(s);return new C(x,L)}}const l2=fr(me);class Jz extends Df{project(e,a){a=fr(a),e=fr(e);const s=Math.cos(a),c=2/Math.PI,p=Math.acos(s*Math.cos(e/2)),m=Math.sin(p)/p,x=.5*(e*c+2*s*Math.sin(e/2)/m)||0,L=.5*(a+Math.sin(a)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(L/Math.PI+1),z:0}}unproject(e,a){let s=e=(2*e-.5)*Math.PI,c=a=(2*(1-a)-1)*Math.PI,p=25;const m=1e-6;let x=0,L=0;do{const N=Math.cos(c),R=Math.sin(c),T=2*R*N,V=R*R,F=N*N,O=Math.cos(s/2),Q=Math.sin(s/2),$=2*O*Q,K=Q*Q,ie=1-F*O*O,le=ie?1/ie:0,de=ie?Math.acos(N*O)*Math.sqrt(1/ie):0,Ee=.5*(2*de*N*Q+2*s/Math.PI)-e,Le=.5*(de*R+c)-a,Ae=.5*le*(F*K+de*N*O*V)+1/Math.PI,Me=le*($*T/4-de*R*Q),Je=.125*le*(T*Q-de*R*F*$),ot=.5*le*(V*O+de*K*N)+.5,We=Me*Je-ot*Ae;x=(Le*Me-Ee*ot)/We,L=(Ee*Je-Le*Ae)/We,s=re(s-x,-Math.PI,Math.PI),c=re(c-L,-l2,l2)}while((Math.abs(x)>m||Math.abs(L)>m)&&--p>0);return new C(Vi(s),Vi(c))}}class c2 extends Df{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,a){const{scale:s,cosPhi:c}=this;return{x:fr(e)*c*s+.5,y:-Math.sin(fr(a))/c*s+.5,z:0}}unproject(e,a){const{scale:s,cosPhi:c}=this,p=-(a-.5)/s,m=re(Vi((e-.5)/s)/c,-180,180),x=Math.asin(re(p*c,-1,1)),L=re(Vi(x),-me,me);return new C(m,L)}}class Fz extends s2{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,a,s){const c=rr(e,a,s);return ln(c,c,Tr(Wa(s))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,a,s){const c=A(a.lat,a.lng),p=ka([],c),m=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(a),e._centerAltitude):e._centerAltitude;ba(c,c,p,se(1,0)*Dt*m);const x=pe(new Float64Array(16));return ke(x,e.pixelMatrix,e.globeMatrix),ln(c,c,x),new St(c[0],c[1])}pixelsPerMeter(e,a){return se(1,0)*a}pixelSpaceConversion(e,a,s){const c=se(1,e)*a,p=Sa(se(1,45)*a,c,s);return this.pixelsPerMeter(e,a)/p}createTileMatrix(e,a,s){const c=ss(Wa(s.canonical));return ke(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,a){const{center:s}=e,c=Tr(Wa(a));return Te(c,c,fr(s.lng)),De(c,c,fr(s.lat)),$e(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,a,s,c){return _a(e,a,s,!0)||new Pe(0,0)}pointCoordinate3D(e,a,s){const c=this.pointCoordinate(e,a,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,a){return!_a(e,a.x,a.y,!1)}farthestPixelDistance(e){const a=function(c,p){const m=c.cameraToCenterDistance,x=c._centerAltitude*p,L=c._camera,N=c._camera.forward(),R=Lt([],Be([],N,-m),[0,0,x]),T=c.worldSize/(2*Math.PI),V=[0,0,-T],F=c.width/c.height,O=Math.tan(c.fovAboveCenter),Q=Be([],L.up(),O),$=Be([],L.right(),O*F),K=ka([],Lt([],Lt([],N,Q),$)),ie=[];let le;if(new Ua(R,K).closestPointOnSphere(V,T,ie)){const de=Lt([],ie,V),Ee=Sr([],de,R);le=Math.cos(c.fovAboveCenter)*ht(Ee)}else{const de=Sr([],R,V),Ee=Sr([],V,R);ka(Ee,Ee);const Le=ht(de)-T;le=Math.sqrt(Le*(Le+2*T));const Ae=Math.acos(le/(T+Le))-Math.acos(gr(N,Ee));le*=Math.cos(Ae)}return 1.01*le}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=kf(e.zoom);if(s>0){const c=n2(e,se(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Sa(a,c+p*(1-Math.cos(m)),Math.pow(s,10))}return a}upVector(e,a,s){return rr(a,s,e,1)}upVectorScale(e){return{metersToTile:ga(xr(Wa(e)))}}}function u2(r){const e=r.parallels,a=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new s2(r);case"equirectangular":return new Bz(r);case"naturalEarth":return new kz(r);case"equalEarth":return new Mz(r);case"winkelTripel":return new Jz(r);case"albers":return a?new c2(r):new Vz(r);case"lambertConformalConic":return a?new c2(r):new Iz(r);case"globe":return new Fz(r)}throw new Error(`Invalid projection name: ${r.name}`)}const Oz=jt.types,Dz=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uy(r,e,a,s,c,p,m,x,L,N,R,T,V){const F=x?Math.min(Uh,Math.round(x[0])):0,O=x?Math.min(Uh,Math.round(x[1])):0;r.emplaceBack(e,a,Math.round(32*s),Math.round(32*c),p,m,(F<<1)+(L?1:0),0+(O<<1),16*N,16*R,256*T,256*V)}function Wy(r,e,a){r.emplaceBack(e,a)}function Xy(r,e,a,s,c,p,m){r.emplaceBack(e,a,s,c,p,m)}const u0=(r,e,a,s)=>{for(let c=0;c<e;c++)r.emplaceBack(a[0],a[1],a[2],s[0],s[1],s[2])};function Em(r,e,a,s,c){r.emplaceBack(e,a,s,c),r.emplaceBack(e,a,s,c),r.emplaceBack(e,a,s,c),r.emplaceBack(e,a,s,c)}function Cz(r){for(const e of r.sections)if(xf(e.text))return!0;return!1}class yx{constructor(e){this.layoutVertexArray=new Ef,this.indexArray=new gn,this.programConfigurations=e,this.segments=new Ar,this.dynamicLayoutVertexArray=new uc,this.opacityVertexArray=new Sf,this.placedSymbolArray=new Bd,this.iconTransitioningVertexArray=new bo,this.globeExtVertexArray=new Mu,this.zOffsetVertexArray=new pl,this.orientationVertexArray=new Tf,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,a){const s=[],c=this.layoutVertexArray.uint16;for(let p=0;p<a;++p){const m=12*(e+p);s.push(...c.slice(m,m+12))}return s}updateIconVertexData(e,a,s,c,p,m,x,L,N,R,T,V,F){const O=this.layoutVertexArray.uint16,Q=12*e;O[Q]=a,O[Q+1]=s,O[Q+2]=c,O[Q+3]=p,O[Q+4]=m,O[Q+5]=x,O[Q+6]=L,O[Q+7]=N,O[Q+8]=R,O[Q+9]=T,O[Q+10]=V,O[Q+11]=F}upload(e,a,s,c,p,m){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WS.members,!!m),this.indexBuffer=e.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,QS.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Dz,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,$S.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,XS.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,HS.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,YS.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}na(yx,"SymbolBuffers");class gx{constructor(e,a,s){this.layoutVertexArray=new e,this.layoutAttributes=a,this.indexArray=new s,this.segments=new Ar,this.collisionVertexArray=new Wi,this.collisionVertexArrayExt=new uc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qS.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,KS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}na(gx,"CollisionBuffers");class d0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pe([]),this.placementViewportMatrix=pe([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=bm(this.zoom,a["text-size"],this.worldview),this.iconSizeData=bm(this.zoom,a["icon-size"],this.worldview);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.lut=e.lut,this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>gl[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const a=this.layers[0].getAppearances();return!(!a||a.length===0)&&a.some(s=>s.getProperty(e)!=null)}createArrays(){this.text=new yx(new io(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new yx(new io(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new xp,this.lineVertexArray=new wp,this.symbolInstances=new kl}calculateGlyphDependencies(e,a,s,c,p){for(const m of e){const x=m.codePointAt(0);if(x===void 0)break;if(a[x]=!0,c&&p&&x<=65535){const L=My[m];L&&(a[L.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,a,s,c,p,m){let x=1;const L=e.getUnevaluatedProperties()._values["icon-size"],N=bm(this.zoom,L,this.worldview),R=Lm(N,a);if(N.kind!=="constant"&&N.kind!=="camera"||(x=R.uSize),N.kind==="composite"){const{minZoom:T,maxZoom:V}=N,F=L.possiblyEvaluate(new $r(T,{worldview:this.worldview}),c),O=L.possiblyEvaluate(new $r(V,{worldview:this.worldview}),c),Q=F.evaluate(s,{},c,p);x=Q+(O.evaluate(s,{},c,p)-Q)*R.uSizeT}return N.kind==="source"&&(x=L.possiblyEvaluate(new $r(this.zoom,{worldview:this.worldview}),c).evaluate(s,{},c,p)),x*m}updateFootprints(e,a){}updateReplacement(e,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const s=a.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Fg(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?Is.build(e):e}populate(e,a,s,c){const p=this.layers[0],m=p.layout,x=this.projection.name==="globe",L=m.get("text-font"),N=m.get("text-field"),R=m.get("icon-image"),[T,V]=m.get("icon-size-scale-range"),F=re(a.scaleFactor||1,T,V),O=(N.value.kind!=="constant"||N.value.value instanceof Bi&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),Q=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,$=this.hasAnyAppearanceProperty("icon-image"),K=m.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!O&&!Q&&!$)return;const ie=a.iconDependencies,le=a.glyphDependencies,de=a.availableImages,Ee=new $r(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Le=Ae=>{const Me=Ae.id.toString();ie.has(Me)?ie.get(Me).push(Ae):ie.set(Me,[Ae])};for(const Ae of e){const{feature:Me,id:Je,index:ot,sourceLayerIndex:We}=Ae,ut=p._featureFilter.needGeometry,_t=et(Me,ut);if(!p._featureFilter.filter(Ee,_t,s))continue;if(ut||(_t.geometry=ct(Me,s,c)),x&&Me.type!==1&&s.z<=5){const Et=_t.geometry,Jt=.98078528056,vt=(sa,ua)=>gr(rr(sa.x,sa.y,s,1),rr(ua.x,ua.y,s,1))<Jt;for(let sa=0;sa<Et.length;sa++)Et[sa]=dt(Et[sa],vt)}let Zt,Pt;if(O){const Et=p.getValueAndResolveTokens("text-field",_t,s,de),Jt=Bi.factory(Et);Cz(Jt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ui()==="unavailable"||this.hasRTLText&&ns.isParsed())&&(Zt=tz(Jt,p,_t))}if(Q){const Et=p.getValueAndResolveTokens("icon-image",_t,s,de);Pt=this.getResolvedImageFromTokens(Et)}const At=this.layers[0];let xt=!1;if(!Pt&&$){const Et=At.getAppearances();for(const Jt of Et)if(Jt.getProperty("icon-image")){const vt=At.getAppearanceValueAndResolveTokens(Jt,"icon-image",_t,s,de);if(vt){Pt=this.getResolvedImageFromTokens(vt),xt=!0;break}}}if(!Zt&&!Pt)continue;const zt=this.sortFeaturesByKey?K.evaluate(_t,{},s):void 0,nt={id:Je,text:Zt,icon:Pt,index:ot,sourceLayerIndex:We,geometry:_t.geometry,properties:Me.properties,type:Oz[Me.type],sortKey:zt};if(this.features.push(nt),this.appearanceFeatureData.push({id:Je,properties:Me.properties,usesAppearanceIconAsPlaceholder:xt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Pt){const Et=At._unevaluatedLayout._values,{iconPrimary:Jt,iconSecondary:vt}=Jy(Pt,this.iconSizeData,Et["icon-size"],s,this.zoom,nt,this.pixelRatio,F,this.worldview);Le(Jt),vt&&(this.hasAnySecondaryIcon=!0,Le(vt))}const rt=At.getAppearances();if(rt.length!==0&&rt.forEach(Et=>{if(!Et.getProperty("icon-image"))return;const Jt=this.getCombinedIconPrimary(Et,At,_t,s,de,nt,F);Jt&&Le(Jt)}),Zt){const Et=L.evaluate(_t,{},s).join(","),Jt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(gl.vertical)>=0;for(const vt of Zt.sections)if(vt.image){const sa=vt.image.getPrimary().scaleSelf(this.pixelRatio),ua=sa.id.toString(),ta=ie.get(ua)||[];ta.push(sa),ie.set(ua,ta)}else{const sa=Eu(Zt.toString()),ua=vt.fontStack||Et,ta=le[ua]=le[ua]||{};this.calculateGlyphDependencies(vt.text,ta,Jt,this.allowVerticalPlacement,sa)}}}if(m.get("symbol-placement")==="line"&&(this.features=function(Ae){const Me={},Je={},ot=[];let We=0;function ut(At){ot.push(Ae[At]),We++}function _t(At,xt,zt){const nt=Je[At];return delete Je[At],Je[xt]=nt,ot[nt].geometry[0].pop(),ot[nt].geometry[0]=ot[nt].geometry[0].concat(zt[0]),nt}function Zt(At,xt,zt){const nt=Me[xt];return delete Me[xt],Me[At]=nt,ot[nt].geometry[0].shift(),ot[nt].geometry[0]=zt[0].concat(ot[nt].geometry[0]),nt}function Pt(At,xt,zt){const nt=zt?xt[0][xt[0].length-1]:xt[0][0];return`${At}:${nt.x}:${nt.y}`}for(let At=0;At<Ae.length;At++){const xt=Ae[At],zt=xt.geometry,nt=xt.text?xt.text.toString():null;if(!nt){ut(At);continue}const rt=Pt(nt,zt),Et=Pt(nt,zt,!0);if(rt in Je&&Et in Me&&Je[rt]!==Me[Et]){const Jt=Zt(rt,Et,zt),vt=_t(rt,Et,ot[Jt].geometry);delete Me[rt],delete Je[Et],Je[Pt(nt,ot[vt].geometry,!0)]=vt,ot[Jt].geometry=null}else rt in Je?_t(rt,Et,zt):Et in Me?Zt(rt,Et,zt):(ut(At),Me[rt]=We-1,Je[Et]=We-1)}return ot.filter(At=>At.geometry)}(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ae of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Ae.id,this.elevationFeatures.length),this.elevationFeatures.push(Ae)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ae,Me)=>Ae.sortKey-Me.sortKey)}getCombinedIconPrimary(e,a,s,c,p,m,x){let L,N;const R=e.getUnevaluatedProperties();if(R._values["icon-image"].value!==void 0){const T=a.getAppearanceValueAndResolveTokens(e,"icon-image",s,c,p);L=this.getResolvedImageFromTokens(T)}else{const T=a.getValueAndResolveTokens("icon-image",s,c,p);L=this.getResolvedImageFromTokens(T)}if(L){const T=R._values["icon-size"]||a._unevaluatedLayout._values["icon-size"];N=Jy(L,bm(this.zoom,T,this.worldview),T,c,this.zoom,m,this.pixelRatio,x,this.worldview).iconPrimary}return N}updateAppearanceBasedIconTextures(e,a,s,c){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const p=this.layers[0];let m=!1,x=0;const L=p.layout,[N,R]=L.get("icon-size-scale-range"),T=re(1,N,R);for(let V=0;V<this.symbolInstances.length;V++){const F=this.symbolInstances.get(V),O=this.appearanceFeatureData[F.featureIndex];if(O&&F.placedIconSymbolIndex>=0){const Q=O.id,$=a&&Q!==void 0?a[String(Q)]:void 0,K={type:"Point",id:O.id,properties:O.properties,geometry:[]},ie=this.layers[0].appearances&&this.layers[0].appearances.find(le=>le.isActive({globals:c,feature:K,canonical:e,featureState:$}));if(O.activeAppearance===ie)continue;if(ie){O.activeAppearance=ie;const le={sortKey:void 0,text:void 0,icon:null,index:F.featureIndex,sourceLayerIndex:F.featureIndex,geometry:[],properties:O.properties,type:"Point",id:O.id};if(!ie.hasCachedIconPrimary()){const Ae=this.getCombinedIconPrimary(ie,p,K,e,s,le,T);ie.setCachedIconPrimary(Ae)}const de=ie.getCachedIconPrimary();if(!de)continue;const Ee=de.toString(),Le=this.iconAtlasPositions&&this.iconAtlasPositions.get(Ee);if(Le){const Ae=p.getAppearanceValueAndResolveTokens(ie,"icon-offset",K,e,s),Me=Ae&&Array.isArray(Ae)?Ae:[0,0];let Je=t0(Le,void 0,Me,p.layout.get("icon-anchor").evaluate(K,{},e));const ot=p.getAppearanceValueAndResolveTokens(ie,"icon-rotate",K,e,s),We=typeof ot=="number"?ot:0,ut=Le.sdf,_t=p.layout.get("icon-text-fit").constantOr("none");_t!=="none"&&O.textShaping&&O.iconTextFitPadding&&O.fontScale&&(Je=ox(Je,O.textShaping,_t,O.iconTextFitPadding,Me,O.fontScale));const Zt=this.calculateEffectiveAppearanceIconSize(ie,c.zoom,K,e,s,T),Pt=0,At=1+(Math.min(Uh,Math.round(Zt*Pu))<<1),xt=dx(Je,We,ut,_t!=="none",T);O.isUsingAppearanceVertexData||(O.isUsingAppearanceVertexData=!0,O.layoutBasedVertexData=this.icon.getIconVertexData(x,F.numIconVertices));for(let nt=0;nt<xt.length;++nt){const rt=xt[nt],Et=O.layoutBasedVertexData[0]||F.tileAnchorX,Jt=O.layoutBasedVertexData[1]||F.tileAnchorY,vt=16*rt.pixelOffsetTL.x,sa=16*rt.pixelOffsetTL.y,ua=16*rt.pixelOffsetBR.x,ta=16*rt.pixelOffsetBR.y,Yt=16*rt.minFontScaleX,Fa=16*rt.minFontScaleY;this.icon.updateIconVertexData(x,Et,Jt,Math.round(32*rt.tl.x),Math.round(32*rt.tl.y),rt.texPrimary.x,rt.texPrimary.y,Pt,At,vt,sa,Yt,Fa),this.icon.updateIconVertexData(x+1,Et,Jt,Math.round(32*rt.tr.x),Math.round(32*rt.tr.y),rt.texPrimary.x+rt.texPrimary.w,rt.texPrimary.y,Pt,At,ua,sa,Yt,Fa),this.icon.updateIconVertexData(x+2,Et,Jt,Math.round(32*rt.bl.x),Math.round(32*rt.bl.y),rt.texPrimary.x,rt.texPrimary.y+rt.texPrimary.h,Pt,At,vt,ta,Yt,Fa),this.icon.updateIconVertexData(x+3,Et,Jt,Math.round(32*rt.br.x),Math.round(32*rt.br.y),rt.texPrimary.x+rt.texPrimary.w,rt.texPrimary.y+rt.texPrimary.h,Pt,At,ua,ta,Yt,Fa),x+=4}const zt=F.numIconVertices-4*xt.length;for(let nt=0;nt<zt;++nt)this.icon.updateIconVertexData(x+nt,0,0,0,0,0,0,0,0,0,0,0,0);m=!0}else x+=F.numIconVertices}else if(O.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(x,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+3,0,0,0,0,0,0,0,0,0,0,0,0),m=!0),x+=F.numIconVertices,O.activeAppearance=null;else if(O.isUsingAppearanceVertexData){const de=O.layoutBasedVertexData.length/12;for(let Ee=0;Ee<de;++Ee){const Le=Ee*12;this.icon.updateIconVertexData(x+Ee,O.layoutBasedVertexData[Le+0],O.layoutBasedVertexData[Le+1],O.layoutBasedVertexData[Le+2],O.layoutBasedVertexData[Le+3],O.layoutBasedVertexData[Le+4],O.layoutBasedVertexData[Le+5],O.layoutBasedVertexData[Le+6],O.layoutBasedVertexData[Le+7],O.layoutBasedVertexData[Le+8],O.layoutBasedVertexData[Le+9],O.layoutBasedVertexData[Le+10],O.layoutBasedVertexData[Le+11])}x+=de,O.isUsingAppearanceVertexData=!1,O.activeAppearance=null,m=!0}else x+=F.numIconVertices,O.activeAppearance=null}}return m}update(e,a,s,c,p,m,x){this.text.programConfigurations.updatePaintArrays(e,a,p,s,c,m,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,a,p,s,c,m,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const s=Se(e),c=1/s;let p=!1,m=!1;for(let x=0;x<this.symbolInstances.length;x++){const L=this.symbolInstances.get(x),N=Wt(1,0,0),R=Wt(0,1,0),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:V,numIconVertices:F,numVerticalIconVertices:O}=L,Q=T>0||V>0,$=F>0,K=this.elevationFeatures[L.elevationFeatureIndex];if(K){const ie=new St(L.tileAnchorX,L.tileAnchorY),le=.075+K.pointElevation(ie);L.zOffset!==le&&(a=!0,L.zOffset=le),le!==0&&(this.hasAnyZOffset=!0);const de=K.computeSlopeNormal(ie,c),Ee=us(Ko(),Wt(0,0,1),de);Xr(N,N,Ee),Xr(R,R,Ee),N[2]*=s,R[2]*=s,N[0]===1&&N[1]===0&&N[2]===0&&R[0]===0&&R[1]===1&&R[2]===0||(p=p||Q,m=m||$)}if(Q&&(u0(this.text.orientationVertexArray,T,N,R),u0(this.text.orientationVertexArray,V,N,R)),$){const{placedIconSymbolIndex:ie,verticalPlacedIconSymbolIndex:le}=L;ie>=0&&u0(this.icon.orientationVertexArray,F,N,R),le>=0&&u0(this.icon.orientationVertexArray,O,N,R)}}p||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,m,x)=>{s+=m,s>p.length&&p.resize(s);for(let L=-m;L<0;L++)p.emplace(L+s,x)},a=(p,m,x)=>{c+=m,c>p.length&&p.resize(c);for(let L=-m;L<0;L++)p.emplace(L+c,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,c=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:L,numIconVertices:N}=m,R=m.zOffset,T=N>0;if((x>0||L>0)&&(e(this.text.zOffsetVertexArray,x,R),e(this.text.zOffsetVertexArray,L,R)),T){const{placedIconSymbolIndex:V,verticalPlacedIconSymbolIndex:F}=m;V>=0&&a(this.icon.zOffsetVertexArray,N,R),F>=0&&a(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,a,s,c,p){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(m=>m.appearances&&m.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,a,s,c){return!!(e&&a&&s)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,a,s,c)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=u2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,a){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:p}of a)this.lineVertexArray.emplaceBack(c,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q,$,K,ie){const le=e.indexArray,de=e.layoutVertexArray,Ee=e.globeExtVertexArray,Le=e.segments.prepareSegment(4*ie,de,le,this.canOverlap?m.sortKey:void 0),Ae=this.glyphOffsetArray.length,Me=Le.vertexLength,Je=this.allowVerticalPlacement&&x===gl.vertical?Math.PI/2:0,ot=m.text&&m.text.sections;for(let _t=0;_t<a.length;_t++){const{tl:Zt,tr:Pt,bl:At,br:xt,texPrimary:zt,texSecondary:nt,pixelOffsetTL:rt,pixelOffsetBR:Et,minFontScaleX:Jt,minFontScaleY:vt,glyphOffset:sa,isSDF:ua,sectionIndex:ta}=a[_t],Yt=Le.vertexLength,Fa=sa[1];if(Uy(de,N.x,N.y,Zt.x,Fa+Zt.y,zt.x,zt.y,s,ua,rt.x,rt.y,Jt,vt),Uy(de,N.x,N.y,Pt.x,Fa+Pt.y,zt.x+zt.w,zt.y,s,ua,Et.x,rt.y,Jt,vt),Uy(de,N.x,N.y,At.x,Fa+At.y,zt.x,zt.y+zt.h,s,ua,rt.x,Et.y,Jt,vt),Uy(de,N.x,N.y,xt.x,Fa+xt.y,zt.x+zt.w,zt.y+zt.h,s,ua,Et.x,Et.y,Jt,vt),L){const{x:ea,y:ja,z:Da}=L.anchor,[nr,Zr,Pa]=L.up;Xy(Ee,ea,ja,Da,nr,Zr,Pa),Xy(Ee,ea,ja,Da,nr,Zr,Pa),Xy(Ee,ea,ja,Da,nr,Zr,Pa),Xy(Ee,ea,ja,Da,nr,Zr,Pa),Em(e.dynamicLayoutVertexArray,ea,ja,Da,Je)}else Em(e.dynamicLayoutVertexArray,N.x,N.y,N.z,Je);if($){const ea=nt||zt;Wy(e.iconTransitioningVertexArray,ea.x,ea.y),Wy(e.iconTransitioningVertexArray,ea.x+ea.w,ea.y),Wy(e.iconTransitioningVertexArray,ea.x,ea.y+ea.h),Wy(e.iconTransitioningVertexArray,ea.x+ea.w,ea.y+ea.h)}le.emplaceBack(Yt,Yt+1,Yt+2),le.emplaceBack(Yt+1,Yt+2,Yt+3),Le.vertexLength+=4,Le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(sa[0]),_t!==a.length-1&&ta===a[_t+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,m,m.index,{},F,O,Q,ot&&ot[ta],this.worldview)}const We=ie-a.length;We!==0&&this._addNullVertices(We,de,s,L,Ee,e,$,Le,le);const ut=L?L.anchor:N;e.placedSymbolArray.emplaceBack(ut.x,ut.y,ut.z,N.x,N.y,Ae,this.glyphOffsetArray.length-Ae,Me,R,T,N.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],x,0,0,0,V,0),e.symbolInstanceIndices.push(K)}_addNullVertices(e,a,s,c,p,m,x,L,N){for(let R=0;R<e;R++){for(let V=0;V<4;V++)Uy(a,0,0,0,0,0,0,s,!1,0,0,0,0),c&&Xy(p,0,0,0,0,0,0),Em(m.dynamicLayoutVertexArray,0,0,0,0),x&&Wy(m.iconTransitioningVertexArray,0,0);const T=L.vertexLength;N.emplaceBack(T,T+1,T+2),N.emplaceBack(T+1,T+2,T+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,a,s,c,p,m,x){e.emplaceBack(a,s,c,p,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,a,s,c,p,m,x){const L=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),N=L.vertexLength,R=x.tileAnchorX,T=x.tileAnchorY;for(let F=0;F<4;F++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,a,e.padding,x.zOffset),this._commitLayoutVertex(s.layoutVertexArray,c,p,m,R,T,new St(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,p,m,R,T,new St(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,p,m,R,T,new St(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,p,m,R,T,new St(e.x1,e.y2)),L.vertexLength+=4;const V=s.indexArray;V.emplaceBack(N,N+1),V.emplaceBack(N+1,N+2),V.emplaceBack(N+2,N+3),V.emplaceBack(N+3,N),L.primitiveLength+=4}_addTextDebugCollisionBoxes(e,a,s,c,p,m){for(let x=c;x<p;x++){const L=s.get(x),N=this.getSymbolInstanceTextSize(e,m,a,x);this._addCollisionDebugVertices(L,N,this.textCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,a,s,c,p,m){for(let x=c;x<p;x++){const L=s.get(x),N=this.getSymbolInstanceIconSize(e,a,m.placedIconSymbolIndex);this._addCollisionDebugVertices(L,N,this.iconCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,a,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gx(Af,E1.members,bo),this.iconCollisionBox=new gx(Af,E1.members,bo);const c=Lm(this.iconSizeData,e),p=Lm(this.textSizeData,e,s);for(let m=0;m<this.symbolInstances.length;m++){const x=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,e,a,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,e,a,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,a,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,a,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,a,s,c){const p=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:c),m=lx(this.textSizeData,e,p)/os;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,a,s){const c=this.icon.placedSymbolArray.get(s),p=lx(this.iconSizeData,e,c);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,a,s,c){e.emplaceBack(a,-s,-s,c),e.emplaceBack(a,s,-s,c),e.emplaceBack(a,s,s,c),e.emplaceBack(a,-s,s,c)}_updateTextDebugCollisionBoxes(e,a,s,c,p,m,x){for(let L=c;L<p;L++){const N=s.get(L),R=this.getSymbolInstanceTextSize(e,m,a,L);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,N.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,a,s,c,p,m,x){for(let L=c;L<p;L++){const N=s.get(L),R=this.getSymbolInstanceIconSize(e,a,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,N.padding,m.zOffset)}}updateCollisionDebugBuffers(e,a,s,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=Lm(this.iconSizeData,e,c),m=Lm(this.textSizeData,e,s);for(let x=0;x<this.symbolInstances.length;x++){const L=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(m,e,a,L.textBoxStartIndex,L.textBoxEndIndex,L,s),this._updateTextDebugCollisionBoxes(m,e,a,L.verticalTextBoxStartIndex,L.verticalTextBoxEndIndex,L,s),this._updateIconDebugCollisionBoxes(p,e,a,L.iconBoxStartIndex,L.iconBoxEndIndex,L,c),this._updateIconDebugCollisionBoxes(p,e,a,L.verticalIconBoxStartIndex,L.verticalIconBoxEndIndex,L,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,a,s,c,p,m,x,L,N){const R={};if(a<s){const{x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de,featureIndex:Ee}=e.get(a);R.textBox={x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de},R.textFeatureIndex=Ee}if(c<p){const{x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de,featureIndex:Ee}=e.get(c);R.verticalTextBox={x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de},R.verticalTextFeatureIndex=Ee}if(m<x){const{x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de,featureIndex:Ee}=e.get(m);R.iconBox={x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de},R.iconFeatureIndex=Ee}if(L<N){const{x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de,featureIndex:Ee}=e.get(L);R.verticalIconBox={x1:T,y1:V,x2:F,y2:O,padding:Q,projectedAnchorX:$,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:de},R.verticalIconFeatureIndex=Ee}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,a){const s=e.placedSymbolArray.get(a),c=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<c;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(e),s=Math.cos(e),c=[],p=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const L=this.symbolInstances.get(x);c.push(0|Math.round(a*L.tileAnchorX+s*L.tileAnchorY)),p.push(L.featureIndex)}return m.sort((x,L)=>c[x]-c[L]||p[L]-p[x]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,a){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const s=this.symbolInstances.get(a);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:N}=s;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const a=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let s;return this.elevationFeatures&&a<this.elevationFeatures.length&&(s=this.elevationFeatures[a]),s}}function d2(r,e){return e.replace(/{([^{}]+)}/g,(a,s)=>s in r?String(r[s]):"")}let h2,f2,_x;na(d0,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),d0.addDynamicAttributes=Em;class p2{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Sc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(e.formattedSection))return a.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}na(p2,"FormatSectionOverride",{omit:["defaultValue"]});const xx=()=>_x||(_x={layout:h2||(h2=new Mn({"symbol-placement":new Tt(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(Ue.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt(Ue.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(Ue.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt(Ue.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Kt(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(Ue.layout_symbol["icon-image"]),"icon-image-use-theme":new Tt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Kt(Ue.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(Ue.layout_symbol["icon-offset"]),"icon-anchor":new Kt(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(Ue.layout_symbol["text-field"]),"text-font":new Kt(Ue.layout_symbol["text-font"]),"text-size":new Kt(Ue.layout_symbol["text-size"]),"text-size-scale-range":new Tt(Ue.layout_symbol["text-size-scale-range"]),"text-max-width":new Kt(Ue.layout_symbol["text-max-width"]),"text-line-height":new Kt(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(Ue.layout_symbol["text-justify"]),"text-radial-offset":new Kt(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Kt(Ue.layout_symbol["text-anchor"]),"text-max-angle":new Tt(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(Ue.layout_symbol["text-rotate"]),"text-padding":new Tt(Ue.layout_symbol["text-padding"]),"text-keep-upright":new Tt(Ue.layout_symbol["text-keep-upright"]),"text-transform":new Kt(Ue.layout_symbol["text-transform"]),"text-offset":new Kt(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(Ue.layout_symbol["text-optional"]),visibility:new Tt(Ue.layout_symbol.visibility)})),paint:f2||(f2=new Mn({"icon-opacity":new Kt(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Kt(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Kt(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Kt(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new Kt(Ue.paint_symbol["icon-color"]),"icon-halo-color":new Kt(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Kt(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Kt(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new Kt(Ue.paint_symbol["text-color"],{runtimeType:Ys,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Kt(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(Ue.paint_symbol["text-halo-blur"]),"text-translate":new Tt(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt(Ue.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Kt(Ue.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},_x);class h0 extends gs{constructor(e,a,s,c){super(e,xx(),a,s,c,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=pe([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,a){super.recalculate(e,a),this.appearances&&this.appearances.forEach(c=>{c.recalculate(e,a,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const p of s)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,a,s,c){return this._saturation===e&&this._contrast===a&&this._brightnessMin===s&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(p,m,x,L){p=Vn(p),m=yn(m);const N=ue(),R=p/3,T=1-2*R,V=[T,R,R,0,R,T,R,0,R,R,T,0,0,0,0,1],F=.5-.5*m,O=L-x;return ke(N,[O,0,0,0,0,O,0,0,0,0,O,0,x,x,x,1],[m,0,0,0,0,m,0,0,0,0,m,0,F,F,F,1]),ke(N,N,V),N}(e,a,s,c),this._saturation=e,this._contrast=a,this._brightnessMin=s,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,a,s,c){const p=this.layout.get(e).evaluate(a,{},s,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Ld(m.value)||!p?p:d2(a.properties,p)}getAppearanceValueAndResolveTokens(e,a,s,c,p){const m=e.getProperty(a);if(!m)return;const x=m.evaluate(s,{},c,p),L=e.getUnevaluatedProperties()._values[a];return L.isDataDriven()||Ld(L.value)||!x||typeof x!="string"?x:d2(s.properties,x)}createBucket(e){return new d0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xx().paint.overridableProperties){if(!h0.hasPaintOverride(this.layout,e))continue;const a=this.paint.get(e),s=new p2(a),c=new bd(s,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let p=null;p=a.value.kind==="constant"||a.value.kind==="source"?new Zs("source",c):new ro("composite",c,a.value.zoomStops,a.value.interpolationType),this.paint._values[e]=new wi(a.property,p,a.parameters)}}_handleOverridablePaintPropertyUpdate(e,a,s){return!(!this.layout||a.isDataDriven()||s.isDataDriven())&&h0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,a){const s=e.get("text-field"),c=xx().paint.properties[a];let p=!1;const m=x=>{for(const L of x)if(c.overrides&&c.overrides.hasOverride(L))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Bi)m(s.value.value.sections);else if(s.value.kind==="source"){const x=N=>{p||(N instanceof Sl&&li(N.value)===uu?m(N.value.sections):N instanceof Ac?m(N.sections):N.eachChild(x))},L=s.value;L._styleExpression&&x(L._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,a,s){return{config:new hc(this,{zoom:a,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let m2,y2,g2,_2;var wx=tr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function f0(r,e,a,s,c,p,m,x){const L=[r,e,1,a,s,1,c,p,1],N=[m,x,1],R=Y([],L),[T,V,F]=bs(N,N,R);return X(L,L,[T,0,0,0,V,0,0,0,F])}function x2(r,e,a,s,c,p,m,x){const L=function(N,R,T,V,F,O,Q,$){const K=f0(0,0,1,0,1,1,0,1),ie=f0(N,R,T,V,F,O,Q,$);return X(ie,ie,Y([],K))}(r,e,a,s,c,p,m,x);return[L[2]/L[8]/Dt,L[5]/L[8]/Dt]}function p0(r){return[r[0],Math.min(Math.max(r[1],-me),me)]}class w2 extends Nl{constructor(e,a,s,c){super(),this.id=e,this.dispatcher=s,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=a,this._dirty=!1}load(e,a){if(this._loaded=a||!1,this.fire(new js("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=td(this.map._requestManager.transformRequest(this.url,rl.Image),(s,c)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new ad(s)):c&&(this.image=c instanceof HTMLImageElement?Qs.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Ry(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new js("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Ry||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=e[0][1],s=e[0][1];for(const p of e)p[1]>s&&(s=p[1]),p[1]<a&&(a=p[1]);const c=(s+a)/2;if(c>me?this.onNorthPole=!0:c<-me&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Pe.fromLngLat);this.tileID=function(m){let x=1/0,L=1/0,N=-1/0,R=-1/0;for(const Q of m)x=Math.min(x,Q.x),L=Math.min(L,Q.y),N=Math.max(N,Q.x),R=Math.max(R,Q.y);const T=Math.max(N-x,R-L),V=Math.max(0,Math.floor(-Math.log2(T))),F=Math.pow(2,V);let O=Math.floor((x+N)/2*F);return O>1&&(O-=1),new v(V,O,Math.floor((L+R)/2*F))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new js("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Ry||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const ie=this.tiles[K];ie.state!=="loaded"&&(ie.state="loaded",ie.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=Oy(new v(0,0,0),this.map.transform.projection),s=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const ie=K[1].x-K[0].x,le=K[1].y-K[0].y,de=K[2].x-K[1].x,Ee=K[2].y-K[1].y,Le=K[3].x-K[2].x,Ae=K[3].y-K[2].y,Me=K[0].x-K[3].x,Je=K[0].y-K[3].y,ot=ie*Ee-de*le,We=de*Ae-Le*Ee,ut=Le*Je-Me*Ae,_t=Me*le-ie*Je;return ot>0&&We>0&&ut>0&&_t>0||ot<0&&We<0&&ut<0&&_t<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=Oy(this.tileID,this.map.transform.projection),[p,m,x,L]=this.coordinates.map(K=>{const ie=c.projection.project(K[0],K[1]);return i2(c,ie)._round()});this.perspectiveTransform=x2(p.x,p.y,m.x,m.y,x.x,x.y,L.x,L.y);const N=this._boundsArray=new Es;N.emplaceBack(p.x,p.y,0,0),N.emplaceBack(m.x,m.y,Dt,0),N.emplaceBack(L.x,L.y,0,Dt),N.emplaceBack(x.x,x.y,Dt,Dt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(N,wx.members),this.boundsSegments=Ar.simpleSegment(0,0,4,2);const R=[],T=[p0((V=this.coordinates)[0]),p0(V[1]),p0(V[2]),p0(V[3])];var V;const[F,O,Q,$]=function(K){let ie=K[0][0],le=ie,de=K[0][1],Ee=de;for(let Le=1;Le<K.length;Le++)K[Le][0]<ie?ie=K[Le][0]:K[Le][0]>le&&(le=K[Le][0]),K[Le][1]<de?de=K[Le][1]:K[Le][1]>Ee&&(Ee=K[Le][1]);return[ie,de,le-ie,Ee-de]}(T);{const K=new Es,[ie,le,de,Ee]=function(xt){let zt=xt[0].x,nt=zt,rt=xt[0].y,Et=rt;for(let Jt=1;Jt<xt.length;Jt++)xt[Jt].x<zt?zt=xt[Jt].x:xt[Jt].x>nt&&(nt=xt[Jt].x),xt[Jt].y<rt?rt=xt[Jt].y:xt[Jt].y>Et&&(Et=xt[Jt].y);return[zt,rt,nt-zt,Et-rt]}(s),Le=xt=>[(xt.x-ie)/de,(xt.y-le)/Ee],[Ae,Me,Je,ot]=s.map(Le),We=function(xt,zt,nt,rt,Et,Jt,vt,sa){const ua=f0(0,0,1,0,1,1,0,1);return X(ua,ua,Y([],f0(xt,zt,nt,rt,Et,Jt,vt,sa)))}(Ae[0],Ae[1],Me[0],Me[1],Je[0],Je[1],ot[0],ot[1]);this.elevatedGlobePerspectiveTransform=x2(Ae[0],Ae[1],Me[0],Me[1],Je[0],Je[1],ot[0],ot[1]);const ut=(xt,zt)=>{R.push(xt.lng);const nt=Math.round((xt.lng-F)/Q*Dt),rt=Math.round((xt.lat-O)/$*Dt),Et=Le(zt),Jt=bs([],[Et[0],Et[1],1],We),vt=Math.round(Jt[0]/Jt[2]*Dt),sa=Math.round(Jt[1]/Jt[2]*Dt);K.emplaceBack(nt,rt,vt,sa)},_t=s[3].x-s[0].x,Zt=s[3].y-s[0].y,Pt=s[2].x-s[1].x,At=s[2].y-s[1].y;for(let xt=0;xt<65;xt++){const zt=xt/64,nt=[s[0].x+zt*_t,s[0].y+zt*Zt],rt=[s[1].x+zt*Pt,s[1].y+zt*At],Et=rt[0]-nt[0],Jt=rt[1]-nt[1];for(let vt=0;vt<65;vt++){const sa=vt/64,ua={x:nt[0]+Et*sa,y:nt[1]+Jt*sa};ut(a.projection.unproject(ua.x,ua.y),ua)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,wx.members)}{this.maxLongitudeTriangleSize=0;let K=[],ie=new gn;const le=(de,Ee,Le)=>{ie.emplaceBack(de,Ee,Le);const Ae=R[de],Me=R[Ee],Je=R[Le],ot=Math.min(Math.min(Ae,Me),Je),We=Math.max(Math.max(Ae,Me),Je)-ot;We>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=We),K.push(ot+We/2)};for(let de=0;de<64;de++)for(let Ee=0;Ee<64;Ee++){const Le=65*de+Ee,Ae=Le+1,Me=Le+65,Je=Me+1;le(Le,Me,Ae),le(Ae,Me,Je)}[K,ie]=function(de,Ee){const Le=Array.from({length:de.length},(Je,ot)=>ot);Le.sort((Je,ot)=>de[Je]-de[ot]);const Ae=[],Me=new gn;for(let Je=0;Je<Le.length;Je++){const ot=Le[Je];Ae.push(de[ot]);const We=3*ot,ut=We+1;Me.emplaceBack(Ee.uint16[We],Ee.uint16[ut],Ee.uint16[ut+1])}return[Ae,Me]}(K,ie),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ie)}this.elevatedGlobeSegments=Ar.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Q/Dt,0,$/Dt,0,0,O,F,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const a=this.map.painter.context,s=a.gl;!this._dirty||this.texture instanceof Ry||(this.texture?this.texture.update(this.image):(this.texture=new W_(a,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(a)}loadTile(e,a){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},a(null)):(e.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let c=(p=e+180)+360*Math.round((s[0]-p)/360);var p;const m=new Ar,x=(T,V)=>{m.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:a.segments[0].vertexLength,primitiveLength:V,sortKey:void 0,vaos:{}})},L=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-c)<=L){const T=Ka(s,0,s.length,c+L);return T===s.length||x(T,Pr(s,T+1,s.length,c+360-L)-T),m}c<s[0]&&(c+=360);const N=Pr(s,0,s.length,c-L);if(N===s.length)return x(0,s.length),m;x(0,N-0);const R=Ka(s,N+1,s.length,c+L);return R!==s.length&&x(R,s.length-R),m}}const Pz=(Math.pow(256,2)-1)/16907520;class v2 extends gs{constructor(e,a,s,c){super(e,{layout:g2||(g2=new Mn({visibility:new Tt(Ue.layout_raster.visibility)})),paint:_2||(_2=new Mn({"raster-opacity":new Tt(Ue.paint_raster["raster-opacity"]),"raster-color":new Su(Ue.paint_raster["raster-color"]),"raster-color-mix":new Tt(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(Ue.paint_raster["raster-saturation"]),"raster-contrast":new Tt(Ue.paint_raster["raster-contrast"]),"raster-resampling":new Tt(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt(Ue.paint_raster["raster-array-band"]),"raster-elevation":new Tt(Ue.paint_raster["raster-elevation"]),"raster-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},a,s,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof w2&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[s,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(c)||s===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=yy({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,c])}}let b2,L2,j2,Z2,N2;class E2 extends gs{constructor(e,a,s,c){super(e,{layout:b2||(b2=new Mn({visibility:new Tt(Ue["layout_raster-particle"].visibility)})),paint:L2||(L2=new Mn({"raster-particle-array-band":new Tt(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Su(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt(Ue["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},a,s,c),this._updateColorRamp(),this.lastInvalidatedAt=Qs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=yy({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Gz extends gs{constructor(e,a){super(e,{},a,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function vx(r,e,a){const s=[0,0,1],c=aa([]);return hr(c,c,a?-fr(r)+Math.PI:fr(r)),La(c,c,-fr(e)),Xr(s,s,c),ka(s,s)}const S2={None:0,Model:1,Symbol:2,FillExtrusion:4};class m0{constructor(e,a,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),a!=null&&a.__line__&&(this.line=a.__line__)}}function bx(r,e){const a=r.indexOf("://")===-1;try{return new URL(r,a&&e?"http://example.com":void 0),!0}catch{return!1}}class z2{constructor(e,a){this.feature=e,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class A2{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Vd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const a=16*e,s=this.instancedDataArray.float32;let c=Math.floor(s[a+2]);const p=1.05*(s[a+2]-c);return c/=100,[s[a]%1*1.05,s[a+1]%1*1.05,p,c]}tileCoordinatesForInstance(e){const a=16*e,s=this.instancedDataArray.float32;let c=s[a+0];return c=c>Dt?c-Dt:c,new St(Math.trunc(c),Math.trunc(s[a+1]))}translationForInstance(e){const a=16*e,s=this.instancedDataArray.float32;return[s[a+4],s[a+5],s[a+6]]}rotationScaleForInstance(e){const a=16*e,s=this.instancedDataArray.float32;return[s[a+7],s[a+8],s[a+9],s[a+10],s[a+11],s[a+12],s[a+13],s[a+14],s[a+15]]}transformForInstance(e){const a=16*e,s=this.instancedDataArray.float32;return[s[a+7],s[a+8],s[a+9],s[a+4],s[a+10],s[a+11],s[a+12],s[a+5],s[a+13],s[a+14],s[a+15],s[a+6],0,0,0,1]}}class Lx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,a){}updateAppearances(e,a,s,c){}populate(e,a,s,c){this.tileToMeter=Se(s);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:x,index:L,sourceLayerIndex:N}of e){const R=x??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),T=et(m,p);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),T,s))continue;const V={id:R,sourceLayerIndex:N,index:L,geometry:p?T.geometry:ct(m,s,c),properties:m.properties,type:m.type,patterns:{}},F=this.addFeature(V,V.geometry,T);F&&a.featureIndex.insert(m,V.geometry,L,N,this.index,this.instancesPerModel[F].instancedDataArray.length,Dt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,a=this.layers[0].scope;let s=0;for(const c of this.modelUris){const p=e.getModel(c,a);if(!p)continue;const m=this.instancesPerModel[c];if(m){const x=.5*lr(p.aabb.max,p.aabb.min)*m.maxScale+m.maxXYTranslationDistance,L=Math.min(Dt,Math.max(x/this.tileToMeter,Dt/32));s=Math.max(L,s)}}return s}update(e,a,s,c){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const x in e)m.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(m.features[m.idToFeaturesIndex[x]],e[x],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const a in this.instancesPerModel){const s=this.instancesPerModel[a];for(const c of s.features){const p=this.layers[0],m=c.feature,x=this.canonical,L=p.paint.get("model-rotation").evaluate(m,{},x),N=p.paint.get("model-scale").evaluate(m,{},x),R=p.paint.get("model-translation").evaluate(m,{},x);rn(c.rotation,L)&&rn(c.scale,N)&&rn(c.translation,R)||(this.evaluate(c,c.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,a,s,c){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const p=a.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Fg(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const x in this.instancesPerModel){const L=this.instancesPerModel[x],N=L.instancedDataArray;for(const R of L.features){const T=R.instancedDataOffset,V=R.instancedDataCount;for(let F=0;F<V;F++){const O=16*(F+T);let Q=N.float32[O+0];const $=Q>Dt;Q=$?Q-Dt:Q;const K=Math.floor(Q),ie=Math.floor(N.float32[O+1]);let le=!1;for(const de of this.activeReplacements)if(!mb(de,s,S2.Model,c)&&!(de.min.x>K||K>de.max.x||de.min.y>ie||ie>de.max.y)&&(le=M_(xb(K,ie,e.canonical,de.footprintTileId.canonical),de.footprint),le))break;N.float32[O]=le?Q+Dt:Q,m=m||le!==$}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const a in this.instancesPerModel){const s=this.instancesPerModel[a];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,gS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const s=this.instancesPerModel[a];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)e.removeModel(a,"",!0)}addFeature(e,a,s){const c=this.layers[0],p=c.layout.get("model-id").evaluate(s,{},this.canonical);if(!p)return Za(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),p;(bx(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new A2);const m=this.instancesPerModel[p],x=m.instancedDataArray,L=new z2(s,x.length);for(const N of a)for(const R of N){if(R.x<0||R.x>=Dt||R.y<0||R.y>=Dt)continue;if(this.lookupDim!==0){const V=(this.lookupDim-1)/Dt,F=this.lookupDim*(R.y*V|0)+R.x*V|0;if(this.lookup){if(this.lookup[F]!==0)continue;this.lookup[F]=1}}this.instanceCount++;const T=x.length;x.resize(T+1),m.instancesEvaluatedElevation.push(0),x.float32[16*T]=R.x,x.float32[16*T+1]=R.y}return L.instancedDataCount=m.instancedDataArray.length-L.instancedDataOffset,L.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(L),this.evaluate(L,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(e,a,s,c){const p=this.layers[0],m=e.feature,x=this.canonical,L=e.rotation=p.paint.get("model-rotation").evaluate(m,a,x),N=e.scale=p.paint.get("model-scale").evaluate(m,a,x),R=e.translation=p.paint.get("model-translation").evaluate(m,a,x),T=Object.assign({},p.paint.get("model-color").evaluate(m,a,x));T.a=p.paint.get("model-color-mix-intensity").evaluate(m,a,x);const V=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]);const F=R[0]*R[0]+R[1]*R[1],O=F>0?Math.sqrt(F):0;s.maxScale=Math.max(Math.max(s.maxScale,N[0]),Math.max(N[1],N[2])),s.maxXYTranslationDistance=Math.max(s.maxXYTranslationDistance,O),this.maxScale=Math.max(Math.max(this.maxScale,N[0]),Math.max(N[1],N[2])),i1(V,L,N);const Q=Math.round(100*T.a)+T.b/1.05;for(let $=0;$<e.instancedDataCount;++$){const K=e.instancedDataOffset+$,ie=16*K,le=s.instancedDataArray.float32;let de=0;c&&(de=le[ie+6]-s.instancesEvaluatedElevation[K]);const Ee=0|le[ie+1];le[ie]=(0|le[ie])+T.r/1.05,le[ie+1]=Ee+T.g/1.05,le[ie+2]=Q,le[ie+3]=1/(x.z>10?this.tileToMeter:Se(x,Ee)),le[ie+4]=R[0],le[ie+5]=R[1],le[ie+6]=R[2]+de,le[ie+7]=V[0],le[ie+8]=V[1],le[ie+9]=V[2],le[ie+10]=V[4],le[ie+11]=V[5],le[ie+12]=V[6],le[ie+13]=V[8],le[ie+14]=V[9],le[ie+15]=V[10],s.instancesEvaluatedElevation[K]=R[2]}}}let R2,T2;na(Lx,"ModelBucket",{omit:["layers"]}),na(A2,"PerModelAttributes"),na(z2,"ModelFeature");class Sm{constructor(e,a,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=a,this._offset=s}static create(e,a,s){const c=s||e.findDEMTileFor(a);if(!c||!c.dem)return;const p=c.dem,m=c.tileID,x=1<<a.canonical.z-m.canonical.z;return new Sm(c,p.dim/Dt/x,[(a.canonical.x/x-m.canonical.x)*p.dim,(a.canonical.y/x-m.canonical.y)*p.dim])}tileCoordToPixel(e,a){const s=a*this._scale+this._offset[1];return new St(Math.floor(e*this._scale+this._offset[0]),Math.floor(s))}getElevationAt(e,a,s,c){const p=e*this._scale+this._offset[0],m=a*this._scale+this._offset[1],x=Math.floor(p),L=Math.floor(m),N=this._dem;return c=!!c,s?Sa(Sa(N.get(x,L,c),N.get(x,L+1,c),m-L),Sa(N.get(x+1,L,c),N.get(x+1,L+1,c),m-L),p-x):N.get(x,L,c)}getElevationAtPixel(e,a,s){return this._dem.get(e,a,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*se(1,e)*this._dem.stride}}const jx=new Float32Array(262144),Tp=new Uint8Array(262144);function V2(r){let e=0;if(r.meshes)for(const a of r.meshes)e=Math.max(e,a.aabb.max[2]);if(r.children)for(const a of r.children)e=Math.max(e,V2(a));return e}function M2(r,e,a){if(r.meshes)for(const s of r.meshes){if(s.aabb.min[0]===1/0)continue;const c=Ca.applyTransform(s.aabb,r.globalMatrix);a.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(r.children)for(const s of r.children)M2(s,e,a)}const B2=["","wall","door","roof","window","lamp","logo"];class I2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:V2(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const a=new Ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Ca.applyTransformFast(s.aabb,this.node.globalMatrix),a.encapsulate(s.transformedAabb)),e++;this.aabb=a}return this.aabb}}class y0{constructor(e,a,s,c,p,m,x,L){this.id=s,this.layers=e,this.layerIds=this.layers.map(N=>N.fqid),this.stateDependentLayerIds=this.layers.filter(N=>N.isStateDependent()).map(N=>N.id),this.modelTraits|=xm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=xm.HasMapboxMeshFeatures),p&&(this.modelTraits|=xm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=L,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const N of a)this.nodesInfo.push(new I2(N)),M2(N,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,a){for(const s of this.getNodesInfo()){const c=s.node;c.footprint&&a.push({footprint:c.footprint,id:e})}}updateAppearances(e,a,s,c){}update(e){const a=Object.keys(e).length!==0;if(a&&!this.stateDependentLayers.length)return;const s=a?this.stateDependentLayers:this.layers;if(!uo(e,this.states))for(const c of s)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const s of a){const c=s.node;this.uploaded?this.updatePbrBuffer(c):H_(c,e,!0)}for(const s of a)$g(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let a=!1;if(!e.meshes)return a;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),a=!0);return a}needsReEvaluation(e,a,s){const c=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;if(!this.uploaded||this.dirty||c.name!==this.projection.name||Qy(s.paint.get("model-color").value,m)||Qy(s.paint.get("model-color-mix-intensity").value,m)||Qy(s.paint.get("model-roughness").value,m)||Qy(s.paint.get("model-emissive-strength").value,m)||Qy(s.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=c,this.brightness=p;const x=this.getNodesInfo();for(const L of x)L.state=null;return!0}return!1}evaluateTransform(e,a){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),c=this.id.canonical;for(const p of s){const m=p.feature;p.evaluatedTranslation=a.paint.get("model-translation").evaluate(m,{},c),p.evaluatedScale=a.paint.get("model-scale").evaluate(m,{},c)}}evaluate(e,a){const s=this.getNodesInfo();for(const c of s){if(!c.node.meshes)continue;const p=c.feature,m=a&&a[p.id];if(uo(m,c.state))continue;c.state=structuredClone(m);const x=c.node.meshes&&c.node.meshes[0].featureData,L=c.evaluatedColor[2],N=c.evaluatedRMEA[2],R=this.id.canonical;if(c.hasTranslucentParts=!1,x){for(let T=0;T<B2.length;T++){const V=B2[T];V.length&&(p.properties.part=V);const F=e.paint.get("model-color").evaluate(p,m,R).toPremultipliedRenderColor(null),O=e.paint.get("model-color-mix-intensity").evaluate(p,m,R);c.evaluatedColor[T]=[F.r,F.g,F.b,O],c.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(p,m,R),c.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(p,m,R),c.evaluatedRMEA[T][3]=F.a,c.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,m,R),!c.hasTranslucentParts&&F.a<1&&(c.hasTranslucentParts=!0)}delete p.properties.part,Wz(c,L!==c.evaluatedColor[2]||N!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,m,R);c.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,m,R),c.evaluatedScale=e.paint.get("model-scale").evaluate(p,m,R),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,a,s,c){const p=e.findDEMTileFor(s);if(p&&(p.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=Sm.create(e,s,p);if(!m)return;this.modelTraits&xm.HasMapboxMeshFeatures&&this.updateDEM(e,m,s,c);for(const x of this.getNodesInfo()){const L=x.node;if(!L.footprint||!L.footprint.vertices||!L.footprint.vertices.length)continue;const N=L.footprint.vertices;let R=m.getElevationAt(N[0].x,N[0].y,!0,!0);for(let T=1;T<N.length;T++)R=Math.min(R,m.getElevationAt(N[T].x,N[T].y,!0,!0));L.elevation=R}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=a}}updateDEM(e,a,s,c){let p=a._dem._modifiedForSources[c];if(p===void 0&&(a._dem._modifiedForSources[c]=[],p=a._dem._modifiedForSources[c]),p.includes(s.canonical))return;const m=a._dem.dim;p.push(s.canonical);let x=!1;for(const L of this.getNodesInfo()){const N=L.node;if(!N.footprint||!N.footprint.grid)continue;const R=N.footprint.grid,T=a.tileCoordToPixel(R.min.x,R.min.y),V=a.tileCoordToPixel(R.max.x,R.max.y),F=Math.min(Math.min(m-V.y,T.x),Math.min(T.y,m-V.x));if(F<0)continue;const O=re(F,2,5);let Q=Math.max(0,T.x-O),$=Math.max(0,T.y-O),K=Math.min(V.x+O,m-1),ie=Math.min(V.y+O,m-1);for(let Le=$;Le<=ie;++Le)for(let Ae=Q;Ae<=K;++Ae)Tp[Le*m+Ae]=255;let le=0,de=0;for(let Le=0;Le<R.cellsY;++Le)for(let Ae=0;Ae<R.cellsX;++Ae){if(!R.cells[Le*R.cellsX+Ae])continue;const Me=a.tileCoordToPixel(R.min.x+Ae/R.xScale,R.min.y+Le/R.yScale),Je=a.tileCoordToPixel(R.min.x+(Ae+1)/R.xScale,R.min.y+(Le+1)/R.yScale);for(let ot=Me.y;ot<=Math.min(Je.y+1,m-1);++ot)for(let We=Me.x;We<=Math.min(Je.x+1,m-1);++We)Tp[ot*m+We]===255&&(Tp[ot*m+We]=0,le+=a.getElevationAtPixel(We,ot),de++)}const Ee=le/de;Q=Math.max(1,T.x-O),$=Math.max(1,T.y-O),K=Math.min(V.x+O,m-2),ie=Math.min(V.y+O,m-2),x=!0;for(let Le=$;Le<=ie;++Le)for(let Ae=Q;Ae<=K;++Ae)Tp[Le*m+Ae]===0&&(jx[Le*m+Ae]=a._dem.set(Ae,Le,Ee));for(let Le=1;Le<O;++Le){Q=Math.max(1,T.x-Le),$=Math.max(1,T.y-Le),K=Math.min(V.x+Le,m-2),ie=Math.min(V.y+Le,m-2);for(let Ae=$;Ae<=ie;++Ae)for(let Me=Q;Me<=K;++Me){const Je=Ae*m+Me;if(Tp[Je]===255){let ot=0,We=0,ut=-1,_t=-1;for(let Zt=-1;Zt<=1;++Zt)for(let Pt=-1;Pt<=1;++Pt){const At=(Ae+Zt)*m+Me+Pt;if(Tp[At]>=Le)continue;const xt=jx[At],zt=Math.abs(xt);zt>We&&(ot=xt,We=zt,ut=Pt,_t=Zt)}if(We>.1){const Zt=1-(Le+.5*Math.abs(ut*_t))/O;let Pt=a._dem.get(Me,Ae)+ot*Zt;const At=a._dem.get(Me+ut,Ae+_t),xt=a._dem.get(Me-ut,Ae-_t,!0);(Pt-At)*(Pt-xt)>0&&(Pt=(At+xt)/2),jx[Je]=a._dem.set(Me,Ae,Pt),Tp[Je]=Le}}}}}x&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Qs.now())}setFilter(e){this.filter=e?Th(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new $r(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const a of e)$g(a.node),Y_(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const s=a.getReplacementRegionsForTile(e.toUnwrapped());for(const c of this.getNodesInfo()){const p=c.node.footprint;c.hiddenByReplacement=!!p&&!s.find(m=>m.footprint===p)}}getHeightAtTileCoord(e,a){const s=[],c=[0,0,0],p=pe([]);for(const m of this.getNodesInfo()){const x=m.node.meshes[0],L=x.transformedAabb;if(e<L.min[0]||a<L.min[1]||e>L.max[0]||a>L.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};ve(p,m.node.globalMatrix),c[0]=e,c[1]=a,ln(c,c,p);const N=(c[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*zp|0,R=Math.min(63,(c[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*zp|0)*zp+Math.min(63,N),T=x.heightmap[R];if(!(T<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:T,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new St(e,a),new St(e,a),s),s.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function Qy(r,e){return r instanceof Zs&&!r.isLightConstant&&e}function Uz(r,e,a,s,c,p,m,x){let L=(61440&e|(61440&e)>>4)>>8,N=(3840&e|(3840&e)>>4)>>4,R=240&e|(240&e)>>4;a[3]>0&&(L=Sa(L,255*a[0],a[3]),N=Sa(N,255*a[1],a[3]),R=Sa(R,255*a[2],a[3]));const T=L<<8|N,V=R<<8|Math.floor(255*s[3]),F=function(Le){const Ae=re(Le,0,2);return Math.min(Math.round(.5*Ae*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],O=re(c[0],0,1),Q=re(c[1],0,1),$=re(c[2],0,1),K=re(c[3],0,1);let ie,le,de,Ee;if(O!==Q&&m!==p&&Q!==O){const Le=m-p;le=1/(Le*(Q-O)),de=-(p+Le*O)/(Le*(Q-O));const Ae=re(c[4],-1,1);Ee=Math.pow(10,Ae),ie=255*$<<8|255*K}else ie=65535,le=0,de=1,Ee=1;if(r.emplaceBack(T,V,F,ie,le,de,Ee),x){const Le=x.length;x.clear();for(let Ae=0;Ae<Le;Ae++)x.emplaceBack(T,V,F,ie,le,de,Ee)}}function Wz(r,e,a){const s=r.node;let c=0;const p=a&xm.HasMeshoptCompression;for(const m of s.meshes){if(s.lights&&s.lightMeshIndex===c||!m.featureData)continue;m.featureArray=new Iu,m.featureArray.reserve(m.featureData.length);let x=e;for(const L of m.featureData){const N=p?65535&L:L>>16&65535,R=p?L>>16&65535:65535&L,T=(15&R)<8?15&R:0,V=r.evaluatedRMEA[T],F=r.evaluatedColor[T],O=r.emissionHeightBasedParams[T];let Q;if(x&&T===2&&s.lights&&(Q=new Iu,Q.resize(10*s.lights.length)),Uz(m.featureArray,N,F,V,O,m.aabb.min[2],m.aabb.max[2],Q),Q&&x){x=!1;const $=s.meshes[s.lightMeshIndex];$.featureArray=Q,$.featureArray._trim()}}m.featureArray._trim(),c++}}na(y0,"Tiled3dModelBucket",{omit:["layers"]}),na(I2,"Tiled3dModelFeature");const Xz=["id","tile","layer","source","sourceLayer","state"];class Vp{constructor(e,a,s,c,p){this.type="Feature",this._vectorTileFeature=e,this._z=a,this._x=s,this._y=c,this.properties=e?e.properties:{},this.id=p}clone(){const e=new Vp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of Xz)this[a]!==void 0&&(e[a]=this[a]);return e}}class Mp extends Nl{constructor(e,a,s,c){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=a,this._modelsInfo=new Map}load(){const e=[];for(const a in this._options.models){const s=this._options.models[a],c=this._modelsInfo.get(a);if(c){const p=c.model;p.position=s.position!=null?new C(s.position[0],s.position[1]):new C(0,0),p.orientation=s.orientation!=null?s.orientation:[0,0,0],c.modelSpec=s,Mp.applyModelSpecification(p,s),p.computeBoundsAndApplyParent(),this.models.push(p)}else{const p=t1(this.map._requestManager.transformRequest(s.uri,rl.Model).url).then(m=>{if(!m)return;const x=q_(m),L=new s1(a,s.uri,s.position,s.orientation,x);Mp.applyModelSpecification(L,s),L.computeBoundsAndApplyParent(),this.models.push(L),this._modelsInfo.set(a,{modelSpec:s,model:L})}).catch(m=>{this.fire(new ad(new Error(`Could not load model ${a} from ${s.uri}: ${m.message}`)))});e.push(p)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new js("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new ad(new Error(`Could not load models: ${a.message}`)))})}static applyModelSpecification(e,a){a.nodeOverrides&&Mp.convertNodeOverrides(e,a.nodeOverrides),a.materialOverrides&&Mp.convertMaterialOverrides(e,a.materialOverrides),a.nodeOverrideNames&&(e.nodeOverrideNames=[...a.nodeOverrideNames]),a.materialOverrideNames&&(e.materialOverrideNames=[...a.materialOverrideNames]),a.featureProperties&&(e.featureProperties=a.featureProperties)}static convertNodeOverrides(e,a){if(Array.isArray(a)&&a.every(s=>typeof s=="string")){e.nodeOverrideNames=[];for(const s of a)e.nodeOverrideNames.push(s)}else Object.entries(a).forEach(([s,c])=>{const p={orientation:[0,0,0]};if(c.hasOwnProperty("orientation")){const m=c.orientation;m&&(p.orientation=m)}e.nodeOverrides.set(s,p)})}static convertMaterialOverrides(e,a){if(Array.isArray(a)&&a.every(s=>typeof s=="string")){e.materialOverrideNames=[];for(const s of a)e.materialOverrideNames.push(s)}else Object.entries(a).forEach(([s,c])=>{const p={color:new Or(1,1,1),colorMix:0,emissionStrength:0,opacity:1},m=c["model-color"];m!==void 0&&(p.color.r=m[0],p.color.g=m[1],p.color.b=m[2]);const x=c["model-color-mix-intensity"];x!==void 0&&(p.colorMix=x);const L=c["model-emissive-strength"];L!==void 0&&(p.emissionStrength=L);const N=c["model-opacity"];N!==void 0&&(p.opacity=N),e.materialOverrides.set(s,p)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,a){}serialize(){return this._options}setProperty(e,a){return!1}reload(){const e=Xc(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const a=new Map;for(const s in e){const c=e[s];if(this._modelsInfo.has(s)){const p=this._modelsInfo.get(s);p&&p.modelSpec.uri===c.uri&&a.set(s,p)}}this._modelsInfo=a,this._options.models=e,this._loaded=!1,this.load()}}function Zx(r,e,a,s){const c=1<<r.z;e.lat=ce((s/Dt+r.y)/c),e.lng=he((a/Dt+r.x)/c)}function Qz(r,e,a,s){const c=r.getNodesInfo()[e];if(!c||c.hiddenByReplacement||!c.node.meshes)return;let p=Number.MAX_VALUE;const m=c.node,x=a.tile,L=s.calculatePosMatrix(x.tileID.toUnwrapped(),s.worldSize),N=c.evaluatedScale;let R=0;s.elevation&&m.elevation&&(R=m.elevation*s.elevation.exaggeration()),ye(L,L,[(m.anchor?m.anchor[0]:0)*(N[0]-1),(m.anchor?m.anchor[1]:0)*(N[1]-1),R]),$e(L,L,N);const T=a.queryGeometry,V=T.isPointQuery()?T.screenBounds:T.screenGeometry,F=function(Q){const $=ke([],L,Q.globalMatrix);ke($,s.expandedFarZProjMatrix,$);for(let K=0;K<Q.meshes.length;++K){const ie=Q.meshes[K];if(K===Q.lightMeshIndex)continue;const le=Q_(V,s,$,ie.aabb);le!=null&&(p=Math.min(le,p))}if(Q.children)for(const K of Q.children)F(K)};if(F(m),p===Number.MAX_VALUE)return;const O=new C(0,0);return Zx(x.tileID.canonical,O,c.node.anchor[0],c.node.anchor[1]),{intersectionZ:p,position:O,feature:c.feature}}const Hz={circle:class extends gs{constructor(r,e,a,s){super(r,{layout:fc||(fc=new Mn({"circle-sort-key":new Kt(Ue.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt(Ue.layout_circle["circle-elevation-reference"]),visibility:new Tt(Ue.layout_circle.visibility)})),paint:pc||(pc=new Mn({"circle-radius":new Kt(Ue.paint_circle["circle-radius"]),"circle-color":new Kt(Ue.paint_circle["circle-color"]),"circle-blur":new Kt(Ue.paint_circle["circle-blur"]),"circle-opacity":new Kt(Ue.paint_circle["circle-opacity"]),"circle-translate":new Tt(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(Ue.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s)}createBucket(r){return new _n(r)}queryRadius(r){const e=r;return Di("circle-radius",this,e)+Di("circle-stroke-width",this,e)+bn(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,a,s,c,p,m,x){const L=Fl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(e,a)+this.paint.get("circle-stroke-width").evaluate(e,a);return Cv(r,s,p,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",L,N)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,a){const s=Dv(this);return{config:new hc(this,{zoom:e,lut:a}),defines:s,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends gs{createBucket(r){return new Gv(r)}constructor(r,e,a,s){super(r,{layout:Uv||(Uv=new Mn({visibility:new Tt(Ue.layout_heatmap.visibility)})),paint:Wv||(Wv=new Mn({"heatmap-radius":new Kt(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Su(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(Ue.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return Di("heatmap-radius",this,r)}queryIntersectsFeature(r,e,a,s,c,p,m,x){const L=this.paint.get("heatmap-radius").evaluate(e,a);return Cv(r,s,p,m,x,!0,!0,new St(0,0),L)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,a){return r==="heatmap"?{config:new hc(this,{zoom:e,lut:a}),overrideFog:!1}:{}}},hillshade:class extends gs{constructor(r,e,a,s){super(r,{layout:Xv||(Xv=new Mn({visibility:new Tt(Ue.layout_hillshade.visibility)})),paint:Qv||(Qv=new Mn({"hillshade-illumination-direction":new Tt(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(Ue.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,a){return{overrideFog:!1}}},fill:class extends gs{constructor(r,e,a,s){super(r,{layout:cb||(cb=new Mn({"fill-sort-key":new Kt(Ue.layout_fill["fill-sort-key"]),visibility:new Tt(Ue.layout_fill.visibility),"fill-elevation-reference":new Tt(Ue.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Kt(Ue.layout_fill["fill-construct-bridge-guard-rail"])})),paint:ub||(ub=new Mn({"fill-antialias":new Tt(Ue.paint_fill["fill-antialias"]),"fill-opacity":new Kt(Ue.paint_fill["fill-opacity"]),"fill-color":new Kt(Ue.paint_fill["fill-color"]),"fill-outline-color":new Kt(Ue.paint_fill["fill-outline-color"]),"fill-translate":new Tt(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kt(Ue.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Tt(Ue.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Tt(Ue.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Kt(Ue.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Kt(Ue.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Kt(Ue.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),a=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(r,e,a){return{config:new hc(this,{zoom:e,lut:a}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new R_(r)}queryRadius(){return bn(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,a,s,c,p){return!r.queryGeometry.isAboveHorizon&&Dn(Eo(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends gs{constructor(r,e,a,s){super(r,{layout:Bb||(Bb=new Mn({visibility:new Tt(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Ib||(Ib=new Mn({"fill-extrusion-opacity":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Kt(Ue["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Dg(r)}queryRadius(){return bn(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,a,s,c,p,m,x,L){const N=Fl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(e,a),T=this.paint.get("fill-extrusion-base").evaluate(e,a),V=[0,0],F=x&&p.elevation,O=p.elevation?p.elevation.exaggeration():1,Q=r.tile.getBucket(this);if(F&&Q instanceof Dg){const de=Q.centroidVertexArray,Ee=L+1;Ee<de.length&&(V[0]=de.geta_centroid_pos0(Ee),V[1]=de.geta_centroid_pos1(Ee))}if(V[0]===0&&V[1]===1)return!1;p.projection.name==="globe"&&(s=Mb([s],[new St(0,0),new St(Dt,Dt)],r.tileID.canonical).map(de=>de.polygon).flat());const $=F?x:null,[K,ie]=Pb(p,s,T,R,N,m,$,V,O,p.center.lat,r.tileID.canonical),le=r.queryGeometry;return Cb(K,ie,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends gs{constructor(r,e,a,s){super(r,{layout:p1||(p1=new Mn({visibility:new Tt(Ue.layout_building.visibility),"building-facade":new Kt(Ue.layout_building["building-facade"]),"building-facade-floors":new Kt(Ue.layout_building["building-facade-floors"]),"building-facade-unit-width":new Kt(Ue.layout_building["building-facade-unit-width"]),"building-facade-window":new Kt(Ue.layout_building["building-facade-window"]),"building-roof-shape":new Kt(Ue.layout_building["building-roof-shape"]),"building-height":new Kt(Ue.layout_building["building-height"]),"building-base":new Kt(Ue.layout_building["building-base"]),"building-flood-light-wall-radius":new Kt(Ue.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Kt(Ue.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Kt(Ue.layout_building["building-flip-roof-orientation"])})),paint:m1||(m1=new Mn({"building-opacity":new Tt(Ue.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Tt(Ue.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Tt(Ue.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Tt(Ue.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Tt(Ue.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Tt(Ue.paint_building["building-vertical-scale"]),"building-cast-shadows":new Tt(Ue.paint_building["building-cast-shadows"]),"building-color":new Kt(Ue.paint_building["building-color"]),"building-emissive-strength":new Kt(Ue.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Tt(Ue.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Tt(Ue.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Tt(Ue.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Tt(Ue.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Tt(Ue.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new f1(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,a,s,c,p,m,x,L){let N=this.layout.get("building-height").evaluate(e,a);const R=this.layout.get("building-base").evaluate(e,a),T=r.tile.getBucket(this).getFootprint(e);if(T){if(T.hiddenFlags!==0)return!1;N=T.height}const[V,F]=Pb(p,s,R,N,new St(0,0),m,null,[0,0],1,p.center.lat,r.tileID.canonical),O=r.queryGeometry;return Cb(V,F,O.isPointQuery()?O.screenBounds:O.screenGeometry)}},line:class extends gs{constructor(r,e,a,s){const c=Z1();super(r,c,e,a,s),c.layout&&(this.layout=new fl(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof _h,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Vy)return Vy;const a=Z1();return Vy=new US(a.paint.properties["line-width"].specification),Vy.useIntegerZoom=!0,Vy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new ex(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,a){const s=L1(this);return{config:new hc(this,{zoom:e,lut:a}),defines:s,overrideFog:!1}}queryRadius(r){const e=r,a=N1(Di("line-width",this,e),Di("line-gap-width",this,e)),s=Di("line-offset",this,e);return a/2+Math.abs(s)+bn(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,a,s,c,p){if(r.queryGeometry.isAboveHorizon)return!1;const m=Eo(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*N1(this.paint.get("line-width").evaluate(e,a),this.paint.get("line-gap-width").evaluate(e,a)),L=this.paint.get("line-offset").evaluate(e,a);return L&&(s=function(N,R){const T=[],V=new St(0,0);for(let F=0;F<N.length;F++){const O=N[F],Q=[];for(let $=0;$<O.length;$++){const K=O[$],ie=O[$+1],le=$===0?V:K.sub(O[$-1])._unit()._perp(),de=$===O.length-1?V:ie.sub(K)._unit()._perp(),Ee=le._add(de)._unit();Ee._mult(1/(Ee.x*de.x+Ee.y*de.y)),Q.push(Ee._mult(R)._add(K))}T.push(Q)}return T}(s,L*r.pixelToTileUnitsFactor)),function(N,R,T){for(let V=0;V<R.length;V++){const F=R[V];if(N.length>=3){for(let O=0;O<F.length;O++)if(vi(N,F[O]))return!0}if(Ss(N,F,T))return!0}return!1}(m,s,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:h0,background:class extends gs{constructor(r,e,a,s){super(r,{layout:m2||(m2=new Mn({visibility:new Tt(Ue.layout_background.visibility)})),paint:y2||(y2=new Mn({"background-pitch-alignment":new Tt(Ue.paint_background["background-pitch-alignment"]),"background-color":new Tt(Ue.paint_background["background-color"]),"background-pattern":new Tt(Ue.paint_background["background-pattern"]),"background-opacity":new Tt(Ue.paint_background["background-opacity"]),"background-emissive-strength":new Tt(Ue.paint_background["background-emissive-strength"]),"background-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,a){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:v2,"raster-particle":E2,sky:class extends gs{constructor(r,e,a,s){super(r,{layout:j2||(j2=new Mn({visibility:new Tt(Ue.layout_sky.visibility)})),paint:Z2||(Z2=new Mn({"sky-type":new Tt(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new Su(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(Ue.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=yy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,p=r.style.light,m=p.properties.get("position");return c&&p.properties.get("anchor")==="viewport"&&Za("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?vx(m.azimuthal,90-m.polar,e):vx(s[0],90-s[1],e)}const a=this.paint.get("sky-gradient-center");return vx(a[0],90-a[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends gs{constructor(r,e,a,s){super(r,{paint:N2||(N2=new Mn({}))},e,null)}},model:class extends gs{constructor(r,e,a,s){super(r,{layout:R2||(R2=new Mn({visibility:new Tt(Ue.layout_model.visibility),"model-id":new Kt(Ue.layout_model["model-id"])})),paint:T2||(T2=new Mn({"model-opacity":new Kt(Ue.paint_model["model-opacity"]),"model-rotation":new Kt(Ue.paint_model["model-rotation"]),"model-scale":new Kt(Ue.paint_model["model-scale"]),"model-translation":new Kt(Ue.paint_model["model-translation"]),"model-color":new Kt(Ue.paint_model["model-color"]),"model-color-mix-intensity":new Kt(Ue.paint_model["model-color-mix-intensity"]),"model-type":new Tt(Ue.paint_model["model-type"]),"model-cast-shadows":new Tt(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Kt(Ue.paint_model["model-emissive-strength"]),"model-roughness":new Kt(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Kt(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt(Ue.paint_model["model-front-cutoff"]),"model-elevation-reference":new Tt(Ue.paint_model["model-elevation-reference"]),"model-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},e,a,s),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Lx(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof y0?Dt-1:0}queryRenderedFeatures(r,e,a){const s=e.getSource();if(!(s&&s instanceof Mp))return{};const c=s,p={};p[this.id]=[];const m=p[this.id];let x=0;for(const L of c.models){const N=e.getFeatureState(this.sourceLayer,L.id),R={type:"Unknown",id:L.id,properties:L.featureProperties},T=this.paint.get("model-rotation").evaluate(R,N),V=this.paint.get("model-scale").evaluate(R,N),F=this.paint.get("model-translation").evaluate(R,N),O=this.paint.get("model-elevation-reference");let Q=[];Yg(Q,L,a,L.position,T,V,F,O==="ground",O==="ground",!1),a.projection.name==="globe"&&(Q=Hg(Q,a));const $=ke([],a.projMatrix,Q),K=Q_(r.isPointQuery()?r.screenBounds:r.screenGeometry,a,$,L.aabb);if(K!=null){const ie=new Vp(void 0,0,0,0,L.id);ie.layer=this.layer,ie.properties=structuredClone(L.featureProperties),ie.properties.layer=this.id,ie.properties.uri=L.uri,ie.properties.orientation=L.orientation,ie.sourceLayer=this.sourceLayer,ie.geometry={type:"Point",coordinates:[L.position.lng,L.position.lat]},ie.state=N,ie.source=this.source,m.push({featureIndex:x,feature:ie,intersectionZ:K})}++x}return p}queryIntersectsFeature(r,e,a,s,c,p){if(!this.modelManager)return!1;const m=this.modelManager,x=r.tile.getBucket(this);if(!(x&&x instanceof Lx))return!1;for(const L in x.instancesPerModel){const N=x.instancesPerModel[L],R=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(N.idToFeaturesIndex.hasOwnProperty(R)){const T=N.features[N.idToFeaturesIndex[R]],V=m.getModel(L,this.scope);if(!V)return!1;let F=[];const O=new C(0,0),Q=x.canonical;let $=Number.MAX_VALUE;for(let K=0;K<T.instancedDataCount;++K){const ie=16*(T.instancedDataOffset+K),le=N.instancedDataArray.float32,de=[le[ie+4],le[ie+5],le[ie+6]];Zx(Q,O,Math.floor(le[ie]),Math.floor(le[ie+1])),Yg(F,V,p,O,T.rotation,T.scale,de,!1,!1,!1),p.projection.name==="globe"&&(F=Hg(F,p));const Ee=ke([],p.projMatrix,F),Le=r.queryGeometry,Ae=Q_(Le.isPointQuery()?Le.screenBounds:Le.screenGeometry,p,Ee,V.aabb);Ae!=null&&($=Math.min(Ae,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(r,e,a){return!(!this.layout||e.isDataDriven()||a.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ro}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends gs{constructor(r,e,a,s){super(r,{layout:db||(db=new Mn({"clip-layer-types":new Tt(Ue.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt(Ue.layout_clip["clip-layer-scope"])})),paint:hb||(hb=new Mn({}))},e,a,s)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new fb(r)}is3D(r){return!0}}},Nx=new Or(0,0,0),Ex={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Sx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},g0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Yz={PAINT_ORDER_FILL_AND_STROKE:1},Hy={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},k2={MASK_TYPE_LUMINANCE:1};function $z(r,e,a){r===1&&e.icons.push(function(s,c){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:m}=p;if(m.content_area){const{content_area:x}=m;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=p.usvg_tree.width),x.height==null&&(x.height=x.width)}if(m.text_placeholder){const{text_placeholder:x}=m;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return m.stretch_x&&m.stretch_x.length&&J2(m,"x"),m.stretch_y&&m.stretch_y.length&&J2(m,"y"),p}(s.readFields(qz,{name:void 0},c))}(a,a.readVarint()+a.pos))}function J2(r,e){const a=[],s=r[`stretch_${e}`];let c=null;for(let p=0;p<s.length;p++)c===null?c=a.length===0?s[0]:a[a.length-1][1]+s[p]:(a.push([c,c+s[p]]),c=null);r[`stretch_${e}_areas`]=a}function qz(r,e,a){r===1?e.name=a.readString():r===2?e.metadata=function(s,c){return s.readFields(Kz,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(a,a.readVarint()+a.pos):r===3&&(e.usvg_tree=function(s,c){return s.readFields(aA,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(a,a.readVarint()+a.pos),e.data="usvg_tree")}function Kz(r,e,a){r===1?e.stretch_x=a.readPackedVarint():r===2?e.stretch_y=a.readPackedVarint():r===3?e.content_area=F2(a,a.readVarint()+a.pos):r===4?e.variables.push(function(s,c){return s.readFields(tA,{name:void 0},c)}(a,a.readVarint()+a.pos)):r===5&&(e.text_placeholder=F2(a,a.readVarint()+a.pos))}function F2(r,e){return r.readFields(eA,{},e)}function eA(r,e,a){r===1?e.left=a.readVarint():r===2?e.width=a.readVarint():r===3?e.top=a.readVarint():r===4&&(e.height=a.readVarint())}function tA(r,e,a){r===1?e.name=a.readString():r===2&&(e.rgb_color=w0(a.readVarint()),e.value="rgb_color")}function aA(r,e,a){r===1?e.width=e.height=a.readVarint():r===2?e.height=a.readVarint():r===3?e.children.push(_0(a,a.readVarint()+a.pos)):r===4?e.linear_gradients.push(function(s,c){return s.readFields(cA,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(a,a.readVarint()+a.pos)):r===5?e.radial_gradients.push(function(s,c){return s.readFields(dA,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(a,a.readVarint()+a.pos)):r===7?e.clip_paths.push(function(s,c){return s.readFields(hA,{children:[]},c)}(a,a.readVarint()+a.pos)):r===8&&e.masks.push(function(s,c){const p=s.readFields(fA,{left:0,width:20,mask_type:k2.MASK_TYPE_LUMINANCE,children:[]},c);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(a,a.readVarint()+a.pos))}function _0(r,e){return r.readFields(rA,{},e)}function rA(r,e,a){r===1?(e.group=function(s,c){return s.readFields(nA,{opacity:255,children:[]},c)}(a,a.readVarint()+a.pos),e.node="group"):r===2&&(e.path=function(s,c){return s.readFields(sA,{paint_order:1,commands:[],step:1,diffs:[],rule:Ex.PATH_RULE_NON_ZERO},c)}(a,a.readVarint()+a.pos),e.node="path")}function nA(r,e,a){r===1?e.transform=x0(a,a.readVarint()+a.pos):r===2?e.opacity=a.readVarint():r===5?e.clip_path_idx=a.readVarint():r===6?e.mask_idx=a.readVarint():r===7&&e.children.push(_0(a,a.readVarint()+a.pos))}function x0(r,e){return r.readFields(iA,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function iA(r,e,a){r===1?e.sx=a.readFloat():r===2?e.ky=a.readFloat():r===3?e.kx=a.readFloat():r===4?e.sy=a.readFloat():r===5?e.tx=a.readFloat():r===6&&(e.ty=a.readFloat())}function sA(r,e,a){r===1?e.fill=function(s,c){return s.readFields(oA,{rgb_color:Nx,paint:"rgb_color",opacity:255},c)}(a,a.readVarint()+a.pos):r===2?e.stroke=function(s,c){return s.readFields(lA,{rgb_color:Nx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(a,a.readVarint()+a.pos):r===3?e.paint_order=a.readVarint():r===5?a.readPackedVarint(e.commands):r===6?e.step=a.readFloat():r===7?a.readPackedSVarint(e.diffs):r===8&&(e.rule=a.readVarint())}function oA(r,e,a){r===1?(e.rgb_color=w0(a.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=a.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=a.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=a.readVarint())}function w0(r){return new Or((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function lA(r,e,a){r===1?(e.rgb_color=w0(a.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=a.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=a.readVarint(),e.paint="radial_gradient_idx"):r===5?a.readPackedFloat(e.dasharray):r===6?e.dashoffset=a.readFloat():r===7?e.miterlimit=a.readFloat():r===8?e.opacity=a.readVarint():r===9?e.width=a.readFloat():r===10?e.linecap=a.readVarint():r===11&&(e.linejoin=a.readVarint())}function cA(r,e,a){r===1?e.transform=x0(a,a.readVarint()+a.pos):r===2?e.spread_method=a.readVarint():r===3?e.stops.push(O2(a,a.readVarint()+a.pos)):r===4?e.x1=a.readFloat():r===5?e.y1=a.readFloat():r===6?e.x2=a.readFloat():r===7&&(e.y2=a.readFloat())}function O2(r,e){return r.readFields(uA,{offset:0,opacity:255,rgb_color:Nx},e)}function uA(r,e,a){r===1?e.offset=a.readFloat():r===2?e.opacity=a.readVarint():r===3&&(e.rgb_color=w0(a.readVarint()))}function dA(r,e,a){r===1?e.transform=x0(a,a.readVarint()+a.pos):r===2?e.spread_method=a.readVarint():r===3?e.stops.push(O2(a,a.readVarint()+a.pos)):r===4?e.cx=a.readFloat():r===5?e.cy=a.readFloat():r===6?e.r=a.readFloat():r===7?e.fx=a.readFloat():r===8?e.fy=a.readFloat():r===9&&(e.fr=a.readFloat())}function hA(r,e,a){r===1?e.transform=x0(a,a.readVarint()+a.pos):r===2?e.clip_path_idx=a.readVarint():r===3&&e.children.push(_0(a,a.readVarint()+a.pos))}function fA(r,e,a){r===1?e.left=e.top=a.readFloat():r===2?e.width=e.height=a.readFloat():r===3?e.top=a.readFloat():r===4?e.height=a.readFloat():r===5?e.mask_type=a.readVarint():r===6?e.mask_idx=a.readVarint():r===7&&e.children.push(_0(a,a.readVarint()+a.pos))}class pA{static calculate(e={},a=[]){const s=new Map,c=new Map;if(Object.keys(e).length===0)return s;a.forEach(p=>{c.set(p.name,p.rgb_color||new Or(0,0,0))});for(const[p,m]of Object.entries(e))c.has(p)?s.set(c.get(p).toString(),m):console.warn(`Ignoring unknown image variable "${p}"`);return s}}function zm(r,e=255,a){const s=e/255,c=r.toString(),p=a.has(c)?a.get(c).clone():r.clone();return p.a*=s,p.toString()}function Yy(r,e){if(!as()){const a=document.createElement("canvas");return a.width=r,a.height=e,a}return new OffscreenCanvas(r,e)}function mA(r,e){const a=pA.calculate(e.params,r.metadata?r.metadata.variables:[]),s=r.usvg_tree,c=s.width,p=s.height,m=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(c*m.a)),L=Math.max(1,Math.round(p*m.d)),N=new DOMMatrix([x/c,0,0,L/p,0,0]),R=Yy(x,L).getContext("2d");return zx(R,N,s,s,a),R.getImageData(0,0,x,L)}function zx(r,e,a,s,c){for(const p of s.children)D2(r,e,a,p,c)}function D2(r,e,a,s,c){s.group?(r.save(),function(p,m,x,L,N){const R=L.mask_idx!=null?x.masks[L.mask_idx]:null,T=L.clip_path_idx!=null?x.clip_paths[L.clip_path_idx]:null;if(L.transform&&(m=Am(L.transform).preMultiplySelf(m)),!function(O,Q,$){return O.opacity!==255||Q||$}(L,T!=null,R!=null))return void zx(p,m,x,L,N);const V=Yy(p.canvas.width,p.canvas.height),F=V.getContext("2d");zx(F,m,x,L,N),T&&Q2(F,m,x,T),R&&H2(F,m,x,R,N),p.globalAlpha=L.opacity/255,p.drawImage(V,0,0)}(r,e,a,s.group,c),r.restore()):s.path&&(r.save(),function(p,m,x,L,N){p.setTransform(m),L.paint_order===Yz.PAINT_ORDER_FILL_AND_STROKE?(C2(p,x,L,N),G2(p,x,L,N)):(G2(p,x,L,N),C2(p,x,L,N))}(r,e,a,s.path,c),r.restore())}function C2(r,e,a,s){const c=a.fill;if(!c)return;const p=c.opacity/255;switch(r.save(),r.beginPath(),Y2(a,r),c.paint){case"rgb_color":r.fillStyle=zm(c.rgb_color,c.opacity,s);break;case"linear_gradient_idx":{const m=e.linear_gradients[c.linear_gradient_idx];m.transform&&r.setTransform(Am(m.transform).preMultiplySelf(r.getTransform())),r.fillStyle=U2(r,m,p,s);break}case"radial_gradient_idx":{const m=e.radial_gradients[c.radial_gradient_idx];m.transform&&r.setTransform(Am(m.transform).preMultiplySelf(r.getTransform())),r.fillStyle=W2(r,m,p,s)}}r.fill(P2(a)),r.restore()}function P2(r){return r.rule===Ex.PATH_RULE_NON_ZERO?"nonzero":r.rule===Ex.PATH_RULE_EVEN_ODD?"evenodd":void 0}function G2(r,e,a,s){const c=a.stroke;if(!c)return;const p=$2(a);r.lineWidth=c.width,r.miterLimit=c.miterlimit,r.setLineDash(c.dasharray),r.lineDashOffset=c.dashoffset;const m=c.opacity/255;switch(c.paint){case"rgb_color":r.strokeStyle=zm(c.rgb_color,c.opacity,s);break;case"linear_gradient_idx":r.strokeStyle=U2(r,e.linear_gradients[c.linear_gradient_idx],m,s,!0);break;case"radial_gradient_idx":r.strokeStyle=W2(r,e.radial_gradients[c.radial_gradient_idx],m,s,!0)}switch(c.linejoin){case g0.LINE_JOIN_MITER_CLIP:case g0.LINE_JOIN_MITER:r.lineJoin="miter";break;case g0.LINE_JOIN_ROUND:r.lineJoin="round";break;case g0.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(c.linecap){case Sx.LINE_CAP_BUTT:r.lineCap="butt";break;case Sx.LINE_CAP_ROUND:r.lineCap="round";break;case Sx.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(p)}function U2(r,e,a,s,c=!1){if(e.stops.length===1){const V=e.stops[0];return zm(V.rgb_color,V.opacity*a,s)}const{x1:p,y1:m,x2:x,y2:L}=e;let N=new DOMPoint(p,m),R=new DOMPoint(x,L);if(c){const V=Am(e.transform);N=V.transformPoint(N),R=V.transformPoint(R)}const T=r.createLinearGradient(N.x,N.y,R.x,R.y);for(const V of e.stops)T.addColorStop(V.offset,zm(V.rgb_color,V.opacity*a,s));return T}function W2(r,e,a,s,c=!1){if(e.stops.length===1){const K=e.stops[0];return zm(K.rgb_color,K.opacity*a,s)}const p=Am(e.transform),{fx:m,fy:x,fr:L,cx:N,cy:R,r:T}=e;let V=new DOMPoint(m,x),F=new DOMPoint(N,R),O=L,Q=T;if(c){V=p.transformPoint(V),F=p.transformPoint(F);const K=(p.a+p.d)/2;O=L*K,Q=e.r*K}const $=r.createRadialGradient(V.x,V.y,O,F.x,F.y,Q);for(const K of e.stops)$.addColorStop(K.offset,zm(K.rgb_color,K.opacity*a,s));return $}function X2(r,e,a,s){const c=s.transform?Am(s.transform).preMultiplySelf(e):e,p=Yy(r.canvas.width,r.canvas.height),m=p.getContext("2d");for(const L of s.children)if(L.group)X2(m,c,a,L.group);else if(L.path){const N=L.path,R=new Path2D;R.addPath($2(N),c),m.fill(R,P2(N))}const x=s.clip_path_idx!=null?a.clip_paths[s.clip_path_idx]:null;x&&Q2(m,c,a,x),r.globalCompositeOperation="source-over",r.drawImage(p,0,0)}function Q2(r,e,a,s){const c=Yy(r.canvas.width,r.canvas.height);X2(c.getContext("2d"),e,a,s),r.globalCompositeOperation="destination-in",r.drawImage(c,0,0)}function H2(r,e,a,s,c){if(s.children.length===0)return;const p=s.mask_idx!=null?a.masks[s.mask_idx]:null;p&&H2(r,e,a,p,c);const m=r.canvas.width,x=r.canvas.height,L=Yy(m,x),N=L.getContext("2d"),R=s.width,T=s.height,V=s.left,F=s.top,O=new Path2D,Q=new Path2D;Q.rect(V,F,R,T),O.addPath(Q,e),N.clip(O);for(const ie of s.children)D2(N,e,a,ie,c);const $=N.getImageData(0,0,m,x),K=$.data;if(s.mask_type===k2.MASK_TYPE_LUMINANCE)for(let ie=0;ie<K.length;ie+=4)K[ie+3]=K[ie+3]/255*(.2126*K[ie]+.7152*K[ie+1]+.0722*K[ie+2]);N.putImageData($,0,0),r.globalCompositeOperation="destination-in",r.drawImage(L,0,0)}function Am(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function Y2(r,e){const a=r.step;let s=r.diffs[0]*a,c=r.diffs[1]*a;e.moveTo(s,c);for(let p=0,m=2;p<r.commands.length;p++)switch(r.commands[p]){case Hy.PATH_COMMAND_MOVE:s+=r.diffs[m++]*a,c+=r.diffs[m++]*a,e.moveTo(s,c);break;case Hy.PATH_COMMAND_LINE:s+=r.diffs[m++]*a,c+=r.diffs[m++]*a,e.lineTo(s,c);break;case Hy.PATH_COMMAND_QUAD:{const x=s+r.diffs[m++]*a,L=c+r.diffs[m++]*a;s=x+r.diffs[m++]*a,c=L+r.diffs[m++]*a,e.quadraticCurveTo(x,L,s,c);break}case Hy.PATH_COMMAND_CUBIC:{const x=s+r.diffs[m++]*a,L=c+r.diffs[m++]*a,N=x+r.diffs[m++]*a,R=L+r.diffs[m++]*a;s=N+r.diffs[m++]*a,c=R+r.diffs[m++]*a,e.bezierCurveTo(x,L,N,R,s,c);break}case Hy.PATH_COMMAND_CLOSE:e.closePath()}return e}function $2(r){return Y2(r,new Path2D)}class v0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const a=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,a),a}put(e,a){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,a)}delete(e){this.cache.delete(e)}}na(v0,"LRUCache");class Ax{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new zs(e,e.data)}getFromCache(e,a,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new v0(150)),this.cacheMap.get(s).get(Xc(e.toString(),a))}setInCache(e,a,s,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new v0(150));const p=this.cacheDependenciesMap.get(c),m=Xc(e.id.toString(),s);p.get(m)||p.set(m,new Set);const x=this.cacheMap.get(c),L=e.toString();p.get(m).add(L),x.put(Xc(e.toString(),s),a)}removeImagesFromCacheByIds(e,a,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const c=this.cacheMap.get(s),p=this.cacheDependenciesMap.get(s);for(const m of e){const x=Xc(m.toString(),a);if(p.has(x)){for(const L of p.get(x))c.delete(L);p.delete(x)}}}rasterize(e,a,s,c,p=mA){const m=this.getFromCache(e,s,c);if(m)return m.clone();const x=p(a.icon,e.options),L=Ax._getImage(x);return this.setInCache(e,L,s,c),L.clone()}}class q2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,a){const s=this.toIdx(e,a);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,a){return this.leaves[this.toIdx(e,a)]}toIdx(e,a){return a*this.size+e}}function K2(r,e,a,s){let c=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(a[m]<r[m]||a[m]>e[m])return null}else{const x=1/s[m];let L=(r[m]-a[m])*x,N=(e[m]-a[m])*x;if(L>N){const R=L;L=N,N=R}if(L>c&&(c=L),N<p&&(p=N),c>p)return null}return c}function e3(r,e,a,s,c,p,m,x,L,N,R){const T=s-r,V=c-e,F=p-a,O=m-r,Q=x-e,$=L-a,K=R[1]*$-R[2]*Q,ie=R[2]*O-R[0]*$,le=R[0]*Q-R[1]*O,de=T*K+V*ie+F*le;if(Math.abs(de)<1e-15)return null;const Ee=1/de,Le=N[0]-r,Ae=N[1]-e,Me=N[2]-a,Je=(Le*K+Ae*ie+Me*le)*Ee;if(Je<0||Je>1)return null;const ot=Ae*F-Me*V,We=Me*T-Le*F,ut=Le*V-Ae*T,_t=(R[0]*ot+R[1]*We+R[2]*ut)*Ee;return _t<0||Je+_t>1?null:(O*ot+Q*We+$*ut)*Ee}function t3(r,e,a){return(r-e)/(a-e)}function a3(r,e,a,s,c,p,m,x,L){const N=1<<a,R=p-s,T=m-c,V=(r+1)/N*R+s,F=(e+0)/N*T+c,O=(e+1)/N*T+c;x[0]=(r+0)/N*R+s,x[1]=F,L[0]=V,L[1]=O}class r3{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(p){const m=Math.ceil(Math.log2(p.dim/8)),x=[];let L=Math.ceil(Math.pow(2,m));const N=1/L,R=(F,O,Q,$,K)=>{const ie=$?1:0,le=(F+1)*Q-ie,de=O*Q,Ee=(O+1)*Q-ie;K[0]=F*Q,K[1]=de,K[2]=le,K[3]=Ee};let T=new q2(L);const V=[];for(let F=0;F<L*L;F++){R(F%L,Math.floor(F/L),N,!1,V);const O=Cf(V[0],V[1],p),Q=Cf(V[2],V[1],p),$=Cf(V[2],V[3],p),K=Cf(V[0],V[3],p);T.minimums.push(Math.min(O,Q,$,K)),T.maximums.push(Math.max(O,Q,$,K)),T.leaves.push(1)}for(x.push(T),L/=2;L>=1;L/=2){const F=x[x.length-1];T=new q2(L);for(let O=0;O<L*L;O++){R(O%L,Math.floor(O/L),2,!0,V);const Q=F.getElevation(V[0],V[1]),$=F.getElevation(V[2],V[1]),K=F.getElevation(V[2],V[3]),ie=F.getElevation(V[0],V[3]),le=F.isLeaf(V[0],V[1]),de=F.isLeaf(V[2],V[1]),Ee=F.isLeaf(V[2],V[3]),Le=F.isLeaf(V[0],V[3]),Ae=Math.min(Q.min,$.min,K.min,ie.min),Me=Math.max(Q.max,$.max,K.max,ie.max),Je=le&&de&&Ee&&Le;T.maximums.push(Me),T.minimums.push(Ae),T.leaves.push(Me-Ae<=5&&Je?1:0)}x.push(T)}return x}(this.dem),s=a.length-1,c=a[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(a,0,0,s,0)}raycastRoot(e,a,s,c,p,m,x=1){return K2([e,a,-100],[s,c,this.maximums[0]*x],p,m)}raycast(e,a,s,c,p,m,x=1){if(!this.nodeCount)return null;const L=this.raycastRoot(e,a,s,c,p,m,x);if(L==null)return null;const N=[],R=[],T=[],V=[],F=[{idx:0,t:L,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:O,t:Q,nodex:$,nodey:K,depth:ie}=F.pop();if(this.leaves[O]){a3($,K,ie,e,a,s,c,T,V);const de=1<<ie,Ee=($+0)/de,Le=($+1)/de,Ae=(K+0)/de,Me=(K+1)/de,Je=Cf(Ee,Ae,this.dem)*x,ot=Cf(Le,Ae,this.dem)*x,We=Cf(Le,Me,this.dem)*x,ut=Cf(Ee,Me,this.dem)*x,_t=e3(T[0],T[1],Je,V[0],T[1],ot,V[0],V[1],We,p,m),Zt=e3(V[0],V[1],We,T[0],V[1],ut,T[0],T[1],Je,p,m),Pt=Math.min(_t!==null?_t:Number.MAX_VALUE,Zt!==null?Zt:Number.MAX_VALUE);if(Pt!==Number.MAX_VALUE)return Pt;{const At=ba([],p,m,Q);if(n3(Je,ot,ut,We,t3(At[0],T[0],V[0]),t3(At[1],T[1],V[1]))>=At[2])return Q}continue}let le=0;for(let de=0;de<this._siblingOffset.length;de++){a3(($<<1)+this._siblingOffset[de][0],(K<<1)+this._siblingOffset[de][1],ie+1,e,a,s,c,T,V),T[2]=-100,V[2]=this.maximums[this.childOffsets[O]+de]*x;const Ee=K2(T,V,p,m);if(Ee!=null){const Le=Ee;N[de]=Le;let Ae=!1;for(let Me=0;Me<le&&!Ae;Me++)Le>=N[R[Me]]&&(R.splice(Me,0,de),Ae=!0);Ae||(R[le]=de),le++}}for(let de=0;de<le;de++){const Ee=R[de];F.push({idx:this.childOffsets[O]+Ee,t:N[Ee],nodex:($<<1)+this._siblingOffset[Ee][0],nodey:(K<<1)+this._siblingOffset[Ee][1],depth:ie+1})}}return null}_addNode(e,a,s){return this.minimums.push(e),this.maximums.push(a),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,a,s,c,p){if(e[c].isLeaf(a,s)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=c-1,x=e[m];let L=0,N=0;for(let R=0;R<this._siblingOffset.length;R++){const T=2*a+this._siblingOffset[R][0],V=2*s+this._siblingOffset[R][1],F=x.getElevation(T,V),O=x.isLeaf(T,V),Q=this._addNode(F.min,F.max,O);O&&(L|=1<<R),N||(N=Q)}for(let R=0;R<this._siblingOffset.length;R++)L&1<<R||this._construct(e,2*a+this._siblingOffset[R][0],2*s+this._siblingOffset[R][1],m,N+R)}}function n3(r,e,a,s,c,p){return Sa(Sa(r,a,p),Sa(e,s,p),c)}function Cf(r,e,a){const s=a.dim,c=re(r*s-.5,0,s-1),p=re(e*s-.5,0,s-1),m=Math.floor(c),x=Math.floor(p),L=Math.min(m+1,s-1),N=Math.min(x+1,s-1);return n3(a.get(m,x),a.get(L,x),a.get(m,N),a.get(L,N),c-m,p-x)}const yA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function gA(r,e,a){return(256*r*256+256*e+a)/10-1e4}function _A(r,e,a){return 256*r+e+a/256-32768}class b0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,a,s,c=!1){if(this.uid=e,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Za(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const p=this.dim=a.height-2,m=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let L=0;L<p;L++)m[this._idx(-1,L)]=m[this._idx(0,L)],m[this._idx(p,L)]=m[this._idx(p-1,L)],m[this._idx(L,-1)]=m[this._idx(L,0)],m[this._idx(L,p)]=m[this._idx(L,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const x=s==="terrarium"?_A:gA;for(let L=0;L<m.length;++L){const N=4*L;this.floatView[L]=x(this.pixels[N],this.pixels[N+1],this.pixels[N+2])}this._timestamp=Qs.now()}_buildQuadTree(){this._tree=new r3(this)}get(e,a,s=!1){s&&(e=re(e,-1,this.dim),a=re(a,-1,this.dim));const c=this._idx(e,a);return this.floatView[c]}set(e,a,s){const c=this._idx(e,a),p=this.floatView[c];return this.floatView[c]=s,s-p}static getUnpackVector(e){return yA[e]}_idx(e,a){if(e<-1||e>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(e+1)}static pack(e,a){const s=[0,0,0,0],c=b0.getUnpackVector(a);let p=Math.floor((e+c[3])/c[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new $v({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,a,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=a*this.dim,p=a*this.dim+this.dim,m=s*this.dim,x=s*this.dim+this.dim;switch(a){case-1:c=p-1;break;case 1:p=c+1}switch(s){case-1:m=x-1;break;case 1:x=m+1}const L=-a*this.dim,N=-s*this.dim;for(let R=m;R<x;R++)for(let T=c;T<p;T++){const V=4*this._idx(T,R),F=4*this._idx(T+L,R+N);this.pixels[V+0]=e.pixels[F+0],this.pixels[V+1]=e.pixels[F+1],this.pixels[V+2]=e.pixels[F+2],this.pixels[V+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function xA(r,e,a){r===1?e.headerLength=a.readFixed32():r===2?e.x=a.readVarint():r===3?e.y=a.readVarint():r===4?e.z=a.readVarint():r===5&&e.layers.push(function(s,c){return s.readFields(jA,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(a,a.readVarint()+a.pos))}function wA(r,e,a){r===1?(e.delta_filter=function(s,c){return s.readFields(vA,{blockSize:0},c)}(a,a.readVarint()+a.pos),e.filter="delta_filter"):r===2?(a.readVarint(),e.filter="zigzag_filter"):r===3?(a.readVarint(),e.filter="bitshuffle_filter"):r===4&&(a.readVarint(),e.filter="byteshuffle_filter")}function vA(r,e,a){r===1&&(e.blockSize=a.readVarint())}function bA(r,e,a){r===1?(a.readVarint(),e.codec="gzip_data"):r===2?(a.readVarint(),e.codec="jpeg_image"):r===3?(a.readVarint(),e.codec="webp_image"):r===4&&(a.readVarint(),e.codec="png_image")}function LA(r,e,a){let s=0,c=0;r===1?e.firstByte=a.readFixed64():r===2?e.lastByte=a.readFixed64():r===3?e.filters.push(function(p,m){return p.readFields(wA,{},m)}(a,a.readVarint()+a.pos)):r===4?e.codec=function(p,m){return p.readFields(bA,{},m)}(a,a.readVarint()+a.pos):r===5?c=a.readFloat():r===6?s=a.readFloat():r===7?e.bands.push(a.readString()):r===8?e.offset=a.readDouble():r===9&&(e.scale=a.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=s)}function jA(r,e,a){r===1?e.version=a.readVarint():r===2?e.name=a.readString():r===3?e.units=a.readString():r===4?e.tileSize=a.readVarint():r===5?e.buffer=a.readVarint():r===6?e.pixelFormat=a.readVarint():r===7&&e.dataIndex.push(function(s,c){return s.readFields(LA,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(a,a.readVarint()+a.pos))}function ZA(r,e,a){if(r===2)(function(s,c,p){s.readFields(NA,p,c)})(a,a.readVarint()+a.pos,e);else if(r===3)throw new Error("Not implemented")}function NA(r,e,a){if(r===1){let s=0;const c=a.readVarint()+a.pos;for(;a.pos<c;)e[s++]=a.readVarint()}}function EA(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let a=e[3];for(let s=2;s>=1;s--){const c=s===1?1:0,p=s===2?1:0;for(let m=0;m<e[0];m++){const x=e[1]*m;for(let L=c;L<e[1];L++){const N=e[2]*(L+x);for(let R=p;R<e[2];R++){const T=e[3]*(R+N);for(let V=0;V<e[3];V++){const F=T+V;r[F]+=r[F-a]}}}}a*=e[s]}return r}function SA(r){for(let e=0,a=r.length;e<a;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function zA(r,e){switch(e){case"uint32":return r;case"uint16":for(let a=0;a<r.length;a+=2){const s=r[a],c=r[a+1];r[a]=(240&s)>>4|(61440&s)>>8|(240&c)<<4|61440&c,r[a+1]=15&s|(3840&s)>>4|(15&c)<<8|(3840&c)<<4}return r;case"uint8":for(let a=0;a<r.length;a+=4){const s=r[a],c=r[a+1],p=r[a+2],m=r[a+3];r[a+0]=(192&s)>>6|(192&c)>>4|(192&p)>>2|192&m,r[a+1]=(48&s)>>4|(48&c)>>2|48&p|(48&m)<<2,r[a+2]=(12&s)>>2|12&c|(12&p)<<2|(12&m)<<4,r[a+3]=3&s|(3&c)<<2|(3&p)<<4|(3&m)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}na(b0,"DEMData"),na(r3,"DemMinMaxQuadTree",{omit:["dem"]});var mc=Uint8Array,$y=Uint16Array,AA=Int32Array,i3=new mc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s3=new mc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),RA=new mc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o3=function(r,e){for(var a=new $y(31),s=0;s<31;++s)a[s]=e+=1<<r[s-1];var c=new AA(a[30]);for(s=1;s<30;++s)for(var p=a[s];p<a[s+1];++p)c[p]=p-a[s]<<5|s;return{b:a,r:c}},l3=o3(i3,2),c3=l3.b,TA=l3.r;c3[28]=258,TA[258]=28;for(var VA=o3(s3,0).b,u3=new $y(32768),Ci=0;Ci<32768;++Ci){var Rm=(43690&Ci)>>1|(21845&Ci)<<1;u3[Ci]=((65280&(Rm=(61680&(Rm=(52428&Rm)>>2|(13107&Rm)<<2))>>4|(3855&Rm)<<4))>>8|(255&Rm)<<8)>>1}var qy=function(r,e,a){for(var s=r.length,c=0,p=new $y(e);c<s;++c)r[c]&&++p[r[c]-1];var m,x=new $y(e);for(c=1;c<e;++c)x[c]=x[c-1]+p[c-1]<<1;m=new $y(1<<e);var L=15-e;for(c=0;c<s;++c)if(r[c])for(var N=c<<4|r[c],R=e-r[c],T=x[r[c]-1]++<<R,V=T|(1<<R)-1;T<=V;++T)m[u3[T]>>L]=N;return m},Ky=new mc(288);for(Ci=0;Ci<144;++Ci)Ky[Ci]=8;for(Ci=144;Ci<256;++Ci)Ky[Ci]=9;for(Ci=256;Ci<280;++Ci)Ky[Ci]=7;for(Ci=280;Ci<288;++Ci)Ky[Ci]=8;var d3=new mc(32);for(Ci=0;Ci<32;++Ci)d3[Ci]=5;var MA=qy(Ky,9),BA=qy(d3,5),Rx=function(r){for(var e=r[0],a=1;a<r.length;++a)r[a]>e&&(e=r[a]);return e},Uu=function(r,e,a){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(7&e)&a},Tx=function(r,e){var a=e/8|0;return(r[a]|r[a+1]<<8|r[a+2]<<16)>>(7&e)},IA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wu=function(r,e,a){var s=new Error(e||IA[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,Wu),!a)throw s;return s},kA=new mc(0),JA=typeof TextDecoder<"u"&&new TextDecoder;try{JA.decode(kA,{stream:!0})}catch{}const FA={gzip_data:"gzip"};class Yc extends Error{constructor(e){super(e),this.name="MRTError"}}const OA={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},h3={uint32:1,uint16:2,uint8:4},DA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Vx;class L0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const a=this.layers[e];if(!a)throw new Yc(`Layer '${e}' not found`);return a}getHeaderLength(e){const a=new Uint8Array(e),s=new DataView(e);if(a[0]!==13)throw new Yc("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const a=new Uint8Array(e),s=this.getHeaderLength(e);if(a.length<s)throw new Yc(`Expected header with length >= ${s} but got buffer of length ${a.length}`);const c=new Vx(a.subarray(0,s)).readFields(xA,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new Yc(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const p of c.layers)this.layers[p.name]=new f3(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const a=[],s=this.getLayer(e.layerName);for(let c of e.blockIndices){const p=s.dataIndex[c],m=p.firstByte-e.firstByte,x=p.lastByte-e.firstByte;if(s._blocksInProgress.has(c))continue;const L={layerName:s.name,firstByte:m,lastByte:x,pixelFormat:s.pixelFormat,blockIndex:c,blockShape:[p.bands.length].concat(s.bandShape),buffer:s.buffer,codec:p.codec.codec,filters:p.filters.map(N=>N.filter)};s._blocksInProgress.add(c),a.push(L)}return new p3(a,()=>{a.forEach(c=>s._blocksInProgress.delete(c.blockIndex))},(c,p)=>{if(a.forEach(m=>s._blocksInProgress.delete(m.blockIndex)),c)throw c;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class f3{constructor({version:e,name:a,units:s,tileSize:c,pixelFormat:p,buffer:m,dataIndex:x},L){if(this.version=e,this.version!==1)throw new Yc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=a,this.units=s,this.tileSize=c,this.buffer=m,this.pixelFormat=OA[p],this.dataIndex=x,this.bandShape=[c+2*m,c+2*m,h3[this.pixelFormat]],this._decodedBlocks=new v0(L?L.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return h3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const a=e.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,e.data)}getBlockForBand(e){let a=0;switch(typeof e){case"string":for(const[s,c]of this.dataIndex.entries()){for(const[p,m]of c.bands.entries())if(m===e)return{bandIndex:a+p,blockIndex:s,blockBandIndex:p};a+=c.bands.length}break;case"number":for(const[s,c]of this.dataIndex.entries()){if(e>=a&&e<a+c.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-a};a+=c.bands.length}break;default:throw new Yc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let a=1/0,s=-1/0;const c=[],p=new Set;for(const m of e){const{blockIndex:x}=this.getBlockForBand(m);if(x<0)throw new Yc(`Invalid band: ${JSON.stringify(m)}`);const L=this.dataIndex[x];c.includes(x)||c.push(x),p.add(x),a=Math.min(a,L.firstByte),s=Math.max(s,L.lastByte)}if(p.size>this.cacheSize)throw new Yc(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:s,blockIndices:c}}hasBand(e){const{blockIndex:a}=this.getBlockForBand(e);return a>=0}hasDataForBand(e){const{blockIndex:a}=this.getBlockForBand(e);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(e){const{blockIndex:a,blockBandIndex:s}=this.getBlockForBand(e);if(a<0)throw new Yc(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(a.toString());if(!c)throw new Yc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[a],m=this.bandShape.reduce((N,R)=>N*R,1),x=s*m,L=c.subarray(x,x+m);return{data:L,bytes:new Uint8Array(L.buffer).subarray(L.byteOffset,L.byteOffset+L.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}L0.setPbf=function(r){Vx=r};class p3{constructor(e,a,s){this.tasks=e,this._onCancel=a,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,a){this._finalized||(this._onComplete(e,a),this._finalized=!0)}}L0.performDecoding=function(r,e){const a=new Uint8Array(r);return Promise.all(e.tasks.map(s=>{const{layerName:c,firstByte:p,lastByte:m,pixelFormat:x,blockShape:L,blockIndex:N,filters:R,codec:T}=s,V=a.subarray(p,m+1),F=new Uint32Array(L[0]*L[1]*L[2]);let O;if(T!=="gzip_data")throw new Yc(`Unhandled codec: ${T}`);return O=function(Q,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((de=function(Ae){Ae[0]==31&&Ae[1]==139&&Ae[2]==8||Wu(6,"invalid gzip data");var Me=Ae[3],Je=10;4&Me&&(Je+=2+(Ae[10]|Ae[11]<<8));for(var ot=(Me>>3&1)+(Me>>4&1);ot>0;ot-=!Ae[Je++]);return Je+(2&Me)}(le=Q))+8>le.length&&Wu(6,"invalid gzip data"),function(Ae,Me,Je,ot){var We=Ae.length;if(!We||Me.f&&!Me.l)return Je||new mc(0);var ut=!Je,_t=ut||Me.i!=2,Zt=Me.i;ut&&(Je=new mc(3*We));var Pt,At,xt=function(Un){var Zn=Je.length;if(Un>Zn){var hn=new mc(Math.max(2*Zn,Un));hn.set(Je),Je=hn}},zt=Me.f||0,nt=Me.p||0,rt=Me.b||0,Et=Me.l,Jt=Me.d,vt=Me.m,sa=Me.n,ua=8*We;do{if(!Et){zt=Uu(Ae,nt,1);var ta=Uu(Ae,nt+1,3);if(nt+=3,!ta){var Yt=Ae[(je=4+((nt+7)/8|0))-4]|Ae[je-3]<<8,Fa=je+Yt;if(Fa>We){Zt&&Wu(0);break}_t&&xt(rt+Yt),Je.set(Ae.subarray(je,Fa),rt),Me.b=rt+=Yt,Me.p=nt=8*Fa,Me.f=zt;continue}if(ta==1)Et=MA,Jt=BA,vt=9,sa=5;else if(ta==2){var ea=Uu(Ae,nt,31)+257,ja=Uu(Ae,nt+10,15)+4,Da=ea+Uu(Ae,nt+5,31)+1;nt+=14;for(var nr=new mc(Da),Zr=new mc(19),Pa=0;Pa<ja;++Pa)Zr[RA[Pa]]=Uu(Ae,nt+3*Pa,7);nt+=3*ja;var Br=Rx(Zr),Ir=(1<<Br)-1,In=qy(Zr,Br);for(Pa=0;Pa<Da;){var je,_e=In[Uu(Ae,nt,Ir)];if(nt+=15&_e,(je=_e>>4)<16)nr[Pa++]=je;else{var ft=0,Xt=0;for(je==16?(Xt=3+Uu(Ae,nt,3),nt+=2,ft=nr[Pa-1]):je==17?(Xt=3+Uu(Ae,nt,7),nt+=3):je==18&&(Xt=11+Uu(Ae,nt,127),nt+=7);Xt--;)nr[Pa++]=ft}}var pt=nr.subarray(0,ea),$t=nr.subarray(ea);vt=Rx(pt),sa=Rx($t),Et=qy(pt,vt),Jt=qy($t,sa)}else Wu(1);if(nt>ua){Zt&&Wu(0);break}}_t&&xt(rt+131072);for(var pa=(1<<vt)-1,fa=(1<<sa)-1,Xa=nt;;Xa=nt){var Aa=(ft=Et[Tx(Ae,nt)&pa])>>4;if((nt+=15&ft)>ua){Zt&&Wu(0);break}if(ft||Wu(2),Aa<256)Je[rt++]=Aa;else{if(Aa==256){Xa=nt,Et=null;break}var da=Aa-254;Aa>264&&(da=Uu(Ae,nt,(1<<(Ma=i3[Pa=Aa-257]))-1)+c3[Pa],nt+=Ma);var Vr=Jt[Tx(Ae,nt)&fa],tn=Vr>>4;if(Vr||Wu(3),nt+=15&Vr,$t=VA[tn],tn>3){var Ma=s3[tn];$t+=Tx(Ae,nt)&(1<<Ma)-1,nt+=Ma}if(nt>ua){Zt&&Wu(0);break}_t&&xt(rt+131072);var Lr=rt+da;if(rt<$t){var an=0-$t,Ur=Math.min($t,Lr);for(an+rt<0&&Wu(3);rt<Ur;++rt)Je[rt]=(void 0)[an+rt]}for(;rt<Lr;++rt)Je[rt]=Je[rt-$t]}}Me.l=Et,Me.p=Xa,Me.b=rt,Me.f=zt,Et&&(zt=1,Me.m=vt,Me.d=Jt,Me.n=sa)}while(!zt);return rt!=Je.length&&ut?(Pt=Je,((At=rt)==null||At>Pt.length)&&(At=Pt.length),new mc(Pt.subarray(0,At))):Je.subarray(0,rt)}(le.subarray(de,-8),{i:2},new mc(((K=le)[(ie=K.length)-4]|K[ie-3]<<8|K[ie-2]<<16|K[ie-1]<<24)>>>0))));var K,ie,le,de;const Ee=FA[$];if(!Ee)throw new Error(`Unhandled codec: ${$}`);const Le=new globalThis.DecompressionStream(Ee);return new Response(new Blob([Q]).stream().pipeThrough(Le)).arrayBuffer().then(Ae=>new Uint8Array(Ae))}(V,T).then(Q=>(function($,K){$.readFields(ZA,K)}(new Vx(Q),F),new DA[x](F.buffer))),O.then(Q=>{for(let $=R.length-1;$>=0;$--)switch(R[$]){case"delta_filter":EA(Q,L);break;case"zigzag_filter":SA(Q);break;case"bitshuffle_filter":zA(Q,x);break;default:throw new Yc(`Unhandled filter "${R[$]}"`)}return{layerName:c,blockIndex:N,data:Q}}).catch(Q=>{throw Q})}))},na(p3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),na(L0,"MapboxRasterTile"),na(f3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class m3{constructor(e){this._stringToNumber={},this._numberToString=[];for(let a=0;a<e.length;a++){const s=e[a];this._stringToNumber[s]=a,this._numberToString[a]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class y3{constructor(e,a){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fs(Dt,16,0),this.featureIndexArray=new vp,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,a,s,c,p,m=0,x=0){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,p,m);const N=this.grid;for(let R=0;R<a.length;R++){const T=a[R],V=[1/0,1/0,-1/0,-1/0];for(let F=0;F<T.length;F++){const O=T[F];V[0]=Math.min(V[0],O.x),V[1]=Math.min(V[1],O.y),V[2]=Math.max(V[2],O.x),V[3]=Math.max(V[3],O.y)}x!==0&&(V[0]-=x,V[1]-=x,V[2]+=x,V[3]+=x),V[0]<Dt&&V[1]<Dt&&V[2]>=0&&V[3]>=0&&N.insert(L,V[0],V[1],V[2],V[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new la(new Kg(this.rawTileData)).layers,this.sourceLayerCoder=new m3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,a){const{tilespaceGeometry:s,transform:c,tileTransform:p,pixelPosMatrix:m,availableImages:x,worldview:L}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const N=a.queryRadius?a.queryRadius:0,R=s.bufferedTilespaceBounds,T=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(Q,$,K,ie)=>vn(s.bufferedTilespaceGeometry,Q-N,$-N,K+N,ie+N));T.sort(CA);let V=null;c.elevation&&T.length>0&&(V=Sm.create(c.elevation,this.tileID));const F={};let O;for(let Q=0;Q<T.length;Q++){const $=T[Q];if($===O)continue;O=$;const K=this.featureIndexArray.get($);let ie=null;this.is3DTile?this.loadMatchingModelFeature(F,K,e,s,c,L):this.loadMatchingFeature(F,K,e,x,L,(le,de,Ee,Le=0)=>(ie||(ie=ct(le,this.tileID.canonical,p)),de.queryIntersectsFeature(s,le,Ee,ie,this.z,c,m,V,Le)))}return F}loadMatchingFeature(e,a,s,c,p,m){const{featureIndex:x,bucketIndex:L,sourceLayerIndex:N,layoutVertexArrayOffset:R}=a,T=this.bucketLayerIDs[L],V=s.layers,F=Object.keys(V);if(F.length&&!Ia(F,T))return;const O=s.sourceCache,Q=this.sourceLayerCoder.decode(N),$=this.vtLayers[Q].feature(x),K=this.getId($,Q);for(let ie=0;ie<T.length;ie++){const le=T[ie];if(!V[le])continue;const{styleLayer:de,targets:Ee}=V[le];let Le={};K!==void 0&&(Le=O.getFeatureState(de.sourceLayer,K));const Ae=!m||m($,de,Le,R);if(!Ae)continue;const Me=new Vp($,this.z,this.x,this.y,K);Me.tile=this.tileID.canonical,Me.state=Le;let Je=this.serializedLayersCache.get(le);Je||(Je=de.serialize(),Je.id=le,this.serializedLayersCache.set(le,Je)),Me.source=Je.source,Me.sourceLayer=Je["source-layer"],Me.layer=Object.assign({},Je),Me.layer.paint=g3(Je.paint,de.paint,$,Le,c),Me.layer.layout=g3(Je.layout,de.layout,$,Le,c);let ot=!1;for(const We of Ee){this.updateFeatureProperties(Me,We);const{filter:ut}=We;if(ut){if($.properties=Me.properties,ut.needGeometry){const _t=et($,!0);if(!ut.filter(new $r(this.tileID.overscaledZ,{worldview:p}),_t,this.tileID.canonical))continue}else if(!ut.filter(new $r(this.tileID.overscaledZ,{worldview:p}),$))continue}ot=!0,We.targetId&&this.addFeatureVariant(Me,We)}ot&&this.appendToResult(e,le,x,Me,Ae)}}loadMatchingModelFeature(e,a,s,c,p,m){const{featureIndex:x,bucketIndex:L}=a,N=this.bucketLayerIDs[L],R=s.layers,T=Object.keys(R);if(!T.length||Ia(T,N))for(let V=0;V<N.length;V++){const F=N[V],{styleLayer:O,targets:Q}=R[F];if(O.type!=="model")continue;const $=c.tile,K=$.getBucket(O);if(!(K&&K instanceof y0))continue;const ie=Qz(K,x,c,p);if(!ie)continue;const{z:le,x:de,y:Ee}=$.tileID.canonical,{feature:Le,intersectionZ:Ae,position:Me}=ie;let Je={};Le.id!==void 0&&(Je=s.sourceCache.getFeatureState(O.sourceLayer,Le.id));const ot=new Vp({},le,de,Ee,Le.id);ot.tile=this.tileID.canonical,ot.state=Je,ot.properties=Le.properties,ot.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let We=this.serializedLayersCache.get(F);We||(We=O.serialize(),We.id=F,this.serializedLayersCache.set(F,We)),ot.source=We.source,ot.sourceLayer=We["source-layer"],ot.layer=Object.assign({},We);let ut=!1;for(const _t of Q){this.updateFeatureProperties(ot,_t);const{filter:Zt}=_t;if(Zt){if(Le.properties=ot.properties,Zt.needGeometry){if(!Zt.filter(new $r(this.tileID.overscaledZ,{worldview:m}),Le,this.tileID.canonical))continue}else if(!Zt.filter(new $r(this.tileID.overscaledZ,{worldview:m}),Le))continue}ut=!0,_t.targetId&&this.addFeatureVariant(ot,_t)}ut&&this.appendToResult(e,F,x,ot,Ae)}}updateFeatureProperties(e,a,s){if(a.properties){const c={};for(const p in a.properties){const m=a.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);m!=null&&(c[p]=m)}e.properties=c}}addFeatureVariant(e,a,s){const c={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[a.targetId]=e.variants[a.targetId]||[],e.variants[a.targetId].push(c)}appendToResult(e,a,s,c,p){let m=e[a];m===void 0&&(m=e[a]=[]),m.push({featureIndex:s,feature:c,intersectionZ:p})}lookupSymbolFeatures(e,a,s,c,p,m){const x={};this.loadVTLayers();for(const L of e)this.loadMatchingFeature(x,{bucketIndex:a,sourceLayerIndex:s,featureIndex:L,layoutVertexArrayOffset:0},c,p,m);return x}loadFeature(e){const{featureIndex:a,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),p=this.vtFeatures[c];if(p[a])return p[a];const m=this.vtLayers[c].feature(a);return p[a]=m,m}hasLayer(e){for(const a of this.bucketLayerIDs)for(const s of a)if(e===s)return!0;return!1}getId(e,a){let s=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const p=Js(c);if(p.result!=="success"){const m=p.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Za(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=p.value}s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[c];typeof s=="boolean"&&(s=Number(s))}return s}}function g3(r,e,a,s,c){return Vt(r,(p,m)=>{const x=e instanceof fl?e.get(m):null;return x&&x.evaluate?x.evaluate(a,s,void 0,c):x})}function CA(r,e){return e-r}na(y3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const _3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Mx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,s]=new Uint8Array(e,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const p=_3[15&s];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Mx(x,m,p,e)}constructor(e,a=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=_3.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+L,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+L),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+L,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=e)}add(e,a){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=a,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Bx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,a,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:x}=this,L=[0,p.length-1,0],N=[];for(;L.length;){const R=L.pop()||0,T=L.pop()||0,V=L.pop()||0;if(T-V<=x){for(let $=V;$<=T;$++){const K=m[2*$],ie=m[2*$+1];K>=e&&K<=s&&ie>=a&&ie<=c&&N.push(p[$])}continue}const F=V+T>>1,O=m[2*F],Q=m[2*F+1];O>=e&&O<=s&&Q>=a&&Q<=c&&N.push(p[F]),(R===0?e<=O:a<=Q)&&(L.push(V),L.push(F-1),L.push(1-R)),(R===0?s>=O:c>=Q)&&(L.push(F+1),L.push(T),L.push(1-R))}return N}within(e,a,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:m}=this,x=[0,c.length-1,0],L=[],N=s*s;for(;x.length;){const R=x.pop()||0,T=x.pop()||0,V=x.pop()||0;if(T-V<=m){for(let $=V;$<=T;$++)w3(p[2*$],p[2*$+1],e,a)<=N&&L.push(c[$]);continue}const F=V+T>>1,O=p[2*F],Q=p[2*F+1];w3(O,Q,e,a)<=N&&L.push(c[F]),(R===0?e-s<=O:a-s<=Q)&&(x.push(V),x.push(F-1),x.push(1-R)),(R===0?e+s>=O:a+s>=Q)&&(x.push(F+1),x.push(T),x.push(1-R))}return L}}function Bx(r,e,a,s,c,p){if(c-s<=a)return;const m=s+c>>1;x3(r,e,m,s,c,p),Bx(r,e,a,s,m-1,1-p),Bx(r,e,a,m+1,c,1-p)}function x3(r,e,a,s,c,p){for(;c>s;){if(c-s>600){const N=c-s+1,R=a-s+1,T=Math.log(N),V=.5*Math.exp(2*T/3),F=.5*Math.sqrt(T*V*(N-V)/N)*(R-N/2<0?-1:1);x3(r,e,a,Math.max(s,Math.floor(a-R*V/N+F)),Math.min(c,Math.floor(a+(N-R)*V/N+F)),p)}const m=e[2*a+p];let x=s,L=c;for(eg(r,e,s,a),e[2*c+p]>m&&eg(r,e,s,c);x<L;){for(eg(r,e,x,L),x++,L--;e[2*x+p]<m;)x++;for(;e[2*L+p]>m;)L--}e[2*s+p]===m?eg(r,e,s,L):(L++,eg(r,e,L,c)),L<=a&&(s=L+1),a<=L&&(c=L-1)}}function eg(r,e,a,s){Ix(r,a,s),Ix(e,2*a,2*s),Ix(e,2*a+1,2*s+1)}function Ix(r,e,a){const s=r[e];r[e]=r[a],r[a]=s}function w3(r,e,a,s){const c=r-a,p=e-s;return c*c+p*p}n.$=oh,n.A=Kl,n.B=Xc,n.C=2,n.D=mm,n.E=Nl,n.F=Iy,n.G=W1,n.H=af,n.I=xn,n.J=bf,n.K=od,n.L=ld,n.M=Zh,n.N=ff,n.O=vd,n.P=St,n.Q=Ld,n.R=rl,n.S=zu,n.T=W_,n.U=Js,n.V=m0,n.W=Sh,n.X=hd,n.Y=xu,n.Z=gh,n._=ms,n.a=function(r){return sn.API_CDN_URL_REGEX.test(r)},n.a$=Es,n.a0=Ba,n.a1=cu,n.a2=Au,n.a3=class extends m0{},n.a4=Nh,n.a5=Nu,n.a6=Ue,n.a7=function(r){const e=r.value;return e?Ba(e)?bx(e,!0)?[]:[new m0(r.key,e,`invalid url "${e}"`)]:[new m0(r.key,e,`string expected, "${od(e)}" found`)]:[]},n.a8=wf,n.a9=Mn,n.aA=re,n.aB=ke,n.aC=Xi,n.aD=On,n.aE=vi,n.aF=ne,n.aG=it,n.aH=function(r,e){const a={};for(let s=0;s<e.length;s++){const c=e[s];c in r&&(a[c]=r[c])}return a},n.aI=J,n.aJ=ae,n.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,a,s){const c=this.entries[r]=this.entries[r]||{callbacks:[]};if(c.result){const[p,m]=c.result;return this.scheduler?this.scheduler.add(()=>{s(p,m)},e):s(p,m),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=a((p,m)=>{c.result=[p,m];for(const x of c.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,m)},e):x(p,m);setTimeout(()=>delete this.entries[r],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(p=>p!==s),c.callbacks.length||(c.cancel(),delete this.entries[r]))}}},n.aL=function(r,e,a){const s=JSON.stringify(r.request);return r.data&&(this.deduped.entries[s]={result:[null,r.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},c=>{const p=iu(r.request,(m,x,L)=>{m?c(m):x&&c(null,{vectorTile:a?void 0:new la(new Kg(x)),rawData:x,responseHeaders:new Map(L.entries())})});return()=>{p.cancel(),c()}},e)},n.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},n.aN=function(r){tl++,tl>hs&&(r.getActor().send("enforceCacheSizeLimit",ed),tl=0)},n.aO=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},n.aP=k,n.aQ=v2,n.aR=E2,n.aS=C,n.aT=w2,n.aU=function(r,e){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){e(null,a)};for(let s=0;s<r.length;s++){const c=document.createElement("source");zr(r[s])||(a.crossOrigin="Anonymous"),c.src=r[s],a.appendChild(c)}return{cancel:()=>{}}},n.aV=Ry,n.aW=Mp,n.aX=tt,n.aY=Oy,n.aZ=he,n.a_=ce,n.aa=Tt,n.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Fr(r.expression.evaluate(e))}interpolate(r,e,a){return{x:Sa(r.x,e.x,a),y:Sa(r.y,e.y,a),z:Sa(r.z,e.z,a),azimuthal:Sa(r.azimuthal,e.azimuthal,a),polar:Sa(r.polar,e.polar,a)}}},n.ac=$r,n.ad=ro,n.ae=Pe,n.af=ln,n.ag=ht,n.ah=xe,n.ai=fl,n.aj=kf,n.ak=Sa,n.al=Dt,n.am=nd,n.an=fr,n.ao=Or,n.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([a,s]){const c=Fr([1,a,s]);return{x:c.x,y:c.y,z:c.z}}(r.expression.evaluate(e))}interpolate(r,e,a){return{x:Sa(r.x,e.x,a),y:Sa(r.y,e.y,a),z:Sa(r.z,e.z,a)}}},n.aq=function(r,e,a=0,s=!0){const c=new St(a,a),p=r.sub(c),m=e.add(c),x=[p,new St(m.x,p.y),m,new St(p.x,m.y)];return s&&x.push(p.clone()),x},n.ar=function(r,e){const a=[];for(let s=0;s<r.length;s++){const c=Ve(s-1,-1,r.length-1),p=Ve(s+1,-1,r.length-1),m=r[s],x=r[p],L=r[c].sub(m).unit(),N=x.sub(m).unit(),R=N.angleWithSep(L.x,L.y),T=L.add(N).unit().mult(-1*e/Math.sin(R/2));a.push(m.add(T))}return a},n.as=i2,n.at=vn,n.au=function(r,e,a=0){return Wt(((e.x-a)*r.scale-r.x)*Dt,(e.y*r.scale-r.y)*Dt,Ze(e.z,e.y))},n.av=Sr,n.aw=ka,n.ax=Ua,n.ay=x1,n.az=function(r){let e=1/0,a=1/0,s=-1/0,c=-1/0;for(const p of r)e=Math.min(e,p.x),a=Math.min(a,p.y),s=Math.max(s,p.x),c=Math.max(c,p.y);return{min:new St(e,a),max:new St(s,c)}},n.b=function(r){return sn.API_FONTS_REGEX.test(r)},n.b$=M_,n.b0=gn,n.b1=at,n.b2=_p,n.b3=d0,n.b4=function(){ns.isLoading()||ns.isLoaded()||Ui()!=="deferred"||Ed()},n.b5=Th,n.b6=et,n.b7=Vp,n.b8=ii,n.b9=ex,n.bA=Qe,n.bB=ue,n.bC=function(r,e){const{x:a,y:s}=r.point,c=Vg(a,s,r.worldSize/r._pixelsPerMercatorPixel,0,0);return ke(c,c,ss(Wa(e)))},n.bD=P,n.bE=Gn,n.bF=lr,n.bG=ba,n.bH=Pn,n.bI=gr,n.bJ=Lm,n.bK=gl,n.bL=lx,n.bM=function(r,e,a,s,c){const p=5*e+2;r.float32[p+0]=a,r.float32[p+1]=s,r.float32[p+2]=c},n.bN=Em,n.bO=co,n.bP=Us,n.bQ=ts,n.bR=$d,n.bS=Ve,n.bT=function(r,e,a,s){var c=new D(4);return c[0]=r,c[1]=e,c[2]=a,c[3]=s,c},n.bU=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const a=e.getSource().maxzoom,s=1<<a,c=Math.floor(r.x),p=Math.floor((r.x-c)*s),m=Math.floor(r.y*s),x=this.findDEMTileFor(new k(a,c,a,p,m));return!(!x||!x.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,a=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||r.y<0||r.y>1)return e;const c=s.getSource().maxzoom,p=1<<c,m=Math.floor(r.x),x=r.x-m,L=new k(c,m,c,Math.floor(x*p),Math.floor(r.y*p)),N=this.findDEMTileFor(L);if(!N||!N.dem)return e;const R=N.dem,T=1<<N.tileID.canonical.z,V=(x*T-N.tileID.canonical.x)*R.dim,F=(r.y*T-N.tileID.canonical.y)*R.dim,O=Math.floor(V),Q=Math.floor(F);return(a?this.exaggeration():1)*Sa(Sa(R.get(O,Q),R.get(O,Q+1),F-Q),Sa(R.get(O+1,Q),R.get(O+1,Q+1),F-Q),V-O)}static getAtTileOffset(r,e,a,s){const c=1<<r.canonical.z;return s?s.pointElevation(e):a?a.getAtPointOrZero(new Pe(r.wrap+(r.canonical.x+e.x/Dt)/c,(r.canonical.y+e.y/Dt)/c)):0}static getAtTileOffsetFunc(r,e,a,s){return(c,p,m)=>{const x=this.getAtTileOffset(r,c,p,m),L=s.upVector(r.canonical,c.x,c.y);return Be(L,L,x*s.upVectorScale(r.canonical,e,a).metersToTile),L}}getForTilePoints(r,e,a,s){if(this.isUsingMockSource())return!1;const c=Sm.create(this,r,s);return!!c&&(e.forEach(p=>{p[2]=this.exaggeration()*c.getElevationAt(p[0],p[1],a)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const a=e.dem.tree,s=e.tileID,c=1<<r.canonical.z-s.canonical.z;let p=r.canonical.x/c-s.canonical.x,m=r.canonical.y/c-s.canonical.y,x=0;for(let L=0;L<r.canonical.z-s.canonical.z&&!a.leaves[x];L++){p*=2,m*=2;const N=2*Math.floor(m)+Math.floor(p);x=a.childOffsets[x]+N,p%=1,m%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,a){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,a=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const c of r){const p=this.getMinMaxForTile(c.tileID);p&&(a=Math.min(a,p.min),s=Math.max(s,p.max),e=!0)}return e?{min:a,max:s}:null}},n.bV=Cg,n.bW=Hn,n.bX=os,n.bY=mb,n.bZ=S2,n.b_=xb,n.ba=R_,n.bb=ct,n.bc=Ds,n.bd=Td,n.be=Ut,n.bf=Ar,n.bg=fm,n.bh=wx,n.bi=function(r,e){const a=kf(e.zoom);if(a===0)return Wa(r);const s=kt(r),c=Na(s),p=ne(s.getWest())*e.worldSize,m=ne(s.getEast())*e.worldSize,x=ae(s.getNorth())*e.worldSize,L=ae(s.getSouth())*e.worldSize,N=[p,x,0],R=[m,x,0],T=[p,L,0],V=[m,L,0],F=ve([],e.globeMatrix);return ln(N,N,F),ln(R,R,F),ln(T,T,F),ln(V,V,F),c[0]=ai(c[0],T,a),c[1]=ai(c[1],V,a),c[2]=ai(c[2],R,a),c[3]=ai(c[3],N,a),Ca.fromPoints(c)},n.bj=Tr,n.bk=ve,n.bl=rr,n.bm=ai,n.bn=Vu,n.bo=lt,n.bp=Ft,n.bq=ye,n.br=L0,n.bs=Kg,n.bt=iu,n.bu=function(r,e){const a=[];for(const s in r)s in e||a.push(s);return a},n.bv=Re,n.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bx=uo,n.by=oe,n.bz=pe,n.c=Mi,n.c$=function(r){return r*r*r*r*r},n.c0=sx,n.c1=K1,n.c2=fx,n.c3=Mx,n.c4=Be,n.c5=di,n.c6=aa,n.c7=function(r,e,a){a*=.5;var s=e[0],c=e[1],p=e[2],m=e[3],x=Math.sin(a),L=Math.cos(a);return r[0]=s*L+c*x,r[1]=c*L-s*x,r[2]=p*L+m*x,r[3]=m*L-p*x,r},n.c8=La,n.c9=cn,n.cA=Rr,n.cB=r1,n.cC=v,n.cD=gt,n.cE=function(r,e,a,s,c,p,m,x,L){if(L.name==="globe")return gt(r,e,new v(a,s,c),!1);const N=Oy({z:a,x:s,y:c},L);return new Ca([(p+N.x/N.scale)*e,e*(N.y/N.scale),m],[(p+N.x2/N.scale)*e,e*(N.y2/N.scale),x])},n.cF=function(r,e,a){return r[0]=Math.min(e[0],a[0]),r[1]=Math.min(e[1],a[1]),r[2]=Math.min(e[2],a[2]),r[3]=Math.min(e[3],a[3]),r},n.cG=function(r,e,a){return r[0]=Math.max(e[0],a[0]),r[1]=Math.max(e[1],a[1]),r[2]=Math.max(e[2],a[2]),r[3]=Math.max(e[3],a[3]),r},n.cH=function(r){const e=Math.round((r+45+360)%360/90)%4;return $u[e]},n.cI=me,n.cJ=cs,n.cK=t,n.cL=function(r){const e=pe(new Float64Array(16));ke(e,r.pixelMatrix,r.globeMatrix);const a=[0,w,0],s=[0,b,0];return ln(a,a,e),ln(s,s,e),[a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!L_(r,new C(r.center.lat,90)),s[0]>0&&s[0]<=r.width&&s[1]>0&&s[1]<=r.height&&!L_(r,new C(r.center.lat,-90))]},n.cM=function(r,e){const{scale:a}=r.tileTransform,s=a*Dt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return function(c,p,m){var x=p[1],L=p[2],N=p[3],R=m[0],T=m[1];return c[0]=p[0]*R,c[1]=x*R,c[2]=L*T,c[3]=N*T,c}(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},n.cN=Xg,n.cO=yt,n.cP=a1,n.cQ=function(r){const e=a1(r,!0);return P([],[e[0],e[1],e[4],e[5]])},n.cR=$e,n.cS=Cr,n.cT=De,n.cU=function(r){const{x:e,y:a}=r.point,{lng:s,lat:c}=r._center;return Vg(e,a,r.worldSize,s,c)},n.cV=ze,n.cW=Vi,n.cX=W,n.cY=Cn,n.cZ=h,n.c_=function(r,e,a){let s=0;for(let c=0;c<2;++c)r[c]>0&&(s+=(r[c]-0)*(r[c]-0)),e[c]<0&&(s+=(0-e[c])*(0-e[c]));return s},n.ca=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},n.cb=Gt,n.cc=function(r,e,a,s,c){var p=1/Math.tan(e/2);if(r[0]=p/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0){var m=1/(s-c);r[10]=(c+s)*m,r[14]=2*c*s*m}else r[10]=-1,r[14]=-2*s;return r},n.cd=function(r,e,a,s,c,p,m){var x=1/(e-a),L=1/(s-c),N=1/(p-m);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*L,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*N,r[11]=0,r[12]=(e+a)*x,r[13]=(c+s)*L,r[14]=(m+p)*N,r[15]=1,r},n.ce=se,n.cf=function(r,e,a){r[4*e+0]=a[0],r[4*e+1]=a[1],r[4*e+2]=a[2],r[4*e+3]=a[3]},n.cg=Ch,n.ch=Hc,n.ci=qn,n.cj=ml,n.ck=Po,n.cl=u2,n.cm=function(){var r=new D(4);return D!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},n.cn=function(r,e,a){var s=e[0],c=e[1],p=e[2],m=e[3],x=Math.sin(a),L=Math.cos(a);return r[0]=s*L+p*x,r[1]=c*L+m*x,r[2]=s*-x+p*L,r[3]=c*-x+m*L,r},n.co=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},n.cp=rn,n.cq=function(r){var e=r[0],a=r[1],s=r[2],c=r[3];return Math.sqrt(e*e+a*a+s*s+c*c)},n.cr=Gs,n.cs=Xr,n.ct=z,n.cu=3,n.cv=2,n.cw=7,n.cx=6,n.cy=qo,n.cz=Ke,n.d=function(r){return sn.API_TILEJSON_REGEX.test(r)},n.d$=Dv,n.d0=q,n.d1=45,n.d2=Ou,n.d3=function(r,e,a){const s=Math.sqrt(r*r+e*e+a*a),c=s>0?Math.acos(a/s)*Ql:0;let p=r!==0||e!==0?Math.atan2(-e,-r)*Ql+90:0;return p<0&&(p+=360),[s,p,c]},n.d4=Wt,n.d5=Fr,n.d6=Se,n.d7=Lt,n.d8=Ca,n.d9=mt,n.dA=$i,n.dB=class extends no{constructor(r){super(r),this.current=hm}set(r,e,a){if(this.fetchUniformLocation(r,e)){for(let s=0;s<9;s++)if(a[s]!==this.current[s]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},n.dC=Lc,n.dD=function(r,e,a){const s=kf(a.zoom),c=r.style.map._antialias,p=r.terrain&&r.terrain.exaggeration()>0;return s===0&&!c&&!p},n.dE=function(r){const e=r.pixelsPerMeter,a=e/se(1,r.center.lat),s=pe(new Float64Array(16));return ye(s,s,[r.point.x,r.point.y,0]),$e(s,s,[a,a,e]),Float32Array.from(s)},n.dF=kt,n.dG=function(r){const e=me-5;r=re(r,-e,e)/e*90;const a=Math.pow(Math.abs(Math.sin(fr(r))),3);return Math.round(a*(_.length-1))},n.dH=function(r,e,a,s){const c=e.getNorth(),p=e.getSouth(),m=e.getWest(),x=e.getEast(),L=1<<r.z,N=x-m,R=c-p,T=N/f,V=-R/_[a],F=[0,T,0,V,0,0,c,m,0];if(r.z>0){const O=180/s;X(F,F,[O/N+1,0,0,0,O/R+1,0,-.5*O/T,.5*O/V,1])}return F[2]=L,F[5]=r.x,F[8]=r.y,F},n.dI=Wa,n.dJ=function(r,e,a){const s=pe(new Float64Array(16)),c=(e/(1<<r)-.5)*Math.PI*2;return Te(s,a.globeMatrix,c),Float32Array.from(s)},n.dK=$v,n.dL=ga,n.dM=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},n.dN=G,n.dO=function(r,e){var a=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=a,r[2]=0,r[3]=-a,r[4]=s,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},n.dP=bs,n.dQ=Du,n.dR=yn,n.dS=Vn,n.dT=256,n.dU=function(r,e){const a=[0,0,0];return ln(a,a,Tr(Wa(e.canonical))),ln(a,a,r),a},n.dV=r=>({u_matrix:new Po(r),u_texsize:new ml(r),u_pixels_to_tile_units:new Lo(r),u_device_pixel_ratio:new qn(r),u_width_scale:new qn(r),u_floor_width_scale:new qn(r),u_image:new Ch(r),u_units_to_pixels:new ml(r),u_tile_units_to_pixels:new qn(r),u_alpha_discard_threshold:new qn(r),u_trim_offset:new ml(r),u_trim_fade_range:new ml(r),u_trim_color:new Ou(r),u_emissive_strength:new qn(r),u_zbias_factor:new qn(r),u_tile_to_meter:new qn(r),u_ground_shadow_factor:new Hc(r),u_pattern_transition:new qn(r)}),n.dW=r=>({u_matrix:new Po(r),u_pixels_to_tile_units:new Lo(r),u_device_pixel_ratio:new qn(r),u_width_scale:new qn(r),u_floor_width_scale:new qn(r),u_units_to_pixels:new ml(r),u_dash_image:new Ch(r),u_gradient_image:new Ch(r),u_image_height:new qn(r),u_texsize:new ml(r),u_tile_units_to_pixels:new qn(r),u_alpha_discard_threshold:new qn(r),u_trim_offset:new ml(r),u_trim_fade_range:new ml(r),u_trim_color:new Ou(r),u_emissive_strength:new qn(r),u_zbias_factor:new qn(r),u_tile_to_meter:new qn(r),u_ground_shadow_factor:new Hc(r)}),n.dX=r=>({u_camera_to_center_distance:new qn(r),u_extrude_scale:new Lo(r),u_device_pixel_ratio:new qn(r),u_matrix:new Po(r),u_inv_rot_matrix:new Po(r),u_merc_center:new ml(r),u_tile_id:new Hc(r),u_zoom_transition:new qn(r),u_up_dir:new Hc(r),u_emissive_strength:new qn(r)}),n.dY=Yi,n.dZ=ez,n.d_=class{constructor(r,e,a,s){this.context=r,this.format=s,this.size=a,this.texture=r.gl.createTexture();const[c,p,m]=this.size,{gl:x}=r;x.bindTexture(x.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,c,p,m,0,G_(this.format),U_(this.format),e.data)}bind(r,e){const{context:a}=this,{gl:s}=a;s.bindTexture(s.TEXTURE_3D,this.texture),r!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,r),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},n.da=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},n.db=t1,n.dc=q_,n.dd=s1,n.de=bx,n.df=function(r,e){return r.readFields($z,{icons:[]},e)},n.dg=Pg,n.dh=jm,n.di=ux,n.dj=$h,n.dk=Wc,n.dl=zn,n.dm=lu,n.dn=ha,n.dp=function(r){const e=r.indexOf(Tu);return e>=0?r.slice(0,e):r},n.dq=function(r){return r.indexOf(Tu)>=0},n.dr=function(r){const e=r.lastIndexOf(Tu);return e>=0?r.slice(e+1):""},n.ds=function(r){const e=[],a=r.id;return a===void 0&&e.push({message:`layers.${a}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${a}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),e},n.dt=function(r,e,a,s){return r.type==="custom"?new Gz(r,e):new Hz[r.type](r,e,a,s)},n.du=Nt,n.dv=function(r){const e=r.indexOf(Tu);return e>=0?r.slice(e+1):""},n.dw=class extends Vp{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},n.dx=ki,n.dy=jc,n.dz=function(r){return r({pluginStatus:Hi,pluginURL:Bl}),ki.on("pluginStateChange",r),r},n.e=sn,n.e$=function([r,e,a]){const s=Math.hypot(r,e,a),c=Math.atan2(r,a),p=.5*Math.PI-Math.acos(-e/s);return new C(Vi(c),Vi(p))},n.e0=(r,e,a,s,c,p)=>{const m=r.transform,x=m.projection.name==="globe";let L;if(p.paint.get("circle-pitch-alignment")==="map")if(x){const R=Du(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;L=Float32Array.from([R,0,0,R])}else L=m.calculatePixelsToTileUnitsMatrix(a);else L=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(m.projection),u_matrix:r.translatePosMatrix(e.projMatrix,a,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qs.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:_E,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(x){N.u_inv_rot_matrix=s,N.u_merc_center=c,N.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],N.u_zoom_transition=kf(m.zoom);const R=c[0]*Dt,T=c[1]*Dt;N.u_up_dir=m.projection.upVector(new v(0,0,0),R,T)}return N},n.e1=L1,n.e2=Is,n.e3=(r,e,a,s,c,p,m,x,L,N)=>{const R=r.transform,T=R.pitch<15?w1(.07,.7,re((14-R.zoom)/5,0,1)):.07,V=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:b1(r,e,a,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:p,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:v1(e,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(V?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:T,u_tile_to_meter:Se(e.tileID.canonical,0),u_ground_shadow_factor:L,u_pattern_transition:N}},n.e4=(r,e,a,s,c,p,m,x,L,N)=>{const R=r.transform,T=R.calculatePixelsToTileUnitsMatrix(e),V=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",F=R.pitch<15?w1(.07,.7,re((14-R.zoom)/5,0,1)):.07;return{u_matrix:b1(r,e,a,s),u_pixels_to_tile_units:T,u_device_pixel_ratio:p,u_width_scale:m,u_floor_width_scale:x,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:j1(a)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:v1(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:L,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(V?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:F,u_tile_to_meter:Se(e.tileID.canonical,0),u_ground_shadow_factor:N}},n.e5=Ce,n.e6=yy,n.e7=Ze,n.e8=ee,n.e9=Dg,n.eA=Zx,n.eB=Yg,n.eC=Hg,n.eD=[1,1,1],n.eE=Sm,n.eF=Tn,n.eG=function(r,e,a,s){var c=e[0],p=e[1],m=e[2],x=e[3];return r[0]=c+s*(a[0]-c),r[1]=p+s*(a[1]-p),r[2]=m+s*(a[2]-m),r[3]=x+s*(a[3]-x),r},n.eH=xm,n.eI=bo,n.eJ=dc,n.eK=function(r,e,a,s,c,p,m,x,L,N,R,T,V,F,O,Q){var $=new D(16);return $[0]=r,$[1]=e,$[2]=a,$[3]=s,$[4]=c,$[5]=p,$[6]=m,$[7]=x,$[8]=L,$[9]=N,$[10]=R,$[11]=T,$[12]=V,$[13]=F,$[14]=O,$[15]=Q,$},n.eL=M,n.eM=Fh,n.eN=Rd,n.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new St(1/0,1/0),max:new St(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const a=gb(new St(0,0),new St(Dt,Dt),r),s=[];if(e&&!T_(a,this._globalClipBounds))return s;for(const c of this._activeRegions){if(c.hiddenByOverlap||!T_(a,c))continue;const p=XE(c.min,c.max,r);s.push({min:p.min,max:p.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return s}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const a=[];for(const s of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(s).buckets[e.layer];c&&c.updateFootprints(s.toUnwrapped(),a)}return a},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const a=r.getOrder(),s=r.getClipMask(),c=r.getClipScope();for(const p of e){if(!p.footprint)continue;const m=gb(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:a,clipMask:s,clipScope:c})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,a)=>e.priority-a.priority||Jg(e.min,a.min)||Jg(e.max,a.max)||e.order-a.order||e.clipMask-a.clipMask||function(s,c){const p=(m,x)=>m+x;return s.length-c.length||s.reduce(p,"").localeCompare(c.reduce(p,""))}(e.clipScope,a.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const a=this._activeRegions[e],s=this._prevRegions[e];r=a.priority!==s.priority||!yb(a,s)||a.order!==s.order||a.clipMask!==s.clipMask||!uo(a.clipScope,s.clipScope),this._activeRegions[e].hiddenByOverlap=s.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const a of this._activeRegions)a.order!==by&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const e=a=>{const s=this._activeRegions;if(a>=s.length)return a;const c=s[a].priority;for(;a<s.length&&s[a].priority===c;)++a;return a};if(this._sourceIds.length>1){let a=0,s=e(a);for(;a!==s;){let c=a;const p=a;for(;c!==s;){const m=this._activeRegions[c];m.hiddenByOverlap=!1;for(let x=0;x<p;x++){const L=this._activeRegions[x];if(!L.hiddenByOverlap&&m.order===by&&T_(m,L)&&(m.hiddenByOverlap=_b(m.footprint,m.tileId,L.footprint,L.tileId),m.hiddenByOverlap))break}++c}a=s,s=e(a)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},n.eP=by,n.eQ=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const a=new Ds,s=new gn,c=[],p=r+1+2,m=e[0]+1,x=e[0]+1+(1+e.length),L=(N,R,T)=>{let V=N===p-1?N-2:N===0?N:N-1;return V+=T?24575:0,[V,R]};for(let N=0;N<p;++N)a.emplaceBack(...L(N,0,!0));for(let N=0;N<m;++N)for(let R=0;R<p;++R)a.emplaceBack(...L(R,N,(R===0||R===p-1)&&!0));for(let N=0;N<e.length;++N){const R=e[N];for(let T=0;T<p;++T)a.emplaceBack(...L(T,R,!0))}for(let N=0;N<e.length;++N){const R=s.length,T=e[N]+1+2,V=new gn;for(let Q=0;Q<T-1;Q++){const $=Q===T-2,K=$?p*(x-e.length+N-Q):p;for(let ie=0;ie<p-1;ie++){const le=Q*p+ie;Q===0||$||ie===0||ie===p-2?(V.emplaceBack(le+1,le,le+K),V.emplaceBack(le+K,le+K+1,le+1)):(s.emplaceBack(le+1,le,le+K),s.emplaceBack(le+K,le+K+1,le+1))}}const F=Ar.simpleSegment(0,R,a.length,s.length-R);for(let Q=0;Q<V.uint16.length;Q+=3)s.emplaceBack(V.uint16[Q],V.uint16[Q+1],V.uint16[Q+2]);const O=Ar.simpleSegment(0,R,a.length,s.length-R);c.push({withoutSkirts:F,withSkirts:O})}return{vertices:a,indices:s,segments:c}}_createGrid(r){const e=this._fillGridMeshWithLods(f,_);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Ut.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new gn;for(let m=0;m<=f;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const a=new Qc,s=new Qc,c=new Qc,p=new Qc;this._poleSegments=[];for(let m=0,x=0;m<h;m++){const L=360/(1<<m);a.emplaceBack(0,-On,0,.5,0),s.emplaceBack(0,-On,0,.5,1),c.emplaceBack(0,-On,0,.5,.5),p.emplaceBack(0,-On,0,.5,.5);for(let N=0;N<=f;N++){let R=N/f,T=0;const V=Sa(0,L,R),[F,O,Q]=E(yE,gE,V,On);a.emplaceBack(F,O,Q,R,T),s.emplaceBack(F,O,Q,R,1-T);const $=fr(V);R=.5+.5*Math.sin($),T=.5+.5*Math.cos($),c.emplaceBack(F,O,Q,R,T),p.emplaceBack(F,O,Q,R,1-T)}this._poleSegments.push(Ar.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(a,He,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(s,He,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(c,He,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(p,He,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},n.eR=pb,n.eS=Ge,n.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.eU=te,n.eV=ge,n.eW=function(r,e,a){return r[0]=e[0]/a[0],r[1]=e[1]/a[1],r[2]=e[2]/a[2],r},n.eX=pi,n.eY=A,n.eZ=Er,n.e_=qt,n.ea=Vb,n.eb=Ff,n.ec=Lb,n.ed=bb,n.ee=we,n.ef=function(r,e){if(r===e){var a=e[1],s=e[2],c=e[3],p=e[6],m=e[7],x=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=a,r[6]=e[9],r[7]=e[13],r[8]=s,r[9]=p,r[11]=e[14],r[12]=c,r[13]=m,r[14]=x}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},n.eg=Pz,n.eh=tr,n.ei=Oh,n.ej=256,n.ek=ss,n.el=Cs,n.em=Te,n.en=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},n.eo=Qc,n.ep=Jh,n.eq=ao,n.er=function(r,e,a,s,c){return re((r-e)/(a-e)*(c-s)+s,s,c)},n.es=hr,n.et=function(r,e){var a=e[0],s=e[1],c=e[2],p=e[3],m=e[4],x=e[5],L=e[6],N=e[7],R=e[8],T=R*m-x*N,V=-R*p+x*L,F=N*p-m*L,O=a*T+s*V+c*F;return O?(r[0]=T*(O=1/O),r[1]=(-R*s+c*N)*O,r[2]=(x*s-c*m)*O,r[3]=V*O,r[4]=(R*a-c*L)*O,r[5]=(-x*a+c*p)*O,r[6]=F*O,r[7]=(-N*a+s*L)*O,r[8]=(m*a-s*p)*O,r):null},n.eu=2,n.ev=or,n.ew=Ko,n.ex=Qt,n.ey=function(r,e){var a=new D(3);Qt(a,e);var s=1/a[0],c=1/a[1],p=1/a[2],m=e[0]*s,x=e[1]*c,L=e[2]*p,N=e[4]*s,R=e[5]*c,T=e[6]*p,V=e[8]*s,F=e[9]*c,O=e[10]*p,Q=m+R+O,$=0;return Q>0?($=2*Math.sqrt(Q+1),r[3]=.25*$,r[0]=(T-F)/$,r[1]=(V-L)/$,r[2]=(x-N)/$):m>R&&m>O?($=2*Math.sqrt(1+m-R-O),r[3]=(T-F)/$,r[0]=.25*$,r[1]=(x+N)/$,r[2]=(V+L)/$):R>O?($=2*Math.sqrt(1+R-m-O),r[3]=(V-L)/$,r[0]=(x+N)/$,r[1]=.25*$,r[2]=(T+F)/$):($=2*Math.sqrt(1+O-m-R),r[3]=(x-N)/$,r[0]=(V+L)/$,r[1]=(T+F)/$,r[2]=.25*$),r},n.ez=function(r,e){var a=2*Math.acos(e[3]),s=Math.sin(a/2);return s>B?(r[0]=e[0]/s,r[1]=e[1]/s,r[2]=e[2]/s):(r[0]=1,r[1]=0,r[2]=0),a},n.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,a)=>String.fromCharCode(+("0x"+a))))},n.f0=Ls,n.f1=X_,n.f2=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(a){if(Fn==null){const s=a.navigator?a.navigator.userAgent:null;Fn=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Fn}(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.f3=function(r,e){ed=r,hs=e},n.f4=L_,n.f5=Fv,n.f6=function(r){const e=[0,0,0],a=pe(new Float64Array(16));return ke(a,r.pixelMatrix,r.globeMatrix),ln(e,e,a),new St(e[0],e[1])},n.f7=function(){const r=Sy;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(F_),Sy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.f8=function(){Pg().acquire(F_)},n.f9=Ui,n.fA=jt,n.fB=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==Yb){const a=new Uint32Array(r,0,7),[,,s,c,p,m]=a;e=a.byteLength+c+p+m+p,(s!==r.byteLength||e>=r.byteLength)&&Za("Invalid b3dm header information.")}return e1(r,e)},n.fC=function(r,e){const a=q_(r);for(const s of a){for(const c of s.meshes)jS(c);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(ZS(s.lights,e)))}return a},n.fD=y0,n.fE=Jn,n.fF=Ub,n.fG=ns,n.fH=Ns,n.fI=function(r){Ll(),fs?.then(e=>{e.keys().then(a=>{for(let s=0;s<a.length-r;s++)e.delete(a[s]).catch(c=>Za(c.message))}).catch(a=>Za(a.message))}).catch(e=>Za(e.message))},n.fa=function(r,e,a=!1){if(Hi===Ns.deferred||Hi===Ns.loading||Hi===Ns.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bl=Qs.resolveURL(r),Hi=Ns.deferred,Ah=e,fi(),a||Ed()},n.fb=function(r){ym=Qs.resolveURL(r),gm||(gm=new mm(Pg(),new Nl)),gm.broadcast("setMeshoptUrl",ym)},n.fc=Qb,n.fd=function(r){D_=Qs.resolveURL(r),gm||(gm=new mm(Pg(),new Nl)),gm.broadcast("setDracoUrl",D_)},n.fe=Xb,n.ff=Ey,n.fg=function(r){const e=el();if(!e)return;const a=e.delete(Ku);r&&a.then(()=>r()).catch(r)},n.fh=Sp,n.fi=na,n.fj=Jf,n.fk=Gu,n.fl=m3,n.fm=y3,n.fn=y1,n.fo=Ht,n.fp="hd_road_elevation",n.fq=Va,n.fr=Vt,n.fs=Ph,n.ft=cx,n.fu=Rp,n.fv=function(r,e,a,s,c,p,m,x=1,L,N,R){r.createArrays(),r.tilePixelRatio=Dt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const T=r.layers[0].layout,V=r.layers[0]._unevaluatedLayout._values,F={};F.scaleFactor=x,F.textSizeScaleRange=T.get("text-size-scale-range"),F.iconSizeScaleRange=T.get("icon-size-scale-range");const[O,Q]=F.textSizeScaleRange,[$,K]=F.iconSizeScaleRange;F.textScaleFactor=re(F.scaleFactor,O,Q),F.iconScaleFactor=re(F.scaleFactor,$,K);const ie=V["text-size"],le=V["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:Je,maxZoom:ot}=r.textSizeData;F.compositeTextSizes=[ie.possiblyEvaluate(new $r(Je,{worldview:R}),p),ie.possiblyEvaluate(new $r(ot,{worldview:R}),p)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Je,maxZoom:ot}=r.iconSizeData;F.compositeIconSizes=[le.possiblyEvaluate(new $r(Je,{worldview:R}),p),le.possiblyEvaluate(new $r(ot,{worldview:R}),p)]}F.layoutTextSize=ie.possiblyEvaluate(new $r(m+1,{worldview:R}),p),F.layoutIconSize=le.possiblyEvaluate(new $r(m+1,{worldview:R}),p),F.textMaxSize=ie.possiblyEvaluate(new $r(18,{worldview:R}),p);const de=T.get("symbol-placement"),Ee=T.get("text-rotation-alignment")==="map"&&de!=="point",Le=T.get("text-size");let Ae=!1;const Me=[];for(const Je of r.features){const ot=T.get("text-font").evaluate(Je,{},p).join(","),We=Le.evaluate(Je,{},p)*F.textScaleFactor,ut=F.layoutTextSize.evaluate(Je,{},p)*F.textScaleFactor,_t=F.layoutIconSize.evaluate(Je,{},p)*F.iconScaleFactor,Zt={horizontal:{},vertical:void 0},Pt=Je.text;let At,xt=[0,0];if(Pt){const nr=Pt.toString(),Zr=T.get("text-letter-spacing").evaluate(Je,{},p)*os,Pa=T.get("text-line-height").evaluate(Je,{},p)*os,Br=Zd(nr)?Zr:0,Ir=T.get("text-anchor").evaluate(Je,{},p),In=T.get("text-variable-anchor");if(!In){const pt=T.get("text-radial-offset").evaluate(Je,{},p);if(pt)xt=K1(Ir,[pt*os,hx]);else{const $t=T.get("text-offset").evaluate(Je,{},p);xt=[$t[0]*os,$t[1]*os]}}let je=Ee?"center":T.get("text-justify").evaluate(Je,{},p);const _e=de==="point",ft=_e?T.get("text-max-width").evaluate(Je,{},p)*os:1/0,Xt=pt=>{r.allowVerticalPlacement&&Eu(nr)&&(Zt.vertical=ix(Pt,e,a,c,ot,ft,Pa,Ir,pt,Br,xt,gl.vertical,!0,ut,We,L))};if(!Ee&&In){const pt=je==="auto"?In.map(pa=>fx(pa)):[je];let $t=!1;for(let pa=0;pa<pt.length;pa++){const fa=pt[pa];if(!Zt.horizontal[fa])if($t)Zt.horizontal[fa]=Zt.horizontal[0];else{const Xa=ix(Pt,e,a,c,ot,ft,Pa,"center",fa,Br,xt,gl.horizontal,!1,ut,We,L);Xa&&(Zt.horizontal[fa]=Xa,$t=Xa.positionedLines.length===1)}}Xt("left")}else{if(je==="auto"&&(je=fx(Ir)),_e||T.get("text-writing-mode").indexOf("horizontal")>=0||!Eu(nr)){const pt=ix(Pt,e,a,c,ot,ft,Pa,Ir,je,Br,xt,gl.horizontal,!1,ut,We,L);pt&&(Zt.horizontal[je]=pt)}Xt(_e?"left":je)}}let zt,nt,rt,Et,Jt,vt,sa=!1;const ua=T.get("icon-text-fit").evaluate(Je,{},p);if(Je.icon&&Je.icon.hasPrimary()){const nr=Jy(Je.icon,r.iconSizeData,V["icon-size"],p,r.zoom,Je,L,F.iconScaleFactor,R);zt=nr.iconPrimary,rt=nr.iconSecondary;const Zr=zt.toString();if(nt=s.get(Zr),nt&&(Jt=T.get("icon-offset").evaluate(Je,{},p),vt=T.get("icon-anchor").evaluate(Je,{},p),At=t0(c.get(Zr),rt?c.get(rt.toString()):void 0,Jt,vt),sa=nt.sdf,r.sdfIcons===void 0?r.sdfIcons=nt.sdf:r.sdfIcons!==nt.sdf&&Za("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==r.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),rt){const Pa=rt.toString();Et=s.get(Pa)}}Ae=Ae||!(!Je.icon||!Je.icon.hasSecondary());const ta=px(Zt.horizontal)||Zt.vertical;r.iconsInText||(r.iconsInText=!!ta&&ta.iconsInText);const Yt=ut*F.textScaleFactor/os,{defaultShapedIcon:Fa,verticallyShapedIcon:ea}=zz(r,At,T,Je,p,Zt,Yt,Jt,ua);ua!=="none"&&At&&(J1(At)||F1(At))&&(s0(0,nt,zt,At,Fa,ua,N,s,c),s0(0,Et,rt,At,Fa,ua,N,s,c),ea&&(s0(0,nt,zt,At,ea,ua,N,s,c),s0(0,Et,rt,At,ea,ua,N,s,c))),At=Fa;const{iconBBox:ja,iconVerticalBBox:Da}=Nz(r,At,ea,T,Je,p,_t,Jt,F,c,vt);Me.push({feature:Je,shapedTextOrientations:Zt,shapedText:ta,shapedIcon:At,iconPrimary:zt,iconSecondary:rt,iconOffset:Jt,iconAnchor:vt,verticallyShapedIcon:ea,layoutTextSize:ut,layoutIconSize:_t,textOffset:xt,isSDFIcon:sa,iconTextFit:ua,iconCollisionBounds:ja,iconVerticalCollisionBounds:Da})}return{featureData:Me,sizes:F,hasAnySecondaryIcon:Ae,textAlongLine:Ee,symbolPlacement:de}},n.fw=X1,n.fx=function(r,e,a,s,c,p,m,x,L,N){r.iconAtlasPositions=N.iconPositions;const{featureData:R,hasAnySecondaryIcon:T,sizes:V,textAlongLine:F,symbolPlacement:O}=e;for(const Q of R){const{shapedIcon:$,verticallyShapedIcon:K,feature:ie,shapedTextOrientations:le,shapedText:de,layoutTextSize:Ee,textOffset:Le,isSDFIcon:Ae,iconPrimary:Me,iconSecondary:Je,iconTextFit:ot,iconOffset:We,iconCollisionBounds:ut,iconVerticalCollisionBounds:_t}=Q;t2($,N.iconPositions,Me,Je),t2(K,N.iconPositions,Me,Je),Sz(le,N.iconPositions),Ez(Me,Je,N.iconPositions),(de||$)&&Az(r,ie,le,$,K,L,V,Ee,0,Le,Ae,s,c,m,x,T,ot,We,F,O,ut,_t)}a&&r.generateCollisionDebugBuffers(p,r.collisionBoxArray,V.textScaleFactor)},n.fy=la,n.fz=b0,n.g=function(r,e){return jc(Object.assign(r,{method:"GET"}),e)},n.h=function(r){return r.indexOf("mapbox:")===0},n.i=function(r){return sn.API_STYLE_REGEX.test(r)&&!Mi(r)},n.j=si,n.k=al,n.l=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.m=function(r,e){return jc(Object.assign(r,{type:"json"}),e)},n.n=td,n.o=Qs,n.p=function(r,e){return jc(Object.assign(r,{method:"POST"}),e)},n.q=zs,n.r=as,n.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=function(){return O_||(O_=new Sp),O_},n.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},n.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},n.w=Za,n.x=Ax,n.y=ad,n.z=js}),Z(["./shared"],function(n){function B(Ge){const te=Ge?Ge.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function D(Ge){if(typeof Ge=="number"||typeof Ge=="boolean"||typeof Ge=="string"||Ge==null)return JSON.stringify(Ge);if(Array.isArray(Ge)){let re="[";for(const xe of Ge)re+=`${D(xe)},`;return`${re}]`}let te="{";for(const re of Object.keys(Ge).sort())te+=`${re}:${D(Ge[re])},`;return`${te}}`}function P(Ge){let te="";for(const re of n.bw)te+=`/${D(Ge[re])}`;return te}class G{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,re){this._layerConfigs={},this._layers={},this.update(te,[],re)}update(te,re,xe){this._options=xe;for(const Re of te)this._layerConfigs[Re.id]=Re,(this._layers[Re.id]=n.dt(Re,this.scope,null,this._options)).compileFilter(xe),this.keyCache[Re.id]&&delete this.keyCache[Re.id];for(const Re of re)delete this.keyCache[Re],delete this._layerConfigs[Re],delete this._layers[Re];this.familiesBySource={};const Ve=function(Re,Oe){const at={};for(let tt=0;tt<Re.length;tt++){const Vt=Re[tt];let Nt=Oe&&Oe[Vt.id];Nt||(Vt.type==="symbol"?Nt=Vt.id:(Nt=P(Vt),Vt.type==="line"&&Vt.paint&&function Ia(ma){return typeof ma=="string"&&ma==="line-progress"||(Array.isArray(ma)?ma.some(Ia):!(!ma||typeof ma!="object")&&Object.values(ma).some(Ia))}(Vt.paint["line-width"])&&(Nt+=`/${D(Vt.paint["line-width"])}`))),Oe&&(Oe[Vt.id]=Nt);let ha=at[Nt];ha||(ha=at[Nt]=[]),ha.push(Vt)}const Ce=[];for(const tt in at)Ce.push(at[tt]);return Ce}(Object.values(this._layerConfigs),this.keyCache);for(const Re of Ve){const Oe=Re.map(ha=>this._layers[ha.id]),at=Oe[0];if(at.visibility==="none")continue;const Ce=at.source||"";let tt=this.familiesBySource[Ce];tt||(tt=this.familiesBySource[Ce]={});const Vt=at.sourceLayer||"_geojsonTileLayer";let Nt=tt[Vt];Nt||(Nt=tt[Vt]=[]),Nt.push(Oe)}}}const Y=1*n.fk;class X{constructor(te){const re={},xe=[];for(const at in te){const Ce=te[at],tt=re[at]={};for(const Vt in Ce.glyphs){const Nt=Ce.glyphs[+Vt];if(!Nt||Nt.bitmap.width===0||Nt.bitmap.height===0)continue;const ha=Nt.metrics.localGlyph?Y:1,Ia={x:0,y:0,w:Nt.bitmap.width+2*ha,h:Nt.bitmap.height+2*ha};xe.push(Ia),tt[Vt]=Ia}}const{w:Ve,h:Re}=n.G(xe),Oe=new n.fj({width:Ve||1,height:Re||1});for(const at in te){const Ce=te[at];for(const tt in Ce.glyphs){const Vt=Ce.glyphs[+tt];if(!Vt||Vt.bitmap.width===0||Vt.bitmap.height===0)continue;const Nt=re[at][tt],ha=Vt.metrics.localGlyph?Y:1;n.fj.copy(Vt.bitmap,Oe,{x:0,y:0},{x:Nt.x+ha,y:Nt.y+ha},Vt.bitmap)}}this.image=Oe,this.positions=re}}function ue(Ge,te,re){Ge[te]?re&&(Ge[te].center=re):Ge[te]={floorIds:new Set,center:re||[0,0],floors:{}}}function oe(Ge,te,re,xe){for(const Ve of te)ue(Ge,Ve),Ge[Ve].floors[re]=xe,Ge[Ve].floorIds.add(re)}function pe(Ge){return{id:Ge.properties.id.toString(),center:Ge.properties.center.toString().split(";").map(Number)}}function ve(Ge){return{id:Ge.properties.id.toString(),isDefault:!!Ge.properties.is_default&&Ge.properties.is_default,connections:Ge.properties.connected_floor_ids?new Set(Ge.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ge.properties.conflicted_floor_ids?new Set(Ge.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ge.properties.building_ids?new Set(Ge.properties.building_ids.toString().split(";")):new Set,name:Ge.properties.name.toString(),zIndex:Ge.properties.z_index}}function ke(Ge,te){return te.every(re=>Ge.properties&&Ge.properties[re]!=null)}function ye(Ge){return ke(Ge,["type","id","name"])&&Ge.properties.type==="building"}function $e(Ge){return ke(Ge,["type","id","name","z_index"])&&Ge.properties.type==="floor"}n.fi(X,"GlyphAtlas");class De{constructor(te){this.tileID=new n.aP(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=n.aY(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor,this.worldview=te.worldview,this.indoor=te.indoor}parse(te,re,xe,Ve,Re,Oe){this.status="parsing",this.data=te,this.collisionBoxArray=new n.b2;const at=new n.fl(Object.keys(te.layers).sort()),Ce=new n.fm(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];const tt={},Vt=new n.fn(256,256),Nt={featureIndex:Ce,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Vt,availableImages:xe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Za=this.indoor.indoorState.activeFloorsVisible,$a=function(ar,Fr,Jn){const ii=function(Pr,Ka){if(!Pr)return n.w("No source layers defined in indoor specification"),Ka;if(Pr.size===0)return Ka;const yn=Pr.difference(Ka);for(const Vn of yn)n.w(`Missing source layer required in indoor specification: ${Vn}`);return Ka.intersection(Ka)}(Fr.sourceLayers,new Set(Object.keys(ar.layers))),Fn=Fr.indoorState,cn=function(Pr,Ka,yn,Vn){const Yr=new Set,sn=new Set,si=new Set,Mi=new Map,Bs={},au=Ni=>{const Xs=Mi.get(Ni)||new Set;for(const ds of Yr)if((Mi.get(ds)||new Set).has(Ni)||Xs.has(ds))return!0;return!1};for(const Ni of Ka){const Xs=Pr.layers[Ni];if(Xs)for(let ds=0;ds<Xs.length;ds++){const ho=Xs.feature(ds);if(ye(ho)){const{id:as,center:Qs}=pe(ho);ue(Bs,as,Qs),Yr.add(as)}else if($e(ho)){const{id:as,isDefault:Qs,connections:qu,conflicts:zn,buildings:Ku,name:ed,zIndex:hs}=ve(ho);oe(Bs,Ku,as,{name:ed,zIndex:hs}),Mi.set(as,zn),(as===Vn||qu.has(Vn))&&Yr.add(as),sn.add(as),Qs&&si.add(as)}}else n.w(`indoor source layer not found: ${Ni}`)}if(yn)for(const Ni of yn)sn.has(Ni)&&(au(Ni)||Yr.add(Ni));for(const Ni of si)Yr.has(Ni)||au(Ni)||Yr.add(Ni);return{buildings:Bs,activeFloors:Yr}}(ar,ii,Fn.lastActiveFloors,Fn.selectedFloorId);return Jn.send("setIndoorData",cn),cn}(te,this.indoor,Re);Nt.activeFloors=Za?$a.activeFloors:void 0}const ha=[],Ia=re.familiesBySource[this.source];for(const Za in Ia){const $a=te.layers[Za];if(!$a)continue;let ar=!1,Fr=!1,Jn=!1;for(const Pr of Ia[Za])Pr[0].type==="symbol"?ar=!0:Fr=!0,Pr[0].is3D()&&Pr[0].type!=="model"&&(Jn=!0);if(this.extraShadowCaster&&!Jn||this.isSymbolTile===!0&&!ar||this.isSymbolTile===!1&&!Fr)continue;$a.version===1&&n.w(`Vector tile source "${this.source}" layer "${Za}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ii=at.encode(Za),Fn=[];let cn=!1;for(let Pr=0,Ka=0;Pr<$a.length;Pr++){const yn=$a.feature(Pr),Vn=Ce.getId(yn,Za);if(this.localizableLayerIds&&this.localizableLayerIds.has(Za)){const Yr=yn.properties?yn.properties.worldview:null;if(this.worldview&&typeof Yr=="string")if(Yr==="all")yn.properties.$localized=!0;else{if(!Yr.split(",").includes(this.worldview))continue;yn.properties.$localized=!0,yn.properties.worldview=this.worldview}}!cn&&yn.properties&&yn.properties.hasOwnProperty(n.fo)&&(cn=!0),Fn.push({feature:yn,id:Vn,index:Ka,sourceLayerIndex:ii}),Ka++}cn&&!Nt.elevationFeatures&&te.layers.hasOwnProperty(n.fp)&&(Nt.elevationFeatures=n.fq.parseFrom(te.layers[n.fp],this.canonical));for(const Pr of Ia[Za]){const Ka=Pr[0];if(this.extraShadowCaster&&(!Ka.is3D()||Ka.type==="model")||this.isSymbolTile!==void 0&&Ka.type==="symbol"!==this.isSymbolTile||Ka.minzoom&&this.zoom<Math.floor(Ka.minzoom)||Ka.maxzoom&&this.zoom>=Ka.maxzoom||Ka.visibility==="none")continue;Te(Pr,this.zoom,Nt.brightness,xe,this.worldview);const yn=tt[Ka.id]=Ka.createBucket({index:Ce.bucketLayerIDs.length,layers:Pr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ii,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ve,worldview:this.worldview});Ce.bucketLayerIDs.push(Pr.map(Yr=>n.B(Yr.id,Yr.scope)));let Vn=yn.prepare?yn.prepare():null;Vn!=null?(Vn=Vn.then(()=>yn.populate(Fn,Nt,this.tileID.canonical,this.tileTransform)),ha.push(Vn)):yn.populate(Fn,Nt,this.tileID.canonical,this.tileTransform)}}const ma=()=>{let Za,$a,ar,Fr,Jn,ii;Vt.trim();const Fn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},cn=()=>{if(Za)return this.status="done",Oe(Za);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:Object.values(tt).filter(Ka=>!Ka.isEmpty()),featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Nt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if($a&&ar&&Fr){const Ka=new X($a),yn=new Map;for(const[sn,si]of ar.entries()){const{imagePosition:Mi}=n.ft(sn,si,n.fu);yn.set(sn,Mi)}const Vn={};for(const sn in tt){const si=tt[sn];si instanceof n.b3&&(Te(si.layers,this.zoom,Nt.brightness,xe,this.worldview),Vn[sn]=n.fv(si,$a,Ka.positions,ar,yn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Jn,this.worldview))}const Yr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Re,ar,Jn,()=>{Yr.iconsPending=!1,Pr(Vn,Ka,Yr)}),this.rasterizeIfNeeded(Re,Fr,ii,()=>{Yr.patternsPending=!1,Pr(Vn,Ka,Yr)})}},Pr=(Ka,yn,Vn,Yr)=>{if(Vn.iconsPending||Vn.patternsPending)return;const sn=new n.fw(ar,Fr,this.lut);for(const si in tt){const Mi=tt[si];if(si in Ka)n.fx(Mi,Ka[si],this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,ar,sn);else if(Mi.hasPattern&&(Mi instanceof n.b9||Mi instanceof n.ba||Mi instanceof n.e9)){Te(Mi.layers,this.zoom,Nt.brightness,xe,this.worldview);const Bs=Object.fromEntries(sn.patternPositions);Mi.addFeatures(Nt,this.tileID.canonical,Bs,xe,this.tileTransform,this.brightness)}}this.status="done",Oe(null,{buckets:Object.values(tt).filter(si=>!si.isEmpty()),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yn.image,lineAtlas:Vt,imageAtlas:sn,brightness:Nt.brightness})};if(!this.extraShadowCaster){const Ka=n.fr(Nt.glyphDependencies,Yr=>Object.keys(Yr).map(Number));Object.keys(Ka).length?Re.send("getGlyphs",{uid:this.uid,stacks:Ka},(Yr,sn)=>{Za||(Za=Yr,$a=sn,cn())},void 0,!1,Fn):$a={};const yn=Array.from(Nt.iconDependencies.keys()).map(Yr=>n.I.parse(Yr));yn.length?Re.send("getImages",{images:yn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Yr,sn)=>{Za||(Za=Yr,ar=new Map,Jn=this.updateImageMapAndGetImageTaskQueue(ar,sn,Nt.iconDependencies),cn())},void 0,!1,Fn):(ar=new Map,Jn=new Map);const Vn=Array.from(Nt.patternDependencies.keys()).map(Yr=>n.I.parse(Yr));Vn.length?Re.send("getImages",{images:Vn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Yr,sn)=>{Za||(Za=Yr,Fr=new Map,ii=this.updateImageMapAndGetImageTaskQueue(Fr,sn,Nt.patternDependencies),cn())},void 0,!1,Fn):(Fr=new Map,ii=new Map)}if(Nt.elevationFeatures&&Nt.elevationFeatures.length>0){const Ka=[];for(const Vn of Object.values(tt))if(Vn instanceof n.ba){const Yr=Vn.getUnevaluatedPortalGraph();Yr&&Ka.push(Yr)}const yn=n.fs.evaluate(Ka);for(const Vn of Object.values(tt))if(Vn instanceof n.ba){const Yr=te.layers[at.decode(Vn.sourceLayerIndex)];Vn.setEvaluatedPortalGraph(yn,Yr,this.tileID.canonical,Nt.availableImages,Nt.brightness)}}cn()};ha.length>0?Promise.allSettled(ha).then(ma).catch(Oe):ma()}updateParameters(te){this.scaleFactor=te.scaleFactor,this.showCollisionBoxes=te.showCollisionBoxes,this.projection=te.projection,this.brightness=te.brightness,this.tileTransform=n.aY(te.tileID.canonical,te.projection),this.extraShadowCaster=te.extraShadowCaster,this.lut=te.lut,this.worldview=te.worldview,this.indoor=te.indoor}rasterizeIfNeeded(te,re,xe,Ve){Array.from(re.values()).some(Re=>Re.usvg)?this.rasterize(te,re,xe,Ve):Ve()}updateImageMapAndGetImageTaskQueue(te,re,xe){const Ve=new Map;for(const Re of re.keys()){const Oe=xe.get(Re)||[];for(const at of Oe){const Ce=at.toString(),tt=re.get(at.id.toString());tt.usvg?Ve.has(Ce)||(Ve.set(Ce,at),te.set(Ce,Object.assign({},tt))):te.set(Ce,tt)}}return Ve}rasterize(te,re,xe,Ve){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:xe},(Re,Oe)=>{if(!Re)for(const[at,Ce]of Oe.entries()){const tt=Object.assign(re.get(at),{data:Ce});re.set(at,tt)}Ve()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Te(Ge,te,re,xe,Ve){const Re=new n.ac(te,{brightness:re,worldview:Ve});for(const Oe of Ge)Oe.recalculate(Re,xe)}class Qe extends n.E{constructor(te,re,xe,Ve,Re,Oe,at){super(),this.actor=te,this.layerIndex=re,this.availableImages=xe,this.availableModels=Ve,this.loadVectorData=Oe||n.aL,this.loading={},this.loaded={},this.deduped=new n.aK(te.scheduler),this.isSpriteLoaded=Re,this.scheduler=te.scheduler,this.brightness=at}loadTile(te,re){const xe=te.uid,Ve=te&&te.request,Re=Ve&&Ve.collectResourceTiming,Oe=this.loading[xe]=new De(te);Oe.abort=this.loadVectorData(te,(at,Ce)=>{const tt=!this.loading[xe];if(delete this.loading[xe],Oe.cancelRasterize(),tt||at||!Ce)return Oe.status="done",tt||(this.loaded[xe]=Oe),re(at);const Vt=Ce.rawData,Nt={},ha=n.aM(Ce.responseHeaders);ha&&ha.expires&&(Nt.expires=ha.expires),ha&&ha.cacheControl&&(Nt.cacheControl=ha.cacheControl),Oe.vectorTile=Ce.vectorTile||new n.fy(new n.bs(Vt));const Ia=()=>{Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(ma,Za)=>{if(ma||!Za)return re(ma);const $a={};if(Re){const ar=B(Ve);ar.length>0&&($a.resourceTiming=JSON.parse(JSON.stringify(ar)))}re(null,Object.assign({rawTileData:Vt.slice(0),responseHeaders:Ce.responseHeaders},Za,Nt,$a))})};this.isSpriteLoaded?Ia():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ia,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Ia()}),this.loaded=this.loaded||{},this.loaded[xe]=Oe})}reloadTile(te,re){const xe=this.loaded,Ve=te.uid;if(xe&&xe[Ve]){const Re=xe[Ve];Re.updateParameters(te);const Oe=(at,Ce)=>{const tt=Re.reloadCallback;tt&&(delete Re.reloadCallback,Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,tt)),re(at,Ce)};Re.status==="parsing"?Re.reloadCallback=Oe:Re.status==="done"&&(Re.vectorTile?Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Oe):Oe())}else re(null,void 0)}abortTile(te,re){const xe=te.uid,Ve=this.loading[xe];Ve&&(Ve.abort&&Ve.abort(),delete this.loading[xe]),re()}removeTile(te,re){const xe=this.loaded,Ve=te.uid;xe&&xe[Ve]&&delete xe[Ve],re()}}class Ft{loadTile(te,re){const{uid:xe,encoding:Ve,rawImageData:Re,padding:Oe}=te,at=ImageBitmap&&Re instanceof ImageBitmap?this.getImageData(Re,Oe):Re;re(null,new n.fz(xe,at,Ve,Oe<1))}reloadTile(te,re){re(null,null)}abortTile(te,re){re()}removeTile(te,re){re()}getImageData(te,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const xe=this.offscreenCanvasContext.getImageData(-re,-re,te.width+2*re,te.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}n.br.setPbf(n.bs);class bt{constructor(te){this._mrt=new n.br(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,re){const xe=this._mrt;this.status="parsing",this._entireBuffer=te;try{xe.parseHeader(te),this._isHeaderLoaded=!0;const Ve=[];for(const Re in xe.layers){const Oe=xe.getLayer(Re),at=Oe.getDataRange(Oe.getBandList()),Ce=xe.createDecodingTask(at),tt=te.slice(at.firstByte,at.lastByte+1),Vt=n.br.performDecoding(tt,Ce).then(Nt=>Ce.complete(null,Nt)).catch(Nt=>Ce.complete(Nt,null));Ve.push(Vt)}Promise.allSettled(Ve).then(()=>re(null,xe)).catch(Re=>re(Re))}catch(Ve){re(Ve)}}}class Qt{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,re){const xe=te.uid,Ve=te.request,Re=this.loading[xe]=new bt(te),{cancel:Oe}=n.bt(Ve,(at,Ce,tt)=>{const Vt=!this.loading[xe];if(delete this.loading[xe],Vt||at||!Ce)return Re.status="done",Vt||(this.loaded[xe]=Re),re(at);Re.parse(Ce,(Nt,ha)=>{if(Nt||!ha)return re(Nt);re(null,ha,tt)}),this.loaded[xe]=Re});Re.abort=Oe}reloadTile(te,re){re(null,void 0)}abortTile(te,re){const xe=te.uid,Ve=this.loading[xe];Ve&&(Ve.abort&&Ve.abort(),delete this.loading[xe]),re()}removeTile(te,re){const xe=te.uid;this.loaded[xe]&&delete this.loaded[xe],re()}decodeRasterArray(te,re){n.br.performDecoding(te.buffer,te.task).then(xe=>re(null,xe)).catch(xe=>re(xe))}}const Gt=n.fA.prototype.toGeoJSON;class yt{constructor(te){this._feature=te,this.extent=n.al,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const re of this._feature.geometry)te.push([new n.P(re[0],re[1])]);return te}{const te=[];for(const re of this._feature.geometry){const xe=[];for(const Ve of re)xe.push(new n.P(Ve[0],Ve[1]));te.push(xe)}return te}}toGeoJSON(te,re,xe){return Gt.call(this,te,re,xe)}}class Ke{constructor(te,re){this.name=te,this.extent=n.al,this.length=re.length,this._jsonFeatures=re}feature(te){return new yt(this._jsonFeatures[te])}}class st{constructor(te){this.layers={},this.extent=n.al;for(const re of Object.keys(te))this.layers[re]=new Ke(re,te[re])}}const ht=64/4096,Wt=128;class qt{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],re){for(const xe of te){const Ve=xe.id;if(Ve==null)continue;let Re=this.features.get(Ve);Re&&this.updateCache(Re,re),xe.geometry?(Re=mt(xe),this.updateCache(Re,re),this.features.set(Ve,Re)):this.features.delete(Ve),this.updateCache(Re,re)}}updateCache(te,re){for(const{canonical:xe,uid:Ve}of Object.values(re)){const{z:Re,x:Oe,y:at}=xe;Lt(te,Math.pow(2,Re),Oe,at)&&delete re[Ve]}}getTile(te,re,xe){const Ve=Math.pow(2,te),Re=[];for(const Oe of this.features.values())Lt(Oe,Ve,re,xe)&&Re.push(Be(Oe,Ve,re,xe));return{features:Re}}getFeatures(){return[...this.features.values()]}}function Lt({minX:Ge,minY:te,maxX:re,maxY:xe},Ve,Re,Oe){return Ge<(Re+1+ht)/Ve&&te<(Oe+1+ht)/Ve&&re>(Re-ht)/Ve&&xe>(Oe-ht)/Ve}function mt(Ge){const{id:te,geometry:re,properties:xe}=Ge;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ve,coordinates:Re}=re,Oe={id:te,type:1,geometry:[],tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},at=Oe.geometry;if(Ve==="Point")ze(Re,at,Oe);else if(Ve==="MultiPoint")for(const Ce of Re)ze(Ce,at,Oe);else if(Ve==="LineString")Oe.type=2,Ye(Re,at,Oe);else if(Ve==="MultiLineString")Oe.type=2,wt(Re,at,Oe);else if(Ve==="Polygon")Oe.type=3,wt(Re,at,Oe,!0);else{if(Ve!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Oe.type=3;for(const Ce of Re)wt(Ce,at,Oe,!0)}return Oe}function ze([Ge,te],re,xe){const Ve=n.aF(Ge);let Re=n.aJ(te);Re=Re<0?0:Re>1?1:Re,re.push(Ve,Re),xe.minX=Math.min(xe.minX,Ve),xe.minY=Math.min(xe.minY,Re),xe.maxX=Math.max(xe.maxX,Ve),xe.maxY=Math.max(xe.maxY,Re)}function Ye(Ge,te,re,xe=!1,Ve=!1){const Re=[];for(const Oe of Ge)ze(Oe,Re,re);te.push(Re),xe&&function(Oe,at){let Ce=0;for(let tt=0,Vt=Oe.length,Nt=Vt-2;tt<Vt;Nt=tt,tt+=2)Ce+=(Oe[tt]-Oe[Nt])*(Oe[tt+1]+Oe[Nt+1]);if(Ce>0===at)for(let tt=0,Vt=Oe.length;tt<Vt/2;tt+=2){const Nt=Oe[tt],ha=Oe[tt+1];Oe[tt]=Oe[Vt-2-tt],Oe[tt+1]=Oe[Vt-1-tt],Oe[Vt-2-tt]=Nt,Oe[Vt-1-tt]=ha}}(Re,Ve)}function wt(Ge,te,re,xe=!1){for(let Ve=0;Ve<Ge.length;Ve++)Ye(Ge[Ve],te,re,xe,Ve===0)}function Be(Ge,te,re,xe){const{id:Ve,type:Re,geometry:Oe,tags:at}=Ge,Ce=[];if(Re===1)(function(tt,Vt,Nt,ha,Ia){for(let ma=0;ma<tt.length;ma+=2){const Za=Math.round(n.al*(tt[ma+0]*Vt-Nt)),$a=Math.round(n.al*(tt[ma+1]*Vt-ha));Ia.push([Za,$a])}})(Oe,te,re,xe,Ce);else for(const tt of Oe)ba(tt,te,re,xe,Ce);return{id:Ve,type:Re,geometry:Ce,tags:at}}function ba(Ge,te,re,xe,Ve){const Re=-Wt,Oe=n.al+Wt;let at;for(let Ce=0;Ce<Ge.length-2;Ce+=2){let tt=Math.round(n.al*(Ge[Ce+0]*te-re)),Vt=Math.round(n.al*(Ge[Ce+1]*te-xe)),Nt=Math.round(n.al*(Ge[Ce+2]*te-re)),ha=Math.round(n.al*(Ge[Ce+3]*te-xe));const Ia=Nt-tt,ma=ha-Vt;tt<Re&&Nt<Re||(tt<Re?(Vt+=Math.round(ma*((Re-tt)/Ia)),tt=Re):Nt<Re&&(ha=Vt+Math.round(ma*((Re-tt)/Ia)),Nt=Re),Vt<Re&&ha<Re||(Vt<Re?(tt+=Math.round(Ia*((Re-Vt)/ma)),Vt=Re):ha<Re&&(Nt=tt+Math.round(Ia*((Re-Vt)/ma)),ha=Re),tt>=Oe&&Nt>=Oe||(tt>=Oe?(Vt+=Math.round(ma*((Oe-tt)/Ia)),tt=Oe):Nt>=Oe&&(ha=Vt+Math.round(ma*((Oe-tt)/Ia)),Nt=Oe),Vt>=Oe&&ha>=Oe||(Vt>=Oe?(tt+=Math.round(Ia*((Oe-Vt)/ma)),Vt=Oe):ha>=Oe&&(Nt=tt+Math.round(Ia*((Oe-Vt)/ma)),ha=Oe),at&&tt===at[at.length-1][0]&&Vt===at[at.length-1][1]||(at=[[tt,Vt]],Ve.push(at)),at.push([Nt,ha])))))}}function lr({name:Ge,features:te},re){re.writeStringField(1,Ge),re.writeVarintField(5,n.al);const xe=new Map,Ve=new Map,Re={keys:xe,values:Ve,feature:null};for(const Oe of te)Re.feature=Oe,re.writeMessage(2,Ja,Re);for(const Oe of xe.keys())re.writeStringField(3,Oe);for(const Oe of Ve.keys())re.writeMessage(4,Pn,Oe)}function Ja(Ge,te){const re=Ge.feature;re.id!==void 0&&Number.isSafeInteger(+re.id)&&te.writeVarintField(1,+re.id),re.tags&&te.writeMessage(2,Er,Ge),te.writeVarintField(3,re.type),te.writeMessage(4,gr,re)}function Er({keys:Ge,values:te,feature:re},xe){for(const Ve of Object.keys(re.tags)){let Re=re.tags[Ve];if(Re===null)continue;let Oe=Ge.get(Ve);Oe===void 0&&(Oe=Ge.size,Ge.set(Ve,Oe)),xe.writeVarint(Oe);const at=typeof Re;at!=="string"&&at!=="boolean"&&at!=="number"&&(Re=JSON.stringify(Re));let Ce=te.get(Re);Ce===void 0&&(Ce=te.size,te.set(Re,Ce)),xe.writeVarint(Ce)}}function or(Ge,te){return(te<<3)+(7&Ge)}function ka(Ge){return Ge<<1^Ge>>31}function gr(Ge,te){const{geometry:re,type:xe}=Ge;let Ve=0,Re=0;if(xe===1){te.writeVarint(or(1,re.length));for(const Oe of re){const at=Oe[0]-Ve,Ce=Oe[1]-Re;te.writeVarint(ka(at)),te.writeVarint(ka(Ce)),Ve+=at,Re+=Ce}}else for(const Oe of re){te.writeVarint(or(1,1));const at=Oe.length-(xe===3?1:0);for(let Ce=0;Ce<at;Ce++){Ce===1&&te.writeVarint(or(2,at-1));const tt=Oe[Ce][0]-Ve,Vt=Oe[Ce][1]-Re;te.writeVarint(ka(tt)),te.writeVarint(ka(Vt)),Ve+=tt,Re+=Vt}xe===3&&te.writeVarint(or(7,1))}}function Pn(Ge,te){const re=typeof Ge;re==="string"?te.writeStringField(1,Ge):re==="boolean"?te.writeBooleanField(7,Ge):re==="number"&&(Ge%1!=0?te.writeDoubleField(3,Ge):Ge<0?te.writeSVarintField(6,Ge):te.writeVarintField(5,Ge))}const qo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ge=>Ge},ln=Math.fround||(bs=new Float32Array(1),Ge=>(bs[0]=+Ge,bs[0]));var bs;const Xr=3,Gn=5,rn=6;class Sr{constructor(te){this.options=Object.assign(Object.create(qo),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:re,minZoom:xe,maxZoom:Ve}=this.options;re&&console.time("total time");const Re=`prepare ${te.length} points`;re&&console.time(Re),this.points=te;const Oe=[];for(let Ce=0;Ce<te.length;Ce++){const tt=te[Ce];if(!tt.geometry)continue;const[Vt,Nt]=tt.geometry.coordinates,ha=ln(Tn(Vt)),Ia=ln(cs(Nt));Oe.push(ha,Ia,1/0,Ce,-1,1),this.options.reduce&&Oe.push(0)}let at=this.trees[Ve+1]=this._createTree(Oe);re&&console.timeEnd(Re);for(let Ce=Ve;Ce>=xe;Ce--){const tt=+Date.now();at=this.trees[Ce]=this._createTree(this._cluster(at,Ce)),re&&console.log("z%d: %d clusters in %dms",Ce,at.numItems,+Date.now()-tt)}return re&&console.timeEnd("total time"),this}getClusters(te,re){let xe=((te[0]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,te[1]));let Re=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)xe=-180,Re=180;else if(xe>Re){const Nt=this.getClusters([xe,Ve,180,Oe],re),ha=this.getClusters([-180,Ve,Re,Oe],re);return Nt.concat(ha)}const at=this.trees[this._limitZoom(re)],Ce=at.range(Tn(xe),cs(Oe),Tn(Re),cs(Ve)),tt=at.data,Vt=[];for(const Nt of Ce){const ha=this.stride*Nt;Vt.push(tt[ha+Gn]>1?pi(tt,ha,this.clusterProps):this.points[tt[ha+Xr]])}return Vt}getChildren(te){const re=this._getOriginId(te),xe=this._getOriginZoom(te),Ve="No cluster with the specified id.",Re=this.trees[xe];if(!Re)throw new Error(Ve);const Oe=Re.data;if(re*this.stride>=Oe.length)throw new Error(Ve);const at=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),Ce=Re.within(Oe[re*this.stride],Oe[re*this.stride+1],at),tt=[];for(const Vt of Ce){const Nt=Vt*this.stride;Oe[Nt+4]===te&&tt.push(Oe[Nt+Gn]>1?pi(Oe,Nt,this.clusterProps):this.points[Oe[Nt+Xr]])}if(tt.length===0)throw new Error(Ve);return tt}getLeaves(te,re,xe){const Ve=[];return this._appendLeaves(Ve,te,re=re||10,xe=xe||0,0),Ve}getTile(te,re,xe){const Ve=this.trees[this._limitZoom(te)],Re=Math.pow(2,te),{extent:Oe,radius:at}=this.options,Ce=at/Oe,tt=(xe-Ce)/Re,Vt=(xe+1+Ce)/Re,Nt={features:[]};return this._addTileFeatures(Ve.range((re-Ce)/Re,tt,(re+1+Ce)/Re,Vt),Ve.data,re,xe,Re,Nt),re===0&&this._addTileFeatures(Ve.range(1-Ce/Re,tt,1,Vt),Ve.data,Re,xe,Re,Nt),re===Re-1&&this._addTileFeatures(Ve.range(0,tt,Ce/Re,Vt),Ve.data,-1,xe,Re,Nt),Nt.features.length?Nt:null}getClusterExpansionZoom(te){let re=this._getOriginZoom(te)-1;for(;re<=this.options.maxZoom;){const xe=this.getChildren(te);if(re++,xe.length!==1)break;te=xe[0].properties.cluster_id}return re}_appendLeaves(te,re,xe,Ve,Re){const Oe=this.getChildren(re);for(const at of Oe){const Ce=at.properties;if(Ce&&Ce.cluster?Re+Ce.point_count<=Ve?Re+=Ce.point_count:Re=this._appendLeaves(te,Ce.cluster_id,xe,Ve,Re):Re<Ve?Re++:te.push(at),te.length===xe)break}return Re}_createTree(te){const re=new n.c3(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<te.length;xe+=this.stride)re.add(te[xe],te[xe+1]);return re.finish(),re.data=te,re}_addTileFeatures(te,re,xe,Ve,Re,Oe){for(const at of te){const Ce=at*this.stride,tt=re[Ce+Gn]>1;let Vt,Nt,ha;if(tt)Vt=di(re,Ce,this.clusterProps),Nt=re[Ce],ha=re[Ce+1];else{const Za=this.points[re[Ce+Xr]];Vt=Za.properties;const[$a,ar]=Za.geometry.coordinates;Nt=Tn($a),ha=cs(ar)}const Ia={type:1,geometry:[[Math.round(this.options.extent*(Nt*Re-xe)),Math.round(this.options.extent*(ha*Re-Ve))]],tags:Vt};let ma;ma=tt||this.options.generateId?re[Ce+Xr]:this.points[re[Ce+Xr]].id,ma!==void 0&&(Ia.id=ma),Oe.features.push(Ia)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,re){const{radius:xe,extent:Ve,reduce:Re,minPoints:Oe}=this.options,at=xe/(Ve*Math.pow(2,re)),Ce=te.data,tt=[],Vt=this.stride;for(let Nt=0;Nt<Ce.length;Nt+=Vt){if(Ce[Nt+2]<=re)continue;Ce[Nt+2]=re;const ha=Ce[Nt],Ia=Ce[Nt+1],ma=te.within(Ce[Nt],Ce[Nt+1],at),Za=Ce[Nt+Gn];let $a=Za;for(const ar of ma){const Fr=ar*Vt;Ce[Fr+2]>re&&($a+=Ce[Fr+Gn])}if($a>Za&&$a>=Oe){let ar,Fr=ha*Za,Jn=Ia*Za,ii=-1;const Fn=(Nt/Vt<<5)+(re+1)+this.points.length;for(const cn of ma){const Pr=cn*Vt;if(Ce[Pr+2]<=re)continue;Ce[Pr+2]=re;const Ka=Ce[Pr+Gn];Fr+=Ce[Pr]*Ka,Jn+=Ce[Pr+1]*Ka,Ce[Pr+4]=Fn,Re&&(ar||(ar=this._map(Ce,Nt,!0),ii=this.clusterProps.length,this.clusterProps.push(ar)),Re(ar,this._map(Ce,Pr)))}Ce[Nt+4]=Fn,tt.push(Fr/$a,Jn/$a,1/0,Fn,-1,$a),Re&&tt.push(ii)}else{for(let ar=0;ar<Vt;ar++)tt.push(Ce[Nt+ar]);if($a>1)for(const ar of ma){const Fr=ar*Vt;if(!(Ce[Fr+2]<=re)){Ce[Fr+2]=re;for(let Jn=0;Jn<Vt;Jn++)tt.push(Ce[Fr+Jn])}}}}return tt}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,re,xe){if(te[re+Gn]>1){const Oe=this.clusterProps[te[re+rn]];return xe?Object.assign({},Oe):Oe}const Ve=this.points[te[re+Xr]].properties,Re=this.options.map(Ve);return xe&&Re===Ve?Object.assign({},Re):Re}}function pi(Ge,te,re){return{type:"Feature",id:Ge[te+Xr],properties:di(Ge,te,re),geometry:{type:"Point",coordinates:[(xe=Ge[te],360*(xe-.5)),Ls(Ge[te+1])]}};var xe}function di(Ge,te,re){const xe=Ge[te+Gn],Ve=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,Re=Ge[te+rn],Oe=Re===-1?{}:Object.assign({},re[Re]);return Object.assign(Oe,{cluster:!0,cluster_id:Ge[te+Xr],point_count:xe,point_count_abbreviated:Ve})}function Tn(Ge){return Ge/360+.5}function cs(Ge){const te=Math.sin(Ge*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function Ls(Ge){const te=(180-360*Ge)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Xi(Ge,te,re,xe){let Ve=xe;const Re=te+(re-te>>1);let Oe,at=re-te;const Ce=Ge[te],tt=Ge[te+1],Vt=Ge[re],Nt=Ge[re+1];for(let ha=te+3;ha<re;ha+=3){const Ia=Ko(Ge[ha],Ge[ha+1],Ce,tt,Vt,Nt);if(Ia>Ve)Oe=ha,Ve=Ia;else if(Ia===Ve){const ma=Math.abs(ha-Re);ma<at&&(Oe=ha,at=ma)}}Ve>xe&&(Oe-te>3&&Xi(Ge,te,Oe,xe),Ge[Oe+2]=Ve,re-Oe>3&&Xi(Ge,Oe,re,xe))}function Ko(Ge,te,re,xe,Ve,Re){let Oe=Ve-re,at=Re-xe;if(Oe!==0||at!==0){const Ce=((Ge-re)*Oe+(te-xe)*at)/(Oe*Oe+at*at);Ce>1?(re=Ve,xe=Re):Ce>0&&(re+=Oe*Ce,xe+=at*Ce)}return Oe=Ge-re,at=te-xe,Oe*Oe+at*at}function aa(Ge,te,re,xe){const Ve={id:Ge??null,type:te,geometry:re,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")La(Ve,re);else if(te==="Polygon")La(Ve,re[0]);else if(te==="MultiLineString")for(const Re of re)La(Ve,Re);else if(te==="MultiPolygon")for(const Re of re)La(Ve,Re[0]);return Ve}function La(Ge,te){for(let re=0;re<te.length;re+=3)Ge.minX=Math.min(Ge.minX,te[re]),Ge.minY=Math.min(Ge.minY,te[re+1]),Ge.maxX=Math.max(Ge.maxX,te[re]),Ge.maxY=Math.max(Ge.maxY,te[re+1])}function hr(Ge,te,re,xe){if(!te.geometry)return;const Ve=te.geometry.coordinates;if(Ve&&Ve.length===0)return;const Re=te.geometry.type,Oe=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let at=[],Ce=te.id;if(re.promoteId?Ce=te.properties[re.promoteId]:re.generateId&&(Ce=xe||0),Re==="Point")wr(Ve,at);else if(Re==="MultiPoint")for(const tt of Ve)wr(tt,at);else if(Re==="LineString")nn(Ve,at,Oe,!1);else if(Re==="MultiLineString"){if(re.lineMetrics){for(const tt of Ve)at=[],nn(tt,at,Oe,!1),Ge.push(aa(Ce,"LineString",at,te.properties));return}ni(Ve,at,Oe,!1)}else if(Re==="Polygon")ni(Ve,at,Oe,!0);else{if(Re!=="MultiPolygon"){if(Re==="GeometryCollection"){for(const tt of te.geometry.geometries)hr(Ge,{id:Ce,geometry:tt,properties:te.properties},re,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const tt of Ve){const Vt=[];ni(tt,Vt,Oe,!0),at.push(Vt)}}Ge.push(aa(Ce,Re,at,te.properties))}function wr(Ge,te){te.push(Gs(Ge[0]),us(Ge[1]),0)}function nn(Ge,te,re,xe){let Ve,Re,Oe=0;for(let Ce=0;Ce<Ge.length;Ce++){const tt=Gs(Ge[Ce][0]),Vt=us(Ge[Ce][1]);te.push(tt,Vt,0),Ce>0&&(Oe+=xe?(Ve*Vt-tt*Re)/2:Math.sqrt(Math.pow(tt-Ve,2)+Math.pow(Vt-Re,2))),Ve=tt,Re=Vt}const at=te.length-3;te[2]=1,Xi(te,0,at,re),te[at+2]=1,te.size=Math.abs(Oe),te.start=0,te.end=te.size}function ni(Ge,te,re,xe){for(let Ve=0;Ve<Ge.length;Ve++){const Re=[];nn(Ge[Ve],Re,re,xe),te.push(Re)}}function Gs(Ge){return Ge/360+.5}function us(Ge){const te=Math.sin(Ge*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function kn(Ge,te,re,xe,Ve,Re,Oe,at){if(xe/=te,Re>=(re/=te)&&Oe<xe)return Ge;if(Oe<re||Re>=xe)return null;const Ce=[];for(const tt of Ge){const Vt=tt.geometry;let Nt=tt.type;const ha=Ve===0?tt.minX:tt.minY,Ia=Ve===0?tt.maxX:tt.maxY;if(ha>=re&&Ia<xe){Ce.push(tt);continue}if(Ia<re||ha>=xe)continue;let ma=[];if(Nt==="Point"||Nt==="MultiPoint")co(Vt,ma,re,xe,Ve);else if(Nt==="LineString")Zi(Vt,ma,re,xe,Ve,!1,at.lineMetrics);else if(Nt==="MultiLineString")yi(Vt,ma,re,xe,Ve,!1);else if(Nt==="Polygon")yi(Vt,ma,re,xe,Ve,!0);else if(Nt==="MultiPolygon")for(const Za of Vt){const $a=[];yi(Za,$a,re,xe,Ve,!0),$a.length&&ma.push($a)}if(ma.length){if(at.lineMetrics&&Nt==="LineString"){for(const Za of ma)Ce.push(aa(tt.id,Nt,Za,tt.tags));continue}Nt!=="LineString"&&Nt!=="MultiLineString"||(ma.length===1?(Nt="LineString",ma=ma[0]):Nt="MultiLineString"),Nt!=="Point"&&Nt!=="MultiPoint"||(Nt=ma.length===3?"Point":"MultiPoint"),Ce.push(aa(tt.id,Nt,ma,tt.tags))}}return Ce.length?Ce:null}function co(Ge,te,re,xe,Ve){for(let Re=0;Re<Ge.length;Re+=3){const Oe=Ge[Re+Ve];Oe>=re&&Oe<=xe&&Us(te,Ge[Re],Ge[Re+1],Ge[Re+2])}}function Zi(Ge,te,re,xe,Ve,Re,Oe){let at=ts(Ge);const Ce=Ve===0?Ln:gi;let tt,Vt,Nt=Ge.start;for(let $a=0;$a<Ge.length-3;$a+=3){const ar=Ge[$a],Fr=Ge[$a+1],Jn=Ge[$a+2],ii=Ge[$a+3],Fn=Ge[$a+4],cn=Ve===0?ar:Fr,Pr=Ve===0?ii:Fn;let Ka=!1;Oe&&(tt=Math.sqrt(Math.pow(ar-ii,2)+Math.pow(Fr-Fn,2))),cn<re?Pr>re&&(Vt=Ce(at,ar,Fr,ii,Fn,re),Oe&&(at.start=Nt+tt*Vt)):cn>xe?Pr<xe&&(Vt=Ce(at,ar,Fr,ii,Fn,xe),Oe&&(at.start=Nt+tt*Vt)):Us(at,ar,Fr,Jn),Pr<re&&cn>=re&&(Vt=Ce(at,ar,Fr,ii,Fn,re),Ka=!0),Pr>xe&&cn<=xe&&(Vt=Ce(at,ar,Fr,ii,Fn,xe),Ka=!0),!Re&&Ka&&(Oe&&(at.end=Nt+tt*Vt),te.push(at),at=ts(Ge)),Oe&&(Nt+=tt)}let ha=Ge.length-3;const Ia=Ge[ha],ma=Ge[ha+1],Za=Ve===0?Ia:ma;Za>=re&&Za<=xe&&Us(at,Ia,ma,Ge[ha+2]),ha=at.length-3,Re&&ha>=3&&(at[ha]!==at[0]||at[ha+1]!==at[1])&&Us(at,at[0],at[1],at[2]),at.length&&te.push(at)}function ts(Ge){const te=[];return te.size=Ge.size,te.start=Ge.start,te.end=Ge.end,te}function yi(Ge,te,re,xe,Ve,Re){for(const Oe of Ge)Zi(Oe,te,re,xe,Ve,Re,!1)}function Us(Ge,te,re,xe){Ge.push(te,re,xe)}function Ln(Ge,te,re,xe,Ve,Re){const Oe=(Re-te)/(xe-te);return Us(Ge,Re,re+(Ve-re)*Oe,1),Oe}function gi(Ge,te,re,xe,Ve,Re){const Oe=(Re-re)/(Ve-re);return Us(Ge,te+(xe-te)*Oe,Re,1),Oe}function zo(Ge,te){const re=[];for(let xe=0;xe<Ge.length;xe++){const Ve=Ge[xe],Re=Ve.type;let Oe;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")Oe=Xl(Ve.geometry,te);else if(Re==="MultiLineString"||Re==="Polygon"){Oe=[];for(const at of Ve.geometry)Oe.push(Xl(at,te))}else if(Re==="MultiPolygon"){Oe=[];for(const at of Ve.geometry){const Ce=[];for(const tt of at)Ce.push(Xl(tt,te));Oe.push(Ce)}}re.push(aa(Ve.id,Re,Oe,Ve.tags))}return re}function Xl(Ge,te){const re=[];re.size=Ge.size,Ge.start!==void 0&&(re.start=Ge.start,re.end=Ge.end);for(let xe=0;xe<Ge.length;xe+=3)re.push(Ge[xe]+te,Ge[xe+1],Ge[xe+2]);return re}function Ws(Ge,te){if(Ge.transformed)return Ge;const re=1<<Ge.z,xe=Ge.x,Ve=Ge.y;for(const Re of Ge.features){const Oe=Re.geometry,at=Re.type;if(Re.geometry=[],at===1)for(let Ce=0;Ce<Oe.length;Ce+=2)Re.geometry.push($d(Oe[Ce],Oe[Ce+1],te,re,xe,Ve));else for(let Ce=0;Ce<Oe.length;Ce++){const tt=[];for(let Vt=0;Vt<Oe[Ce].length;Vt+=2)tt.push($d(Oe[Ce][Vt],Oe[Ce][Vt+1],te,re,xe,Ve));Re.geometry.push(tt)}}return Ge.transformed=!0,Ge}function $d(Ge,te,re,xe,Ve,Re){return[Math.round(re*(Ge*xe-Ve)),Math.round(re*(te*xe-Re))]}function Yu(Ge,te,re,xe,Ve){const Re=te===Ve.maxZoom?0:Ve.tolerance/((1<<te)*Ve.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:Ge.length,source:null,x:re,y:xe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const at of Ge)Hh(Oe,at,Re,Ve);return Oe}function Hh(Ge,te,re,xe){const Ve=te.geometry,Re=te.type,Oe=[];if(Ge.minX=Math.min(Ge.minX,te.minX),Ge.minY=Math.min(Ge.minY,te.minY),Ge.maxX=Math.max(Ge.maxX,te.maxX),Ge.maxY=Math.max(Ge.maxY,te.maxY),Re==="Point"||Re==="MultiPoint")for(let at=0;at<Ve.length;at+=3)Oe.push(Ve[at],Ve[at+1]),Ge.numPoints++,Ge.numSimplified++;else if(Re==="LineString")bc(Oe,Ve,Ge,re,!1,!1);else if(Re==="MultiLineString"||Re==="Polygon")for(let at=0;at<Ve.length;at++)bc(Oe,Ve[at],Ge,re,Re==="Polygon",at===0);else if(Re==="MultiPolygon")for(let at=0;at<Ve.length;at++){const Ce=Ve[at];for(let tt=0;tt<Ce.length;tt++)bc(Oe,Ce[tt],Ge,re,!0,tt===0)}if(Oe.length){let at=te.tags||null;if(Re==="LineString"&&xe.lineMetrics){at={};for(const tt in te.tags)at[tt]=te.tags[tt];at.mapbox_clip_start=Ve.start/Ve.size,at.mapbox_clip_end=Ve.end/Ve.size}const Ce={geometry:Oe,type:Re==="Polygon"||Re==="MultiPolygon"?3:Re==="LineString"||Re==="MultiLineString"?2:1,tags:at};te.id!==null&&(Ce.id=te.id),Ge.features.push(Ce)}}function bc(Ge,te,re,xe,Ve,Re){const Oe=xe*xe;if(xe>0&&te.size<(Ve?Oe:xe))return void(re.numPoints+=te.length/3);const at=[];for(let Ce=0;Ce<te.length;Ce+=3)(xe===0||te[Ce+2]>Oe)&&(re.numSimplified++,at.push(te[Ce],te[Ce+1])),re.numPoints++;Ve&&function(Ce,tt){let Vt=0;for(let Nt=0,ha=Ce.length,Ia=ha-2;Nt<ha;Ia=Nt,Nt+=2)Vt+=(Ce[Nt]-Ce[Ia])*(Ce[Nt+1]+Ce[Ia+1]);if(Vt>0===tt)for(let Nt=0,ha=Ce.length;Nt<ha/2;Nt+=2){const Ia=Ce[Nt],ma=Ce[Nt+1];Ce[Nt]=Ce[ha-2-Nt],Ce[Nt+1]=Ce[ha-1-Nt],Ce[ha-2-Nt]=Ia,Ce[ha-1-Nt]=ma}}(at,Re),Ge.push(at)}const St={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class uo{constructor(te,re){const xe=(re=this.options=function(Re,Oe){for(const at in Oe)Re[at]=Oe[at];return Re}(Object.create(St),re)).debug;if(xe&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ve=function(Re,Oe){const at=[];if(Re.type==="FeatureCollection")for(let Ce=0;Ce<Re.features.length;Ce++)hr(at,Re.features[Ce],Oe,Ce);else hr(at,Re.type==="Feature"?Re:{geometry:Re},Oe);return at}(te,re);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ve=function(Re,Oe){const at=Oe.buffer/Oe.extent;let Ce=Re;const tt=kn(Re,1,-1-at,at,0,-1,2,Oe),Vt=kn(Re,1,1-at,2+at,0,-1,2,Oe);return(tt||Vt)&&(Ce=kn(Re,1,-at,1+at,0,-1,2,Oe)||[],tt&&(Ce=zo(tt,1).concat(Ce)),Vt&&(Ce=Ce.concat(zo(Vt,-1)))),Ce}(Ve,re),Ve.length&&this.splitTile(Ve,0,0,0),xe&&(Ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,re,xe,Ve,Re,Oe,at){const Ce=[te,re,xe,Ve],tt=this.options,Vt=tt.debug;for(;Ce.length;){Ve=Ce.pop(),xe=Ce.pop(),re=Ce.pop(),te=Ce.pop();const Nt=1<<re,ha=tu(re,xe,Ve);let Ia=this.tiles[ha];if(!Ia&&(Vt>1&&console.time("creation"),Ia=this.tiles[ha]=Yu(te,re,xe,Ve,tt),this.tileCoords.push({z:re,x:xe,y:Ve}),Vt)){Vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,xe,Ve,Ia.numFeatures,Ia.numPoints,Ia.numSimplified),console.timeEnd("creation"));const Ka=`z${re}`;this.stats[Ka]=(this.stats[Ka]||0)+1,this.total++}if(Ia.source=te,Re==null){if(re===tt.indexMaxZoom||Ia.numPoints<=tt.indexMaxPoints)continue}else{if(re===tt.maxZoom||re===Re)continue;if(Re!=null){const Ka=Re-re;if(xe!==Oe>>Ka||Ve!==at>>Ka)continue}}if(Ia.source=null,te.length===0)continue;Vt>1&&console.time("clipping");const ma=.5*tt.buffer/tt.extent,Za=.5-ma,$a=.5+ma,ar=1+ma;let Fr=null,Jn=null,ii=null,Fn=null,cn=kn(te,Nt,xe-ma,xe+$a,0,Ia.minX,Ia.maxX,tt),Pr=kn(te,Nt,xe+Za,xe+ar,0,Ia.minX,Ia.maxX,tt);te=null,cn&&(Fr=kn(cn,Nt,Ve-ma,Ve+$a,1,Ia.minY,Ia.maxY,tt),Jn=kn(cn,Nt,Ve+Za,Ve+ar,1,Ia.minY,Ia.maxY,tt),cn=null),Pr&&(ii=kn(Pr,Nt,Ve-ma,Ve+$a,1,Ia.minY,Ia.maxY,tt),Fn=kn(Pr,Nt,Ve+Za,Ve+ar,1,Ia.minY,Ia.maxY,tt),Pr=null),Vt>1&&console.timeEnd("clipping"),Ce.push(Fr||[],re+1,2*xe,2*Ve),Ce.push(Jn||[],re+1,2*xe,2*Ve+1),Ce.push(ii||[],re+1,2*xe+1,2*Ve),Ce.push(Fn||[],re+1,2*xe+1,2*Ve+1)}}getTile(te,re,xe){te=+te,re=+re,xe=+xe;const Ve=this.options,{extent:Re,debug:Oe}=Ve;if(te<0||te>24)return null;const at=1<<te,Ce=tu(te,re=re+at&at-1,xe);if(this.tiles[Ce])return Ws(this.tiles[Ce],Re);Oe>1&&console.log("drilling down to z%d-%d-%d",te,re,xe);let tt,Vt=te,Nt=re,ha=xe;for(;!tt&&Vt>0;)Vt--,Nt>>=1,ha>>=1,tt=this.tiles[tu(Vt,Nt,ha)];return tt&&tt.source?(Oe>1&&(console.log("found parent tile z%d-%d-%d",Vt,Nt,ha),console.time("drilling down")),this.splitTile(tt.source,Vt,Nt,ha,te,re,xe),Oe>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Ws(this.tiles[Ce],Re):null):null}}function tu(Ge,te,re){return 32*((1<<Ge)*re+te)+Ge}function Ql(Ge,te){const re=Ge.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const xe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!xe)return void te(null,null);const Ve=tt=>tt.tags&&"3d_elevation_id"in tt.tags&&"source"in tt.tags&&tt.tags.source==="elevation",Re=xe.features.filter(tt=>Ve(tt));let Oe={_geojsonTileLayer:xe.features};Re.length>0&&(Oe={_geojsonTileLayer:xe.features.filter(tt=>!Ve(tt)),hd_road_elevation:Re});const at=new st(Oe),Ce=function(tt){const Vt=new n.bs;for(const Nt of Object.keys(tt))Vt.writeMessage(3,lr,{name:Nt,features:tt[Nt]});return Vt.finish()}(Oe).buffer;te(null,{vectorTile:at,rawData:Ce})}class fr extends Qe{constructor(te,re,xe,Ve,Re,Oe,at){super(te,re,xe,Ve,Re,Ql,at),Oe&&(this.loadGeoJSON=Oe),this._dynamicIndex=new qt}loadData(te,re){const xe=te&&te.request,Ve=xe&&xe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(te,(Re,Oe)=>{if(Re||!Oe)return re(Re);if(typeof Oe!="object")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const Ce=n.U(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));Oe.features=Oe.features.filter(tt=>Ce.value.evaluate({zoom:0},tt))}te.dynamic?(Oe.type==="Feature"&&(Oe={type:"FeatureCollection",features:[Oe]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Oe.features,this.loaded),te.cluster&&(Oe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Sr(function({superclusterOptions:Ce,clusterProperties:tt}){if(!tt||!Ce)return Ce;const Vt={},Nt={},ha={accumulated:null,zoom:0},Ia={properties:null},ma=Object.keys(tt);for(const Za of ma){const[$a,ar]=tt[Za],Fr=n.U(ar),Jn=n.U(typeof $a=="string"?[$a,["accumulated"],["get",Za]]:$a);Vt[Za]=Fr.value,Nt[Za]=Jn.value}return Ce.map=Za=>{Ia.properties=Za;const $a={};for(const ar of ma)$a[ar]=Vt[ar].evaluate(ha,Ia);return $a},Ce.reduce=(Za,$a)=>{Ia.properties=$a;for(const ar of ma)ha.accumulated=Za[ar],Za[ar]=Nt[ar].evaluate(ha,Ia)},Ce}(te)).load(Oe.features):te.dynamic?this._dynamicIndex:function(Ce,tt){return new uo(Ce,tt)}(Oe,te.geojsonVtOptions)}catch(Ce){return re(Ce)}const at={};if(Ve){const Ce=B(xe);Ce&&(at.resourceTiming={},at.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ce)))}re(null,at)}})}reloadTile(te,re){const xe=this.loaded;return xe&&xe[te.uid]?te.partial?re(null,void 0):super.reloadTile(te,re):this.loadTile(te,re)}loadGeoJSON(te,re){if(te.request)n.m(te.request,re);else{if(typeof te.data!="string")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return re(null,JSON.parse(te.data))}catch{return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(te,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(xe){re(xe)}}getClusterChildren(te,re){try{re(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(xe){re(xe)}}getClusterLeaves(te,re){try{re(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(xe){re(xe)}}}class Vi{constructor(te,re,xe){this.tileID=new n.aP(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=re,this.worldview=xe}parse(te,re,xe,Ve){this.status="parsing";const Re=new n.aP(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),Oe=[],at=re.familiesBySource[xe.source],Ce=new n.fm(Re,xe.promoteId);Ce.bucketLayerIDs=[],Ce.is3DTile=!0,n.fB(te).then(tt=>{if(!tt)return Ve(new Error("Could not parse tile"));const Vt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||tt.json.asset.extras&&tt.json.asset.extras.MAPBOX_mesh_features,Nt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("EXT_meshopt_compression"),ha=new n.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ia in at)for(const ma of at[Ia]){const Za=ma[0];Ce.bucketLayerIDs.push(ma.map(Fr=>n.B(Fr.id,Fr.scope))),Za.recalculate(ha,[]);const $a=n.fC(tt,1/n.d6(xe.tileID.canonical)),ar=new n.fD(ma,$a,Re,Vt,Nt,this.brightness,Ce,this.worldview);Vt||(ar.needsUpload=!0),Oe.push(ar),ar.evaluate(Za)}this.status="done",Ve(null,{buckets:Oe,featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(tt=>Ve(new Error(tt.message)))}}class $u{constructor(te,re,xe,Ve,Re,Oe,at,Ce){this.actor=te,this.layerIndex=re,this.availableImages=xe,this.availableModels=Ve,this.brightness=at,this.loading={},this.loaded={},this.worldview=Ce}loadTile(te,re){const xe=te.uid,Ve=this.loading[xe]=new Vi(te,this.brightness,this.worldview);n.bt(te.request,(Re,Oe)=>{const at=!this.loading[xe];return delete this.loading[xe],at||Re?(Ve.status="done",at||(this.loaded[xe]=Ve),re(Re)):Oe&&Oe.byteLength!==0?void Ve.parse(Oe,this.layerIndex,te,(Ce,tt)=>{Ve.status="done",this.loaded=this.loaded||{},this.loaded[xe]=Ve,Ce||!tt?re(Ce):re(null,tt)}):(Ve.status="done",this.loaded[xe]=Ve,re())})}reloadTile(te,re){const xe=this.loaded,Ve=te.uid;if(xe&&xe[Ve]){const Re=xe[Ve];Re.projection=te.projection,Re.brightness=te.brightness;const Oe=(at,Ce)=>{Re.reloadCallback&&(delete Re.reloadCallback,this.loadTile(te,re)),re(at,Ce)};Re.status==="parsing"?Re.reloadCallback=Oe:Re.status==="done"&&this.loadTile(te,re)}}abortTile(te,re){const xe=te.uid;this.loading[xe]&&delete this.loading[xe],re()}removeTile(te,re){const xe=this.loaded,Ve=te.uid;xe&&xe[Ve]&&delete xe[Ve],re()}}class Lc{constructor(te){this.self=te,this.actor=new n.fF(te,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=n.cl({name:"mercator"}),this.workerSourceTypes={vector:Qe,geojson:fr,"raster-dem":Ft,"raster-array":Qt,"batched-model":$u},this.workerSources={},this.self.registerWorkerSource=(re,xe)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=xe},this.self.registerRTLTextPlugin=re=>{if(n.fG.isParsed())throw new Error("RTL text plugin already registered.");n.fG.setState({pluginStatus:n.fH.parsed,pluginURL:n.fG.getPluginURL()}),n.fG.applyArabicShaping=re.applyArabicShaping,n.fG.processBidirectionalText=re.processBidirectionalText,n.fG.processStyledBidirectionalText=re.processStyledBidirectionalText;for(const xe of this.rtlPluginParsingListeners)xe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(te,re,xe){delete this.layerIndexes[te],delete this.availableImages[te],delete this.availableModels[te],delete this.workerSources[te],xe()}checkIfReady(te,re,xe){xe()}setReferrer(te,re){this.referrer=re}spriteLoaded(te,re){this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={});const{scope:xe,isLoaded:Ve}=re;if(this.isSpriteLoaded[te][xe]=Ve,this.workerSources[te]&&this.workerSources[te][xe])for(const Re in this.workerSources[te][xe]){const Oe=this.workerSources[te][xe][Re];for(const at in Oe){const Ce=Oe[at];Ce instanceof Qe&&(Ce.isSpriteLoaded=Ve,Ce.fire(new n.z("isSpriteLoaded")))}}}setImages(te,re,xe){this.availableImages[te]||(this.availableImages[te]={});const{scope:Ve,images:Re}=re;if(this.availableImages[te][Ve]=Re,this.workerSources[te]&&this.workerSources[te][Ve]){for(const Oe in this.workerSources[te][Ve]){const at=this.workerSources[te][Ve][Oe];for(const Ce in at)at[Ce].availableImages=Re}xe()}else xe()}setModels(te,{scope:re,models:xe},Ve){if(this.availableModels[te]||(this.availableModels[te]={}),this.availableModels[te][re]=xe,this.workerSources[te]&&this.workerSources[te][re]){for(const Re in this.workerSources[te][re]){const Oe=this.workerSources[te][re][Re];for(const at in Oe)Oe[at].availableModels=xe}Ve()}else Ve()}setProjection(te,re){this.projections[te]=n.cl(re)}setBrightness(te,re,xe){this.brightness=re,xe()}setWorldview(te,re,xe){this.worldview=re,xe()}setLayers(te,re,xe){this.getLayerIndex(te,re.scope).replace(re.layers,re.options),xe()}updateLayers(te,re,xe){this.getLayerIndex(te,re.scope).update(re.layers,re.removedIds,re.options),xe()}loadTile(te,re,xe){re.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source,re.scope).loadTile(re,xe)}decodeRasterArray(te,re,xe){this.getWorkerSource(te,re.type,re.source,re.scope).decodeRasterArray(re,xe)}reloadTile(te,re,xe){re.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source,re.scope).reloadTile(re,xe)}abortTile(te,re,xe){this.getWorkerSource(te,re.type,re.source,re.scope).abortTile(re,xe)}removeTile(te,re,xe){this.getWorkerSource(te,re.type,re.source,re.scope).removeTile(re,xe)}removeSource(te,re,xe){if(!(this.workerSources[te]&&this.workerSources[te][re.scope]&&this.workerSources[te][re.scope][re.type]&&this.workerSources[te][re.scope][re.type][re.source]))return;const Ve=this.workerSources[te][re.scope][re.type][re.source];delete this.workerSources[te][re.scope][re.type][re.source],Ve.removeSource!==void 0?Ve.removeSource(re,xe):xe()}loadWorkerSource(te,re,xe){try{this.self.importScripts(re.url),xe()}catch(Ve){xe(Ve.toString())}}syncRTLPluginState(te,re,xe){if(n.fG.isParsed())xe(null,!0);else if(n.fG.isParsing())this.rtlPluginParsingListeners.push(xe);else try{n.fG.setState(re);const Ve=n.fG.getPluginURL();!n.fG.isLoaded()||n.fG.isParsed()||n.fG.isParsing()||Ve==null||(n.fG.setState({pluginStatus:n.fH.parsing,pluginURL:n.fG.getPluginURL()}),this.self.importScripts(Ve),n.fG.isParsed()?xe(null,!0):this.rtlPluginParsingListeners.push(xe))}catch(Ve){xe(Ve.toString())}}setDracoUrl(te,re){this.dracoUrl=re}getAvailableImages(te,re){this.availableImages[te]||(this.availableImages[te]={});let xe=this.availableImages[te][re];return xe||(xe=[]),xe}getAvailableModels(te,re){this.availableModels[te]||(this.availableModels[te]={});let xe=this.availableModels[te][re];return xe||(xe={}),xe}getLayerIndex(te,re){this.layerIndexes[te]||(this.layerIndexes[te]={});let xe=this.layerIndexes[te][re];return xe||(xe=this.layerIndexes[te][re]=new G,xe.scope=re),xe}getWorkerSource(te,re,xe,Ve){const Re=this.workerSources;return Re[te]||(Re[te]={}),Re[te][Ve]||(Re[te][Ve]={}),Re[te][Ve][re]||(Re[te][Ve][re]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),Re[te][Ve][re][xe]||(Re[te][Ve][re][xe]=new this.workerSourceTypes[re]({send:(Oe,at,Ce,tt,Vt,Nt)=>this.actor.send(Oe,at,Ce,te,Vt,Nt),scheduler:this.actor.scheduler},this.getLayerIndex(te,Ve),this.getAvailableImages(te,Ve),this.getAvailableModels(te,Ve),this.isSpriteLoaded[te][Ve],void 0,this.brightness,this.worldview)),Re[te][Ve][re][xe]}rasterizeImagesWorker(te,re,xe){const Ve=new Map;for(const[Re,{image:Oe,imageVariant:at}]of re.tasks.entries()){const Ce=this.imageRasterizer.rasterize(at,Oe,re.scope,te);Ve.set(Re,Ce)}xe(void 0,Ve)}removeRasterizedImages(te,re,xe){this.imageRasterizer.removeImagesFromCacheByIds(re.imageIds,re.scope,te),xe()}enforceCacheSizeLimit(te,re){n.fI(re)}getWorkerPerformanceMetrics(te,re,xe){xe(void 0,void 0)}}return n.fE(self)&&(self.worker=new Lc(self)),Lc}),Z(["./shared"],function(n){var B="3.16.0";const D={create:"create",load:"load",fullLoad:"fullLoad"},P={mark(h){performance.mark(h)},measure(h,t,i){performance.measure(h,t,i)}};function G(h){const t=h.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var Y,X={},ue=function(){if(Y)return X;function h(f){return!t(f)}function t(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,b,E=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(E);try{b=new Worker(A),w=!0}catch{w=!1}return b&&b.terminate(),URL.revokeObjectURL(A),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var b=w.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===w.width}()?(i[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(i[_]=function(w){var b,E=function(A){var M=document.createElement("canvas"),I=Object.create(h.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=A,M.getContext("webgl2",I)}(w);if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),E.getShaderParameter(b,E.COMPILE_STATUS)===!0)}(_)),i[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}Y=1,X.supported=h,X.notSupportedReason=t;var i={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},X}();function oe(h,t,i){const f=document.createElement(h);return t!=null&&(f.className=t),i&&i.appendChild(f),f}function pe(h,t,i){const f=document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(t))f.setAttributeNS(null,_,String(t[_]));return i&&i.appendChild(f),f}const ve=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ke=ve&&ve.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ye;function $e(){ve&&ke&&(ye=ve[ke],ve[ke]="none")}function De(){ve&&ke&&(ve[ke]=ye)}function Te(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Te,!0)}function Qe(){window.addEventListener("click",Te,!0),window.setTimeout(()=>{window.removeEventListener("click",Te,!0)},0)}function Ft(h,t){const i=h.getBoundingClientRect();return Gt(h,i,t)}function bt(h,t){const i=h.getBoundingClientRect(),f=[];for(let _=0;_<t.length;_++)f.push(Gt(h,i,t[_]));return f}function Qt(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function Gt(h,t,i){const f=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new n.P((i.clientX-t.left)*f,(i.clientY-t.top)*f)}const yt="01",Ke="NO_ACCESS_TOKEN";class st{constructor(t,i,f){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const t=function(){let i="";for(let f=0;f<10;f++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yt,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!n.h(t))return t;const f=Wt(t);return f.params.push(`sdk=js-${B}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!n.h(t))return t;const f=Wt(t);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||i)}normalizeModelURL(t,i){if(!n.h(t))return t;const f=Wt(t);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||i)}normalizeSourceURL(t,i,f,_){if(!n.h(t))return t;const w=Wt(t);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),f&&w.params.push(`language=${f}`),_&&w.params.push(`worldview=${_}`),this._makeAPIURL(w,this._customAccessToken||i)}normalizeIconsetURL(t,i){const f=Wt(t);return n.h(t)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||i)):qt(f)}normalizeSpriteURL(t,i,f,_){const w=Wt(t);return n.h(t)?(w.path=`/styles/v1${w.path}/sprite${i}${f}`,this._makeAPIURL(w,this._customAccessToken||_)):(w.path+=`${i}${f}`,qt(w))}normalizeTileURL(t,i,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.h(t))return t;const _=Wt(t);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||f&&_.authority!=="raster"&&f===512?"@2x":""}${n.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${n.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${n.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${n.e.TILE_URL_VERSION}${_.path}`);const w=this._customAccessToken||function(b){for(const E of b){const A=E.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(_.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,w)}canonicalizeTileURL(t,i){const f=Wt(t);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return t;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let w=f.params;return i&&(w=w.filter(b=>!b.match(/^access_token=/))),w.length&&(_+=`?${w.join("&")}`),_}canonicalizeTileset(t,i){const f=!!i&&n.h(i),_=[];for(const w of t.tiles||[])n.j(w)?_.push(this.canonicalizeTileURL(w,f)):_.push(w);return _}_makeAPIURL(t,i){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Wt(n.e.API_URL);if(t.protocol=_.protocol,t.authority=_.authority,t.protocol==="http"){const w=t.params.indexOf("secure");w>=0&&t.params.splice(w,1)}if(_.path!=="/"&&(t.path=`${_.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return qt(t);if(i=i||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return t.params=t.params.filter(w=>w.indexOf("access_token")===-1),t.params.push(`access_token=${i||""}`),qt(t)}}const ht=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(h){const t=h.match(ht);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function qt(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const Lt="mapbox.eventData";function mt(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.l(t[1]))}catch{return null}}class ze{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=mt(n.e.ACCESS_TOKEN);let f="";return f=i&&i.u?n.f(i.u):n.e.ACCESS_TOKEN||"",t?`${Lt}.${t}:${f}`:`${Lt}:${f}`}fetchEventData(){const t=n.s("localStorage"),i=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp");if(t)try{const w=localStorage.getItem(i);w&&(this.eventData=JSON.parse(w));const b=localStorage.getItem(f);b&&(this.anonId=b);const E=localStorage.getItem(_);E&&(this.anonIdTimestamp=Number(E));const A=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<A)&&this.refreshUUID()}catch{n.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=n.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=n.s("localStorage"),i=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp"),w=this.anonId,b=this.anonIdTimestamp;if(t&&w)try{localStorage.setItem(f,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData)),b&&localStorage.setItem(_,b.toString())}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,f,_){if(!n.e.EVENTS_URL)return;const w=Wt(n.e.EVENTS_URL);w.params.push(`access_token=${_||n.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(t).toISOString()},E=i?Object.assign(b,i):b,A={url:qt(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=n.p(A,M=>{this.pendingRequest=null,f(M),this.saveEventData(),this.processRequests(_)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const Ye=new class extends ze{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(i=>n.h(i)||n.j(i))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=mt(n.e.ACCESS_TOKEN),i=t?t.u:n.e.ACCESS_TOKEN;let f=i!==this.eventData.tokenU;n.v(this.anonId)||(this.refreshUUID(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),b=new Date(_),E=(_-this.eventData.lastSuccess)/864e5;f=f||E>=1||E<-1||w.getDate()!==b.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:yt,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=_,this.eventData.tokenU=i)},h):this.processRequests()}},wt=Ye.postTurnstileEvent.bind(Ye),Be=new class extends ze{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,i,f){this.skuToken=t,this.errorCb=f,n.e.EVENTS_URL&&(i||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},i):this.errorCb(new Error(Ke)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID(),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:B,skuId:yt,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},ba=Be.postMapLoadEvent.bind(Be),lr=new class extends ze{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=n.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:i,style:f,importedStyles:_}=t;if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(i),b={mapInstanceId:w,eventId:this.getEventId(w),style:f};_.length&&(b.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:b},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,()=>{},h)}},Ja=lr.postStyleLoadEvent.bind(lr),Er=new class extends ze{constructor(h){super("metrics"),h&&(this.data=h)}postMetricsEvent(h){if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID();const t=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,()=>{},h)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),or=Er.postMetricsEvent.bind(Er),ka=new class extends ze{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){n.e.EVENTS_URL&&(h||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),f=function(_){const w=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),E=function(U){const H={};if(U){for(const q in U)if(q!=="other")for(const ne of U[q]){const ae=`${q}ResolveRangeMin`,se=`${q}ResolveRangeMax`,he=`${q}RequestCount`,ce=`${q}RequestCachedCount`;H[ae]=Math.min(H[ae]||1/0,ne.startTime),H[se]=Math.max(H[se]||-1/0,ne.responseEnd);const Ze=me=>{H[me]===void 0&&(H[me]=0),++H[me]};ne.transferSize!==void 0&&ne.transferSize===0&&Ze(ce),Ze(he)}}return H}(function(U,H){const q={};if(U)for(const ne of U){const ae=H(ne);q[ae]===void 0&&(q[ae]=[]),q[ae].push(ne)}return q}(w,G)),A=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,I=M?M.effectiveType:void 0,C={counters:[],metadata:[],attributes:[]},J=(U,H,q)=>{q!=null&&U.push({name:H,value:q.toString()})};for(const U in E)J(C.counters,U,E[U]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(J(C.counters,"interactionRangeMin",_.interactionRange[0]),J(C.counters,"interactionRangeMax",_.interactionRange[1])),b)for(const U of Object.values(D)){const H=b.find(q=>q.name===U);H&&J(C.counters,U,H.startTime)}return J(C.counters,"visibilityHidden",_.visibilityHidden),J(C.attributes,"style",function(U){if(U)for(const H of U){const q=H.name.split("?")[0];if(n.i(q)){const ne=q.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(w)),J(C.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),J(C.attributes,"fogEnabled",_.fogEnabled?"true":"false"),J(C.attributes,"projection",_.projection),J(C.attributes,"zoom",_.zoom),J(C.metadata,"devicePixelRatio",A),J(C.metadata,"connectionEffectiveType",I),J(C.metadata,"navigatorUserAgent",navigator.userAgent),J(C.metadata,"screenWidth",window.screen.width),J(C.metadata,"screenHeight",window.screen.height),J(C.metadata,"windowWidth",window.innerWidth),J(C.metadata,"windowHeight",window.innerHeight),J(C.metadata,"mapWidth",_.width/A),J(C.metadata,"mapHeight",_.height/A),J(C.metadata,"webglRenderer",_.renderer),J(C.metadata,"webglVendor",_.vendor),J(C.metadata,"sdkVersion",B),J(C.metadata,"sdkIdentifier","mapbox-gl-js"),C}(i);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(t,f,()=>{},h)}},gr=ka.postPerformanceEvent.bind(ka),Pn=new class extends ze{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,i,f){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const _=Wt(n.e.API_URL+n.e.SESSION_PATH);_.params.push(`sku=${t||""}`),_.params.push(`access_token=${f||n.e.ACCESS_TOKEN||""}`);const w={url:qt(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(w,b=>{this.pendingRequest=null,i(b),this.saveEventData(),this.processRequests(f)})}getSessionAPI(h,t,i,f){this.skuToken=t,this.errorCb=f,n.e.SESSION_PATH&&n.e.API_URL&&(i||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},i):this.errorCb(new Error(Ke)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},qo=Pn.getSessionAPI.bind(Pn),ln=new Set;function bs(h,t){t?ln.add(h):ln.delete(h)}class Xr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){const i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(const i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,i){this._updatedImages[i]=this._updatedImages[i]||new Set,this._updatedImages[i].add(n.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Gn(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class rn extends n.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.r()&&(this.imageRasterizerDispatcher=new n.D(n.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new n.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const i=this.atlasTexture.get(t);i&&(i.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,i){this.imageProviders.has(i)||this.imageProviders.set(i,new Map),this.imageProviders.get(i).set(t.id,t)}removeImageProvider(t,i){this.imageProviders.has(i)&&this.imageProviders.get(i).delete(t)}getPendingImageProviders(){const t=[];for(const i of this.imageProviders.values())for(const f of i.values())f.hasPendingRequests()&&t.push(f);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,i){if(this.loaded.get(i)!==t&&(this.loaded.set(i,t),t)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,i,_);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images.get(i).get(t.toString())}addImage(t,i,f){this._validate(t,f)&&this.images.get(i).set(t.toString(),f)}_validate(t,i){let f=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(i.content,i)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "content" value`))),f=!1),f}_validateStretch(t,i){if(!t)return!0;let f=0;for(const _ of t){if(_[0]<f||_[1]<_[0]||i<_[1])return!1;f=_[1]}return!0}_validateContent(t,i){return t?t.length!==4||!i.usvg&&(t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,i,f){const _=this.images.get(i).get(t.toString());f.version=_.version+1,this.images.get(i).set(t.toString(),f),this.updatedImages.get(i).add(t),this.removeFromImageRasterizerCache(t,i)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,i){this.spriteFormat!=="raster"&&(n.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:i}):this.imageRasterizer.removeImagesFromCacheByIds([t],i))}removeImage(t,i){const f=this.images.get(i),_=f.get(t.toString());f.delete(t.toString()),this.patterns.get(i).delete(t.toString()),this.removeFromImageRasterizerCache(t,i),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(i=>n.I.from(i))}getImages(t,i,f){const _=[],w=[],b=this.imageProviders.get(i);for(const I of t){if(!I.iconsetId){_.push(I);continue}const C=b.get(I.iconsetId);C&&(this.getImage(I,i)?w.push(I):C.addPendingRequest(I))}if(_.length===0)return void this._notify(w,i,f);let E=!0;const A=!!this.loaded.get(i),M=this.images.get(i);if(!A)for(const I of _)M.has(I.toString())||(E=!1);A||E?this._notify(_,i,f):this.requestors.push({ids:_,scope:i,callback:f})}rasterizeImages(t,i){const f=new Map,{tasks:_,scope:w}=t;for(const[b,E]of _.entries()){const A=this.getImage(E.id,w);A&&f.set(b,{image:A,imageVariant:E})}this._rasterizeImages(w,f,i)}_rasterizeImages(t,i,f){if(n.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:i,scope:t},f);else{const _=new Map;for(const[w,{image:b,imageVariant:E}]of i.entries())_.set(w,this.imageRasterizer.rasterize(E,b,t,0));f(void 0,_)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,i,f){const _=this.images.get(i),w=new Map;for(const b of t){if(!_.get(b.toString())){if(b.iconsetId)continue;this.fire(new n.z("styleimagemissing",{id:b.name}))}const E=_.get(b.toString());if(!E){n.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(A,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),w.set(n.I.toString(b),A)}f(null,w)}getPixelSize(t){const{width:i,height:f}=this.atlasImage.get(t);return{width:i,height:f}}getPattern(t,i,f){const _=t.toString(),w=this.patterns.get(i),b=w.get(_),E=this.getImage(t,i);if(!E)return null;if(b){if(b.position.version===E.version)return b.position;b.position.version=E.version}else{if(E.usvg&&!E.data){const A=this.getPatternInFlightId(_,i);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const M=new n.A(t).scaleSelf(n.o.devicePixelRatio),I=new Map([[M.toString(),{image:E,imageVariant:M}]]);return this._rasterizeImages(i,I,(C,J)=>this.storePatternImage(M,i,E,f,J)),null}this.storePattern(t,i,E)}return this._updatePatternAtlas(i,f),w.get(_).position}getPatternInFlightId(t,i){return n.B(t,i)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,i,f,_,w){const b=t.toString(),E=w?w.get(b):void 0;E&&(f.data=E,this.storePattern(t.id,i,f),this._updatePatternAtlas(i,_),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),i)))}storePattern(t,i,f){const _={w:f.data.width+2*n.C,h:f.data.height+2*n.C,x:0,y:0},w=new n.F(_,f,n.C);this.patterns.get(i).set(t.toString(),{bin:_,position:w})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,i){const f=t.gl;let _=this.atlasTexture.get(i);_?this.dirty&&(_.update(this.atlasImage.get(i)),this.dirty=!1):(_=new n.T(t,this.atlasImage.get(i),f.RGBA8),this.atlasTexture.set(i,_)),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(t,i){const f=this.patterns.get(t),_=Array.from(f.values()).map(({bin:M})=>M),{w,h:b}=n.G(_),E=this.atlasImage.get(t);E.resize({width:w||1,height:b||1});const A=this.images.get(t);for(const[M,{bin:I,position:C}]of f.entries()){let J=C.padding;const U=I.x+J,H=I.y+J,q=A.get(M).data,ne=q.width,ae=q.height;J=J>1?J-1:J,n.q.copy(q,E,{x:0,y:0},{x:U,y:H},{width:ne,height:ae},i),n.q.copy(q,E,{x:0,y:ae-J},{x:U,y:H-J},{width:ne,height:J},i),n.q.copy(q,E,{x:0,y:0},{x:U,y:H+ae},{width:ne,height:J},i),n.q.copy(q,E,{x:ne-J,y:0},{x:U-J,y:H},{width:J,height:ae},i),n.q.copy(q,E,{x:0,y:0},{x:U+ne,y:H},{width:J,height:ae},i),n.q.copy(q,E,{x:ne-J,y:ae-J},{x:U-J,y:H-J},{width:J,height:J},i),n.q.copy(q,E,{x:0,y:ae-J},{x:U+ne,y:H-J},{width:J,height:J},i),n.q.copy(q,E,{x:0,y:0},{x:U+ne,y:H+ae},{width:J,height:J},i),n.q.copy(q,E,{x:ne-J,y:0},{x:U-J,y:H+ae},{width:J,height:J},i)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,i){const f=this.images.get(i);for(const _ of t){if(this.callbackDispatchedThisFrame.get(i).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(i).add(_.toString());const w=f.get(_.toString());Gn(w)&&this.updateImage(_,i,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Sr(h){const t=h.value,i=h.valueSpec,f=h.style,_=h.styleSpec,w=h.key,b=h.arrayElementValidator||Ln;if(!Array.isArray(t))return[new n.V(w,t,`array expected, ${n.K(t)} found`)];if(i.length&&t.length!==i.length)return[new n.V(w,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new n.V(w,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let E={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};_.$version<7&&(E.function=i.function),n.H(i.value)&&(E=i.value);let A=[];for(let M=0;M<t.length;M++)A=A.concat(b({array:t,arrayIndex:M,value:t[M],valueSpec:E,style:f,styleSpec:_,key:`${w}[${M}]`},!0));return A}function pi(h){const t=h.key,i=h.value,f=h.valueSpec;if(!n.L(i))return[new n.V(t,i,`number expected, ${n.K(i)} found`)];if(i!=i)return[new n.V(t,i,"number expected, NaN found")];if("minimum"in f){let _=f.minimum;if(Array.isArray(f.minimum)&&(_=f.minimum[h.arrayIndex]),i<_)return[new n.V(t,i,`${i} is less than the minimum value ${_}`)]}if("maximum"in f){let _=f.maximum;if(Array.isArray(f.maximum)&&(_=f.maximum[h.arrayIndex]),i>_)return[new n.V(t,i,`${i} is greater than the maximum value ${_}`)]}return[]}function di(h){const t=h.key,i=h.value;if(!n.H(i))return[new n.V(t,i,`object expected, ${n.K(i)} found`)];const f=h.valueSpec,_=n.J(i.type);let w,b,E,A={};const M=_!=="categorical"&&i.property===void 0,I=!M,C=function(q){const ne=q.stops;return Array.isArray(ne)&&Array.isArray(ne[0])&&n.H(ne[0][0])}(i),J=gi({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(q){if(_==="identity")return[new n.V(q.key,q.value,'identity function may not have a "stops" property')];let ne=[];const ae=q.value;return ne=ne.concat(Sr({key:q.key,value:ae,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:U})),Array.isArray(ae)&&ae.length===0&&ne.push(new n.V(q.key,ae,"array must have at least one stop")),ne},default:function(q){return Ln({key:q.key,value:q.value,valueSpec:f,style:q.style,styleSpec:q.styleSpec})}}});return _==="identity"&&M&&J.push(new n.V(h.key,h.value,'missing required property "property"')),_==="identity"||i.stops||J.push(new n.V(h.key,h.value,'missing required property "stops"')),_==="exponential"&&f.expression&&!n.M(f)&&J.push(new n.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(I&&!n.N(f)?J.push(new n.V(h.key,h.value,"property functions not supported")):M&&!n.O(f)&&J.push(new n.V(h.key,h.value,"zoom functions not supported"))),_!=="categorical"&&!C||i.property!==void 0||J.push(new n.V(h.key,h.value,'"property" property is required')),J;function U(q){let ne=[];const ae=q.value,se=q.key;if(!Array.isArray(ae))return[new n.V(se,ae,`array expected, ${n.K(ae)} found`)];if(ae.length!==2)return[new n.V(se,ae,`array length 2 expected, length ${ae.length} found`)];if(C){if(!n.H(ae[0]))return[new n.V(se,ae,`object expected, ${n.K(ae[0])} found`)];const he=ae[0];if(he.zoom===void 0)return[new n.V(se,ae,"object stop key must have zoom")];if(he.value===void 0)return[new n.V(se,ae,"object stop key must have value")];const ce=n.J(he.zoom);if(typeof ce!="number")return[new n.V(se,he.zoom,"stop zoom values must be numbers")];if(E&&E>ce)return[new n.V(se,he.zoom,"stop zoom values must appear in ascending order")];ce!==E&&(E=ce,b=void 0,A={}),ne=ne.concat(gi({key:`${se}[0]`,value:ae[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:pi,value:H}}))}else ne=ne.concat(H({key:`${se}[0]`,value:ae[0],style:q.style,styleSpec:q.styleSpec},ae));return n.Q(n.S(ae[1]))?ne.concat([new n.V(`${se}[1]`,ae[1],"expressions are not allowed in function stops.")]):ne.concat(Ln({key:`${se}[1]`,value:ae[1],valueSpec:f,style:q.style,styleSpec:q.styleSpec}))}function H(q,ne){const ae=n.K(q.value),se=n.J(q.value),he=q.value!==null?q.value:ne;if(w){if(ae!==w)return[new n.V(q.key,he,`${ae} stop domain type must match previous stop domain type ${w}`)]}else w=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean"&&typeof se!="number"&&typeof se!="string"&&typeof se!="boolean")return[new n.V(q.key,he,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&_!=="categorical"){let ce=`number expected, ${ae} found`;return n.N(f)&&_===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(q.key,he,ce)]}return _!=="categorical"||ae!=="number"||typeof se=="number"&&isFinite(se)&&Math.floor(se)===se?_!=="categorical"&&ae==="number"&&typeof se=="number"&&typeof b=="number"&&b!==void 0&&se<b?[new n.V(q.key,he,"stop domain values must appear in ascending order")]:(b=se,_==="categorical"&&se in A?[new n.V(q.key,he,"stop domain values must be unique")]:(A[se]=!0,[])):[new n.V(q.key,he,`integer expected, found ${String(se)}`)]}}function Tn(h){const t=(h.expressionContext==="property"?n.W:n.U)(n.S(h.value),h.valueSpec);if(t.result==="error")return t.value.map(f=>new n.V(`${h.key}${f.key}`,h.value,f.message));const i=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!i.outputDefined())return[new n.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!n.Z(i))return[new n.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return cs(i,h);if(h.expressionContext==="appearance")return Ls(i,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!n.X(i,["zoom","feature-state"]))return[new n.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!n.Y(i))return[new n.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cs(h,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)i.delete(_);if(i.size===0)return[];const f=[];return h instanceof n._&&i.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(_=>{f.push(...cs(_,t))}),f)}function Ls(h,t){const i=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)i.add(_);if(i.size===0)return[];const f=[];return h instanceof n._&&!i.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] is not an allowed parameter`)]:(h.eachChild(_=>{f.push(...Ls(_,t))}),f)}function Xi(h){const t=h.key,i=h.value,f=h.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(n.J(i))===-1&&_.push(new n.V(t,i,`expected one of [${f.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(f.values).indexOf(n.J(i))===-1&&_.push(new n.V(t,i,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(i)} found`)),_}function Ko(h){return n.a2(n.S(h.value))?Tn(Object.assign({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):aa(h)}function aa(h){const t=h.value,i=h.key;if(!Array.isArray(t))return[new n.V(i,t,`array expected, ${n.K(t)} found`)];if(t.length<1)return[new n.V(i,t,"filter array must have at least 1 element")];const f=h.styleSpec;let _=Xi({key:`${i}[0]`,value:t[0],valueSpec:f.filter_operator});switch(n.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.J(t[1])==="$type"&&_.push(new n.V(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new n.V(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n.a0(t[1])||_.push(new n.V(`${i}[1]`,t[1],`string expected, ${n.K(t[1])} found`)));for(let w=2;w<t.length;w++)n.J(t[1])==="$type"?_=_.concat(Xi({key:`${i}[${w}]`,value:t[w],valueSpec:f.geometry_type})):n.a0(t[w])||n.L(t[w])||n.$(t[w])||_.push(new n.V(`${i}[${w}]`,t[w],`string, number, or boolean expected, ${n.K(t[w])} found.`));break;case"any":case"all":case"none":for(let w=1;w<t.length;w++)_=_.concat(aa({key:`${i}[${w}]`,value:t[w],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":t.length!==2?_.push(new n.V(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):n.a0(t[1])||_.push(new n.V(`${i}[1]`,t[1],`string expected, ${n.K(t[1])} found`))}return _}function La(h,t){const i=h.key,f=h.style,_=h.layer,w=h.styleSpec,b=h.value,E=h.objectKey,A=w[`${t}_${h.layerType}`];if(!A)return[];const M=E.match(/^(.*)-use-theme$/);if(M&&A[M[1]])return n.Q(n.S(b))?[].concat(Ln({key:i,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:w,expressionContext:"property",propertyType:t,propertyKey:E})):Ln({key:i,value:b,valueSpec:{type:"string"},style:f,styleSpec:w});const I=E.match(/^(.*)-transition$/);if(t==="paint"&&I&&A[I[1]]&&A[I[1]].transition)return Ln({key:i,value:b,valueSpec:w.transition,style:f,styleSpec:w});const C=h.valueSpec||A[E];if(!C)return[new n.a3(i,b,`unknown property "${E}"`)];let J;if(n.a0(b)&&n.N(C)&&!C.tokens&&(J=/^{([^}]+)}$/.exec(b))){const H=`\`{ "type": "identity", "property": ${J?JSON.stringify(J[1]):'"_"'} }\``;return[new n.V(i,b,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${H}.`)]}const U=[];if(h.layerType==="symbol")E!=="text-field"||!f||f.glyphs||f.imports||U.push(new n.V(i,b,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&n.a4(n.S(b))&&n.J(b.type)==="identity"&&U.push(new n.V(i,b,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&n.N(C)&&(n.a5(C)||n.O(C))){const H=n.W(n.S(b),C).value,q="expression"in H&&H.expression||"_styleExpression"in H&&H._styleExpression&&H._styleExpression.expression;q&&!n.X(q,["measure-light"])&&(E==="model-emissive-strength"&&n.Y(q)&&n.Z(q)||U.push(new n.V(i,b,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(Ln({key:h.key,value:b,valueSpec:C,style:f,styleSpec:w,expressionContext:"property",propertyType:t,propertyKey:E}))}function hr(h){return La(h,"paint")}function wr(h){return La(h,"layout")}function nn(h){let t=[];const i=h.value,f=h.key,_=h.style,w=h.styleSpec;if(!n.H(i))return[new n.V(f,i,"object expected")];i.type||i.ref||t.push(new n.V(f,i,'either "type" or "ref" is required'));let b=n.J(i.type);const E=n.J(i.ref);if(i.id){const A=n.J(i.id);for(let M=0;M<h.arrayIndex;M++){const I=_.layers[M];n.J(I.id)===A&&t.push(new n.V(f,i.id,`duplicate layer id "${A}", previously used at line ${I.id.__line__}`))}}if("ref"in i){let A;["type","source","source-layer","filter","layout"].forEach(M=>{M in i&&t.push(new n.V(f,i[M],`"${M}" is prohibited for ref layers`))}),_.layers.forEach(M=>{n.J(M.id)===E&&(A=M)}),A?A.ref?t.push(new n.V(f,i.ref,"ref cannot reference another ref layer")):b=n.J(A.type):typeof E=="string"&&t.push(new n.V(f,i.ref,`ref layer "${E}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(i.source)if(n.a0(i.source)){const A=_.sources&&_.sources[i.source],M=A&&n.J(A.type);A?M==="vector"&&b==="raster"?t.push(new n.V(f,i.source,`layer "${i.id}" requires a raster source`)):M==="raster"&&b!=="raster"?t.push(new n.V(f,i.source,`layer "${i.id}" requires a vector source`)):M!=="vector"||i["source-layer"]?M==="raster-dem"&&b!=="hillshade"?t.push(new n.V(f,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(b)?b==="line"&&i.paint&&(i.paint["line-gradient"]||i.paint["line-trim-offset"])&&M==="geojson"&&!A.lineMetrics?t.push(new n.V(f,i,`layer "${i.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):b==="raster-particle"&&M!=="raster-array"&&t.push(new n.V(f,i.source,`layer "${i.id}" requires a 'raster-array' source.`)):t.push(new n.V(f,i.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(f,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new n.V(f,i.source,`source "${i.source}" not found`))}else t.push(new n.V(`${f}.source`,i.source,'"source" must be a string'));else t.push(new n.V(f,i,'missing required property "source"'));return t=t.concat(gi({key:f,value:i,valueSpec:w.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ln({key:`${f}.type`,value:i.type,valueSpec:w.layer.type,style:h.style,styleSpec:h.styleSpec,object:i,objectKey:"type"}),filter:A=>Ko(Object.assign({layerType:b},A)),layout:A=>gi({layer:i,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>wr(Object.assign({layerType:b},M))}}),paint:A=>gi({layer:i,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>hr(Object.assign({layerType:b,layer:i},M))}}),appearances(A){const M=Sr({key:A.key,value:A.value,valueSpec:A.valueSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:J=>function(U){const{key:H,layer:q,layerType:ne}=U,ae=n.J(U.value),se=n.J(ae.name),he=n.J(ae.condition),ce=gi({key:H,value:ae,valueSpec:U.styleSpec.appearance,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{condition:Ze=>function(me){const Ne=[];return Ne.push(...Tn({key:me.key,value:me.object.condition,valueSpec:n.a6.appearance.condition,expressionContext:"appearance"})),Ne}(Object.assign({layer:q,layerType:ne},Ze)),properties:Ze=>function(me){const Ne=[],{styleSpec:we,layer:ge,layerType:Se}=me,Pe=we[`paint_${Se}`],Fe=we[`layout_${Se}`],it=me.object[me.objectKey];for(const qe in it){const dt=qe in Pe?"paint":qe in Fe?"layout":void 0;if(!dt){Ne.push(new n.V(me.key,qe,`unknown property "${qe}" for layer type "${Se}"`));continue}const Mt=Object.assign({},me,{key:`${me.key}.${qe}`,object:it,objectKey:qe,layer:ge,layerType:Se,value:it[qe],valueSpec:dt==="paint"?Pe[qe]:Fe[qe]});Ne.push(...La(Mt,dt))}return Ne}(Object.assign({layer:q,layerType:ne},Ze))}});return se!=="hidden"&&he===void 0&&ce.push(new n.V(U.key,"name",'Appearance with name different than "hidden" must have a condition')),ce}(Object.assign({layerType:b,layer:i},J))}),I=Array.isArray(A.value)?A.value:[],C=new Set;return I.forEach((J,U)=>{const H=n.J(J.name);if(H)if(C.has(H)){const q=n.J(i.id);M.push(new n.V(A.key,H,`Duplicated appearance name "${H}" for layer "${q}"`))}else C.add(H)}),M}}})),t}function ni({key:h,value:t}){return n.a0(t)?[]:[new n.V(h,t,`string expected, ${n.K(t)} found`)]}const Gs={promoteId:function h({key:t,value:i}){if(n.a0(i))return ni({key:t,value:i});if(Array.isArray(i)){const _=[],w=n.S(i),b=n.U(w);return b.result==="error"&&b.value.forEach(E=>{_.push(new n.V(`${t}${E.key}`,null,`${E.message}`))}),n.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),_}if(!n.H(i))return[new n.V(t,i,`string, expression or object expected, "${n.K(i)}" found`)];const f=[];for(const _ in i)f.push(...h({key:`${t}.${_}`,value:i[_]}));return f}};function us(h){const t=h.value,i=h.key,f=h.styleSpec,_=h.style;if(!n.H(t))return[new n.V(i,t,`object expected, ${n.K(t)} found`)];if(!("type"in t))return[new n.V(i,t,'"type" is required')];const w=n.J(t.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&("url"in t||"tiles"in t||b.push(new n.a3(i,t,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(gi({key:i,value:t,valueSpec:f[`source_${w.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:Gs})),b;case"geojson":if(b=gi({key:i,value:t,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Gs}),"cluster"in t&&"clusterProperties"in t){if(!n.H(t.clusterProperties))return[new n.V(`${i}.clusterProperties`,t,`object expected, ${n.K(t)} found`)];for(const E in t.clusterProperties){const A=t.clusterProperties[E];if(!Array.isArray(A))return[new n.V(`${i}.clusterProperties.${E}`,A,"array expected")];const[M,I]=A,C=typeof M=="string"?[M,["accumulated"],["get",E]]:M;b.push(...Tn({key:`${i}.${E}.map`,value:I,expressionContext:"cluster-map"})),b.push(...Tn({key:`${i}.${E}.reduce`,value:C,expressionContext:"cluster-reduce"}))}}return b;case"video":return gi({key:i,value:t,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return gi({key:i,value:t,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new n.V(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xi({key:`${i}.type`,value:t.type,valueSpec:{values:kn(f)}})}}function kn(h){return h.source.reduce((t,i)=>{const f=h[i];return f.type.type==="enum"&&(t=t.concat(Object.keys(f.type.values||{}))),t},[])}function co(h){const t=h.value,i=h.styleSpec,f=i.light,_=h.style;if(t===void 0)return[];if(!n.H(t))return[new n.V("light",t,`object expected, ${n.K(t)} found`)];let w=[];for(const b in t){const E=b.match(/^(.*)-transition$/),A=b.match(/^(.*)-use-theme$/);w=w.concat(A&&f[A[1]]?Ln({key:b,value:t[b],valueSpec:{type:"string"},style:_,styleSpec:i}):E&&f[E[1]]&&f[E[1]].transition?Ln({key:b,value:t[b],valueSpec:i.transition,style:_,styleSpec:i}):f[b]?Ln({key:b,value:t[b],valueSpec:f[b],style:_,styleSpec:i}):[new n.V(b,t[b],`unknown property "${b}"`)])}return w}function Zi(h){const t=h.value;if(!t)return[];const i=h.key;if(!n.H(t))return[new n.V(i,t,`object expected, ${n.K(t)} found`)];let f=[];const _=h.styleSpec,w=_["light-3d"],b=h.style,E=h.style.lights;for(const I of["type","id"])if(!(I in t))return f=f.concat([new n.V(i,t,`missing property "${I}"`)]),f;if(!n.a0(t.type))return f=f.concat([new n.V(`${i}.type`,t.type,"string expected")]),f;if(E)for(let I=0;I<h.arrayIndex;I++){const C=n.J(t.type),J=E[I];n.J(J.type)===C&&f.push(new n.V(i,t.id,`duplicate light type "${t.type}", previously defined at line ${J.id.__line__}`))}const A=`properties_light_${t.type}`;if(!(A in _))return f=f.concat([new n.V(`${i}.type`,t,`Invalid light type ${t.type}`)]),f;const M=_[A];for(const I in t)if(I==="properties"){const C=t[I];if(!n.H(C))return f=f.concat([new n.V("properties",C,`object expected, ${n.K(C)} found`)]),f;for(const J in C){const U=J.match(/^(.*)-transition$/),H=J.match(/^(.*)-use-theme$/);f=f.concat(H&&M[H[1]]?Ln({key:I,value:C[J],valueSpec:{type:"string"},style:b,styleSpec:_}):U&&M[U[1]]&&M[U[1]].transition?Ln({key:I,value:t[I],valueSpec:_.transition,style:b,styleSpec:_}):M[J]?Ln({key:J,value:C[J],valueSpec:M[J],style:b,styleSpec:_}):[new n.a3(h.key,C[J],`unknown property "${J}"`)])}}else f=f.concat(w[I]?Ln({key:I,value:t[I],valueSpec:w[I],style:b,styleSpec:_}):[new n.a3(I,t[I],`unknown property "${I}"`)]);return f}function ts(h){const t=h.value,i=h.key,f=h.style,_=h.styleSpec,w=_.terrain;if(t==null)return[];if(!n.H(t))return[new n.V("terrain",t,`object expected, ${n.K(t)} found`)];let b=[];for(const E in t){const A=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);b=b.concat(M&&w[M[1]]?Ln({key:E,value:t[E],valueSpec:{type:"string"},style:f,styleSpec:_}):A&&w[A[1]]&&w[A[1]].transition?Ln({key:E,value:t[E],valueSpec:_.transition,style:f,styleSpec:_}):w[E]?Ln({key:E,value:t[E],valueSpec:w[E],style:f,styleSpec:_}):[new n.a3(E,t[E],`unknown property "${E}"`)])}if(t.source)if(n.a0(t.source)){const E=f.sources&&f.sources[t.source],A=E&&n.J(E.type);E?A!=="raster-dem"&&b.push(new n.V(`${i}.source`,t.source,`terrain cannot be used with a source of type ${A}, it only be used with a "raster-dem" source type`)):b.push(new n.V(`${i}.source`,t.source,`source "${t.source}" not found`))}else b.push(new n.V(`${i}.source`,t.source,"source must be a string"));else b.push(new n.V(i,t,'terrain is missing required property "source"'));return b}function yi(h){const t=h.value,i=h.style,f=h.styleSpec,_=f.fog;if(t===void 0)return[];if(!n.H(t))return[new n.V("fog",t,`object expected, ${n.K(t)} found`)];let w=[];for(const b in t){const E=b.match(/^(.*)-transition$/),A=b.match(/^(.*)-use-theme$/);w=w.concat(A&&_[A[1]]?Ln({key:b,value:t[b],valueSpec:{type:"string"},style:i,styleSpec:f}):E&&_[E[1]]&&_[E[1]].transition?Ln({key:b,value:t[b],valueSpec:f.transition,style:i,styleSpec:f}):_[b]?Ln({key:b,value:t[b],valueSpec:_[b],style:i,styleSpec:f}):[new n.a3(b,t[b],`unknown property "${b}"`)])}return w}const Us={"*":()=>[],array:Sr,boolean:function(h){const t=h.value,i=h.key;return n.$(t)?[]:[new n.V(i,t,`boolean expected, ${n.K(t)} found`)]},number:pi,color:function({key:h,value:t}){return n.a0(t)?n.a1.parseCSSColor(t)===null?[new n.V(h,t,`color expected, "${t}" found`)]:[]:[new n.V(h,t,`color expected, ${n.K(t)} found`)]},enum:Xi,filter:Ko,function:di,layer:nn,object:gi,source:us,model:n.a7,light:co,"light-3d":Zi,terrain:ts,fog:yi,string:ni,formatted:function(h){return ni(h).length===0?[]:Tn(h)},resolvedImage:function(h){return ni(h).length===0?[]:Tn(h)},projection:function(h){const t=h.value,i=h.styleSpec,f=i.projection,_=h.style;if(n.H(t)){let w=[];for(const b in t)w=w.concat(Ln({key:b,value:t[b],valueSpec:f[b],style:_,styleSpec:i}));return w}return n.a0(t)?[]:[new n.V("projection",t,`object or string expected, ${n.K(t)} found`)]},import:function(h){const t=h.key,{value:i,styleSpec:f}=h;if(!n.H(i))return[new n.V(t,i,"import must be an object")];const{data:_,...w}=i;Object.defineProperty(w,"__line__",{value:i.__line__,enumerable:!1});let b=gi(Object.assign({},h,{value:w,valueSpec:f.import}));return n.J(w.id)===""&&b.push(new n.V(`${h.key}.id`,w,"import id can't be an empty string")),_&&(b=b.concat(Xl(_,f,{key:`${h.key}.data`}))),b},iconset:function(h){const t=h.value,i=h.key,f=h.styleSpec,_=h.style;if(!n.H(t))return[new n.V(i,t,"object expected")];if(!t.type)return[new n.V(i,t,'"type" is required')];const w=n.J(t.type);let b=[];if(b=b.concat(gi({key:i,value:t,valueSpec:f[`iconset_${w}`],style:_,styleSpec:f})),function(E,A){return!(E!=="source"||!A.source)}(w,t)){const E=_.sources&&_.sources[t.source],A=E&&n.J(E.type);E?A!=="raster-array"&&b.push(new n.V(i,t.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):b.push(new n.V(i,t.source,`source "${t.source}" not found`))}return b}};function Ln(h,t=!1){const i=h.value,f=h.valueSpec,_=h.styleSpec;if(f.expression){if(n.a4(n.J(i)))return di(h);if(n.Q(n.S(i)))return Tn(h)}if(f.type&&Us[f.type]){const w=Us[f.type](h);return t===!0&&w.length>0&&Array.isArray(h.value)?Tn(h):w}return gi(Object.assign({},h,{valueSpec:f.type?_[f.type]:f}))}function gi(h){const t=h.key,i=h.value,f=h.valueSpec||{},_=h.objectElementValidators||{},w=h.style,b=h.styleSpec;if(!n.H(i))return[new n.V(t,i,`object expected, ${n.K(i)} found`)];let E=[];for(const A in i){const M=A.split(".")[0];let I;_[M]?I=_[M]:f[M]?I=Ln:_["*"]?I=_["*"]:f["*"]&&(I=Ln),I?E=E.concat(I({key:(t&&`${t}.`)+A,value:i[A],valueSpec:f[M]||f["*"],style:w,styleSpec:b,object:i,objectKey:A},i)):E.push(new n.a3(t,i[A],`unknown property "${A}"`))}for(const A in f){if(_[A])continue;const M=f[A];M.required&&M.default===void 0&&i[A]===void 0&&E.push(new n.V(t,i,`missing required property "${A}"`))}return E}function zo({key:h,value:t}){const i=ni({key:h,value:t});if(i.length)return i;const f=t;return f.indexOf("{fontstack}")===-1&&i.push(new n.V(h,t,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&i.push(new n.V(h,t,'"glyphs" url must include a "{range}" token')),i}function Xl(h,t=n.a6,i={}){return gi({key:i.key||"",value:h,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:h,objectElementValidators:{glyphs:zo}})}function Ws(h,t=n.a6){return Ge(Xl(h,t))}const $d=h=>Ge(us(h)),Yu=h=>Ge(co(h)),Hh=h=>Ge(Zi(h)),bc=h=>Ge(ts(h)),St=h=>Ge(yi(h)),uo=h=>Ge(function(t){const i=t.value,f=t.style,_=t.styleSpec,w=_.snow;if(i===void 0)return[];if(!n.H(i))return[new n.V("snow",i,`object expected, ${n.K(i)} found`)];let b=[];for(const E in i){const A=E.match(/^(.*)-transition$/);b=b.concat(A&&w[A[1]]&&w[A[1]].transition?Ln({key:E,value:i[E],valueSpec:_.transition,style:f,styleSpec:_}):w[E]?Ln({key:E,value:i[E],valueSpec:w[E],style:f,styleSpec:_}):[new n.a3(E,i[E],`unknown property "${E}"`)])}return b}(h)),tu=h=>Ge(function(t){const i=t.value,f=t.style,_=t.styleSpec,w=_.rain;if(i===void 0)return[];if(!n.H(i))return[new n.V("rain",i,`object expected, ${n.K(i)} found`)];let b=[];for(const E in i){const A=E.match(/^(.*)-transition$/);b=b.concat(A&&w[A[1]]&&w[A[1]].transition?Ln({key:E,value:i[E],valueSpec:_.transition,style:f,styleSpec:_}):w[E]?Ln({key:E,value:i[E],valueSpec:w[E],style:f,styleSpec:_}):[new n.a3(E,i[E],`unknown property "${E}"`)])}return b}(h)),Ql=h=>Ge(nn(h)),fr=h=>Ge(Ko(h)),Vi=h=>Ge(hr(h)),$u=h=>Ge(wr(h)),Lc=h=>Ge(n.a7(h));function Ge(h){return h.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function te(h,t){let i=!1;if(t&&t.length)for(const f of t)f instanceof n.a3?n.w(f.message):(h.fire(new n.y(new Error(f.message))),i=!0);return i}const re=n.a6.light;let xe;class Ve extends n.E{constructor(t,i="flat"){super(),this._transitionable=new n.a8(xe||(xe=new n.a9({anchor:new n.aa(re.anchor),position:new n.ab(re.position),color:new n.aa(re.color),intensity:new n.aa(re.intensity)}))),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,f={}){this._validate(Yu,t,f)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,f){return(!f||f.validate!==!1)&&te(this,t.call(Ws,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}const Re=n.a6.terrain;let Oe=class extends n.E{constructor(h,t,i,f,_){super(),this.scope=i,this._transitionable=new n.a8(new n.a9({source:new n.aa(Re.source),exaggeration:new n.aa(Re.exaggeration)}),i,f),this._transitionable.setTransitionOrValue(h,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=_}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new n.ac(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let i=-1,f=-1,_=1;for(const w of t.zoomStops)_=t.evaluate(new n.ac(w,{worldview:this.worldview})),_>.01?(i=w,f=-1):f=w;return _<.01&&i>0&&f>i?[i,f]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof n.ad}};const at=45,Ce=65,tt=.05;function Vt(h,t,i,f){const _=n.ah(at,Ce,i),[w,b]=Nt(h,f);let E=1-Math.min(1,Math.exp((t-w)/(b-w)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*_*h.alpha}function Nt(h,t){const i=.5/Math.tan(.5*t);return[h.range[0]+i,h.range[1]+i]}function ha(h,t,i,f,_){const w=n.af([],[t,i,f],_.mercatorFogMatrix);return Vt(h,n.ag(w),_.pitch,_._fov)}function Ia(h,t,i,f,_,w,b){const E=[[i,f,0],[_,f,0],[_,w,0],[i,w,0]];let A=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(const I of E){const C=n.af([],I,t),J=n.ag(C);A=Math.min(A,J),M=Math.max(M,J)}return[Vt(h,A,b.pitch,b._fov),Vt(h,M,b.pitch,b._fov)]}const ma=n.a6.fog;class Za extends n.E{constructor(t,i,f,_){super();const w=new n.a9({range:new n.aa(ma.range),color:new n.aa(ma.color),"color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.aa(ma["high-color"]),"high-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.aa(ma["space-color"]),"space-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.aa(ma["horizon-blend"]),"star-intensity":new n.aa(ma["star-intensity"]),"vertical-range":new n.aa(ma["vertical-range"])});this._transitionable=new n.a8(w,f,new Map(_)),this.set(t,_),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new n.ai(w),this.scope=f}get state(){const t=this._transform,i=t.projection.name==="globe",f=n.aj(t.zoom),_=this.properties.get("range"),w=[.5,3];return{range:i?[n.ak(w[0],_[0],f),n.ak(w[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i,f={}){if(this._validate(St,t,f))return;const _=Object.assign({},t);for(const w of Object.keys(ma))_[w]===void 0&&(_[w]=ma[w].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ah(at,Ce,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(f,_,w){const b=n.ae.fromLngLat(_),E=w.elevation?w.elevation.getAtPointOrZero(b):0;return ha(f,b.x,b.y,E,w)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ia(this.state,i,0,0,n.al,n.al,this._transform)}getOpacityForBounds(t,i,f,_,w){return this._transform.projection.supportsFog?Ia(this.state,t,i,f,_,w,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Nt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const f of i){const _=t.points[f];let w;if(_[2]>=0)w=_;else{const b=t.points[f-4];w=n.am(b,_,b[2]/(b[2]-_[2]))}if(ha(this.state,w[0],w[1],0,this._transform)>=tt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,f){return(!f||f.validate!==!1)&&te(this,t.call(Ws,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}let $a,ar,Fr,Jn,ii=class extends n.E{constructor(h,t,i,f){super();const _=$a||($a=new n.a9({density:new n.aa(n.a6.snow.density),intensity:new n.aa(n.a6.snow.intensity),color:new n.aa(n.a6.snow.color),opacity:new n.aa(n.a6.snow.opacity),vignette:new n.aa(n.a6.snow.vignette),"vignette-color":new n.aa(n.a6.snow["vignette-color"]),"center-thinning":new n.aa(n.a6.snow["center-thinning"]),direction:new n.aa(n.a6.snow.direction),"flake-size":new n.aa(n.a6.snow["flake-size"])}));this._transitionable=new n.a8(_,i,new Map(f)),this.set(h,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(_),this.scope=i}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),f=n.an(i[0]),_=-Math.max(n.an(i[1]),.01),w=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],b=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*h),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(h,t,i={}){if(this._validate(uo,h,i))return;const f=Object.assign({},h),_=n.a6.snow;for(const w of Object.keys(_))f[w]===void 0&&(f[w]=_[w].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,i){return(!i||i.validate!==!1)&&te(this,h.call(Ws,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}},Fn=class extends n.E{constructor(h,t,i,f){super();const _=ar||(ar=new n.a9({density:new n.aa(n.a6.rain.density),intensity:new n.aa(n.a6.rain.intensity),color:new n.aa(n.a6.rain.color),opacity:new n.aa(n.a6.rain.opacity),vignette:new n.aa(n.a6.rain.vignette),"vignette-color":new n.aa(n.a6.rain["vignette-color"]),"center-thinning":new n.aa(n.a6.rain["center-thinning"]),direction:new n.aa(n.a6.rain.direction),"droplet-size":new n.aa(n.a6.rain["droplet-size"]),"distortion-strength":new n.aa(n.a6.rain["distortion-strength"])}));this._transitionable=new n.a8(_,i,new Map(f)),this.set(h,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(_),this.scope=i}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),f=n.an(i[0]),_=-Math.max(n.an(i[1]),.01),w=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*h),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(h,t,i={}){if(this._validate(tu,h,i))return;const f=Object.assign({},h),_=n.a6.rain;for(const w of Object.keys(_))f[w]===void 0&&(f[w]=_[w].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,i){return(!i||i.validate!==!1)&&te(this,h.call(Ws,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}};class cn extends n.E{constructor(t,i,f,_){super(),this.scope=f,this._options=t,this.properties=new n.ai(i),this._transitionable=new n.a8(i,f,new Map(_)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Pr{constructor(t,i,f){this.screenBounds=t,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(t,i){let f,_;if(t instanceof n.P||typeof t[0]=="number"){const w=n.P.convert(t);f=[w],_=i.isPointAboveHorizon(w)}else{const w=n.P.convert(t[0]),b=n.P.convert(t[1]),E=w.add(b)._div(2);f=[w,b],_=n.aq(w,b).every(A=>i.isPointAboveHorizon(A))&&i.isPointAboveHorizon(E)}return new Pr(f,_,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],_=n.aq(i,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(_[3]=this.cameraPoint)),n.ar(_,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],_=n.aq(i,f,t),w=this.cameraPoint.clone();switch(3*((w.y>i.y)+(w.y>f.y))+((w.x>i.x)+(w.x>f.x))){case 0:_[0]=w,_[4]=w.clone();break;case 1:_.splice(1,0,w);break;case 2:_[1]=w;break;case 3:_.splice(4,0,w);break;case 5:_.splice(2,0,w);break;case 6:_[3]=w;break;case 7:_.splice(3,0,w);break;case 8:_[2]=w}return _}containsTile(t,i,f,_=0){const w=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/i._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(w,i):this._bufferedScreenMercator(w,i);let E=t.tileID.wrap+(b.unwrapped?_:0);const A=b.polygon.map(ne=>n.as(t.tileTransform,ne,E));if(!n.at(A,0,0,n.al,n.al))return;E=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const M=this.screenGeometryMercator.polygon.map(ne=>n.au(t.tileTransform,ne,E)),I=M.map(ne=>new n.P(ne[0],ne[1])),C=i.getFreeCameraOptions().position||new n.ae(0,0,0),J=n.au(t.tileTransform,C,E),U=M.map(ne=>{const ae=n.av(ne,ne,J);return n.aw(ae,ae),new n.ax(J,ae)}),H=n.ay(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:U,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(q=n.az(A),q.min.x=n.aA(q.min.x,0,n.al),q.min.y=n.aA(q.min.y,0,n.al),q.max.x=n.aA(q.max.x,0,n.al),q.max.y=n.aA(q.max.y,0,n.al),q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:H};var q}_bufferedScreenMercator(t,i){const f=Vn(t);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(w=>i.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(t,i){const f=Vn(t);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(w=>i.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(t,i){const f=function(w,b){const E=n.aB([],b.pixelMatrix,b.globeMatrix),A=[0,-n.aD,0,1],M=[0,n.aD,0,1],I=[0,0,0,1];n.aC(A,A,E),n.aC(M,M,E),n.aC(I,I,E);const C=new n.P(A[0]/A[3],A[1]/A[3]),J=new n.P(M[0]/M[3],M[1]/M[3]),U=n.aE(w,C)&&A[3]<I[3],H=n.aE(w,J)&&M[3]<I[3];if(!U&&!H)return null;const q=function(Ne,we,ge){for(let Se=1;Se<Ne.length;Se++){const Pe=yn(we.pointCoordinate3D(Ne[Se-1]).x),Fe=yn(we.pointCoordinate3D(Ne[Se]).x);if(ge<0){if(Pe<Fe)return{idx:Se,t:-Pe/(Fe-1-Pe)}}else if(Fe<Pe)return{idx:Se,t:(1-Pe)/(Fe+1-Pe)}}return null}(w,b,U?-1:1);if(!q)return null;const{idx:ne,t:ae}=q;let se=ne>1?Ka(w.slice(0,ne),b):[],he=ne<w.length?Ka(w.slice(ne),b):[];se=se.map(Ne=>new n.P(yn(Ne.x),Ne.y)),he=he.map(Ne=>new n.P(yn(Ne.x),Ne.y));const ce=[...se];ce.length===0&&ce.push(he[he.length-1]);const Ze=n.ak(ce[ce.length-1].y,(he.length===0?se[0]:he[0]).y,ae);let me;return me=U?[new n.P(0,Ze),new n.P(0,0),new n.P(1,0),new n.P(1,Ze)]:[new n.P(1,Ze),new n.P(1,1),new n.P(0,1),new n.P(0,Ze)],ce.push(...me),he.length===0?ce.push(se[0]):ce.push(...he),{polygon:ce.map(Ne=>new n.ae(Ne.x,Ne.y)),unwrapped:!1}}(t,i);if(f)return f;const _=function(w,b){let E=!1,A=-1/0,M=0;for(let C=0;C<w.length-1;C++)w[C].x>A&&(A=w[C].x,M=C);for(let C=0;C<w.length-1;C++){const J=(M+C)%(w.length-1),U=w[J],H=w[J+1];Math.abs(U.x-H.x)>.5&&(U.x<H.x?(U.x+=1,J===0&&(w[w.length-1].x+=1)):(H.x+=1,J+1===w.length-1&&(w[0].x+=1)),E=!0)}const I=n.aF(b.center.lng);return E&&I<Math.abs(I-1)&&w.forEach(C=>{C.x-=1}),{polygon:w,unwrapped:E}}(Ka(t,i).map(w=>new n.P(yn(w.x),w.y)),i);return{polygon:_.polygon.map(w=>new n.ae(w.x,w.y)),unwrapped:_.unwrapped}}}function Ka(h,t){return n.aG(h,i=>{const f=t.pointCoordinate3D(i);i.x=f.x,i.y=f.y},1/256)}function yn(h){return h<0?1+h%1:h%1}function Vn(h){return 100*h|0}function Yr(h,t,i,f,_){const w=function(E,A){if(E)return _(E);if(A){if(h.url&&A.tiles&&h.tiles&&delete h.tiles,A.variants){if(!Array.isArray(A.variants))return _(new Error("variants must be an array"));for(const I of A.variants){if(I==null||typeof I!="object"||I.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(I.capabilities))return _(new Error("capabilities must be an array"));if(I.capabilities.length===1&&I.capabilities[0]==="meshopt"){A=Object.assign(A,I);break}}}const M=n.aH(Object.assign({},A,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=t.canonicalizeTileset(M,h.url),_(null,M)}},b=function(E,A,M){if(!E)return null;if(!A&&!M)return E;M=M||E.worldview_default;const I=Object.values(E.language||{});if(I.length===0)return null;const C=Object.values(E.worldview||{});if(C.length===0)return null;const J=I.every(H=>H===A),U=C.every(H=>H===M);return J&&U?E:A in(E.language_options||{})||M in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null}(h.data,i,f);return b?n.o.frame(()=>w(null,b)):h.url?n.m(t.transformRequest(t.normalizeSourceURL(h.url,null,i,f),n.R.Source),w):n.o.frame(()=>{const{data:E,...A}=h;w(null,A)})}function sn(h,t){const i=Math.pow(2,t.z),f=Math.floor(n.aF(h.getWest())*i),_=Math.floor(n.aJ(h.getNorth())*i),w=Math.ceil(n.aF(h.getEast())*i),b=Math.ceil(n.aJ(h.getSouth())*i);return t.x>=f&&t.x<w&&t.y>=_&&t.y<b}class si{constructor(t,i,f){this.bounds=t?n.aI.convert(this.validateBounds(t)):null,this.minzoom=i||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const i of t)this.extraBounds.push(n.aI.convert(this.validateBounds(i)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!sn(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const i of this.extraBounds)if(sn(i,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const i=new si(t.bounds,t.minzoom,t.maxzoom);return i.addExtraBounds(t.extra_bounds),i}}class Mi extends n.E{constructor(t,i,f,_){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,n.aH(i,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new n.aK}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Yr(this._options,this.map._requestManager,i,f,(_,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new n.y(_));else if(w){if(Object.assign(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of w.vector_layers)this.vectorLayerIds.push(b.id),w.worldview&&w.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=si.fromTileJSON(w),wt(w.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(_)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,i){const f=t.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),w=this.map._requestManager.transformRequest(_,n.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,E=b?{image:b.image.clone()}:null,A={request:w,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&n.h(f)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",A,M.bind(this));else if(t.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,M.bind(this),void 0,!0);else{const I=n.aL.call({deduped:this._deduped},A,(C,J)=>{if(C||!J)M.call(this,C);else{const U=n.aM(J.responseHeaders);A.data={cacheControl:U.cacheControl,expires:U.expires,rawData:J.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,M.bind(this),void 0,!0)}},!0);t.request={cancel:I}}function M(I,C){return delete t.request,t.aborted?i(null):I&&I.status!==404?i(I):(C&&C.resourceTiming&&(t.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&t.setExpiryData(C),t.loadVectorData(C,this.map.painter),n.aN(this.dispatcher),i(null,C),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Bs extends n.E{constructor(t,i,f,_){super(),this.id=t,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},i),Object.assign(this,n.aH(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const i=this.map.getWorldview();this._tileJSONRequest=Yr(this._options,this.map._requestManager,null,i,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new n.y(f)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),this.tileBounds=si.fromTileJSON(_),wt(_.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(f)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){const f=n.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);t.request=n.n(this.map._requestManager.transformRequest(_,n.R.Tile),(w,b,E)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(w)return t.state="errored",i(w);if(!b)return i(null);const A=n.aM(E);this.map._refreshExpiredTiles&&t.setExpiryData(A),t.setTexture(b,this.map.painter),t.state="loaded",n.aN(this.dispatcher),i(null)})}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i&&i()}unloadTile(t,i){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function au([h,t],i,f,{scaled:_=!0}={}){const{tileSize:w,buffer:b}=f,{x:E,y:A,z:M}=i;if(!isFinite(E)||!isFinite(A)||!isFinite(M))throw new Error("Invalid MRT header");const I=2**M,C=I*n.aF(h),J=I*n.aJ(t);return function([U,H],q,{scaled:ne=!0}={}){if(!q)throw new Error("bandView is undefined");const{data:ae,tileSize:se,buffer:he,offset:ce,scale:Ze,dimension:me}=q;if(U<-he||U>se+he||H<-he||H>se+he)throw new Error(`Point (${U}, ${H}) out of bounds for tileSize=${se}, buffer=${he}`);const Ne=(H+he)*(se+2*he)+(U+he);if(new Uint32Array(ae.buffer)[Ne]===4294967295)return null;let we=[];we=ne?[]:new q.data.constructor(me);for(let ge=0;ge<me;ge++)we[ge]=Math.round(1e12*(ae[me*Ne+ge]*Ze+ce))/1e12;return we}([Math.min(Math.max(-b,Math.floor((C-E)*w)),w-1+b),Math.min(Math.max(-b,Math.floor((J-A)*w)),w-1+b)],f,{scaled:_})}class Ni extends Bs{constructor(t,i,f,_){super(t,i,f,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},i)}triggerRepaint(t){const i=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);i&&i.enabled&&f&&i._clearRenderCacheForTile(f.id,t.tileID),this.map.triggerRepaint()}loadTile(t,i){const f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,n.R.Tile),w={request:_,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=_,t.actor||(t.actor=this.dispatcher.getActor());const b=(E,A,M)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(E)return E.name==="AbortError"?void 0:(t.state="errored",i(E));if(this.map._refreshExpiredTiles&&A){const I=n.aM(M);t.setExpiryData(I)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!A)return i(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=A}i(null)};t.request=this.partial?t.fetchHeader(void 0,b.bind(this)):t.actor.send("loadTile",w,b.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){const f=t.texturePerLayer;if(t.flushAllQueues(),f.size){t.destroy(!0);for(const _ of f.values())this.map.painter.saveTileTexture(_)}else t.destroy()}prepareTile(t,i,f,_){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(i,f,_,(w,b)=>{if(w)return t.state="errored",this.fire(new n.y(w)),void this.triggerRepaint(t);b&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(f,b,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const i=this.rasterLayers.find(({id:w})=>w===t),f=i&&i.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(t,i,f){if(!t)return;const _=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let w=null;i instanceof n.aQ?w=i.paint.get("raster-array-band"):i instanceof n.aR&&(w=i.paint.get("raster-particle-array-band"));const b=w||this.getInitialBand(_);if(b==null)return;if(!t.textureDescriptorPerLayer.get(i.id))return void this.prepareTile(t,_,i.id,b);if(t.updateNeeded(i.id,b)&&!f)return;const E=t.textureDescriptorPerLayer.get(i.id);return Object.assign({},E,{texture:t.texturePerLayer.get(i.id)})}getImages(t,i){const f=new Map;for(const _ of t)for(const w of i){const[b,E]=w.split("/"),A=_.getLayer(b);if(!A||!A.hasBand(E)||!A.hasDataForBand(E))continue;const{bytes:M,tileSize:I,buffer:C}=A.getBandView(E),J=I+2*C,U={data:new n.q({width:J,height:J},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(w,U)}return f}queryRasterArrayValueByBandId(t,i,f){const _=i._mrt;return new Promise(w=>{const b={},E=new Set;for(const[A,M]of Object.entries(_.layers)){if(f.layerName&&A!==f.layerName)continue;const I={};b[A]=I;for(const{bands:C}of M.dataIndex)for(const J of C)f.bands&&!f.bands.includes(J)||(E.add(n.B(A,J)),i.fetchBand(A,null,J,U=>{n.o.frame(()=>{I[J]=U?null:au([t.lng,t.lat],_,M.getBandView(J)),E.delete(n.B(A,J)),E.size===0&&w(b)})},!1))}E.size===0&&w(b)})}_loadTileForQuery(t,i){if(this._loadTileLoaded[t.uid])return void i(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(i);this._loadTilePending[t.uid]=[i];const f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,n.R.Tile);t.actor.send("loadTile",{request:_,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(w,b,E)=>{if(w)return this._loadTilePending[t.uid].forEach(A=>A(w,null)),void delete this._loadTilePending[t.uid];if(!b)return this._loadTilePending[t.uid].forEach(A=>A(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&b){const A=n.aM(E);t.setExpiryData(A)}t._mrt=b,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(A=>A(null,b)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,i,f){return new Promise((_,w)=>{this._loadTileForQuery(i,(b,E)=>{b?w(b):_(E?this.queryRasterArrayValueByBandId(t,i,f):null)})})}queryRasterArrayValue(t,i){const f=n.aS.convert(t),_=this.findLoadedParent(f);return _&&_._mrt?i.bands||!this.partial?this.queryRasterArrayValueByBandId(f,_,i):this.queryRasterArrayValueByAllBands(f,_,i):Promise.resolve(null)}findLoadedParent(t){const i=n.ae.fromLngLat(t,this.map.transform.tileSize),f=this.maxzoom+1,_=1<<f,w=Math.floor(i.x),b=Math.floor((i.x-w)*_),E=Math.floor(i.y*_),A=this.map.style.getSourceCache(this.id),M=new n.aP(f,w,f,b,E);return A.findLoadedParent(M,this.minzoom)}}const Xs={vector:Mi,raster:Bs,"raster-dem":class extends Bs{constructor(h,t,i,f){super(h,t,i,f),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const i=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,w){_&&(h.state="errored",t(_)),w&&(h.dem=w,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=n.n(this.map._requestManager.transformRequest(i,n.R.Tile),(function(_,w,b){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(_)h.state="errored",t(_);else if(w){const E=n.aM(b);this.map._refreshExpiredTiles&&h.setExpiryData(E);const A=ImageBitmap&&w instanceof ImageBitmap&&n.r(),M=1-(w.width-n.aO(w.width))/2;M<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const I=A?w:n.o.getImageData(w,M),C={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:I,encoding:this.encoding,padding:M};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",C,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,i=Math.pow(2,t.z),f=(t.x-1+i)%i,_=t.x===0?h.wrap-1:h.wrap,w=(t.x+1+i)%i,b=t.x+1===i?h.wrap+1:h.wrap,E={};return E[new n.aP(h.overscaledZ,_,t.z,f,t.y).key]={backfilled:!1},E[new n.aP(h.overscaledZ,b,t.z,w,t.y).key]={backfilled:!1},t.y>0&&(E[new n.aP(h.overscaledZ,_,t.z,f,t.y-1).key]={backfilled:!1},E[new n.aP(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},E[new n.aP(h.overscaledZ,b,t.z,w,t.y-1).key]={backfilled:!1}),t.y+1<i&&(E[new n.aP(h.overscaledZ,_,t.z,f,t.y+1).key]={backfilled:!1},E[new n.aP(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},E[new n.aP(h.overscaledZ,b,t.z,w,t.y+1).key]={backfilled:!1}),E}},"raster-array":Ni,geojson:class extends n.E{constructor(h,t,i,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(f),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=n.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*_,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*_,extent:n.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const i of this._data.features)t.set(i.id,i);for(const i of h.features)t.set(i.id,i);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,i,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:i},f),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:h},this.workerOptions);t.scope=this.scope;const i=this._data;typeof i=="string"?(t.request=this.map._requestManager.transformRequest(n.o.resolveURL(i),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new n.y(f));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w.resourceTiming=_.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new n.z("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=n.B(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const i=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,w=this._partialReload,b={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};h.request=this.actor.send(i,b,(E,A)=>w&&!A?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):E?t(E):(h.loadVectorData(A,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aT{constructor(h,t,i,f){super(h,t,i,f),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aU(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new n.y(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aT,model:n.aW,"batched-model":class extends n.E{constructor(h,t,i,f){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=n.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=Yr(this._options,this.map._requestManager,t,i,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new n.y(f))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new si(_.bounds,this.minzoom,this.maxzoom)),wt(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(f)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const i=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(i,n.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.o.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const w=Object.values(h.buckets);for(const b of w)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",f,_.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(w,b){return h.aborted?t(null):w&&w.status!==404?t(w):(this.map._refreshExpiredTiles&&b&&h.setExpiryData(b),h.loadModelData(b,this.map.painter),h.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends n.aT{constructor(h,t,i,f){super(h,t,i,f),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(w=>typeof w!="number"))||this.fire(new n.y(new n.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof n.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends n.E{constructor(h,t,i,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new si(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,n.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:i,z:f}=h.canonical;return this._implementation.hasTile({x:t,y:i,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:i,y:f,z:_}=h.tileID.canonical,w=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:i,y:f,z:_},{signal:w.signal})).then((function(b){return delete h.request,h.aborted?(h.state="unloaded",t(null)):b===void 0?(h.state="errored",t(null)):b===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(b)?(this.loadTileData(h,b),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.name!=="AbortError"&&(h.state="errored",t(b))}),h.request.cancel=()=>w.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof n.T?(h.destroy(!0),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:i,y:f,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:i,y:f,z:_})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=n.B(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},ds=function(h,t,i,f){const _=new Xs[t.type](h,t,i,f);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return n.aX(["load","abort","unload","serialize","prepare"],_),_};function ho(h,t,i=""){return`${i}:${t.id||""}:${t.layer.id}:${function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:_,importId:w}=f;return`featureset:${_}${w?`:import:${w}`:""}`}}(h.target)}`}function as(h,t,i,f=""){if(h.uniqueFeatureID){const _=ho(h,t,f);if(i.has(_))return!0;i.add(_)}return!1}function Qs(h,t,i,f,_=!1){const w=t.sourceCache.transform,b=t.sourceCache.tilesIn(h,t.has3DLayers,_);b.sort(Ku);const E=[];for(const A of b){const M=A.tile.queryRenderedFeatures(t,A,i,f,w,_);Object.keys(M).length&&E.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:M})}for(const A in t.layers){const M=t.layers[A];if(M.styleLayer){const I=M.styleLayer.queryRenderedFeatures(h,t.sourceCache,f);Object.keys(I).length&&E.push({wrappedTileID:0,queryResults:I})}}return E.length===0?{}:function(A){const M={},I={};for(const C of A){const J=C.queryResults,U=C.wrappedTileID,H=I[U]=I[U]||{};for(const q in J){const ne=J[q],ae=H[q]=H[q]||{},se=M[q]=M[q]||[];for(const he of ne)ae[he.featureIndex]||(ae[he.featureIndex]=!0,se.push(he))}}return M}(E)}function qu(h,t,i,f,_,w){const b={},E=f.queryRenderedSymbols(h),A=[];for(const M of Object.keys(E).map(Number))A.push(_[M]);A.sort(Ku);for(const M of A){const I=M.featureIndex.lookupSymbolFeatures(E[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,t,i,w);for(const C in I){const J=b[C]=b[C]||[],U=I[C];U.sort((H,q)=>{const ne=M.featureSortOrder;if(ne){const ae=ne.indexOf(H.featureIndex);return ne.indexOf(q.featureIndex)-ae}return q.featureIndex-H.featureIndex});for(const H of U)J.push(H)}}return b}function zn(h,t){const i=h.getRenderableIds().map(w=>h.getTileByID(w)),f=[],_={};for(let w=0;w<i.length;w++){const b=i[w],E=b.tileID.canonical.key;_[E]||(_[E]=!0,b.querySourceFeatures(f,t))}return f}function Ku(h,t){const i=h.tileID,f=t.tileID;return i.overscaledZ-f.overscaledZ||i.canonical.y-f.canonical.y||i.wrap-f.wrap||i.canonical.x-f.canonical.x}function ed(h,t){const i={};if(!t)return i;for(const f of h){const _=f.layerIds.map(w=>t.getLayer(w)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(w=>_.filter(b=>b.id===w)[0]));for(const w of _)i[w.fqid]=f}}return i}const hs=32,Ao=33,fs=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,i=0,f=0,_=0,w=0,b=0,E=0;for(1&t?_=w=b=hs:i=f=E=hs;(t>>=1)>1;){const M=i+_>>1,I=f+w>>1;1&t?(_=i,w=f,i=b,f=E):(i=_,f=w,_=b,w=E),b=M,E=I}const A=4*h;fs[A+0]=i,fs[A+1]=f,fs[A+2]=_,fs[A+3]=w}const Hs=new Uint16Array(2178),el=new Uint8Array(1089),Ll=new Uint16Array(1089);function tl(h){return h===0?-.03125:h===32?.03125:0}const al={type:2,extent:n.al,loadGeometry:()=>[[new n.P(0,0),new n.P(n.al+1,0),new n.P(n.al+1,n.al+1),new n.P(0,n.al+1),new n.P(0,0)]]};class ps{constructor(t,i,f,_,w,b){this.tileID=t,this.uid=n.b1(),this.uses=0,this.tileSize=i,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=b,this._hasAppearances=null}registerFadeDuration(t){const i=t+this.timeAdded;i<n.o.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,f){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=ed(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const w=this.buckets[_];if(w instanceof n.b3){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const w=this.buckets[_];if(w instanceof n.b3&&w.hasRTLText){this.hasRTLText=!0,n.b4();break}}this.queryPadding=0;for(const _ in this.buckets){const w=this.buckets[_],b=i.style.getOwnLayer(_);if(!b)continue;const E=b.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,E)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.b2}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,i,f){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,ed(t.buckets,i.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,i){for(const w in this.buckets){const b=this.buckets[w];if(b.uploadPending()){let E={},A=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(i){if(i.style){A=i.style.listImages();const I=b.layers[0],C=I.sourceLayer||"_geojsonTileLayer",J=i.style.getLayerSourceCache(I);J&&(E=J._state.getState(C,void 0))}M={zoom:i.transform.zoom||0,pitch:i.transform.pitch||0,brightness:i.style.getBrightness()||0,worldview:i.worldview||""}}b.upload(t,this.tileID.canonical,E,A,M)}}const f=t.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new n.T(t,_.image,f.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,f.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,f.R8),this.lineAtlas.uploaded=!0)}prepare(t,i,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,f),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=i.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(i)),(this._lastUpdatedBrightness||_||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(i,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const i in this.buckets){const f=this.buckets[i];f.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,f.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,i,f,_,w,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const E=this.evaluateQueryRenderedFeaturePadding(),A=function(M,I){const C=n.bp([],[.5*M.width,.5*-M.height,1]);return n.bq(C,C,[1,-1,0]),n.aB(C,C,M.calculateProjMatrix(I.toUnwrapped())),Float32Array.from(C)}(w,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:i,pixelPosMatrix:A,transform:_,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:E})}querySourceFeatures(t,i){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),w=i?i.sourceLayer:"",b=_._geojsonTileLayer||_[w];if(!b)return;const E=n.b5(i&&i.filter),{z:A,x:M,y:I}=this.tileID.canonical,C={z:A,x:M,y:I};for(let J=0;J<b.length;J++){const U=b.feature(J);if(E.needGeometry){const ne=n.b6(U,!0);if(!E.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ne,this.tileID.canonical))continue}else if(!E.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),U))continue;const H=f.getId(U,w),q=new n.b7(U,A,M,I,H);q.tile=C,t.push(q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const f=n.b8(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(i)if(this.expirationTime<i)_=!0;else{const w=this.expirationTime-i;w?this.expirationTime=f+Math.max(w,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const i in this.buckets)if(t.style.hasLayer(i)&&this.buckets[i].layers.some(f=>f.appearances&&f.appearances.length>0))return!0;return!1}updateBuckets(t,i){if(!this.latestFeatureIndex||!t.style)return;const f=this.latestFeatureIndex.loadVTLayers(),_=t.style.listImages(),w=t.style.getBrightness();for(const b in this.buckets){if(!t.style.hasLayer(b))continue;const E=this.buckets[b],A=E.layers[0],M=A.sourceLayer||"_geojsonTileLayer",I=f[M],C=t.style.getLayerSourceCache(A);let J={};C&&(J=C._state.getState(M,void 0));const U=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},H=Object.keys(J).length>0&&!i;if(E.hasAppearances=E.layers.some(ne=>ne.appearances&&ne.appearances.length>0),(H&&E.stateDependentLayers.length!==0||i)&&E.update(J,I,_,U,H?E.stateDependentLayers:E.layers,i,w),H&&E.stateDependentLayers.length!==0||i||E.hasAppearances){const ne={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};E.updateAppearances(this.tileID.canonical,J,_,ne)}(E instanceof n.b9||E instanceof n.ba)&&t._terrain&&t._terrain.enabled&&C&&E.uploadPending()&&t._terrain._clearRenderCacheForTile(C.id,this.tileID);const q=t&&t.style&&t.style.getOwnLayer(b);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.o.now()+t}setTexture(t,i){const f=i.context,_=f.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(f,t,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(t,i){const f={};for(const _ of i)f[_]=!0;this.dependencies[t]=f}hasDependency(t,i){for(const f of t){const _=this.dependencies[f];if(_){for(const w of i)if(_[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const f=n.bb(al,this.tileID.canonical,this.tileTransform)[0],_=new n.bc,w=new n.bd;for(let b=0;b<f.length;b++){const{x:E,y:A}=f[b];_.emplaceBack(E,A),w.emplaceBack(b)}w.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(_,n.be.members),this._tileDebugSegments=n.bf.simpleSegment(0,0,_.length,w.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const f=n.bb(al,this.tileID.canonical,this.tileTransform)[0];let _,w;if(this.isRaster){const b=function(E,A){const M=n.aY(E,A),I=Math.pow(2,E.z);for(let ne=0;ne<Ao;ne++)for(let ae=0;ae<Ao;ae++){const se=n.aZ((E.x+(ae+tl(ae))/hs)/I),he=n.a_((E.y+(ne+tl(ne))/hs)/I),ce=A.project(se,he),Ze=ne*Ao+ae;Hs[2*Ze+0]=Math.round((ce.x*M.scale-M.x)*n.al),Hs[2*Ze+1]=Math.round((ce.y*M.scale-M.y)*n.al)}el.fill(0),Ll.fill(0);for(let ne=2045;ne>=0;ne--){const ae=4*ne,se=fs[ae+0],he=fs[ae+1],ce=fs[ae+2],Ze=fs[ae+3],me=se+ce>>1,Ne=he+Ze>>1,we=me+Ne-he,ge=Ne+se-me,Se=he*Ao+se,Pe=Ze*Ao+ce,Fe=Ne*Ao+me,it=Math.hypot((Hs[2*Se+0]+Hs[2*Pe+0])/2-Hs[2*Fe+0],(Hs[2*Se+1]+Hs[2*Pe+1])/2-Hs[2*Fe+1])>=16;el[Fe]=el[Fe]||(it?1:0),ne<1022&&(el[Fe]=el[Fe]||el[(he+ge>>1)*Ao+(se+we>>1)]||el[(Ze+ge>>1)*Ao+(ce+we>>1)])}const C=new n.a$,J=new n.b0;let U=0;function H(ne,ae){const se=ae*Ao+ne;return Ll[se]===0&&(C.emplaceBack(Hs[2*se+0],Hs[2*se+1],ne*n.al/hs,ae*n.al/hs),Ll[se]=++U),Ll[se]-1}function q(ne,ae,se,he,ce,Ze){const me=ne+se>>1,Ne=ae+he>>1;if(Math.abs(ne-ce)+Math.abs(ae-Ze)>1&&el[Ne*Ao+me])q(ce,Ze,ne,ae,me,Ne),q(se,he,ce,Ze,me,Ne);else{const we=H(ne,ae),ge=H(se,he),Se=H(ce,Ze);J.emplaceBack(we,ge,Se)}}return q(0,0,hs,hs,hs,0),q(hs,hs,0,0,0,hs),{vertices:C,indices:J}}(this.tileID.canonical,i);_=b.vertices,w=b.indices}else{_=new n.a$,w=new n.b0;for(const{x:E,y:A}of f)_.emplaceBack(E,A,0,0);const b=n.bg(_.int16.subarray(0,4*_.length),void 0,4);for(let E=0;E<b.length;E+=3)w.emplaceBack(b[E],b[E+1],b[E+2])}this._tileBoundsBuffer=t.createVertexBuffer(_,n.bh.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(w),this._tileBoundsSegments=n.bf.simpleSegment(0,0,_.length,w.length)}_makeGlobeTileDebugBuffers(t,i){const f=i.projection;if(!f||f.name!=="globe"||i.freezeTileCoverage)return;const _=this.tileID.canonical,w=n.bi(_,i),b=n.bj(w),E=n.aj(i.zoom);let A;E>0&&(A=n.bk(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,_,i,b,A,E),this._makeGlobeTileDebugTextBuffer(t,_,i,b,A,E)}_globePoint(t,i,f,_,w,b,E){let A=n.bl(t,i,f);if(b){const M=1<<f.z,I=n.aF(_.center.lng),C=n.aJ(_.center.lat),J=(f.x+.5)/M-I;let U=0;J>.5?U=-1:J<-.5&&(U=1);let H=(t/n.al+f.x)/M+U,q=(i/n.al+f.y)/M;H=(H-I)*_._pixelsPerMercatorPixel+I,q=(q-C)*_._pixelsPerMercatorPixel+C;const ne=[H*_.worldSize,q*_.worldSize,0];n.af(ne,ne,b),A=n.bm(A,ne,E)}return n.af(A,A,w)}_makeGlobeTileDebugBorderBuffer(t,i,f,_,w,b){const E=new n.bc,A=new n.bd,M=new n.bn,I=(J,U,H,q,ne)=>{const ae=(H-J)/(ne-1),se=(q-U)/(ne-1),he=E.length;for(let ce=0;ce<ne;ce++){const Ze=J+ce*ae,me=U+ce*se;E.emplaceBack(Ze,me);const Ne=this._globePoint(Ze,me,i,f,_,w,b);M.emplaceBack(Ne[0],Ne[1],Ne[2]),A.emplaceBack(he+ce)}},C=n.al;I(0,0,C,0,16),I(C,0,C,C,16),I(C,C,0,C,16),I(0,C,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(E,n.be.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(M,n.bo.members),this._tileDebugSegments=n.bf.simpleSegment(0,0,E.length,A.length)}_makeGlobeTileDebugTextBuffer(t,i,f,_,w,b){const E=n.al/4,A=new n.bc,M=new n.b0,I=new n.bn,C=25;M.reserve(32),A.reserve(C),I.reserve(C);const J=(U,H)=>C*U+H;for(let U=0;U<C;U++){const H=U*E;for(let q=0;q<C;q++){const ne=q*E;A.emplaceBack(ne,H);const ae=this._globePoint(ne,H,i,f,_,w,b);I.emplaceBack(ae[0],ae[1],ae[2])}}for(let U=0;U<4;U++)for(let H=0;H<4;H++){const q=J(U,H),ne=J(U,H+1),ae=J(U+1,H),se=J(U+1,H+1);M.emplaceBack(q,ne,ae),M.emplaceBack(ae,ne,se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(M),this._tileDebugTextBuffer=t.createVertexBuffer(A,n.be.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(I,n.bo.members),this._tileDebugTextSegments=n.bf.simpleSegment(0,0,C,32)}destroy(t=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.br.setPbf(n.bs);class Ro extends ps{constructor(t,i,f,_,w){super(t,i,f,_,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,i,f){const _=f.context,w=_.gl;let b=this.texturePerLayer.get(t)||f.getTileTexture(i.width);b&&b instanceof n.T?b.update(i,{premultiply:!1}):b=new n.T(_,i,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,b)}flushQueues(t){const i=this._workQueuePerLayer.get(t)||[],f=this._fetchQueuePerLayer.get(t)||[];for(;i.length;)i.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const i=this._workQueuePerLayer.get(t)||[];for(;i.length;)i.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const i=this._fetchQueuePerLayer.get(t)||[];for(;i.length;)i.pop()()}}fetchHeader(t=16384,i){const f=this._mrt=new n.br(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bt(_,(w,b,E)=>{if(w)i(w);else try{const A=f.getHeaderLength(b);if(A>t)return void(this.request=this.fetchHeader(A,i));f.parseHeader(b),this._isHeaderLoaded=!0;let M=0;for(const I of Object.values(f.layers))M=Math.max(M,I.dataIndex[I.dataIndex.length-1].lastByte);b.byteLength>=M&&(this.entireBuffer=b),i(null,this.entireBuffer||b,E)}catch(A){i(A)}}),this.request}fetchBandForRender(t,i,f,_){this.fetchBand(t,i,f,w=>{if(w)return void _(w);this.updateTextureDescriptor(t,i,f);const b=this.textureDescriptorPerLayer.get(i);_(null,b?b.img:null)})}fetchBand(t,i,f,_,w=!0){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void _(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void _(new Error("Can't fetch tile band without an actor"));let A;const M=n.B(String(f),n.B(this.tileID.key,t));let I=this._taskQueue.get(M);I?I.add(_):(I=new Set,I.add(_),this._taskQueue.set(M,I));const C=(q,ne)=>{A.complete(q,ne),q?_(q):(I.values().forEach(ae=>ae(null,ne)),this._taskQueue.delete(M))},J=(q,ne)=>{if(q)return _(q);const ae=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ne,task:A},C,void 0,!0);if(i!==null){const se=this._workQueuePerLayer.get(i)||[];se.push(()=>{ae&&ae.cancel(),A.cancel()}),this._workQueuePerLayer.has(i)||this._workQueuePerLayer.set(i,se)}};let U;try{U=b.getLayer(t)}catch(q){if(this.state==="reloading")return;throw q}if(!U)return void _(new Error(`Unknown sourceLayer "${t}"`));if(U.hasDataForBand(f))return I.values().forEach(q=>q(null,null)),void this._taskQueue.delete(M);const H=U.getDataRange([f]);if(A=b.createDecodingTask(H),!A||A.tasks.length)if(i!==null&&this.flushQueues(i),this.entireBuffer)J(null,this.entireBuffer.slice(H.firstByte,H.lastByte+1));else{const q=Object.assign({},this.requestParams,{headers:{Range:`bytes=${H.firstByte}-${H.lastByte}`}}),ne=n.bt(q,J);if(i!==null){const ae=this._fetchQueuePerLayer.get(i)||[];ae.push(()=>{ne.cancel(),A.cancel()}),this._fetchQueuePerLayer.has(i)||this._fetchQueuePerLayer.set(i,ae)}}}updateNeeded(t,i){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==i||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,i,f){if(!this._mrt)return;const _=this._mrt.getLayer(t);if(!_||!_.hasBand(f)||!_.hasDataForBand(f))return;const{bytes:w,tileSize:b,buffer:E,offset:A,scale:M}=_.getBandView(f),I=b+2*E,C=new n.q({width:I,height:I},w),J=this.texturePerLayer.get(i);J&&J instanceof n.T&&J.update(C,{premultiply:!1}),this.textureDescriptorPerLayer.set(i,{layer:t,band:f,img:C,buffer:E,offset:A,tileSize:b,format:_.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const i of this.texturePerLayer.values())i&&i instanceof n.T&&i.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class ru{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,f){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const w={value:i,timeout:void 0};if(f!==void 0&&(w.timeout=setTimeout(()=>{this.remove(t,w)},f)),this.data[_].push(w),this.order.push(_),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const f=t.wrapped().key,_=i===void 0?0:this.data[f].indexOf(i),w=this.data[f][_];return this.data[f].splice(_,1),w.timeout&&clearTimeout(w.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(w.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const f in this.data)for(const _ of this.data[f])t(_.value)||i.push(_);for(const f of i)this.remove(f.value.tileID,f)}}class Hl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,f){const _=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},Object.assign(this.stateChanges[t][_],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const w in this.state[t])w!==_&&(this.deletedStates[t][w]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const w in this.state[t][_])f[w]||(this.deletedStates[t][_][w]=null)}else for(const w in f)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][w]===null&&delete this.deletedStates[t][_][w]}removeFeatureState(t,i,f){if(this.deletedStates[t]===null)return;const _=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&i!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][f]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(f in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][f]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,i){const f=this.state[t]||{},_=this.stateChanges[t]||{},w=this.deletedStates[t];if(w===null)return{};if(i!==void 0){const E=String(i),A=Object.assign({},f[E],_[E]);if(w){const M=w[i];if(M===null)return{};for(const I in M)delete A[I]}return A}const b=Object.assign({},f,_);if(w)for(const E in w)delete b[E];return b}initializeTileState(t,i){t.refreshFeatureState(i)}coalesceChanges(t,i){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const w={};for(const b in this.stateChanges[_])this.state[_][b]||(this.state[_][b]={}),Object.assign(this.state[_][b],this.stateChanges[_][b]),w[b]=this.state[_][b];f[_]=w}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const w={};if(this.deletedStates[_]===null)for(const b in this.state[_])w[b]={},this.state[_][b]={};else for(const b in this.deletedStates[_]){if(this.deletedStates[_][b]===null)this.state[_][b]={};else if(this.state[_][b])for(const E of Object.keys(this.deletedStates[_][b]))delete this.state[_][b][E];w[b]=this.state[_][b]}f[_]=f[_]||{},Object.assign(f[_],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in t)t[_].refreshFeatureState(i)}}class To extends n.E{constructor(t,i,f){super(),this.id=t,this._onlySymbols=f,i.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new ru(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Hl,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const f=this._tiles[i];f.upload(t,this.map?this.map.painter:void 0),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Yh).map(t=>t.key)}getRenderableIds(t,i){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,t,i)&&f.push(this._tiles[_]);return t?f.sort((_,w)=>{const b=_.tileID,E=w.tileID,A=new n.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),M=new n.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-E.overscaledZ||M.y-A.y||M.x-A.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(Yh).map(_=>_.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,f){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(f||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=i),this._loadTile(f,this._tileLoaded.bind(this,f,t,i)))}_tileLoaded(t,i,f,_,w){if(_){if(t.state="errored",_.status!==404)this._source.fire(new n.y(_,{tile:t}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=n.o.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let b=new Map;w&&w.responseHeaders&&(b=w.responseHeaders),this._source.fire(new n.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:b}))}_backfillDEM(t){const i=this.getRenderableIds();for(let _=0;_<i.length;_++){const w=i[_];if(t.neighboringTiles&&t.neighboringTiles[w]){const b=this.getTileByID(w);f(t,b),f(b,t)}}function f(_,w){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let b=w.tileID.canonical.x-_.tileID.canonical.x;const E=w.tileID.canonical.y-_.tileID.canonical.y,A=Math.pow(2,_.tileID.canonical.z),M=w.tileID.key;b===0&&E===0||Math.abs(E)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),w.dem&&_.dem&&(_.dem.backfillBorder(w.dem,b,E),_.neighboringTiles&&_.neighboringTiles[M]&&(_.neighboringTiles[M].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,f,_){for(const w in this._tiles){let b=this._tiles[w];if(_[w]||!b.hasData()||b.tileID.overscaledZ<=i||b.tileID.overscaledZ>f)continue;let E=b.tileID;for(;b&&b.tileID.overscaledZ>i+1;){const M=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[M.key],b&&b.hasData()&&(E=M)}let A=E;for(;A.overscaledZ>i;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){_[E.key]=E;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=i?f:null}for(let f=t.overscaledZ-1;f>=i;f--){const _=t.scaledTo(f),w=this._getLoadedTile(_);if(w)return w}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const f=Math.ceil(t.width/i)+1,_=Math.ceil(t.height/i)+1,w=Math.floor(f*_*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(E)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const f={};for(const _ in this._tiles){const w=this._tiles[_];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+i),f[w.tileID.key]=w}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(t,i,f,_,w){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let E,A=this._source.maxzoom;const M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){const J=M.attenuationRange()[0],U=Math.floor(J)-Math.log2(M.getDemUpscale());A>U&&(A=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(J=>new n.aP(J.canonical.z,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y));else if(this.tileCoverLift!==0){const J=t.clone();J.tileCoverLift=this.tileCoverLift,E=J.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&t.projection.name==="globe"&&(E.push(new n.aP(1,0,1,0,0)),E.push(new n.aP(1,0,1,1,0)),E.push(new n.aP(1,0,1,0,1)),E.push(new n.aP(1,0,1,1,1)))}else if(E=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const J=this._source.hasTile.bind(this._source);E=E.filter(U=>J(U))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!rl(this._source.type)){const J=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),U=Math.min(J,this._source.maxzoom);if(b){const H=t.extendTileCover(E,U);for(const q of H)E.push(q)}else if(w){const H=t.extendTileCoverToNearPlane(E,this.transform.getFrustum(U),U);for(const q of H)E.push(q)}else if(this.castsShadows&&_){const H=t.extendTileCover(E,U,_);for(const q of H)this._shadowCasterTiles[q.key]=!0,E.push(q)}}const I=this._updateRetainedTiles(E);if(rl(this._source.type)&&E.length!==0){const J={},U={},H=Object.keys(I);for(const ne of H){const ae=I[ne],se=this._tiles[ne];if(!se||se.fadeEndTime&&se.fadeEndTime<=n.o.now())continue;const he=this.findLoadedParent(ae,Math.max(ae.overscaledZ-To.maxOverzooming,this._source.minzoom));he&&(this._addTile(he.tileID),J[he.tileID.key]=he.tileID),U[ne]=ae}const q=E[E.length-1].overscaledZ;for(const ne in this._tiles){const ae=this._tiles[ne];if(I[ne]||!ae.hasData())continue;let se=ae.tileID;for(;se.overscaledZ>q;){se=se.scaledTo(se.overscaledZ-1);const he=this._tiles[se.key];if(he&&he.hasData()&&U[se.key]){I[ne]=ae.tileID;break}}}for(const ne in J)I[ne]||(this._coveredTiles[ne]=!0,I[ne]=J[ne])}for(const J in I)this._tiles[J].clearFadeHold();const C=n.bu(this._tiles,I);for(const J of C){const U=this._tiles[J];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+J)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const f={},_=t.reduce((M,I)=>Math.min(M,I.overscaledZ),1/0),w=t[0].overscaledZ,b=Math.max(w-To.maxOverzooming,this._source.minzoom),E=Math.max(w+To.maxUnderzooming,this._source.minzoom),A={};for(const M of t){const I=this._addTile(M);i[M.key]=M,I.hasData()||_<this._source.maxzoom&&(A[M.key]=M)}this._retainLoadedChildren(A,_,E,i);for(const M of t){let I=this._tiles[M.key];if(I.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const J=M.children(this._source.maxzoom)[0],U=this.getTile(J);if(U&&U.hasData()){i[J.key]=J;continue}}else{const J=M.children(this._source.maxzoom);if(i[J[0].key]&&i[J[1].key]&&i[J[2].key]&&i[J[3].key])continue}let C=I.wasRequested();for(let J=M.overscaledZ-1;J>=b;--J){const U=M.scaledTo(J);if(f[U.key]||(f[U.key]=!0,I=this.getTile(U),!I&&C&&(I=this._addTile(U)),I&&(i[U.key]=U,C=I.wasRequested(),I.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let f,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}i.push(_.key);const w=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(w),f)break;_=w}for(const w of i)this._loadedParentTiles[w]=f}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const f=!!i;if(!f){const _=this.map?this.map.painter:null,w=this._source.tileSize*t.overscaleFactor();i=this._source.type==="raster-array"?new Ro(t,w,this.transform.tileZoom,_,this._isRaster):new ps(t,w,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i.uses++,this._tiles[t.key]=i,f||this._source.fire(new n.z("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=i.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"||i.state==="empty"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,f){const _=[],w=this.transform;if(!w)return _;const b=w.projection.name==="globe",E=n.aF(w.center.lng);for(const A in this._tiles){const M=this._tiles[A];if(f&&M.clearQueryDebugViz(),M.holdingForFade())continue;let I;if(b){const C=M.tileID.canonical;if(C.z===0){const J=[Math.abs(n.aA(E,...nu(C,-1))-E),Math.abs(n.aA(E,...nu(C,1))-E)];I=[0,2*J.indexOf(Math.min(...J))-1]}else{const J=[Math.abs(n.aA(E,...nu(C,-1))-E),Math.abs(n.aA(E,...nu(C,0))-E),Math.abs(n.aA(E,...nu(C,1))-E)];I=[J.indexOf(Math.min(...J))-1]}}else I=[0];for(const C of I){const J=t.containsTile(M,w,i,C);J&&_.push(J)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){const f=this.getRenderableIds(t,i).map(w=>this._tiles[w].tileID),_=this.transform.projection.name==="globe";for(const w of f)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=_?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return f}sortCoordinatesByDistance(t){const i=t.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),w={};for(const b of i){const E=1/(1<<b.canonical.z);w[b.key]=((b.canonical.x+.5)*E+b.wrap-f[0])*_[0]+((b.canonical.y+.5)*E-f[1])*_[1]-f[2]*_[2]}return i.sort((b,E)=>w[b.key]-w[E.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(rl(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=n.o.now())return!0}return!1}setFeatureState(t,i,f){this._state.updateState(t=t||"_geojsonTileLayer",i,f)}removeFeatureState(t,i,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,f)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,f){const _=this._tiles[t];_&&_.setDependencies(i,f)}reloadTilesForDependencies(t,i){for(const f in this._tiles)this._tiles[f].hasDependency(t,i)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,i))};return void this._source.on("data",A)}const f=new Map,_=Array.isArray(t)?t:[t],w=this.map.painter.terrain,b=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const A of _){const M=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of M)f.set(I.key,I);this.usedForTerrain&&A.updateElevation(!1)}const E=Array.from(f.values());n.bv(E,(A,M)=>{const I=new ps(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(I,C=>{this._source.type==="raster-dem"&&I.dem&&this._backfillDEM(I),M(C,I)})},i)}}function Yh(h,t){const i=Math.abs(2*h.wrap)-+(h.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||f-i||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function rl(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function nu(h,t){const i=1<<h.z;return[h.x/i+t,(h.x+1)/i+t]}To.maxOverzooming=10,To.maxUnderzooming=3;class $h{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,i=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:t,visibilityChanged:i});else if(_.type==="model"){const w=this.style.getLayerSource(_);w&&w.type==="batched-model"&&this.layers.push({layer:_,visible:t,visibilityChanged:i})}}}onNewFrame(t){this.layersGotHidden=!1;for(const i of this.layers){const f=i.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(t)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?_=!f.isHidden(t)&&f.paint.get("building-opacity")>0:f.type==="model"&&(_=!f.isHidden(t)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&i.visible,i.visible=_}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(const _ of this.layers){const w=_.layer,b=this.style.getLayerSourceCache(w);let E=1;w.type==="fill-extrusion"?E=_.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(E=_.visible?w.paint.get("building-vertical-scale"):0);let A=b?b.getTile(i):null;if(!A&&b)for(const M in b._tiles){const I=b._tiles[M];if(i.canonical.isChildOf(I.tileID.canonical)){A=I;break}}this.currentBuildingBuckets.push({bucket:A?A.getBucket(w):null,tileID:A?A.tileID:i,verticalScale:E})}t.hasAnyZOffset=!1;let f=!1;for(let _=0;_<t.symbolInstances.length;_++){const w=t.symbolInstances.get(_),b=w.zOffset,E=this._getHeightAtTileOffset(i,w.tileAnchorX,w.tileAnchorY);w.zOffset=E!==Number.NEGATIVE_INFINITY?E:b,f||b===w.zOffset||(f=!0),t.hasAnyZOffset||w.zOffset===0||(t.hasAnyZOffset=!0)}f&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,f,_){let w=i,b=f;if(t.canonical.z!==_.canonical.z){const E=_.canonical,A=1/(1<<t.canonical.z-E.z);w=(i+t.canonical.x*n.al)*A-E.x*n.al|0,b=(f+t.canonical.y*n.al)*A-E.y*n.al|0}return{tileX:w,tileY:b}}_getHeightAtTileOffset(t,i,f){let _,w;for(let b=0;b<this.layers.length;++b){const E=this.layers[b].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:A,tileID:M,verticalScale:I}=this.currentBuildingBuckets[b];if(!A)continue;const{tileX:C,tileY:J}=this._mapCoordToOverlappingTile(t,i,f,M),U=A.getHeightAtTileCoord(C,J);U&&U.height!==void 0&&(U.hidden?_=U.height:w=Math.max(U.height*I,w||0))}if(w!==void 0)return w;for(let b=0;b<this.layers.length;++b){const E=this.layers[b];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:A,tileID:M}=this.currentBuildingBuckets[b];if(!A)continue;const{tileX:I,tileY:C}=this._mapCoordToOverlappingTile(t,i,f,M),J=A.getHeightAtTileCoord(I,C);if(J&&!J.hidden)return J.height===void 0&&_!==void 0?Math.min(J.maxHeight,_)*J.verticalScale:J.height?J.height*J.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function jc(h,t){const i={};for(const f in h)f!=="ref"&&(i[f]=h[f]);return n.bw.forEach(f=>{f in t&&(i[f]=t[f])}),i}function iu(h){h=h.slice();const t=Object.create(null);for(let i=0;i<h.length;i++)t[h[i].id]=h[i];for(let i=0;i<h.length;i++)"ref"in h[i]&&(h[i]=jc(h[i],t[h[i].ref]));return h}const zr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function su(h,t,i){i.push({command:zr.addSource,args:[h,t[h]]})}function Yl(h,t,i){t.push({command:zr.removeSource,args:[h]}),i[h]=!0}function jl(h,t,i,f){Yl(h,i,f),su(h,t,i)}function td(h,t,i){let f;for(f in h[i])if(h[i].hasOwnProperty(f)&&f!=="data"&&!n.bx(h[i][f],t[i][f]))return!1;for(f in t[i])if(t[i].hasOwnProperty(f)&&f!=="data"&&!n.bx(h[i][f],t[i][f]))return!1;return!0}function qd(h,t,i,f,_,w){let b;for(b in t=t||{},h=h||{})h.hasOwnProperty(b)&&(n.bx(h[b],t[b])||i.push({command:w,args:[f,b,t[b],_]}));for(b in t)t.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(n.bx(h[b],t[b])||i.push({command:w,args:[f,b,t[b],_]}))}function Kd(h){return h.id}function ou(h,t){return h[t.id]=t,h}function Zl(h,t,i){const f=t.createTileMatrix(h,h.worldSize,i.toUnwrapped());return n.aB(new Float32Array(16),h.projMatrix,f)}function qh(h,t,i){if(t.projection.name===i.projection.name)return h.projMatrix;const f=i.clone();return f.setProjection(t.projection),Zl(f,t.getProjection(),h)}function eh(h,t,i){return t.name===i.projection.name?h.projMatrix:Zl(i,t,h)}class Zc{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.aA(t,0,1);let i=1,f=this._distances[i];const _=t*this.paddedLength+this.padding;for(;f<_&&i<this._distances.length;)f=this._distances[++i];const w=i-1,b=this._distances[w],E=f-b,A=E>0?(_-b)/E:0;return this.points[w].mult(1-A).add(this.points[i].mult(A))}}class lu{constructor(t,i,f){const _=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(i/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,f,_,w){this._forEachCell(i,f,_,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(w)}insertCircle(t,i,f,_){this._forEachCell(i-_,f-_,i+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(f),this.circles.push(_)}_insertBoxCell(t,i,f,_,w,b){this.boxCells[w].push(b)}_insertCircleCell(t,i,f,_,w,b){this.circleCells[w].push(b)}_query(t,i,f,_,w,b){if(f<0||t>this.width||_<0||i>this.height)return!w&&[];const E=[];if(t<=0&&i<=0&&this.width<=f&&this.height<=_){if(w)return!0;for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const M=this.circles[3*A],I=this.circles[3*A+1],C=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:M-C,y1:I-C,x2:M+C,y2:I+C})}return b?E.filter(b):E}return this._forEachCell(t,i,f,_,this._queryCell,E,{hitTest:w,seenUids:{box:{},circle:{}}},b),w?E.length>0:E}_queryCircle(t,i,f,_,w){const b=t-f,E=t+f,A=i-f,M=i+f;if(E<0||b>this.width||M<0||A>this.height)return!_&&[];const I=[];return this._forEachCell(b,A,E,M,this._queryCellCircle,I,{hitTest:_,circle:{x:t,y:i,radius:f},seenUids:{box:{},circle:{}}},w),_?I.length>0:I}query(t,i,f,_,w){return this._query(t,i,f,_,!1,w)}hitTest(t,i,f,_,w){return this._query(t,i,f,_,!0,w)}hitTestCircle(t,i,f,_){return this._queryCircle(t,i,f,!0,_)}_queryCell(t,i,f,_,w,b,E,A){const M=E.seenUids,I=this.boxCells[w];if(I!==null){const J=this.bboxes;for(const U of I)if(!M.box[U]){M.box[U]=!0;const H=4*U;if(t<=J[H+2]&&i<=J[H+3]&&f>=J[H+0]&&_>=J[H+1]&&(!A||A(this.boxKeys[U]))){if(E.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[U],x1:J[H],y1:J[H+1],x2:J[H+2],y2:J[H+3]})}}}const C=this.circleCells[w];if(C!==null){const J=this.circles;for(const U of C)if(!M.circle[U]){M.circle[U]=!0;const H=3*U;if(this._circleAndRectCollide(J[H],J[H+1],J[H+2],t,i,f,_)&&(!A||A(this.circleKeys[U]))){if(E.hitTest)return b.push(!0),!0;{const q=J[H],ne=J[H+1],ae=J[H+2];b.push({key:this.circleKeys[U],x1:q-ae,y1:ne-ae,x2:q+ae,y2:ne+ae})}}}}}_queryCellCircle(t,i,f,_,w,b,E,A){const M=E.circle,I=E.seenUids,C=this.boxCells[w];if(C!==null){const U=this.bboxes;for(const H of C)if(!I.box[H]){I.box[H]=!0;const q=4*H;if(this._circleAndRectCollide(M.x,M.y,M.radius,U[q+0],U[q+1],U[q+2],U[q+3])&&(!A||A(this.boxKeys[H])))return b.push(!0),!0}}const J=this.circleCells[w];if(J!==null){const U=this.circles;for(const H of J)if(!I.circle[H]){I.circle[H]=!0;const q=3*H;if(this._circlesCollide(U[q],U[q+1],U[q+2],M.x,M.y,M.radius)&&(!A||A(this.circleKeys[H])))return b.push(!0),!0}}}_forEachCell(t,i,f,_,w,b,E,A){const M=this._convertToXCellCoord(t),I=this._convertToYCellCoord(i),C=this._convertToXCellCoord(f),J=this._convertToYCellCoord(_);for(let U=M;U<=C;U++)for(let H=I;H<=J;H++)if(w.call(this,t,i,f,_,this.xCellCount*H+U,b,E,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,f,_,w,b){const E=_-t,A=w-i,M=f+b;return M*M>E*E+A*A}_circleAndRectCollide(t,i,f,_,w,b,E){const A=(b-_)/2,M=Math.abs(t-(_+A));if(M>A+f)return!1;const I=(E-w)/2,C=Math.abs(i-(w+I));if(C>I+f)return!1;if(M<=A||C<=I)return!0;const J=M-A,U=C-I;return J*J+U*U<=f*f}}const js={unknown:0,flipRequired:1,flipNotRequired:2},ad=Math.tan(85*Math.PI/180);function $l(h,t,i,f,_,w,b){const E=n.bB();if(i)if(w.name==="globe"){const A=n.bC(_,t);n.aB(E,E,A)}else{const A=n.bD([],b);E[0]=A[0],E[1]=A[1],E[4]=A[2],E[5]=A[3],f||n.bA(E,E,_.angle)}else n.aB(E,_.labelPlaneMatrix,h);return E}function Nc(h,t,i,f,_,w,b){const E=$l(h,t,i,f,_,w,b);return w.name==="globe"&&i||(E[2]=E[6]=E[10]=E[14]=0),E}function Nl(h,t,i,f,_,w,b){if(i){if(w.name==="globe"){const E=$l(h,t,i,f,_,w,b);return n.bk(E,E),n.aB(E,h,E),E}{const E=n.by(h),A=n.bz([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],n.aB(E,E,A),f||n.bA(E,E,-_.angle),E}}return _.glCoordMatrix}function xn(h,t,i,f){const _=[h,t,i,1];i?n.aC(_,_,f):Vo(_,_,f);const w=_[3];return _[0]/=w,_[1]/=w,_[2]/=w,_}function Ec(h,t){return Math.min(.5+h/t*.5,1.5)}function th(h,t){const i=h[0]/h[3],f=h[1]/h[3];return i>=-t[0]&&i<=t[0]&&f>=-t[1]&&f<=t[1]}function cu(h,t,i,f,_,w,b,E,A,M,I=1){const C=i.transform,J=f?h.textSizeData:h.iconSizeData,U=n.bJ(J,i.transform.zoom,I),H=C.projection.name==="globe",q=[256/i.width*2+1,256/i.height*2+1],ne=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ne.clear();let ae=null;H&&(ae=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const se=h.lineVertexArray,he=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,ce=i.transform.width/i.transform.height;let Ze,me=!1;for(let Ne=0;Ne<he.length;Ne++){const we=he.get(Ne),{numGlyphs:ge,writingMode:Se}=we;if(Se!==n.bK.vertical||me||Ze===n.bK.horizontal||(me=!0),Ze=Se,(we.hidden||Se===n.bK.vertical)&&!me){ql(ge,ne);continue}me=!1;const Pe=new n.P(we.tileAnchorX,we.tileAnchorY),Fe=h.elevationType==="road",it=!!C.elevation||Fe;let{x:qe,y:dt,z:Mt}=C.projection.projectTilePoint(Pe.x,Pe.y,M.canonical),Xe=null;if(it){const ia=Fe?h.getElevationFeatureForText(Ne):null;Xe={getElevation:A,elevation:C.elevation,elevationFeature:ia};const[va,ir,Oa]=A(Pe,C.elevation,ia);qe+=va,dt+=ir,Mt+=Oa}const Ie=[qe,dt,Mt,1];if(n.aC(Ie,Ie,t),!th(Ie,q)){ql(ge,ne);continue}const ct=Ie[3],et=Ec(i.transform.getCameraToCenterDistance(C.projection),ct),jt=n.bL(J,U,we),Ct=b?jt/et:jt*et,oa=xn(qe,dt,Mt,_);if(oa[3]<=0){ql(ge,ne);continue}let Bt={};const Ot=n.an(h.layers[0].layout.get("text-max-angle")),la=Math.cos(Ot),ra=b?null:Xe,Ht=Kh(we,Ct,!1,E,t,_,w,h.glyphOffsetArray,se,ne,ae,oa,Pe,Bt,ce,ra,C.projection,M,b,la);me=Ht.useVertical,ra&&Ht.needsFlipping&&(Bt={}),(Ht.notEnoughRoom||me||Ht.needsFlipping&&Kh(we,Ct,!0,E,t,_,w,h.glyphOffsetArray,se,ne,ae,oa,Pe,Bt,ce,ra,C.projection,M,b,la).notEnoughRoom)&&ql(ge,ne)}f?(h.text.dynamicLayoutVertexBuffer.updateData(ne),ae&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(ae)):(h.icon.dynamicLayoutVertexBuffer.updateData(ne),ae&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(ae))}function Or(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne){const{lineStartIndex:ae,glyphStartIndex:se,segment:he}=E,ce=se+E.numGlyphs,Ze=ae+E.lineLength,me=t.getoffsetX(se),Ne=t.getoffsetX(ce-1),we=nd(h*me,i,f,_,w,b,he,ae,Ze,A,M,I,C,J,!0,U,H,q,ne);if(!we)return null;const ge=nd(h*Ne,i,f,_,w,b,he,ae,Ze,A,M,I,C,J,!0,U,H,q,ne);return ge?{first:we,last:ge}:null}function ah(h,t,i,f){return h===n.bK.horizontal&&Math.abs(f)>Math.abs(i)?{useVertical:!0}:h===n.bK.vertical?f>0?{needsFlipping:!0}:null:t!==js.unknown&&function(_,w){return _===0||Math.abs(w/_)>ad}(i,f)?t===js.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function Kh(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae,se,he){const ce=t/24,Ze=h.lineOffsetX*ce,me=h.lineOffsetY*ce,{lineStartIndex:Ne,glyphStartIndex:we,numGlyphs:ge,segment:Se,writingMode:Pe,flipState:Fe}=h,it=Ne+h.lineLength,qe=dt=>{if(I){const[ct,et,jt]=dt.up,Ct=M.length;n.bM(I,Ct+0,ct,et,jt),n.bM(I,Ct+1,ct,et,jt),n.bM(I,Ct+2,ct,et,jt),n.bM(I,Ct+3,ct,et,jt)}const[Mt,Xe,Ie]=dt.point;n.bN(M,Mt,Xe,Ie,dt.angle)};if(ge>1){const dt=Or(ce,E,Ze,me,i,C,J,h,A,w,U,q,!1,ne,ae,se,he);if(!dt)return{notEnoughRoom:!0};if(f&&!i){let[Mt,Xe,Ie]=dt.first.point,[ct,et,jt]=dt.last.point;[Mt,Xe]=xn(Mt,Xe,Ie,b),[ct,et]=xn(ct,et,jt,b);const Ct=ah(Pe,Fe,(ct-Mt)*H,et-Xe);if(h.flipState=Ct&&Ct.needsFlipping?js.flipRequired:js.flipNotRequired,Ct)return Ct}qe(dt.first);for(let Mt=we+1;Mt<we+ge-1;Mt++){const Xe=nd(ce*E.getoffsetX(Mt),Ze,me,i,C,J,Se,Ne,it,A,w,U,q,!1,!1,ne,ae,se,he);if(!Xe)return M.length-=4*(Mt-we),{notEnoughRoom:!0};qe(Xe)}qe(dt.last)}else{if(f&&!i){const Mt=xn(J.x,J.y,0,_),Xe=Ne+Se+1,Ie=new n.P(A.getx(Xe),A.gety(Xe)),ct=xn(Ie.x,Ie.y,0,_),et=ct[3]>0?ct:Sa(J,Ie,Mt,1,_,void 0,ne,ae.canonical),jt=ah(Pe,Fe,(et[0]-Mt[0])*H,et[1]-Mt[1]);if(h.flipState=jt&&jt.needsFlipping?js.flipRequired:js.flipNotRequired,jt)return jt}const dt=nd(ce*E.getoffsetX(we),Ze,me,i,C,J,Se,Ne,it,A,w,U,q,!1,!1,ne,ae,se,he);if(!dt)return{notEnoughRoom:!0};qe(dt)}return{}}function rd(h,t,i,f,_){const{x:w,y:b,z:E}=f.projectTilePoint(h.x,h.y,t);if(!_)return xn(w,b,E,i);const[A,M,I]=_.getElevation(h,_.elevation,_.elevationFeature);return xn(w+A,b+M,E+I,i)}function Sa(h,t,i,f,_,w,b,E){const A=rd(h.sub(t)._unit()._add(h),E,_,b,w);return n.av(A,i,A),n.aw(A,A),n.bG(A,i,A,f)}function nd(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae,se){const he=f?h-t:h+t;let ce=he>0?1:-1,Ze=0;f&&(ce*=-1,Ze=Math.PI),ce<0&&(Ze+=Math.PI);let me=E+b+(ce>0?0:1)|0,Ne=_,we=_,ge=0,Se=0;const Pe=Math.abs(he),Fe=[],it=[];let qe=w,dt=qe,Mt=n.bE([]);const Xe=()=>Sa(dt,qe,we,Pe-ge+1,I,J,q,ne.canonical);for(;ge+Se<=Pe;){if(me+=ce,me<E||me>=A)return null;if(we=Ne,dt=qe,Fe.push(we),U&&it.push(dt),qe=new n.P(M.getx(me),M.gety(me)),Ne=C[me],!Ne){const ra=rd(qe,ne.canonical,I,q,J);Ne=ra[3]>0?C[me]=ra:Xe()}ge+=Se;const Ot=n.av([],Ne,we),la=n.bF(we,Ne);if(i&&la>0&&Se>0&&n.bI(Mt,Ot)/(Se*la)<se)return null;Se=la,Mt=Ot}H&&J&&(C[me]&&(Ne=Xe(),Se=n.bF(we,Ne),Mt=n.av([],Ne,we)),C[me]=Ne);const Ie=(Pe-ge)/Se,ct=qe.sub(dt)._mult(Ie)._add(dt),et=n.bG([],we,Mt,Ie);let jt=[0,0,1],Ct=Mt[0],oa=Mt[1];if(ae&&(jt=q.upVector(ne.canonical,ct.x,ct.y),jt[0]!==0||jt[1]!==0||jt[2]!==1)){const Ot=[jt[2],0,-jt[0]],la=n.bH([],jt,Ot);n.aw(Ot,Ot),n.aw(la,la),Ct=n.bI(Mt,Ot),oa=n.bI(Mt,la)}if(i){const Ot=n.bH([],jt,Mt);n.aw(Ot,Ot),n.bG(et,et,Ot,i*ce)}const Bt=Ze+Math.atan2(oa,Ct);return Fe.push(et),U&&it.push(ct),{point:et,angle:Bt,path:Fe,tilePath:it,up:jt}}function ql(h,t){const i=t.length,f=i+4*h;t.resize(f),t.float32.fill(-1/0,4*i,4*f)}function Vo(h,t,i){const f=t[0],_=t[1];return h[0]=i[0]*f+i[4]*_+i[12],h[1]=i[1]*f+i[5]*_+i[13],h[3]=i[3]*f+i[7]*_+i[15],h}const Mo=100;class Sc{constructor(t,i,f=new lu(t.width+200,t.height+200,25),_=new lu(t.width+200,t.height+200,25)){this.transform=t,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Mo,this.screenBottomBoundary=t.height+Mo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,f,_,w,b,E,A,M,I,C){let J=f.projectedAnchorX,U=f.projectedAnchorY,H=f.projectedAnchorZ;const q=f.tileAnchorX,ne=f.tileAnchorY,ae=f.elevation,se=f.tileID,he=t.getProjection();if(ae&&se){const[it,qe,dt]=he.upVector(se.canonical,f.tileAnchorX,f.tileAnchorY),Mt=he.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;J+=it*ae*Mt,U+=qe*ae*Mt,H+=dt*ae*Mt}const ce=t.projection.name==="globe",Ze=t.projection.name==="globe"?n.aj(this.transform.zoom):0;if(se&&ce&&Ze<1&&!b){const it=1<<se.canonical.z,qe=n.bO(q,ne);n.bP(qe,qe,1/n.al),n.bQ(qe,qe,n.bO(se.canonical.x,se.canonical.y)),n.bP(qe,qe,1/it),n.bR(qe,qe,n.bO(_[0],_[1])),qe[0]=n.bS(qe[0],-.5,.5),n.bP(qe,qe,n.al);const dt=n.bT(qe[0],qe[1],n.al/(2*Math.PI),1);n.aC(dt,dt,w),J=n.ak(J,dt[0],Ze),U=n.ak(U,dt[1],Ze),H=n.ak(H,dt[2],Ze)}const me=this.projectAndGetPerspectiveRatio(I,J,U,H,f.tileID,he.name==="globe"||!!ae||this.transform.pitch>0,he),Ne=M*me.perspectiveRatio,we=(f.x1*i+E.x-f.padding)*Ne+me.point.x,ge=(f.y1*i+E.y-f.padding)*Ne+me.point.y,Se=(f.x2*i+E.x+f.padding)*Ne+me.point.x,Pe=(f.y2*i+E.y+f.padding)*Ne+me.point.y,Fe=me.perspectiveRatio<=.55||me.occluded;return!this.isInsideGrid(we,ge,Se,Pe)||!A&&this.grid.hitTest(we,ge,Se,Pe,C)||Fe?{box:[],offscreen:!1,occluded:me.occluded}:{box:[we,ge,Se,Pe],offscreen:this.isOffscreen(we,ge,Se,Pe),occluded:!1}}placeCollisionCircles(t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne){const ae=[],se=this.transform.elevation,he=t.getProjection(),ce=t.elevationType==="road",Ze=!!se||ce,me=n.bU.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,he),Ne=new n.P(f.tileAnchorX,f.tileAnchorY),we=new n.P(f.tileAnchorX,f.tileAnchorY);let{x:ge,y:Se,z:Pe}=he.projectTilePoint(we.x,we.y,ne.canonical),Fe=null;if(Ze){const la=ce?t.getElevationFeatureForText(_):null;Fe={getElevation:me,elevation:se,elevationFeature:la};const[ra,Ht,ia]=me(Ne,se,la);ge+=ra,Se+=Ht,Pe+=ia}const it=he.name==="globe",qe=this.projectAndGetPerspectiveRatio(A,ge,Se,Pe,ne,it||!!se||this.transform.pitch>0,he),{perspectiveRatio:dt}=qe,Mt=(J?E/dt:E*dt)/n.bX,Xe=xn(ge,Se,Pe,M),Ie=f.lineOffsetX*Mt,ct=f.lineOffsetY*Mt,et=n.an(t.layers[0].layout.get("text-max-angle")),jt=Math.cos(et),Ct=qe.signedDistanceFromCamera>0?Or(Mt,b,Ie,ct,ce&&f.flipState===1,Xe,we,f,w,M,{},Ze&&!J?Fe:null,J&&Ze,he,ne,J,jt):null;let oa=!1,Bt=!1,Ot=!0;if(Ct&&!qe.occluded){const la=.5*H*dt+q,ra=new n.P(-100,-100),Ht=new n.P(this.screenRightBoundary,this.screenBottomBoundary),ia=new Zc,{first:va,last:ir}=Ct,Oa=va.path.length;let Qr=[];for(let Ua=Oa-1;Ua>=1;Ua--)Qr.push(va.path[Ua]);for(let Ua=1;Ua<ir.path.length;Ua++)Qr.push(ir.path[Ua]);const Ta=2.5*la;I&&(Qr=Qr.map(([Ua,Cr,mr],Kr)=>(Ze&&!it&&(mr=me(Kr<Oa-1?va.tilePath[Oa-1-Kr]:ir.tilePath[Kr-Oa+2],se,Fe.elevationFeature)[2]),xn(Ua,Cr,mr,I))),Qr.some(Ua=>Ua[3]<=0)&&(Qr=[]));let pr=[];if(Qr.length>0){let Ua=1/0,Cr=-1/0,mr=1/0,Kr=-1/0;for(const sr of Qr)Ua=Math.min(Ua,sr[0]),mr=Math.min(mr,sr[1]),Cr=Math.max(Cr,sr[0]),Kr=Math.max(Kr,sr[1]);Cr>=ra.x&&Ua<=Ht.x&&Kr>=ra.y&&mr<=Ht.y&&(pr=[Qr.map(sr=>new n.P(sr[0],sr[1]))],(Ua<ra.x||Cr>Ht.x||mr<ra.y||Kr>Ht.y)&&(pr=n.bV(pr,ra.x,ra.y,Ht.x,Ht.y)))}for(const Ua of pr){ia.reset(Ua,.25*la);let Cr=0;Cr=ia.length<=.5*la?1:Math.ceil(ia.paddedLength/Ta)+1;for(let mr=0;mr<Cr;mr++){const Kr=mr/Math.max(Cr-1,1),sr=ia.lerp(Kr),Ga=sr.x+Mo,Rr=sr.y+Mo;ae.push(Ga,Rr,la,0);const Ca=Ga-la,en=Rr-la,_r=Ga+la,Va=Rr+la;if(Ot=Ot&&this.isOffscreen(Ca,en,_r,Va),Bt=Bt||this.isInsideGrid(Ca,en,_r,Va),!i&&this.grid.hitTestCircle(Ga,Rr,la,U)&&(oa=!0,!C))return{circles:[],offscreen:!1,collisionDetected:oa,occluded:!1}}}}return{circles:!C&&oa||!Bt?[]:ae,offscreen:Ot,collisionDetected:oa,occluded:qe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let f=1/0,_=1/0,w=-1/0,b=-1/0;for(const I of t){const C=new n.P(I.x+Mo,I.y+Mo);f=Math.min(f,C.x),_=Math.min(_,C.y),w=Math.max(w,C.x),b=Math.max(b,C.y),i.push(C)}const E=this.grid.query(f,_,w,b).concat(this.ignoredGrid.query(f,_,w,b)),A={},M={};for(const I of E){const C=I.key;if(A[C.bucketInstanceId]===void 0&&(A[C.bucketInstanceId]={}),A[C.bucketInstanceId][C.featureIndex])continue;const J=[new n.P(I.x1,I.y1),new n.P(I.x2,I.y1),new n.P(I.x2,I.y2),new n.P(I.x1,I.y2)];n.bW(i,J)&&(A[C.bucketInstanceId][C.featureIndex]=!0,M[C.bucketInstanceId]===void 0&&(M[C.bucketInstanceId]=[]),M[C.bucketInstanceId].push(C.featureIndex))}return M}insertCollisionBox(t,i,f,_,w){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:w},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,f,_,w){const b=i?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:_,collisionGroupID:w};for(let A=0;A<t.length;A+=4)b.insertCircle(E,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,i,f,_,w,b,E){const A=[i,f,_,1];let M=!1;_||this.transform.pitch>0?(n.aC(A,A,t),this.fogState&&w&&E.name!=="globe"&&(M=function(J,U,H,q,ne,ae){const se=ae.calculateFogTileMatrix(ne),he=[U,H,q];return n.af(he,he,se),Vt(J,n.ag(he),ae.pitch,ae._fov)}(this.fogState,i,f,_,w.toUnwrapped(),this.transform)>.9)):Vo(A,A,t);const I=A[3];return{point:new n.P((A[0]/I+1)/2*this.transform.width+Mo,(-A[1]/I+1)/2*this.transform.height+Mo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/I*.5,1.5),signedDistanceFromCamera:I,occluded:b&&A[2]>I||M}}isOffscreen(t,i,f,_){return f<Mo||t>=this.screenRightBoundary||_<Mo||i>this.screenBottomBoundary}isInsideGrid(t,i,f,_){return f>=0&&t<this.gridRightBoundary&&_>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const t=n.bz([]);return n.bq(t,t,[-100,-100,0]),t}}class ya{constructor(t,i,f,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class jr{constructor(t,i,f,_,w,b=!1){this.text=new ya(t?t.text:null,i,f,w),this.icon=new ya(t?t.icon:null,i,_,w),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mr{constructor(t,i,f,_=!1){this.text=t,this.icon=i,this.skipFade=f,this.clipped=_}}class Ys{constructor(){this.invProjMatrix=n.bB(),this.viewportMatrix=n.bB(),this.circles=[]}}class id{constructor(t,i,f,_,w){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=w}}class Dr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:f=>f.collisionGroupID===i}}return this.collisionGroups[t]}}function rh(h,t,i,f,_){const{horizontalAlign:w,verticalAlign:b}=n.c0(h),E=-(w-.5)*t,A=-(b-.5)*i,M=n.c1(h,f);return new n.P(E+M[0]*_,A+M[1]*_)}function uu(h,t,i,f,_){const w=new n.P(h,t);return i&&w._rotate(f?_:-_),w}class nh{constructor(t,i,f,_,w,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Sc(this.transform,w),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new Dr(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,f,_,w=1){const b=f.getBucket(i),E=f.latestFeatureIndex;if(!b||!E||i.fqid!==b.layerIds[0])return;const A=b.layers[0].layout,M=b.layers[0].paint,I=f.collisionBoxArray,C=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),J=f.tileSize/n.al,U=f.tileID.toUnwrapped();this.transform.setProjection(b.projection);const H=(q=f.tileID,ne=b.getProjection(),ae=this.transform,ne.name===this.projection?ae.calculateProjMatrix(q.toUnwrapped()):Zl(ae,ne,q));var q,ne,ae;const se=A.get("text-pitch-alignment")==="map",he=A.get("text-rotation-alignment")==="map";i.compileFilter(i.options);const ce=i.dynamicFilter(),Ze=i.dynamicFilterNeedsFeature(),me=this.transform.calculatePixelsToTileUnitsMatrix(f),Ne=Nc(H,f.tileID.canonical,se,he,this.transform,b.getProjection(),me);let we=null;const ge=b.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(se){const Ie=Nl(H,f.tileID.canonical,se,he,this.transform,b.getProjection(),me);we=n.aB([],this.transform.labelPlaneMatrix,Ie)}let Se=null;ce&&f.latestFeatureIndex&&(Se={unwrappedTileID:U,dynamicFilter:ce,dynamicFilterNeedsFeature:Ze}),this.retainedQueryData[b.bucketInstanceId]=new id(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,f.tileID);const[Pe,Fe]=b.layers[0].layout.get("text-size-scale-range"),it=n.aA(w,Pe,Fe),[qe,dt]=A.get("icon-size-scale-range"),Mt=n.aA(w,qe,dt),Xe={bucket:b,layout:A,paint:M,posMatrix:H,invMatrix:ge,mercatorCenter:[n.aF(this.transform.center.lng),n.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ne,labelToScreenMatrix:we,clippingData:Se,scale:C,textPixelRatio:J,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:n.bJ(b.textSizeData,this.transform.zoom,it),partiallyEvaluatedIconSize:n.bJ(b.iconSizeData,this.transform.zoom,Mt),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(const Ie of b.sortKeyRanges){const{sortKey:ct,symbolInstanceStart:et,symbolInstanceEnd:jt}=Ie;t.push({sortKey:ct,symbolInstanceStart:et,symbolInstanceEnd:jt,parameters:Xe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Xe})}attemptAnchorPlacement(t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae,se,he,ce,Ze){const{textOffset0:me,textOffset1:Ne,crossTileID:we}=q,ge=[me,Ne],Se=rh(t,b,E,ge,A),Pe=this.collisionIndex.placeCollisionBox(ae,A,i,f,_,w,uu(Se.x,Se.y,M,I,this.transform.angle),H,C,J,U.predicate);if(he){const Fe=ae.getSymbolInstanceIconSize(Ze,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ae,Fe,he,f,_,w,uu(Se.x,Se.y,M,I,this.transform.angle),H,C,J,U.predicate).box.length===0)return}if(Pe.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(Fe=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:ge,width:b,height:E,anchor:t,textScale:A,prevAnchor:Fe},this.markUsedJustification(ae,t,q,se),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,se,q),this.placedOrientations[we]=se),{shift:Se,placedGlyphBoxes:Pe}}}placeLayerBucketPart(t,i,f,_,w=1){const{bucket:b,layout:E,paint:A,posMatrix:M,textLabelPlaneMatrix:I,labelToScreenMatrix:C,clippingData:J,textPixelRatio:U,mercatorCenter:H,invMatrix:q,holdingForFade:ne,collisionBoxArray:ae,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:he,collisionGroup:ce,latestFeatureIndex:Ze}=t.parameters,me=E.get("text-optional"),Ne=E.get("icon-optional"),we=E.get("text-allow-overlap"),ge=E.get("icon-allow-overlap"),Se=E.get("text-rotation-alignment")==="map",Pe=E.get("icon-rotation-alignment")==="map",Fe=E.get("text-pitch-alignment")==="map",it=A.get("symbol-z-offset"),qe=E.get("symbol-elevation-reference")==="sea",dt=E.get("symbol-placement"),[Mt,Xe]=E.get("text-size-scale-range"),[Ie,ct]=E.get("icon-size-scale-range"),et=n.aA(w,Mt,Xe),jt=n.aA(w,Ie,ct),Ct=E.get("text-variable-anchor"),oa=Se&&dt!=="point",Bt=Pe&&dt!=="point",Ot=Ct&&b.hasTextData(),la=b.hasIconTextFit()&&Ot&&b.hasIconData();this.transform.setProjection(b.projection);const ra=Ot||oa,Ht=Bt||la;let ia=we&&(ge||!b.hasIconData()||Ne),va=ge&&(we||!b.hasTextData()||me);const ir=!it.isConstant();!b.collisionArrays&&ae&&b.deserializeCollisionBoxes(ae),f&&_&&b.updateCollisionDebugBuffers(this.transform.zoom,ae,et,jt);const Oa=(Ta,pr,Ua)=>{const{crossTileID:Cr,numVerticalGlyphVertices:mr}=Ta;let Kr=null;if(J&&J.dynamicFilterNeedsFeature||ir){const vn=this.retainedQueryData[b.bucketInstanceId];Kr=Ze.loadFeature({featureIndex:Ta.featureIndex,bucketIndex:vn.bucketIndex,sourceLayerIndex:vn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(J&&!(0,J.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:b.worldview},Kr,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new n.P(Ta.tileAnchorX,Ta.tileAnchorY),this.transform.calculateDistanceTileData(J.unwrappedTileID)))return this.placements[Cr]=new Mr(!1,!1,!1,!0),void i.add(Cr);const sr=it.evaluate(Kr,{});if(i.has(Cr))return;if(ne)return void(this.placements[Cr]=new Mr(!1,!1,!1));let Ga=!1,Rr=!1,Ca=!0,en=!1,_r=!1,Va=null,yr={box:null,offscreen:null,occluded:null},_n={box:null},Hn=null,wn=null,Dn=null,Ss=0,xs=0,Si=0;Ua.textFeatureIndex?Ss=Ua.textFeatureIndex:Ta.useRuntimeCollisionCircles&&(Ss=Ta.featureIndex),Ua.verticalTextFeatureIndex&&(xs=Ua.verticalTextFeatureIndex);const Fi=b.elevationFeatures?b.elevationFeatures[Ta.elevationFeatureIndex]:void 0,so=vn=>{vn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Cn=this.transform.elevation;vn.elevation=qe?sr:sr+n.bU.getAtTileOffset(vn.tileID,new n.P(vn.tileAnchorX,vn.tileAnchorY),Cn,Fi),vn.elevation+=Ta.zOffset},Oi=Ua.textBox;if(Oi){so(Oi);const vn=Gr=>{let Yn=n.bK.horizontal;if(b.allowVerticalPlacement&&!Gr&&this.prevPlacement){const Di=this.prevPlacement.placedOrientations[Cr];Di&&(this.placedOrientations[Cr]=Di,Yn=Di,this.markUsedOrientation(b,Yn,Ta))}return Yn},Cn=(Gr,Yn)=>{if(b.allowVerticalPlacement&&mr>0&&Ua.verticalTextBox){for(const Di of b.writingModes)if(Di===n.bK.vertical?(yr=Yn(),_n=yr):yr=Gr(),yr&&yr.box&&yr.box.length)break}else yr=Gr()};if(Ct){let Gr=Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Cr]){const bn=this.prevPlacement.variableOffsets[Cr];Gr.indexOf(bn.anchor)>0&&(Gr=Gr.filter(Eo=>Eo!==bn.anchor),Gr.unshift(bn.anchor))}const Yn=(bn,Eo,Fl)=>{const fc=b.getSymbolInstanceTextSize(se,Ta,this.transform.zoom,pr),pc=(bn.x2-bn.x1)*fc+2*bn.padding,y=(bn.y2-bn.y1)*fc+2*bn.padding,v=Ta.hasIconTextFit&&!ge?Eo:null;v&&so(v);let z={box:[],offscreen:!1,occluded:!1};const k=we?2*Gr.length:Gr.length;for(let W=0;W<k;++W){const ee=this.attemptAnchorPlacement(Gr[W%Gr.length],bn,H,q,ra,pc,y,fc,Se,Fe,U,M,ce,W>=Gr.length,Ta,pr,b,Fl,v,se,he);if(ee&&(z=ee.placedGlyphBoxes,z&&z.box&&z.box.length)){Ga=!0,Va=ee.shift;break}}return z};Cn(()=>Yn(Oi,Ua.iconBox,n.bK.horizontal),()=>{const bn=Ua.verticalTextBox;return bn&&so(bn),b.allowVerticalPlacement&&!(yr&&yr.box&&yr.box.length)&&mr>0&&bn?Yn(bn,Ua.verticalIconBox,n.bK.vertical):{box:null,offscreen:null,occluded:null}}),yr&&(Ga=yr.box,Ca=yr.offscreen,en=yr.occluded);const Di=vn(!(!yr||!yr.box));if(!Ga&&this.prevPlacement){const bn=this.prevPlacement.variableOffsets[Cr];bn&&(this.variableOffsets[Cr]=bn,this.markUsedJustification(b,bn.anchor,Ta,Di))}}else{const Gr=(Yn,Di)=>{const bn=b.getSymbolInstanceTextSize(se,Ta,this.transform.zoom,pr),Eo=this.collisionIndex.placeCollisionBox(b,bn,Yn,H,q,ra,new n.P(0,0),we,U,M,ce.predicate);return Eo&&Eo.box&&Eo.box.length&&(this.markUsedOrientation(b,Di,Ta),this.placedOrientations[Cr]=Di),Eo};Cn(()=>Gr(Oi,n.bK.horizontal),()=>{const Yn=Ua.verticalTextBox;return b.allowVerticalPlacement&&mr>0&&Yn?(so(Yn),Gr(Yn,n.bK.vertical)):{box:null,offscreen:null,occluded:null}}),vn(!!(yr&&yr.box&&yr.box.length))}}if(Hn=yr,Ga=Hn&&Hn.box&&Hn.box.length>0,Ca=Hn&&Hn.offscreen,en=Hn&&Hn.occluded,Ta.useRuntimeCollisionCircles){const vn=Ta.centerJustifiedTextSymbolIndex>=0?Ta.centerJustifiedTextSymbolIndex:Ta.verticalPlacedTextSymbolIndex,Cn=b.text.placedSymbolArray.get(vn),Gr=n.bL(b.textSizeData,se,Cn),Yn=E.get("text-padding");wn=this.collisionIndex.placeCollisionCircles(b,we,Cn,vn,b.lineVertexArray,b.glyphOffsetArray,Gr,M,I,C,f,Fe,ce.predicate,Ta.collisionCircleDiameter*Gr/n.bX,Yn,this.retainedQueryData[b.bucketInstanceId].tileID),Ga=we||wn.circles.length>0&&!wn.collisionDetected,Ca=Ca&&wn.offscreen,en=wn.occluded}if(Ua.iconFeatureIndex&&(Si=Ua.iconFeatureIndex),Ua.iconBox){const vn=Cn=>{so(Cn);const Gr=Ta.hasIconTextFit&&Va?uu(Va.x,Va.y,Se,Fe,this.transform.angle):new n.P(0,0),Yn=b.getSymbolInstanceIconSize(he,this.transform.zoom,Ta.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Yn,Cn,H,q,Ht,Gr,ge,U,M,ce.predicate)};_n&&_n.box&&_n.box.length&&Ua.verticalIconBox?(Dn=vn(Ua.verticalIconBox),Rr=Dn.box.length>0):(Dn=vn(Ua.iconBox),Rr=Dn.box.length>0),Ca=Ca&&Dn.offscreen,_r=Dn.occluded}const Zo=me||Ta.numHorizontalGlyphVertices===0&&mr===0,No=Ne||Ta.numIconVertices===0;if(Zo||No?No?Zo||(Rr=Rr&&Ga):Ga=Rr&&Ga:Rr=Ga=Rr&&Ga,Ga&&Hn&&Hn.box&&this.collisionIndex.insertCollisionBox(Hn.box,E.get("text-ignore-placement"),b.bucketInstanceId,_n&&_n.box&&xs?xs:Ss,ce.ID),Rr&&Dn&&this.collisionIndex.insertCollisionBox(Dn.box,E.get("icon-ignore-placement"),b.bucketInstanceId,Si,ce.ID),wn&&(Ga&&this.collisionIndex.insertCollisionCircles(wn.circles,E.get("text-ignore-placement"),b.bucketInstanceId,Ss,ce.ID),f)){const vn=b.bucketInstanceId;let Cn=this.collisionCircleArrays[vn];Cn===void 0&&(Cn=this.collisionCircleArrays[vn]=new Ys);for(let Gr=0;Gr<wn.circles.length;Gr+=4)Cn.circles.push(wn.circles[Gr+0]),Cn.circles.push(wn.circles[Gr+1]),Cn.circles.push(wn.circles[Gr+2]),Cn.circles.push(wn.collisionDetected?1:0)}const vi=b.projection.name!=="globe";ia=ia&&(vi||!en),va=va&&(vi||!_r),this.placements[Cr]=new Mr(Ga||ia,Rr||va,Ca||b.justReloaded),i.add(Cr)},Qr=this.retainedQueryData[b.bucketInstanceId].tileID;if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,Qr),b.elevationType==="road"&&b.updateRoadElevation(Qr.canonical),b.updateZOffset(),b.sortFeaturesByY){const Ta=b.getSortedSymbolIndexes(this.transform.angle);for(let pr=Ta.length-1;pr>=0;--pr){const Ua=Ta[pr];Oa(b.symbolInstances.get(Ua),Ua,b.collisionArrays[Ua])}b.hasAnyZOffset&&n.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const Ta=b.getSortedIndexesByZOffset();for(let pr=0;pr<Ta.length;++pr){const Ua=Ta[pr];Oa(b.symbolInstances.get(Ua),Ua,b.collisionArrays[Ua])}}else for(let Ta=t.symbolInstanceStart;Ta<t.symbolInstanceEnd;Ta++)Oa(b.symbolInstances.get(Ta),Ta,b.collisionArrays[Ta]);if(f&&b.bucketInstanceId in this.collisionCircleArrays){const Ta=this.collisionCircleArrays[b.bucketInstanceId];n.bk(Ta.invProjMatrix,M),Ta.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,i,f,_){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:A,crossTileID:M}=f,I=n.c2(i),C=_===n.bK.vertical?A:I==="left"?w:I==="center"?b:I==="right"?E:-1;w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=C>=0&&w!==C?0:M),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=C>=0&&b!==C?0:M),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=C>=0&&E!==C?0:M),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=C>=0&&A!==C?0:M)}markUsedOrientation(t,i,f){const _=i===n.bK.horizontal||i===n.bK.horizontalOnly?i:0,w=i===n.bK.vertical?i:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:M}=f,I=t.text.placedSymbolArray;b>=0&&(I.get(b).placedOrientation=_),E>=0&&(I.get(E).placedOrientation=_),A>=0&&(I.get(A).placedOrientation=_),M>=0&&(I.get(M).placedOrientation=w)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let f=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const _=i?i.symbolFadeChange(t):1,w=i?i.opacities:{},b=i?i.variableOffsets:{},E=i?i.placedOrientations:{};for(const A in this.placements){const M=this.placements[A],I=w[A];I?(this.opacities[A]=new jr(I,_,M.text,M.icon,null,M.clipped),f=f||M.text!==I.text.placed||M.icon!==I.icon.placed):(this.opacities[A]=new jr(null,_,M.text,M.icon,M.skipFade,M.clipped),f=f||M.text||M.icon)}for(const A in w){const M=w[A];if(!this.opacities[A]){const I=new jr(M,_,!1,!1);I.isHidden()||(this.opacities[A]=I,f=f||M.text.placed||M.icon.placed)}}for(const A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(const A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i,f,_){const w=new Set;for(const b of i){const E=b.getBucket(t);E&&b.latestFeatureIndex&&t.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,w,b,b.collisionBoxArray,f,_,b.tileID,t.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,b.tileID),E.elevationType==="road"&&E.updateRoadElevation(b.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(t,i,f,_,w,b,E,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const M=t.layers[0].layout,I=t.layers[0].paint,C=!!t.layers[0].dynamicFilter(),J=new jr(null,0,!1,!1,!0),U=M.get("text-allow-overlap"),H=M.get("icon-allow-overlap"),q=M.get("text-variable-anchor"),ne=M.get("text-rotation-alignment")==="map",ae=M.get("text-pitch-alignment")==="map",se=I.get("symbol-z-offset"),he=M.get("symbol-elevation-reference")==="sea",ce=!se.isConstant(),Ze=new jr(null,0,U&&(H||!t.hasIconData()||M.get("icon-optional")),H&&(U||!t.hasTextData()||M.get("text-optional")),!0);!t.collisionArrays&&_&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(_);const me=(we,ge,Se)=>{for(let Pe=0;Pe<ge/4;Pe++)we.opacityVertexArray.emplaceBack(Se)};let Ne=0;b&&t.updateReplacement(E,b);for(let we=0;we<t.symbolInstances.length;we++){const ge=t.symbolInstances.get(we),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:Pe,crossTileID:Fe,numIconVertices:it,tileAnchorX:qe,tileAnchorY:dt}=ge;let Mt=null;const Xe=this.retainedQueryData[t.bucketInstanceId];ce&&ge&&Xe&&(Mt=f.latestFeatureIndex.loadFeature({featureIndex:ge.featureIndex,bucketIndex:Xe.bucketIndex,sourceLayerIndex:Xe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ie=se.evaluate(Mt,{}),ct=i.has(Fe);let et=this.opacities[Fe];ct?et=J:et||(et=Ze,this.opacities[Fe]=et),i.add(Fe);const jt=Se>0||Pe>0,Ct=it>0,oa=this.placedOrientations[Fe],Bt=oa===n.bK.vertical,Ot=oa===n.bK.horizontal||oa===n.bK.horizontalOnly;!jt&&!Ct||et.isHidden()||Ne++;let la=!1;if((jt||Ct)&&b)for(const ra of t.activeReplacements){if(n.bY(ra,w,n.bZ.Symbol,A)||ra.min.x>qe||qe>ra.max.x||ra.min.y>dt||dt>ra.max.y)continue;const Ht=n.b_(qe,dt,E.canonical,ra.footprintTileId.canonical);if(la=n.b$(Ht,ra.footprint),la)break}if(jt){const ra=la?Bi:sh(et.text);me(t.text,Se,Bt?Bi:ra),me(t.text,Pe,Ot?Bi:ra);const Ht=et.text.isHidden(),{leftJustifiedTextSymbolIndex:ia,centerJustifiedTextSymbolIndex:va,rightJustifiedTextSymbolIndex:ir,verticalPlacedTextSymbolIndex:Oa}=ge,Qr=t.text.placedSymbolArray,Ta=Ht||Bt?1:0;ia>=0&&(Qr.get(ia).hidden=Ta),va>=0&&(Qr.get(va).hidden=Ta),ir>=0&&(Qr.get(ir).hidden=Ta),Oa>=0&&(Qr.get(Oa).hidden=Ht||Ot?1:0);const pr=this.variableOffsets[Fe];pr&&this.markUsedJustification(t,pr.anchor,ge,oa);const Ua=this.placedOrientations[Fe];Ua&&(this.markUsedJustification(t,"left",ge,Ua),this.markUsedOrientation(t,Ua,ge))}if(Ct){const ra=la?Bi:sh(et.icon),{placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:ia}=ge,va=t.icon.placedSymbolArray,ir=et.icon.isHidden()?1:0;Ht>=0&&(me(t.icon,it,Bt?Bi:ra),va.get(Ht).hidden=ir),ia>=0&&(me(t.icon,ge.numVerticalIconVertices,Ot?Bi:ra),va.get(ia).hidden=ir)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ra=t.collisionArrays[we];if(ra){let Ht=new n.P(0,0),ia=!0;if(ra.textBox||ra.verticalTextBox){if(q){const ir=this.variableOffsets[Fe];ir?(Ht=rh(ir.anchor,ir.width,ir.height,ir.textOffset,ir.textScale),ne&&Ht._rotate(ae?this.transform.angle:-this.transform.angle)):ia=!1}C&&(ia=!et.clipped),ra.textBox&&Pi(t.textCollisionBox.collisionVertexArray,et.text.placed,!ia||Bt,Ie,he,Ht.x,Ht.y),ra.verticalTextBox&&Pi(t.textCollisionBox.collisionVertexArray,et.text.placed,!ia||Ot,Ie,he,Ht.x,Ht.y)}const va=ia&&!!(!Ot&&ra.verticalIconBox);ra.iconBox&&Pi(t.iconCollisionBox.collisionVertexArray,et.icon.placed,va,Ie,he,ge.hasIconTextFit?Ht.x:0,ge.hasIconTextFit?Ht.y:0),ra.verticalIconBox&&Pi(t.iconCollisionBox.collisionVertexArray,et.icon.placed,!va,Ie,he,ge.hasIconTextFit?Ht.x:0,ge.hasIconTextFit?Ht.y:0)}}}if(t.fullyClipped=Ne===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=we.invProjMatrix,t.placementViewportMatrix=we.viewportMatrix,t.collisionCircleArray=we.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){const f=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Pi(h,t,i,f,_,w,b){h.emplaceBack(t?1:0,i?1:0,w||0,b||0,f,_?1:0),h.emplaceBack(t?1:0,i?1:0,w||0,b||0,f,_?1:0),h.emplaceBack(t?1:0,i?1:0,w||0,b||0,f,_?1:0),h.emplaceBack(t?1:0,i?1:0,w||0,b||0,f,_?1:0)}const oi=Math.pow(2,25),uy=Math.pow(2,24),ih=Math.pow(2,17),ep=Math.pow(2,16),sd=Math.pow(2,9),ef=Math.pow(2,8),tp=Math.pow(2,1);function sh(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,i=Math.floor(127*h.opacity);return i*oi+t*uy+i*ih+t*ep+i*sd+t*ef+i*tp+t}const Bi=0;class Kl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,f,_,w,b){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(E,_,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,M)=>A.sortKey-M.sortKey));this._currentPartIndex<E.length;){const A=E[this._currentPartIndex];if(i.placeLayerBucketPart(A,this._seenCrossTileIDs,f,A.symbolInstanceStart===0,b),this._currentPartIndex++,w())return!0}return!1}}class Is{constructor(t,i,f,_,w,b,E,A,M){this.placement=new nh(t,w,b,E,A,M),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,i,f,_,w){const b=n.o.now(),E=()=>{const A=n.o.now()-b;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=i[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=M)&&(!A.maxzoom||A.maxzoom>M)){const I=A,C=I.layout.get("symbol-z-elevate"),J=I.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=I.layout.get("symbol-z-order"),H=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&J),q=I.layout.get("text-allow-overlap")||I.layout.get("icon-allow-overlap")||I.layout.get("text-ignore-placement")||I.layout.get("icon-ignore-placement"),ne=H&&q,ae=this._inProgressLayer=this._inProgressLayer||new Kl(I),se=n.B(A.source,A.scope);if(ae.continuePlacement(C||ne?_[se]:f[se],this.placement,this._showCollisionBoxes,A,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const tf=512/n.al/2;class zc{constructor(t,i,f){this.tileID=t,this.bucketInstanceId=f,this.index=new n.c3(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=t.canonical.x*n.al,w=t.canonical.y*n.al;for(let b=0;b<i.length;b++){const{key:E,crossTileID:A,tileAnchorX:M,tileAnchorY:I}=i.get(b),C=Math.floor((_+M)*tf),J=Math.floor((w+I)*tf);this.index.add(C,J),this.keys.push(E),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,i,f){const _=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),w=tf/Math.pow(2,i.canonical.z-this.tileID.canonical.z),b=i.canonical.x*n.al,E=i.canonical.y*n.al;for(let A=0;A<t.length;A++){const M=t.get(A);if(M.crossTileID)continue;const{key:I,tileAnchorX:C,tileAnchorY:J}=M,U=Math.floor((b+C)*w),H=Math.floor((E+J)*w),q=this.index.range(U-_,H-_,U+_,H+_).sort((ne,ae)=>ne-ae);for(const ne of q){const ae=this.crossTileIDs[ne];if(this.keys[ne]===I&&!f.has(ae)){f.add(ae),M.crossTileID=ae;break}}}}}class li{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class El{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const i=Math.round((t-this.lng)/360);if(i!==0)for(const f in this.indexes){const _=this.indexes[f],w={};for(const b in _){const E=_[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+i),w[E.tileID.key]=E}this.indexes[f]=w}this.lng=t}addBucket(t,i,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let w=0;w<i.symbolInstances.length;w++)i.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const _=this.usedCrossTileIDs[t.overscaledZ];for(const w in this.indexes){const b=this.indexes[w];if(Number(w)>t.overscaledZ)for(const E in b){const A=b[E];A.tileID.isChildOf(t)&&A.findMatches(i.symbolInstances,t,_)}else{const E=b[t.scaledTo(Number(w)).key];E&&E.findMatches(i.symbolInstances,t,_)}}for(let w=0;w<i.symbolInstances.length;w++){const b=i.symbolInstances.get(w);b.crossTileID||(b.crossTileID=f.generate(),_.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new zc(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(const f of i.crossTileIDs)this.usedCrossTileIDs[t].delete(f)}removeStaleBuckets(t){let i=!1;for(const f in this.indexes){const _=this.indexes[f];for(const w in _)t[_[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[w]),delete _[w],i=!0)}return i}}class Sl{constructor(){this.layerIndexes={},this.crossTileIDs=new li,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,f,_){let w=this.layerIndexes[t.fqid];w===void 0&&(w=this.layerIndexes[t.fqid]=new El);let b=!1;const E={};_.name!=="globe"&&w.handleWrapJump(f);for(const A of i){const M=A.getBucket(t);M&&t.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(A.tileID,M,this.crossTileIDs)&&(b=!0),E[M.bucketInstanceId]=!0)}return w.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(t){const i={};t.forEach(f=>{i[f]=!0});for(const f in this.layerIndexes)i[f]||delete this.layerIndexes[f]}}const Xn=771;class Ya{constructor(t,i,f,_){this.blendFunction=t,this.blendColor=i.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=_}}Ya.Replace=[1,0,1,0],Ya.disabled=new Ya(Ya.Replace,n.ao.transparent,[!1,!1,!1,!1]),Ya.unblended=new Ya(Ya.Replace,n.ao.transparent,[!0,!0,!0,!0]),Ya.alphaBlended=new Ya([1,Xn,1,Xn],n.ao.transparent,[!0,!0,!0,!0]),Ya.alphaBlendedNonPremultiplied=new Ya([770,Xn,770,Xn],n.ao.transparent,[!0,!0,!0,!0]),Ya.multiply=new Ya([774,0,774,0],n.ao.transparent,[!0,!0,!0,!0]),Ya.additive=new Ya([1,1,1,1],n.ao.transparent,[!0,!0,!0,!0]);class ca{constructor(t,i,f){this.func=t,this.mask=i,this.range=f}}ca.ReadOnly=!1,ca.ReadWrite=!0,ca.disabled=new ca(519,ca.ReadOnly,[0,1]);const Ac=7680;class za{constructor(t,i,f,_,w,b){this.test=t,this.ref=i,this.mask=f,this.fail=_,this.depthFail=w,this.pass=b}}za.disabled=new za({func:519,mask:0},0,0,Ac,Ac,Ac);const od=1029,af=2305;class Ba{constructor(t,i,f){this.enable=t,this.mode=i,this.frontFace=f}}function ld(h,t){const i=n.c9(h,3);n.cb(h,t),n.cf(h,3,i)}function oh(h,t){const i=n.c6([]);return n.c7(i,i,-t),n.c8(i,i,-h),i}function cd(h,t){const i=[h[0],h[1],0],f=[t[0],t[1],0];if(n.ag(i)>=1e-15){const b=n.aw([],i);n.c4(f,b,n.bI(f,b)),t[0]=f[0],t[1]=f[1]}const _=n.bH([],t,h);if(n.c5(_)<1e-15)return null;const w=Math.atan2(-_[1],_[0]);return oh(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),w)}Ba.disabled=new Ba(!1,od,af),Ba.backCCW=new Ba(!0,od,af),Ba.backCW=new Ba(!0,od,2304),Ba.frontCW=new Ba(!0,1028,2304),Ba.frontCCW=new Ba(!0,1028,af);class $s{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){const i=t instanceof n.ae?t:new n.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=n.bS(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i,f){if(this.orientation=null,!this.position)return;const _=this.position,w=f||(this._elevation?this._elevation.getAtPointOrZero(n.ae.fromLngLat(t)):0),b=n.ae.fromLngLat(t,w),E=[b.x-_.x,b.y-_.y,b.z-_.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=cd(E,i)}setPitchBearing(t,i){this.orientation=oh(n.an(t),n.an(-i))}}class rf{constructor(t,i){this._transform=n.bz([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new n.ae(t[0],t[1],t[2])}get position(){const t=n.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&n.cf(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.c6([]),t&&ld(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=oh(t,i),ld(this._transform,this._orientation)}forward(){const t=n.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const f=new Float64Array(16);return n.bk(f,this.getWorldToCamera(t,i)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,f){const _=this.position;n.c4(_,_,-t);const w=new Float64Array(16);return n.bp(w,[f,f,f]),n.bq(w,w,_),w[10]*=i,w}getWorldToCamera(t,i){const f=new Float64Array(16),_=new Float64Array(4),w=this.position;return n.ca(_,this._orientation),n.c4(w,w,-t),n.cb(f,_),n.bq(f,f,w),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=i,f[9]*=i,f[10]*=i,f[11]*=i,f}getCameraToClipPerspective(t,i,f,_){const w=new Float64Array(16);return n.cc(w,t,i,f,_),w}getCameraToClipOrthographic(t,i,f,_,w,b){const E=new Float64Array(16);return n.cd(E,t,i,f,_,w,b),E}getDistanceToElevation(t,i=!1){const f=t===0?0:n.ce(t,i?n.a_(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new rf([...this.position],[...this.orientation])}}const _i={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ms{constructor(t=0,i=0,f=0,_=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=f,this.right=_}interpolate(t,i,f){return i.top!=null&&t.top!=null&&(this.top=n.ak(t.top,i.top,f)),i.bottom!=null&&t.bottom!=null&&(this.bottom=n.ak(t.bottom,i.bottom,f)),i.left!=null&&t.left!=null&&(this.left=n.ak(t.left,i.left,f)),i.right!=null&&t.right!=null&&(this.right=n.ak(t.right,i.right,f)),this}getCenter(t,i){const f=n.aA((this.left+t-this.right)/2,0,t),_=n.aA((this.top+i-this.bottom)/2,0,i);return new n.P(f,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ms(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Rc=15;class Tc{constructor(t,i,f,_,w,b,E){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(b),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new n.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ms,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new rf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Tc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Rc}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(t||f)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return n.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=n.cl(this.projectionOptions);const f=this.getProjection(),_=!n.bx(i,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.cl({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bS(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=n.cm(),n.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=n.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,w=0;for(let b=0;b<i.length;b++){const E=new n.P(i[b][0]*this.width,f+i[b][1]*(this.height-f)),A=t.pointCoordinate(E);if(!A)continue;const M=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);_+=A[3]*M,w+=M}return w===0?NaN:_/w}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*i,_=this._mercatorZfromZoom(t),w=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-f,w);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let f;f=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const _=n.ag(n.av([],this._camera.position,f));return n.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!n.co(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const f=[t.position.x,t.position.y,t.position.z];n.cp(f,this._camera.position)||(this._setCameraPosition(f),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new $s;return i.position=new n.ae(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!n.cq(t))return!1;n.cr(t,t);const i=n.cs([],[0,0,-1],t),f=n.cs([],[0,-1,0],t);if(f[2]<0)return!1;const _=cd(i,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=n.aA(t[2],_/f,_/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,f){this._unmodified=!1,this._edgeInsets.interpolate(t,i,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){const i=[new n.ct(0,t)];if(this.renderWorldCopies){const f=this.pointCoordinate(new n.P(0,0)),_=this.pointCoordinate(new n.P(this.width,0)),w=this.pointCoordinate(new n.P(this.width,this.height)),b=this.pointCoordinate(new n.P(0,this.height)),E=Math.floor(Math.min(f.x,_.x,w.x,b.x)),A=Math.floor(Math.max(f.x,_.x,w.x,b.x)),M=1;for(let I=E-M;I<=A+M;I++)I!==0&&i.push(new n.ct(I,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,i,f){let _=[];const w=f!=null,b=!w;if(b&&this.zoom<i||w&&f[0]===0&&f[1]===0)return _;const E=new Set,A=(I,C,J,U,H)=>{const q=n.cX(C,I,J,U,H);E.has(q)||(_.push(new n.aP(I,C,J,U,H)),E.add(q))};for(let I=0;I<t.length;I++){const C=t[I];if(b&&C.canonical.z!==i)continue;const J=C.canonical,U=C.overscaledZ,H=C.wrap,q=1<<J.z,ne=J.x+1<q,ae=J.x>0,se=J.y+1<q,he=J.y>0,ce=C.wrap-(ae?0:1),Ze=C.wrap+(ne?0:1),me=ae?J.x-1:q-1,Ne=ne?J.x+1:0;if(w)f[0]<0?(A(U,Ze,J.z,Ne,J.y),f[1]<0&&se&&(A(U,H,J.z,J.x,J.y+1),A(U,Ze,J.z,Ne,J.y+1)),f[1]>0&&he&&(A(U,H,J.z,J.x,J.y-1),A(U,Ze,J.z,Ne,J.y-1))):f[0]>0?(A(U,ce,J.z,me,J.y),f[1]<0&&se&&(A(U,H,J.z,J.x,J.y+1),A(U,ce,J.z,me,J.y+1)),f[1]>0&&he&&(A(U,H,J.z,J.x,J.y-1),A(U,ce,J.z,me,J.y-1))):f[1]<0&&se?A(U,H,J.z,J.x,J.y+1):he&&A(U,H,J.z,J.x,J.y-1);else{const we=C.visibleQuadrants;1&we&&(A(U,ce,J.z,me,J.y),he&&(A(U,H,J.z,J.x,J.y-1),A(U,ce,J.z,me,J.y-1))),2&we&&(A(U,Ze,J.z,Ne,J.y),he&&(A(U,H,J.z,J.x,J.y-1),A(U,Ze,J.z,Ne,J.y-1))),4&we&&(A(U,ce,J.z,me,J.y),se&&(A(U,H,J.z,J.x,J.y+1),A(U,ce,J.z,me,J.y+1))),8&we&&(A(U,Ze,J.z,Ne,J.y),se&&(A(U,H,J.z,J.x,J.y+1),A(U,Ze,J.z,Ne,J.y+1)))}}const M=[];for(const I of _)_.some(C=>I.isChildOf(C))||M.push(I);if(_=M.filter(I=>!t.some(C=>!!(I.overscaledZ<i&&C.isChildOf(I))||I.equals(C)||I.isChildOf(C))),b){const I=1<<i,C=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=[I*C.x,I*C.y],U=4,H=U*U;_=_.filter(q=>{const ne=q.canonical.x+.5-J[0],ae=q.canonical.y+.5-J[1];return ne*ne+ae*ae<H})}return _}extendTileCoverToNearPlane(t,i,f){const _=[],w=new Set;for(const se of t)w.add(se.key);const b=(se,he,ce,Ze,me)=>{const Ne=n.cX(he,se,ce,Ze,me);w.has(Ne)||(_.push(new n.aP(se,he,ce,Ze,me)),w.add(Ne))},E=t.reduce((se,he)=>Math.max(se,he.overscaledZ),f),A=1<<f,M=[new n.P(0,0),new n.P(n.al,0),new n.P(n.al,n.al),new n.P(0,n.al)],I=new n.P(0,0),C=new n.P(0,0),J=(se,he)=>{const ce=Math.floor(se[0]),Ze=Math.floor(se[1]),me=(se[0]-ce)*n.al,Ne=(se[1]-Ze)*n.al,we=Math.floor(he[0]),ge=Math.floor(he[1]),Se=(he[0]-we)*n.al,Pe=(he[1]-ge)*n.al;for(let Fe=-1;Fe<=1;Fe++){const it=ce+Fe;if(!(it<0||it>=A)){I.x=me-Fe*n.al,C.x=Se-(it-we)*n.al;for(let qe=-1;qe<=1;qe++){const dt=Ze+qe;I.y=Ne-qe*n.al,C.y=Pe-(dt-ge)*n.al,n.cY(I,C,M)&&b(E,0,f,it,dt)}}}},U=i.points,H=U[n.cu],q=U[n.cv],ne=this._projectToGround(H,U[n.cw]),ae=this._projectToGround(q,U[n.cx]);return J(H,ne),J(q,ae),_}_projectToGround(t,i){return n.cy(n.cz(),t,i,t[2]/(t[2]-i[2]))}coveringTiles(t){let i=this.coveringZoomLevel(t);const f=i,_=this.elevation&&this.elevation.exaggeration(),w=_&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);const E=this.locationCoordinate(this.center),A=this.center.lat,M=1<<i,I=[M*E.x,M*E.y,0],C=this.projection.name==="globe",J=!C,U=n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,J),H=C?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=M*n.ce(1,this.center.lat),ne=this._camera.position[2]/n.ce(1,this.center.lat),ae=[M*H.x,M*H.y,ne*(J?1:q)],se=C||_,he=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?i:0;let Ze;if(this._elevation&&t.isTerrainDEM)Ze=1e4*this._elevation.exaggeration();else if(this._elevation){const Ie=this._elevation.getMinMaxForVisibleTiles();Ze=Ie?Ie.max:this._centerAltitude}else Ze=this._centerAltitude;const me=t.isTerrainDEM?-Ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ne=this.projection.isReprojectedInTileSpace?n.cB(this):1,we=Ie=>{const et=new n.ae(Ie.x+25e-6,Ie.y,Ie.z),jt=new n.ae(Ie.x,Ie.y+25e-6,Ie.z),Ct=Ie.toLngLat(),oa=et.toLngLat(),Bt=jt.toLngLat(),Ot=this.locationCoordinate(Ct),la=this.locationCoordinate(oa),ra=this.locationCoordinate(Bt),Ht=Math.hypot(la.x-Ot.x,la.y-Ot.y),ia=Math.hypot(ra.x-Ot.x,ra.y-Ot.y);return Math.sqrt(Ht*ia)*Ne/25e-6},ge=Ie=>{const ct=Ze,et=me;return{aabb:n.cE(this,M,0,0,0,Ie,et,ct,this.projection),zoom:0,x:0,y:0,minZ:et,maxZ:ct,wrap:Ie,fullyVisible:!1}},Se=[];let Pe=[];const Fe=i,it=t.reparseOverscaled?f:i,qe=(ne-this._centerAltitude)*q,dt=Ie=>{if(!this._elevation||!Ie.tileID||!b)return;const ct=this._elevation.getMinMaxForTile(Ie.tileID),et=Ie.aabb;ct?(et.min[2]=ct.min,et.max[2]=ct.max,et.center[2]=(et.min[2]+et.max[2])/2):(Ie.shouldSplit=Xe(Ie),Ie.shouldSplit||(et.min[2]=et.max[2]=et.center[2]=this._centerAltitude))},Mt=(Ie,ct)=>{if(.707*ct<Ie)return 1;const et=ct/Ie;return et/(1.4144271570014144+(Math.pow(1.1,et-1.4144271570014144+1)-1)/(1.1-1)-1)},Xe=Ie=>{if(Ie.zoom<ce)return!0;if(Ie.zoom===Fe)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;const ct=Ie.aabb.distanceX(ae),et=Ie.aabb.distanceY(ae);let jt=qe,Ct=1;if(C){jt=Ie.aabb.distanceZ(ae);const ia=Math.pow(2,Ie.zoom),va=n.a_((Ie.y+1)/ia),ir=n.a_(Ie.y/ia),Oa=Math.min(Math.max(A,va),ir),Qr=n.d0(Oa)/n.d0(A);if(Ct=Oa===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Qr/this._mercatorScaleRatio),this.zoom<=n.cZ&&Ie.zoom===Fe-1&&Qr>=.9)return!0}else if(w&&(jt=Ie.aabb.distanceZ(ae)*q),this.projection.isReprojectedInTileSpace&&f<=5){const ia=Math.pow(2,Ie.zoom),va=we(new n.ae((Ie.x+.5)/ia,(Ie.y+.5)/ia));Ct=va>.85?1:va}if(!b&&!C){const ia=Math.sqrt(ct*ct+et*et+jt*jt);let va=(1<<Fe-Ie.zoom)*he*Ct;return va*=Mt(Math.max(jt,qe),ia),ia<va}let oa=Number.MAX_VALUE,Bt=0;const Ot=Ie.aabb.getCorners(),la=[];for(const ia of Ot){n.av(la,ia,ae),C||(w?la[2]*=q:la[2]=qe);const va=n.bI(la,this._camera.forward());va<oa&&(oa=va,Bt=Math.abs(la[2]))}let ra=(1<<Fe-Ie.zoom)*he*Ct;if(ra*=Mt(Math.max(Bt,qe),oa),oa<ra)return!0;const Ht=Ie.aabb.closestPoint(I);return Ht[0]===I[0]&&Ht[1]===I[1]};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)Se.push(ge(-Ie)),Se.push(ge(Ie));for(Se.push(ge(0));Se.length>0;){const Ie=Se.pop(),ct=Ie.x,et=Ie.y;let jt=Ie.fullyVisible;const Ct=()=>this.projection.name==="globe"&&(Ie.y===0||Ie.y===(1<<Ie.zoom)-1);if(!jt){let oa=se?Ie.aabb.intersects(U):Ie.aabb.intersectsFlat(U);if(oa===0&&Ct()){const Bt=new n.cC(Ie.zoom,ct,et);oa=n.cD(this,M,Bt,!0).intersects(U)}if(oa===0)continue;jt=oa===2}if(Ie.zoom!==Fe&&Xe(Ie))for(let oa=0;oa<4;oa++){const Bt=(ct<<1)+oa%2,Ot=(et<<1)+(oa>>1),la={aabb:b?Ie.aabb.quadrant(oa):n.cE(this,M,Ie.zoom+1,Bt,Ot,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:Bt,y:Ot,wrap:Ie.wrap,fullyVisible:jt,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};w&&!C&&(la.tileID=new n.aP(Ie.zoom+1===Fe?it:Ie.zoom+1,Ie.wrap,Ie.zoom+1,Bt,Ot),dt(la)),Se.push(la)}else{const oa=Ie.zoom===Fe?it:Ie.zoom;if(t.minzoom&&t.minzoom>oa)continue;let Bt=0;if(!jt){let Ht=se?Ie.aabb.intersectsPrecise(U):Ie.aabb.intersectsPreciseFlat(U);if(Ht===0&&Ct()){const ia=new n.cC(Ie.zoom,ct,et);Ht=n.cD(this,M,ia,!0).intersectsPrecise(U)}if(Ht===0)continue;if(t.calculateQuadrantVisibility)if(U.containsPoint(Ie.aabb.center))Bt=15;else for(let ia=0;ia<4;ia++)Ie.aabb.quadrant(ia).intersects(U)!==0&&(Bt|=1<<ia)}const Ot=I[0]-(.5+ct+(Ie.wrap<<Ie.zoom))*(1<<i-Ie.zoom),la=I[1]-.5-et,ra=Ie.tileID?Ie.tileID:new n.aP(oa,Ie.wrap,Ie.zoom,ct,et);t.calculateQuadrantVisibility&&(ra.visibleQuadrants=Bt),Pe.push({tileID:ra,distanceSq:Ot*Ot+la*la})}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,ct=this.horizonLineFromTop();Pe=Pe.filter(et=>{const jt=[0,0,0,1],Ct=[n.al,n.al,0,1],oa=this.calculateFogTileMatrix(et.tileID.toUnwrapped());n.aC(jt,jt,oa),n.aC(Ct,Ct,oa);const Bt=n.cF([],jt,Ct),Ot=n.cG([],jt,Ct),la=n.c_(Bt,Ot);if(la===0)return!0;let ra=!1;const Ht=this._elevation;if(Ht&&la>Ie&&ct!==0){const ia=this.calculateProjMatrix(et.tileID.toUnwrapped());let va;t.isTerrainDEM||(va=Ht.getMinMaxForTile(et.tileID)),va||(va={min:me,max:Ze});const ir=n.cH(this.rotation),Oa=[ir[0]*n.al,ir[1]*n.al,va.max];n.af(Oa,Oa,ia),ra=(1-Oa[1])*this.height*.5<ct}return la<Ie||ra})}return Pe.sort((Ie,ct)=>Ie.distanceSq-ct.distanceSq).map(Ie=>Ie.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const i=n.aA(t.lat,-n.cI,n.cI),f=this.projection.project(t.lng,i);return new n.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let f,_;const w=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;f=(i.x-w.x)/E,_=(i.y-w.y)/E}else{const E=this.pointCoordinate(i),A=this.pointCoordinate(w);f=E.x-A.x,_=E.y-A.y}const b=this.locationCoordinate(t);this.setLocation(new n.ae(b.x-f,b.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,i){return this.projection.locationPoint(this,t,i)}locationPoint3D(t,i){return this.projection.locationPoint(this,t,i,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,i){return this.coordinateLocation(this.pointCoordinate3D(t,i))}locationCoordinate(t,i){const f=i?n.ce(i,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new n.ae(_.x,_.y,f)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){const f=i??this._centerAltitude,_=[t.x,t.y,0,1],w=[t.x,t.y,1,1];n.aC(_,_,this.pixelMatrixInverse),n.aC(w,w,this.pixelMatrixInverse);const b=w[3];n.cJ(_,_,1/_[3]),n.cJ(w,w,1/b);const E=_[2],A=w[2];return{p0:_,p1:w,t:E===A?0:(f-E)/(A-E)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],f=[t.x,t.y,1,1];return n.aC(i,i,this.pixelMatrixInverse),n.aC(f,f,this.pixelMatrixInverse),n.cJ(i,i,1/i[3]),n.cJ(f,f,1/f[3]),i[2]=n.ce(i[2],this._center.lat)*this.worldSize,f[2]=n.ce(f[2],this._center.lat)*this.worldSize,n.cJ(i,i,1/this.worldSize),n.cJ(f,f,1/this.worldSize),new n.ax([i[0],i[1],i[2]],n.aw([],n.av([],f,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:f,t:_}=t,w=n.ce(i[2],this._center.lat),b=n.ce(f[2],this._center.lat);return new n.ae(n.ak(i[0],f[0],_)/this.worldSize,n.ak(i[1],f[1],_)/this.worldSize,n.ak(w,b,_))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t,i){if(!this.elevation)return this.pointCoordinate(t,i);let f=this.projection.pointCoordinate3D(this,t.x,t.y);if(f)return new n.ae(f[0],f[1],f[2]);let _=0,w=this.horizonLineFromTop();if(t.y>w)return this.pointCoordinate(t,i);const b=.02*w,E=t.clone();for(let A=0;A<10&&w-_>b;A++){E.y=n.ak(_,w,.66);const M=this.projection.pointCoordinate3D(this,E.x,E.y);M?(w=E.y,f=M):_=E.y}return f?new n.ae(f[0],f[1],f[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.cK)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const f=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,f+t.toAltitude(),1];return n.aC(_,_,this.pixelMatrix),_[3]>0?new n.P(_[0]/_[3],_[1]/_[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,w=this.pointLocation3D(new n.P(i,t)),b=this.pointLocation3D(new n.P(_,t)),E=this.pointLocation3D(new n.P(_,f)),A=this.pointLocation3D(new n.P(i,f));let M=Math.min(w.lng,b.lng,E.lng,A.lng),I=Math.max(w.lng,b.lng,E.lng,A.lng),C=Math.min(w.lat,b.lat,E.lat,A.lat),J=Math.max(w.lat,b.lat,E.lat,A.lat);const U=Math.pow(2,-this.zoom)/16*270,H=this.projection.name==="globe"?1:4,q=(ne,ae,se,he,ce)=>{const Ze=(ne+se)/2,me=(ae+he)/2,Ne=new n.P(Ze,me),{lng:we,lat:ge}=this.pointLocation3D(Ne),Se=Math.max(0,M-we,C-ge,we-I,ge-J);M=Math.min(M,we),I=Math.max(I,we),C=Math.min(C,ge),J=Math.max(J,ge),(ce<H||Se>U)&&(q(ne,ae,Ze,me,ce+1),q(Ze,me,se,he,ce+1))};if(q(i,t,_,t,1),q(_,t,_,f,1),q(_,f,i,f,1),q(i,f,i,t,1),this.projection.name==="globe"){const[ne,ae]=n.cL(this);ne?(J=90,I=180,M=-180):ae&&(C=-90,I=180,M=-180)}return new n.aI(new n.aS(M,C),new n.aS(I,J))}_getBoundsRectangular(t,i){const{top:f,left:_}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=new n.P(_,f),A=new n.P(b,f),M=new n.P(b,w),I=new n.P(_,w);let C=this.pointCoordinate(E,t),J=this.pointCoordinate(A,t);const U=this.pointCoordinate(M,i),H=this.pointCoordinate(I,i),q=(ne,ae)=>(ae.y-ne.y)/(ae.x-ne.x);return C.y>1&&J.y>=0?C=new n.ae((1-H.y)/q(H,C)+H.x,1):C.y<0&&J.y<=1&&(C=new n.ae(-H.y/q(H,C)+H.x,0)),J.y>1&&C.y>=0?J=new n.ae((1-U.y)/q(U,J)+U.x,1):J.y<0&&C.y<=1&&(J=new n.ae(-U.y/q(U,J)+U.x,0)),new n.aI().extend(this.coordinateLocation(C)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const i=t.visibleDemTiles.reduce((f,_)=>{if(_.dem){const w=_.dem.tree;f.min=Math.min(f.min,w.minimums[0]),f.max=Math.max(f.max,w.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.cI,this.maxLat=n.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.aF(this.minLng)*this.tileSize,this.worldMaxX=n.aF(this.maxLng)*this.tileSize,this.worldMinY=n.aJ(this.maxLat)*this.tileSize,this.worldMaxY=n.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){const i=t.key,f=this._distanceTileDataCache;if(f[i])return f[i];const _=t.canonical,w=1/this.height,b=this.cameraWorldSize,E=b/this.zoomScale(_.z),A=(_.x+Math.pow(2,_.z)*t.wrap)*E,M=_.y*E,I=this.point;I.x*=b/this.worldSize,I.y*=b/this.worldSize;const C=this.angle,J=Math.sin(-C),U=-Math.cos(-C);return f[i]={bearing:[J,U],center:[(I.x-A)*w,(I.y-M)*w],scale:E/n.al*w},f[i]}calculateFogTileMatrix(t){const i=t.key,f=this._fogTileMatrixCache;if(f[i])return f[i];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.aB(_,this.worldToFogMatrix,_),f[i]=new Float32Array(_),f[i]}calculateProjMatrix(t,i=!1,f=!1){const _=t.key;let w;if(w=f?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,w[_])return w[_];const b=this.calculatePosMatrix(t,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,n.aB(b,E,b),w[_]=new Float32Array(b),w[_]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,f=this._pixelsToTileUnitsCache;if(f[i])return f[i];const _=n.cM(t,this);return f[i]=_,f[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,i=n.bp([],[t,t,t]);return n.aB(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const i=n.ce(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(i),_=this._camera.forward(),w=n.ce(1,this._center.lat);f[2]/=w,_[2]/=w,n.aw(_,_);const b=t.raycast(f,_,t.exaggeration());if(b){const E=n.bG([],f,_,b),A=new n.ae(E[0],E[1],n.ce(E[2],n.a_(E[1]))),M=(A.z+n.ag([A.x-f[0],A.y-f[1],A.z-f[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,f=n.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),w=i.getAtPointOrZero(new n.ae(..._)),b=this.pixelsPerMeter/this.worldSize*w,E=this._minimumHeightOverTerrain(),A=_[2]-b;if(A<=E)if(A<0||t){const M=this.locationCoordinate(this._center,this._centerAltitude),I=[_[0],_[1],M.z-_[2]],C=n.ag(I);I[2]-=(E-A)/this._pixelsPerMercatorPixel;const J=n.ag(I);if(J===0)return;n.c4(I,I,C/J*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],M.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const J=this.center;return J.lat=n.aA(J.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(J.lng=n.aA(J.lng,this.minLng,this.maxLng)),this.center=J,void(this._constraining=!1)}const i=this._unmodified,{x:f,y:_}=this.point;let w=0,b=f,E=_;const A=this.width/2,M=this.height/2,I=this.worldMinY*this.scale,C=this.worldMaxY*this.scale;if(_-M<I&&(E=I+M),_+M>C&&(E=C-M),C-I<this.height&&(w=Math.max(w,this.height/(C-I)),E=(C+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const J=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,H=this.worldSize/2-(J+U)/2;b=(f+H+this.worldSize)%this.worldSize-H,b-A<J&&(b=J+A),b+A>U&&(b=U-A),U-J<this.width&&(w=Math.max(w,this.width/(U-J)),b=(U+J)/2)}b===f&&E===_||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(b,E))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.ce(1,this.center.lat)/n.ce(1,n.d1));const _=n.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,w);let E;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=ge*this.aspect,Pe=-Se,Fe=-ge;Se-=t.x,Pe-=t.x,ge+=t.y,Fe+=t.y,E=this._camera.getCameraToClipOrthographic(Pe,Se,Fe,ge,this._nearZ,this._farZ),((it,qe,dt,Mt)=>{for(let Xe=0;Xe<16;Xe++)it[Xe]=n.ak(qe[Xe],dt[Xe],Mt)})(E,E,A,n.c$(this.pitch>=Rc?1:this.pitch/Rc))}else E=A;const M=n.cO([],A,b);let I=n.cO([],E,b);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),Se=n.bz([]);n.bq(Se,Se,[ge.x*this.worldSize,ge.y*this.worldSize,0]),n.aB(Se,Se,n.cP(this)),n.bq(Se,Se,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),n.aB(I,I,Se),n.aB(M,M,Se),this.inverseAdjustmentMatrix=n.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cR([],I,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=I,this.invProjMatrix=n.bk(new Float64Array(16),this.projMatrix),i){const ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ge[8]=2*-t.x/this.width,ge[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.cO([],ge,b)}else this.expandedFarZProjMatrix=this.projMatrix;const C=n.bk([],E);this.frustumCorners=n.cS.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const J=new Float32Array(16);n.bz(J),n.cR(J,J,[1,-1,1]),n.cT(J,J,this._pitch),n.bA(J,J,this.angle);const U=n.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.by(U);const H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-t.x/this.width,U[9]=2*(t.y+H)/this.height,this.skyboxMatrix=n.aB(J,U,J);const q=this.point,ne=q.x,ae=q.y,se=this.width%2/2,he=this.height%2/2,ce=Math.cos(this.angle),Ze=Math.sin(this.angle),me=ne-Math.round(ne)+ce*se+Ze*he,Ne=ae-Math.round(ae)+ce*he+Ze*se,we=new Float64Array(I);if(n.bq(we,we,[me>.5?me-1:me,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=we,I=n.bB(),n.cR(I,I,[this.width/2,-this.height/2,1]),n.bq(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=n.bB(),n.cR(I,I,[1,-1,1]),n.bq(I,I,[-1,-1,0]),n.cR(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=n.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},I=n.bk(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cU(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.af(ge,ge,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,w=[t,t,i];n.c4(w,w,_),n.c4(f,f,-1),n.cV(f,f,w);const b=n.bB();n.bq(b,b,f),n.cR(b,b,w),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,_)}_computeCameraPosition(t){const i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*w,_.y/this.worldSize-f[1]*w,t/this.worldSize*this._centerAltitude-f[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=t[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(w=Math.min((i-f)/_,1)),this._camera.position=n.bG([],this._camera.position,t,w),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),w=n.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.an(this._maxPitch)),E=Math.max((t[2]-w)/Math.cos(f),b),A=this._zoomFromMercatorZ(E);n.bG(t,t,i,E),this._pitch=n.aA(f,n.an(this.minPitch),n.an(this.maxPitch)),this.angle=n.bS(_,-Math.PI,Math.PI),this._setZoom(n.aA(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,f=n.cK,_=0,w=1/0;for(;f-i>1e-6&&f>i;){const b=i+.5*(f-i),E=this.tileSize*Math.pow(2,b),A=this.getCameraToCenterDistance(this.projection,b,E),M=this.scaleZoom(A/(Math.max(0,t)*this.tileSize)),I=Math.abs(b-M);I<w&&(w=I,_=b),b<M?i=b:f=b}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const f=Math.min(t.x,i.x),_=Math.max(t.x,i.x),w=Math.min(t.y,i.y),b=Math.max(t.y,i.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new n.P(f,w),new n.P(_,b),new n.P(f,b),new n.P(_,w)],A=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const I of E){const C=this.pointRayIntersection(I);if(C.t<0)return!0;const J=this.rayIntersectionCoordinate(C);if(J.x<A||J.y<0||J.x>M||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,i){const f=n.ag(n.av([],this._camera.position,t)),_=this._zoomFromMercatorZ(f)+i;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([i,f,_],w){const b=[i,f,_,1];n.aC(b,b,w);const E=b[3]=Math.max(b[3],1e-6);return b[0]/=E,b[1]/=E,b[2]/=E,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,i=this.zoom,f=this.worldSize){const _=n.cN(t,i,this.width,this.height,1024),w=t.pixelSpaceConversion(this.center.lat,f,_);let b=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(b=n.ak(1,b,n.c$(this.pitch>=Rc?1:this.pitch/Rc))),b}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.aB(t,t,this.globeMatrix),t}getFrustum(t){return n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const nl=(h,t)=>{if(t>0&&h.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=h.transform,f=Math.max(Math.abs(i._zoom-(h.minCutoffZoom-1)),1),_=i.isLODDisabled(!1)?n.ah(60,45,i.pitch):n.ah(30,15,i.pitch),w=i._farZ-i._nearZ,b=t*i.height,E=((1-(A=_))*i.cameraToCenterDistance+A*(i._farZ+b))*f;var A;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(E-i._nearZ)/w,(E-b-i._nearZ)/w]}}},Ii={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class qp{constructor(t,i){this.aabb=t,this.lastCascade=i}}class Kp{add(t,i){const f=this.receivers[t.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],i.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],i.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],i.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],i.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],i.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],i.max[2])):this.receivers[t.key]=new qp(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,f){const _=n.d8.fromPoints(t.points);let w=0;for(const b in this.receivers){const E=this.receivers[b];if(!E||!_.intersectsAabb(E.aabb))continue;E.aabb.min=_.closestPoint(E.aabb.min),E.aabb.max=_.closestPoint(E.aabb.max);const A=E.aabb.getCorners();for(let M=0;M<f.length;M++){let I=!0;for(const C of A){const J=[C[0]*i,C[1]*i,C[2]];if(n.af(J,J,f[M].matrix),J[0]<-1||J[0]>1||J[1]<-1||J[1]>1){I=!1;break}}if(E.lastCascade=M,w=Math.max(w,M),I)break}}return w+1}}class lh{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Kp,this._depthMode=new ca(t.context.gl.LEQUAL,ca.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Ii,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Ii,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Ii,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const _=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((H,q)=>{const ne=f.style._mergedLayers[q];return H+(ne.hasShadowPass()&&!ne.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=f.context,b=Ii.shadowMapResolution,E=Ii.shadowMapResolution;if(this._cascades.length===0||Ii.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<Ii.cascadeCount;++H){const q=f._shadowMapDebug,ne=w.gl,ae=w.createFramebuffer(b,E,q,"texture"),se=new n.T(w,{width:b,height:E,data:null},ne.DEPTH_COMPONENT16);if(ae.depthAttachment.set(se.texture),q){const he=new n.T(w,{width:b,height:E,data:null},ne.RGBA8);ae.colorAttachment.set(he.texture)}this._cascades.push({framebuffer:ae,texture:se,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cA,scale:0})}}this.shadowDirection=em(i);let A=0;if(t.elevation){const H=t.elevation,q=[1e4,-1e4];H.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const ae=ne.dem.tree;q[0]=Math.min(q[0],ae.minimums[0]),q[1]=Math.max(q[1],ae.maximums[0])}),q[0]!==1e4&&(A=(q[1]-q[0])*H.exaggeration())}const M=1.5*t.cameraToCenterDistance,I=3*M,C=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){const q=this._cascades[H];let ne=t.height/50,ae=1;Ii.cascadeCount===1?ae=I:H===0?ae=M:(ne=M,ae=I);const[se,he]=tm(t,this.shadowDirection,ne,ae,Ii.shadowMapResolution,A);q.scale=t.scale,q.matrix=se,q.boundingSphereRadius=he,n.bk(C,q.matrix),q.frustum=n.cA.fromInvProjectionMatrix(C,1,0,!0),q.far=ae}const J=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[J].far,this._cascades[J].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ii.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ii.shadowMapResolution,this._uniformValues.u_shadowmap_0=_i.ShadowMap0,this._uniformValues.u_shadowmap_1=_i.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const U=f.transform.elevation;for(const H of this._groundShadowTiles){let q={min:0,max:0};if(U){const ne=U.getMinMaxForTile(H);ne&&(q=ne)}this.addShadowReceiver(H.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this.enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,Ii.shadowMapResolution,Ii.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){f.currentShadowCascade=w,_.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),_.clear({color:n.ao.white,depth:1});for(const b of t.order){const E=t._mergedLayers[b];if(!E.hasShadowPass()||E.isHidden(f.transform.zoom))continue;const A=t.getLayerSourceCache(E),M=A?i[A.id]:void 0;(E.type==="model"||M&&M.length)&&f.renderLayer(f,A,E,M)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,i=t.style,f=t.context,_=f.gl,w=i.directionalLight,b=i.ambientLight;if(!w||!b)return;const E=[],A=nl(t,t.longestCutoffRange);A.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const M=Bo(i,w,b),I=new ca(_.LEQUAL,ca.ReadOnly,t.depthRangeFor3D),C=new za({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const J of this._groundShadowTiles){const U=J.toUnwrapped(),H=t.isTileAffectedByFog(J),q=t.getOrCreateProgram("groundShadow",{defines:E,overrideFog:H});this.setupShadows(U,q),t.uploadCommonUniforms(f,q,U,null,A);const ne={u_matrix:t.transform.calculateProjMatrix(U),u_ground_shadow_factor:M};q.draw(t,_.TRIANGLES,I,C,Ya.multiply,Ba.disabled,ne,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ya.unblended:Ya.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,f=i.calculatePosMatrix(t,i.worldSize);return n.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(t){const i=n.by(t);return n.aB(i,this._cascades[this.painter.currentShadowCascade].matrix,t),i}setupShadows(t,i,f){if(!this.enabled)return;const _=this.painter.transform,w=this.painter.context,b=w.gl,E=this._uniformValues,A=new Float64Array(16),M=_.calculatePosMatrix(t,_.worldSize);for(let I=0;I<this._cascades.length;I++)n.aB(A,this._cascades[I].matrix,M),E[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),w.activeTexture.set(b.TEXTURE0+_i.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){const I=n.d6(t.canonical),C=2/_.tileSize*n.al/Ii.shadowMapResolution,J=C*this._cascades[0].boundingSphereRadius,U=C*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(f==="vector-tile"?1:3)*function(q,ne,ae,se,he){const ce=n.aA((q-22)/-22,0,1);return .125*(1-ce)+4*ce}(_.zoom);E.u_shadow_normal_offset=[I,J*H,U*H],E.u_shadow_bias=[1e-4,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(w,E)}setupShadowsFromMatrix(t,i,f=!1){if(!this.enabled)return;const _=this.painter.context,w=_.gl,b=this._uniformValues,E=new Float64Array(16);for(let A=0;A<Ii.cascadeCount;A++)n.aB(E,this._cascades[A].matrix,t),b[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),_.activeTexture.set(w.TEXTURE0+_i.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=f,f){const A=Ii.normalOffset;b.u_shadow_normal_offset=[1,A,A],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(_,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,f,_){if(_[2]>=0)return{};const w=function(A,M,I){const C=I/(1<<A.canonical.z);return new n.d8([A.canonical.x*C+A.wrap*I,A.canonical.y*C+A.wrap*I,0],[(A.canonical.x+1)*C+A.wrap*I,(A.canonical.y+1)*C+A.wrap*I,M])}(t,i,f).getCorners(),b=i/-_[2];_[0]<0?(n.d7(w[0],w[0],[_[0]*b,0,0]),n.d7(w[3],w[3],[_[0]*b,0,0])):_[0]>0&&(n.d7(w[1],w[1],[_[0]*b,0,0]),n.d7(w[2],w[2],[_[0]*b,0,0])),_[1]<0?(n.d7(w[0],w[0],[0,_[1]*b,0]),n.d7(w[1],w[1],[0,_[1]*b,0])):_[1]>0&&(n.d7(w[2],w[2],[0,_[1]*b,0]),n.d7(w[3],w[3],[0,_[1]*b,0]));const E={};return E.vertices=w,E.planes=[Vc(w[1],w[0],w[4]),Vc(w[2],w[1],w[5]),Vc(w[3],w[2],w[6]),Vc(w[0],w[3],w[7])],E}addShadowReceiver(t,i,f){this._receivers.add(t,n.d8.fromTileIdAndHeight(t,i,f))}getMaxCascadeForTile(t){const i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function Vc(h,t,i){const f=n.av([],i,t),_=n.av([],h,t),w=n.bH([],f,_),b=n.ag(w);return b===0?[0,0,1,0]:(n.c4(w,w,1/b),[w[0],w[1],w[2],-n.bI(w,t)])}function em(h){const t=h.properties.get("direction"),i=n.d3(t.x,t.y,t.z);i[2]=n.aA(i[2],0,75);const f=n.d5([i[0],i[1],i[2]]);return n.d4(f.x,f.y,f.z)}function Bo(h,t,i){const f=t.properties.get("color-use-theme")==="none",_=t.properties.get("color"),w=t.properties.get("intensity"),b=t.properties.get("direction"),E=[b.x,b.y,b.z],A=i.properties.get("color-use-theme")==="none",M=i.properties.get("color"),I=i.properties.get("intensity"),C=Math.max(n.bI([0,0,1],E),0),J=[0,0,0];n.c4(J,M.toPremultipliedRenderColor(A?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),I);const U=[0,0,0];return n.c4(U,_.toPremultipliedRenderColor(f?null:h.getLut(i.scope)).toArray01Linear().slice(0,3),C*w),n.da([J[0]>0?J[0]/(J[0]+U[0]):0,J[1]>0?J[1]/(J[1]+U[1]):0,J[2]>0?J[2]/(J[2]+U[2]):0])}function tm(h,t,i,f,_,w){const b=h.zoom,E=h.scale,A=h.worldSize,M=1/A,I=h.aspect,C=Math.sqrt(1+I*I)*Math.tan(.5*h.fovX),J=C*C,U=f-i,H=f+i;let q,ne;J>U/H?(q=f,ne=f*C):(q=.5*H*(1+J),ne=.5*Math.sqrt(U*U+2*(f*f+i*i)*J+H*H*J*J));const ae=h.projection.pixelsPerMeter(h.center.lat,A),se=h._camera.getCameraToWorldMercator(),he=[0,0,-q*M];n.af(he,he,se);let ce=ne*M;const Ze=h._edgeInsets;if(!(Ze.left===0&&Ze.top===0&&Ze.right===0&&Ze.bottom===0||Ze.left===Ze.right&&Ze.top===Ze.bottom)){const jt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?ae:1),Ct=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,i,f);Ct[8]=2*-h.centerOffset.x/h.width,Ct[9]=2*h.centerOffset.y/h.height;const oa=new Float64Array(16);n.cO(oa,Ct,jt);const Bt=new Float64Array(16);n.bk(Bt,oa);const Ot=n.cA.fromInvProjectionMatrix(Bt,A,b,!0);for(const la of Ot.points){const ra=((me=la)[0]/=E,me[1]/=E,me[2]=n.ce(me[2],h._center.lat),me);ce=Math.max(ce,n.c5(n.d9([],he,ra)))}}var me;ce*=_/(_-1);const Ne=Math.acos(t[2]),we=Math.atan2(-t[0],-t[1]),ge=new rf;ge.position=he,ge.setPitchBearing(Ne,we);const Se=ge.getWorldToCamera(A,ae),Pe=ce*A,Fe=Math.min(h._mercatorZfromZoom(17)*A*-2,-2*Pe),it=ge.getCameraToClipOrthographic(-Pe,Pe,-Pe,Pe,Fe,(Pe+w*ae)/t[2]),qe=new Float64Array(16);n.aB(qe,it,Se);const dt=n.d4(Math.floor(1e6*he[0])/1e6*A,Math.floor(1e6*he[1])/1e6*A,0),Mt=.5*_,Xe=[0,0,0];n.af(Xe,dt,qe),n.c4(Xe,Xe,Mt);const Ie=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],ct=[0,0,0];n.av(ct,Xe,Ie),n.c4(ct,ct,-1/Mt);const et=new Float64Array(16);return n.bz(et),n.bq(et,et,ct),n.aB(qe,et,qe),[qe,Pe]}class qs extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,i){return n.db(this.requestManager.transformRequest(i,n.R.Model).url).then(f=>{if(!f)return;const _=n.dc(f),w=new n.dd(t,i,void 0,void 0,_);return w.computeBoundsAndApplyParent(),w}).catch(f=>{if(f&&f.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${t} from ${i}: ${f.message}`)))})}load(t,i,f={forceReload:!1}){this.models[i]||(this.models[i]={});const _=Object.keys(t),w=[],b=[];for(const E of _){const A=t[E];this.hasURLBeenRequested(A)&&!f.forceReload||(this.modelByURL[A]={modelId:E,scope:i},w.push(this.loadModel(E,A)),b.push(E)),this.models[i][E]||(this.models[i][E]={model:null,numReferences:1})}this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+b.length,Promise.allSettled(w).then(E=>{for(let A=0;A<E.length;A++){const{status:M}=E[A];if(M==="rejected")continue;const{value:I}=E[A];this.models[i][b[A]]||(this.models[i][b[A]]={model:null,numReferences:1}),this.models[i][b[A]].model=I}this.numModelsLoading[i]-=b.length,this.fire(new n.z("data",{dataType:"style"}))}).catch(E=>{this.fire(new n.y(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(t,i):this.getModelByURL(this.modelUris[i][t]))}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]?this.models[i][t].model:void 0}getModelByURL(t){if(!t)return null;const i=this.modelByURL[t];return i?this.models[i.scope][i.modelId].model:null}hasModelBeenAdded(t,i){return this.models[i]&&this.models[i][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,i,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const _=this.requestManager.normalizeModelURL(i);if((this.hasModel(t,f,{exactIdMatch:!0})||this.hasModelBeenAdded(t,f))&&this.modelUris[f][t]===_)this.models[f][t].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:w,modelId:b}=this.modelByURL[_];this.models[w][b].numReferences++}else this.modelUris[f][t]=_,this.load({[t]:this.modelUris[f][t]},f)}addModelURLs(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const f=this.modelUris[i];for(const _ in t)f[_]=this.requestManager.normalizeModelURL(t[_])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const f={};for(const _ of t)this.hasModel(_,i,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[i][_].numReferences++:this.modelUris[i][_]&&!this.hasURLBeenRequested(_)?f[_]=this.modelUris[i][_]:!this.hasURLBeenRequested(_)&&n.de(_,!1)&&(this.modelUris[i][_]=this.requestManager.normalizeModelURL(_),f[_]=this.modelUris[i][_]);this.load(f,i)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,i,f=!1,_=!1){if(this.models[i]&&this.models[i][t]&&(this.models[i][t].numReferences--,this.models[i][t].numReferences===0||_)){const w=this.modelUris[i][t];f||delete this.modelUris[i][t],delete this.modelByURL[w];const b=this.models[i][t].model;if(!b)return;delete this.models[i][t],b.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const i of Object.keys(this.models[t])){const f=this.models[t][i].model;delete this.models[t][i],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(const f in this.models[i])this.models[i][f].model&&this.models[i][f].model.upload(t.context)}}const ec=n.a6.colorTheme,tc=new n.a9({data:new n.aa(ec.data)});function am(h){if(!h.metadata||!h.metadata.content_area)return;const t=n.o.devicePixelRatio,{left:i,top:f,width:_,height:w}=h.metadata.content_area,b=i*t,E=f*t;return[b,E,b+_*t,E+w*t]}function ap(h){if(h)return h.map(([t,i])=>[t*n.o.devicePixelRatio,i*n.o.devicePixelRatio])}class rm{constructor(t,i,f){this.id=t,this.scope=i,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const i=this.sourceCache.getVisibleCoordinates();if(i.length===0)return t;const f=this.sourceCache.getSource();if(!(f instanceof Ni))return t;const _=i.map(b=>this.sourceCache.getTile(b)),w=f.getImages(_,Array.from(this.pendingRequests));for(const[b,E]of w)t.set(n.I.from({name:b,iconsetId:this.id}),E),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),t}}const zl=(h,t)=>te(h,t&&t.filter(i=>i.identifier!=="source.canvas")),dy=n.aH(zr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),rp=n.aH(zr,["setCenter","setZoom","setBearing","setPitch"]),ac=new Set(["background","sky","slot","custom"]),ch={version:8,layers:[],sources:{}},du={duration:300,delay:0};class Ks extends n.E{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=Object.assign({},du),this._buildingIndex=new $h(this),this.crossTileSymbolIndex=new Sl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=i.styleChanges||new Xr,this.dispatcher=i.dispatcher?i.dispatcher:new n.D(n.dg(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new rn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new n.dh(t._requestManager,i.localFontFamily?n.di.all:i.localIdeographFontFamily?n.di.ideographs:n.di.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new qs(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._indoorDependentLayers=i.indoorDependentLayers?i.indoorDependentLayers:new Set,this._config=i.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:i.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",n.dj());const f=this;this._rtlTextPluginCallback=Ks.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(w,b)=>{if(n.dk(w),b&&b.every(E=>E))for(const E in f._sourceCaches){const A=f._sourceCaches[E],M=A.getSource().type;M!=="vector"&&M!=="geojson"||A.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const w=this.getOwnSource(_.sourceId);if(w&&w.vectorLayerIds)for(const b in this._layers){const E=this._layers[b];E.source===w.id&&this._validateLayer(E)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.h(t))return t;const i=n.dl(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch{return i}return i}return`json://${n.dm(JSON.stringify(t))}`}_diffStyle(t,i,f){this.globalId=this._getGlobalId(t);const _=(w,b)=>{try{b(null,this.setState(w,f))}catch(E){b(E,!1)}};if(typeof t=="string"){const w=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(w,n.R.Style);n.m(b,(E,A)=>{E?this.fire(new n.y(E)):A&&_(A,i)})}else typeof t=="object"&&_(t,i)}loadURL(t,i={}){this.fire(new n.z("dataloading",{dataType:"style"}));const f=typeof i.validate=="boolean"?i.validate:!n.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const _=this.importsCache.get(t);if(_)return this._load(_,f);const w=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.m(w,(b,E)=>{if(this._request=null,b)this.fire(new n.y(b));else if(E)return this.importsCache.set(t,E),this._load(E,f)})}loadJSON(t,i={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.o.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load(ch,!1)}_loadImports(t,i,f){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const w of t){const b=this._createFragmentStyle(w),E=new Promise(I=>{b.once("style.import.load",I),b.once("error",I)}).then(()=>this.mergeAll());if(_.push(E),this.resolvedImports.has(w.url)){b.loadEmpty();continue}const A=w.data||this.importsCache.get(w.url);A?(b.loadJSON(A,{validate:i}),this._isInternalStyle(A)&&(b.globalId=null)):w.url?b.loadURL(w.url,{validate:i}):b.loadEmpty();const M={style:b,id:w.id,config:w.config};if(f){const I=this.fragments.findIndex(({id:C})=>C===f);this.fragments=this.fragments.slice(0,I).concat(M).concat(this.fragments.slice(I))}else this.fragments.push(M)}return Promise.allSettled(_)}getImportGlobalIds(t=this,i=new Set){for(const f of t.fragments)f.style.globalId&&i.add(f.style.globalId),this.getImportGlobalIds(f.style,i);return[...i.values()]}_createFragmentStyle(t){const i=this.scope?n.B(t.id,this.scope):t.id;let f;const _=this._initialConfig&&this._initialConfig[i];(t.config||_)&&(f=Object.assign({},t.config,_));const w=new Ks(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,i){if(this._isInternalStyle(t)){const w=Object.assign({},ch,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(w,i)}if(this.updateConfig(this._config,t.schema),i&&zl(this,Ws(t)))return;this._loaded=!0,this.stylesheet=n.dn(t);const f=()=>{for(const A in t.sources)this.addSource(A,t.sources[A],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const A in t.iconsets)this.addIconset(A,t.iconsets[A]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const w=iu(this.stylesheet.layers);if(this._order=w.map(A=>A.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new Ve(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ve(this.stylesheet.light)),this._layers={};for(const A of w){const M=n.dt(A,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;const I=this.getOwnLayerSourceCache(M),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&M.canCastShadows()&&C&&(I.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const b=this.stylesheet.terrain;b&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));const E=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then(()=>{this._reloadImports(),this.fire(new n.z(E?"style.load":"style.import.load"))}).catch(A=>{this.fire(new n.y(new Error("Failed to load imports",A))),this.fire(new n.z(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.z(E?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const w=this._evaluateColorThemeData(_);this._loadColorTheme(w).then(()=>{f()}).catch(b=>{n.w(`Couldn't load color theme from the stylesheet: ${b}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let t,i,f,_,w,b,E,A,M,I;const C={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(J=>{if(J.stylesheet){if(J.light!=null&&(t=J.light),J.stylesheet.lights)for(const U of J.stylesheet.lights)U.type==="ambient"&&J.ambientLight!=null&&(i=J.ambientLight),U.type==="directional"&&J.directionalLight!=null&&(f=J.directionalLight);_=this._prioritizeTerrain(_,J.terrain,J.stylesheet.terrain),J.stylesheet.fog&&J.fog!=null&&(w=J.fog),J.stylesheet.snow&&J.snow!=null&&(b=J.snow),J.stylesheet.rain&&J.rain!=null&&(E=J.rain),J.stylesheet.camera!=null&&(I=J.stylesheet.camera),J.stylesheet.projection!=null&&(A=J.stylesheet.projection),J.stylesheet.transition!=null&&(M=J.stylesheet.transition),C[J.scope]=J._styleColorTheme}}),this.light=t,this.ambientLight=i,this.directionalLight=f,this.fog=w,this.snow=b,this.rain=E,this._styleColorThemeForScope=C,_===null?delete this.terrain:this.terrain=_,this.camera=I||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=Object.assign({},du,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const i=f=>{for(const _ of f.fragments)i(_.style);t(f)};i(this)}_prioritizeTerrain(t,i,f){const _=t&&t.drapeRenderMode===0;return f===null?i&&i.drapeRenderMode===0?i:_?t:null:i!=null&&(!t||_||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},i={},f={};this.forEachFragmentStyle(_=>{for(const w in _._sourceCaches){const b=n.B(w,_.scope);t[b]=_._sourceCaches[w]}for(const w in _._otherSourceCaches){const b=n.B(w,_.scope);i[b]=_._otherSourceCaches[w]}for(const w in _._symbolSourceCaches){const b=n.B(w,_.scope);f[b]=_._symbolSourceCaches[w]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=f}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const i of Object.values(t.stylesheet.indoor)){const f=i,_=n.B(f.sourceId,t.scope);this._mergedIndoor[_]=new Set(f.sourceLayers||[])}})}mergeLayers(){const t={},i=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const E of b._order){const A=b._layers[E];if(A.type==="slot"){const M=n.dp(E);if(t[M])continue;t[M]=[]}A.slot&&t[A.slot]?t[A.slot].push(A):i.push(A)}}),this._mergedOrder=[];let _=-1;const w=(b=[])=>{for(const E of b)if(E.type==="slot"){const A=n.dp(E.id);t[A]&&w(t[A]),this._mergedSlots.push(A)}else{const A=n.B(E.id,E.scope);this._mergedOrder.push(A),f[A]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};if(w(i),this._has3DLayers){const b={};for(let E=0;E<this._mergedOrder.length;++E){const A=this._mergedOrder[E];b[A]=E===_?1:E<_?f[A].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((E,A)=>b[E]-b[A])}this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(i,f,_,w){const b=Object.assign({},f);for(const A of Object.keys(ec))b[A]===void 0&&(b[A]=ec[A].default);const E=new n.a8(tc,i,new Map(_));return E.setTransitionOrValue(b,_),E.untransitioned().possiblyEvaluate(new n.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{const w="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let b=t;b.startsWith(w)||(b=w+b);const E=n.I.from("mapbox-reserved-lut"),A=new Image;A.src=b,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void f();this._styleColorTheme.lutLoading=!1;const{width:M,height:I,data:C}=n.o.getImageData(A);if(I>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==I*I)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new n.q({width:M,height:I},C),pixelRatio:1,sdf:!1,usvg:!1,version:0});const J=this.imageManager.getImage(E,this.scope);J?(this._styleColorTheme.lut={image:J.data,data:t},f()):_(new Error("Missing LUT image."))}})}getLut(t){const i=this._styleColorThemeForScope[t];return i?i.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,f,_){let w,b,E;const A=n.o.devicePixelRatio>1?"@2x":"";let M=n.m(f.transformRequest(f.normalizeSpriteURL(i,A,".json"),n.R.SpriteJSON),(J,U)=>{M=null,E||(E=J,w=U,C())}),I=n.n(f.transformRequest(f.normalizeSpriteURL(i,A,".png"),n.R.SpriteImage),(J,U)=>{I=null,E||(E=J,b=U,C())});function C(){if(E)_(E);else if(w&&b){const J=n.o.getImageData(b),U={};for(const H in w){const{width:q,height:ne,x:ae,y:se,sdf:he,pixelRatio:ce,stretchX:Ze,stretchY:me,content:Ne}=w[H],we=new n.q({width:q,height:ne});n.q.copy(J,we,{x:ae,y:se},{x:0,y:0},{width:q,height:ne},null),U[H]={data:we,pixelRatio:ce!==void 0?ce:1,sdf:he!==void 0&&he,stretchX:Ze,stretchY:me,content:Ne,usvg:!1,version:0}}_(null,U)}}return{cancel(){M&&(M.cancel(),M=null),I&&(I.cancel(),I=null)}}}(t,this.map._requestManager,(i,f)=>{if(this._spriteRequest=null,i)this.fire(new n.y(i));else if(f){const _=new Map;for(const w in f)_.set(n.I.from(w),f[w]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))})}addIconset(t,i){if(i.type==="sprite")return void this._loadSprite(i.url);const f=this.getOwnSourceCache(i.source);if(!f)return void this.fire(new n.y(new Error(`Source "${i.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const _=f.getSource();if(_.type!=="raster-array")return void this.fire(new n.y(new Error(`Source "${i.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const w=new rm(t,this.scope,f);this.imageManager.addImageProvider(w,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!n.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const i=this.map._spriteFormat==="auto";var f,_;this._spriteRequest=(_=(w,b)=>{if(this._spriteRequest=null,w)i?this._loadSprite(t):this.fire(new n.y(w));else if(b){const E=new Map;for(const A in b)E.set(n.I.from(A),b[A]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bt((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(t),n.R.Iconset),(w,b)=>{if(w)return void _(w);const E={},A=n.df(new n.bs(b));for(const M of A.icons){const I={version:1,pixelRatio:n.o.devicePixelRatio,content:am(M),stretchX:M.metadata?ap(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?ap(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};E[M.name]=I}_(null,E)}))}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const f=t.sourceLayer;f&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(f)===-1)&&this.fire(new n.y(new Error(`Source layer "${f}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{const f=this.fragments[i];return f&&f.style&&(t.data=f.style.serialize()),t})}_serializeSources(){const t={};for(const i in this._sourceCaches){const f=this._sourceCaches[i].getSource();t[f.id]||(t[f.id]=f.serialize())}return t}_serializeLayers(t){const i=[];for(const f of t){const _=this._layers[f];_&&_.type!=="custom"&&i.push(_.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new n.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new n.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,i){const f=this.map.painter;if(f)for(let _=t.minzoom||0;_<(t.maxzoom||25.5);_++){const w=t.getProgramIds();if(w)for(const b of w){const E=t.getDefaultProgramParams(b,i.zoom,this._styleColorTheme.lut);E&&(f.style=this,this.fog&&(f._fogVisible=!0,E.overrideFog=!0,f.getOrCreateProgram(b,E)),f._fogVisible=!1,E.overrideFog=!1,f.getOrCreateProgram(b,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,f.getOrCreateProgram(b,E)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const f=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const A in E){const{updatedIds:M,removedIds:I}=E[A];(M||I)&&(this._updateWorkerLayers(A,M,I),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const w={};for(const E in this._mergedSourceCaches){const A=this._mergedSourceCaches[E];w[E]=A.used,A.used=!1,A.tileCoverLift=0}for(const E of this._mergedOrder){const A=this._mergedLayers[E];if(A.recalculate(t,this._availableImages),!A.isHidden(t.zoom)){const M=this.getLayerSourceCache(A);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,t)}):this.precompilePrograms(A,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const E of b)E.sourceCache.used=!0;for(const E in w){const A=this._mergedSourceCaches[E];w[E]!==A.used&&A.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new n.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const i of t){const f=i.resolvePendingRequests(),_=this.getFragmentStyle(i.scope);_&&_.addImages(f)}}_updateTilesForChangedImages(){const t={};for(const i in this._mergedSourceCaches){const f=this._mergedSourceCaches[i].getSource().scope;t[f]=t[f]||this._changes.getUpdatedImages(f),t[f].length!==0&&this._mergedSourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t[f])}for(const i in t)this._changes.resetUpdatedImages(i)}_updateWorkerLayers(t,i,f){const _=this.getFragmentStyle(t);_&&this.dispatcher.broadcast("updateLayers",{layers:i?_._serializeLayers(i):[],scope:t,removedIds:f||[],options:_.options})}setState(t,i){if(this._checkLoaded(),zl(this,Ws(t)))return!1;(t=n.dn(t)).layers=iu(t.layers);const f=function(b,E){if(!b)return[{command:zr.setStyle,args:[E]}];let A=[];try{if(!n.bx(b.version,E.version))return[{command:zr.setStyle,args:[E]}];if(n.bx(b.center,E.center)||A.push({command:zr.setCenter,args:[E.center]}),n.bx(b.zoom,E.zoom)||A.push({command:zr.setZoom,args:[E.zoom]}),n.bx(b.bearing,E.bearing)||A.push({command:zr.setBearing,args:[E.bearing]}),n.bx(b.pitch,E.pitch)||A.push({command:zr.setPitch,args:[E.pitch]}),n.bx(b.sprite,E.sprite)||A.push({command:zr.setSprite,args:[E.sprite]}),n.bx(b.glyphs,E.glyphs)||A.push({command:zr.setGlyphs,args:[E.glyphs]}),n.bx(b.imports,E.imports)||function(U=[],H=[],q){H=H||[];const ne=(U=U||[]).map(Kd),ae=H.map(Kd),se=U.reduce(ou,{}),he=H.reduce(ou,{}),ce=ne.slice();let Ze,me,Ne,we;for(Ze=0,me=0;Ze<ne.length;Ze++)Ne=ne[Ze],he.hasOwnProperty(Ne)?me++:(q.push({command:zr.removeImport,args:[Ne]}),ce.splice(ce.indexOf(Ne,me),1));for(Ze=0,me=0;Ze<ae.length;Ze++)Ne=ae[ae.length-1-Ze],ce[ce.length-1-Ze]!==Ne&&(se.hasOwnProperty(Ne)?(q.push({command:zr.removeImport,args:[Ne]}),ce.splice(ce.lastIndexOf(Ne,ce.length-me),1)):me++,we=ce[ce.length-Ze],q.push({command:zr.addImport,args:[he[Ne],we]}),ce.splice(ce.length-Ze,0,Ne));for(const ge of H){const Se=se[ge.id];Se&&(delete Se.data,n.bx(Se,ge)||q.push({command:zr.updateImport,args:[ge.id,ge]}))}}(b.imports,E.imports,A),n.bx(b.transition,E.transition)||A.push({command:zr.setTransition,args:[E.transition]}),n.bx(b.light,E.light)||A.push({command:zr.setLight,args:[E.light]}),n.bx(b.fog,E.fog)||A.push({command:zr.setFog,args:[E.fog]}),n.bx(b.snow,E.snow)||A.push({command:zr.setSnow,args:[E.snow]}),n.bx(b.rain,E.rain)||A.push({command:zr.setRain,args:[E.rain]}),n.bx(b.projection,E.projection)||A.push({command:zr.setProjection,args:[E.projection]}),n.bx(b.lights,E.lights)||A.push({command:zr.setLights,args:[E.lights]}),n.bx(b.camera,E.camera)||A.push({command:zr.setCamera,args:[E.camera]}),n.bx(b.iconsets,E.iconsets)||function(U,H,q){let ne;for(ne in H=H||{},U=U||{})U.hasOwnProperty(ne)&&(H.hasOwnProperty(ne)||q.push({command:zr.removeIconset,args:[ne]}));for(ne in H){if(!H.hasOwnProperty(ne))continue;const ae=H[ne];U.hasOwnProperty(ne)?n.bx(U[ne],ae)||(q.push({command:zr.removeIconset,args:[ne]}),q.push({command:zr.addIconset,args:[ne,ae]})):q.push({command:zr.addIconset,args:[ne,ae]})}}(b.iconsets,E.iconsets,A),!n.bx(b["color-theme"],E["color-theme"]))return[{command:zr.setStyle,args:[E]}];const M={},I=[];(function(U,H,q,ne){let ae;for(ae in H=H||{},U=U||{})U.hasOwnProperty(ae)&&(H.hasOwnProperty(ae)||Yl(ae,q,ne));for(ae in H){if(!H.hasOwnProperty(ae))continue;const se=H[ae];U.hasOwnProperty(ae)?n.bx(U[ae],se)||(U[ae].type==="geojson"&&se.type==="geojson"&&td(U,H,ae)?q.push({command:zr.setGeoJSONSourceData,args:[ae,se.data]}):jl(ae,H,q,ne)):su(ae,H,q)}})(b.sources,E.sources,I,M);const C=[];b.layers&&b.layers.forEach(U=>{U.source&&M[U.source]?A.push({command:zr.removeLayer,args:[U.id]}):C.push(U)});let J=b.terrain;J&&M[J.source]&&(A.push({command:zr.setTerrain,args:[void 0]}),J=void 0),A=A.concat(I),n.bx(J,E.terrain)||A.push({command:zr.setTerrain,args:[E.terrain]}),function(U,H,q){H=H||[];const ne=(U=U||[]).map(Kd),ae=H.map(Kd),se=U.reduce(ou,{}),he=H.reduce(ou,{}),ce=ne.slice(),Ze=Object.create(null);let me,Ne,we,ge,Se,Pe,Fe;for(me=0,Ne=0;me<ne.length;me++)we=ne[me],he.hasOwnProperty(we)?Ne++:(q.push({command:zr.removeLayer,args:[we]}),ce.splice(ce.indexOf(we,Ne),1));for(me=0,Ne=0;me<ae.length;me++)we=ae[ae.length-1-me],ce[ce.length-1-me]!==we&&(se.hasOwnProperty(we)?(q.push({command:zr.removeLayer,args:[we]}),ce.splice(ce.lastIndexOf(we,ce.length-Ne),1)):Ne++,Pe=ce[ce.length-me],q.push({command:zr.addLayer,args:[he[we],Pe]}),ce.splice(ce.length-me,0,we),Ze[we]=!0);for(me=0;me<ae.length;me++)if(we=ae[me],ge=se[we],Se=he[we],!Ze[we]&&!n.bx(ge,Se))if(n.bx(ge.source,Se.source)&&n.bx(ge["source-layer"],Se["source-layer"])&&n.bx(ge.type,Se.type)){for(Fe in qd(ge.layout,Se.layout,q,we,null,zr.setLayoutProperty),qd(ge.paint,Se.paint,q,we,null,zr.setPaintProperty),n.bx(ge.slot,Se.slot)||q.push({command:zr.setSlot,args:[we,Se.slot]}),n.bx(ge.filter,Se.filter)||q.push({command:zr.setFilter,args:[we,Se.filter]}),n.bx(ge.minzoom,Se.minzoom)&&n.bx(ge.maxzoom,Se.maxzoom)||q.push({command:zr.setLayerZoomRange,args:[we,Se.minzoom,Se.maxzoom]}),ge)ge.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?qd(ge[Fe],Se[Fe],q,we,Fe.slice(6),zr.setPaintProperty):n.bx(ge[Fe],Se[Fe])||q.push({command:zr.setLayerProperty,args:[we,Fe,Se[Fe]]}));for(Fe in Se)Se.hasOwnProperty(Fe)&&!ge.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?qd(ge[Fe],Se[Fe],q,we,Fe.slice(6),zr.setPaintProperty):n.bx(ge[Fe],Se[Fe])||q.push({command:zr.setLayerProperty,args:[we,Fe,Se[Fe]]}))}else q.push({command:zr.removeLayer,args:[we]}),Pe=ce[ce.lastIndexOf(we)+1],q.push({command:zr.addLayer,args:[Se,Pe]})}(C,E.layers,A)}catch(M){console.warn("Unable to compute style diff:",M),A=[{command:zr.setStyle,args:[E]}]}return A}(this.serialize(),t).filter(b=>!(b.command in rp));if(f.length===0)return!1;const _=f.filter(b=>!(b.command in dy));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);const w=[];return f.forEach(b=>{w.push(this[b.command](...b.args))}),i&&Promise.all(w).then(i).catch(i),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[i,f]of t.entries()){if(this.getImage(i))return this.fire(new n.y(new Error(`An image with the name "${i.name}" already exists.`)));this.imageManager.addImage(i,this.scope,f),this._changes.updateImage(i,this.scope)}return this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this}addImage(t,i){return this.getImage(t)?this.fire(new n.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,i),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this)}updateImage(t,i,f=!1){this.imageManager.updateImage(t,this.scope,i),f&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new n.z("data",{dataType:"style"})),this}addModel(t,i,f={}){return this._checkLoaded(),this._validate(Lc,`models.${t}`,i,null,f)||(this.modelManager.addModel(t,i,this.scope),this.fire(new n.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,f={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate($d,`sources.${t}`,i,null,f))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const _=ds(t,i,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const w=b=>{const E=(b?"symbol:":"other:")+_.id,A=n.B(E,this.scope),M=this._sourceCaches[E]=new To(A,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=M,M.onAdd(this.map)};w(!1),i.type!=="vector"&&i.type!=="geojson"||w(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find(([w,b])=>b.type==="source"&&b.source===t);if(_)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while iconset "${_[0]}" is using it.`)))}const f=this.getOwnSourceCaches(t);for(const _ of f){const w=n.dp(_.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(_.id),_.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){const i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){const t=[];for(const i in this._otherSourceCaches){const f=this.getOwnSourceCache(i);f&&t.push(f.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const i in t){const f=t[i]._tiles;for(const _ in f){const w=f[_];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const w of t){if(this._validate(Hh,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(w),b.updateTransitions(i)}else this.ambientLight=new cn(w,Fr||(Fr=new n.a9({color:new n.aa(n.a6.properties_light_ambient.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(w),b.updateTransitions(i)}else this.directionalLight=new cn(w,Jn||(Jn=new n.a9({direction:new n.ap(n.a6.properties_light_directional.direction),color:new n.aa(n.a6.properties_light_directional.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_directional.intensity),"cast-shadows":new n.aa(n.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new n.aa(n.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.aa(n.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=Object.assign(i,{worldview:this.map.getWorldview()}),_=new n.ac(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const f=J=>.2126*(J[0]<=.03928?J[0]/12.92:Math.pow((J[0]+.055)/1.055,2.4))+.7152*(J[1]<=.03928?J[1]/12.92:Math.pow((J[1]+.055)/1.055,2.4))+.0722*(J[2]<=.03928?J[2]/12.92:Math.pow((J[2]+.055)/1.055,2.4)),_=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=t.properties.get("intensity"),b=t.properties.get("direction"),E=1-n.d3(b.x,b.y,b.z)[2]/90,A=f(_)*w*E,M=i.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),I=i.properties.get("intensity"),C=f(M)*I;return Number(((A+C)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(n.dq(t)){const i=n.dr(t),f=this.fragments.find(({id:w})=>w===i);if(!f)return;const _=n.dp(t);return f.style.getFragmentStyle(_)}{const i=this.fragments.find(({id:f})=>f===t);return i?i.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const i={},f=(_,w="")=>`${_}::${w}`;this._featuresetSelectors={};for(const _ in t){const w=this._featuresetSelectors[_]=[];for(const b of t[_].selectors){if(b.featureNamespace){const A=this.getOwnLayer(b.layer);if(!A){n.w(`Layer is undefined for selector: ${b.layer}`);continue}const M=f(A.source,A.sourceLayer);if(M in i&&i[M]!==b.featureNamespace){n.w(`"featureNamespace ${b.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}i[M]=b.featureNamespace}let E;if(b.properties)for(const A in b.properties){const M=n.U(b.properties[A]);M.result==="success"&&(E=E||{},E[A]=M.value)}w.push({layerId:b.layer,namespace:b.featureNamespace,properties:E,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const i=this.getFragmentStyle(t);if(!i||!i.stylesheet.featuresets)return[];const f=[];for(const _ in i.stylesheet.featuresets)f.push({featuresetId:_,importId:i.scope?i.scope:void 0});return f}getFeaturesetLayers(t,i){const f=this.getFragmentStyle(i),_=f.stylesheet.featuresets;if(!_||!_[t])return this.fire(new n.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const b of _[t].selectors){const E=f.getOwnLayer(b.layer);E&&w.push(E)}return w}getConfigProperty(t,i){const f=this.getFragmentStyle(t);if(!f)return null;const _=n.B(i,f.scope),w=f.options.get(_),b=w?w.value||w.default:null;return b?b.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,i){const f=n.B(t,i);return this._mergedIndoor[f]}setIndoorData(t,i){this.map.indoor.setIndoorData(i)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,i,f){const _=this.getFragmentStyle(t);if(!_)return;const w=_.stylesheet.schema;if(!w||!w[i])return;const b=n.U(f);if(b.result!=="success")return void zl(this,b.value);const E=b.value.expression,A=n.B(i,_.scope),M=_.options.get(A);if(!M)return;let I;const{minValue:C,maxValue:J,stepValue:U,type:H,values:q}=w[i],ne=n.U(w[i].default);ne.result==="success"&&(I=ne.value.expression),I?(this.options.set(A,Object.assign({},M,{value:E,default:I,minValue:C,maxValue:J,stepValue:U,type:H,values:q})),this.updateConfigDependencies(i)):this.fire(new n.y(new Error(`No schema defined for the config option "${i}" in the "${t}" fragment.`)))}getConfig(t){const i=this.getFragmentStyle(t);if(!i)return null;const f=i.stylesheet.schema;if(!f)return null;const _={};for(const w in f){const b=n.B(w,i.scope),E=i.options.get(b),A=E?E.value||E.default:null;_[w]=A?A.serialize():null}return _}setConfig(t,i){const f=this.getFragmentStyle(t);f&&(f.updateConfig(i,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const i=this.getFragmentStyle(t);return i?i.stylesheet.schema:null}setSchema(t,i){const f=this.getFragmentStyle(t);f&&(f.stylesheet.schema=i,f.updateConfig(f._config,i),this.updateConfigDependencies())}updateConfig(t,i){if(this._config=t,t||i)if(i)for(const f in i){let _,w;const b=n.U(i[f].default);if(b.result==="success"&&(_=b.value.expression),t&&t[f]!==void 0){const J=n.U(t[f]);J.result==="success"&&(w=J.value.expression)}const{minValue:E,maxValue:A,stepValue:M,type:I,values:C}=i[f];if(_){const J=n.B(f,this.scope);this.options.set(J,{default:_,value:w,minValue:E,maxValue:A,stepValue:M,type:I,values:C})}else this.fire(new n.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,i=()=>!0){for(const f of t){const _=this.getLayer(f);_&&i(_)&&(_.possiblyEvaluateVisibility(),this._updateLayer(_),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,i=>!t||i.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(i=>{const f=i._styleColorTheme.colorThemeOverride?i._styleColorTheme.colorThemeOverride:i._styleColorTheme.colorTheme;if(f){const _=i._evaluateColorThemeData(f);(!i._styleColorTheme.lut&&_!==""||i._styleColorTheme.lut&&_!==i._styleColorTheme.lut.data)&&i.setColorTheme(f)}}),this._changes.setDirty()}addLayer(t,i,f={}){this._checkLoaded();const _=t.id;if(this._layers[_])return void this.fire(new n.y(new Error(`Layer with id "${_}" already exists on this map`)));let w;if(t.type==="custom"){if(zl(this,n.ds(t)))return;w=n.dt(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=n.dn(t),t=Object.assign(t,{source:_})),this._validate(Ql,`layers.${_}`,t,{arrayIndex:-1},f))return;w=n.dt(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:_}})}const b=n.B(w.source,w.scope);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b);let E=this._order.length;if(i){const C=this._order.indexOf(i);if(C===-1)return void this.fire(new n.y(new Error(`Layer with id "${i}" does not exist on this map.`)));w.slot===this._layers[i].slot?E=C:n.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=w;const A=this.getOwnLayerSourceCache(w),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&w.canCastShadows()&&M&&(A.castsShadows=!0);const I=this._changes.getRemovedLayer(w);if(I&&w.source&&A&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const C=n.B(w.source,w.scope);I.type!==w.type?this._changes.updateSourceCache(C,"clear"):(this._changes.updateSourceCache(C,"reload"),A.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const f=this._checkLayer(t);if(!f||t===i)return;const _=this._order.indexOf(t);this._order.splice(_,1);let w=this._order.length;if(i){const b=this._order.indexOf(i);if(b===-1)return void this.fire(new n.y(new Error(`Layer with id "${i}" does not exist on this map.`)));f.slot===this._layers[i].slot?w=b:n.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._indoorDependentLayers.delete(i.fqid),this._changes.removeLayer(i);const _=this.getOwnLayerSourceCache(i);if(_&&_.castsShadows){let w=!1;for(const b in this._layers)if(this._layers[b].source===i.source&&this._layers[b].canCastShadows()){w=!0;break}_.castsShadows=w}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,f){this._checkLoaded();const _=this._checkLayer(t);_&&(_.minzoom===i&&_.maxzoom===f||(i!=null&&(_.minzoom=i),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,i){this._checkLoaded();const f=this._checkLayer(t);f&&f.slot!==i&&(f.slot=i,this._updateLayer(f))}setFilter(t,i,f={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!n.bx(_.filter,i))return i==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(fr,`layers.${_.id}.filter`,i,{layerType:_.type},f)||(_.filter=n.dn(i),this._updateLayer(_)))}getFilter(t){const i=this._checkLayer(t);if(i)return n.dn(i.filter)}setLayoutProperty(t,i,f,_={}){this._checkLoaded();const w=this._checkLayer(t);if(w&&!n.bx(w.getLayoutProperty(i),f)){if(f!=null&&(!_||_.validate!==!1)&&zl(w,$u.call(Ws,{key:`layers.${t}.layout.${i}`,layerType:w.type,objectKey:i,value:f,styleSpec:n.a6,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(i,f),w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),this._updateLayer(w)}}setLayerProperty(t,i,f,_={}){this._checkLoaded();const w=this._checkLayer(t);w&&(i==="appearances"?(w.setAppearances(f),this._changes.setDirty()):w.isPaintProperty(i)?this.setPaintProperty(t,i,f,_):this.setLayoutProperty(t,i,f,_))}getLayoutProperty(t,i){const f=this._checkLayer(t);if(f)return f.getLayoutProperty(i)}setPaintProperty(t,i,f,_={}){this._checkLoaded();const w=this._checkLayer(t);if(!w||n.bx(w.getPaintProperty(i),f)||f!=null&&(!_||_.validate!==!1)&&zl(w,Vi.call(Ws,{key:`layers.${t}.paint.${i}`,layerType:w.type,objectKey:i,value:f,styleSpec:n.a6})))return;const b=w.setPaintProperty(i,f);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),b&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(t,i){const f=this._checkLayer(t);if(f)return f.getPaintProperty(i)}setFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:M}=t.target,I=this.getFragmentStyle(M),C=I.getFeaturesetLayers(A);for(const{source:J,sourceLayer:U}of C)I.setFeatureState({id:t.id,source:J,sourceLayer:U},i)}else if("layerId"in t.target){const{layerId:A}=t.target,M=this.getLayer(A);this.setFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer},i)}return}const f=t.source,_=t.sourceLayer,w=this._checkSource(f);if(!w)return;const b=w.type;if(b==="geojson"&&_)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!_)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(f);for(const A of E)A.setFeatureState(_,t.id,i)}removeFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:M}=t.target,I=this.getFragmentStyle(M),C=I.getFeaturesetLayers(A);for(const{source:J,sourceLayer:U}of C)I.removeFeatureState({id:t.id,source:J,sourceLayer:U},i)}else if("layerId"in t.target){const{layerId:A}=t.target,M=this.getLayer(A);this.removeFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer},i)}return}const f=t.source,_=this._checkSource(f);if(!_)return;const w=_.type,b=w==="vector"?t.sourceLayer:void 0;if(w==="vector"&&!b)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(f);for(const A of E)A.removeFeatureState(b,t.id,i)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let w;if("featuresetId"in t.target){const{featuresetId:b,importId:E}=t.target,A=this.getFragmentStyle(E),M=A.getFeaturesetLayers(b);for(const{source:I,sourceLayer:C}of M){const J=A.getFeatureState({id:t.id,source:I,sourceLayer:C});if(J&&!w)w=J;else if(!n.bx(w,J))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:b}=t.target,E=this.getLayer(b);w=this.getFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer})}return w}const i=t.source,f=t.sourceLayer,_=this._checkSource(i);if(_){if(_.type!=="vector"||f)return t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(f,t.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(t){for(const i of Object.values(this._mergedLayers))t(i)&&this._updateLayer(i)}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),f=n.B(t.source,t.scope),_=this._changes.getUpdatedSourceCaches();t.source&&!_[f]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const i=E=>this._mergedLayers[E].is3D(!!this.terrain),f=this.order,_={},w=[];for(let E=f.length-1;E>=0;E--){const A=f[E];if(i(A)){_[A]=E;for(const M of t){const I=M[A];if(I)for(const C of I)w.push(C)}}}w.sort((E,A)=>A.intersectionZ-E.intersectionZ);const b=[];for(let E=f.length-1;E>=0;E--){const A=f[E];if(i(A))for(let M=w.length-1;M>=0;M--){const I=w[M].feature;if(I.layer&&_[I.layer.id]<E)break;b.push(I),w.pop()}else for(const M of t){const I=M[A];if(I)for(const C of I)b.push(C.feature)}}return b}queryRasterValue(t,i,f){const _=this.getOwnSource(t);return _?_.type!=="raster-array"?(this.fire(new n.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(i,f):(this.fire(new n.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,i,f){let _;i&&!Array.isArray(i)&&i.filter&&(this._validate(fr,"queryRenderedFeatures.filter",i.filter,null,i),_=n.b5(i.filter));const w={},b=I=>{if(ac.has(I.type))return;const C=this.getOwnLayerSourceCache(I),J=w[C.id]=w[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};I.is3D(!!this.terrain)&&(J.has3DLayers=!0),J.layers[I.fqid]=J.layers[I.fqid]||{styleLayer:I,targets:[]},J.layers[I.fqid].targets.push({filter:_})};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(const I of i.layers){const C=this._layers[I];if(!C)return this.fire(new n.y(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];b(C)}}else for(const I in this._layers)b(this._layers[I]);const E=this._queryRenderedFeatures(t,w,f),A=this._flattenAndSortRenderedFeatures(E),M=[];for(const I of A)n.dv(I.layer.id)===this.scope&&M.push(I);return M}queryRenderedFeatureset(t,i,f){let _;i&&!Array.isArray(i)&&i.filter&&(this._validate(fr,"queryRenderedFeatures.filter",i.filter,null,i),_=n.b5(i.filter));const w="mock",b=[];if(i&&i.target)b.push(Object.assign({},i,{targetId:w,filter:_}));else{const I=this.getFeaturesetDescriptors();for(const C of I)b.push({targetId:w,filter:_,target:C});for(const{style:C}of this.fragments){const J=C.getFeaturesetDescriptors();for(const U of J)b.push({targetId:w,filter:_,target:U})}}const E=this.queryRenderedTargets(t,b,f),A=[],M=new Set;for(const I of E)for(const C of I.variants[w])as(C,I,M)||A.push(new n.dw(I,C));return A}queryRenderedTargets(t,i,f){const _={},w=(E,A,M,I)=>{const C=_[A.id]=_[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(C.layers[E.fqid]=C.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(C.has3DLayers=!0),!I)return M.uniqueFeatureID=!1,void C.layers[E.fqid].targets.push(M);C.layers[E.fqid].targets.push(Object.assign({},M,{namespace:I.namespace,properties:I.properties,uniqueFeatureID:I.uniqueFeatureID}))};for(const E of i)if("featuresetId"in E.target){const{featuresetId:A,importId:M}=E.target,I=this.getFragmentStyle(M);if(!I||!I._featuresetSelectors)continue;const C=I._featuresetSelectors[A];if(!C){this.fire(new n.y(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const J of C){const U=I.getOwnLayer(J.layerId);U&&!ac.has(U.type)&&w(U,I.getOwnLayerSourceCache(U),E,J)}}else if("layerId"in E.target){const{layerId:A}=E.target,M=this.getLayer(A);if(!M||ac.has(M.type))continue;w(M,this.getLayerSourceCache(M),E)}const b=this._queryRenderedFeatures(t,_,f);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(t,i,f){const _=[],w=!!this.map._showQueryGeometry,b=Pr.createFromScreenPoints(t,f);for(const E in i){const A=Qs(b,i[E],this._availableImages,f,w);Object.keys(A).length&&_.push(A)}if(this.placement)for(const E in i){if(!i[E].sourceCache._onlySymbols)continue;const A=qu(b.screenGeometry,i[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&_.push(A)}return _}querySourceFeatures(t,i){const f=i&&i.filter;f&&this._validate(fr,"querySourceFeatures.filter",f,null,i);let _=[];const w=this.getOwnSourceCaches(t);for(const b of w)_=_.concat(zn(b,i));return _}addSourceType(t,i,f){return Ks.getSourceType(t)?f(new Error(`A source type called "${t}" already exists.`)):(Ks.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,f={}){this._checkLoaded();const _=this.light.getLight();let w=!1;for(const E in t)if(!n.bx(t[E],_[E])){w=!0;break}if(!w)return;const b=this._getTransitionParameters();this.light.setLight(t,i,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,i=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),i===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=t;const _=t.source==null;if(i===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const E="terrain-dem-src";this.addSource(E,f.source),f=n.dn(f),f=Object.assign(f,{source:E})}const w=Object.assign({},f),b={};if(this.terrain&&_){w.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(b.style=E.serialize())}if(this._validate(bc,"terrain",w,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&i!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,i),this.fire(new n.z("data",{dataType:"style"}))}else{const w=this.terrain,b=w.get();for(const E of Object.keys(n.a6.terrain))!f.hasOwnProperty(E)&&n.a6.terrain[E].default&&(f[E]=n.a6.terrain[E].default);for(const E in t)if(!n.bx(t[E],b[E])){w.set(t,this.options),this.stylesheet.terrain=t;const A=this._getTransitionParameters({duration:0});w.updateTransitions(A),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const i=this.fog=new Za(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=i.get();const f=this._getTransitionParameters({duration:0});i.updateTransitions(f)}_createSnow(t){const i=this.snow=new ii(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=i.get();const f=this._getTransitionParameters({duration:0});i.updateTransitions(f)}_createRain(t){const i=this.rain=new Fn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=i.get();const f=this._getTransitionParameters({duration:0});i.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!n.bx(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const f=this._getTransitionParameters({duration:0});i.updateTransitions(f)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const i=this.snow;if(!n.bx(i.get(),t)){i.set(t,this.options),this.stylesheet.snow=i.get();const f=this._getTransitionParameters({duration:0});i.updateTransitions(f)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const i=this.rain;if(!n.bx(i.get(),t)){i.set(t,this.options),this.stylesheet.rain=i.get();const f=this._getTransitionParameters({duration:0});i.updateTransitions(f)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!i)return this._styleColorTheme.lut=null,void t();const f=this._evaluateColorThemeData(i);this._loadColorTheme(f).then(()=>{this.fire(new n.z("colorthemeset")),t()}).catch(_=>{n.w(`Couldn't set color theme: ${_}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,i){const f=this.getFragmentStyle(t);f&&(f._styleColorTheme.colorThemeOverride=i,f._reloadColorTheme())}_getTransitionParameters(t){return{now:n.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],i=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?t.push(f):i.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){const f=this.terrain=new Oe(t,i,this.scope,this.options,this.map.getWorldview());i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,f,_,w={}){if(w&&w.validate===!1)return!1;const b=Object.assign({},this.serialize());return zl(this,t.call(Ws,Object.assign({key:i,style:b,value:f,styleSpec:n.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const i=this.getSourceCaches(t);for(const f of i)f.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const i=this._mergedLayers[t];i._clear&&i._clear()}}reloadSource(t){const i=this.getSourceCaches(t);for(const f of i)f.resume(),f.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let i;this.directionalLight&&(i=em(this.directionalLight));const f=new Set;for(const _ in this._mergedLayers){const w=this._mergedLayers[_];w.hasElevation()&&!f.has(w.source)&&f.add(w.source)}for(const _ in this._mergedSourceCaches){const w=this._mergedSourceCaches[_],b=f.has(w._source.id);w.update(t,void 0,void 0,i,b)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,f,_,w,b,E=!1){let A=!1,M=!1;const I={},C={};for(const J of this._mergedOrder){const U=this._mergedLayers[J];if(U.type!=="symbol")continue;const H=n.B(U.source,U.scope);let q=I[H];if(!q){const ae=this.getLayerSourceCache(U);if(!ae)continue;const se=ae.getRenderableIds(!0).map(he=>ae.getTileByID(he));C[H]=se.slice(),q=I[H]=se.sort((he,ce)=>ce.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(ce.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(U,q,i.center.lng,i.projection);A=A||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new n.z("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.o.now(),i.zoom))&&(this.pauseablePlacement=new Is(i,this._mergedOrder,E,f,_,w,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,C,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.o.now()),M=!0),A&&this.pauseablePlacement.placement.setStale()),M||A){this._buildingIndex.onNewFrame(i.zoom);for(let J=0;J<this._mergedOrder.length;J++){const U=this._mergedLayers[this._mergedOrder[J]];if(U.type!=="symbol")continue;const H=this.isLayerClipped(U);this.placement.updateLayerOpacities(U,I[n.B(U.source,U.scope)],J,H?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:w})=>w===t.id)!==-1)return void this.fire(new n.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return f.push(t),this._loadImports([t],!0);const _=f.findIndex(({id:w})=>w===i);return _===-1&&this.fire(new n.y(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(t).concat(f.slice(_)),this._loadImports([t],!0,i)}updateImport(t,i){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(t);return _===-1?this:typeof i=="string"?(this.setImportUrl(t,i),this):(i.url&&i.url!==f[_].url&&this.setImportUrl(t,i.url),n.bx(i.config,f[_].config)||this.setImportConfig(t,i.config,i.data.schema),n.bx(i.data,f[_].data)||this.setImportData(t,i.data),this)}moveImport(t,i){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(t);if(_===-1)return this;const w=this.getImportIndex(i);if(w===-1)return this;const b=f[_],E=this.fragments[_];return f=f.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=f.slice(0,w).concat(b).concat(f.slice(w)),this.fragments=this.fragments.slice(0,w).concat(E).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(t,i){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(t);if(_===-1)return this;f[_].url=i;const w=this.fragments[_];return w.style=this._createFragmentStyle(f[_]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();const f=this.getImportIndex(t),_=this.stylesheet.imports||[];return f===-1?this:i?(this.fragments[f].style.setState(i),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(t,_[f].url))}setImportConfig(t,i,f){this._checkLoaded();const _=this.getImportIndex(t),w=this.stylesheet.imports||[];if(_===-1)return this;i?w[_].config=i:delete w[_].config;const b=this.fragments[_];f&&b.style.stylesheet&&(b.style.stylesheet.schema=f);const E=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=i,b.style.updateConfig(i,E),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const i=this.stylesheet.imports||[],f=this.getImportIndex(t);f!==-1&&(i.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex(f=>f.id===t);return i===-1&&this.fire(new n.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const i in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[i];f&&t.push(f.getSource())}return t}getSource(t,i){const f=this.getSourceCache(t,i);return f&&f.getSource()}getLayerSource(t){const i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){const f=n.B(t,i);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(t){const i=n.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const i in t){const f=t[i];f==="reload"?this.reloadSource(i):f==="clear"&&this.clearSource(i)}}updateLayers(t){const i=this._changes.getUpdatedPaintProperties();for(const f of i){const _=this.getLayer(f);_&&_.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,i,f){this.imageManager.getImages(i.images,i.scope,f),this._updateTilesForChangedImages();const _=b=>{if(b){const E=i.images.map(A=>n.I.toString(A));b.setDependencies(i.tileID.key,i.type,E)}},w=n.B(i.source,i.scope);_(this._mergedOtherSourceCaches[w]),_(this._mergedSymbolSourceCaches[w]),i.images.some(b=>b.iconsetId)&&this.fire(new n.z("data",{dataType:"style"}))}rasterizeImages(t,i,f){this.imageManager.rasterizeImages(i,f)}getGlyphs(t,i,f){this.glyphManager.getGlyphs(i.stacks,f)}getResource(t,i,f){return n.dy(i,f)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${t}'`))),!1):i.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,i){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const f=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),_=t.type==="building";if(t.is3D(!!this.terrain)){if(f||_||i&&i.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ks.getSourceType=function(h){return Xs[h]},Ks.setSourceType=function(h,t){Xs[h]=t},Ks.registerForPluginStateChange=n.dz;class Mc extends n.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},n.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[i,f]of Object.entries(t.buildings))if(this._buildings[i])for(const _ of f.floorIds)this._buildings[i].floors[_]||(this._buildings[i].floors[_]=f.floors[_]);else this._buildings[i]=f;for(const i of t.activeFloors)this._activeFloors.add(i);this._updateIndoorSelector()}getIndoorTileOptions(t,i){const f=this._style.getIndoorSourceLayers(t,i);return f&&this._indoorState?{sourceLayers:f,indoorState:this._indoorState}:null}_updateUI(t,i,f){const _=function(w,b,E,A){let M=null,I=Number.MAX_SAFE_INTEGER;if(A<16)return null;for(const[C,J]of Object.entries(w)){const U=J.center;if(U){const H=b.distanceTo(n.aS.convert(U));H<I&&E.contains(U)&&(I=H,M=C)}}return M}(this._buildings,i,f,t);_!==this._closestBuildingId&&(this._closestBuildingId=_,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,i=this._closestBuildingId,f=i&&t?t[i]:void 0;if(!f)return void this.fire(new n.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let _=null;for(const b of f.floorIds)if(this._activeFloors&&this._activeFloors.has(b)){_=b;break}const w=Array.from(f.floorIds).map(b=>({id:b,name:f.floors[b].name,zIndex:f.floors[b].zIndex})).sort((b,E)=>E.zIndex-b.zIndex);this.fire(new n.z("selector-update",{selectedFloorId:_,activeFloorsVisible:this._activeFloorsVisible,floors:w}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Bc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ic=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,uh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,hu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",rc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,nf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,dh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,eo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,hh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Dt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,sf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const fo=[];Io(Bc,fo),Io(uh,fo),Io(Ic,fo);const kc={"_prelude_fog.vertex.glsl":nf,"_prelude_terrain.vertex.glsl":rc,"_prelude_shadow.vertex.glsl":Dt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":dh,"_prelude_shadow.fragment.glsl":sf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":eo,"_prelude_raster_particle.glsl":hh},fu={};cr("",rc),cr(dh,nf),cr(sf,Dt),cr(eo,""),cr(hh,"");const fh=cr(Ic,uh),Al=Bc;var Jc={background:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:cr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:cr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:cr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:cr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:cr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:cr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:cr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:cr(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:cr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:cr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:cr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:cr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:cr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:cr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,hu),skyboxGradient:cr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,hu),skyboxCapture:cr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:cr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:cr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:cr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:cr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:cr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:cr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Io(h,t){const i=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of i)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const w of _)t.includes(w)||t.push(w)}}function cr(h,t){const i=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_={},w=[],b=[];if(h=h.replace(i,(A,M)=>(b.push(M),"")),(t=t.replace(i,(A,M)=>(w.push(M),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let E=[...fo];Io(h,E),Io(t,E);for(const A of[...w,...b])kc[A]||console.error(`Undefined include: ${A}`),fu[A]||(fu[A]=[],Io(kc[A],fu[A])),E=[...E,...fu[A]];return{fragmentSource:h=h.replace(f,(A,M,I,C,J)=>(_[J]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${J}
in ${I} ${C} ${J};
#else
uniform ${I} ${C} u_${J};
#endif
`:M==="initialize"?`
#ifdef HAS_UNIFORM_u_${J}
    ${I} ${C} ${J} = u_${J};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${J}
    in ${I} ${C} ${J};
#endif
`:M==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(f,(A,M,I,C,J)=>{const U=`MATERIAL_ATTRIBUTE_OFFSET_${J}`,H=C==="float"?"vec2":C,q=`GET_ATTRIBUTE_${H}(a_${J}, materialInfo, ${U})`,ne=J.match(/color/)?"color":H;return M==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${J}
in ${I} ${C} a_${J};
#endif
`:_[J]?M==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
    #if !defined(${U})
        in ${I} ${H} a_${J};
    #endif
out ${I} ${C} ${J};
#else
uniform ${I} ${C} u_${J};
#endif
`:M==="initialize"?ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${I} ${C} ${J} = u_${J};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${J}) 
    #ifdef ${U}
        ${J} = unpack_mix_${ne}(${q}, u_${J}_t);
    #else
        ${J} = unpack_mix_${ne}(a_${J}, u_${J}_t);
    #endif
#else
    ${I} ${C} ${J} = u_${J};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${J}
    in ${I} ${C} a_${J};
    out ${I} ${C} ${J};
#endif
`:M==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${J}
    ${J} = a_${J};
#endif
`:void 0:M==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
    #if !defined(${U})
        in ${I} ${H} a_${J};
    #endif  
#else
uniform ${I} ${C} u_${J};
#endif
`:M==="define-instanced"?ne==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${J}0;
in vec4 a_${J}1;
in vec4 a_${J}2;
in vec4 a_${J}3;
#else
uniform ${I} ${C} u_${J};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${I} ${H} a_${J};
#else
uniform ${I} ${C} u_${J};
#endif
`:M==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${J}
    ${I} ${C} ${J} = a_${J};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    #ifdef ${U}
        ${I} ${C} ${J} = ${q};
    #else
        ${I} ${C} ${J} = a_${J};
    #endif
#else
    ${I} ${C} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    #ifdef ${U}
        ${I} ${C} ${J} = unpack_mix_${ne}(${q}, u_${J}_t);
    #else
        ${I} ${C} ${J} = unpack_mix_${ne}(a_${J}, u_${J}_t);
    #endif
#else
    ${I} ${C} ${J} = u_${J};
#endif
`}),usedDefines:E,vertexIncludes:w,fragmentIncludes:b}}class pu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,f,_,w,b,E,A){this.context=t;let M=this.boundPaintVertexBuffers.length!==_.length;for(let C=0;!M&&C<_.length;C++)this.boundPaintVertexBuffers[C]!==_[C]&&(M=!0);let I=this.boundDynamicVertexBuffers.length!==E.length;for(let C=0;!I&&C<E.length;C++)this.boundDynamicVertexBuffers[C]!==E[C]&&(I=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==f||M||I||this.boundIndexBuffer!==w||this.boundVertexOffset!==b)this.freshBind(i,f,_,w,b,E,A);else{t.bindVertexArrayOES.set(this.vao);for(const C of E)C&&(C.bind(),A&&C.instanceCount&&C.setVertexAttribDivisor(t.gl,i,A));w&&w.dynamicDraw&&w.bind()}}freshBind(t,i,f,_,w,b,E){const A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=b,i.enableAttributes(M,t),i.bind(),i.setVertexAttribPointers(M,t,w);for(const I of f)I.enableAttributes(M,t),I.bind(),I.setVertexAttribPointers(M,t,w);for(const I of b)I&&(I.enableAttributes(M,t),I.bind(),I.setVertexAttribPointers(M,t,w),E&&I.instanceCount&&I.setVertexAttribDivisor(M,t,E));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function hi(h,t){const i=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new n.ae(0,f/i).toLngLat().lat,new n.ae(0,(f+1)/i).toLngLat().lat]}function np(h,t,i,f,_,w,b){const E=h.context,A=E.gl,M=i.hillshadeFBO;if(!M)return;h.prepareDrawTile();const I=h.isTileAffectedByFog(t),C=h.getOrCreateProgram("hillshade",{overrideFog:I});E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,M.colorAttachment.get());const J=((ne,ae,se,he)=>{const ce=se.paint.get("hillshade-shadow-color"),Ze=se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",me=se.paint.get("hillshade-highlight-color"),Ne=se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",we=se.paint.get("hillshade-accent-color"),ge=se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Se=se.paint.get("hillshade-emissive-strength");let Pe=n.an(se.paint.get("hillshade-illumination-direction"));if(se.paint.get("hillshade-illumination-anchor")==="viewport")Pe-=ne.transform.angle;else if(ne.style&&ne.style.enable3dLights()&&ne.style.directionalLight){const it=ne.style.directionalLight.properties.get("direction"),qe=n.d3(it.x,it.y,it.z);Pe=n.an(qe[1])}const Fe=!ne.options.moving;return{u_matrix:he||ne.transform.calculateProjMatrix(ae.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:hi(0,ae.tileID),u_light:[se.paint.get("hillshade-exaggeration"),Pe],u_shadow:ce.toPremultipliedRenderColor(Ze?null:se.lut),u_highlight:me.toPremultipliedRenderColor(Ne?null:se.lut),u_emissive_strength:Se,u_accent:we.toPremultipliedRenderColor(ge?null:se.lut)}})(h,i,f,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(E,C,t.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:H,tileBoundsSegments:q}=h.getTileBoundsBuffers(i);C.draw(h,A.TRIANGLES,_,w,b,Ba.disabled,J,f.id,U,H,q)}function mu(h,t,i){if(!t.needsDEMTextureUpload)return;const f=h.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(i.stride);const w=i.getPixels();t.demTexture?t.demTexture.update(w,{premultiply:!1}):t.demTexture=new n.T(f,w,_.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ph(h,t,i){const f=h.context,_=f.gl;if(!t.dem)return;const w=t.dem;if(f.activeTexture.set(_.TEXTURE1),mu(h,t,w),!t.demTexture)return;t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const b=w.dim;f.activeTexture.set(_.TEXTURE0);let E=t.hillshadeFBO;if(!E){const J=new n.T(f,{width:b,height:b,data:null},_.RGBA8);J.bind(_.LINEAR,_.CLAMP_TO_EDGE),E=t.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),E.colorAttachment.set(J.texture)}f.bindFramebuffer.set(E.framebuffer),f.viewport.set([0,0,b,b]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:M,tileBoundsSegments:I}=h.getMercatorTileBoundsBuffers(),C=[];h.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:C}).draw(h,_.TRIANGLES,ca.disabled,za.disabled,Ya.unblended,Ba.disabled,((J,U)=>{const H=U.stride,q=n.bB();return n.cd(q,0,n.al,-n.al,0,0,1),n.bq(q,q,[0,-n.al,0]),{u_matrix:q,u_image:1,u_dimension:[H,H],u_zoom:J.overscaledZ}})(t.tileID,w),i.id,A,M,I),t.needsHillshadePrepare=!1}class jn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class of extends jn{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class yu extends jn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class lf extends jn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ud extends jn{getDefault(){return[!0,!0,!0,!0]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class nm extends jn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hy extends jn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class im extends jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class sm extends jn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class gu extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class cf extends jn{getDefault(){return[0,1]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class uf extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class mh extends jn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class dd extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class yh extends jn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _u extends jn{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class xu extends jn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class gh extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class hd extends jn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class df extends jn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Rl=class extends jn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class ip extends jn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class il extends jn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class po extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Fc extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class sl extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fd extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class _h extends jn{getDefault(){return null}set(t){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class om extends jn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Oc extends jn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class pd extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ol extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class wu extends jn{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class sp extends wu{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class vu extends wu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Dc extends wu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ti extends vu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $n=(h,t,i)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),ll=(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:i,u_zoom_transition:_,u_merc_center:w,u_image0:0,u_frustum_tl:b,u_frustum_tr:E,u_frustum_br:A,u_frustum_bl:M,u_globe_pos:I,u_globe_radius:C,u_viewport:J,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:H});function Qi(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const Gi=new class{constructor(){this.operations={}}newMorphing(h,t,i,f,_){if(h in this.operations){const w=this.operations[h];w.to.tileID.key!==i.tileID.key&&(w.queued=i)}else this.operations[h]={startTime:f,phase:0,duration:_,from:t,to:i,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const i=this.operations[t];for(i.phase=(h-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},nc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function bu(h,t,i){if(t===0)return 0;const f=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*f}function rs(h,t){const i=1<<h.z;return!t&&(h.x===0||h.x===i-1)||h.y===0||h.y===i-1}const Tl=h=>({u_matrix:h});function xh(h,t,i,f,_){if(_>0){const w=n.o.now(),b=(w-h.timeAdded)/_,E=t?(w-t.timeAdded)/_:-1,A=i.getSource(),M=f.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),I=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(h.tileID.overscaledZ-M),C=I&&h.refreshedUponExpiration?1:n.aA(I?b:1-E,0,1);return t?{opacity:1,mix:1-C,isFading:b<1}:{opacity:C,mix:0,isFading:b<1}}return{opacity:1,mix:0,isFading:!1}}class to extends To{constructor(t){const i=ds("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",i,!1),i.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class md extends To{constructor(t){const i=ds("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,f){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,b)=>{if(w[b.key]="",!this._tiles[b.key]){const E=new ps(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[b.key]=E}return w},{});for(const w in this._tiles)w in _||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(t){const i=this.proxyCachedFBO[t];if(i!==void 0){const f=Object.values(i);this.renderCachePool.push(...f),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class yd extends n.aP{constructor(t,i,f){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=f}}class mo extends n.bU{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,w]=function(A){const M=new n.bc,I=new n.b0,C=131;M.reserve(17161),I.reserve(33800);const J=n.al/128,U=n.al+J/2,H=U+J;for(let ne=-J;ne<H;ne+=J)for(let ae=-J;ae<H;ae+=J){const se=ae<0||ae>U||ne<0||ne>U?24575:0,he=n.aA(Math.round(ae),0,n.al),ce=n.aA(Math.round(ne),0,n.al);M.emplaceBack(he+se,ce)}const q=(ne,ae)=>{const se=ae*C+ne;I.emplaceBack(se+1,se,se+C),I.emplaceBack(se+C,se+C+1,se+1)};for(let ne=1;ne<129;ne++)for(let ae=1;ae<129;ae++)q(ae,ne);return[0,129].forEach(ne=>{for(let ae=0;ae<130;ae++)q(ae,ne),q(ne,ae)}),[M,I,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(f,n.be.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=n.bf.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=n.bf.simpleSegment(0,0,f.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new md(i.map),this.orthoMatrix=n.bB(),n.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.al,0,n.al,0,1);const E=b.gl;this._overlapStencilMode=new za({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new to(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,f){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const _=t.terrain.properties,w=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.o.now();const E=t.terrain&&t.terrain.scope,A=_.get("source"),M=w?this._mockSourceCache:t.getSourceCache(A,E);if(!M)return void n.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=M,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(i):_.get("exaggeration"),!i.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const I=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(i,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,I(),this._initializing=!0),I(),i.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const i=this._previousCameraAltitude,f=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=f;const _=i!=null?f-i:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const w=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(w);let E=w-this._previousZoom;const A=this._previousUpdateTimestamp;let M=w;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(w-M)>.5&&(E=.5*(w-M+E)),E*_<0&&(M+=E)),this._evaluationZoom=M;const I=b.getExaggeration(M),C=I===b.getExaggeration(Math.max(0,M-.1));if(C&&Math.abs(I-this._exaggeration)<.01)return I;let J=Math.min(.1,.00375*(this._updateTimestamp-A));return(C||I<.1||Math.abs(E)<1e-4)&&(J=Math.min(.2,4*J)),n.ak(this._exaggeration,I,J)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(n.ae.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=i.getIds().map(A=>{const M=i.getTileByID(A).tileID;return M.projMatrix=f.calculateProjMatrix(M.toUnwrapped()),M});(function(A,M){const I=M.transform.pointCoordinate(M.transform.getCameraPoint()),C=new n.P(I.x,I.y);A.sort((J,U)=>{if(U.overscaledZ-J.overscaledZ)return U.overscaledZ-J.overscaledZ;const H=new n.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),q=new n.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),ne=C.mult(1<<J.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(H)-ne.distSqr(q)})})(_,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},_.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const A in b){const M=b[A];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,t[A],w),M.usedForTerrain))continue;const I=t[A];M.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[i.id]=_.map(A=>new yd(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const M=this.terrainTileForTile[A.key];if(!M)continue;const I=M.tileID.key;I in E||(this._visibleDemTiles.push(M),E[I]=I)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;const f=this._findTileCoveringTileID(i,this.sourceCache);f&&(this.terrainTileForTile[i.key]=f)})}_prepareDEMTextures(){const t=this.painter.context,i=t.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],w=_.dem;!w||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),mu(this.painter,_,w))}}_prepareDemTileUniforms(t,i,f,_){if(!i||i.demTexture==null)return!1;const w=t.tileID.canonical,b=Math.pow(2,i.tileID.canonical.z-w.z),E=_||"";return f[`u_dem_tl${E}`]=[w.x*b%1,w.y*b%1],f[`u_dem_scale${E}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const i=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const w=_.dem.tree.minimums[0];return w>0&&t++,f+w},0);return t?i/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new n.dK({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(_,{premultiply:!1}):w=this._emptyDEMTexture=new n.T(t,_,i.R32F,{premultiply:!1}),w}setupElevationDraw(t,i,f){const _=this.painter.context,w=_.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let E=null,A=null,M=1;if(f&&f.morphing&&this._useVertexMorphing){const U=f.morphing.srcDemTile,H=f.morphing.dstDemTile;M=f.morphing.phase,U&&H&&(this._prepareDemTileUniforms(t,U,b,"_prev")&&(A=U),this._prepareDemTileUniforms(t,H,b)&&(E=H))}const I=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let C=null;var J;if(this.enabled?A&&E?(C=E.demTexture,_.activeTexture.set(w.TEXTURE4),A.demTexture.bind(I(A),w.CLAMP_TO_EDGE),b.u_dem_lerp=M):(E=this.terrainTileForTile[t.tileID.key],C=this._prepareDemTileUniforms(t,E,b)?E.demTexture:this.emptyDEMTexture):C=this.emptyDEMTexture,_.activeTexture.set(w.TEXTURE2),C&&(b.u_dem_size=(J=C).size[0]===1?1:J.size[0]-2,C.bind(I(E),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,i,b),f&&f.useMeterToDem&&E){const U=(1<<E.tileID.canonical.z)*n.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=U}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),i.setTerrainUniformValues(_,b),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,t.tileID.canonical,f&&f.useDenormalizedUpVectorScale);i.setGlobeUniformValues(_,U)}}globeUniformValues(t,i,f){const _=t.projection;return{u_tile_tl_up:_.upVector(i,0,0),u_tile_tr_up:_.upVector(i,n.al,0),u_tile_br_up:_.upVector(i,n.al,n.al),u_tile_bl_up:_.upVector(i,0,n.al),u_tile_up_scale:f?n.dL(1):_.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,f=this.painter.context;t.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,w,b,E,A){if(_.transform.projection.name==="globe")(function(M,I,C,J,U){const H=M.context,q=H.gl;let ne,ae;const se=M.transform,he=n.dD(M,H,se),ce=(it,qe)=>{if(ae===qe)return;const dt=[nc[qe],"PROJECTION_GLOBE_VIEW"];he&&dt.push("CUSTOM_ANTIALIASING");const Mt=M.isTileAffectedByFog(it);ne=M.getOrCreateProgram("globeRaster",{defines:dt,overrideFog:Mt}),ae=qe},Ze=M.colorModeForRenderPass(),me=new ca(q.LEQUAL,ca.ReadWrite,M.depthRangeFor3D);Gi.update(U);const Ne=n.dE(se),we=[n.aF(se.center.lng),n.aJ(se.center.lat)],ge=M.globeSharedBuffers,Se=[se.width*n.o.devicePixelRatio,se.height*n.o.devicePixelRatio],Pe=Float32Array.from(se.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};{const it=M.transform,qe=bu(it.zoom,I.exaggeration(),I.sourceCache._source.tileSize);ae=-1;const dt=q.TRIANGLES;for(const Mt of J){const Xe=C.getTile(Mt),Ie=za.disabled,ct=I.prevTerrainTileForTile[Mt.key],et=I.terrainTileForTile[Mt.key];Qi(ct,et)&&Gi.newMorphing(Mt.key,ct,et,U,250),H.activeTexture.set(q.TEXTURE0),Xe.texture&&Xe.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const jt=Gi.getMorphValuesForProxy(Mt.key),Ct=jt?1:0;jt&&Object.assign(Fe,{morphing:{srcDemTile:jt.from,dstDemTile:jt.to,phase:n.dC(jt.phase)}});const oa=n.dF(Mt.canonical),Bt=n.dG(oa.getCenter().lat),Ot=n.dH(Mt.canonical,oa,Bt,it.worldSize/it._pixelsPerMercatorPixel),la=n.bj(n.dI(Mt.canonical)),ra=ll(it.expandedFarZProjMatrix,Pe,Ne,la,n.aj(it.zoom),we,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Se,qe,it._farZ,Ot);if(ce(Mt,Ct),ne&&(I.setupElevationDraw(Xe,ne,Fe),M.uploadCommonUniforms(H,ne,Mt.toUnwrapped()),ge)){const[Ht,ia,va]=ge.getGridBuffers(Bt,qe!==0);ne.draw(M,dt,me,Ie,Ze,Ba.backCCW,ra,"globe_raster",Ht,ia,va)}}}if(ge&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&it.push("CUSTOM_ANTIALIASING"),ne=M.getOrCreateProgram("globeRaster",{defines:it});for(const qe of J){const{x:dt,y:Mt,z:Xe}=qe.canonical,Ie=Mt===0,ct=Mt===(1<<Xe)-1,[et,jt,Ct,oa]=ge.getPoleBuffers(Xe,!1);if(oa&&(Ie||ct)){const Bt=C.getTile(qe);H.activeTexture.set(q.TEXTURE0),Bt.texture&&Bt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let Ot=n.dJ(Xe,dt,se);const la=n.bj(n.dI(qe.canonical)),ra=(Ht,ia)=>Ht.draw(M,q.TRIANGLES,me,za.disabled,Ze,Ba.disabled,ll(se.expandedFarZProjMatrix,Ot,Ot,la,0,we,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Se,0,se._farZ),"globe_pole_raster",ia,Ct,oa);I.setupElevationDraw(Bt,ne,Fe),M.uploadCommonUniforms(H,ne,qe.toUnwrapped()),Ie&&M.renderDefaultNorthPole&&ra(ne,et),ct&&M.renderDefaultSouthPole&&(Ot=n.cR(n.bB(),Ot,[1,-1,1]),ra(ne,jt))}}}})(_,w,b,E,A);else{const M=_.context,I=M.gl;let C,J;const U=_.shadowRenderer,H=nl(_,_.longestCutoffRange),q=Ze=>{if(J===Ze)return;const me=[];me.push(nc[Ze]),H.shouldRenderCutoff&&me.push("RENDER_CUTOFF"),U&&(me.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&me.push("NORMAL_OFFSET")),C=_.getOrCreateProgram("terrainRaster",{defines:me}),J=Ze},ne=_.colorModeForRenderPass(),ae=new ca(I.LEQUAL,ca.ReadWrite,_.depthRangeFor3D);Gi.update(A);const se=_.transform,he=bu(se.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let ce=[0,0,0];if(U){const Ze=_.style.directionalLight,me=_.style.ambientLight;Ze&&me&&(ce=Bo(_.style,Ze,me))}{J=-1;const Ze=I.TRIANGLES,[me,Ne]=[w.gridIndexBuffer,w.gridSegments];for(const we of E){const ge=b.getTile(we),Se=za.disabled,Pe=w.prevTerrainTileForTile[we.key],Fe=w.terrainTileForTile[we.key];Qi(Pe,Fe)&&Gi.newMorphing(we.key,Pe,Fe,A,250),M.activeTexture.set(I.TEXTURE0),ge.texture&&ge.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const it=Gi.getMorphValuesForProxy(we.key),qe=it?1:0;let dt;it&&(dt={morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:n.dC(it.phase)}});const Mt=$n(we.projMatrix,rs(we.canonical,se.renderWorldCopies)?he/10:he,ce);if(q(qe),!C)continue;w.setupElevationDraw(ge,C,dt);const Xe=we.toUnwrapped();U&&U.setupShadows(Xe,C),_.uploadCommonUniforms(M,C,Xe,null,H),C.draw(_,Ze,ae,Se,ne,Ba.backCCW,Mt,"terrain_raster",w.gridBuffer,me,Ne)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const i=this.painter,f=this.painter.context,_=this.proxySourceCache,w=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),E=i.style.order,A=[];let M=0;for(const I of w){const C=_.getTileByID(I.proxyTileKey),J=_.proxyCachedFBO[I.key]?_.proxyCachedFBO[I.key][t]:void 0,U=J!==void 0?_.renderCache[J]:this.pool[M++],H=J!==void 0;if(C.texture=U.tex,H&&!U.dirty){A.push(C.tileID);continue}let q;f.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(f.clear({color:n.ao.transparent,stencil:0}),U.dirty=!1);for(let ne=b.start;ne<=b.end;++ne){const ae=i.style._mergedLayers[E[ne]];if(ae.isHidden(i.transform.zoom))continue;const se=i.style.getLayerSourceCache(ae),he=se?this.proxyToSource[I.key][se.id]:[I];if(!he)continue;const ce=he;f.viewport.set([0,0,U.fb.width,U.fb.height]),q!==(se?se.id:null)&&(this._setupStencil(U,he,ae,se),q=se?se.id:null),i.renderLayer(i,se,ae,ce)}if(this._drapedRenderBatches.length===0)for(const ne of this._pendingGroundEffectLayers){const ae=i.style._mergedLayers[E[ne]];if(ae.isHidden(i.transform.zoom))continue;const se=i.style.getLayerSourceCache(ae),he=se?this.proxyToSource[I.key][se.id]:[I];if(!he)continue;const ce=he;f.viewport.set([0,0,U.fb.width,U.fb.height]),q!==(se?se.id:null)&&(this._setupStencil(U,he,ae,se),q=se?se.id:null),i.renderLayer(i,se,ae,ce)}this.renderedToTile?(U.dirty=!0,A.push(C.tileID)):H||--M,M===5&&(M=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,i.width,i.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){const i=t.order.length;let f=-1,_=i;for(let w=0;w<i;++w)this._style.isLayerDraped(t._mergedLayers[t.order[w]])?f=Math.max(f,w):_=Math.min(_,w);return _>f}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const b=w.tileID,E=1<<b.overscaledZ,{x:A,y:M}=b.canonical,I=A/E,C=(A+1)/E,J=M/E,U=(M+1)/E;return{minx:I,miny:J,maxx:C,maxy:U,t:w.dem.tree.raycastRoot(I,J,C,U,t,i,f),tile:w}});_.sort((w,b)=>(w.t!==null?w.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const w of _){if(w.t==null)return null;const b=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,t,i,f);if(b!=null)return b}return null}_createFBO(){const t=this.painter.context,i=t.gl,f=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const _=new n.T(t,{width:f[0],height:f[1],data:null},i.RGBA8);_.bind(i.LINEAR,i.CLAMP_TO_EDGE);const w=t.createFramebuffer(f[0],f[1],!0,null);return w.colorAttachment.set(_.texture),w.depthAttachment=new ti(t,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:w,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const i=this._style._mergedLayers[t],f=i.isHidden(this.painter.transform.zoom);return i.type==="hillshade"||i.type==="custom"?!f&&i.shouldRedrape():!f&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const f of this._style.getSources())if(f instanceof Mi){t=!0;break}if(!t)return;const i={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],w=this._style.getLayerSourceCache(_);if(w&&!i[w.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof n.ad){i[w.id]=!0;for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][w.id];if(E)for(const A of E)this._clearRenderCacheForTile(w.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof Bs){t=!0;break}if(!t)return;const i={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],w=this._style.getLayerSourceCache(_);if(!w||i[w.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const b=_.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const A=this.proxyToSource[E.key][w.id];if(A)for(const M of A){const I=xh(w.getTile(M),w.findLoadedParent(M,0),w,this.painter.transform,b);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(w.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,i=t.length;if(i===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,w=0,b=this._style._mergedLayers[t[w]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++w<i;)b=this._style._mergedLayers[t[w]];for(;w<i;++w){const E=this._style._mergedLayers[t[w]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=w):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),_!==void 0&&(f.push({start:_,end:w-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:w-1}),f.length!==0){const E=f[f.length-1];this._pendingGroundEffectLayers.every(A=>A>E.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(t){const i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){const b=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let E=0;E<b.length;++E){const A=Object.values(b[E]);i.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let b=f.length-1;b>=0;b--){const E=f[b];if(i.getTileByID(E.key),i.proxyCachedFBO[E.key]!==void 0){const A=t[E.key],M=this.proxyToSource[E.key];let I=0;for(const C in M){const J=M[C],U=A[C];if(!U||U.length!==J.length||J.some((H,q)=>H!==U[q]||_[C]&&_[C].hasOwnProperty(H.key))){I=-1;break}++I}for(const C in i.proxyCachedFBO[E.key])i.renderCache[i.proxyCachedFBO[E.key][C]].dirty=I<0||I!==Object.values(A).length}}const w=[...this._drapedRenderBatches];w.sort((b,E)=>E.end-E.start-(b.end-b.start));for(const b of w)for(const E of f){if(i.proxyCachedFBO[E.key])continue;let A=i.renderCachePool.pop();A===void 0&&i.renderCache.length<50&&(A=i.renderCache.length,i.renderCache.push(this._createFBO())),A!==void 0&&(i.proxyCachedFBO[E.key]={},i.proxyCachedFBO[E.key][b.start]=A,i.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,b=w.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let E;if(f.isTileClipped())E=i.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):za.disabled}_renderTileClippingMasks(t,i){const f=this.painter,_=this.painter.context,w=_.gl;f._tileClippingMaskIDs={},_.setColorMode(Ya.disabled),_.setDepthMode(ca.disabled);const b=f.getOrCreateProgram("clippingMask");for(const E of t){const A=f._tileClippingMaskIDs[E.key]=--i;b.draw(f,w.TRIANGLES,ca.disabled,new za({func:w.ALWAYS,mask:0},A,255,w.KEEP,w.KEEP,w.REPLACE),Ya.disabled,Ba.disabled,Tl(E.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const f=[t.x,t.y,1,1];n.aC(f,f,i.pixelMatrixInverse),n.cJ(f,f,1/f[3]),f[0]/=i.worldSize,f[1]/=i.worldSize;const _=i._camera.position,w=n.ce(1,i.center.lat),b=[_[0],_[1],_[2]/w,0],E=n.d9([],f.slice(0,3),b);n.aw(E,E);const A=this.raycast(b,E,this._exaggeration);return A!==null&&A?(n.bG(b,b,E,A),b[3]=b[2],b[2]*=w,b):null}_setupProxiedCoordsForOrtho(t,i,f){if(t.getSource()instanceof n.aT)return this._setupProxiedCoordsForImageSource(t,i,f);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],w=this.proxyCoords;for(let A=0;A<w.length;A++){const M=w[A],I=this._findTileCoveringTileID(M,t);if(I){const C=this._createProxiedId(M,I,f[M.key]&&f[M.key][t.id]);_.push(C),this.proxyToSource[M.key][t.id]=[C]}}let b=!1;const E=new Set;for(let A=0;A<i.length;A++){const M=t.getTile(i[A]);if(!M||!M.hasData())continue;const I=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==M.tileID.canonical.z){const C=this.proxyToSource[I.tileID.key][t.id],J=this._createProxiedId(I.tileID,M,f[I.tileID.key]&&f[I.tileID.key][t.id]);C?C.splice(C.length-1,0,J):this.proxyToSource[I.tileID.key][t.id]=[J];const U=this.proxyToSource[I.tileID.key][t.id];E.has(U)||E.add(U),_.push(J),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const A of E)A.sort((M,I)=>I.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(t,i,f){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],w=this.proxyCoords,b=t.getSource(),E=b.tileID;if(!E)return;const A=new n.P(E.x,E.y)._div(1<<E.z),M=b.coordinates.map(n.ae.fromLngLat).reduce((C,J)=>(C.min.x=Math.min(C.min.x,J.x-A.x),C.min.y=Math.min(C.min.y,J.y-A.y),C.max.x=Math.max(C.max.x,J.x-A.x),C.max.y=Math.max(C.max.y,J.y-A.y),C),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(C,J)=>{const U=C.wrap+C.canonical.x/(1<<C.canonical.z),H=C.canonical.y/(1<<C.canonical.z),q=n.al/(1<<C.canonical.z),ne=J.wrap+J.canonical.x/(1<<J.canonical.z),ae=J.canonical.y/(1<<J.canonical.z);return U+q<ne+M.min.x||U>ne+M.max.x||H+q<ae+M.min.y||H>ae+M.max.y};for(let C=0;C<w.length;C++){const J=w[C];for(let U=0;U<i.length;U++){const H=t.getTile(i[U]);if(!H||!H.hasData()||I(J,H.tileID))continue;const q=this._createProxiedId(J,H,f[J.key]&&f[J.key][t.id]),ne=this.proxyToSource[J.key][t.id];ne?ne.push(q):this.proxyToSource[J.key][t.id]=[q],_.push(q)}}}_createProxiedId(t,i,f){let _=this.orthoMatrix;if(f){const w=f.find(b=>b.key===i.tileID.key);if(w)return w}if(i.tileID.key!==t.key){const w=t.canonical.z-i.tileID.canonical.z;let b,E,A;_=n.bB();const M=i.tileID.wrap-t.wrap<<t.overscaledZ;w>0?(b=n.al>>w,E=b*((i.tileID.canonical.x<<w)-t.canonical.x+M),A=b*((i.tileID.canonical.y<<w)-t.canonical.y)):(b=n.al<<-w,E=n.al*(i.tileID.canonical.x-(t.canonical.x+M<<-w)),A=n.al*(i.tileID.canonical.y-(t.canonical.y<<-w))),n.cd(_,0,b,0,b,0,1),n.bq(_,_,[E,A,0])}return new yd(i.tileID,t.key,_)}_findTileCoveringTileID(t,i){let f=i.getTile(t);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[i.id],w=_[t.key];if(f=w?i.getTileByID(w):null,f&&f.hasData()||w===null)return f;let b=f?f.tileID:t,E=b.overscaledZ;const A=i.getSource().minzoom,M=[];if(!w){const C=i.getSource().maxzoom;if(t.canonical.z>=C){const J=t.canonical.z-C;i.getSource().reparseOverscaled?(E=Math.max(t.canonical.z+2,i.transform.tileZoom),b=new n.aP(E,t.wrap,C,t.canonical.x>>J,t.canonical.y>>J)):J!==0&&(E=C,b=new n.aP(E,t.wrap,C,t.canonical.x>>J,t.canonical.y>>J))}b.key!==t.key&&(M.push(b.key),f=i.getTile(b))}const I=C=>{M.forEach(J=>{_[J]=C}),M.length=0};for(E-=1;E>=A&&(!f||!f.hasData());E--){f&&I(f.tileID.key);const C=b.calculateScaledKey(E);if(f=i.getTileByID(C),f&&f.hasData())break;const J=_[C];if(J===null)break;J===void 0?M.push(C):f=i.getTileByID(J)}return I(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let f=this._tilesDirty[t];f||(f=this._tilesDirty[t]={}),f[i.key]=!0}}function gd(h,t,i){const f=function(E,A,M){const I=n.bI(A,E),C=n.bI(M,[.2126,.7152,.0722]),J=(H,q,ne)=>(1-ne)*H+ne*q,U=J(1-.3*Math.min(C,1),1,Math.min(I+1,1));return J(.92,1,Math.asin(n.aA(A[2],-1,1))/Math.PI+.5)*U}(h,[0,0,1],t),_=[0,0,0];n.c4(_,i.slice(0,3),f);const w=[0,0,0];n.c4(w,t.slice(0,3),h[2]);const b=[0,0,0];return n.d7(b,_,w),n.da(b)}const wh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],hf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class vh{static cacheKey(t,i,f,_){let w=`${i}${_?_.cacheKey:""}`;for(const b of f)t.usedDefines.includes(b)&&(w+=`/${b}`);return w}constructor(t,i,f,_,w,b){const E=t.gl;this.program=E.createProgram(),this.configuration=_,this.name=i,this.fixedDefines=[...b];let A=_?_.defines():[];A=A.concat(b.map(H=>`#define ${H}`));const M=`#version 300 es
`;let I=M+A.concat("precision mediump float;",Al,fh.fragmentSource).join(`
`);for(const H of f.fragmentIncludes)I+=`
${kc[H]}`;I+=`
${f.fragmentSource}`;let C=M+A.concat("precision highp float;",Al,fh.vertexSource).join(`
`);for(const H of f.vertexIncludes)C+=`
${kc[H]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(C+=`
uniform int u_instanceID;
`),C+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(C=C.replaceAll("gl_InstanceID","u_instanceID"));const J=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(J,I),E.compileShader(J),E.attachShader(this.program,J);const U=E.createShader(E.VERTEX_SHADER);E.isContextLost()?this.failedToCreate=!0:(E.shaderSource(U,C),E.compileShader(U),E.attachShader(this.program,U),this.attributes={},E.linkProgram(this.program),E.deleteShader(U),E.deleteShader(J),this.fixedUniforms=w(t),this.binderUniforms=_?_.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(H=>({u_instanceID:new n.cg(H)}))(t)),(b.includes("TERRAIN")||i.indexOf("symbol")!==-1||i.indexOf("circle")!==-1)&&(this.terrainUniforms=(H=>({u_dem:new n.cg(H),u_dem_prev:new n.cg(H),u_dem_tl:new n.cj(H),u_dem_scale:new n.ci(H),u_dem_tl_prev:new n.cj(H),u_dem_scale_prev:new n.ci(H),u_dem_size:new n.ci(H),u_dem_lerp:new n.ci(H),u_exaggeration:new n.ci(H),u_depth:new n.cg(H),u_depth_size_inv:new n.cj(H),u_depth_range_unpack:new n.cj(H),u_occluder_half_size:new n.ci(H),u_occlusion_depth_offset:new n.ci(H),u_meter_to_dem:new n.ci(H),u_label_plane_matrix_inv:new n.ck(H)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new n.ch(H),u_tile_tr_up:new n.ch(H),u_tile_br_up:new n.ch(H),u_tile_bl_up:new n.ch(H),u_tile_up_scale:new n.ci(H)}))(t)),b.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new n.ck(H),u_fog_range:new n.cj(H),u_fog_color:new n.d2(H),u_fog_horizon_blend:new n.ci(H),u_fog_vertical_limit:new n.cj(H),u_fog_temporal_offset:new n.ci(H),u_frustum_tl:new n.ch(H),u_frustum_tr:new n.ch(H),u_frustum_br:new n.ch(H),u_frustum_bl:new n.ch(H),u_globe_pos:new n.ch(H),u_globe_radius:new n.ci(H),u_globe_transition:new n.ci(H),u_is_globe:new n.cg(H),u_viewport:new n.cj(H)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(H=>({u_cutoff_params:new n.d2(H)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(H=>({u_lighting_ambient_color:new n.ch(H),u_lighting_directional_dir:new n.ch(H),u_lighting_directional_color:new n.ch(H),u_ground_radiance:new n.ch(H)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(H=>({u_light_matrix_0:new n.ck(H),u_light_matrix_1:new n.ck(H),u_fade_range:new n.cj(H),u_shadow_normal_offset:new n.ch(H),u_shadow_intensity:new n.ci(H),u_shadow_texel_size:new n.ci(H),u_shadow_map_resolution:new n.ci(H),u_shadow_direction:new n.ch(H),u_shadow_bias:new n.ch(H),u_shadowmap_0:new n.cg(H),u_shadowmap_1:new n.cg(H)}))(t)))}getAttributeLocation(t,i){let f=this.attributes[i];return f===void 0&&(f=this.attributes[i]=t.getAttribLocation(this.program,i)),f}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in i)f[_]&&f[_].set(this.program,_,i[_])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in i)f[_]&&f[_].set(this.program,_,i[_])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in i)f[_].set(this.program,_,i[_])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in i)f[_].set(this.program,_,i[_])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in i)f[_].set(this.program,_,i[_])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;t.program.set(this.program);for(const _ in i)f[_].set(this.program,_,i[_])}_drawDebugWireframe(t,i,f,_,w,b,E,A,M,I){const C=t.options.wireframe;if(C.terrain===!1&&C.layers2D===!1&&C.layers3D===!1)return;const J=t.context;if(!(!(!C.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!C.layers2D||t._terrain&&t._terrain.renderingToTexture||!wh.includes(this.name))||!(!C.layers3D||!hf.includes(this.name))))return;const U=J.gl,H=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,w,J);if(!H)return;const q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");const ne=t.getOrCreateProgram(this.name,{config:this.configuration,defines:q});J.program.set(ne.program);const ae=(ce,Ze,me)=>{if(Ze[ce]&&me[ce])for(const Ne in Ze[ce])me[ce][Ne]&&me[ce][Ne].set(me.program,Ne,Ze[ce][Ne].current)};M&&M.setUniforms(ne.program,J,ne.binderUniforms,E,{zoom:A}),ae("fixedUniforms",this,ne),ae("terrainUniforms",this,ne),ae("globeUniforms",this,ne),ae("fogUniforms",this,ne),ae("lightsUniforms",this,ne),ae("shadowUniforms",this,ne),H.bind(),J.setColorMode(new Ya([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],n.ao.transparent,[!0,!0,!0,!1])),J.setDepthMode(new ca(i.func===U.LESS?U.LEQUAL:i.func,ca.ReadOnly,i.range)),J.setStencilMode(za.disabled);const se=3*b.primitiveLength*2,he=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=I||1;for(let Ze=0;Ze<ce;++Ze)ne.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ze),U.drawElements(U.LINES,se,U.UNSIGNED_SHORT,he)}else I&&I>1?U.drawElementsInstanced(U.LINES,se,U.UNSIGNED_SHORT,he,I):U.drawElements(U.LINES,se,U.UNSIGNED_SHORT,he);w.bind(),J.program.set(this.program),J.setDepthMode(i),J.setStencilMode(f),J.setColorMode(_)}checkUniforms(t,i,f){if(this.fixedDefines.includes(i)){for(const _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${_} not set but required by ${i} being defined`)}}draw(t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne){const ae=t.context,se=ae.gl;if(this.failedToCreate)return;ae.program.set(this.program),ae.setDepthMode(f),ae.setStencilMode(_),ae.setColorMode(w),ae.setCullFace(b);for(const Ze of Object.keys(this.fixedUniforms))this.fixedUniforms[Ze].set(this.program,Ze,E[Ze]);H&&H.setUniforms(this.program,ae,this.binderUniforms,J,{zoom:U});const he={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[i];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ce=ne&&ne>0?1:void 0;for(const Ze of C.get()){const me=Ze.vaos||(Ze.vaos={});if((me[A]||(me[A]=new pu)).bind(ae,this,M,H?H.getPaintVertexBuffers():[],I,Ze.vertexOffset,q||[],ce),this.forceManualRenderingForInstanceIDShaders){const Ne=ne||1;for(let we=0;we<Ne;++we)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),I?se.drawElements(i,Ze.primitiveLength*he,se.UNSIGNED_SHORT,Ze.primitiveOffset*he*2):se.drawArrays(i,Ze.vertexOffset,Ze.vertexLength)}else ne&&ne>1?se.drawElementsInstanced(i,Ze.primitiveLength*he,se.UNSIGNED_SHORT,Ze.primitiveOffset*he*2,ne):I?se.drawElements(i,Ze.primitiveLength*he,se.UNSIGNED_SHORT,Ze.primitiveOffset*he*2):se.drawArrays(i,Ze.vertexOffset,Ze.vertexLength);i===se.TRIANGLES&&I&&this._drawDebugWireframe(t,f,_,w,I,Ze,J,U,H,ne)}}}function cl(h,t,i=0){const f=Math.pow(2,t.tileID.overscaledZ),_=t.tileSize*Math.pow(2,h.transform.tileZoom)/f,w=_*(t.tileID.canonical.x+t.tileID.wrap*f),b=_*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ay(t,1,h.transform.tileZoom),u_pixel_coord_upper:[w>>16,b>>16],u_pixel_coord_lower:[65535&w,65535&b],u_pattern_transition:i}}const ul={terrain:0,flat:1},ic=n.bB(),Lu=(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae)=>{const se=t.style.light,he=se.properties.get("position"),ce=[he.x,he.y,he.z],Ze=n.dN();se.properties.get("anchor")==="viewport"&&(n.dO(Ze,-t.transform.angle),n.dP(ce,ce,Ze));const me=se.properties.get("color").toPremultipliedRenderColor(null),Ne=t.transform,we={u_matrix:h,u_lightpos:ce,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_vertical_gradient:+i,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ic,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ul[M],u_base_type:ul[I],u_ao:_,u_edge_radius:w,u_width_scale:b,u_flood_light_color:H,u_vertical_scale:q,u_flood_light_intensity:ne,u_ground_shadow_factor:ae};return Ne.projection.name==="globe"&&(we.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],we.u_zoom_transition=C,we.u_inv_rot_matrix=U,we.u_merc_center=J,we.u_up_dir=Ne.projection.upVector(new n.cC(0,0,0),J[0]*n.al,J[1]*n.al),we.u_height_lift=A),we},bh=(h,t,i,f,_,w)=>({u_matrix:h,u_edge_radius:t,u_width_scale:i,u_vertical_scale:f,u_height_type:ul[_],u_base_type:ul[w]}),yo=(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae)=>{const se=Lu(h,t,i,f,_,w,b,E,M,I,C,J,U,H,q,ne,1,[0,0,0]),he={u_height_factor:-Math.pow(2,E.overscaledZ)/A.tileSize/8};return Object.assign(se,cl(t,A,ae),he)},ys=(h,t,i,f,_,w,b,E,A,M,I)=>({u_matrix:t,u_opacity:i,u_ao_pass:f?1:0,u_meter_to_tile:_,u_ao:w,u_flood_light_intensity:b,u_flood_light_color:E,u_attenuation:A,u_edge_radius:M,u_fb:0,u_fb_size:I,u_dynamic_offset:1}),Cc=(h,t,i)=>({u_matrix:h,u_emissive_strength:t,u_ground_shadow_factor:i}),Vl=(h,t,i,f,_,w=0)=>Object.assign(Cc(h,t,_),cl(i,f,w)),sc=(h,t,i,f)=>({u_matrix:h,u_world:i,u_emissive_strength:t,u_ground_shadow_factor:f}),ju=(h,t,i,f,_,w,b=0)=>Object.assign(Vl(h,t,i,f,w,b),{u_world:_}),lm=(h,t)=>({u_matrix:h,u_ground_shadow_factor:t}),_d=(h,t,i,f,_)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:i,u_height_scale:f,u_reset_depth:_}),Lh=(h,t,i,f,_,w,b,E,A)=>({u_matrix:h,u_normal_matrix:t,u_opacity:i,u_faux_facade_ao_intensity:f,u_camera_pos:_,u_tile_to_meter:w,u_facade_emissive_chance:b,u_flood_light_color:E,u_flood_light_intensity:A}),ks=h=>({u_matrix:h}),ao=h=>({u_matrix:h}),Qn=(h,t,i,f,_,w,b,E)=>{const A=n.al/w.tileSize;return{u_matrix:h,u_inv_rot_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(E),u_extrude_scale:[i.pixelsToGLUnits[0]/A,i.pixelsToGLUnits[1]/A],u_zoom_transition:f,u_tile_id:b,u_merc_center:_}},go=(h,t,i=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:i}),op=n.bB(),lp=(h,t,i,f,_,w,b)=>{const E=h.transform,A=E.projection.name==="globe",M=A?n.dQ(E.zoom,t.canonical)*E._pixelsPerMercatorPixel:n.ay(i,1,w),I={u_matrix:t.projMatrix,u_extrude_scale:M,u_intensity:b,u_inv_rot_matrix:op,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){I.u_inv_rot_matrix=f,I.u_merc_center=_,I.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],I.u_zoom_transition=n.aj(E.zoom);const C=_[0]*n.al,J=_[1]*n.al;I.u_up_dir=E.projection.upVector(new n.cC(0,0,0),C,J)}return I};function xd(h,[t,i,f,_],[w,b]){if(w===b)return[0,0,0,0];const E=255*(h-1)/(h*(b-w));return[t*E,i*E,f*E,_*E]}function dl(h,t,[i,f]){return i===f?0:.5/h+(t-i)*(h-1)/(h*(f-i))}const wd=(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae,se,he,ce)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:w,u_scale_parent:M,u_fade_t:I.mix,u_opacity:I.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:n.dS(C.paint.get("raster-saturation")),u_contrast_factor:n.dR(C.paint.get("raster-contrast")),u_spin_weights:Zu(C.paint.get("raster-hue-rotate")),u_perspective_transform:J,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:E,u_cutoff_params:A,u_colorization_mix:xd(n.dT,q,ae),u_colorization_offset:dl(n.dT,ne,ae),u_color_ramp:H,u_texture_offset:[he/(se+2*he),se/(se+2*he)],u_texture_res:[se+2*he,se+2*he],u_emissive_strength:ce});function Zu(h){h*=Math.PI/180;const t=Math.sin(h),i=Math.cos(h);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Pc=.05,_o=(h,t,i,f,_,w,b,E,A,M,I,C)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:w,u_scale_parent:M,u_fade_t:I.mix,u_opacity:I.opacity,u_image0:0,u_image1:1,u_raster_elevation:C,u_zoom_transition:b,u_merc_center:E,u_cutoff_params:A}),jh=(h,t,i,f,_,w,b,E,A,M)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:f,u_color_ramp:w,u_velocity_res:_,u_max_speed:b,u_uv_offset:E,u_data_scale:[255*A[0],255*A[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[Pc,Pc]}),ff=(h,t,i,f,_,w,b,E,A,M)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:f,u_max_speed:_,u_speed_factor:w,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*A[0],255*A[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[Pc,Pc]}),Nu=n.bB(),vd=(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae,se,he,ce,Ze,me,Ne)=>{const we=_.transform,ge={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:we.getCameraToCenterDistance(se),u_rotate_symbol:+i,u_aspect_ratio:we.width/we.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+M,u_elevation_from_sea:A?1:0,u_pitch_with_map:+f,u_texsize:I,u_texsize_icon:C,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nu,u_up_vector:[0,-1,0],u_color_adj_mat:Ze,u_icon_transition:me||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(se)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:n.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ne||1,u_ground_shadow_factor:he,u_inv_matrix:n.bk(n.bB(),b),u_normal_scale:ce,u_lutTexture:_i.LUT};return se.name==="globe"&&(ge.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],ge.u_zoom_transition=H,ge.u_inv_rot_matrix=ne,ge.u_merc_center=q,ge.u_camera_forward=we._camera.forward(),ge.u_ecef_origin=n.dU(we.globeMatrix,U.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(we.globeMatrix),ge.u_up_vector=ae),ge},Zh=(h,t,i,f)=>({u_matrix:h,u_emissive_strength:t,u_opacity:i,u_color:f}),Nh=(h,t,i,f,_,w,b,E,A)=>Object.assign(function(M,I,C,J,U,H){const{width:q,height:ne}=J.imageManager.getPixelSize(I),ae=Math.pow(2,H.tileID.overscaledZ),se=H.tileSize*Math.pow(2,J.transform.tileZoom)/ae,he=se*(H.tileID.canonical.x+H.tileID.wrap*ae),ce=se*H.tileID.canonical.y;return{u_image:0,u_pattern_tl:C.tl,u_pattern_br:C.br,u_texsize:[q,ne],u_pattern_size:C.displaySize,u_pattern_units_to_pixels:U?[J.transform.width,-1*J.transform.height]:[1/n.ay(H,1,J.transform.tileZoom),1/n.ay(H,1,J.transform.tileZoom)],u_pixel_coord_upper:[he>>16,ce>>16],u_pixel_coord_lower:[65535&he,65535&ce]}}(0,w,b,f,E,A),{u_matrix:h,u_emissive_strength:t,u_opacity:i}),Gc=new Float32Array(n.bz([])),Eh=(h,t,i,f,_,w,b,E,A,M,I,C,J,U=[0,0,0],H,q,ne)=>{const ae=_.style.light,se=ae.properties.get("position"),he=[-se.x,-se.y,se.z],ce=n.dN();ae.properties.get("anchor")==="viewport"&&(n.dO(ce,-_.transform.angle),n.dP(he,he,ce));const Ze=I.alphaMode==="MASK",me=ae.properties.get("color").toNonPremultipliedRenderColor(null),Ne=J.paint.get("model-ambient-occlusion-intensity"),we=J.paint.get("model-color").constantOr(n.ao.white).toNonPremultipliedRenderColor(null);return we.a=J.paint.get("model-color-mix-intensity").constantOr(0),ne&&(we.r=ne[0],we.g=ne[1],we.b=ne[2],we.a=ne[3]),q&&(we.r=q.color.r,we.g=q.color.g,we.b=q.color.b,we.a=q.colorMix,C=q.emissionStrength,w=q.opacity),{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:i,u_node_matrix:f||Gc,u_lightpos:he,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_camera_pos:U,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Ze,u_alphaCutoff:I.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:M,u_baseColorTexture:_i.BaseColor,u_metallicRoughnessTexture:_i.MetallicRoughness,u_normalTexture:_i.Normal,u_occlusionTexture:_i.Occlusion,u_emissionTexture:_i.Emission,u_lutTexture:_i.LUT,u_color_mix:we.toArray01(),u_aoIntensity:Ne,u_emissive_strength:C,u_occlusionTextureTransform:H||[0,0,0,0]}},oc=(h,t=Gc,i=Gc)=>({u_matrix:h,u_instance:t,u_node_matrix:i}),pf={fillExtrusion:h=>({u_matrix:new n.ck(h),u_lightpos:new n.ch(h),u_lightintensity:new n.ci(h),u_lightcolor:new n.ch(h),u_vertical_gradient:new n.ci(h),u_opacity:new n.ci(h),u_edge_radius:new n.ci(h),u_width_scale:new n.ci(h),u_ao:new n.cj(h),u_height_type:new n.cg(h),u_base_type:new n.cg(h),u_tile_id:new n.ch(h),u_zoom_transition:new n.ci(h),u_inv_rot_matrix:new n.ck(h),u_merc_center:new n.cj(h),u_up_dir:new n.ch(h),u_height_lift:new n.ci(h),u_flood_light_color:new n.ch(h),u_vertical_scale:new n.ci(h),u_flood_light_intensity:new n.ci(h),u_ground_shadow_factor:new n.ch(h)}),fillExtrusionDepth:h=>({u_matrix:new n.ck(h),u_edge_radius:new n.ci(h),u_width_scale:new n.ci(h),u_vertical_scale:new n.ci(h),u_height_type:new n.cg(h),u_base_type:new n.cg(h)}),fillExtrusionPattern:h=>({u_matrix:new n.ck(h),u_lightpos:new n.ch(h),u_lightintensity:new n.ci(h),u_lightcolor:new n.ch(h),u_vertical_gradient:new n.ci(h),u_height_factor:new n.ci(h),u_edge_radius:new n.ci(h),u_width_scale:new n.ci(h),u_ao:new n.cj(h),u_height_type:new n.cg(h),u_base_type:new n.cg(h),u_tile_id:new n.ch(h),u_zoom_transition:new n.ci(h),u_inv_rot_matrix:new n.ck(h),u_merc_center:new n.cj(h),u_up_dir:new n.ch(h),u_height_lift:new n.ci(h),u_image:new n.cg(h),u_texsize:new n.cj(h),u_pixel_coord_upper:new n.cj(h),u_pixel_coord_lower:new n.cj(h),u_tile_units_to_pixels:new n.ci(h),u_opacity:new n.ci(h),u_pattern_transition:new n.ci(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new n.ck(h),u_opacity:new n.ci(h),u_ao_pass:new n.ci(h),u_meter_to_tile:new n.ci(h),u_ao:new n.cj(h),u_flood_light_intensity:new n.ci(h),u_flood_light_color:new n.ch(h),u_attenuation:new n.ci(h),u_edge_radius:new n.ci(h),u_fb:new n.cg(h),u_fb_size:new n.ci(h),u_dynamic_offset:new n.ci(h)}),fill:h=>({u_matrix:new n.ck(h),u_emissive_strength:new n.ci(h),u_ground_shadow_factor:new n.ch(h)}),fillPattern:h=>({u_matrix:new n.ck(h),u_emissive_strength:new n.ci(h),u_image:new n.cg(h),u_texsize:new n.cj(h),u_pixel_coord_upper:new n.cj(h),u_pixel_coord_lower:new n.cj(h),u_tile_units_to_pixels:new n.ci(h),u_ground_shadow_factor:new n.ch(h),u_pattern_transition:new n.ci(h)}),fillOutline:h=>({u_matrix:new n.ck(h),u_emissive_strength:new n.ci(h),u_world:new n.cj(h),u_ground_shadow_factor:new n.ch(h)}),fillOutlinePattern:h=>({u_matrix:new n.ck(h),u_emissive_strength:new n.ci(h),u_world:new n.cj(h),u_image:new n.cg(h),u_texsize:new n.cj(h),u_pixel_coord_upper:new n.cj(h),u_pixel_coord_lower:new n.cj(h),u_tile_units_to_pixels:new n.ci(h),u_ground_shadow_factor:new n.ch(h),u_pattern_transition:new n.ci(h)}),building:h=>({u_matrix:new n.ck(h),u_normal_matrix:new n.ck(h),u_opacity:new n.ci(h),u_faux_facade_ao_intensity:new n.ci(h),u_camera_pos:new n.ch(h),u_tile_to_meter:new n.ci(h),u_facade_emissive_chance:new n.ci(h),u_flood_light_color:new n.ch(h),u_flood_light_intensity:new n.ci(h)}),buildingBloom:h=>({u_matrix:new n.ck(h)}),buildingDepth:h=>({u_matrix:new n.ck(h)}),elevatedStructuresDepth:h=>({u_matrix:new n.ck(h),u_depth_bias:new n.ci(h)}),elevatedStructures:h=>({u_matrix:new n.ck(h),u_ground_shadow_factor:new n.ch(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new n.ck(h),u_camera_pos:new n.ch(h),u_depth_bias:new n.ci(h),u_height_scale:new n.ci(h),u_reset_depth:new n.ci(h)}),circle:n.dX,collisionBox:h=>({u_matrix:new n.ck(h),u_inv_rot_matrix:new n.ck(h),u_camera_to_center_distance:new n.ci(h),u_extrude_scale:new n.cj(h),u_zoom_transition:new n.ci(h),u_merc_center:new n.cj(h),u_tile_id:new n.ch(h)}),collisionCircle:h=>({u_matrix:new n.ck(h),u_inv_matrix:new n.ck(h),u_camera_to_center_distance:new n.ci(h),u_viewport_size:new n.cj(h)}),debug:h=>({u_color:new n.dA(h),u_matrix:new n.ck(h),u_overlay:new n.cg(h),u_overlay_scale:new n.ci(h)}),clippingMask:h=>({u_matrix:new n.ck(h)}),heatmap:h=>({u_extrude_scale:new n.ci(h),u_intensity:new n.ci(h),u_matrix:new n.ck(h),u_inv_rot_matrix:new n.ck(h),u_merc_center:new n.cj(h),u_tile_id:new n.ch(h),u_zoom_transition:new n.ci(h),u_up_dir:new n.ch(h)}),heatmapTexture:h=>({u_image:new n.cg(h),u_color_ramp:new n.cg(h),u_opacity:new n.ci(h)}),hillshade:h=>({u_matrix:new n.ck(h),u_image:new n.cg(h),u_latrange:new n.cj(h),u_light:new n.cj(h),u_shadow:new n.dA(h),u_highlight:new n.dA(h),u_emissive_strength:new n.ci(h),u_accent:new n.dA(h)}),hillshadePrepare:h=>({u_matrix:new n.ck(h),u_image:new n.cg(h),u_dimension:new n.cj(h),u_zoom:new n.ci(h)}),line:n.dW,linePattern:n.dV,raster:h=>({u_matrix:new n.ck(h),u_normalize_matrix:new n.ck(h),u_globe_matrix:new n.ck(h),u_merc_matrix:new n.ck(h),u_grid_matrix:new n.dB(h),u_tl_parent:new n.cj(h),u_scale_parent:new n.ci(h),u_fade_t:new n.ci(h),u_opacity:new n.ci(h),u_image0:new n.cg(h),u_image1:new n.cg(h),u_brightness_low:new n.ci(h),u_brightness_high:new n.ci(h),u_saturation_factor:new n.ci(h),u_contrast_factor:new n.ci(h),u_spin_weights:new n.ch(h),u_perspective_transform:new n.cj(h),u_raster_elevation:new n.ci(h),u_zoom_transition:new n.ci(h),u_merc_center:new n.cj(h),u_cutoff_params:new n.d2(h),u_colorization_mix:new n.d2(h),u_colorization_offset:new n.ci(h),u_color_ramp:new n.cg(h),u_texture_offset:new n.cj(h),u_texture_res:new n.cj(h),u_emissive_strength:new n.ci(h)}),rasterParticle:h=>({u_matrix:new n.ck(h),u_normalize_matrix:new n.ck(h),u_globe_matrix:new n.ck(h),u_merc_matrix:new n.ck(h),u_grid_matrix:new n.dB(h),u_tl_parent:new n.cj(h),u_scale_parent:new n.ci(h),u_fade_t:new n.ci(h),u_opacity:new n.ci(h),u_image0:new n.cg(h),u_image1:new n.cg(h),u_raster_elevation:new n.ci(h),u_zoom_transition:new n.ci(h),u_merc_center:new n.cj(h),u_cutoff_params:new n.d2(h)}),rasterParticleTexture:h=>({u_texture:new n.cg(h),u_opacity:new n.ci(h)}),rasterParticleDraw:h=>({u_particle_texture:new n.cg(h),u_particle_texture_side_len:new n.ci(h),u_tile_offset:new n.cj(h),u_velocity:new n.cg(h),u_color_ramp:new n.cg(h),u_velocity_res:new n.cj(h),u_max_speed:new n.ci(h),u_uv_offset:new n.cj(h),u_data_scale:new n.cj(h),u_data_offset:new n.ci(h),u_particle_pos_scale:new n.ci(h),u_particle_pos_offset:new n.cj(h)}),rasterParticleUpdate:h=>({u_particle_texture:new n.cg(h),u_particle_texture_side_len:new n.ci(h),u_velocity:new n.cg(h),u_velocity_res:new n.cj(h),u_max_speed:new n.ci(h),u_speed_factor:new n.ci(h),u_reset_rate:new n.ci(h),u_rand_seed:new n.ci(h),u_uv_offset:new n.cj(h),u_data_scale:new n.cj(h),u_data_offset:new n.ci(h),u_particle_pos_scale:new n.ci(h),u_particle_pos_offset:new n.cj(h)}),symbol:h=>({u_is_size_zoom_constant:new n.cg(h),u_is_size_feature_constant:new n.cg(h),u_size_t:new n.ci(h),u_size:new n.ci(h),u_camera_to_center_distance:new n.ci(h),u_rotate_symbol:new n.cg(h),u_aspect_ratio:new n.ci(h),u_fade_change:new n.ci(h),u_matrix:new n.ck(h),u_label_plane_matrix:new n.ck(h),u_coord_matrix:new n.ck(h),u_is_text:new n.cg(h),u_elevation_from_sea:new n.cg(h),u_pitch_with_map:new n.cg(h),u_texsize:new n.cj(h),u_texsize_icon:new n.cj(h),u_texture:new n.cg(h),u_texture_icon:new n.cg(h),u_gamma_scale:new n.ci(h),u_device_pixel_ratio:new n.ci(h),u_tile_id:new n.ch(h),u_zoom_transition:new n.ci(h),u_inv_rot_matrix:new n.ck(h),u_merc_center:new n.cj(h),u_camera_forward:new n.ch(h),u_tile_matrix:new n.ck(h),u_up_vector:new n.ch(h),u_ecef_origin:new n.ch(h),u_is_halo:new n.cg(h),u_icon_transition:new n.ci(h),u_color_adj_mat:new n.ck(h),u_scale_factor:new n.ci(h),u_ground_shadow_factor:new n.ch(h),u_inv_matrix:new n.ck(h),u_normal_scale:new n.ci(h),u_lutTexture:new n.cg(h)}),background:h=>({u_matrix:new n.ck(h),u_emissive_strength:new n.ci(h),u_opacity:new n.ci(h),u_color:new n.dA(h)}),backgroundPattern:h=>({u_matrix:new n.ck(h),u_emissive_strength:new n.ci(h),u_opacity:new n.ci(h),u_image:new n.cg(h),u_pattern_tl:new n.cj(h),u_pattern_br:new n.cj(h),u_texsize:new n.cj(h),u_pattern_size:new n.cj(h),u_pixel_coord_upper:new n.cj(h),u_pixel_coord_lower:new n.cj(h),u_pattern_units_to_pixels:new n.cj(h)}),terrainRaster:h=>({u_matrix:new n.ck(h),u_image0:new n.cg(h),u_skirt_height:new n.ci(h),u_ground_shadow_factor:new n.ch(h)}),skybox:h=>({u_matrix:new n.ck(h),u_sun_direction:new n.ch(h),u_cubemap:new n.cg(h),u_opacity:new n.ci(h),u_temporal_offset:new n.ci(h)}),skyboxGradient:h=>({u_matrix:new n.ck(h),u_color_ramp:new n.cg(h),u_center_direction:new n.ch(h),u_radius:new n.ci(h),u_opacity:new n.ci(h),u_temporal_offset:new n.ci(h)}),skyboxCapture:h=>({u_matrix_3f:new n.dB(h),u_sun_direction:new n.ch(h),u_sun_intensity:new n.ci(h),u_color_tint_r:new n.d2(h),u_color_tint_m:new n.d2(h),u_luminance:new n.ci(h)}),globeRaster:h=>({u_proj_matrix:new n.ck(h),u_globe_matrix:new n.ck(h),u_normalize_matrix:new n.ck(h),u_merc_matrix:new n.ck(h),u_zoom_transition:new n.ci(h),u_merc_center:new n.cj(h),u_image0:new n.cg(h),u_grid_matrix:new n.dB(h),u_skirt_height:new n.ci(h),u_far_z_cutoff:new n.ci(h),u_frustum_tl:new n.ch(h),u_frustum_tr:new n.ch(h),u_frustum_br:new n.ch(h),u_frustum_bl:new n.ch(h),u_globe_pos:new n.ch(h),u_globe_radius:new n.ci(h),u_viewport:new n.cj(h)}),globeAtmosphere:h=>({u_frustum_tl:new n.ch(h),u_frustum_tr:new n.ch(h),u_frustum_br:new n.ch(h),u_frustum_bl:new n.ch(h),u_horizon:new n.ci(h),u_transition:new n.ci(h),u_fadeout_range:new n.ci(h),u_atmosphere_fog_color:new n.d2(h),u_high_color:new n.d2(h),u_space_color:new n.d2(h),u_temporal_offset:new n.ci(h),u_horizon_angle:new n.ci(h)}),model:h=>({u_matrix:new n.ck(h),u_lighting_matrix:new n.ck(h),u_normal_matrix:new n.ck(h),u_node_matrix:new n.ck(h),u_lightpos:new n.ch(h),u_lightintensity:new n.ci(h),u_lightcolor:new n.ch(h),u_camera_pos:new n.ch(h),u_opacity:new n.ci(h),u_baseColorFactor:new n.d2(h),u_emissiveFactor:new n.d2(h),u_metallicFactor:new n.ci(h),u_roughnessFactor:new n.ci(h),u_baseTextureIsAlpha:new n.cg(h),u_alphaMask:new n.cg(h),u_alphaCutoff:new n.ci(h),u_baseColorTexture:new n.cg(h),u_metallicRoughnessTexture:new n.cg(h),u_normalTexture:new n.cg(h),u_occlusionTexture:new n.cg(h),u_emissionTexture:new n.cg(h),u_lutTexture:new n.cg(h),u_color_mix:new n.d2(h),u_aoIntensity:new n.ci(h),u_emissive_strength:new n.ci(h),u_occlusionTextureTransform:new n.d2(h)}),modelDepth:h=>({u_matrix:new n.ck(h),u_instance:new n.ck(h),u_node_matrix:new n.ck(h)}),groundShadow:h=>({u_matrix:new n.ck(h),u_ground_shadow_factor:new n.ch(h)}),stars:h=>({u_matrix:new n.ck(h),u_up:new n.ch(h),u_right:new n.ch(h),u_intensity_multiplier:new n.ci(h)}),snowParticle:h=>({u_modelview:new n.ck(h),u_projection:new n.ck(h),u_time:new n.ci(h),u_cam_pos:new n.ch(h),u_velocityConeAperture:new n.ci(h),u_velocity:new n.ci(h),u_horizontalOscillationRadius:new n.ci(h),u_horizontalOscillationRate:new n.ci(h),u_boxSize:new n.ci(h),u_billboardSize:new n.ci(h),u_simpleShapeParameters:new n.cj(h),u_screenSize:new n.cj(h),u_thinningCenterPos:new n.cj(h),u_thinningShape:new n.ch(h),u_thinningAffectedRatio:new n.ci(h),u_thinningParticleOffset:new n.ci(h),u_particleColor:new n.d2(h),u_direction:new n.ch(h)}),rainParticle:h=>({u_modelview:new n.ck(h),u_projection:new n.ck(h),u_time:new n.ci(h),u_cam_pos:new n.ch(h),u_texScreen:new n.cg(h),u_velocityConeAperture:new n.ci(h),u_velocity:new n.ci(h),u_boxSize:new n.ci(h),u_rainDropletSize:new n.cj(h),u_distortionStrength:new n.ci(h),u_rainDirection:new n.ch(h),u_color:new n.d2(h),u_screenSize:new n.cj(h),u_thinningCenterPos:new n.cj(h),u_thinningShape:new n.ch(h),u_thinningAffectedRatio:new n.ci(h),u_thinningParticleOffset:new n.ci(h),u_shapeDirectionalPower:new n.ci(h),u_shapeNormalPower:new n.ci(h),u_mode:new n.ci(h)}),vignette:h=>({u_vignetteShape:new n.ch(h),u_vignetteColor:new n.d2(h)}),occlusion:h=>({u_matrix:new n.ck(h),u_anchorPos:new n.ch(h),u_screenSizePx:new n.cj(h),u_occluderSizePx:new n.cj(h),u_color:new n.d2(h)})};class xo{constructor(t,i,f,_){this.id=xo.uniqueIdxCounter,xo.uniqueIdxCounter++,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||_||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=xo.uniqueIdxCounter,xo.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}xo.uniqueIdxCounter=0;const mf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cp{constructor(t,i,f,_,w,b){this.length=i.length,this.attributes=f,this.itemSize=i.bytesPerElement,this.dynamicDraw=_,this.instanceCount=b,this.context=t;const E=t.gl;this.buffer=E.createBuffer(),t.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||w||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let f=0;f<this.attributes.length;f++){const _=i.getAttributeLocation(t,this.attributes[f].name);_!==-1&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,i,f){for(let _=0;_<this.attributes.length;_++){const w=this.attributes[_],b=i.getAttributeLocation(t,w.name);b!==-1&&t.vertexAttribPointer(b,w.components,t[mf[w.type]],!1,this.itemSize,w.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(t,i,f){for(let _=0;_<this.attributes.length;_++){const w=i.getAttributeLocation(t,this.attributes[_].name);w!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(w,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bd{constructor(t,i,f,_,w){this.context=t,this.width=i,this.height=f;const b=this.framebuffer=t.gl.createFramebuffer();_&&(this.colorAttachment=new sp(t,b)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new vu(t,b):new Dc(t,b))}destroy(){const t=this.context.gl;if(this.colorAttachment){const i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{const i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class Ld{constructor(t,i){this.gl=t,this.clearColor=new of(this),this.clearDepth=new yu(this),this.clearStencil=new lf(this),this.colorMask=new ud(this),this.depthMask=new nm(this),this.stencilMask=new hy(this),this.stencilFunc=new im(this),this.stencilOp=new sm(this),this.stencilTest=new gu(this),this.depthRange=new cf(this),this.depthTest=new uf(this),this.depthFunc=new mh(this),this.blend=new dd(this),this.blendFunc=new yh(this),this.blendColor=new _u(this),this.blendEquation=new xu(this),this.cullFace=new gh(this),this.cullFaceSide=new hd(this),this.frontFace=new df(this),this.program=new Rl(this),this.activeTexture=new ip(this),this.viewport=new il(this),this.bindFramebuffer=new po(this),this.bindRenderbuffer=new Fc(this),this.bindTexture=new sl(this),this.bindVertexBuffer=new fd(this),this.bindElementBuffer=new _h(this),this.bindVertexArrayOES=new om(this),this.pixelStoreUnpack=new Oc(this),this.pixelStoreUnpackPremultiplyAlpha=new pd(this),this.pixelStoreUnpackFlipY=new ol(this),this.options=i?Object.assign({},i):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=i&&!!i.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,f){return new xo(this,t,i,f)}createVertexBuffer(t,i,f,_,w){return new cp(this,t,i,f,_,w)}createRenderbuffer(t,i,f){const _=this.gl,w=_.createRenderbuffer();return this.bindRenderbuffer.set(w),_.renderbufferStorage(_.RENDERBUFFER,t,i,f),this.bindRenderbuffer.set(null),w}createFramebuffer(t,i,f,_){return new bd(this,t,i,f,_)}clear({color:t,depth:i,stencil:f,colorMask:_}){const w=this.gl;let b=0;t&&(b|=w.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),i!==void 0&&(b|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),f!==void 0&&(b|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),w.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bx(t.blendFunction,Ya.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Js;function Zs(h,t,i,f,_,w,b){const E=h.context,A=E.gl,M=h.transform,I=[n.aF(M.center.lng),n.aJ(M.center.lat)],C=i.layout.get("symbol-placement"),J=i.layout.get("text-variable-anchor"),U=i.layout.get("icon-rotation-alignment")==="map",H=i.layout.get("text-rotation-alignment")==="map",q=C!=="point",ne=[];let ae=0,se=0;for(let ge=0;ge<f.length;ge++){const Se=f[ge],Pe=t.getTile(Se),Fe=Pe.getBucket(i);if(!Fe)continue;const it=Fe.getProjection().createInversionMatrix(M,Se.canonical),qe=[],dt=qh(Se,Fe,M),Mt=!b&&U&&q,Xe=b&&H&&q,Ie=J&&Fe.hasTextData(),ct=Fe.hasIconTextFit()&&Ie&&Fe.hasIconData(),et=Mt||Xe||b&&Ie||ct,jt=Fe.projection.name==="globe",Ct=jt?n.aj(M.zoom):0;jt&&(qe.push("PROJECTION_GLOBE_VIEW"),et&&qe.push("PROJECTED_POS_ON_VIEWPORT"));const oa=h.getOrCreateProgram("collisionBox",{defines:qe});let Bt=dt;_[0]===0&&_[1]===0||(Bt=h.translatePosMatrix(dt,Pe,_,w));const Ot=b?Fe.textCollisionBox:Fe.iconCollisionBox,la=Fe.collisionCircleArray;if(la.length>0){const Ht=n.bB(),ia=Bt;n.cO(Ht,Fe.placementInvProjMatrix,M.glCoordMatrix),n.cO(Ht,Ht,Fe.placementViewportMatrix),ne.push({circleArray:la,circleOffset:se,transform:ia,invTransform:Ht,projection:Fe.getProjection()}),ae+=la.length/4,se=ae}if(!Ot)continue;h.terrain&&h.terrain.setupElevationDraw(Pe,oa);const ra=jt?[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z]:[0,0,0];oa.draw(h,A.LINES,ca.disabled,za.disabled,h.colorModeForRenderPass(),Ba.disabled,Qn(Bt,it,M,Ct,I,Pe,ra,Fe.getProjection()),i.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,null,M.zoom,null,[Ot.collisionVertexBuffer,Ot.collisionVertexBufferExt])}if(!b||!ne.length)return;const he=h.getOrCreateProgram("collisionCircle"),ce=new n.dY;ce.resize(4*ae),ce._trim();let Ze=0;for(const ge of ne)for(let Se=0;Se<ge.circleArray.length/4;Se++){const Pe=4*Se,Fe=ge.circleArray[Pe+0],it=ge.circleArray[Pe+1],qe=ge.circleArray[Pe+2],dt=ge.circleArray[Pe+3];ce.emplace(Ze++,Fe,it,qe,dt,0),ce.emplace(Ze++,Fe,it,qe,dt,1),ce.emplace(Ze++,Fe,it,qe,dt,2),ce.emplace(Ze++,Fe,it,qe,dt,3)}(!Js||Js.length<2*ae)&&(Js=function(ge){const Se=2*ge,Pe=new n.b0;Pe.resize(Se),Pe._trim();for(let Fe=0;Fe<Se;Fe++){const it=6*Fe;Pe.uint16[it+0]=4*Fe+0,Pe.uint16[it+1]=4*Fe+1,Pe.uint16[it+2]=4*Fe+2,Pe.uint16[it+3]=4*Fe+2,Pe.uint16[it+4]=4*Fe+3,Pe.uint16[it+5]=4*Fe+0}return Pe}(ae));const me=E.createIndexBuffer(Js,!0),Ne=E.createVertexBuffer(ce,n.dZ.members,!0);for(const ge of ne){const Se={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(we=M).getCameraToCenterDistance(ge.projection),u_viewport_size:[we.width,we.height]};he.draw(h,A.TRIANGLES,ca.disabled,za.disabled,h.colorModeForRenderPass(),Ba.disabled,Se,i.id,Ne,me,n.bf.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,M.zoom)}var we;Ne.destroy(),me.destroy()}const ro=n.bB();function Sh(h){const t=h._camera.getWorldToCamera(h.worldSize,1),i=n.aB([],t,h.globeMatrix);n.bk(i,i);const f=[0,0,0],_=[0,1,0,0];return n.aC(_,_,i),f[0]=_[0],f[1]=_[1],f[2]=_[2],n.aw(f,f),f}function zh({width:h,height:t,anchor:i,textOffset:f,textScale:_},w){const{horizontalAlign:b,verticalAlign:E}=n.c0(i),A=-(b-.5)*h,M=-(E-.5)*t,I=n.c1(i,f);return new n.P((A/_+I[0])*w,(M/_+I[1])*w)}function ko(h,t,i,f,_,w,b,E,A,M){const I=h.text.placedSymbolArray,C=h.text.dynamicLayoutVertexArray,J=h.icon.dynamicLayoutVertexArray,U={},H=h.getProjection(),q=eh(b,H,_),ne=_.elevation,ae=H.upVectorScale(b.canonical,_.center.lat,_.worldSize).metersToTile;C.clear();for(let se=0;se<I.length;se++){const he=I.get(se),{tileAnchorX:ce,tileAnchorY:Ze,numGlyphs:me}=he,Ne=he.hidden||!he.crossTileID||h.allowVerticalPlacement&&!he.placedOrientation?null:f[he.crossTileID];if(Ne){let we=0,ge=0,Se=0;const Pe=h.elevationType==="road";if(ne||Pe){const et=Pe?h.getElevationFeatureForText(se):null,jt=n.bU.getAtTileOffset(b,new n.P(ce,Ze),ne,et),[Ct,oa,Bt]=H.upVector(b.canonical,ce,Ze);we=jt*Ct*ae,ge=jt*oa*ae,Se=jt*Bt*ae}let[Fe,it,qe,dt]=xn(he.projectedAnchorX+we,he.projectedAnchorY+ge,he.projectedAnchorZ+Se,i?q:w);const Mt=Ec(_.getCameraToCenterDistance(H),dt);let Xe=n.bL(h.textSizeData,A,he)*Mt/n.bX;i&&(Xe*=h.tilePixelRatio/E);const Ie=zh(Ne,Xe);i?({x:Fe,y:it,z:qe}=H.projectTilePoint(ce+Ie.x,Ze+Ie.y,b.canonical),[Fe,it,qe]=xn(Fe+we,it+ge,qe+Se,w)):(t&&Ie._rotate(-_.angle),Fe+=Ie.x,it+=Ie.y,qe=0);const ct=h.allowVerticalPlacement&&he.placedOrientation===n.bK.vertical?Math.PI/2:0;for(let et=0;et<me;et++)n.bN(C,Fe,it,qe,ct);M&&he.associatedIconIndex>=0&&(U[he.associatedIconIndex]={x:Fe,y:it,z:qe,angle:ct})}else ql(me,C)}if(M){J.clear();const se=h.icon.placedSymbolArray;for(let he=0;he<se.length;he++){const ce=se.get(he),{numGlyphs:Ze}=ce,me=U[he];if(ce.hidden||!me)ql(Ze,J);else{const{x:Ne,y:we,z:ge,angle:Se}=me;for(let Pe=0;Pe<Ze;Pe++)n.bN(J,Ne,we,ge,Se)}}h.icon.dynamicLayoutVertexBuffer.updateData(J)}h.text.dynamicLayoutVertexBuffer.updateData(C)}function Jo(h,t,i,f,_,w,b={}){const E=i.paint.get("icon-translate"),A=i.paint.get("text-translate"),M=i.paint.get("icon-translate-anchor"),I=i.paint.get("text-translate-anchor"),C=i.layout.get("icon-rotation-alignment"),J=i.layout.get("text-rotation-alignment"),U=i.layout.get("icon-pitch-alignment"),H=i.layout.get("text-pitch-alignment"),q=i.layout.get("icon-keep-upright"),ne=i.layout.get("text-keep-upright"),ae=i.paint.get("icon-color-saturation"),se=i.paint.get("icon-color-contrast"),he=i.paint.get("icon-color-brightness-min"),ce=i.paint.get("icon-color-brightness-max"),Ze=i.layout.get("symbol-elevation-reference")==="sea",me=i.layout.get("icon-image-use-theme")==="none",Ne=h.context,we=Ne.gl,ge=h.transform,Se=C==="map",Pe=J==="map",Fe=U==="map",it=H==="map",qe=i.layout.get("symbol-sort-key").constantOr(1)!==void 0;let dt=!1;const Mt=h.depthModeForSublayer(0,ca.ReadOnly),Xe=new ca(h.context.gl.LEQUAL,ca.ReadOnly,h.depthRangeFor3D),Ie=[n.aF(ge.center.lng),n.aJ(ge.center.lat)],ct=i.layout.get("text-variable-anchor"),et=ge.projection.name==="globe",jt=[],Ct=[0,-1,0];for(const oa of f){const Bt=t.getTile(oa),Ot=Bt.getBucket(i);if(!Ot||Ot.projection.name==="mercator"&&et||Ot.fullyClipped)continue;const la=Ot.projection.name==="globe",ra=la?n.aj(ge.zoom):0,Ht=eh(oa,Ot.getProjection(),ge),ia=ge.calculatePixelsToTileUnitsMatrix(Bt),va=ct&&Ot.hasTextData(),ir=Ot.hasIconTextFit()&&va&&Ot.hasIconData(),Oa=Ot.getProjection().createInversionMatrix(ge,oa.canonical),Qr=(1<<Bt.tileID.canonical.z)*n.al/h.transform.worldSize,Ta=_r=>{let Va=[0,0,0];if(_r){const yr=h.style.directionalLight,_n=h.style.ambientLight;yr&&_n&&(Va=Bo(h.style,yr,_n))}return Va},pr=_r=>{ge.depthOcclusionForSymbolsAndCircles&&(i.hasOcclusionOpacityProperties||h.terrain)&&(_r.push("DEPTH_D24"),_r.push("DEPTH_OCCLUSION"))},Ua=_r=>{i.lut&&!me&&(i.lut.texture||(i.lut.texture=new n.d_(h.context,i.lut.image,[i.lut.image.height,i.lut.image.height,i.lut.image.height],Ne.gl.RGBA8)),Ne.activeTexture.set(Ne.gl.TEXTURE0+_i.LUT),i.lut.texture&&i.lut.texture.bind(Ne.gl.LINEAR,Ne.gl.CLAMP_TO_EDGE),_r.push("APPLY_LUT_ON_GPU"))},Cr=()=>{const _r=Se&&i.layout.get("symbol-placement")!=="point",Va=[];pr(Va),Ua(Va);const yr=_r||ir,_n=Ot.elevationType==="road",Hn=h.shadowRenderer,wn=_n&&Fe&&!!Hn&&Hn.enabled,Dn=Ta(wn),Ss=_n&&Fe&&!h.terrain?Xe:Mt,xs=i.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&Fe&&Va.push("PITCH_WITH_MAP_TERRAIN"),la&&(Va.push("PROJECTION_GLOBE_VIEW"),yr&&Va.push("PROJECTED_POS_ON_VIEWPORT")),xs>0&&Ot.hasAnySecondaryIcon&&Va.push("ICON_TRANSITION"),!Ot.icon.zOffsetVertexBuffer||_n&&h.terrain||Va.push("Z_OFFSET"),ae===0&&se===0&&he===0&&ce===1||Va.push("COLOR_ADJUSTMENT"),Ot.sdfIcons&&Va.push("RENDER_SDF"),wn&&Va.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),_n&&Fe&&!h.terrain&&Ot.icon.orientationVertexBuffer&&Va.push("ELEVATED_ROADS");const Si=Ot.icon.programConfigurations.get(i.id),Fi=h.getOrCreateProgram("symbol",{config:Si,defines:Va}),so=Bt.imageAtlasTexture?Bt.imageAtlasTexture.size:[0,0],Oi=Ot.iconSizeData,Zo=n.bJ(Oi,ge.zoom),No=Fe||!ge.isOrthographic,vi=$l(Ht,Bt.tileID.canonical,Fe,Se,ge,Ot.getProjection(),ia),vn=Nl(Ht,Bt.tileID.canonical,Fe,Se,ge,Ot.getProjection(),ia),Cn=h.translatePosMatrix(vn,Bt,E,M,!0),Gr=h.translatePosMatrix(Ht,Bt,E,M),Yn=yr?ro:vi,Di=Se&&!Fe&&!_r;let bn=Ct;!et&&!ge.mercatorFromTransition||Se||(bn=Sh(ge));const Eo=la?bn:Ct,Fl=i.getColorAdjustmentMatrix(ae,se,he,ce),fc=vd(Oi.kind,Zo,Di,Fe,h,Gr,Yn,Cn,Ze,!1,so,[0,0],0,oa,ra,Ie,Oa,Eo,Ot.getProjection(),Dn,Qr,Fl,xs,null),pc=Bt.imageAtlasTexture?Bt.imageAtlasTexture:null,y=i.layout.get("icon-size").constantOr(0)!==1||Ot.iconsNeedLinear,v=Ot.sdfIcons||h.options.rotating||h.options.zooming||y||No?we.LINEAR:we.NEAREST,z=Ot.sdfIcons&&i.paint.get("icon-halo-width").constantOr(1)!==0,k=h.terrain&&Fe&&_r?n.bk(n.bB(),vi):ro;if(_r&&Ot.icon){const W=n.bU.getAtTileOffsetFunc(oa,ge.center.lat,ge.worldSize,Ot.getProjection()),ee=Nc(Ht,Bt.tileID.canonical,Fe,Se,ge,Ot.getProjection(),ia),be=i.layout.get("icon-size-scale-range"),He=n.aA(h.scaleFactor,be[0],be[1]);cu(Ot,Ht,h,!1,ee,vn,Fe,q,W,oa,He)}return{program:Fi,buffers:Ot.icon,uniformValues:fc,atlasTexture:pc,atlasTextureIcon:null,atlasInterpolation:v,atlasInterpolationIcon:null,isSDF:Ot.sdfIcons,hasHalo:z,depthMode:Ss,tile:Bt,renderWithShadows:wn,labelPlaneMatrixInv:k}},mr=()=>{const _r=Pe&&i.layout.get("symbol-placement")!=="point",Va=[],yr=_r||ct||ir,_n=Ot.elevationType==="road",Hn=h.shadowRenderer,wn=_n&&it&&!!Hn&&Hn.enabled,Dn=Ta(wn),Ss=_n&&it&&!h.terrain?Xe:Mt;h.terrainRenderModeElevated()&&it&&Va.push("PITCH_WITH_MAP_TERRAIN"),la&&(Va.push("PROJECTION_GLOBE_VIEW"),yr&&Va.push("PROJECTED_POS_ON_VIEWPORT")),!Ot.text.zOffsetVertexBuffer||_n&&h.terrain||Va.push("Z_OFFSET"),Ot.iconsInText&&Va.push("RENDER_TEXT_AND_SYMBOL"),Va.push("RENDER_SDF"),wn&&Va.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),_n&&it&&!h.terrain&&Ot.text.orientationVertexBuffer&&Va.push("ELEVATED_ROADS"),pr(Va);const xs=Ot.text.programConfigurations.get(i.id),Si=h.getOrCreateProgram("symbol",{config:xs,defines:Va});let Fi,so=[0,0],Oi=null;const Zo=Ot.textSizeData;Ot.iconsInText&&(so=Bt.imageAtlasTexture?Bt.imageAtlasTexture.size:[0,0],Oi=Bt.imageAtlasTexture?Bt.imageAtlasTexture:null,Fi=it||!ge.isOrthographic||h.options.rotating||h.options.zooming||Zo.kind==="composite"||Zo.kind==="camera"?we.LINEAR:we.NEAREST);const No=Bt.glyphAtlasTexture?Bt.glyphAtlasTexture.size:[0,0],vi=i.layout.get("text-size-scale-range"),vn=n.aA(h.scaleFactor,vi[0],vi[1]),Cn=n.bJ(Zo,ge.zoom,vn),Gr=$l(Ht,Bt.tileID.canonical,it,Pe,ge,Ot.getProjection(),ia),Yn=Nl(Ht,Bt.tileID.canonical,it,Pe,ge,Ot.getProjection(),ia),Di=h.translatePosMatrix(Yn,Bt,A,I,!0),bn=h.translatePosMatrix(Ht,Bt,A,I),Eo=yr?ro:Gr,Fl=Pe&&!it&&!_r;let fc=Ct;!et&&!ge.mercatorFromTransition||Pe||(fc=Sh(ge));const pc=vd(Zo.kind,Cn,Fl,it,h,bn,Eo,Di,Ze,!0,No,so,0,oa,ra,Ie,Oa,la?fc:Ct,Ot.getProjection(),Dn,Qr,null,null,vn),y=Bt.glyphAtlasTexture?Bt.glyphAtlasTexture:null,v=we.LINEAR,z=i.paint.get("text-halo-width").constantOr(1)!==0,k=h.terrain&&it&&_r?n.bk(n.bB(),Gr):ro;if(_r&&Ot.text){const W=n.bU.getAtTileOffsetFunc(oa,ge.center.lat,ge.worldSize,Ot.getProjection()),ee=Nc(Ht,Bt.tileID.canonical,it,Pe,ge,Ot.getProjection(),ia);cu(Ot,Ht,h,!0,ee,Yn,it,ne,W,oa,vn)}return{program:Si,buffers:Ot.text,uniformValues:pc,atlasTexture:y,atlasTextureIcon:Oi,atlasInterpolation:v,atlasInterpolationIcon:Fi,isSDF:!0,hasHalo:z,depthMode:Ss,tile:Bt,renderWithShadows:wn,labelPlaneMatrixInv:k}},Kr=Ot.icon.segments.get().length,sr=Ot.text.segments.get().length,Ga=Kr&&!b.onlyText?Cr():null,Rr=sr&&!b.onlyIcons?mr():null,Ca=i.paint.get("icon-opacity").constantOr(1),en=i.paint.get("text-opacity").constantOr(1);if(qe&&Ot.canOverlap){dt=!0;const _r=Ca&&!b.onlyText?Ot.icon.segments.get():[],Va=en&&!b.onlyIcons?Ot.text.segments.get():[];for(const yr of _r)jt.push({segments:new n.bf([yr]),sortKey:yr.sortKey,state:Ga});for(const yr of Va)jt.push({segments:new n.bf([yr]),sortKey:yr.sortKey,state:Rr})}else b.onlyText||jt.push({segments:Ca?Ot.icon.segments:new n.bf([]),sortKey:0,state:Ga}),b.onlyIcons||jt.push({segments:en?Ot.text.segments:new n.bf([]),sortKey:0,state:Rr})}dt&&jt.sort((oa,Bt)=>oa.sortKey-Bt.sortKey);for(const oa of jt){const Bt=oa.state;if(Bt)if(h.terrain?h.terrain.setupElevationDraw(Bt.tile,Bt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Bt.labelPlaneMatrixInv}):h.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,Bt.program),Ne.activeTexture.set(we.TEXTURE0),Bt.atlasTexture&&Bt.atlasTexture.bind(Bt.atlasInterpolation,we.CLAMP_TO_EDGE,!0),Bt.atlasTextureIcon&&(Ne.activeTexture.set(we.TEXTURE1),Bt.atlasTextureIcon&&Bt.atlasTextureIcon.bind(Bt.atlasInterpolationIcon,we.CLAMP_TO_EDGE,!0)),Bt.renderWithShadows&&h.shadowRenderer.setupShadows(Bt.tile.tileID.toUnwrapped(),Bt.program,"vector-tile"),h.uploadCommonLightUniforms(h.context,Bt.program),Bt.hasHalo){const Ot=Bt.uniformValues;Ot.u_is_halo=1,jd(Bt.buffers,oa.segments,i,h,Bt.program,Bt.depthMode,_,w,Ot,2),Ot.u_is_halo=0}else{if(Bt.isSDF){const Ot=Bt.uniformValues;Bt.hasHalo&&(Ot.u_is_halo=1,jd(Bt.buffers,oa.segments,i,h,Bt.program,Bt.depthMode,_,w,Ot,1)),Ot.u_is_halo=0}jd(Bt.buffers,oa.segments,i,h,Bt.program,Bt.depthMode,_,w,Bt.uniformValues,1)}}}function jd(h,t,i,f,_,w,b,E,A,M){const I=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,w,b,E,Ba.disabled,A,i.id,h.layoutVertexBuffer,h.indexBuffer,t,i.paint,f.transform.zoom,h.programConfigurations.get(i.id),I,M)}function up(h,t){const i=1<<h.canonical.z,f=(t.x*i-h.canonical.x-h.wrap*i)*n.al,_=(t.y*i-h.canonical.y)*n.al,w=n.e7(t.z,t.y);return n.d4(f,_,w)}function Fs(h,t,i,f,_){if(!i.layout||i.layout.get("fill-elevation-reference")==="none"||i.paint.get("fill-opacity").constantOr(1)===0)return;const w=h.context.gl,b=new ca(h.context.gl.LEQUAL,ca.ReadWrite,h.depthRangeFor3D),E=new ca(h.context.gl.GREATER,ca.ReadWrite,h.depthRangeFor3D),A=function(U){let H=.01;return U.isOrthographic&&(H=n.ak(1e-4,H,n.c$(U.pitch>=Rc?1:U.pitch/Rc))),2*H}(h.transform),M=h.transform.getFreeCameraOptions().position,I="elevatedStructuresDepthReconstruct",C=h.getOrCreateProgram(I,{defines:["DEPTH_RECONSTRUCTION"]}),J=h.getOrCreateProgram(I);for(const U of f){const H=t.getTile(U),q=H.getBucket(i);if(!q)continue;const ne=q.elevatedStructures;if(!ne)continue;const ae=q.elevationBufferData.heightRange,se=up(U.toUnwrapped(),M),he=h.translatePosMatrix(U.projMatrix,H,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));let ce,Ze,me,Ne;if(_==="initialize"){if(!ae||ae.min>=1||ne.depthSegments.segments[0].primitiveLength===0)continue;ce=_d(he,se,A,1,0),Ze=b,me=ne.depthSegments,Ne=C}else if(_==="reset"){if(!ae||ae.min>=0||ne.maskSegments.segments[0].primitiveLength===0)continue;ce=_d(he,se,0,0,1),Ze=E,me=ne.maskSegments,Ne=C}else if(_==="geometry"){if(ne.depthSegments.segments[0].primitiveLength===0)continue;ce=_d(he,se,A,1,0),Ze=b,me=ne.depthSegments,Ne=J}Ne.draw(h,w.TRIANGLES,Ze,za.disabled,Ya.disabled,Ba.disabled,ce,i.id,ne.vertexBuffer,ne.indexBuffer,me,i.paint,h.transform.zoom)}}function wo(h,t,i){const{painter:f,sourceCache:_,layer:w,coords:b,colorMode:E,elevationType:A,terrainEnabled:M,pass:I}=h,C=f.context.gl,J=w.paint.get("fill-pattern"),U=w.paint.get("fill-pattern-cross-fade"),H=J.constantOr(null);let q=A;A!=="road"||t&&!M||(q="none");const ne=q==="road",ae=h.painter.shadowRenderer,se=ne&&!!ae&&ae.enabled,he=new ca(f.context.gl.LEQUAL,ca.ReadOnly,f.depthRangeFor3D);let ce=[0,0,0];if(se){const Ne=f.style.directionalLight,we=f.style.ambientLight;Ne&&we&&(ce=Bo(f.style,Ne,we))}const Ze=J&&J.constantOr(1),me=(Ne,we)=>{let ge,Se,Pe,Fe,it;we?(ge=Ze&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Pe=C.LINES):(ge=Ze?"fillPattern":"fill",Pe=C.TRIANGLES);for(const qe of b){const dt=_.getTile(qe);if(Ze&&!dt.patternsLoaded())continue;const Mt=dt.getBucket(w);if(!Mt)continue;const Xe=t?Mt.elevationBufferData:Mt.bufferData;if(Xe.isEmpty())continue;f.prepareDrawTile();const Ie=Xe.programConfigurations.get(w.id),ct=f.isTileAffectedByFog(qe),et=[],jt=[];ne&&(et.push("ELEVATED_ROADS"),jt.push(Xe.elevatedLayoutVertexBuffer)),se&&et.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ze&&(f.context.activeTexture.set(C.TEXTURE0),dt.imageAtlasTexture&&dt.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ie.updatePaintBuffers());let Ct=!1;if(H&&dt.imageAtlas){const ra=dt.imageAtlas,Ht=n.e2.from(H),ia=Ht.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),va=Ht.getSecondary(),ir=ra.patternPositions.get(ia),Oa=va?ra.patternPositions.get(va.scaleSelf(n.o.devicePixelRatio).toString()):null;Ct=!!ir&&!!Oa,ir&&Ie.setConstantPatternPositions(ir,Oa)}U>0&&(Ct||Ie.getPatternTransitionVertexBuffer("fill-pattern"))&&et.push("FILL_PATTERN_TRANSITION");const oa=f.getOrCreateProgram(ge,{config:Ie,overrideFog:ct,defines:et}),Bt=f.translatePosMatrix(qe.projMatrix,dt,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));se&&ae.setupShadows(dt.tileID.toUnwrapped(),oa,"vector-tile");const Ot=w.paint.get("fill-emissive-strength");if(we){Fe=Xe.lineIndexBuffer,it=Xe.lineSegments;const ra=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];Se=ge==="fillOutlinePattern"&&Ze?ju(Bt,Ot,f,dt,ra,ce,U):sc(Bt,Ot,ra,ce)}else Fe=Xe.indexBuffer,it=Xe.triangleSegments,Se=Ze?Vl(Bt,Ot,f,dt,ce,U):Cc(Bt,Ot,ce);f.uploadCommonUniforms(f.context,oa,qe.toUnwrapped());let la=Ne;(A==="road"&&!M||A==="offset")&&(la=he),oa.draw(f,Pe,la,i||f.stencilModeForClipping(qe),E,Ba.disabled,Se,w.id,Xe.layoutVertexBuffer,Fe,it,w.paint,f.transform.zoom,Ie,jt)}};f.renderPass===I&&me(f.depthModeForSublayer(1,f.renderPass==="opaque"?ca.ReadWrite:ca.ReadOnly),!1),q==="none"&&f.renderPass==="translucent"&&w.paint.get("fill-antialias")&&me(f.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ca.ReadOnly),!0)}function na(h,t,i,f,_,w,b,E){i.resetLayerRenderingStats(h);const A=h.context,M=A.gl,I=h.transform,C=i.paint.get("fill-extrusion-pattern"),J=i.paint.get("fill-extrusion-pattern-cross-fade"),U=C.constantOr(null),H=C.constantOr(1),q=i.paint.get("fill-extrusion-opacity"),ne=h.style.enable3dLights(),ae=i.paint.get(ne&&!H?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),se=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae],he=i.layout.get("fill-extrusion-edge-radius"),ce=he>0&&!i.paint.get("fill-extrusion-rounded-roof"),Ze=ce?0:he,me=I.projection.name==="globe"?n.ea():0,Ne=I.projection.name==="globe",we=Ne?n.aj(I.zoom):0,ge=[n.aF(I.center.lng),n.aJ(I.center.lat)],Se=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Pe=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:i.lut).toArray01().slice(0,3),Fe=i.paint.get("fill-extrusion-flood-light-intensity"),it=i.paint.get("fill-extrusion-vertical-scale"),qe=i.paint.get("fill-extrusion-line-width").constantOr(1)!==0,dt=i.paint.get("fill-extrusion-height-alignment"),Mt=i.paint.get("fill-extrusion-base-alignment"),Xe=nl(h,i.paint.get("fill-extrusion-cutoff-fade-range")),Ie=[];let ct;Ne&&Ie.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&Ie.push("FAUX_AO"),ce&&Ie.push("ZERO_ROOF_RADIUS"),E&&Ie.push("HAS_CENTROID"),Fe>0&&Ie.push("FLOOD_LIGHT"),Xe.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),qe&&Ie.push("RENDER_WALL_MODE");const et=h.renderPass==="shadow",jt=h.shadowRenderer,Ct=et&&!!jt,oa=et?Ba.disabled:Ba.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let Bt=[0,0,0];if(jt){const ra=h.style.directionalLight,Ht=h.style.ambientLight;ra&&Ht&&(Bt=Bo(h.style,ra,Ht)),et||(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),jt.useNormalOffset&&Ie.push("NORMAL_OFFSET")),ct=Ie.concat(["SHADOWS_SINGLE_CASCADE"])}const Ot=Ct?"fillExtrusionDepth":H?"fillExtrusionPattern":"fillExtrusion",la=i.getLayerRenderingStats();for(const ra of f){const Ht=t.getTile(ra),ia=Ht.getBucket(i);if(!ia||ia.projection.name!==I.projection.name)continue;let va=!1;jt&&(va=jt.getMaxCascadeForTile(ra.toUnwrapped())===0);const ir=h.isTileAffectedByFog(ra),Oa=ia.programConfigurations.get(i.id);let Qr=!1;if(U&&Ht.imageAtlas){const sr=Ht.imageAtlas,Ga=n.e2.from(U),Rr=Ga.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),Ca=Ga.getSecondary(),en=sr.patternPositions.get(Rr),_r=Ca?sr.patternPositions.get(Ca.scaleSelf(n.o.devicePixelRatio).toString()):null;Qr=!!en&&!!_r,en&&Oa.setConstantPatternPositions(en,_r)}J>0&&(Qr||Oa.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ie.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ta=h.getOrCreateProgram(Ot,{config:Oa,defines:va?ct:Ie,overrideFog:ir});if(h.terrain&&h.terrain.setupElevationDraw(Ht,Ta,{useMeterToDem:!0}),!ia.centroidVertexBuffer){const sr=Ta.getAttributeLocation(M,"a_centroid_pos");sr!==-1&&M.vertexAttrib2f(sr,0,0)}!et&&jt&&jt.setupShadows(Ht.tileID.toUnwrapped(),Ta,"vector-tile"),H&&(h.context.activeTexture.set(M.TEXTURE0),Ht.imageAtlasTexture&&Ht.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Oa.updatePaintBuffers());const pr=i.paint.get("fill-extrusion-vertical-gradient"),Ua=1/ia.tileToMeter;let Cr;if(et&&jt){if(Zd(Ht.tileID,ia.maxHeight,h))continue;const sr=jt.calculateShadowPassMatrixFromTile(Ht.tileID.toUnwrapped());Cr=bh(sr,Ze,Ua,it,dt,Mt)}else{const sr=h.translatePosMatrix(ra.expandedProjMatrix,Ht,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Ga=I.projection.createInversionMatrix(I,ra.canonical);Cr=H?yo(sr,h,pr,q,se,Ze,Ua,ra,Ht,me,dt,Mt,we,ge,Ga,Pe,it,J):Lu(sr,h,pr,q,se,Ze,Ua,ra,me,dt,Mt,we,ge,Ga,Pe,it,Fe,Bt)}h.uploadCommonUniforms(A,Ta,ra.toUnwrapped(),null,Xe);let mr=ia.segments;if(I.projection.name==="mercator"&&!et&&(mr=ia.getVisibleSegments(Ht.tileID,h.terrain,h.transform.getFrustum(0)),!mr.get().length))continue;if(la)if(et)for(const sr of mr.get())la.numRenderedVerticesInShadowPass+=sr.primitiveLength;else for(const sr of mr.get())la.numRenderedVerticesInTransparentPass+=sr.primitiveLength;const Kr=[];(h.terrain||E)&&Kr.push(ia.centroidVertexBuffer),Ne&&Kr.push(ia.layoutVertexExtBuffer),qe&&Kr.push(ia.wallVertexBuffer),Ta.draw(h,A.gl.TRIANGLES,_,w,b,oa,Cr,i.id,ia.layoutVertexBuffer,ia.indexBuffer,mr,i.paint,h.transform.zoom,Oa,Kr)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}class yf{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Fo(h,t,i,f,_,w,b,E,A,M,I,C,J,U,H,q,ne,ae,se,he){const ce=t.context,Ze=ce.gl,me=t.transform,Ne=t.transform.zoom,we=[],ge=h.translate,Se=h.translateAnchor,Pe=h.edgeRadius,Fe=nl(t,h.cutoffFadeRange);I==="clear"?(we.push("CLEAR_SUBPASS"),he&&(we.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(Ze.TEXTURE0),he.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE))):I==="sdf"&&we.push("SDF_SUBPASS"),ae&&we.push("HAS_CENTROID"),Fe.shouldRenderCutoff&&we.push("RENDER_CUTOFF");const it=(qe,dt,Mt,Xe,Ie)=>{let ct=we;dt.groundRadiusBuffer!=null&&(ct=we.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const et=dt.programConfigurations.get(f.id),jt=t.isTileAffectedByFog(qe),Ct=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:et,defines:ct,overrideFog:jt}),oa=ys(t,Xe,C,M,Ie,[J,U*Ie],H,q,ne,Ne>=17?0:Pe*Ie,he?he.size[0]:0),Bt=[];ae&&Bt.push(dt.hiddenByLandmarkVertexBuffer),dt.groundRadiusBuffer!=null&&Bt.push(dt.groundRadiusBuffer),t.uploadCommonUniforms(ce,Ct,qe.toUnwrapped(),null,Fe),Ct.draw(t,ce.gl.TRIANGLES,w,b,E,A,oa,f.id,dt.vertexBuffer,dt.indexBuffer,Mt,f.paint,Ne,et,Bt)};for(const qe of _){const dt=i.getTile(qe),Mt=dt.getBucket(f);if(!Mt||Mt.projection.name!==me.projection.name||!Mt.groundEffect||Mt.groundEffect&&!Mt.groundEffect.hasData())continue;const Xe=Mt.groundEffect,Ie=1/Mt.tileToMeter;{const ct=t.translatePosMatrix(qe.projMatrix,dt,ge,Se),et=Xe.getDefaultSegment();it(qe,Xe,et,ct,Ie)}if(se)for(let ct=0;ct<4;ct++){const et=n.e8[ct](qe),jt=i.getTile(et);if(!jt)continue;const Ct=jt.getBucket(f);if(!Ct||Ct.projection.name!==me.projection.name||!Ct.groundEffect||Ct.groundEffect&&!Ct.groundEffect.hasData())continue;const oa=Ct.groundEffect;let Bt,Ot;ct===0?(Bt=[-n.al,0,0],Ot=1):ct===1?(Bt=[n.al,0,0],Ot=0):ct===2?(Bt=[0,-n.al,0],Ot=3):(Bt=[0,n.al,0],Ot=2);const la=oa.regionSegments[Ot];if(!la)continue;const ra=new Float32Array(16);n.bq(ra,qe.projMatrix,Bt),it(qe,oa,la,t.translatePosMatrix(ra,dt,ge,Se),Ie)}}}function lc(h,t,i,f,_,w,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const E=w?w.findDEMTileFor(i):null;if(!(E&&E.dem||b))return;w&&E&&E.dem&&f.selfDEMTileTimestamp!==E.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=E.dem._timestamp);const A=ae=>new n.P(Math.ceil((ae+n.ec)*n.ed),0),M=ae=>{const se=t.getSource().minzoom,he=Ze=>{const me=t.getTileByID(Ze);if(me&&me.hasData())return me.getBucket(_)},ce=[0,-1,1];for(const Ze of ce){if(ae.overscaledZ+Ze<se)continue;const me=he(ae.calculateScaledKey(ae.overscaledZ+Ze));if(me)return me}},I=[0,0,0],C=(ae,se)=>(I[0]=Math.min(ae.min.y,se.min.y),I[1]=Math.max(ae.max.y,se.max.y),I[2]=n.al-se.min.x>ae.max.x?se.min.x-n.al:ae.max.x,I),J=(ae,se)=>(I[0]=Math.min(ae.min.x,se.min.x),I[1]=Math.max(ae.max.x,se.max.x),I[2]=n.al-se.min.y>ae.max.y?se.min.y-n.al:ae.max.y,I),U=[(ae,se)=>C(ae,se),(ae,se)=>C(se,ae),(ae,se)=>J(ae,se),(ae,se)=>J(se,ae)],H=(ae,se,he,ce,Ze,me,Ne)=>{if(!w)return 0;const we=[[me?he:ae,me?ae:he,0],[me?he:se,me?se:he,0]],ge=Ne<0?n.al+Ne:Ne,Se=[me?ge:(ae+se)/2,me?(ae+se)/2:ge,0];return he===0&&Ne<0||he!==0&&Ne>0?w.getForTilePoints(Ze,[Se],!0,ce):we.push(Se),w.getForTilePoints(i,we,!0,E),Math.max(we[0][2],we[1][2],Se[2])/w.exaggeration()};for(let ae=0;ae<4;ae++){const se=f.borderFeatureIndices[ae];if(se.length===0)continue;const he=n.e8[ae](i),ce=M(he);if(!(ce&&ce instanceof n.e9))continue;const Ze=w?w.findDEMTileFor(he):null;if(!(Ze&&Ze.dem||b)||(w&&Ze&&Ze.dem&&f.borderDEMTileTimestamp[ae]!==Ze.dem._timestamp&&(f.borderDoneWithNeighborZ[ae]=-1,f.borderDEMTileTimestamp[ae]=Ze.dem._timestamp),f.borderDoneWithNeighborZ[ae]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const me=(ae<2?1:5)-ae,Ne=ce.borderDoneWithNeighborZ[me]!==f.canonical.z,we=ce.borderFeatureIndices[me];let ge=0;if(f.canonical.z!==ce.canonical.z){for(const Se of se)f.showCentroid(f.featuresOnBorder[Se]);if(Ne)for(const Se of we)ce.showCentroid(ce.featuresOnBorder[Se]);f.borderDoneWithNeighborZ[ae]=ce.canonical.z,ce.borderDoneWithNeighborZ[me]=f.canonical.z}for(const Se of se){const Pe=f.featuresOnBorder[Se],Fe=f.centroidData[Pe.centroidDataIndex],it=Pe.borders[ae];let qe;for(;ge<we.length;){qe=ce.featuresOnBorder[we[ge]];const dt=qe.borders[me];if(dt[1]>it[0]+3||dt[0]>it[0]-3)break;ce.showCentroid(qe),ge++}if(qe&&ge<we.length){const dt=ge;let Mt=0;for(;!(qe.borders[me][0]>it[1]-3)&&(Mt++,++ge!==we.length);)qe=ce.featuresOnBorder[we[ge]];qe=ce.featuresOnBorder[we[dt]];let Xe=!1;if(Mt>=1){const et=qe.borders[me];Math.abs(it[0]-et[0])<3&&Math.abs(it[1]-et[1])<3&&(Mt=1,Xe=!0,ge=dt+1)}else if(Mt===0){f.showCentroid(Pe);continue}const Ie=ce.centroidData[qe.centroidDataIndex];b&&Xe&&(((q=Fe).flags|(ne=Ie).flags)&n.eb?(q.flags|=n.eb,ne.flags|=n.eb):(q.flags&=~n.eb,ne.flags&=~n.eb));const ct=Pe.intersectsCount()>1||qe.intersectsCount()>1;if(Mt>1)ge=dt,Fe.centroidXY=Ie.centroidXY=new n.P(0,0);else if(Ze&&Ze.dem&&!ct){const et=U[ae](Fe,Ie),jt=ae%2?n.al-1:0,Ct=H(et[0],Math.min(n.al-1,et[1]),jt,Ze,he,ae<2,et[2]);Fe.centroidXY=Ie.centroidXY=A(Ct)}else ct?Fe.centroidXY=Ie.centroidXY=new n.P(0,0):(Fe.centroidXY=f.encodeBorderCentroid(Pe),Ie.centroidXY=ce.encodeBorderCentroid(qe));f.writeCentroidToBuffer(Fe),ce.writeCentroidToBuffer(Ie)}else f.showCentroid(Pe)}f.borderDoneWithNeighborZ[ae]=ce.canonical.z,ce.borderDoneWithNeighborZ[me]=f.canonical.z}var q,ne;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}const Oo=[1,0,0],xa=[0,1,0],Eu=[0,0,1];function Zd(h,t,i){const f=i.transform,_=i.shadowRenderer;if(!_)return!0;const w=h.toUnwrapped(),b=f.tileSize*_._cascades[i.currentShadowCascade].scale;let E=t;if(f.elevation){const q=f.elevation.getMinMaxForTile(h);q&&(E+=q.max)}const A=[..._.shadowDirection];A[2]=-A[2];const M=_.computeSimplifiedTileShadowVolume(w,E,b,A);if(!M)return!1;const I=[Oo,xa,Eu,A,[A[0],0,A[2]],[0,A[1],A[2]]],C=f.projection.name==="globe",J=f.scaleZoom(b),U=n.cA.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,J,!C),H=_.getCurrentCascadeFrustum();return U.intersectsPrecise(M.vertices,M.planes,I)===0||H.intersectsPrecise(M.vertices,M.planes,I)===0}function Ml(h){const{painter:t,source:i,layer:f,coords:_}=h;let w=h.defines;const b=t.context,E=t.renderPass==="shadow",A=t.renderPass==="light-beam",M=t.shadowRenderer,I=n.ee(t.transform.center.lat,t.transform.zoom),C=nl(t,f.paint.get("building-cutoff-fade-range"));C.shouldRenderCutoff&&(w=w.concat("RENDER_CUTOFF")),h.floodLightIntensity>0&&(w=w.concat("FLOOD_LIGHT"));for(const J of _){const U=i.getTile(J),H=U.getBucket(f);if(!H)continue;M&&M.getMaxCascadeForTile(J.toUnwrapped())===0&&(w=w.concat("SHADOWS_SINGLE_CASCADE"));const q=H.programConfigurations.get(f.id);let ne,ae,se,he=t.translatePosMatrix(J.expandedProjMatrix,U,[0,0],"map");if(he=n.cR(n.bB(),he,[1,1,h.verticalScale]),E&&M){if(Zd(U.tileID,H.maxHeight*I,t))continue;let Ze=M.calculateShadowPassMatrixFromTile(U.tileID.toUnwrapped());Ze=n.cR(n.bB(),Ze,[1,1,h.verticalScale]),se=ao(Ze),ne=ae=t.getOrCreateProgram("buildingDepth",{config:q,defines:w,overrideFog:!1})}else if(A)ne=ae=t.getOrCreateProgram("buildingBloom",{config:q,defines:w,overrideFog:!1}),se=ks(he);else{const Ze=t.transform.calculatePosMatrix(J.toUnwrapped(),t.transform.worldSize);n.cR(Ze,Ze,[1,1,h.verticalScale]);const me=n.bB();n.cR(me,Ze,[1,-1,1/I]),n.bk(me,me),n.ef(me,me);const Ne=t.transform.getFreeCameraOptions().position,we=1<<J.canonical.z;if(se=Lh(he,me,h.opacity,h.facadeAOIntensity,[((Ne.x-J.wrap)*we-J.canonical.x)*n.al,(Ne.y*we-J.canonical.y)*n.al,Ne.z*we*n.al],H.tileToMeter,h.facadeEmissiveChance,h.floodLightColor,h.floodLightIntensity),ae=t.getOrCreateProgram("building",{config:q,defines:w,overrideFog:!1}),h.depthOnly===!0)ne=ae;else{const ge=w.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ne=t.getOrCreateProgram("building",{config:q,defines:ge,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(Ze,ae,!0),ne!==ae&&M.setupShadowsFromMatrix(Ze,ne,!0))}const ce=(Ze,me)=>{if(A){const Ne=Ze.entranceBloom;me.draw(t,b.gl.TRIANGLES,h.depthMode,za.disabled,h.blendMode,Ba.disabled,se,f.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segmentsBucket,f.paint,t.transform.zoom,q,[Ne.layoutAttenuationBuffer,Ne.layoutColorBuffer])}else{const Ne=Ze.segmentsBucket;let we=[Ze.layoutNormalBuffer,Ze.layoutCentroidBuffer,Ze.layoutColorBuffer,Ze.layoutFloodLightDataBuffer];Ze.layoutFacadePaintBuffer&&(we=we.concat([Ze.layoutFacadeDataBuffer,Ze.layoutFacadeVerticalRangeBuffer,Ze.layoutFacadePaintBuffer])),me.draw(t,b.gl.TRIANGLES,h.depthMode,za.disabled,h.blendMode,E?Ba.disabled:Ba.backCW,se,f.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ne,f.paint,t.transform.zoom,q,we)}};t.uploadCommonUniforms(b,ae,J.toUnwrapped(),null,C),H.buildingWithoutFacade&&ce(H.buildingWithoutFacade,ae),H.buildingWithFacade&&(ne!==ae&&t.uploadCommonUniforms(b,ne,J.toUnwrapped(),null,C),ce(H.buildingWithFacade,ne))}}function Nd(h,t,i,f,_,w,b,E,A,M,I,C,J){const U=h.context.gl,H=h.depthModeForSublayer(1,ca.ReadOnly,U.LEQUAL,!0),q=.1*(1-(ne=I))+3*ne;var ne;const ae=h._showOverdrawInspector,se=C,he=new yf;ae||Fo(he,h,t,i,f,H,new za({func:U.ALWAYS,mask:255},255,255,U.KEEP,U.KEEP,U.REPLACE),new Ya([U.ONE,U.ONE,U.ONE,U.ONE],n.ao.transparent,[!1,!1,!1,!0],U.MIN),Ba.disabled,_,"sdf",w,b,E,A,M,q,se,!1);{const ce=ae?za.disabled:new za({func:U.EQUAL,mask:255},255,255,U.KEEP,U.DECR,U.DECR),Ze=ae?h.colorModeForRenderPass():new Ya([U.ONE_MINUS_DST_ALPHA,U.DST_ALPHA,U.ONE,U.ONE],n.ao.transparent,[!0,!0,!0,!0]);Fo(he,h,t,i,f,H,ce,Ze,Ba.disabled,_,"color",w,b,E,A,M,q,se,!1)}}function Uc(h){return[h[0]*n.eg,h[1]*n.eg,h[2]*n.eg,0]}function gf(h,t,i,f,_,w,b,E,A){const M=f.getSource(),I=i.globeSharedBuffers;if(!I)return;let C,J,U;if(t&&(C=f.getTile(t)),M instanceof n.aT?(J=M.texture,U=n.dJ(0,0,i.transform)):C&&t&&(J=C.texture,U=n.dJ(t.canonical.z,t.canonical.x,i.transform)),!J||!U)return;h||(U=n.cR(n.bB(),U,[1,-1,1]));const H=i.context,q=H.gl,ne=_.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,ae=i.colorModeForDrapableLayerRenderPass(w),se=b.defines;se.push("GLOBE_POLES");const he=new ca(q.LEQUAL,ca.ReadWrite,i.depthRangeFor3D),ce=Float32Array.from(i.transform.expandedFarZProjMatrix),Ze=Float32Array.from(n.bj(n.dI(new n.cC(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),H.activeTexture.set(q.TEXTURE0),J.bind(ne,q.CLAMP_TO_EDGE),H.activeTexture.set(q.TEXTURE1),J.bind(ne,q.CLAMP_TO_EDGE),"useMipmap"in J&&H.extTextureFilterAnisotropic&&i.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const[me,Ne,we,ge]=t?I.getPoleBuffers(t.canonical.z,!1):I.getPoleBuffers(0,!0),Se=_.paint.get("raster-elevation");let Pe;h?(Pe=me,i.renderDefaultNorthPole=Se!==0):(Pe=Ne,i.renderDefaultSouthPole=Se!==0);const Fe=Uc(b.mix),it=((dt,Mt,Xe,Ie,ct,et,jt,Ct,oa,Bt,Ot,la,ra)=>wd(dt,Mt,Xe,new Float32Array(16),new Float32Array(9),[0,0],Ie,[0,0],[0,0,0,0],1,{opacity:1,mix:0},et,[0,0],Ct,2,Bt,Ot,la,1,0,ra))(ce,Ze,U,n.aj(i.transform.zoom),0,_,0,Se,0,Fe,b.offset,b.range,w),qe=i.getOrCreateProgram("raster",{defines:se});i.uploadCommonUniforms(H,qe,null),qe.draw(i,q.TRIANGLES,he,A,ae,E,it,_.id,Pe,we,ge)}function _f(h){const t=h._nearZ,i=h.projection.farthestPixelDistance(h),f=i-t,_=.2*h.height,w=t+_;return[t,i,(w-_-t)/f,(w-t)/f]}function xi(h,t,i,f){if(h)return t instanceof Ni&&h instanceof Ro?t.getTextureDescriptor(h,i,!0):{texture:h.texture,mix:Uc(f.mix),offset:f.offset,buffer:0,tileSize:1}}var xf=n.eh([{name:"a_index",type:"Int16",components:1}]);class Ns{constructor(t,i,f,_){const w={width:f[0],height:f[1],data:null},b=t.gl;this.targetColorTexture=new n.T(t,w,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,w,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(i,_),this.lastInvalidatedAt=0}updateParticleTexture(t,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,_=i.width*i.height;this.particleTexture0=new n.T(this.context,i,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,i,f.RGBA8,{premultiply:!1,useMipmap:!1});const w=new n.ei;w.reserve(_);for(let b=0;b<_;b++)w.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(w,xf.members,!0),this.particleSegment=n.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ah(h,t,i){if(!h)return null;const f=t.getTextureDescriptor(h,i,!0);if(!f)return null;let{texture:_,mix:w,offset:b,tileSize:E,buffer:A,format:M}=f;if(!_||!M)return null;let I=!1;return M==="uint32"&&(I=!0,w[3]=0,w=xd(n.ej,w,[0,i.paint.get("raster-particle-max-speed")]),b=dl(n.ej,b,[0,i.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[A/(E+2*A),E/(E+2*A)],tileSize:E,scalarData:I,scale:w,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Hi(h){const t=h._nearZ,i=h.projection.farthestPixelDistance(h),f=i-t,_=.2*h.height,w=t+_;return[t,i,(w-_-t)/f,(w-t)/f]}const Bl=new n.ao(1,0,0,1),Wc=new n.ao(0,1,0,1),fi=new n.ao(0,0,1,1),ki=new n.ao(1,0,1,1),Ui=new n.ao(0,1,1,1);function Ed(h,t,i,f,_,w){for(let b=0;b<i.length;b++)if(_){const M=new n.ao(f.r*.8,f.g*.8,f.b*.8,1);ns(h,t,i[b],f,-1,-1,w),ns(h,t,i[b],f,-1,1,w),ns(h,t,i[b],f,1,1,w),ns(h,t,i[b],f,1,-1,w),ns(h,t,i[b],M,0,0,w)}else ns(h,t,i[b],f,0,0,w)}function ns(h,t,i,f,_,w,b){const E=h.context,A=h.transform,M=E.gl,I=A.projection.name==="globe",C=I?["PROJECTION_GLOBE_VIEW"]:[];let J=n.by(i.projMatrix);if(I&&n.aj(A.zoom)>0){const Fe=n.bi(i.canonical,A),it=n.ek(Fe);J=n.aB(new Float32Array(16),A.globeMatrix,it),n.aB(J,A.projMatrix,J)}const U=n.bB();U[12]+=2*_/(n.o.devicePixelRatio*A.width),U[13]+=2*w/(n.o.devicePixelRatio*A.height),n.aB(J,U,J);const H=h.getOrCreateProgram("debug",{defines:C}),q=t.getTileByID(i.key);h.terrain&&h.terrain.setupElevationDraw(q,H);const ne=ca.disabled,ae=za.disabled,se=h.colorModeForRenderPass(),he="$debug";E.activeTexture.set(M.TEXTURE0),h.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),I?q._makeGlobeTileDebugBuffers(h.context,A):q._makeDebugTileBoundsBuffers(h.context,A.projection);const ce=q._tileDebugBuffer||h.debugBuffer,Ze=q._tileDebugIndexBuffer||h.debugIndexBuffer,me=q._tileDebugSegments||h.debugSegments;if(H.draw(h,M.LINE_STRIP,ne,ae,se,Ba.disabled,go(J,f.toPremultipliedRenderColor(null)),he,ce,Ze,me,null,null,null,[q._globeTileDebugBorderBuffer]),b){const Fe=q.latestRawTileData,it=Math.floor((Fe&&Fe.byteLength||0)/1024);let qe=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(qe+=` => ${i.overscaledZ}`),qe+=` ${q.state}`,qe+=` ${it}kb`,function(dt,Mt){dt.initDebugOverlayCanvas();const Xe=dt.debugOverlayCanvas,Ie=dt.context.gl,ct=dt.debugOverlayCanvas.getContext("2d");ct.clearRect(0,0,Xe.width,Xe.height),ct.shadowColor="white",ct.shadowBlur=2,ct.lineWidth=1.5,ct.strokeStyle="white",ct.textBaseline="top",ct.font="bold 36px Open Sans, sans-serif",ct.fillText(Mt,5,5),ct.strokeText(Mt,5,5),dt.debugOverlayTexture.update(Xe),dt.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(h,qe)}const Ne=t.getTile(i).tileSize,we=512/Math.min(Ne,512)*(i.overscaledZ/A.zoom)*.5,ge=q._tileDebugTextBuffer||h.debugBuffer,Se=q._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Pe=q._tileDebugTextSegments||h.debugSegments;H.draw(h,M.TRIANGLES,ne,ae,Ya.alphaBlended,Ba.disabled,go(J,n.ao.transparent.toPremultipliedRenderColor(null),we),he,ge,Se,Pe,null,null,null,[q._globeTileDebugTextBuffer])}function $r(h,t,i,f){Ji(h,0,t+i/2,h.transform.width,i,f)}function Rh(h,t,i,f){Ji(h,t-i/2,0,i,h.transform.height,f)}function Ji(h,t,i,f,_,w){const b=h.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*n.o.devicePixelRatio,i*n.o.devicePixelRatio,f*n.o.devicePixelRatio,_*n.o.devicePixelRatio),b.clear({color:w}),E.disable(E.SCISSOR_TEST)}const wf=n.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:vf}=wf;function hl(h,t,i,f){h.emplaceBack(t,i,f)}class Do{constructor(t){this.vertexArray=new n.el,this.indices=new n.b0,hl(this.vertexArray,-1,-1,1),hl(this.vertexArray,1,-1,1),hl(this.vertexArray,-1,1,1),hl(this.vertexArray,1,1,1),hl(this.vertexArray,-1,-1,-1),hl(this.vertexArray,1,-1,-1),hl(this.vertexArray,-1,1,-1),hl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,vf),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.bf.simpleSegment(0,0,36,12)}}function wi(h,t,i,f,_,w){const b=h.context.gl,E=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),M=t.paint.get("sky-atmosphere-sun-intensity"),I=((C,J,U,H,q)=>({u_matrix_3f:C,u_sun_direction:J,u_sun_intensity:U,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(n.en(n.dN(),f),_,M,E.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+w,t.skyboxTexture,0),i.draw(h,b.TRIANGLES,ca.disabled,za.disabled,Ya.unblended,Ba.frontCW,I,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const fl=n.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Tt{constructor(t){const i=new n.eo;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const f=new n.b0;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,fl.members),this.indexBuffer=t.createIndexBuffer(f),this.segments=n.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Kt=n.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Su{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Mn{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ya([1,Xn,1,Xn],n.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ya([1,0,1,0],n.ao.transparent,[!1,!1,!1,!0]),this.params=new Su,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Tt(i);const f=this.params.sizeRange,_=this.params.intensityRange,w=function(I){const C=n.eq(30),J=[];for(let U=0;U<I;++U){const H=2*Math.PI*C(),q=Math.acos(1-2*C())-.5*Math.PI;J.push(n.d4(Math.cos(q)*Math.cos(H),Math.cos(q)*Math.sin(H),Math.sin(q)))}return J}(this.params.starsCount),b=n.eq(300),E=new n.ep,A=new n.b0;let M=0;for(let I=0;I<w.length;++I){const C=n.c4([],w[I],200),J=Math.max(0,1+.01*f*(1*b()-.5)),U=Math.max(0,1+.01*_*(1*b()-.5));E.emplaceBack(C[0],C[1],C[2],-1,-1,J,U),E.emplaceBack(C[0],C[1],C[2],1,-1,J,U),E.emplaceBack(C[0],C[1],C[2],1,1,J,U),E.emplaceBack(C[0],C[1],C[2],-1,1,J,U),A.emplaceBack(M+0,M+1,M+2),A.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=i.createVertexBuffer(E,Kt.members),this.starsIdx=i.createIndexBuffer(A),this.starsSegments=n.bf.simpleSegment(0,0,E.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const f=t.context,_=f.gl,w=t.transform,b=new ca(_.LEQUAL,ca.ReadOnly,[0,1]),E=n.aj(w.zoom),A=t.style.getLut(i.scope),M=i.properties.get("color-use-theme")==="none",I=i.properties.get("color").toNonPremultipliedRenderColor(M?null:A),C=i.properties.get("high-color-use-theme")==="none",J=i.properties.get("high-color").toNonPremultipliedRenderColor(C?null:A),U=i.properties.get("space-color-use-theme")==="none",H=i.properties.get("space-color").toNonPremultipliedRenderColor(U?null:A),q=5e-4,ne=n.er(i.properties.get("horizon-blend"),0,1,q,.25),ae=n.dD(t,f,w)&&ne===q?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,se=t.frameCounter/1e3%1,he=n.ag(w.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(he,2)-Math.pow(ae,2)),Ze=Math.acos(ce/he),me=Ne=>{const we=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ne&&we.push("ALPHA_PASS");const ge=t.getOrCreateProgram("globeAtmosphere",{defines:we}),Se=((Fe,it,qe,dt,Mt,Xe,Ie,ct,et,jt,Ct,oa)=>({u_frustum_tl:Fe,u_frustum_tr:it,u_frustum_br:qe,u_frustum_bl:dt,u_horizon:Mt,u_transition:Xe,u_fadeout_range:Ie,u_atmosphere_fog_color:ct.toArray01(),u_high_color:et.toArray01(),u_space_color:jt.toArray01(),u_temporal_offset:Ct,u_horizon_angle:oa}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,E,ne,I,J,H,se,Ze);t.uploadCommonUniforms(f,ge);const Pe=this.atmosphereBuffer;Pe&&ge.draw(t,_.TRIANGLES,b,za.disabled,Ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ba.backCW,Se,Ne?"atmosphere_glow_alpha":"atmosphere_glow",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)};me(!1),me(!0)}drawStars(t,i){const f=n.aA(i.properties.get("star-intensity"),0,1);if(f===0)return;const _=t.context,w=_.gl,b=t.transform,E=t.getOrCreateProgram("stars"),A=n.c6([]);n.c8(A,A,-b._pitch),n.c7(A,A,-b.angle),n.c8(A,A,n.an(b._center.lat)),n.es(A,A,-n.an(b._center.lng));const M=n.cb(new Float32Array(16),A),I=n.aB([],b.starsProjMatrix,M),C=n.en([],M),J=n.et([],C),U=[0,1,0];n.dP(U,U,J),n.c4(U,U,this.params.sizeMultiplier);const H=[1,0,0];n.dP(H,H,J),n.c4(H,H,this.params.sizeMultiplier);const q=(ne=U,ae=H,se=f,{u_matrix:Float32Array.from(I),u_up:ne,u_right:ae,u_intensity_multiplier:se});var ne,ae,se;t.uploadCommonUniforms(_,E),this.starsVx&&this.starsIdx&&E.draw(t,w.TRIANGLES,ca.disabled,za.disabled,this.colorModeAlphaBlendedWriteRGB,Ba.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ue{constructor(){this.visibleTiles=[]}updateBorders(t,i){const f=[],_=[],w=t._getRenderableCoordinates(!1,!0);for(const A of w){const M=t.getTile(A);if(!M.hasData())continue;const I=M.getBucket(i);I&&(I.isEmpty()||(f.push(A.key),_.push({bucket:I,tileID:A.canonical})))}let b=f.length!==this.visibleTiles.length;if(!b){f.sort();for(let A=0;A<f.length;A++)if(f[A]!==this.visibleTiles[A]){b=!0;break}}if(!b)return;const E=new Set;this.visibleTiles=f,_.sort((A,M)=>A.tileID.z-M.tileID.z||A.tileID.x-M.tileID.x||A.tileID.y-M.tileID.y);for(const A of _){const M=new Array,I=new Array,C=A.bucket;for(const J of C.featuresOnBorder)E.has(J.featureId)?I.push(J.footprintIndex):(E.add(J.featureId),M.push(J.footprintIndex));C.updateFootprintHiddenFlags(M,n.eu,!1),C.updateFootprintHiddenFlags(I,n.eu,!0)}}}function bf(h,t){const i=[...h],f=t.cameraWorldSizeForFog/t.worldSize,_=n.bz([]);return n.cR(_,_,[f,f,1]),n.aB(i,_,i),n.aB(i,t.worldToFogMatrix,i),i}function zu(h,t,i,f,_){const w=i.material,b=f.context,{baseColorTexture:E,metallicRoughnessTexture:A}=w.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:I,emissionTexture:C}=w;function J(H,q,ne){if(H&&(h.push(q),b.activeTexture.set(b.gl.TEXTURE0+ne),H.gfxTexture)){const{minFilter:ae,magFilter:se,wrapS:he,wrapT:ce}=H.sampler;H.gfxTexture.bindExtraParam(ae,se,he,ce)}}J(E,"HAS_TEXTURE_u_baseColorTexture",_i.BaseColor),J(A,"HAS_TEXTURE_u_metallicRoughnessTexture",_i.MetallicRoughness),J(M,"HAS_TEXTURE_u_normalTexture",_i.Normal),J(I,"HAS_TEXTURE_u_occlusionTexture",_i.Occlusion),J(C,"HAS_TEXTURE_u_emissionTexture",_i.Emission),_&&(_.texture||(_.texture=new n.d_(f.context,_.image,[_.image.height,_.image.height,_.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+_i.LUT),_.texture&&_.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),i.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(h.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||h.push("DIFFUSE_SHADED");const U=f.shadowRenderer;U&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Au(h,t,i,f,_,w){const b=i.paint.get("model-opacity").constantOr(1),E=t.context,A=new ca(t.context.gl.LEQUAL,h.isLightMesh?ca.ReadOnly:ca.ReadWrite,t.depthRangeFor3D),M=t.transform,I=h.mesh,C=I.material,J=C.pbrMetallicRoughness,U=t.style.fog;let H;H=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:n.aB([],f.zScaleMatrix,h.nodeModelMatrix),n.aB(H,f.negCameraPosMatrix,H);const q=n.bk([],H);n.ef(q,q);const ne=i.paint.get("model-color-use-theme").constantOr("default")==="none",ae=i.paint.get("model-emissive-strength").constantOr(0),se=Eh(new Float32Array(h.worldViewProjection),new Float32Array(H),new Float32Array(q),null,t,b,J.baseColorFactor,C.emissiveFactor,J.metallicFactor,J.roughnessFactor,C,ae,i,void 0,void 0,h.materialOverride,h.modelColor),he={defines:[]},ce=[],Ze=t.shadowRenderer;Ze&&(Ze.useNormalOffset=!1),zu(he.defines,ce,I,t,ne?null:i.lut);let me=null;if(U){const ge=bf(h.nodeModelMatrix,t.transform);if(me=new Float32Array(ge),M.projection.name!=="globe"){const Se=I.aabb.min,Pe=I.aabb.max,[Fe,it]=U.getOpacityForBounds(ge,Se[0],Se[1],Pe[0],Pe[1]);he.overrideFog=Fe>=tt||it>=tt}}const Ne=nl(t,i.paint.get("model-cutoff-fade-range"));Ne.shouldRenderCutoff&&he.defines.push("RENDER_CUTOFF");const we=t.getOrCreateProgram("model",he);t.uploadCommonUniforms(E,we,null,me,Ne),t.renderPass!=="shadow"&&Ze&&Ze.setupShadowsFromMatrix(h.nodeModelMatrix,we),we.draw(t,E.gl.TRIANGLES,A,_,w,I.material.doubleSided?Ba.disabled:Ba.backCCW,se,i.id,I.vertexBuffer,I.indexBuffer,I.segments,i.paint,t.transform.zoom,void 0,ce)}function Th(h,t,i){return h.type==="vector"?t.scope:i?"basemap":""}function Vh(h,t,i,f,_,w,b,E,A){const M=h.transform,I=!!t.isGeometryBloom&&t.isGeometryBloom;if(I&&h.renderPass==="shadow")return;const C=M.projection.name==="globe"?n.eC(i,M):[...i];n.aB(C,C,t.globalMatrix);const J=n.aB([],f,C);if(t.meshes)for(const U of t.meshes){const H=E.get(U.material.name);if(H&&H.opacity<=0)continue;if(U.material.alphaMode!=="BLEND"){b.push({mesh:U,depth:0,modelIndex:_,worldViewProjection:J,nodeModelMatrix:C,isLightMesh:I,materialOverride:H,modelColor:A});continue}const q=n.af([],U.centroid,J);!M.isOrthographic&&q[2]<=0||w.push({mesh:U,depth:q[2],modelIndex:_,worldViewProjection:J,nodeModelMatrix:C,isLightMesh:I,materialOverride:H,modelColor:A})}if(t.children)for(const U of t.children)Vh(h,U,i,f,_,w,b,E,A)}function Il(h,t,i,f){const _=i.shadowRenderer;if(!_)return;const w=_.getShadowPassDepthMode(),b=_.getShadowPassColorMode(),E=_.calculateShadowPassMatrixFromMatrix(t),A=oc(E);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,w,za.disabled,b,Ba.disabled,A,f.id,h.vertexBuffer,h.indexBuffer,h.segments,f.paint,i.transform.zoom,void 0,void 0)}function Ru(h,t,i,f,_,w){for(const b of _){const E=Object.assign({},f);E.part=b;const A={type:"Unknown",id:t,properties:E},M={orientation:h.paint.get("model-rotation").evaluate(A,i)};w.set(b,M)}}function Lf(h,t,i,f,_,w){for(const b of _){const E=Object.assign({},f);E.part=b;const A={type:"Unknown",id:t,properties:E},M={color:h.paint.get("model-color").evaluate(A,i),colorMix:h.paint.get("model-color-mix-intensity").evaluate(A,i),opacity:h.paint.get("model-opacity").evaluate(A,i),emissionStrength:h.paint.get("model-emissive-strength").evaluate(A,i)};w.set(b,M)}}function Mh(h,t,i,f,_,w){if(i===1)for(const E of _)Au(E,h,t,w[E.modelIndex],za.disabled,h.colorModeForRenderPass());else{for(const E of _)Au(E,h,t,w[E.modelIndex],za.disabled,Ya.disabled);for(const E of _)Au(E,h,t,w[E.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}const b=Ya.additive;for(const E of f)Au(E,h,t,w[E.modelIndex],za.disabled,E.isLightMesh?b:h.colorModeForRenderPass())}function dp(h,t,i){const f=t.updateZoomBasedPaintProperties(),_=function(w,b,E){let A,M,I,C=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&C>0){const J=w.terrain,U=J.findDEMTileFor(E);U&&U.dem?A=n.eE.create(J,E,U):C=0}if(C===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),C===b.validForExaggeration&&(C===0||A&&A._demTile&&A._demTile.tileID===b.validForDEMTile.id&&A._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const J in b.instancesPerModel){const U=b.instancesPerModel[J];for(let H=0;H<U.instancedDataArray.length;++H){const q=(A?C*A.getElevationAt(0|U.instancedDataArray.float32[16*H],0|U.instancedDataArray.float32[16*H+1],!0,!0):0)+U.instancesEvaluatedElevation[H];U.instancedDataArray.float32[16*H+6]=q,M=M?Math.min(b.terrainElevationMin,q):q,I=I?Math.max(b.terrainElevationMax,q):q}}return b.terrainElevationMin=M||0,b.terrainElevationMax=I||0,b.validForExaggeration=C,b.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,i);(f||_)&&(t.uploaded=!1,t.upload(h.context))}const Os={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.d8([0,0,0],[n.al,n.al,0])};function jf(h,t){const i=1<<h.canonical.z,f=t.getFreeCameraOptions().position,_=t.elevation,w=h.canonical.x/i,b=(h.canonical.x+1)/i,E=h.canonical.y/i,A=(h.canonical.y+1)/i;let M=t._centerAltitude;if(_){const U=_.getMinMaxForTile(h);U&&U.max>M&&(M=U.max)}const I=n.aA(f.x,w,b)-f.x,C=n.aA(f.y,E,A)-f.y,J=n.ce(M,t.center.lat)-f.z;return t._zoomFromMercatorZ(Math.sqrt(I*I+C*C+J*J))}function Zf(h,t,i,f,_,w,b){const E=h.context,A=h.renderPass==="shadow",M=h.shadowRenderer,I=A&&M?M.getShadowPassDepthMode():new ca(E.gl.LEQUAL,ca.ReadWrite,h.depthRangeFor3D),C=h.isTileAffectedByFog(w),J=h.transform.projection.name==="globe";if(i.meshes)for(const U of i.meshes){const H=J?[]:["MODEL_POSITION_ON_GPU"],q=[];let ne,ae,se;const he=!J&&f.instancedDataArray.length>20;he&&H.push("INSTANCED_ARRAYS");const ce=nl(h,t.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),A&&M)ne=h.getOrCreateProgram("modelDepth",{defines:H}),ae=oc(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(i.globalMatrix)),se=M.getShadowPassColorMode();else{zu(H,q,U,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),ne=h.getOrCreateProgram("model",{defines:H,overrideFog:C});const me=U.material,Ne=me.pbrMetallicRoughness,we=t.paint.get("model-opacity").constantOr(1),ge=t.paint.get("model-emissive-strength").constantOr(0);ae=Eh(w.expandedProjMatrix,Float32Array.from(i.globalMatrix),new Float32Array(16),null,h,we,Ne.baseColorFactor,me.emissiveFactor,Ne.metallicFactor,Ne.roughnessFactor,me,ge,t,_),M&&(b.shadowUniformsInitialized?ne.setShadowUniformValues(E,M.getShadowUniformValues()):(M.setupShadows(w.toUnwrapped(),ne,"model-tile"),b.shadowUniformsInitialized=!0)),se=ce.shouldRenderCutoff||we<1||me.alphaMode!=="OPAQUE"?Ya.alphaBlended:Ya.unblended}h.uploadCommonUniforms(E,ne,w.toUnwrapped(),null,ce);const Ze=U.material.doubleSided?Ba.disabled:Ba.backCCW;if(he)q.push(f.instancedDataBuffer),ne.draw(h,E.gl.TRIANGLES,I,za.disabled,se,Ze,ae,t.id,U.vertexBuffer,U.indexBuffer,U.segments,t.paint,h.transform.zoom,void 0,q,f.instancedDataArray.length);else{const me=A?"u_instance":"u_normal_matrix";for(let Ne=0;Ne<f.instancedDataArray.length;++Ne)ae[me]=new Float32Array(f.instancedDataArray.arrayBuffer,64*Ne,16),ne.draw(h,E.gl.TRIANGLES,I,za.disabled,se,Ze,ae,t.id,U.vertexBuffer,U.indexBuffer,U.segments,t.paint,h.transform.zoom,void 0,q)}}if(i.children)for(const U of i.children)Zf(h,t,U,f,_,w,b)}const hp=[1,-1,1];function Bh(h,t,i,f){if(!i.modelManager)return!0;const _=i.modelManager;if(!i.shadowRenderer)return!0;const w=i.shadowRenderer,b=t.aabb;let E=!0,A=h.maxHeight;if(A===0){let I=0;for(const C in h.instancesPerModel){const J=_.getModel(C,f);J?I=Math.max(I,Math.max(Math.max(J.aabb.max[0],J.aabb.max[1]),J.aabb.max[2])):E=!1}A=h.maxScale*I*1.41+h.maxVerticalOffset,E&&(h.maxHeight=A)}b.max[2]=A,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,n.af(b.min,b.min,t.tileMatrix),n.af(b.max,b.max,t.tileMatrix);const M=b.intersects(w.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=M===2),M===0}function Tu(h,t){const i=h.uniformValues.u_cutoff_params[0],f=h.uniformValues.u_cutoff_params[1],_=h.uniformValues.u_cutoff_params[2],w=h.uniformValues.u_cutoff_params[3];return f===i||w===_?1:n.aA(((t-i)/(f-i)-_)/(w-_),0,1)}function Xc(h,t,i,f){if(t.pitch<20)return 1;const _=t.getWorldToCameraMatrix();n.aB(_,_,h);const w=n.bT(i.min[0],i.min[1],i.min[2],1);let b=n.aC(n.eF(),w,_),E=b,A=b;w[1]=i.max[1],b=n.aC(n.eF(),w,_),E=b[1]<E[1]?b:E,A=b[1]>A[1]?b:A,w[0]=i.max[0],b=n.aC(n.eF(),w,_),E=b[1]<E[1]?b:E,A=b[1]>A[1]?b:A,w[1]=i.min[1],b=n.aC(n.eF(),w,_),E=b[1]<E[1]?b:E,A=b[1]>A[1]?b:A;const M=n.aA(f[0],0,1),I=100*t.pixelsPerMeter*n.aA(f[1],0,1),C=n.aA(f[2],0,1),J=n.eG(n.eF(),E,A,M),U=Math.tan(.5*t.fovX),H=-J[2]*U;if(I===0)return J[1]<-Math.abs(H)?C:1;const q=(-Math.abs(H)-J[1])/I,ne=(se,he,ce)=>(1-ce)*se+ce*he,ae=n.aA(ne(1,C,q),C,1);return ne(1,ae,n.aA((t.pitch-20)/20,0,1))}class fp{}class pp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,f){{const C=this._storage.get(i.id);if(C)return C.lastUsedFrameIdx=t,C.buf}const _=f.gl,w=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),b=new ArrayBuffer(w),E=new Int16Array(b);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const A=new n.eI;for(let C=0;C<w/2;C+=3){const J=E[C],U=E[C+1],H=E[C+2];A.emplaceBack(J,U),A.emplaceBack(U,H),A.emplaceBack(H,J)}const M=f.bindVertexArrayOES.current,I=new fp;return I.buf=new xo(f,A),I.lastUsedFrameIdx=t,this._storage.set(i.id,I),f.bindVertexArrayOES.set(M),I.buf}update(t){for(const[i,f]of this._storage)t-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(i))}destroy(){for(const[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}class fy{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const mp=n.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class py{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class gs{constructor(t,i){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...i,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...i,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const cm=n.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Sd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,i){const f=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new n.eJ,E=new n.b0;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(b,cm.members),this.vignetteIdx=t.context.createIndexBuffer(E)}const _=n.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,f);const b={u_vignetteShape:(w={vignetteShape:[i.start,i.range,Math.pow(10,i.fadePower)],vignetteColor:[i.color.r,i.color.g,i.color.b,i.color.a*i.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};f.draw(t,t.context.gl.TRIANGLES,ca.disabled,za.disabled,Ya.alphaBlended,Ba.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,_)}var w}}class dn{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,i){const f=t.getFreeCameraOptions().position,_=f.toAltitude(),w=f.toLngLat(),b=n.an(w.lng),E=n.an(w.lat),A=t.pixelsPerMeter/i,M=b*n.eL,I=n.eL*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const C=-this._offsetYPrev+I,J=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*A,this._accumulatedOffsetY+=C*A,this._accumulatedElevation+=J*A,this._offsetXPrev=M,this._offsetYPrev=I,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function tr(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function yp(h){const t=n.eq(1323123451230),i=[];for(let f=0;f<h;++f){const _=2*t()-1,w=2*t()-1,b=2*t()-1;i.push(n.d4(_,w,b))}return i}function Ds(h,t,i,f,_){const w=n.aA((_-i)/(f-i),0,1);return(1-w)*h+w*t}class Vu{constructor(t){this._movement=new dn,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Sd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,i){const f=t.transform;this._movement.update(f,this._ppmScaleFactor);const _=f.starsProjMatrix,w=n.c6([]);n.c8(w,w,n.an(90)-f._pitch),n.c7(w,w,-f.angle);const b=n.cb(new Float32Array(16),w),E=n.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=n.ef([],E),M=n.aB([],A,b),I=Date.now()/1e3;return this._accumulatedTimeFromStart+=(I-this._prevTime)*i,this._prevTime=I,{projectionMatrix:_,modelviewMatrix:M}}}class Es extends Vu{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new gs(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const f=yp(this.particlesCount),_=new n.eM,w=new n.b0;let b=0;const E=n.eq(1323123451230);for(let A=0;A<f.length;++A){const M=f[A],I=[2*E()-1,E(),E(),E()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...I),_.emplaceBack(M[0],M[1],M[2],1,-1,...I),_.emplaceBack(M[0],M[1],M[2],1,1,...I),_.emplaceBack(M[0],M[1],M[2],-1,1,...I),w.emplaceBack(b+0,b+1,b+2),w.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=i.createVertexBuffer(_,mp.members),this.particlesIdx=i.createIndexBuffer(w)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const i=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=t.transform.zoom;if(i.revealStart>f)return;const _=Ds(0,1,i.revealStart,i.revealStart+i.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let b=[-w.direction.x,w.direction.y,-100];n.aw(b,b);const E=structuredClone(this._vignetteParams);E.strength*=_,w.overrideStyleParameters||(w.intensity=t.style.rain.state.density,w.timeFactor=t.style.rain.state.intensity,w.color=structuredClone(t.style.rain.state.color),b=structuredClone(t.style.rain.state.direction),w.screenThinning.intensity=t.style.rain.state.centerThinning,w.dropletSizeX=t.style.rain.state.dropletSize[0],w.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],w.distortionStrength=100*t.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(t.style.rain.state.vignetteColor));const A=this.updateOnRender(t,w.timeFactor),M=t.context,I=M.gl,C=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(M,{width:t.width,height:t.height,data:null},I.RGBA8)),w.distortionStrength>0&&(M.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexSubImage2D(I.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const J=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(M,J),M.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const U=[w.color.r,w.color.g,w.color.b,w.color.a],H=(q,ne)=>{const ae=tr(this._movement.getPosition(),q),se=w.dropletSizeX,he=w.dropletSizeX*w.dropletSizeYScale,ce=t.width/2,Ze=t.height/2,me=Ds(0,w.screenThinning.start,0,1,w.screenThinning.intensity),Ne=Ds(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),we=Ds(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),ge=(Se={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ae,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:q,rainDropletSize:[se,he],distortionStrength:w.distortionStrength,rainDirection:b,color:U,screenSize:[C.width,C.height],thinningCenterPos:[ce,Ze],thinningShape:[me,Ne,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:we,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:ne?0:1},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_texScreen:0,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_boxSize:Se.boxSize,u_rainDropletSize:Se.rainDropletSize,u_distortionStrength:Se.distortionStrength,u_rainDirection:Se.rainDirection,u_color:Se.color,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_shapeDirectionalPower:Se.shapeDirectionalPower,u_shapeNormalPower:Se.shapeNormalPower,u_mode:Se.mode});var Se;const Pe=Math.round(w.intensity*this.particlesCount),Fe=n.bf.simpleSegment(0,0,4*Pe,2*Pe);J.draw(t,I.TRIANGLES,ca.disabled,za.disabled,Ya.alphaBlended,Ba.disabled,ge,"rain_particles",this.particlesVx,this.particlesIdx,Fe)};w.distortionStrength>0&&H(w.boxSize,!0),H(w.boxSize,!1),this._vignette.draw(t,E)}}const pl=n.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class zd extends Vu{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new gs(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const f=yp(this.particlesCount),_=new n.eN,w=new n.b0;let b=0;const E=n.eq(1323123451230);for(let A=0;A<f.length;++A){const M=f[A],I=E(),C=E(),J=E(),U=[A/f.length,I,C,J],H=[E(),E()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...U,...H),_.emplaceBack(M[0],M[1],M[2],1,-1,...U,...H),_.emplaceBack(M[0],M[1],M[2],1,1,...U,...H),_.emplaceBack(M[0],M[1],M[2],-1,1,...U,...H),w.emplaceBack(b+0,b+1,b+2),w.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=i.createVertexBuffer(_,pl.members),this.particlesIdx=i.createIndexBuffer(w)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const i=structuredClone(this._params);let f=[-i.direction.x,i.direction.y,-100];n.aw(f,f);const _=structuredClone(this._vignetteParams),w=i.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=t.transform.zoom;if(w.revealStart>b)return;const E=Ds(0,1,w.revealStart,w.revealStart+w.revealRange,b);_.strength*=E,i.overrideStyleParameters||(i.intensity=t.style.snow.state.density,i.timeFactor=t.style.snow.state.intensity,i.color=structuredClone(t.style.snow.state.color),f=structuredClone(t.style.snow.state.direction),i.screenThinning.intensity=t.style.snow.state.centerThinning,i.billboardSize=2.79*t.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(t.style.snow.state.vignetteColor));const A=this.updateOnRender(t,i.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const M=t.context,I=M.gl,C=t.transform,J=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(M,J),((U,H,q)=>{const ne=tr(this._movement.getPosition(),U),ae=C.width/2,se=C.height/2,he=Ds(0,q.screenThinning.start,0,1,q.screenThinning.intensity),ce=Ds(.001,q.screenThinning.range,0,1,q.screenThinning.intensity),Ze=Ds(0,q.screenThinning.particleOffset,0,1,q.screenThinning.intensity),me=(Ne={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:q.velocityConeAperture,velocity:q.velocity,horizontalOscillationRadius:q.horizontalOscillationRadius,horizontalOscillationRate:q.horizontalOscillationRate,boxSize:U,billboardSize:1*q.billboardSize,simpleShapeParameters:[q.shapeFadeStart,q.shapeFadePower],screenSize:[C.width,C.height],thinningCenterPos:[ae,se],thinningShape:[he,ce,Math.pow(10,q.screenThinning.fadePower)],thinningAffectedRatio:q.screenThinning.affectedRatio,thinningParticleOffset:Ze,color:[q.color.r,q.color.g,q.color.b,q.color.a],direction:f},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_horizontalOscillationRadius:Ne.horizontalOscillationRadius,u_horizontalOscillationRate:Ne.horizontalOscillationRate,u_boxSize:Ne.boxSize,u_billboardSize:Ne.billboardSize,u_simpleShapeParameters:Ne.simpleShapeParameters,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_particleColor:Ne.color,u_direction:Ne.direction});var Ne;const we=Math.round(q.intensity*this.particlesCount),ge=n.bf.simpleSegment(0,0,4*we,2*we);this.particlesVx&&this.particlesIdx&&J.draw(t,I.TRIANGLES,ca.disabled,za.disabled,Ya.alphaBlended,Ba.disabled,me,"snow_particles",this.particlesVx,this.particlesIdx,ge)})(i.boxSize,0,i),this._vignette.draw(t,_)}}const Nf={symbol:function(h,t,i,f,_){if(h.renderPass!=="translucent")return;const w=za.disabled,b=h.colorModeForRenderPass(),E=i.layout.get("text-variable-anchor"),A=i.layout.get("text-size-scale-range"),M=n.aA(h.scaleFactor,A[0],A[1]);E&&function(J,U,H,q,ne,ae,se,he){const ce=U.transform,Ze=ne==="map",me=ae==="map";for(const Ne of J){const we=q.getTile(Ne),ge=we.getBucket(H);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const Se=n.bJ(ge.textSizeData,ce.zoom,he),Pe=eh(Ne,ge.getProjection(),ce),Fe=ce.calculatePixelsToTileUnitsMatrix(we),it=$l(Pe,we.tileID.canonical,me,Ze,ce,ge.getProjection(),Fe),qe=ge.hasIconTextFit()&&ge.hasIconData();Se&&ko(ge,Ze,me,se,ce,it,Ne,Math.pow(2,ce.zoom-we.tileID.overscaledZ),Se,qe)}}(f,h,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),_,M);const I=i.paint.get("icon-opacity").constantOr(1)!==0,C=i.paint.get("text-opacity").constantOr(1)!==0;i.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||C)?Jo(h,t,i,f,w,b):(I&&Jo(h,t,i,f,w,b,{onlyIcons:!0}),C&&Jo(h,t,i,f,w,b,{onlyText:!0})),t.map.showCollisionBoxes&&(Zs(h,t,i,f,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Zs(h,t,i,f,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,i,f){if(h.renderPass!=="translucent")return;const _=i.paint.get("circle-opacity"),w=i.paint.get("circle-stroke-width"),b=i.paint.get("circle-stroke-opacity"),E=i.layout.get("circle-sort-key").constantOr(1)!==void 0,A=i.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(w.constantOr(1)===0||b.constantOr(1)===0))return;const M=h.context,I=M.gl,C=h.transform,J=!(!h.terrain||!h.terrain.enabled),U=i.layout.get("circle-elevation-reference"),H=h.depthModeForSublayer(0,ca.ReadOnly),q=new ca(h.context.gl.LEQUAL,ca.ReadOnly,h.depthRangeFor3D),ne=U==="none"||J?H:q,ae=za.disabled,se=h.colorModeForDrapableLayerRenderPass(A),he=C.projection.name==="globe",ce=[n.aF(C.center.lng),n.aJ(C.center.lat)],Ze=[];for(let Ne=0;Ne<f.length;Ne++){const we=f[Ne],ge=t.getTile(we),Se=ge.getBucket(i);if(!Se||Se.projection.name!==C.projection.name)continue;const Pe=Se.programConfigurations.get(i.id),Fe=Se.layoutVertexBuffer,it=Se.globeExtVertexBuffer,qe=Se.indexBuffer,dt=n.d$(i),Mt=[it],Xe=h.isTileAffectedByFog(we);he&&dt.push("PROJECTION_GLOBE_VIEW"),dt.push("DEPTH_D24"),h.terrain&&C.depthOcclusionForSymbolsAndCircles&&dt.push("DEPTH_OCCLUSION"),Se.hasElevation&&!h.terrain&&(dt.push("ELEVATED_ROADS"),Mt.push(Se.elevatedLayoutVertexBuffer));const Ie=h.getOrCreateProgram("circle",{config:Pe,defines:dt,overrideFog:Xe}),ct=C.projection.createInversionMatrix(C,we.canonical),et={programConfiguration:Pe,program:Ie,layoutVertexBuffer:Fe,dynamicBuffers:Mt,indexBuffer:qe,uniformValues:n.e0(h,we,ge,ct,ce,i),tile:ge};if(E){const jt=Se.segments.get();for(const Ct of jt)Ze.push({segments:new n.bf([Ct]),sortKey:Ct.sortKey,state:et})}else Ze.push({segments:Se.segments,sortKey:0,state:et})}E&&Ze.sort((Ne,we)=>Ne.sortKey-we.sortKey);const me={useDepthForOcclusion:C.depthOcclusionForSymbolsAndCircles};for(const Ne of Ze){const{programConfiguration:we,program:ge,layoutVertexBuffer:Se,dynamicBuffers:Pe,indexBuffer:Fe,uniformValues:it,tile:qe}=Ne.state,dt=Ne.segments;h.terrain&&h.terrain.setupElevationDraw(qe,ge,me),h.uploadCommonUniforms(M,ge,qe.tileID.toUnwrapped()),ge.draw(h,I.TRIANGLES,ne,ae,se,Ba.disabled,it,i.id,Se,Fe,dt,i.paint,C.zoom,we,Pe)}},heatmap:function(h,t,i,f){if(i.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,w=_.gl,b=za.disabled,E=new Ya([w.ONE,w.ONE,w.ONE,w.ONE],n.ao.transparent,[!0,!0,!0,!0]);(function(U,H,q,ne){const ae=U.gl,se=H.width*ne,he=H.height*ne;U.activeTexture.set(ae.TEXTURE1),U.viewport.set([0,0,se,he]);let ce=q.heatmapFbo;if(!ce||ce&&(ce.width!==se||ce.height!==he)){ce&&ce.destroy();const Ze=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Ze),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),ce=q.heatmapFbo=U.createFramebuffer(se,he,!0,null),function(me,Ne,we,ge,Se,Pe){const Fe=me.gl;Fe.texImage2D(Fe.TEXTURE_2D,0,me.extRenderToTextureHalfFloat?Fe.RGBA16F:Fe.RGBA,Se,Pe,0,Fe.RGBA,me.extRenderToTextureHalfFloat?Fe.HALF_FLOAT:Fe.UNSIGNED_BYTE,null),ge.colorAttachment.set(we)}(U,0,Ze,ce,se,he)}else ae.bindTexture(ae.TEXTURE_2D,ce.colorAttachment.get()),U.bindFramebuffer.set(ce.framebuffer)})(_,h,i,h.transform.projection.name==="globe"?.5:.25),_.clear({color:n.ao.transparent});const A=h.transform,M=A.projection.name==="globe",I=M?["PROJECTION_GLOBE_VIEW"]:[],C=M?Ba.frontCCW:Ba.disabled,J=[n.aF(A.center.lng),n.aJ(A.center.lat)];for(let U=0;U<f.length;U++){const H=f[U];if(t.hasRenderableParent(H))continue;const q=t.getTile(H),ne=q.getBucket(i);if(!ne||ne.projection.name!==A.projection.name)continue;const ae=h.isTileAffectedByFog(H),se=ne.programConfigurations.get(i.id),he=h.getOrCreateProgram("heatmap",{config:se,defines:I,overrideFog:ae}),{zoom:ce}=h.transform;h.terrain&&h.terrain.setupElevationDraw(q,he),h.uploadCommonUniforms(_,he,H.toUnwrapped());const Ze=A.projection.createInversionMatrix(A,H.canonical);he.draw(h,w.TRIANGLES,ca.disabled,b,E,C,lp(h,H,q,Ze,J,ce,i.paint.get("heatmap-intensity")),i.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,i.paint,h.transform.zoom,se,M?[ne.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,w){const b=_.context,E=b.gl,A=w.heatmapFbo;if(!A)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1);let M=w.colorRampTexture;M||(M=w.colorRampTexture=new n.T(b,w.colorRamp,E.RGBA8)),M.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,E.TRIANGLES,ca.disabled,za.disabled,_.colorModeForRenderPass(),Ba.disabled,((I,C,J,U)=>({u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")}))(0,w),w.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,w.paint,_.transform.zoom)}(h,i))},line:function(h,t,i,f){if(h.renderPass!=="translucent")return;const _=i.paint.get("line-opacity"),w=i.paint.get("line-width");if(_.constantOr(1)===0||w.constantOr(1)===0)return;const b=i.paint.get("line-emissive-strength"),E=i.paint.get("line-occlusion-opacity"),A=i.layout.get("line-elevation-reference"),M=i.layout.get("line-width-unit")==="meters",I=A==="sea",C=!(!h.terrain||!h.terrain.enabled),J=h.context,U=J.gl;if(i.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const H=i.layout.get("line-cross-slope"),q=H!==void 0,ne=H<1,ae=h.colorModeForDrapableLayerRenderPass(b),se=h.terrain&&h.terrain.renderingToTexture,he=se?1:n.o.devicePixelRatio,ce=i.paint.get("line-dasharray"),Ze=ce.constantOr(1),me=i.layout.get("line-cap"),Ne=ce.constantOr(null),we=me.constantOr(null),ge=i.paint.get("line-pattern"),Se=ge.constantOr(1),Pe=i.paint.get("line-pattern-cross-fade"),Fe=ge.constantOr(null),it=i.paint.get("line-opacity").constantOr(1);let qe=!Se&&it!==1||h.depthOcclusion&&E>0&&E<1;const dt=i.paint.get("line-gradient"),Mt=Se?"linePattern":"line",Xe=n.e1(i);let Ie;if(se&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(qe=!1),E!==0&&h.depthOcclusion){const Ct=i.paint._values["line-opacity"];Ct&&Ct.value&&Ct.value.kind==="constant"?Ie=Ct.value:n.w(`Occlusion opacity for layer ${i.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&Xe.push("VARIABLE_LINE_WIDTH");const ct=(Ct,oa,Bt,Ot,la,ra)=>{for(const Ht of Ct){const ia=t.getTile(Ht);if(Se&&!ia.patternsLoaded())continue;const va=ia.getBucket(i);if(!va||va.elevationType!=="none"&&!la||va.elevationType==="none"&&la)continue;h.prepareDrawTile();const ir=[...oa],Oa=h.shadowRenderer,Qr=va.elevationType==="road"&&!!Oa&&Oa.enabled;let Ta=[0,0,0];if(Qr){const Va=h.style.directionalLight,yr=h.style.ambientLight;Va&&yr&&(Ta=Bo(h.style,Va,yr)),ir.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const pr=va.programConfigurations.get(i.id);let Ua=!1;if(Fe&&ia.imageAtlas){const Va=n.e2.from(Fe),yr=Va.getPrimary().scaleSelf(he).toString(),_n=ia.imageAtlas.patternPositions.get(yr),Hn=Va.getSecondary(),wn=Hn?ia.imageAtlas.patternPositions.get(Hn.scaleSelf(he).toString()):null;Ua=!!_n&&!!wn,_n&&pr.setConstantPatternPositions(_n,wn)}Pe>0&&(Ua||pr.getPatternTransitionVertexBuffer("line-pattern"))&&ir.push("LINE_PATTERN_TRANSITION");const Cr=h.isTileAffectedByFog(Ht),mr=h.getOrCreateProgram(Mt,{config:pr,defines:ir,overrideFog:Cr});if(!Se&&Ne&&we&&ia.lineAtlas){const Va=ia.lineAtlas.getDash(Ne,we);Va&&pr.setConstantPatternPositions(Va)}Qr&&Oa.setupShadows(ia.tileID.toUnwrapped(),mr,"vector-tile");let[Kr,sr]=i.paint.get("line-trim-offset");(we==="round"||we==="square")&&Kr!==sr&&(Kr===0&&(Kr-=1),sr===1&&(sr+=1));const Ga=se?Ht.projMatrix:null,Rr=M?1/va.tileToMeter/n.ay(ia,1,h.transform.zoom):1,Ca=M?1/va.tileToMeter/n.ay(ia,1,Math.floor(h.transform.zoom)):1,en=Se?n.e3(h,ia,i,Ga,he,Rr,Ca,[Kr,sr],Ta,Pe):n.e4(h,ia,i,Ga,va.lineClipsArray.length,he,Rr,Ca,[Kr,sr],Ta);if(dt){const Va=va.gradients[i.id];let yr=Va.texture;if(i.gradientVersion!==Va.version){let _n=256;if(i.stepInterpolant){const Hn=t.getSource().maxzoom,wn=Ht.canonical.z===Hn?Math.ceil(1<<h.transform.maxZoom-Ht.canonical.z):1;_n=n.aA(n.e5(va.maxLineLength/n.al*1024*wn),256,J.maxTextureSize)}Va.gradient=n.e6({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:_n,image:Va.gradient||void 0,clips:va.lineClipsArray}),Va.texture?Va.texture.update(Va.gradient):Va.texture=new n.T(J,Va.gradient,U.RGBA8),Va.version=i.gradientVersion,yr=Va.texture}J.activeTexture.set(U.TEXTURE1),yr.bind(i.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}Ze&&(J.activeTexture.set(U.TEXTURE0),ia.lineAtlasTexture&&ia.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),pr.updatePaintBuffers()),Se&&(J.activeTexture.set(U.TEXTURE0),ia.imageAtlasTexture&&ia.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),pr.updatePaintBuffers()),la&&!I&&h.terrain.setupElevationDraw(ia,mr),h.uploadCommonUniforms(J,mr,Ht.toUnwrapped());const _r=Va=>{Ie!=null&&(Ie.value=it*E),mr.draw(h,U.TRIANGLES,Bt,Va,ae,Ba.disabled,en,i.id,va.layoutVertexBuffer,va.indexBuffer,va.segments,i.paint,h.transform.zoom,pr,[va.layoutVertexBuffer2,va.patternVertexBuffer,va.zOffsetVertexBuffer]),Ie!=null&&(Ie.value=it)};if(qe&&!la){const Va=h.stencilModeForClipping(Ht).ref;Va===0&&se&&J.clear({stencil:0});const yr={func:U.EQUAL,mask:255};en.u_alpha_discard_threshold=.8,_r(new za(yr,Va,255,U.KEEP,U.KEEP,U.INVERT)),en.u_alpha_discard_threshold=0,_r(new za(yr,Va,255,U.KEEP,U.KEEP,U.KEEP))}else en.u_alpha_discard_threshold=qe&&la&&ra?.8:0,_r(la?Ot:h.stencilModeForClipping(Ht))}};let et=h.depthModeForSublayer(0,ca.ReadOnly);const jt=new ca(h.depthOcclusion?U.GREATER:U.LEQUAL,ca.ReadOnly,h.depthRangeFor3D);if(i.hasNonElevatedBuckets){const Ct=!se&&h.terrain;E!==0&&Ct?n.w(`Occlusion opacity for layer ${i.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ct?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${i.id}.`):ct(f,Xe,et,za.disabled,!1,!0)}if(i.hasElevatedBuckets){A==="hd-road-markup"?C||(et=jt,Xe.push("ELEVATED_ROADS")):(Xe.push("ELEVATED"),et=jt,q&&Xe.push(ne?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),I&&Xe.push("ELEVATION_REFERENCE_SEA"));const Ct=qe?h.stencilModeFor3D():za.disabled;h.forceTerrainMode=!0,ct(f,Xe,et,Ct,!0,!0),qe&&ct(f,Xe,et,Ct,!0,!1),h.forceTerrainMode=!1}qe&&(h.resetStencilClippingMasks(),se&&J.clear({stencil:0})),E===0||h.depthOcclusion||se||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,i,f){const _=i.paint.get("fill-color"),w=i.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const b=i.paint.get("fill-emissive-strength"),E=h.colorModeForDrapableLayerRenderPass(b),A=i.paint.get("fill-pattern"),M=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&_.constantOr(n.ao.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let I="none";i.layout.get("fill-elevation-reference")!=="none"?I="road":i.paint.get("fill-z-offset").constantOr(1)!==0&&(I="offset");const C=!(!h.terrain||!h.terrain.enabled),J={painter:h,sourceCache:t,layer:i,coords:f,colorMode:E,elevationType:I,terrainEnabled:C,pass:M};if(h.renderPass!=="shadow")if(I!=="offset"){if(wo(J,!1),I==="road"){const U=!C&&h.renderPass==="translucent";U&&Fs(h,t,i,f,"geometry"),wo(J,!0,za.disabled),U&&function(H){const{painter:q,sourceCache:ne,layer:ae,coords:se,colorMode:he}=H,ce=q.context.gl,Ze=H.painter.shadowRenderer,me=!!Ze&&Ze.enabled,Ne=new ca(q.context.gl.LEQUAL,ca.ReadOnly,q.depthRangeFor3D);let we=[0,0,0];if(me){const Se=q.style.directionalLight,Pe=q.style.ambientLight;Se&&Pe&&(we=Bo(q.style,Se,Pe))}const ge=Se=>{for(const Pe of se){const Fe=ne.getTile(Pe),it=Fe.getBucket(ae);if(!it)continue;const qe=it.elevatedStructures;if(!qe)continue;let dt,Mt;if(Se?(dt=qe.renderableBridgeSegments,Mt=qe.bridgeProgramConfigurations.get(ae.id)):(dt=qe.renderableTunnelSegments,Mt=qe.tunnelProgramConfigurations.get(ae.id)),!dt||dt.segments[0].primitiveLength===0)continue;Mt.updatePaintBuffers(),q.prepareDrawTile();const Xe=q.isTileAffectedByFog(Pe),Ie=[];me&&Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ct=q.getOrCreateProgram("elevatedStructures",{config:Mt,overrideFog:Xe,defines:Ie}),et=q.translatePosMatrix(Pe.projMatrix,Fe,ae.paint.get("fill-translate"),ae.paint.get("fill-translate-anchor"));me&&Ze.setupShadows(Fe.tileID.toUnwrapped(),ct,"vector-tile");const jt=lm(et,we);q.uploadCommonUniforms(q.context,ct,Pe.toUnwrapped()),ct.draw(q,ce.TRIANGLES,Ne,za.disabled,he,Ba.backCCW,jt,ae.id,qe.vertexBuffer,qe.indexBuffer,dt,ae.paint,q.transform.zoom,Mt,[qe.vertexBufferNormal])}};ge(!0),ge(!1)}(J)}}else wo(J,!1,h.stencilModeFor3D());else h.shadowRenderer&&I==="road"&&!C&&function(U){const{painter:H,sourceCache:q,layer:ne,coords:ae}=U,se=H.context.gl,he=U.painter.shadowRenderer;for(const ce of ae){const Ze=q.getTile(ce),me=Ze.getBucket(ne);if(!me)continue;const Ne=me.elevatedStructures;if(!Ne||!Ne.shadowCasterSegments||Ne.shadowCasterSegments.segments[0].primitiveLength===0)continue;H.prepareDrawTile();const we=me.bufferData.programConfigurations.get(ne.id),ge=H.isTileAffectedByFog(ce),Se=H.getOrCreateProgram("elevatedStructuresDepth",{config:we,overrideFog:ge}),Pe=he.calculateShadowPassMatrixFromTile(Ze.tileID.toUnwrapped());H.uploadCommonUniforms(H.context,Se,ce.toUnwrapped());const Fe={u_matrix:Pe,u_depth_bias:0};Se.draw(H,se.TRIANGLES,he.getShadowPassDepthMode(),za.disabled,he.getShadowPassColorMode(),Ba.disabled,Fe,ne.id,Ne.vertexBuffer,Ne.indexBuffer,Ne.shadowCasterSegments,ne.paint,H.transform.zoom,we)}}(J)},"fill-extrusion":function(h,t,i,f){const _=i.paint.get("fill-extrusion-opacity"),w=h.context,b=w.gl,E=h.terrain,A=E&&E.renderingToTexture;if(_===0)return;const M=h.conflationActive&&h.style.isLayerClipped(i,t.getSource()),I=h.style.order.indexOf(i.fqid);if(M&&function(C,J,U,H,q){for(const ne of H){const ae=J.getTile(ne).getBucket(U);ae&&(ae.updateReplacement(ne,C.replacementSource,q),ae.uploadCentroid(C.context))}}(h,t,i,f,I),E||M)for(const C of f){const J=t.getTile(C).getBucket(i);J&&lc(h.context,t,C,J,i,E,M)}if(h.renderPass==="shadow"&&h.shadowRenderer){const C=h.shadowRenderer;if(E&&_<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ad)return;const J=C.getShadowPassDepthMode(),U=C.getShadowPassColorMode();na(h,t,i,f,J,za.disabled,U,M)}else if(h.renderPass==="translucent"){const C=!i.paint.get("fill-extrusion-pattern").constantOr(1),J=i.paint.get("fill-extrusion-color").constantOr(n.ao.white);if(!A&&J.a!==0){const U=new ca(h.context.gl.LEQUAL,ca.ReadWrite,h.depthRangeFor3D);_===1&&C?na(h,t,i,f,U,za.disabled,Ya.unblended,M):(na(h,t,i,f,U,za.disabled,Ya.disabled,M),na(h,t,i,f,U,h.stencilModeFor3D(),h.colorModeForRenderPass(),M),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&C&&(!E&&h.transform.projection.name!=="globe"||A)){const U=i.paint.get("fill-extrusion-opacity"),H=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ne=i.paint.get("fill-extrusion-flood-light-intensity"),ae=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",se=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ae?null:i.lut).toArray01().slice(0,3),he=H>0&&q>0,ce=ne>0,Ze=(we,ge,Se)=>(1-Se)*we+Se*ge,me=new yf;me.translate=i.paint.get("fill-extrusion-translate"),me.translateAnchor=i.paint.get("fill-extrusion-translate-anchor"),me.edgeRadius=i.layout.get("fill-extrusion-edge-radius"),me.cutoffFadeRange=i.paint.get("fill-extrusion-cutoff-fade-range");const Ne=we=>{const ge=h.depthModeForSublayer(1,ca.ReadOnly,b.LEQUAL,!0),Se=i.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pe=Ze(.1,3,Se),Fe=h._showOverdrawInspector;if(!Fe){const it=new za({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),qe=new Ya([b.ONE,b.ONE,b.ONE,b.ONE],n.ao.transparent,[!1,!1,!1,!0],b.MIN);Fo(me,h,t,i,f,ge,it,qe,Ba.disabled,we,"sdf",U,H,q,ne,se,Pe,M,!1)}{const it=Fe?za.disabled:new za({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),qe=Fe?h.colorModeForRenderPass():new Ya([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],n.ao.transparent,[!0,!0,!0,!0]);Fo(me,h,t,i,f,ge,it,qe,Ba.disabled,we,"color",U,H,q,ne,se,Pe,M,!1)}};if(A){const we=(ge,Se,Pe)=>{const Fe=h.depthModeForSublayer(1,ca.ReadOnly,b.LEQUAL,!1),it=i.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qe=Ze(.1,3,it);{const dt=new Ya([b.ONE,b.ONE,b.ONE,b.ONE],n.ao.transparent,[!1,!1,!1,!0]);Fo(me,h,t,i,f,Fe,za.disabled,dt,Ba.disabled,ge,"clear",U,H,q,ne,se,qe,M,Se)}{const dt=new za({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Mt=new Ya([b.ONE,b.ONE,b.ONE,b.ONE],n.ao.transparent,[!1,!1,!1,!0],b.MIN);Fo(me,h,t,i,f,Fe,dt,Mt,Ba.disabled,ge,"sdf",U,H,q,ne,se,qe,M,Se)}{const dt=ge?b.ZERO:b.ONE_MINUS_DST_ALPHA,Mt=new za({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Xe=new Ya([dt,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],n.ao.transparent,[!0,!0,!0,!0]);Fo(me,h,t,i,f,Fe,Mt,Xe,Ba.disabled,ge,"color",U,H,q,ne,se,qe,M,Se)}{const dt=new Ya([b.ONE,b.ONE,b.ONE,ge?b.ZERO:b.ONE],n.ao.transparent,[!1,!1,!1,!0],ge?b.FUNC_ADD:b.MAX);Fo(me,h,t,i,f,Fe,za.disabled,dt,Ba.disabled,ge,"clear",U,H,q,ne,se,qe,M,Se,Pe)}};if(he||ce){let ge;if(h.prepareDrawTile(),E){const Se=E.drapeBufferSize[0],Pe=E.drapeBufferSize[1];ge=E.framebufferCopyTexture,ge&&(!ge||ge.size[0]===Se&&ge.size[1]===Pe)||(ge&&ge.destroy(),ge=E.framebufferCopyTexture=new n.T(w,new n.q({width:Se,height:Pe}),b.RGBA8)),ge.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Se,Pe)}he&&we(!0,!1,ge),ce&&we(!1,!0,ge)}}else he&&Ne(!0),ce&&Ne(!1),(he||ce)&&h.resetStencilClippingMasks()}}},building:function(h,t,i,f){h.currentLayer<h.firstLightBeamLayer&&(h.firstLightBeamLayer=h.currentLayer);const _=i.paint.get("building-ambient-occlusion-ground-intensity"),w=i.paint.get("building-ambient-occlusion-ground-radius"),b=i.paint.get("building-ambient-occlusion-ground-attenuation"),E=i.paint.get("building-opacity");if(E<=0)return;let A=_>0&&w>0,M=!0;const I=i.paint.get("building-vertical-scale");if(I<=0)return;(!h.shadowRenderer||I<1)&&(M=!1);const C=h.conflationActive&&h.style.isLayerClipped(i,t.getSource()),J=h.style.order.indexOf(i.fqid);if(function(U,H,q,ne,ae,se){for(const he of se){const ce=H.getTile(he).getBucket(q);ce&&(ae&&ce.updateReplacement(he,U.replacementSource,ne),ce.uploadUpdatedIndexBuffer(U.context))}}(h,t,i,J,C,f),function(U,H,q,ne){for(const ae of ne){const se=H.getTile(ae).getBucket(q);se&&se.needsEvaluation()&&se.uploadUpdatedColorBuffer(U.context)}}(h,t,i,f),i.resetLayerRenderingStats(h),h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0),h.renderPass==="shadow"&&h.shadowRenderer){const U=h.shadowRenderer,H=[],q=U.getShadowPassDepthMode();Ml({painter:h,source:t,layer:i,coords:f,defines:H,blendMode:U.getShadowPassColorMode(),depthMode:q,opacity:E,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(h.renderPass==="translucent"){let U=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(U=U.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),h.shadowRenderer&&h.shadowRenderer.useNormalOffset&&(U=U.concat("NORMAL_OFFSET"));const H=i.paint.get("building-facade-emissive-chance"),q=i.paint.get("building-ambient-occlusion-intensity"),ne=i.paint.get("building-flood-light-intensity"),ae=i.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",se=i.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ae?null:i.lut).toArray01().slice(0,3),he=i.paint.get("building-flood-light-ground-attenuation"),ce=ne>0,Ze=new ca(h.context.gl.LEQUAL,ca.ReadWrite,h.depthRangeFor3D);E<1&&Ml({painter:h,source:t,layer:i,coords:f,defines:U,blendMode:Ya.disabled,depthMode:Ze,opacity:E,verticalScale:I,facadeEmissiveChance:H,facadeAOIntensity:q,floodLightIntensity:ne,floodLightColor:se,depthOnly:!0});const me=h.colorModeForRenderPass();Ml({painter:h,source:t,layer:i,coords:f,defines:U,blendMode:me,depthMode:Ze,opacity:E,verticalScale:I,facadeEmissiveChance:H,facadeAOIntensity:q,floodLightIntensity:ne,floodLightColor:se}),A&&Nd(h,t,i,f,!0,E,_,w,ne,se,b,C),ce&&Nd(h,t,i,f,!1,E,_,w,ne,se,he,C)}else if(h.renderPass==="light-beam"){const U=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],H=new ca(h.context.gl.LEQUAL,ca.ReadOnly,h.depthRangeFor3D);Ml({painter:h,source:t,layer:i,coords:f,defines:U,blendMode:Ya.alphaBlended,depthMode:H,opacity:E,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1),h.resetStencilClippingMasks()},hillshade:function(h,t,i,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const _=h.context,w=h.terrain&&h.terrain.renderingToTexture,[b,E]=h.renderPass!=="translucent"||w?[{},f]:h.stencilConfigForOverlap(f);for(const A of E){const M=t.getTile(A);if(M.needsHillshadePrepare&&h.renderPass==="offscreen")ph(h,M,i);else if(h.renderPass==="translucent"){const I=h.depthModeForSublayer(0,ca.ReadOnly),C=i.paint.get("hillshade-emissive-strength"),J=h.colorModeForDrapableLayerRenderPass(C),U=w&&h.terrain?h.terrain.stencilModeForRTTOverlap(A):b[A.overscaledZ];np(h,A,M,i,I,U,J)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,i,f,_,w){if(h.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;const b=h.transform.projection.name==="globe",E=i.paint.get("raster-elevation")!==0,A=E&&b;if(h.renderElevatedRasterBackface&&!A)return;const M=h.context,I=M.gl,C=t.getSource(),J=function(me,Ne,we,ge){const Se=Ne.paint.get("raster-color"),Pe=me.type==="raster-array",Fe=[],it=Ne.paint.get("raster-resampling"),qe=Ne.paint.get("raster-color-mix");let dt=Ne.paint.get("raster-color-range");const Mt=[qe[0],qe[1],qe[2],0],Xe=qe[3];let Ie=it==="nearest"?ge.NEAREST:ge.LINEAR;if(Pe&&(Fe.push("RASTER_ARRAY"),Se||Fe.push("RASTER_COLOR"),it==="linear"&&Fe.push("RASTER_ARRAY_LINEAR"),Ie=ge.NEAREST,!dt&&me.rasterLayers)){const ct=me.rasterLayers.find(({id:et})=>et===Ne.sourceLayer);ct&&ct.fields&&ct.fields.range&&(dt=ct.fields.range)}if(dt=dt||[0,1],Se){Fe.push("RASTER_COLOR"),we.activeTexture.set(ge.TEXTURE2),Ne.updateColorRamp(dt);let ct=Ne.colorRampTexture;ct||(ct=Ne.colorRampTexture=new n.T(we,Ne.colorRamp,ge.RGBA8)),ct.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}return{mix:Mt,range:dt,offset:Xe,defines:Fe,resampling:Ie}}(C,i,M,I);if(C instanceof n.aT&&!f.length&&!b)return;const U=i.paint.get("raster-emissive-strength"),H=h.colorModeForDrapableLayerRenderPass(U),q=h.terrain&&h.terrain.renderingToTexture,ne=!h.options.moving,ae=i.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;if(C instanceof n.aT&&!f.length&&(C.onNorthPole||C.onSouthPole)){const me=E?h.stencilModeFor3D():za.disabled;return void gf(!!C.onNorthPole,null,h,t,i,U,J,Ba.disabled,me)}if(!f.length)return;const[se,he]=C instanceof n.aT||q?[{},f]:h.stencilConfigForOverlap(f),ce=he[he.length-1].overscaledZ;A&&J.defines.push("PROJECTION_GLOBE_VIEW"),E&&J.defines.push("RENDER_CUTOFF");const Ze=(me,Ne,we)=>{for(const ge of me){const Se=ge.toUnwrapped(),Pe=t.getTile(ge);if(q&&(!Pe||!Pe.hasData()))continue;M.activeTexture.set(I.TEXTURE0);const Fe=xi(Pe,C,i,J);if(!Fe||!Fe.texture)continue;const{texture:it,mix:qe,offset:dt,tileSize:Mt,buffer:Xe}=Fe;let Ie,ct;q?(Ie=ca.disabled,ct=ge.projMatrix):E?(Ie=new ca(I.LEQUAL,ca.ReadWrite,h.depthRangeFor3D),ct=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Se,ne)):(Ie=h.depthModeForSublayer(ge.overscaledZ-ce,i.paint.get("raster-opacity")===1?ca.ReadWrite:ca.ReadOnly,I.LESS),ct=h.transform.calculateProjMatrix(Se,ne));const et=h.terrain&&q?h.terrain.stencilModeForRTTOverlap(ge):se[ge.overscaledZ],jt=w?0:i.paint.get("raster-fade-duration");Pe.registerFadeDuration(jt);const Ct=t.findLoadedParent(ge,0),oa=xh(Pe,Ct,t,h.transform,jt);let Bt,Ot;!oa.isFading&&Pe.refreshedUponExpiration&&(Pe.refreshedUponExpiration=!1),h.terrain&&h.terrain.prepareDrawTile(),M.activeTexture.set(I.TEXTURE0),it.bind(ae,I.CLAMP_TO_EDGE),M.activeTexture.set(I.TEXTURE1),Ct?(Ct.texture&&Ct.texture.bind(ae,I.CLAMP_TO_EDGE),Bt=Math.pow(2,Ct.tileID.overscaledZ-Pe.tileID.overscaledZ),Ot=[Pe.tileID.canonical.x*Bt%1,Pe.tileID.canonical.y*Bt%1]):it.bind(ae,I.CLAMP_TO_EDGE),"useMipmap"in it&&M.extTextureFilterAnisotropic&&h.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const la=h.transform;let ra;const Ht=E?_f(la):[0,0,0,0];let ia,va,ir,Oa,Qr,Ta=0;if(A&&C instanceof n.aT&&C.coordinates.length>3)ia=Float32Array.from(n.bj(n.dI(new n.cC(0,0,0)))),va=Float32Array.from(la.globeMatrix),ir=Float32Array.from(n.dE(la)),Oa=[n.aF(la.center.lng),n.aJ(la.center.lat)],ra=C.elevatedGlobePerspectiveTransform,Qr=C.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const mr=n.dF(ge.canonical);Ta=n.dG(mr.getCenter().lat),ia=Float32Array.from(n.bj(n.dI(ge.canonical))),va=Float32Array.from(la.globeMatrix),ir=Float32Array.from(n.dE(la)),Oa=[n.aF(la.center.lng),n.aJ(la.center.lat)],ra=[0,0],Qr=Float32Array.from(n.dH(ge.canonical,mr,Ta,la.worldSize/la._pixelsPerMercatorPixel))}else ra=C instanceof n.aT?C.perspectiveTransform:[0,0],ia=new Float32Array(16),va=new Float32Array(9),ir=new Float32Array(16),Oa=[0,0],Qr=new Float32Array(9);const pr=wd(ct,ia,va,ir,Qr,Ot||[0,0],n.aj(h.transform.zoom),Oa,Ht,Bt||1,oa,i,ra,E?i.paint.get("raster-elevation"):0,2,qe,dt,J.range,Mt,Xe,U),Ua=h.isTileAffectedByFog(ge),Cr=h.getOrCreateProgram("raster",{defines:J.defines,overrideFog:Ua});if(h.uploadCommonUniforms(M,Cr,Se),C instanceof n.aT){const mr=C.elevatedGlobeVertexBuffer,Kr=C.elevatedGlobeIndexBuffer;if(q||!b)C.boundsBuffer&&C.boundsSegments&&Cr.draw(h,I.TRIANGLES,Ie,za.disabled,H,Ba.disabled,pr,i.id,C.boundsBuffer,h.quadTriangleIndexBuffer,C.boundsSegments);else if(mr&&Kr){const sr=la.zoom<=n.cZ?C.elevatedGlobeSegments:C.getSegmentsForLongitude(la.center.lng);sr&&Cr.draw(h,I.TRIANGLES,Ie,za.disabled,H,Ne,pr,i.id,mr,Kr,sr)}}else if(A){Ie=new ca(I.LEQUAL,ca.ReadOnly,h.depthRangeFor3D);const mr=h.globeSharedBuffers;if(mr){const[Kr,sr,Ga]=mr.getGridBuffers(Ta,!1);Cr.draw(h,I.TRIANGLES,Ie,we||et,h.colorModeForRenderPass(),Ne,pr,i.id,Kr,sr,Ga)}}else{const{tileBoundsBuffer:mr,tileBoundsIndexBuffer:Kr,tileBoundsSegments:sr}=h.getTileBoundsBuffers(Pe);Cr.draw(h,I.TRIANGLES,Ie,et,H,Ba.disabled,pr,i.id,mr,Kr,sr)}}if(!(C instanceof n.aT)&&A)for(const ge of me){const Se=ge.canonical.y===(1<<ge.canonical.z)-1;ge.canonical.y===0&&gf(!0,ge,h,t,i,U,J,Ne,we||za.disabled),Se&&gf(!1,ge,h,t,i,U,J,Ne===Ba.frontCW?Ba.backCW:Ba.frontCW,we||za.disabled)}};A?Ze(he,h.renderElevatedRasterBackface?Ba.backCW:Ba.frontCW,h.stencilModeFor3D()):Ze(he,Ba.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,i,f,_,w){h.renderPass==="offscreen"&&function(b,E,A,M){if(!M.length)return;const I=b.context,C=I.gl,J=E.getSource();if(!(J instanceof Ni))return;const U=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let H=A.particlePositionRGBAImage;if(!H||H.width!==U){const he=function(ce){const Ze=ce*ce,me=new Uint8Array(4*Ze),Ne=function(ge){return ge|=0,ge=Math.imul(2747636419^ge,2654435769),ge=Math.imul(ge^ge>>>16,2654435769),((ge=Math.imul(ge^ge>>>16,2654435769))>>>0)/4294967296},we=1/1.1;for(let ge=0;ge<Ze;ge++){const Se=we*(Ne(2*ge+0)+Pc),Pe=we*(Ne(2*ge+1)+Pc),Fe=255*Se%1,it=255*Pe%1,qe=Fe,dt=Pe-it/255,Mt=it;me[4*ge+0]=255*(Se-Fe/255),me[4*ge+1]=255*qe,me[4*ge+2]=255*dt,me[4*ge+3]=255*Mt}return me}(U);H=A.particlePositionRGBAImage=new n.q({width:U,height:U},he)}let q=A.particleFramebuffer;q?q.width!==U&&(q.destroy(),q=A.particleFramebuffer=I.createFramebuffer(U,U,!0,null)):q=A.particleFramebuffer=I.createFramebuffer(U,U,!0,null);const ne=[];for(const he of M){const ce=E.getTile(he);if(!(ce instanceof Ro))continue;const Ze=Ah(ce,J,A);if(!Ze)continue;const me=[ce.tileSize,ce.tileSize];let Ne=A.tileFramebuffer;Ne||(Ne=A.tileFramebuffer=I.createFramebuffer(me[0],me[1],!0,null));let we=ce.rasterParticleState;we||(we=ce.rasterParticleState=new Ns(I,he,me,H));const ge=we.update(A.lastInvalidatedAt);we.particleTextureDimension!==U&&we.updateParticleTexture(he,H);const Se=we.targetColorTexture;we.targetColorTexture=we.backgroundColorTexture,we.backgroundColorTexture=Se;const Pe=we.particleTexture0;we.particleTexture0=we.particleTexture1,we.particleTexture1=Pe,ne.push([he,Ze,we,ge])}if(ne.length===0)return;const ae=n.o.now(),se=A.previousDrawTimestamp?.001*(ae-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=ae,A.hasColorMap()){I.activeTexture.set(C.TEXTURE0+2);let he=A.colorRampTexture;he||(he=A.colorRampTexture=new n.T(I,A.colorRamp,C.RGBA8)),he.bind(C.LINEAR,C.CLAMP_TO_EDGE)}I.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(he,ce,Ze){const me=he.context,Ne=me.gl,we=ce.tileFramebuffer;me.activeTexture.set(Ne.TEXTURE0);const ge={u_texture:0,u_opacity:1.05*(Pe=ce.paint.get("raster-particle-fade-opacity-factor"))/(Pe+.05)},Se=he.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Pe;for(const Fe of Ze){const[,,it,qe]=Fe;we.colorAttachment.set(it.targetColorTexture.texture),me.viewport.set([0,0,we.width,we.height]),me.clear({color:n.ao.transparent}),qe&&(it.backgroundColorTexture.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE),Se.draw(he,Ne.TRIANGLES,ca.disabled,za.disabled,Ya.alphaBlended,Ba.disabled,ge,ce.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments))}}(b,A,ne),function(he,ce,Ze,me){const Ne=he.context,we=Ne.gl,ge=Ze.tileFramebuffer,Se=he.transform.projection.name==="globe",Pe=Ze.paint.get("raster-particle-max-speed");for(const Fe of me){const[it,qe,dt]=Fe;Ne.activeTexture.set(we.TEXTURE0+0),qe.texture.bind(we.LINEAR,we.CLAMP_TO_EDGE),ge.colorAttachment.set(dt.targetColorTexture.texture);const Mt=he.getOrCreateProgram("rasterParticleDraw",{defines:qe.defines,overrideFog:!1});Ne.activeTexture.set(we.TEXTURE0+1);const Xe=qe.scalarData?[]:[0,1,2,3].map(et=>n.e8[et](it));Xe.push(it);const Ie=it.canonical.x,ct=it.canonical.y;for(const et of Xe){const jt=ce.getTile(Se?et.wrapped():et);if(!jt)continue;const Ct=jt.rasterParticleState;if(!Ct)continue;const oa=et.canonical.x+(1<<et.canonical.z)*(et.wrap-it.wrap),Bt=et.canonical.y;Ct.particleTexture0.bind(we.NEAREST,we.CLAMP_TO_EDGE);const Ot=jh(1,Ct.particleTexture0.size[0],[oa-Ie,Bt-ct],0,qe.texture.size,2,Pe,qe.textureOffset,qe.scale,qe.offset);Mt.draw(he,we.POINTS,ca.disabled,za.disabled,Ya.alphaBlended,Ba.disabled,Ot,Ze.id,Ct.particleIndexBuffer,void 0,Ct.particleSegment)}}}(b,E,A,ne),I.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(he,ce,Ze,me){const Ne=he.context,we=Ne.gl,ge=ce.paint.get("raster-particle-max-speed"),Se=me*ce.paint.get("raster-particle-speed-factor")*.15,Pe=function(it){return Math.pow(it,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Fe=ce.particleFramebuffer;Ne.viewport.set([0,0,Fe.width,Fe.height]);for(const it of Ze){const[,qe,dt]=it;Ne.activeTexture.set(we.TEXTURE0+0),qe.texture.bind(we.LINEAR,we.CLAMP_TO_EDGE),Ne.activeTexture.set(we.TEXTURE0+1);const Mt=dt.particleTexture0;Mt.bind(we.NEAREST,we.CLAMP_TO_EDGE);const Xe=ff(1,Mt.size[0],0,qe.texture.size,ge,Se,Pe,qe.textureOffset,qe.scale,qe.offset);Fe.colorAttachment.set(dt.particleTexture1.texture),Ne.clear({color:n.ao.transparent}),he.getOrCreateProgram("rasterParticleUpdate",{defines:qe.defines}).draw(he,we.TRIANGLES,ca.disabled,za.disabled,Ya.unblended,Ba.disabled,Xe,ce.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments)}}(b,A,ne,se)}(h,t,i,f),h.renderPass==="translucent"&&(function(b,E,A,M,I){const C=b.context,J=C.gl,U=E.getSource().tileSize,H=5*(1-n.ah(n.cK,n.cK+1,b.transform.zoom))*U+A.paint.get("raster-particle-elevation"),q=!b.options.moving,ne=b.transform.projection.name==="globe";if(!M.length)return;const[ae,se]=b.stencilConfigForOverlap(M),he=[];ne&&he.push("PROJECTION_GLOBE_VIEW");const ce=b.stencilModeFor3D();for(const Ze of se){const me=Ze.toUnwrapped(),Ne=E.getTile(Ze);if(!Ne.rasterParticleState)continue;const we=Ne.rasterParticleState,ge=100;Ne.registerFadeDuration(ge);const Se=E.findLoadedParent(Ze,0),Pe=xh(Ne,Se,E,b.transform,ge);let Fe,it;b.terrain&&b.terrain.prepareDrawTile(),C.activeTexture.set(J.TEXTURE0),we.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),C.activeTexture.set(J.TEXTURE1),Se&&Se.rasterParticleState?(Se.rasterParticleState.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Fe=Math.pow(2,Se.tileID.overscaledZ-Ne.tileID.overscaledZ),it=[Ne.tileID.canonical.x*Fe%1,Ne.tileID.canonical.y*Fe%1]):we.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const qe=ne?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(me,q),dt=b.transform,Mt=Hi(dt),Xe=n.dF(Ze.canonical),Ie=n.dG(Xe.getCenter().lat);let ct,et,jt,Ct,oa;ne?(ct=Float32Array.from(n.bj(n.dI(Ze.canonical))),et=Float32Array.from(dt.globeMatrix),jt=Float32Array.from(n.dE(dt)),Ct=[n.aF(dt.center.lng),n.aJ(dt.center.lat)],oa=Float32Array.from(n.dH(Ze.canonical,Xe,Ie,dt.worldSize/dt._pixelsPerMercatorPixel))):(ct=new Float32Array(16),et=new Float32Array(9),jt=new Float32Array(16),Ct=[0,0],oa=new Float32Array(9));const Bt=_o(qe,ct,et,jt,oa,it||[0,0],n.aj(b.transform.zoom),Ct,Mt,Fe||1,Pe,H),Ot=b.isTileAffectedByFog(Ze),la=b.getOrCreateProgram("rasterParticle",{defines:he,overrideFog:Ot});if(b.uploadCommonUniforms(C,la,me),ne){const ra=new ca(J.LEQUAL,ca.ReadOnly,b.depthRangeFor3D),Ht=0,ia=b.globeSharedBuffers;if(ia){const[va,ir,Oa]=ia.getGridBuffers(Ie,Ht!==0);la.draw(b,J.TRIANGLES,ra,ce,Ya.alphaBlended,b.renderElevatedRasterBackface?Ba.frontCCW:Ba.backCCW,Bt,A.id,va,ir,Oa)}}else{const ra=b.depthModeForSublayer(0,ca.ReadOnly),Ht=ae[Ze.overscaledZ],{tileBoundsBuffer:ia,tileBoundsIndexBuffer:va,tileBoundsSegments:ir}=b.getTileBoundsBuffers(Ne);la.draw(b,J.TRIANGLES,ra,Ht,Ya.alphaBlended,Ba.disabled,Bt,A.id,ia,va,ir)}}b.resetStencilClippingMasks()}(h,t,i,f),h.style.map.triggerRepaint())},background:function(h,t,i,f){const _=i.paint.get("background-color"),w=i.paint.get("background-color-use-theme").constantOr("default")==="none",b=i.paint.get("background-opacity"),E=i.paint.get("background-emissive-strength"),A=i.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const M=h.context,I=M.gl,C=h.transform,J=C.tileSize,U=i.paint.get("background-pattern");let H;if(U!==void 0&&(U===null||(H=h.imageManager.getPattern(n.I.from(U.toString()),i.scope,h.style.getLut(i.scope)),!H)))return;const q=!U&&_.a===1&&b===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==q)return;const ne=za.disabled,ae=h.depthModeForSublayer(0,q==="opaque"?ca.ReadWrite:ca.ReadOnly),se=h.colorModeForDrapableLayerRenderPass(E),he=U?"backgroundPattern":"background";let ce,Ze=f;if(Ze||(ce=h.getBackgroundTiles(),Ze=Object.values(ce).map(me=>me.tileID)),U&&(M.activeTexture.set(I.TEXTURE0),h.imageManager.bind(h.context,i.scope)),A){const me=h.getOrCreateProgram(he,{overrideFog:!1,overrideRtt:!0}),Ne=new Float32Array(n.bz([])),we=new n.aP(0,0,0,0,0),ge=U?Nh(Ne,E,b,h,0,i.scope,H,A,{tileID:we,tileSize:J}):Zh(Ne,E,b,_.toPremultipliedRenderColor(w?null:i.lut));me.draw(h,I.TRIANGLES,ae,ne,se,Ba.disabled,ge,i.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const me of Ze){const Ne=h.isTileAffectedByFog(me),we=h.getOrCreateProgram(he,{overrideFog:Ne}),ge=me.toUnwrapped(),Se=f?me.projMatrix:h.transform.calculateProjMatrix(ge);h.prepareDrawTile();const Pe=t?t.getTile(me):ce?ce[me.key]:new ps(me,J,C.zoom,h),Fe=U?Nh(Se,E,b,h,0,i.scope,H,A,{tileID:me,tileSize:J}):Zh(Se,E,b,_.toPremultipliedRenderColor(w?null:i.lut));h.uploadCommonUniforms(M,we,ge);const{tileBoundsBuffer:it,tileBoundsIndexBuffer:qe,tileBoundsSegments:dt}=h.getTileBoundsBuffers(Pe);we.draw(h,I.TRIANGLES,ae,ne,se,Ba.disabled,Fe,i.id,it,qe,dt)}},sky:function(h,t,i){const f=h._atmosphere?n.aj(h.transform.zoom):1,_=i.paint.get("sky-opacity")*f;if(_===0)return;const w=h.context,b=i.paint.get("sky-type"),E=new ca(w.gl.LEQUAL,ca.ReadOnly,[0,1]),A=h.frameCounter/1e3%1;b==="atmosphere"?h.renderPass==="offscreen"?i.needsSkyboxCapture(h)&&(function(M,I,C,J){const U=M.context,H=U.gl;let q=I.skyboxFbo;if(!q){q=I.skyboxFbo=U.createFramebuffer(32,32,!0,null),I.skyboxGeometry=new Do(U),I.skyboxTexture=U.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,I.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let he=0;he<6;++he)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(q.framebuffer),U.viewport.set([0,0,32,32]);const ne=I.getCenter(M,!0),ae=M.getOrCreateProgram("skyboxCapture"),se=new Float64Array(16);n.bz(se),n.em(se,se,.5*-Math.PI),wi(M,I,ae,se,ne,0),n.bz(se),n.em(se,se,.5*Math.PI),wi(M,I,ae,se,ne,1),n.bz(se),n.cT(se,se,.5*-Math.PI),wi(M,I,ae,se,ne,2),n.bz(se),n.cT(se,se,.5*Math.PI),wi(M,I,ae,se,ne,3),n.bz(se),wi(M,I,ae,se,ne,4),n.bz(se),n.em(se,se,Math.PI),wi(M,I,ae,se,ne,5),U.viewport.set([0,0,M.width,M.height])}(h,i),i.markSkyboxValid(h)):h.renderPass==="sky"&&function(M,I,C,J,U){const H=M.context,q=H.gl,ne=M.transform,ae=M.getOrCreateProgram("skybox");H.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,I.skyboxTexture);const se=((he,ce,Ze,me,Ne)=>({u_matrix:he,u_sun_direction:ce,u_cubemap:0,u_opacity:me,u_temporal_offset:Ne}))(ne.skyboxMatrix,I.getCenter(M,!1),0,J,U);M.uploadCommonUniforms(H,ae),ae.draw(M,q.TRIANGLES,C,za.disabled,M.colorModeForRenderPass(),Ba.backCW,se,"skybox",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(h,i,E,_,A):b==="gradient"&&h.renderPass==="sky"&&function(M,I,C,J,U){const H=M.context,q=H.gl,ne=M.transform,ae=M.getOrCreateProgram("skyboxGradient");I.skyboxGeometry||(I.skyboxGeometry=new Do(H)),H.activeTexture.set(q.TEXTURE0);let se=I.colorRampTexture;se||(se=I.colorRampTexture=new n.T(H,I.colorRamp,q.RGBA8)),se.bind(q.LINEAR,q.CLAMP_TO_EDGE);const he=((ce,Ze,me,Ne,we)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:Ze,u_radius:n.an(me),u_opacity:Ne,u_temporal_offset:we}))(ne.skyboxMatrix,I.getCenter(M,!1),I.paint.get("sky-gradient-radius"),J,U);M.uploadCommonUniforms(H,ae),ae.draw(M,q.TRIANGLES,C,za.disabled,M.colorModeForRenderPass(),Ba.backCW,he,"skyboxGradient",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(h,i,E,_,A)},custom:function(h,t,i,f){const _=h.context,w=i.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&i.isDraped(t)){if(h.renderPass==="offscreen"){const b=w.prerender;if(b){if(h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const E=h.transform.pointMerc;b.call(w,_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.aj(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else b.call(w,_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const E=w.renderToTile;if(E){const A=f[0].canonical,M={x:A.x+f[0].wrap*(w.wrapTileId?0:1<<A.z),y:A.y,z:A.z};_.setDepthMode(ca.disabled),_.setStencilMode(za.disabled),_.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),E.call(w,_.gl,M),_.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),_.setStencilMode(za.disabled);const b=w.renderingMode==="3d"?new ca(h.context.gl.LEQUAL,ca.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ca.ReadOnly);if(_.setDepthMode(b),h.transform.projection.name==="globe"){const E=h.transform.pointMerc;w.render(_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.aj(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else w.render(_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState(),_.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,i,f){if(h.renderPass==="opaque")return;const _=i.paint.get("model-opacity").constantOr(1),w=i.paint.get("model-elevation-reference"),b=w==="ground",E=w==="ground";if(_===0)return;const A=i.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!A||h.terrain&&_<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof n.ad))return;const M=h.shadowRenderer,I=i.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,I||(M.enabled=!1));const C=()=>{M&&(M.useNormalOffset=!0,I||(M.enabled=!0))},J=t.getSource();if(h.renderPass==="light-beam"&&J.type!=="batched-model")return;if(J.type==="vector"||J.type==="geojson")return function(ce,Ze,me,Ne,we){const ge=ce.transform,Se=ge.projection.name==="globe",Pe=ge.getFreeCameraOptions().position;if(!ce.modelManager)return;const Fe=ce.modelManager;me.modelManager=Fe;const it=ce.shadowRenderer;if(!me._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const qe=me._unevaluatedLayout._values["model-id"],dt=Object.assign({},me.layout.get("model-id").parameters),Mt=ce.style.order.indexOf(me.fqid);for(const Xe of Ne){const Ie=Ze.getTile(Xe).getBucket(me);if(!Ie||Ie.projection.name!==ge.projection.name)continue;const ct=Ie.getModelUris();if(ct&&!Ie.modelsRequested&&(Fe.addModelsFromBucket(ct,we),Ie.modelsRequested=!0),Se)dt.zoom=Xe.overscaledZ;else{const ra=jf(Xe,ge);dt.zoom=ra}const et=qe.possiblyEvaluate(dt);if(dp(ce,Ie,Xe),Os.shadowUniformsInitialized=!1,Os.useSingleShadowCascade=!!it&&it.getMaxCascadeForTile(Xe.toUnwrapped())===0,ce.renderPass==="shadow"&&it){if(ce.currentShadowCascade===1&&Ie.isInsideFirstShadowMapFrustum)continue;const ra=ge.calculatePosMatrix(Xe.toUnwrapped(),ge.worldSize);if(Os.tileMatrix.set(ra),Os.shadowTileMatrix=Float32Array.from(it.calculateShadowPassMatrixFromMatrix(ra)),Os.aabb.min=[0,0,0],Os.aabb.max[0]=Os.aabb.max[1]=n.al,Os.aabb.max[2]=0,Bh(Ie,Os,ce,me.scope))continue}const jt=1<<Xe.canonical.z,Ct=[((Pe.x-Xe.wrap)*jt-Xe.canonical.x)*n.al,(Pe.y*jt-Xe.canonical.y)*n.al,Pe.z*jt*n.al];ce.conflationActive&&Object.keys(Ie.instancesPerModel).length>0&&ce.style.isLayerClipped(me,Ze.getSource())&&Ie.updateReplacement(Xe,ce.replacementSource,Mt,we)&&(Ie.uploaded=!1,Ie.upload(ce.context));let oa=0;const Bt=new Array,Ot=new Array,la=new Array;for(let ra in Ie.instancesPerModel){const Ht=Ie.instancesPerModel[ra];Ht.features.length>0&&!Se&&(ra=et.evaluate(Ht.features[0].feature,{}));const ia=Fe.getModel(ra,we);if(ia||Fe.hasURLBeenRequested(ra)||Ie.modelUris.includes(ra)||(Ie.modelUris.push(ra),Ie.modelsRequested=!1),ia&&ia.uploaded)if(Se){const va=n.c4([],[Pe.x,Pe.y,Pe.z],ce.transform.worldSize);n.ev(va,va);for(let ir=0;ir<Ht.instancedDataArray.length;++ir){const Oa=[0,0,0],Qr=[1,1,1],Ta=n.ew(),pr=Ht.tileCoordinatesForInstance(ir),Ua=Ht.transformForInstance(ir);n.ex(Qr,Ua),n.ey(Ta,Ua),n.ez(Oa,Ta);const Cr=Ht.translationForInstance(ir),mr=new n.aS(0,0);n.eA(Ie.canonical,mr,pr.x,pr.y);const Kr=n.bB();n.eB(Kr,ia,ce.transform,mr,Oa,Qr,Cr,!0,!1,!1);const sr=Ht.colorForInstance(ir),Ga=n.bz([]),Rr=n.ee(mr.lat,ce.transform.zoom),Ca=n.bp([],[1,1,1/Rr]);n.bq(Ga,Ga,va),la.push({zScaleMatrix:Ca,negCameraPosMatrix:Ga});for(const en of ia.nodes)Vh(ce,en,Kr,ce.transform.expandedFarZProjMatrix,oa,Bt,Ot,ia.materialOverrides,sr);++oa}}else for(const va of ia.nodes)Zf(ce,me,va,Ht,Ct,Xe,Os)}if(Se)if(ce.renderPass==="shadow"){for(const ra of Ot)Il(ra.mesh,ra.nodeModelMatrix,ce,me);for(const ra of Bt)Il(ra.mesh,ra.nodeModelMatrix,ce,me)}else Mh(ce,me,1,Bt,Ot,la)}}(h,t,i,f,Th(J,i,h.style._importedAsBasemap)),void C();if(!J.loaded())return;if(J.type==="batched-model")return function(ce,Ze,me,Ne){me.resetLayerRenderingStats(ce);const we=ce.context,ge=ce.transform,Se=ce.style.fog,Pe=ce.shadowRenderer;if(ge.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const Fe=ce.transform.getFreeCameraOptions().position,it=n.c4([],[Fe.x,Fe.y,Fe.z],ce.transform.worldSize),qe=n.ev([],it),dt=n.bz([]),Mt=n.ee(ge.center.lat,ge.zoom),Xe=n.bp([],[1,1,1/Mt]);n.bq(dt,dt,qe);const Ie=me.paint.get("model-opacity").constantOr(1),ct=new ca(we.gl.LEQUAL,ca.ReadWrite,ce.depthRangeFor3D),et=new ca(we.gl.LEQUAL,ca.ReadOnly,ce.depthRangeFor3D),jt=new n.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ct=ce.renderPass==="shadow",oa=Ct&&Pe?Pe.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),Bt=me.paint.get("model-front-cutoff"),Ot=Bt[2]<1,la=nl(ce,me.paint.get("model-cutoff-fade-range")),ra=me.getLayerRenderingStats();(function(Ht,ia,va,ir){const Oa=Ht.terrain?Ht.terrain.exaggeration():0,Qr=Ht.transform.zoom;for(const Ta of ir){const pr=ia.getTile(Ta).getBucket(va);pr&&(pr.setFilter(va.filter),Ht.conflationActive&&pr.updateReplacement(Ta,Ht.replacementSource),pr.evaluateTransform(Ht,va),Ht.terrain&&Oa>0&&pr.elevationUpdate(Ht.terrain,Oa,Ta,va.source),pr.needsReEvaluation(Ht,Qr,va)&&pr.evaluate(va))}})(ce,Ze,me,Ne),function(){let Ht,ia,va;Ot?(Ht=Ne.length-1,ia=-1,va=-1):(Ht=0,ia=Ne.length,va=1);const ir=new Float64Array(16),Oa=n.cz(),Qr=new n.P(0,0);for(let Ta=Ht;Ta!==ia;Ta+=va){const pr=Ne[Ta],Ua=Ze.getTile(pr).getBucket(me);if(!Ua||!Ua.uploaded)continue;let Cr=!1;Pe&&(Cr=Pe.getMaxCascadeForTile(pr.toUnwrapped())===0);const mr=ge.calculatePosMatrix(pr.toUnwrapped(),ge.worldSize),Kr=Ua.modelTraits;!Ct&&Ot&&(n.bk(ir,mr),n.af(Oa,it,ir),Qr.x=Oa[0],Qr.y=Oa[1]);const sr=[];Ua.setFilter(me.filter);for(const Ga of Ua.getNodesInfo()){if(Ga.hiddenByReplacement||!Ga.node.meshes)continue;const Rr=Ga.node;let Ca=0;ce.terrain&&Rr.elevation&&(Ca=Rr.elevation*ce.terrain.exaggeration());const en=(()=>{const Fi=Ga.aabb;return jt.min=[...Fi.min],jt.max=[...Fi.max],jt.min[2]+=Ca,jt.max[2]+=Ca,n.af(jt.min,jt.min,mr),n.af(jt.max,jt.max,mr),jt})(),_r=Ga.evaluatedScale;if(_r[0]<=1&&_r[1]<=1&&_r[2]<=1&&en.intersects(oa)===0)continue;if(!Ct&&Ot){const Fi=.16666666666666666;Ga.cameraCollisionOpacity=it[0]>en.min[0]&&it[0]<en.max[0]&&it[1]>en.min[1]&&it[1]<en.max[1]&&it[2]*Mt<en.max[2]&&Rr.footprint&&n.b$(Qr,Rr.footprint)?Math.max(Ga.cameraCollisionOpacity-Fi,0):Math.min(1,Ga.cameraCollisionOpacity+Fi)}const Va=[...mr],yr=1/n.d6(pr.canonical),_n=Rr.anchor?Rr.anchor[0]:0,Hn=Rr.anchor?Rr.anchor[1]:0;n.bq(Va,Va,[_n*(_r[0]-1)+Ga.evaluatedTranslation[0]*yr,Hn*(_r[1]-1)+Ga.evaluatedTranslation[1]*yr,Ca+Ga.evaluatedTranslation[2]]),n.cp(_r,n.eD)||n.cR(Va,Va,_r);const wn=n.aB([],Va,Rr.globalMatrix),Dn=n.aB([],ge.expandedFarZProjMatrix,wn),Ss=n.aB([],ge.expandedFarZProjMatrix,Va),xs=n.aC([],[_n,Hn,Ca,1],Dn)[2];Rr.hidden=!1;let Si=Ie;Ct||(Ot&&(Si*=Ga.cameraCollisionOpacity,Si*=Xc(Va,ge,Ga.aabb,Bt)),Si*=Tu(la,xs)),Si!==0?sr.push({nodeInfo:Ga,depth:xs,opacity:Si,wvpForNode:Dn,wvpForTile:Ss,nodeModelMatrix:wn,tileModelMatrix:Va}):Rr.hidden=!0}Ct||sr.sort((Ga,Rr)=>!Ot||Ga.opacity===1&&Rr.opacity===1?Ga.depth<Rr.depth?-1:1:Ga.opacity===1?-1:Rr.opacity===1?1:Ga.depth>Rr.depth?-1:1);for(const Ga of sr){const Rr=Ga.nodeInfo,Ca=Rr.node;let en=n.aB([],Xe,Ga.tileModelMatrix);n.aB(en,dt,en);const _r=n.bk([],en);n.ef(_r,_r),n.cR(_r,_r,hp),en=n.aB(en,en,Ca.globalMatrix);const Va=ce.renderPass==="light-beam",yr=me.paint.get("model-color-use-theme").constantOr("default")==="none",_n=Kr&n.eH.HasMapboxMeshFeatures,Hn=_n?0:Rr.evaluatedRMEA[0][2];for(let wn=0;wn<Ca.meshes.length;++wn){const Dn=Ca.meshes[wn],Ss=wn===Ca.lightMeshIndex;let xs=Ga.wvpForNode;if(Ss){if(!Va&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}xs=Ga.wvpForTile}else if(Va)continue;const Si={defines:[]},Fi=[];if(!Ct&&Pe&&(Pe.useNormalOffset=!!Dn.normalBuffer),zu(Si.defines,Fi,Dn,ce,yr?null:me.lut),_n||Si.defines.push("DIFFUSE_SHADED"),Cr&&Si.defines.push("SHADOWS_SINGLE_CASCADE"),ra&&(Ct?ra.numRenderedVerticesInShadowPass+=Dn.vertexArray.length:ra.numRenderedVerticesInTransparentPass+=Dn.vertexArray.length),Ct){Il(Dn,Ga.nodeModelMatrix,ce,me);continue}let so=null;if(Se){const Cn=bf(Ga.nodeModelMatrix,ce.transform);if(so=new Float32Array(Cn),ge.projection.name!=="globe"){const Gr=Dn.aabb.min,Yn=Dn.aabb.max,[Di,bn]=Se.getOpacityForBounds(Cn,Gr[0],Gr[1],Yn[0],Yn[1]);Si.overrideFog=Di>=tt||bn>=tt}}const Oi=Dn.material;let Zo;Oi.occlusionTexture&&Oi.occlusionTexture.offsetScale&&(Zo=Oi.occlusionTexture.offsetScale,Si.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const No=ce.getOrCreateProgram("model",Si);!Ct&&Pe&&Pe.setupShadowsFromMatrix(Ga.tileModelMatrix,No,Pe.useNormalOffset),ce.uploadCommonUniforms(we,No,null,so);const vi=Oi.pbrMetallicRoughness;vi.metallicFactor=.9,vi.roughnessFactor=.5;const vn=Eh(new Float32Array(xs),new Float32Array(en),new Float32Array(_r),new Float32Array(Ca.globalMatrix),ce,Ga.opacity,vi.baseColorFactor,Oi.emissiveFactor,vi.metallicFactor,vi.roughnessFactor,Oi,Hn,me,[0,0,0],Zo);!Ss&&(Rr.hasTranslucentParts||Ga.opacity<1)&&No.draw(ce,we.gl.TRIANGLES,ct,za.disabled,Ya.disabled,Ba.backCCW,vn,me.id,Dn.vertexBuffer,Dn.indexBuffer,Dn.segments,me.paint,ce.transform.zoom,void 0,Fi),No.draw(ce,we.gl.TRIANGLES,Ss?et:ct,za.disabled,Ss||Ga.opacity<1||Rr.hasTranslucentParts?Ya.alphaBlended:Ya.unblended,Ba.backCCW,vn,me.id,Dn.vertexBuffer,Dn.indexBuffer,Dn.segments,me.paint,ce.transform.zoom,void 0,Fi)}}}}()}(h,t,i,f),void C();if(J.type!=="model")return;const U=J.getModels(),H=[],q=h.transform.getFreeCameraOptions().position,ne=n.c4([],[q.x,q.y,q.z],h.transform.worldSize);n.ev(ne,ne);const ae=[],se=[];let he=0;for(const ce of U){const Ze=t.getFeatureState("",ce.id),me={type:"Unknown",id:ce.id,properties:ce.featureProperties},Ne=i.paint.get("model-rotation").evaluate(me,Ze),we=i.paint.get("model-scale").evaluate(me,Ze),ge=i.paint.get("model-translation").evaluate(me,Ze);Ru(i,ce.id,Ze,ce.featureProperties,ce.nodeOverrideNames,ce.nodeOverrides),Lf(i,ce.id,Ze,ce.featureProperties,ce.materialOverrideNames,ce.materialOverrides),ce.nodeOverrides.size>0&&ce.computeBoundsAndApplyParent(),ce.computeModelMatrix(h,Ne,we,ge,E,b,!1);const Se=n.bz([]),Pe=n.ee(ce.position.lat,h.transform.zoom),Fe=n.bp([],[1,1,1/Pe]);n.bq(Se,Se,ne),H.push({zScaleMatrix:Fe,negCameraPosMatrix:Se});for(const it of ce.nodes)Vh(h,it,ce.matrix,h.transform.expandedFarZProjMatrix,he,ae,se,ce.materialOverrides);he++}if(ae.sort((ce,Ze)=>Ze.depth-ce.depth),h.renderPass!=="shadow")Mh(h,i,_,ae,se,H),C();else{for(const ce of se)Il(ce.mesh,ce.nodeModelMatrix,h,i);for(const ce of ae)Il(ce.mesh,ce.nodeModelMatrix,h,i);C()}}},Ih={line:function(h,t,i){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const f=t.getVisibleCoordinates();for(const _ of f){const w=t.getTile(_).getBucket(h);if(w&&(w.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,i){const f=t.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson"){const w=Th(f,h,i.style._importedAsBasemap);return void(i.modelManager&&i.modelManager.upload(i,w))}if(f.type==="batched-model"||f.type!=="model")return;const _=f.getModels();for(const w of _)w.upload(i.context)},raster:function(h,t,i){const f=t.getSource();if(!(f instanceof Ni&&f.loaded()))return;const _=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const w=h.paint.get("raster-array-band")||f.getInitialBand(_);if(w==null)return;const b=t.getIds().map(E=>t.getTileByID(E));for(const E of b)E.updateNeeded(h.id,w)&&f.prepareTile(E,_,h.id,w)},"raster-particle":function(h,t,i){const f=t.getSource();if(!(f instanceof Ni&&f.loaded()))return;const _=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const w=h.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(w==null)return;const b=t.getIds().map(E=>t.getTileByID(E));for(const E of b)E.updateNeeded(h.id,w)&&f.prepareTile(E,_,h.id,w)}},kh={fill:Fs},Cs={fill:function(h,t,i,f){if(!i.layout||i.layout.get("fill-elevation-reference")==="none"||i.paint.get("fill-opacity").constantOr(1)===0)return;const _=h.context.gl,w=new ca(_.LEQUAL,ca.ReadOnly,h.depthRangeFor3D),b=new za({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),E=h.transform.getFreeCameraOptions().position,A=h.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const M of f){const I=t.getTile(M),C=I.getBucket(i);if(!C)continue;const J=C.elevatedStructures;if(!J||J.depthSegments.segments[0].primitiveLength===0)continue;const U=up(M.toUnwrapped(),E),H=h.translatePosMatrix(M.projMatrix,I,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),q=_d(H,U,0,1,0);A.draw(h,_.TRIANGLES,w,b,Ya.disabled,Ba.disabled,q,i.id,J.vertexBuffer,J.indexBuffer,J.depthSegments,i.paint,h.transform.zoom)}}};class vo{constructor(t,i,f,_,w,b){this.context=new Ld(t,i),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=n.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of E)this._debugParams.enabledLayers[M]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of E)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new fy(w),this.setup(),this.numSublayers=To.maxUnderzooming+To.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new lh(this),this._wireframeDebugCache=new pp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new n.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,A,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=b}updateTerrain(t,i){const f=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new mo(this,t));const _=this._terrain;this.transform.elevation=f?_:null,_.update(t,this.transform,i),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(t){const i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=i.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const w=f+.78*(_-f);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new mo(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*n.o.devicePixelRatio,this.height=i*n.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const t=this.context,i=new n.bc;i.emplaceBack(0,0),i.emplaceBack(n.al,0),i.emplaceBack(0,n.al),i.emplaceBack(n.al,n.al),this.tileExtentBuffer=t.createVertexBuffer(i,n.be.members),this.tileExtentSegments=n.bf.simpleSegment(0,0,4,2);const f=new n.bc;f.emplaceBack(0,0),f.emplaceBack(n.al,0),f.emplaceBack(0,n.al),f.emplaceBack(n.al,n.al),this.debugBuffer=t.createVertexBuffer(f,n.be.members),this.debugSegments=n.bf.simpleSegment(0,0,4,5);const _=new n.bc;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,n.be.members),this.viewportSegments=n.bf.simpleSegment(0,0,4,2);const w=new n.a$;w.emplaceBack(0,0,0,0),w.emplaceBack(n.al,0,n.al,0),w.emplaceBack(0,n.al,0,n.al),w.emplaceBack(n.al,n.al,n.al,n.al),this.mercatorBoundsBuffer=t.createVertexBuffer(w,n.bh.members),this.mercatorBoundsSegments=n.bf.simpleSegment(0,0,4,2);const b=new n.b0;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const E=new n.bd;for(const M of[0,1,3,2,0])E.emplaceBack(M);this.debugIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new n.T(t,new n.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.bB();const A=this.context.gl;this.stencilClearMode=new za({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ca.disabled,this.stencilClearMode,Ya.disabled,Ba.disabled,Tl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,f){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const A of f)if(this._tileClippingMaskIDs[A.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=i.id;const _=this.context,w=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(Ya.disabled),_.setDepthMode(ca.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of f){const A=i.getTile(E),M=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:C,tileBoundsSegments:J}=this.getTileBoundsBuffers(A);b.draw(this,w.TRIANGLES,ca.disabled,new za({func:w.ALWAYS,mask:0},M,255,w.KEEP,w.KEEP,w.REPLACE),Ya.disabled,Ba.disabled,Tl(E.projMatrix),"$clipping",I,C,J)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new za({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new za({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,f=t.sort((b,E)=>E.overscaledZ-b.overscaledZ),_=f[f.length-1].overscaledZ,w=f[0].overscaledZ-_+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const b={};for(let E=0;E<w;E++)b[E+_]=new za({func:i.GEQUAL,mask:255},E+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=w,[b,f]}return[{[_]:za.disabled},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ya([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ya.unblended:Ya.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ya([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new n.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,f,_=!1){if(this.depthOcclusion)return new ca(this.context.gl.GREATER,ca.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return ca.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ca(f||this.context.gl.LEQUAL,i,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,i=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),w=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),i!==0&&f!==0&&(this.depthFBO=new bd(this.context,i,f,!1,"texture"),this.depthTexture=new n.T(this.context,{width:i,height:f,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),t.bindTexture(t.TEXTURE_2D,w),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,i,f,0,0,i,f,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,i)=>t+i/this._fpsHistory.length,0))}render(t,i){const f=n.o.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;const _=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(w).filter(Xe=>{const Ie=_[Xe];return!(Ie.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ie.type]});let E=b(),A=!1,M=!1,I=null;for(const Xe of E){const Ie=_[Xe];Ie.type==="circle"?A=!0:Ie.type==="building"?I=Ie:Ie.type==="symbol"&&(Ie.hasOcclusionOpacityProperties?M=!0:A=!0)}let C=E.map(Xe=>_[Xe]);const J=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.o.now()),this.imageManager.beginFrame();let U=0,H=!1;for(const Xe in J){const Ie=J[Xe];Ie.used&&(Ie.prepare(this.context),Ie.getSource().usedInConflation&&++U)}let q=!1;for(const Xe of C)Xe.isHidden(this.transform.zoom)||(Xe.type==="clip"&&(q=!0),this.prepareLayer(Xe));const ne={},ae={},se={},he={},ce={};for(const Xe in J){const Ie=J[Xe];ne[Xe]=Ie.getVisibleCoordinates(),ae[Xe]=ne[Xe].slice().reverse(),se[Xe]=Ie.getVisibleCoordinates(!0).reverse(),he[Xe]=Ie.getShadowCasterCoordinates(),ce[Xe]=Ie.sortCoordinatesByDistance(ne[Xe])}const Ze=Xe=>{const Ie=this.style.getLayerSourceCache(Xe);return Ie&&Ie.used?Ie.getSource():null};if(U||q||this._clippingActiveLastFrame){const Xe=[],Ie=[];let ct=0;for(const et of C)this.isSourceForClippingOrConflation(et,Ze(et))&&(Xe.push(et),Ie.push(ct)),ct++;if(Xe&&(q||Xe.length>1)||this._clippingActiveLastFrame){q=!1;const et=[];for(let jt=0;jt<Xe.length;jt++){const Ct=Xe[jt],oa=Ie[jt],Bt=this.style.getLayerSourceCache(Ct);if(!Bt||!Bt.used||!Bt.getSource().usedInConflation&&Ct.type!=="clip"&&Ct.type!=="building")continue;let Ot=n.eP,la=n.bZ.None;const ra=[];let Ht=!0;if(Ct.type==="building")Ot=n.eR;else if(Ct.type==="clip"){Ot=oa;for(const ia of Ct.layout.get("clip-layer-types"))la|=ia==="model"?n.bZ.Model:ia==="symbol"?n.bZ.Symbol:n.bZ.FillExtrusion;for(const ia of Ct.layout.get("clip-layer-scope"))ra.push(ia);Ct.isHidden(this.transform.zoom)?Ht=!1:q=!0}Ht&&et.push({layer:Ct.fqid,cache:Bt,order:Ot,clipMask:la,clipScope:ra})}this.replacementSource.setSources(et),H=!0}}this._clippingActiveLastFrame=q,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Xe=0;Xe<C.length;Xe++){const Ie=C[Xe],ct=Ie.cutoffRange();if(this.longestCutoffRange=Math.max(ct,this.longestCutoffRange),ct>0){const et=Ze(Ie);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),Ie.minzoom&&(this.minCutoffZoom=Math.max(Ie.minzoom,this.minCutoffZoom))}Ie.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Xe),this._lastOcclusionLayer=Xe)}const me=this.style&&this.style.fog;me?(this._fogVisible=me.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=me.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0,E=b(),C=E.map(Xe=>_[Xe]));const Ne=this._shadowRenderer;if(Ne){Ne.updateShadowParameters(this.transform,this.style.directionalLight);for(const Xe in J)for(const Ie of ne[Xe]){let ct={min:0,max:0};this.terrain&&(ct=this.terrain.getMinMaxForTile(Ie)||ct),Ne.addShadowReceiver(Ie.toUnwrapped(),ct.min,ct.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Mn(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(we&&!this._snow&&(this._snow=new zd(this)),!we&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new Es(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),I){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ue);const Xe=this.style.getLayerSourceCache(I);this.buildingTileBorderManager.updateBorders(Xe,I)}if(!ln.has(this.context.gl))return;this.renderPass="offscreen";for(const Xe of C){const Ie=t.getLayerSourceCache(Xe);if(!Xe.hasOffscreenPass()||Xe.isHidden(this.transform.zoom))continue;const ct=Ie?ae[Ie.id]:void 0;(Xe.type==="custom"||Xe.type==="raster"||Xe.type==="raster-particle"||Xe.isSky()||ct&&ct.length)&&this.renderLayer(this,Ie,Xe,ct)}this.depthRangeFor3D=[0,1-(C.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,he)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Pe=(()=>{if(i.showOverdrawInspector)return n.ao.black;const Xe=this.style.fog;if(Xe&&this.transform.projection.supportsFog){const Ie=this.style.getLut(Xe.scope);if(!Se){const ct=Xe.properties.get("color-use-theme")==="none",et=Xe.properties.get("color").toNonPremultipliedRenderColor(ct?null:Ie).toArray01();return new n.ao(...et)}if(Se){const ct=Xe.properties.get("space-color-use-theme")==="none",et=Xe.properties.get("space-color").toNonPremultipliedRenderColor(ct?null:Ie).toArray01();return new n.ao(...et)}}return n.ao.transparent})();if(this.context.clear({color:Pe,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const Xe=C[this.currentLayer],Ie=t.getLayerSourceCache(Xe);if(Xe.isSky())continue;const ct=Ie?(Xe.is3D(w)?ce:ae)[Ie.id]:void 0;this._renderTileClippingMasks(Xe,Ie,ct),this.renderLayer(this,Ie,Xe,ct)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const Xe=C[this.currentLayer],Ie=t.getLayerSourceCache(Xe);Xe.isSky()&&this.renderLayer(this,Ie,Xe,Ie?ae[Ie.id]:void 0)}function Fe(Xe,Ie){let ct;return Ie&&(ct=(Xe.type==="symbol"?se:Xe.is3D(w)?ce:ae)[Ie.id]),ct}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const Xe=C[this.currentLayer];if(Xe.type==="raster"||Xe.type==="raster-particle"){const Ie=t.getLayerSourceCache(Xe);this.renderLayer(this,Ie,Xe,Fe(Xe,Ie))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let it=0;Ne&&(it=Ne.getShadowCastingLayerCount());let qe=!1,dt=-1;for(let Xe=0;Xe<E.length;++Xe){const Ie=C[Xe];Ie.isHidden(this.transform.zoom)||Ie.is3D(w)&&(dt=Xe)}M&&dt===-1&&(A=!0);let Mt=!1;for(;this.currentLayer<E.length;){const Xe=C[this.currentLayer],Ie=t.getLayerSourceCache(Xe);if(Xe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Xe)){if(Xe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Mt&&Xe.is3D(w)&&!w){const ct=this.currentLayer,et=jt=>{for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Ct=C[this.currentLayer];if(kh[Ct.type]){const oa=this.style.getLayerSourceCache(Ct);kh[Ct.type](this,oa,Ct,Fe(Ct,oa),jt)}}};et("initialize"),et("reset"),this.currentLayer=ct,Mt=!0}if(A&&!qe&&this.terrain&&!this.transform.isOrthographic&&(qe=!0,this.blitDepth()),M&&dt!==-1&&this.currentLayer===dt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Xe,Ie,Ie?ne[Ie.id]:void 0),this.renderLayer(this,Ie,Xe,Fe(Xe,Ie)),!this.terrain&&Ne&&it>0&&Xe.hasShadowPass()&&--it==0){{this.clearStencil(),this.resetStencilClippingMasks();const ct=this.currentLayer;for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const et=C[this.currentLayer];if(Cs[et.type]){const jt=this.style.getLayerSourceCache(et);Cs[et.type](this,jt,et,Fe(et,jt))}}this.currentLayer=ct}if(Ne.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ct=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ct;this.currentLayer++){const et=C[this.currentLayer];if(!et.hasLightBeamPass())continue;const jt=t.getLayerSourceCache(et);this.renderLayer(this,jt,et,jt?ae[jt.id]:void 0)}this.currentLayer=ct,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ct=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const jt=C[this.currentLayer],Ct=t.getLayerSourceCache(jt),oa=Ct?ae[Ct.id]:void 0;this.terrain||this._renderTileClippingMasks(jt,Ct,Ct?ne[Ct.id]:void 0),this.renderLayer(this,Ct,jt,oa)}this.depthOcclusion=!1,this.currentLayer=ct,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Xe=null;C.forEach(Ie=>{const ct=t.getLayerSourceCache(Ie);ct&&!Ie.isHidden(this.transform.zoom)&&ct.getVisibleCoordinates().length&&(!Xe||Xe.getSource().maxzoom<ct.getSource().maxzoom)&&(Xe=ct)}),Xe&&this.options.showTileBoundaries&&Ed(this,Xe,Xe.getVisibleCoordinates(),n.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ed(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Xe){const Ie=Xe.transform.padding;$r(Xe,Xe.transform.height-(Ie.top||0),3,Bl),$r(Xe,Ie.bottom||0,3,Wc),Rh(Xe,Ie.left||0,3,fi),Rh(Xe,Xe.transform.width-(Ie.right||0),3,ki);const ct=Xe.transform.centerPoint;(function(et,jt,Ct,oa){Ji(et,jt-1,Ct-10,2,20,oa),Ji(et,jt-10,Ct-1,20,2,oa)})(Xe,ct.x,Xe.transform.height-ct.y,Ui)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:i}=this.transform.projection,f=!i||!i.includes(t.type);if(Ih[t.type]&&(f||this.terrain&&t.type==="custom")){const _=this.style.getLayerSourceCache(t);Ih[t.type](t,_,this)}this.gpuTimingEnd()}renderLayer(t,i,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(f.type)&&(!t.terrain||f.type!=="custom")||f.type==="clip"||Nf[f.type](t,i,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[t.id];_||(_=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(i.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,i=this.context.gl,f=i.createQuery();this.deferredRenderGpuTimeQueries.push(f),i.beginQuery(t.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const i={};for(const f in t){const _=t[f],w=this.context.extTimerQuery,b=w.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(_.query),i[f]=b}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const i=this.context.gl;let f=0;for(const _ of t)f+=i.getQueryParameter(_,i.QUERY_RESULT)/1e6,i.deleteQuery(_);return f}translatePosMatrix(t,i,f,_,w){if(!f[0]&&!f[1])return t;const b=w?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){const M=Math.sin(b),I=Math.cos(b);f=[f[0]*I-f[1]*M,f[0]*M+f[1]*I]}const E=[w?f[0]:n.ay(i,f[0],this.transform.zoom),w?f[1]:n.ay(i,f[1],this.transform.zoom),0],A=new Float32Array(16);return n.bq(A,t,E),A}saveTileTexture(t){if(t.context!==this.context)return;const i=t.size[0],f=this._tileTextures[i];f?f.push(t):this._tileTextures[i]=[t]}getTileTexture(t){const i=this._tileTextures[t];return i&&i.length>0?i.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,w=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||_||i!==void 0&&!i||w.push("FOG","FOG_DITHERING"),_&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(t,i){this.cache=this.cache||{};const f=i&&i.defines||[],_=i&&i.config,w=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(f),b=vh.cacheKey(Jc[t],t,w,_);return this.cache[b]||(this.cache[b]=new vh(this.context,t,Jc[t],_,pf[t],w)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const w=((b,E,A)=>{const M=b.properties.get("direction"),I=b.properties.get("color-use-theme")==="none",C=b.properties.get("color").toNonPremultipliedRenderColor(I?null:A.getLut(b.scope)).toArray01(),J=b.properties.get("intensity"),U=E.properties.get("color-use-theme")==="none",H=E.properties.get("color").toNonPremultipliedRenderColor(U?null:A.getLut(E.scope)).toArray01(),q=E.properties.get("intensity"),ne=[M.x,M.y,M.z],ae=n.dM(H,q),se=n.dM(C,J);return{u_lighting_ambient_color:ae,u_lighting_directional_dir:ne,u_lighting_directional_color:se,u_ground_radiance:gd(ne,se,ae)}})(f,_,this.style);i.setLightsUniformValues(t,w)}}}uploadCommonUniforms(t,i,f,_,w){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),A=((M,I,C,J,U,H,q,ne,ae,se,he,ce)=>{const Ze=M.transform,me=I.properties.get("color-use-theme")==="none",Ne=I.properties.get("color").toNonPremultipliedRenderColor(me?null:M.style.getLut(I.scope)).toArray01();Ne[3]=J;const we=M.frameCounter/1e3%1,[ge,Se]=I.properties.get("vertical-range");return{u_fog_matrix:C?Ze.calculateFogTileMatrix(C):ce||M.identityMat,u_fog_range:I.getFovAdjustedRange(Ze._fov),u_fog_color:Ne,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,Se),Se],u_fog_temporal_offset:we,u_frustum_tl:U,u_frustum_tr:H,u_frustum_br:q,u_frustum_bl:ne,u_globe_pos:ae,u_globe_radius:se,u_viewport:he,u_globe_transition:n.aj(Ze.zoom),u_is_globe:+(Ze.projection.name==="globe")}})(this,b,f,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.o.devicePixelRatio,this.transform.height*n.o.devicePixelRatio],_);i.setFogUniformValues(t,A)}w&&i.setCutoffUniformValues(t,w.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)i[_.key]=t[_.key]||new ps(_,512,this.transform.tileZoom,this,void 0,this.worldview);return i}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,i){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!i||i.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=tt||i[1]>=tt}setupDepthForOcclusion(t,i,f){const _=this.context,w=_.gl,b=!!f;var E;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(w.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),_.activeTexture.set(w.TEXTURE0),b||i.setTerrainUniformValues(_,f)}}function cc(h,t){let i=!1,f=null;const _=()=>{f=null,i&&(h(),f=setTimeout(_,t),i=!1)};return()=>(i=!0,f||_(),f)}class Ad{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=cc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const i=Ef(t);if(this._hashName){const f=this._hashName;let _=!1;const w=location.hash.slice(1).split("&").map(b=>{const E=b.split("=")[0];return E===f?(_=!0,`${E}=${i}`):b}).filter(b=>b);return _||w.push(`${f}=${i}`),`#${w.join("&")}`}return`#${i}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(i=f)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const i=this._getCurrentHash();if(i.length>=3&&!i.some(f=>isNaN(Number(f)))){const f=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:f,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ef(h,t){const i=h.getCenter(),f=Math.round(100*h.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,_),b=Math.round(i.lng*w)/w,E=Math.round(i.lat*w)/w,A=h.getBearing(),M=h.getPitch();let I=t?`/${b}/${E}/${f}`:`${f}/${E}/${b}`;return(A||M)&&(I+="/"+Math.round(10*A)/10),M&&(I+=`/${Math.round(M)}`),I}const Mu={linearity:.3,easing:n.eS(0,0,.3,1)},uc=Object.assign({deceleration:2500,maxSpeed:1400},Mu),Sf=Object.assign({deceleration:20,maxSpeed:1400},Mu),bo=Object.assign({deceleration:1e3,maxSpeed:360},Mu),zf=Object.assign({deceleration:1e3,maxSpeed:90},Mu);class Af{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=n.o.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const i={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)i.zoom+=w.zoomDelta||0,i.bearing+=w.bearingDelta||0,i.pitch+=w.pitchDelta||0,w.panDelta&&i.pan._add(w.panDelta),w.around&&(i.around=w.around),w.pinchAround&&(i.pinchAround=w.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(i.pan.mag()){const w=Wi(i.pan.mag(),f,Object.assign({},uc,t||{}));_.offset=i.pan.mult(w.amount/i.pan.mag()),_.center=this._map.transform.center,Yi(_,w)}if(i.zoom){const w=Wi(i.zoom,f,Sf);_.zoom=this._map.transform.zoom+w.amount,Yi(_,w)}if(i.bearing){const w=Wi(i.bearing,f,bo);_.bearing=this._map.transform.bearing+n.aA(w.amount,-179,179),Yi(_,w)}if(i.pitch){const w=Wi(i.pitch,f,zf);_.pitch=this._map.transform.pitch+w.amount,Yi(_,w)}if(_.zoom||_.bearing){const w=i.pinchAround===void 0?i.around:i.pinchAround;_.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Yi(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Wi(h,t,i){const{maxSpeed:f,linearity:_,deceleration:w}=i,b=n.aA(h*_/(t/1e3),-f,f),E=Math.abs(b)/(w*_);return{easing:i.easing,duration:1e3*E,amount:b*(E/2)}}class gn extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,f,_={}){const w=Ft(i.getCanvasContainer(),f),b=i.unproject(w);super(t,Object.assign({point:w,lngLat:b,originalEvent:f},_)),this._defaultPrevented=!1,this.target=i}}class Bu extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,f){const _=t==="touchend"?f.changedTouches:f.touches,w=bt(i.getCanvasContainer(),_),b=w.map(A=>i.unproject(A)),E=w.reduce((A,M,I,C)=>A.add(M.div(C.length)),new n.P(0,0));super(t,{points:w,point:E,lngLats:b,lngLat:i.unproject(E),originalEvent:f}),this._defaultPrevented=!1}}class Rf extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i){super("wheel",{originalEvent:i}),this._defaultPrevented=!1}}class Tf{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Rf(this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new gn(t.type,this._map,t))}mouseup(t){this._map.fire(new gn(t.type,this._map,t))}preclick(t){const i=new MouseEvent("preclick",t);this._map.fire(new gn(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new gn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new gn(t.type,this._map,t))}mouseover(t){this._map.fire(new gn(t.type,this._map,t))}mouseout(t){this._map.fire(new gn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Bu(t.type,this._map,t))}touchmove(t){this._map.fire(new Bu(t.type,this._map,t))}touchend(t){this._map.fire(new Bu(t.type,this._map,t))}touchcancel(t){this._map.fire(new Bu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new gn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new gn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jh{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&($e(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;const f=i,_=this._startPos,w=this._lastPos;if(!_||!w||w.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=oe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(_.x,f.x),E=Math.max(_.x,f.x),A=Math.min(_.y,f.y),M=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=E-b+"px",this._box.style.height=M-A+"px")})}mouseupWindow(t,i){if(!this._active)return;const f=this._startPos,_=i;if(f&&t.button===0){if(this.reset(),Qe(),f.x!==_.x||f.y!==_.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:t})),{cameraAnimation:w=>w.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),De(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new n.z(t,{originalEvent:i}))}}function Rd(h,t){const i={};for(let f=0;f<h.length;f++)i[h[f].identifier]=t[f];return i}class Fh{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const w=new n.P(0,0);for(const b of _)w._add(b);return w.div(_.length)}(i),this.touches=Rd(f,i)))}touchmove(t,i,f){if(this.aborted||!this.centroid)return;const _=Rd(f,i);for(const w in this.touches){const b=_[w];(!b||b.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(t,i,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class dc{constructor(t){this.singleTap=new Fh(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,f){this.singleTap.touchstart(t,i,f)}touchmove(t,i,f){this.singleTap.touchmove(t,i,f)}touchend(t,i,f){const _=this.singleTap.touchend(t,i,f);if(_){const w=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(w&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Vf{constructor(){this._zoomIn=new dc({numTouches:1,numTaps:2}),this._zoomOut=new dc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,f){this._zoomIn.touchstart(t,i,f),this._zoomOut.touchstart(t,i,f)}touchmove(t,i,f){this._zoomIn.touchmove(t,i,f),this._zoomOut.touchmove(t,i,f)}touchend(t,i,f){const _=this._zoomIn.touchend(t,i,f),w=this._zoomOut.touchend(t,i,f);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:t})}):w?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(w)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Td={0:1,2:2},Vd={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Iu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;const f=Qt(t);this._correctButton(t,f)&&(this._lastPoint=i,this._eventButton=f)}mousemoveWindow(t,i){const f=this._lastPoint;if(f){if(t.preventDefault(),this._eventButton!=null&&function(_,w){const b=Td[w];return _.buttons===void 0||(_.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(f,i)}}mouseupWindow(t){this._lastPoint&&Qt(t)===this._eventButton&&(this._moved&&Qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oh extends Iu{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class ku extends Iu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Vd[t.pitchRotateKey]:void 0}_correctButton(t,i){return this._pitchRotateKey?i===0&&t[this._pitchRotateKey]:i===0&&t.ctrlKey||i===2}_move(t,i){const f=.8*(i.x-t.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class gp extends Iu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Vd[t.pitchRotateKey]:void 0}_correctButton(t,i){return this._pitchRotateKey?i===0&&t[this._pitchRotateKey]:i===0&&t.ctrlKey||i===2}_move(t,i){const f=-.5*(i.y-t.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class _p{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),n.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,i,f){return this._calculateTransform(t,i,f)}touchmove(t,i,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!n.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,f)}}touchend(t,i,f){this._calculateTransform(t,i,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,f){f.length>0&&(this._active=!0);const _=Rd(f,i),w=new n.P(0,0),b=new n.P(0,0);let E=0;for(const M in _){const I=_[M],C=this._touches[M];C&&(w._add(I),b._add(I.sub(C)),E++,_[M]=I)}if(this._touches=_,E<this._minTouches||!b.mag())return;const A=b.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(E),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Md{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,f){return{}}touchstart(t,i,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,f){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[w,b]=_,E=Bd(f,i,w),A=Bd(f,i,b);if(!E||!A)return;const M=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],M,t)}touchend(t,i,f){if(!this._firstTwoTouches)return;const[_,w]=this._firstTwoTouches,b=Bd(f,i,_),E=Bd(f,i,w);b&&E||(this._active&&Qe(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bd(h,t,i){for(let f=0;f<h.length;f++)if(h[f].identifier===i)return t[f]}function Id(h,t){return Math.log2(h/t)}class kl extends Md{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Id(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Id(this._distance,f),pinchAround:i}}}function xp(h,t){return 180*h.angleWith(t)/Math.PI}class wp extends Md{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){const f=this._vector;if(this._vector=t[0].sub(t[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xp(this._vector,f),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const i=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=xp(t,f);return Math.abs(_)<i}}function kd(h){return Math.abs(h.y)>Math.abs(h.x)}class vp extends Md{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,kd(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,f){const _=this._lastPoints;if(!_)return;const w=t[0].sub(_[0]),b=t[1].sub(_[1]);return this._map._cooperativeGestures&&!n.eT()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(w,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(w.y+b.y)/2*-.5})}gestureBeginsVertically(t,i,f){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,w=i.mag()>=2;if(!_&&!w)return;if(!_||!w)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const b=t.y>0==i.y>0;return kd(t)&&kd(i)&&b}}const bp={panStep:100,bearingStep:15,pitchStep:10};class Jd{constructor(){const t=bp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,f=0,_=0,w=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),w=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),w=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:E=>{const A=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:_s,zoom:i?Math.round(A)+i*(t.shiftKey?2:1):A,bearing:E.getBearing()+f*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-w*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _s(h){return h*(2-h)}const um=4.000244140625,my=1/450;class Mf{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=my,n.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=n.o.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,i!==0&&i%um==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=Ft(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>um?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&I!==0&&(I=1/I);const C=i(),J=Math.pow(2,C),U=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):J;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(U*I))),this._type==="wheel"&&(this._startZoom=C,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:i(),_=this._startZoom,w=this._easing;let b,E=!1;if(this._type==="wheel"&&_&&w){const M=Math.min((n.o.now()-this._lastWheelEventTime)/200,1),I=w(M);b=n.ak(_,f,I),M<1?this._frameId||(this._frameId=!0):E=!0}else b=f,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=b-i();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=n.eU;if(this._prevEase){const f=this._prevEase,_=(n.o.now()-f.start)/f.duration,w=f.easing(_+.01)-f.easing(_),b=.27/Math.sqrt(w*w+1e-4)*.01,E=Math.sqrt(.0729-b*b);i=n.eS(b,E,.25,1)}return this._prevEase={start:n.o.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ar{constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(t.shiftKey?-1:1),around:f.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qa{constructor(){this._tap=new dc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,f){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=i[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(t,i,f))}touchmove(t,i,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=i[0],w=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(t,i,f)}touchend(t,i,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(t,i,f)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fd{constructor(t,i,f){this._el=t,this._mousePan=i,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lp{constructor(t,i,f){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Od{constructor(t,i,f,_){this._el=t,this._touchZoom=i,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Dh=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ju extends n.z{}class Fu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const f=n.av([],i,t);this.radius=n.ag(f[2]<0?n.eW([],f,this.constants):[f[0],f[1],0])}projectRay(t){n.eW(t,t,this.constants),n.aw(t,t),n.eX(t,t,this.constants);const i=n.c4([],t,this.radius);if(i[2]>0){const f=n.c4([],[0,0,1],n.bI(i,[0,0,1])),_=n.c4([],n.aw([],[i[0],i[1],0]),this.radius),w=n.d7([],i,n.c4([],n.av([],n.d7([],_,f),i),2));i[0]=w[0],i[1]=w[1]}return i}}function no(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ch{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Af(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Fu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),n.aX(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,w,b]of this._listeners){const E=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(w,E,b)}}destroy(){for(const[t,i,f]of this._listeners){const _=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(i,_,f)}}_addDefaultHandlers(t){const i=this._map,f=i.getCanvasContainer();this._add("mapEvent",new Tf(i,t));const _=i.boxZoom=new Jh(i,t);this._add("boxZoom",_);const w=new Vf,b=new dm;i.doubleClickZoom=new Ar(b,w),this._add("tapZoom",w),this._add("clickZoom",b);const E=new qa;this._add("tapDragZoom",E);const A=i.touchPitch=new vp(i);this._add("touchPitch",A);const M=new ku(t),I=new gp(t);i.dragRotate=new Lp(t,M,I),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const C=new Oh(t),J=new _p(i,t);i.dragPan=new Fd(f,C,J),this._add("mousePan",C),this._add("touchPan",J,["touchZoom","touchRotate"]);const U=new wp,H=new kl;i.touchZoomRotate=new Od(f,H,U,E),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qc(i));const q=i.scrollZoom=new Mf(i,this);this._add("scrollZoom",q,["mousePan"]);const ne=i.keyboard=new Jd;this._add("keyboard",ne);for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ae]&&i[ae].enable(t[ae])}_add(t,i,f){this._handlers.push({handlerName:t,handler:i,allowed:f}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,f){for(const _ in t)if(_!==f&&(!i||i.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const i=[];for(const f of t)this._el.contains(f.target)&&i.push(f);return i}handleEvent(t,i){this._updatingCamera=!0;const f=t.type==="renderFrame",_=f?void 0:t,w={needsRenderFrame:!1},b={},E={},A=t.touches?this._getMapTouches(t.touches):void 0,M=A?bt(this._el,A):f?void 0:Ft(this._el,t);for(const{handlerName:J,handler:U,allowed:H}of this._handlers){if(!U.isEnabled())continue;let q;this._blockedByActive(E,H,J)?U.reset():U[i||t.type]&&(q=U[i||t.type](t,M,A),this.mergeHandlerResult(w,b,q,J,_),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||U.isActive())&&(E[J]=U)}const I={};for(const J in this._previousActiveHandlers)E[J]||(I[J]=_);this._previousActiveHandlers=E,(Object.keys(I).length||no(w))&&(this._changes.push([w,b,I]),this._triggerRenderFrame()),(Object.keys(E).length||no(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:C}=w;C&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],C(this._map))}mergeHandlerResult(t,i,f,_,w){if(!f)return;Object.assign(t,f);const b={handlerName:_,originalEvent:f.originalEvent||w};f.zoomDelta!==void 0&&(i.zoom=b),f.panDelta!==void 0&&(i.drag=b),f.pitchDelta!==void 0&&(i.pitch=b),f.bearingDelta!==void 0&&(i.rotate=b)}_applyChanges(){const t={},i={},f={};for(const[_,w,b]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.aroundCoord!==void 0&&(t.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),Object.assign(i,w),Object.assign(f,b);this._updateMapTransform(t,i,f),this._changes=[]}_updateMapTransform(t,i,f){const _=this._map,w=_.transform,b=se=>[se.x,se.y,se.z];if((se=>{const he=this._eventsInProgress.drag;return he&&!this._handlersById[he.handlerName].isActive()})()&&!no(t)){const se=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),se!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&_._stop(!0),!no(t))return void this._fireEvents(i,f,!0);let{panDelta:E,zoomDelta:A,bearingDelta:M,pitchDelta:I,around:C,aroundCoord:J,pinchAround:U}=t;w._isCameraConstrained&&(A>0&&(A=0),w._isCameraConstrained=!1),U!==void 0&&(C=U),(A||(se=>i[se]&&!this._eventsInProgress[se])("drag"))&&C&&(this._dragOrigin=b(w.pointCoordinate3D(C)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",_._stop(!0),C=C||_.transform.centerPoint,M&&(w.bearing+=M),I&&(w.pitch+=I),w._updateCameraState();const H=[0,0,0];if(E)if(w.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(C).dir),he=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(C.sub(E)).dir);H[0]=he[0]-se[0],H[1]=he[1]-se[1]}else{const se=w.pointCoordinate(C);if(w.projection.name==="globe"){E=E.rotate(-w.angle);const he=w._pixelsPerMercatorPixel/w.worldSize;H[0]=-E.x*n.eV(n.a_(se.y))*he,H[1]=-E.y*n.eV(w.center.lat)*he}else{const he=w.pointCoordinate(C.sub(E));se&&he&&(H[0]=he.x-se.x,H[1]=he.y-se.y)}}const q=w.zoom,ne=[0,0,0];if(A){const se=b(J||w.pointCoordinate3D(C)),he={dir:n.aw([],n.av([],se,w._camera.position))};if(he.dir[2]<0){const ce=w.zoomDeltaToMovement(se,A);n.c4(ne,he.dir,ce)}}const ae=n.d7(H,H,ne);w._translateCameraConstrained(ae),A&&Math.abs(w.zoom-q)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,f,!0)}_fireEvents(t,i,f){const _=Dh(this._eventsInProgress),w=Dh(t),b={};for(const I in t){const{originalEvent:C}=t[I];this._eventsInProgress[I]||(b[`${I}start`]=C),this._eventsInProgress[I]=t[I]}!_&&w&&this._fireEvent("movestart",w.originalEvent);for(const I in b)this._fireEvent(I,b[I]);w&&this._fireEvent("move",w.originalEvent);for(const I in t){const{originalEvent:C}=t[I];this._fireEvent(I,C)}const E={};let A;for(const I in this._eventsInProgress){const{handlerName:C,originalEvent:J}=this._eventsInProgress[I];this._handlersById[C].isActive()||(delete this._eventsInProgress[I],A=i[C]||J,E[`${I}end`]=A)}for(const I in E)this._fireEvent(I,E[I]);const M=Dh(this._eventsInProgress);if(f&&(_||w)&&!M){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),C=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;I?(C(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:A})):(this._map.fire(new n.z("moveend",{originalEvent:A})),C(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new n.z(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Ju("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ml extends n.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,n.aX(["_renderFrameCallback"],this)}getCenter(){return new n.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,f){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},i),f)}panTo(t,i,f){return this.easeTo(Object.assign({center:t},i),f)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,f){return this.easeTo(Object.assign({zoom:t},i),f)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,f){return this.easeTo(Object.assign({bearing:t},i),f)}resetNorth(t,i){return this.rotateTo(0,Object.assign({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=n.aI.convert(t);const f=i&&i.bearing||0,_=i&&i.pitch||0,w=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,w,b,f,_,i)}_extendPadding(t){const i={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},i,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},i,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,i){const f=i.max[0]-i.min[0],_=i.max[1]-i.min[1];return f/_>t.aspect?f/(2*Math.tan(.5*t.fovX)*t.aspect):_/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,f,_,w,b){const E=t.clone(),A=this._extendCameraOptions(b);E.bearing=_,E.pitch=w;const M=n.aS.convert(i),I=n.aS.convert(f),C=.5*(M.lat+I.lat),J=.5*(M.lng+I.lng),U=n.eY(C,J),H=n.aw([],U),q=n.aw([],n.bH([],H,[0,1,0])),ne=n.bH([],q,H),ae=[q[0],q[1],q[2],0,ne[0],ne[1],ne[2],0,H[0],H[1],H[2],0,0,0,0,1],se=[U,n.eY(M.lat,M.lng),n.eY(I.lat,M.lng),n.eY(I.lat,I.lng),n.eY(M.lat,I.lng),n.eY(C,M.lng),n.eY(C,I.lng),n.eY(M.lat,J),n.eY(I.lat,J)];let he=n.d8.fromPoints(se.map(et=>[n.bI(q,et),n.bI(ne,et),n.bI(H,et)]));const ce=n.af([],he.center,ae);n.eZ(ce)===0&&n.e_(ce,0,0,1),n.aw(ce,ce),n.c4(ce,ce,n.aD),E.center=n.e$(ce);const Ze=E.getWorldToCameraMatrix(),me=n.bk(new Float64Array(16),Ze);he=n.d8.applyTransform(he,n.aB([],Ze,ae));const Ne=this._extendAABB(he,E,A,_);if(!Ne)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=Ne,n.af(ce,ce,Ze);const we=.5*(he.max[2]-he.min[2]),ge=this._minimumAABBFrustumDistance(E,he),Se=n.c4([],[0,0,1],we),Pe=n.d7(Se,ce,Se),Fe=ge+(E.pitch===0?0:n.bF(ce,Pe)),it=E.globeCenterInViewSpace,qe=n.av([],ce,[it[0],it[1],it[2]]);n.aw(qe,qe),n.c4(qe,qe,Fe);const dt=n.d7([],ce,qe);n.af(dt,dt,me);const Mt=n.eL/n.aD,Xe=n.ag(dt),Ie=n.ce(Math.max(Xe*Mt-n.eL,Number.EPSILON),0),ct=Math.min(E.zoomFromMercatorZAdjusted(Ie),A.maxZoom);return ct>.5*(n.cZ+n.cK)?(E.setProjection({name:"mercator"}),E.zoom=ct,this._cameraForBounds(E,i,f,_,w,b)):{center:E.center,zoom:ct,bearing:_,pitch:w}}_extendAABB(t,i,f,_){const w=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),E=b,A=w,M=w,I=b,C=i.width-(A+M),J=i.height-(E+I),U=n.av([],t.max,t.min),H=Math.min(C/U[0],J/U[1]),q=Math.min(i.scaleZoom(i.scale*H),f.maxZoom);if(isNaN(q))return null;const ne=i.scale/i.zoomScale(q),ae=new n.d8([t.min[0]-A*ne,t.min[1]-I*ne,t.min[2]],[t.max[0]+M*ne,t.max[1]+E*ne,t.max[2]]),se=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new n.P(f.offset.x,f.offset.y):n.P.convert(f.offset)).rotate(-n.an(_));return ae.center[0]-=se.x*ne,ae.center[1]+=se.y*ne,ae}queryTerrainElevation(t,i){const f=this.transform.elevation;return f?(i=Object.assign({},{exaggerated:!0},i),f.getAtPoint(n.ae.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,f,_,w,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,f,_,w,b);const E=t.clone(),A=this._extendCameraOptions(b);E.bearing=_,E.pitch=w;const M=n.aS.convert(i),I=n.aS.convert(f),C=new n.aS(M.lng,I.lat),J=new n.aS(I.lng,M.lat),U=E.project(M),H=E.project(I),q=this.queryTerrainElevation(M),ne=this.queryTerrainElevation(I),ae=this.queryTerrainElevation(C),se=this.queryTerrainElevation(J),he=[[U.x,U.y,Math.min(q||0,ne||0,ae||0,se||0)],[H.x,H.y,Math.max(q||0,ne||0,ae||0,se||0)]];let ce=n.d8.fromPoints(he);const Ze=E.getWorldToCameraMatrix(),me=n.bk(new Float64Array(16),Ze);ce=n.d8.applyTransform(ce,Ze);const Ne=this._extendAABB(ce,E,A,_);if(!Ne)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Ne;const we=.5*n.av([],ce.max,ce.min)[2],ge=this._minimumAABBFrustumDistance(E,ce),Se=[0,0,1,0];n.aC(Se,Se,Ze),n.f0(Se,Se);const Pe=n.c4([],Se,ge+we),Fe=n.d7([],ce.center,Pe);n.af(ce.center,ce.center,me),n.af(Fe,Fe,me);const it=E.unproject(new n.P(ce.center[0],ce.center[1])),qe=n.f1(E.projection,it),dt=Math.pow(2,qe),Mt=Math.min(E._zoomFromMercatorZ(Fe[2]*E.pixelsPerMeter*dt/E.worldSize),A.maxZoom);return E.mercatorFromTransition&&Mt<.5*(n.cZ+n.cK)?(E.setProjection({name:"globe"}),E.zoom=Mt,this._cameraForBounds(E,i,f,_,w,b)):{center:it,zoom:Mt,bearing:_,pitch:w}}fitBounds(t,i,f){const _=this.cameraForBounds(t,i);return this._fitInternal(_,i,f)}fitScreenCoordinates(t,i,f,_,w){const b=n.P.convert(t),E=n.P.convert(i),A=new n.P(Math.min(b.x,E.x),Math.min(b.y,E.y)),M=new n.P(Math.max(b.x,E.x),Math.max(b.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,E))return this;const I=this.transform.pointLocation3D(A),C=this.transform.pointLocation3D(M),J=this.transform.pointLocation3D(new n.P(A.x,M.y)),U=this.transform.pointLocation3D(new n.P(M.x,A.y)),H=[Math.min(I.lng,C.lng,J.lng,U.lng),Math.min(I.lat,C.lat,J.lat,U.lat)],q=[Math.max(I.lng,C.lng,J.lng,U.lng),Math.max(I.lat,C.lat,J.lat,U.lat)],ne=_&&_.pitch?_.pitch:this.getPitch(),ae=this._cameraForBounds(this.transform,H,q,f,ne,_);return this._fitInternal(ae,_,w)}_fitInternal(t,i,f){return t?(i=Object.assign(t,i)).linear?this.easeTo(i,f):this.flyTo(i,f):this}jumpTo(t,i){this.stop();const f=t.preloadOnly?this.transform.clone():this.transform;let _=!1,w=!1,b=!1;"zoom"in t&&f.zoom!==+t.zoom&&(_=!0,f.zoom=+t.zoom),t.center!==void 0&&(f.center=n.aS.convert(t.center)),"bearing"in t&&f.bearing!==+t.bearing&&(w=!0,f.bearing=+t.bearing),"pitch"in t&&f.pitch!==+t.pitch&&(b=!0,f.pitch=+t.pitch);const E=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!f.isPaddingEqual(E))if(t.retainPadding===!1){const A=f.clone();A.padding=E,f.setLocationAtPoint(f.center,A.centerPoint)}else f.padding=E;return t.preloadOnly?(this._preloadTiles(f),this):(this.fire(new n.z("movestart",i)).fire(new n.z("move",i)),_&&this.fire(new n.z("zoomstart",i)).fire(new n.z("zoom",i)).fire(new n.z("zoomend",i)),w&&this.fire(new n.z("rotatestart",i)).fire(new n.z("rotate",i)).fire(new n.z("rotateend",i)),b&&this.fire(new n.z("pitchstart",i)).fire(new n.z("pitch",i)).fire(new n.z("pitchend",i)),this.fire(new n.z("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(qn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const f=this.transform;if(!f.projection.supportsFreeCamera)return n.w(qn),this;this.stop();const _=f.zoom,w=f.pitch,b=f.bearing;f.setFreeCameraOptions(t);const E=_!==f.zoom,A=w!==f.pitch,M=b!==f.bearing;return this.fire(new n.z("movestart",i)).fire(new n.z("move",i)),E&&this.fire(new n.z("zoomstart",i)).fire(new n.z("zoom",i)).fire(new n.z("zoomend",i)),M&&this.fire(new n.z("rotatestart",i)).fire(new n.z("rotate",i)).fire(new n.z("rotateend",i)),A&&this.fire(new n.z("pitchstart",i)).fire(new n.z("pitch",i)).fire(new n.z("pitchend",i)),this.fire(new n.z("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:n.eU},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const f=this.transform,_=this.getZoom(),w=this.getBearing(),b=this.getPitch(),E=this.getPadding(),A="zoom"in t?+t.zoom:_,M="bearing"in t?this._normalizeBearing(t.bearing,w):w,I="pitch"in t?+t.pitch:b,C=this._extendPadding(t.padding),J=n.P.convert(t.offset);let U,H,q;if(f.projection.name==="globe"){const Se=n.ae.fromLngLat(f.center),Pe=J.rotate(-f.angle);Se.x+=Pe.x/f.worldSize,Se.y+=Pe.y/f.worldSize;const Fe=Se.toLngLat(),it=n.aS.convert(t.center||Fe);this._normalizeCenter(it),U=f.centerPoint.add(Pe),H=new n.P(Se.x,Se.y).mult(f.worldSize),q=new n.P(n.aF(it.lng),n.aJ(it.lat)).mult(f.worldSize).sub(H)}else{U=f.centerPoint.add(J);const Se=f.pointLocation(U),Pe=n.aS.convert(t.center||Se);this._normalizeCenter(Pe),H=f.project(Se),q=f.project(Pe).sub(H)}const ne=f.zoomScale(A-_);let ae,se;t.around&&(ae=n.aS.convert(t.around),se=f.locationPoint(ae));const he=this._zooming||A!==_,ce=this._rotating||w!==M,Ze=this._pitching||I!==b,me=!f.isPaddingEqual(C),Ne=t.retainPadding===!1?f.clone():f,we=Se=>Pe=>{if(he&&(Se.zoom=n.ak(_,A,Pe)),ce&&(Se.bearing=n.ak(w,M,Pe)),Ze&&(Se.pitch=n.ak(b,I,Pe)),me&&(Ne.interpolatePadding(E,C,Pe),U=Ne.centerPoint.add(J)),ae)Se.setLocationAtPoint(ae,se);else{const Fe=Se.zoomScale(Se.zoom-_),it=A>_?Math.min(2,ne):Math.max(.5,ne),qe=Math.pow(it,1-Pe),dt=Se.unproject(H.add(q.mult(Pe*qe)).mult(Fe));Se.setLocationAtPoint(Se.renderWorldCopies?dt.wrap():dt,U)}return t.preloadOnly||this._fireMoveEvents(i),Se};if(t.preloadOnly){const Se=this._emulate(we,t.duration,f);return this._preloadTiles(Se),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=he,this._rotating=ce,this._pitching=Ze,this._padding=me,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,ge),this._ease(we(f),Se=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(i,Se)},t),this}_prepareEase(t,i,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||f.moving||this.fire(new n.z("movestart",t)),this._zooming&&!f.zooming&&this.fire(new n.z("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new n.z("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new n.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.z("move",t)),this._zooming&&this.fire(new n.z("zoom",t)),this._rotating&&this.fire(new n.z("rotate",t)),this._pitching&&this.fire(new n.z("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new n.z("zoomend",t)),_&&this.fire(new n.z("rotateend",t)),w&&this.fire(new n.z("pitchend",t)),this.fire(new n.z("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const et=n.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(et,i)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:n.eU},t);const f=this.transform,_=this.getZoom(),w=this.getBearing(),b=this.getPitch(),E=this.getPadding(),A="zoom"in t?n.aA(+t.zoom,f.minZoom,f.maxZoom):_,M="bearing"in t?this._normalizeBearing(t.bearing,w):w,I="pitch"in t?+t.pitch:b,C=this._extendPadding(t.padding),J=f.zoomScale(A-_),U=n.P.convert(t.offset);let H=f.centerPoint.add(U);const q=f.pointLocation(H),ne=n.aS.convert(t.center||q);this._normalizeCenter(ne);const ae=f.project(q),se=f.project(ne).sub(ae);let he=t.curve;const ce=Math.max(f.width,f.height),Ze=ce/J,me=se.mag();if("minZoom"in t){const et=n.aA(Math.min(t.minZoom,_,A),f.minZoom,f.maxZoom),jt=ce/f.zoomScale(et-_);he=Math.sqrt(jt/me*2)}const Ne=he*he;function we(et){const jt=(Ze*Ze-ce*ce+(et?-1:1)*Ne*Ne*me*me)/(2*(et?Ze:ce)*Ne*me);return Math.log(Math.sqrt(jt*jt+1)-jt)}function ge(et){return(Math.exp(et)-Math.exp(-et))/2}function Se(et){return(Math.exp(et)+Math.exp(-et))/2}const Pe=we(0);let Fe=function(et){return Se(Pe)/Se(Pe+he*et)},it=function(et){return ce*((Se(Pe)*(ge(jt=Pe+he*et)/Se(jt))-ge(Pe))/Ne)/me;var jt},qe=(we(1)-Pe)/he;if(Math.abs(me)<1e-6||!isFinite(qe)){if(Math.abs(ce-Ze)<1e-6)return this.easeTo(t,i);const et=Ze<ce?-1:1;qe=Math.abs(Math.log(Ze/ce))/he,it=function(){return 0},Fe=function(jt){return Math.exp(et*he*jt)}}t.duration="duration"in t?+t.duration:1e3*qe/("screenSpeed"in t?+t.screenSpeed/he:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const dt=w!==M,Mt=I!==b,Xe=!f.isPaddingEqual(C),Ie=t.retainPadding===!1?f.clone():f,ct=et=>jt=>{const Ct=jt*qe,oa=1/Fe(Ct);et.zoom=jt===1?A:_+et.scaleZoom(oa),dt&&(et.bearing=n.ak(w,M,jt)),Mt&&(et.pitch=n.ak(b,I,jt)),Xe&&(Ie.interpolatePadding(E,C,jt),H=Ie.centerPoint.add(U));const Bt=jt===1?ne:et.unproject(ae.add(se.mult(it(Ct))).mult(oa));return et.setLocationAtPoint(et.renderWorldCopies?Bt.wrap():Bt,H),et._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),et};if(t.preloadOnly){const et=this._emulate(ct,t.duration,f);return this._preloadTiles(et),this}return this._zooming=!0,this._rotating=dt,this._pitching=Mt,this._padding=Xe,this._prepareEase(i,!1),this._ease(ct(f),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,i)}if(!t){const f=this.handlers;f&&f.stop(!1)}return this}_ease(t,i,f){f.animate===!1||f.duration===0?(t(1),i()):(this._easeStart=n.o.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.o.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=n.bS(t,-180,180);const f=Math.abs(t-i);return Math.abs(t-360-i)<f&&(t-=360),Math.abs(t+360-i)<f&&(t+=360),t}_normalizeCenter(t){const i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;const f=t.lng-i.center.lng;t.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,f){const _=Math.ceil(15*i/1e3),w=[],b=t(f.clone());for(let E=0;E<=_;E++){const A=b(E/_);w.push(A.clone())}return w}_preloadTiles(t,i){}}class Hc{constructor(t={}){this.options=t,n.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const i=this.options&&this.options.compact,f=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=oe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const _=oe("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=oe("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){const f=i.reduce((_,w,b)=>(w.value&&(_+=`${w.key}=${w.value}${b<i.length-1?"&":""}`),_),"?");t.href=`${n.e.FEEDBACK_URL}/${f}#${Ef(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const i=this._map.style._mergedSourceCaches;for(const _ in i){const w=i[_];if(w.used){const b=w.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((_,w)=>_.length-w.length),t=t.filter((_,w)=>{for(let b=w+1;b<t.length;b++)if(t[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ou{constructor(){n.aX(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=oe("div","mapboxgl-ctrl");const i=oe("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const i in t){const f=t[i].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class $i{constructor(){n.aX(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",i=>this._onIndoorUpdate(i)),this._container}_createButton(t,i){const f=oe("button",t,this._container);return f.type="button",f.addEventListener("click",i),f}_createSeparator(){return oe("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,i){this._map&&(t.setAttribute("aria-label",i),t.textContent=i)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const i=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",i&&Array.from(this._container.children).forEach(f=>f.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const i=this._map;this._model&&i&&i._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});oe("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,i){for(let f=0;f<t.length;f++){const _=t[f],w=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(_.id)});this._setButtonTitle(w,_.zIndex.toString()),this._model&&_.id===this._model.selectedFloorId&&i&&w.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(w),f<t.length-1&&this._createSeparator()}}}class Co{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){const i=this._currentlyRunning,f=i?this._queue.concat(i):this._queue;for(const _ of f)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const i=this._currentlyRunning=this._queue;this._queue=[];for(const f of i)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Po{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=n.dC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,f){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+f}}const hm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class jp extends n.z{constructor(t,i,f,_){const{point:w,lngLat:b,originalEvent:E,target:A}=t;super(t.type,{point:w,lngLat:b,originalEvent:E,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=i,this.interaction=f,this.feature=_}}class Lo{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,i){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const f=i.filter;let _=i.type;f&&this.filters.set(t,n.b5(f)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const w=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,i)):w.size===0&&this.map.on(_,this.handleType),w.size===0&&this.interactionsByType.set(_,w),w.set(t,i),this.typeById.set(t,_)}get(t){const i=this.typeById.get(t);if(!i)return;const f=this.interactionsByType.get(i);return f?f.get(t):void 0}remove(t){const i=this.typeById.get(t);if(!i)return;this.typeById.delete(t),this.filters.delete(t);const f=this.interactionsByType.get(i);f&&(f.delete(t),i==="mouseenter"||i==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(i,this.handleType))}queryTargets(t,i){const f=[];for(const[_,w]of i)w.target&&f.push({targetId:_,target:w.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(t,f,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const i=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());i.length&&(t.type="mouseenter",this.handleType(t,i));const f=new Map;for(const[_,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||f.set(w.id,w);f.size&&(t.type="mouseleave",this.handleType(t,Array.from(f.values())))}handleOut(t){const i=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);i.length&&(t.type="mouseleave",this.handleType(t,i)),this.hoveredFeatures.clear()}handleType(t,i){const f=t.type==="mouseenter";if(f&&!this.interactionsByType.has(t.type))return void n.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(t.type)).reverse(),w=!!i;i=i||this.queryTargets(t.point,_);let b=!1;const E=new Set;for(const A of i){for(const[M,I]of _){if(!I.target)continue;const C=A.variants?A.variants[M]:null;if(C){for(const J of C){if(as(J,A,E,M))continue;const U=new n.dw(A,J),H=ho(J,A,M);w&&U.id!==void 0&&(U.state=this.map.getFeatureState(U));const q=f?this.prevHoveredFeatures.get(H):null,ne=new jp(t,M,I,U),ae=q?q.stop:I.handler(ne);if(f&&this.hoveredFeatures.set(H,{feature:A,stop:ae}),ae!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[A,M]of _){const{handler:I,target:C}=M;if(!C&&I(new jp(t,A,M,null))!==!1)break}}}function Bf(h,t){if(Array.isArray(h)&&Array.isArray(t)){const i=new Set(h),f=new Set(t);return i.size===f.size&&h.every(_=>f.has(_))}return n.bx(h,t)}const jo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},If={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dd{constructor(t,i,f=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new ku({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,f&&(this.mousePitch=new gp({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),$e()}move(t,i){const f=this.map,_=this.mouseRotate.mousemoveWindow(t,i),w=_&&_.bearingDelta;if(w&&f.setBearing(f.getBearing()+w),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,i),E=b&&b.pitchDelta;E&&f.setPitch(f.getPitch()+E)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){De(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ft(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ft(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=bt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=bt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Jl(h,t,i){if(h=new n.aS(h.lng,h.lat),t){const f=new n.aS(h.lng-360,h.lat),_=new n.aS(h.lng+360,h.lat),w=360*Math.ceil(Math.abs(h.lng-i.center.lng)/360),b=i.locationPoint3D(h).distSqr(t),E=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint3D(f).distSqr(t)<b&&(E||Math.abs(f.lng-i.center.lng)<w)?h=f:i.locationPoint3D(_).distSqr(t)<b&&(E||Math.abs(_.lng-i.center.lng)<w)&&(h=_)}for(;Math.abs(h.lng-i.center.lng)>180;){const f=i.locationPoint3D(h);if(f.x>=0&&f.y>=0&&f.x<=i.width&&f.y<=i.height)break;h.lng>i.center.lng?h.lng-=360:h.lng+=360}return h}const Go={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},qi={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class hc extends n.E{constructor(t,i){super(),(t instanceof HTMLElement||i)&&(t=Object.assign({element:t},i)),n.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:f="center",color:_="#3FB1CE",scale:w=1,draggable:b=!1,clickTolerance:E=0,rotation:A=qi.rotation,rotationAlignment:M=qi.rotationAlignment,pitchAlignment:I=qi.pitchAlignment,occludedOpacity:C=qi.occludedOpacity,altitude:J=qi.altitude}=t||{};this._anchor=f,this._color=_,this._scale=w,this._draggable=b,this._clickTolerance=E,this._rotation=A,this._rotationAlignment=M,this._pitchAlignment=I,this._occludedOpacity=C,this._altitude=J,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",q=>{q.preventDefault()}),this._element.addEventListener("mousedown",q=>{q.preventDefault()});const U=this._element.classList;for(const q in Go)U.remove(`mapboxgl-marker-anchor-${q}`);U.add(`mapboxgl-marker-anchor-${this._anchor}`);const H=t&&t.className?t.className.trim().split(/\s+/):[];U.add(...H),this._popup=null}_createDefaultMarker(){const t=oe("div"),i=pe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const f=pe("radialGradient",{id:"shadowGradient"},pe("defs",{},i));pe("stop",{offset:"10%","stop-opacity":.4},f),pe("stop",{offset:"100%","stop-opacity":.05},f),pe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i)}return pe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),pe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),pe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.aS.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||qi.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const i=t.code,f=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(t){const i=t.originalEvent.target,f=this._element;this._popup&&(i===f||f.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,i=this._pos;if(!t||!i)return!1;const f=t.unproject(i,this._altitude),_=t.getFreeCameraOptions();if(!_.position)return!1;const w=_.position.toLngLat();return w.distanceTo(f)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const f=t.unproject(i,this._altitude);let _;t._showingGlobe()&&n.f4(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(f),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Go[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){const t=this._pos,i=this._map,f=this.getPitchAlignment();if(!i||!t||f!=="map")return"";if(!i._showingGlobe()){const A=i.getPitch();return A?`rotateX(${A}deg)`:""}const _=n.cW(n.f5(i.transform,this._lngLat)),w=t.sub(n.f6(i.transform)),b=Math.abs(w.x)+Math.abs(w.y);if(b===0)return"";const E=_/b;return`rotateX(${-w.y*E}deg) rotateY(${w.x*E}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(i._showingGlobe()){const w=i.project(new n.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=i.project(new n.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);f=n.cW(Math.atan2(b.y,b.x))-90}else f=-i.getBearing();else if(_==="horizon"){const w=n.ah(4,6,i.getZoom()),b=n.f6(i.transform);b.y+=w*i.transform.height;const E=t.sub(b),A=n.cW(Math.atan2(E.y,E.x));f=(A>90?A-270:A+90)*(1-w)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Jl(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const i=this._map;if(!i)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const w=this._clickTolerance||i._clickTolerance;if(t.point.dist(f)<w)return;this._isDragging=!0}this._pos=t.point.sub(_),this._lngLat=i.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(t){const i=this._map,f=this._pos;i&&f&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(f),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||qi.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||qi.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||qi.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||qi.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const io={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Zp={maxWidth:100,unit:"metric"},Uo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},An={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},is=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ei(h=new n.P(0,0),t="bottom"){if(typeof h=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new n.P(0,h);case"top-left":return new n.P(i,i);case"top-right":return new n.P(-i,i);case"bottom":return new n.P(0,-h);case"bottom-left":return new n.P(i,-i);case"bottom-right":return new n.P(-i,-i);case"left":return new n.P(h,0);case"right":return new n.P(-h,0)}return new n.P(0,0)}return h instanceof n.P||Array.isArray(h)?n.P.convert(h):n.P.convert(h[t]||[0,0])}return{version:B,supported:ue.supported,setRTLTextPlugin:n.fa,getRTLTextPluginStatus:n.f9,Map:class extends ml{constructor(h){P.mark(D.create);const t=h;if((h=Object.assign({},jo,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&n.f2(window)&&(h.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Tc(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Co,this._domRenderTaskQueue=new Co,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.b1(),this._locale=Object.assign({},hm,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Po(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new st(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const i=document.getElementById(h.container);if(!i)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=i}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,n.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new py),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ch(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||n.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new Ad(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const i=h.bounds;i&&(this.resize(),this.fitBounds(i,Object.assign({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Hc({customAttribution:h.customAttribution})),this._logoControl=new Ou,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new n.z(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new n.z(`${i.dataType}dataloading`,i))}),this._interactions=new Lo(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=h.onAdd(this);this._controls.push(h);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(i,f.firstChild):f.appendChild(i),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.z("movestart",h)).fire(new n.z("move",h)),this.fire(new n.z("resize",h)),t&&this.fire(new n.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(n.aI.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let i;t==="globe"&&h.zoom>=n.cK?(h.setMercatorFromTransition(),i=!0):t==="mercator"&&h.zoom<n.cK&&(h.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;const i=this.transform.mercatorFromTransition;t=h.name==="globe"&&this.transform.zoom>=n.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate();const f=this.transform.getProjection().name==="mercator"&&i!==this.transform.mercatorFromTransition;return(t||f)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(n.aS.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(n.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,i){const f=_=>{let w=[];if(Array.isArray(t)){const b=t.filter(E=>this.getLayer(E));w=b.length?this.queryRenderedFeatures(_,{layers:b}):[]}else w=this.queryRenderedFeatures(_,{target:t});return w};if(h==="mouseenter"||h==="mouseover"){let _=!1;return{listener:i,targets:t,delegates:{mousemove:b=>{const E=f(b.point);E.length?_||(_=!0,i.call(this,new gn(h,this,b.originalEvent,{features:E}))):_=!1},mouseout:()=>{_=!1}}}}if(h==="mouseleave"||h==="mouseout"){let _=!1;return{listener:i,targets:t,delegates:{mousemove:E=>{f(E.point).length?_=!0:_&&(_=!1,i.call(this,new gn(h,this,E.originalEvent)))},mouseout:E=>{_&&(_=!1,i.call(this,new gn(h,this,E.originalEvent)))}}}}{const _=w=>{const b=f(w.point);b.length&&(w.features=b,i.call(this,w),delete w.features)};return{listener:i,targets:t,delegates:{[h]:_}}}}on(h,t,i){if(typeof t=="function"||i===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const f=this._createDelegatedListener(h,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(h,t,i){if(typeof t=="function"||i===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const f=this._createDelegatedListener(h,t,i);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(h,t,i){if(typeof t=="function"||i===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const f=this._delegatedListeners?this._delegatedListeners[h]:void 0;return f&&(_=>{for(let w=0;w<_.length;w++){const b=_[w];if(b.listener===i&&Bf(b.targets,t)){for(const E in b.delegates)this.off(E,b.delegates[E]);return _.splice(w,1),this}}})(f),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof n.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const w=this.style.queryRenderedFeatures(h,void 0,this.transform),b=this.style.queryRenderedFeatureset(h,void 0,this.transform);return w.concat(b)}let i=!0;if(t.target&&(i=this._isTargetValid(t.target),i&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let f=!0;if(t.layers&&Array.isArray(t.layers)){for(const w of t.layers)if(!this._isValidId(w)){f=!1;break}if(f&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let _=[];return f&&(_=_.concat(this.style.queryRenderedFeatures(h,t,this.transform))),i&&(_=_.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),_}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}queryRasterValue(h,t,i){return this._isValidId(h)?this.style.queryRasterValue(h,t,i):Promise.resolve(null)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(i,f)=>{if(i){const _=typeof i=="string"?i:i instanceof Error?i.message:i.error;n.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(h,t)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const i=Object.assign({},t);t&&t.config&&(i.initialConfig=t.config,delete i.config),this.style=new Ks(this,i).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ks(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.dq(h)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,i)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:i=1,sdf:f=!1,stretchX:_,stretchY:w,content:b}={}){this._lazyInitEmptyStyle();const E=n.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:A,height:M,data:I}=n.o.getImageData(t);this.style.addImage(E,{data:new n.q({width:A,height:M},I),pixelRatio:i,stretchX:_,stretchY:w,content:b,sdf:f,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:M}=t,I=t;this.style.addImage(E,{data:new n.q({width:A,height:M},new Uint8Array(I.data)),pixelRatio:i,stretchX:_,stretchY:w,content:b,sdf:f,usvg:!1,version:0,userImage:I}),I.onAdd&&I.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const i=n.I.from(h),f=this.style.getImage(i);if(!f)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.o.getImageData(t):t,{width:w,height:b,data:E}=_;if(w===void 0||b===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||b!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${w}, ${b})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const A=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let M=!1;f.usvg?(f.data=new n.q({width:w,height:b},new Uint8Array(E)),f.usvg=!1,f.icon=void 0,M=!0):f.data.replace(E,A),this.style.updateImage(i,f,M)}hasImage(h){return h?!!this.style&&!!this.style.getImage(n.I.from(h)):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(n.I.from(h))}loadImage(h,t){n.n(this._requestManager.transformRequest(h,n.R.Image),(i,f)=>{t(i,f instanceof HTMLImageElement?n.o.getImageData(f):f)})}listImages(){return this.style.listImages().map(h=>h.name)}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t).catch(i=>this.fire(new n.y(new Error("Failed to add import",i)))),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,i){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,i),this._update(!0)):this}setFilter(h,t,i={}){return this._isValidId(h)?(this.style.setFilter(h,t,i),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,i,f={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,i,f),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,i,f={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,i,f),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}setLayerProperty(h,t,i,f={}){return this._isValidId(h)?(this.style.setLayerProperty(h,t,i,f),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,i){return this.style.setConfigProperty(h,t,i),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.aS.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_selectIndoorFloor(h){this.indoor.selectFloor(h)}_setIndoorActiveFloorsVisibility(h){this.indoor.setActiveFloorsVisibility(h)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new $i),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,f,_,w=this._container;for(;w&&(!f||!_);){const b=window.getComputedStyle(w).transform;b&&b!=="none"&&(i=b.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(f=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(_=i[3])),w=w.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Mc(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=oe("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=oe("div","mapboxgl-canvas-container",h);this._canvas=oe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=oe("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=oe("div",`mapboxgl-ctrl-${_}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const i=n.o.devicePixelRatio||1;this._canvas.width=i*Math.ceil(h),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=Object.assign({},ue.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(bs(t,!0),this.painter=new vo(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.k.testSupport(t)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new n.z("renderstart")),++this._frameId;const i=this.painter.context.extTimerQuery,f=n.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=_.createQuery(),_.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,I=this.transform.pitch,C=n.o.now(),J=new n.ac(M,{now:C,fadeDuration:w,pitch:I,transition:this.style.transition,worldview:this._worldview});this.style.update(J)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f);const E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),E&&(this._placementDirty=E.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,P.mark(D.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const M=n.o.now()-f;_.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const I=_.getQueryParameter(t,_.QUERY_RESULT)/1e6;_.deleteQuery(t),this.fire(new n.z("gpu-timing-frame",{cpuTime:M,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(M);this.fire(new n.z("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(M);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:I}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{const M=this.idle();if(M&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,P.mark(D.fullLoad),this._performanceMetricsCollection&&gr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const i=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const _=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=h;const b=Math.abs(_-w);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(w),i(w);this._averageElevation.easeTo(w,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(w),i(w)}return!!this._averageElevation.isEasing(h)&&i(this._averageElevation.getValue(h))}_authenticate(){qo(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===Ke||h.status===401)){const t=this.painter.context.gl;bs(t,!1),this._logoControl instanceof Ou&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ba(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ja(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&or(this._requestManager._customAccessToken)}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,f=i.createFramebuffer();function _(w){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,w,0);const b=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,b),b}return i.bindFramebuffer(i.FRAMEBUFFER,f),this._canvasPixelComparison(_(h),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(h,t,i){let f=i[1]-i[0];const _=h.length/4;for(let w=0;w<t.length;w++){const b=t[w];let E=0;for(let A=0;A<b.length;A+=4)b[A]===h[A]&&b[A+1]===h[A+1]&&b[A+2]===h[A+2]&&b[A+3]===h[A+3]&&(E+=1);f+=(i[w+2]-i[w+1])*(1-E/_)}return f}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ln.delete(this.painter.context.gl),Pn.remove(),Be.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=n.o.frame(t=>{const i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return n.bv(t,(i,f)=>i._preloadTiles(h,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){n.f3(h,t)}get version(){return B}},NavigationControl:class{constructor(h={}){this.options=Object.assign({},If,h),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),oe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),oe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=oe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),i=t===h.getMaxZoom(),f=t===h.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dd(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const i=oe("button",h,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(h,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",i),h.firstElementChild&&h.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends n.E{constructor(h={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},io,h),n.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=cc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,h(i)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),i=h.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",Object.assign({coords:h.coords,timestamp:h.timestamp},h.toJSON?{toJSON:h.toJSON.bind(h)}:{}))),this._finish()}}_updateCamera(h){const t=new n.aS(h.coords.longitude,h.coords.latitude),i=h.coords.accuracy,f=this._map.getBearing(),_=Object.assign({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),_,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new n.aS(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=n.ce(1,h._center.lat)*h.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=oe("button","mapboxgl-ctrl-geolocate",this._container),oe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe("div","mapboxgl-user-location"),this._dotElement.appendChild(oe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(oe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new hc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=oe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hc,ScaleControl:class{constructor(h={}){this.options=Object.assign({},Zp,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,f=t._containerWidth/2-h/2,_=t.unproject([f,i]),w=t.unproject([f+h,i]),b=_.distanceTo(w);if(this.options.unit==="imperial"){const E=3.2808*b;E>5280?this._setScale(h,E/5280,"mile"):this._setScale(h,E,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,t,i){this._map._requestDomTask(()=>{const f=function(w){const b=Math.pow(10,`${Math.floor(w)}`.length-1);let E=w/b;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(A){const M=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*M)/M}(E),b*E}(t),_=f/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(f):`${f}&nbsp;${Uo[i]}`,this._container.style.width=h*_+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:n.w("Full screen control 'container' must be a DOM element.")),n.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=oe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);oe("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:$i,Popup:class extends n.E{constructor(h){super(),this.options=Object.assign(Object.create(An),h),this._altitude=this.options.altitude,n.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=n.aS.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),i=document.createElement("body");let f;for(i.innerHTML=h;f=i.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=oe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const i=this._closeButton=oe("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.innerHTML='<span aria-hidden="true">&#215;</span>',i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,f=this._pos;if(!t||!i||!f)return"bottom";const _=i.offsetWidth,w=i.offsetHeight,b=f.x<_/2,E=f.x>t.transform.width-_/2;if(f.y+h<w)return b?"top-left":E?"top-right":"top";if(f.y>t.transform.height-w){if(b)return"bottom-left";if(E)return"bottom-right"}return b?"left":E?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let f=this._container;if(f||(f=this._container=oe("div","mapboxgl-popup",t.getContainer()),this._tip=oe("div","mapboxgl-popup-tip",f),f.appendChild(i)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jl(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h instanceof n.P?h:t.project(this._lngLat,this._altitude),w=Ei(this.options.offset),b=this._anchor=this._getAnchor(w.y),E=Ei(this.options.offset,b),A=_.add(E).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Go[b]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){const _=n.f4(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(is);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:hc,Style:Ks,LngLat:n.aS,LngLatBounds:n.aI,Point:n.P,MercatorCoordinate:n.ae,FreeCameraOptions:$s,Evented:n.E,config:n.e,prewarm:n.f8,clearPrewarmedResources:n.f7,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(h){n.e.ACCESS_TOKEN=h},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(h){n.e.API_URL=h},get workerCount(){return n.fh.workerCount},set workerCount(h){n.fh.workerCount=h},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){n.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){n.fg(h)},get workerUrl(){return n.ff.workerUrl},set workerUrl(h){n.ff.workerUrl=h},get workerClass(){return n.ff.workerClass},set workerClass(h){n.ff.workerClass=h},get workerParams(){return n.ff.workerParams},set workerParams(h){n.ff.workerParams=h},get dracoUrl(){return n.fe()},set dracoUrl(h){n.fd(h)},get meshoptUrl(){return n.fc()},set meshoptUrl(h){n.fb(h)},setNow:n.o.setNow,restoreNow:n.o.restoreNow}});var S=j;return S})}(Q0)),Q0.exports}var fk=hk();const Dm=ry(fk);function pN({routeStops:u,routeGeometry:o,mapboxToken:d,className:g="w-full h-64"}){const j=fe.useRef(null),Z=fe.useRef(null),[S,n]=fe.useState(!1);return fe.useEffect(()=>{if(!j.current||!d||Z.current)return;Dm.accessToken=d;const B=new Dm.LngLatBounds;return u.forEach(D=>{B.extend([D.lng,D.lat])}),Z.current=new Dm.Map({container:j.current,style:"mapbox://styles/mapbox/streets-v12",bounds:B,fitBoundsOptions:{padding:50,maxZoom:12}}),Z.current.addControl(new Dm.NavigationControl,"top-right"),Z.current.on("load",()=>{n(!0)}),()=>{Z.current?.remove(),Z.current=null}},[d,u]),fe.useEffect(()=>{if(!(!Z.current||!S)){if(o&&o.coordinates)Z.current.getSource("route")||(Z.current.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:o}}),Z.current.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2563eb","line-width":4,"line-opacity":.8}}));else{const B=u.sort((D,P)=>D.stop_order-P.stop_order).map(D=>[D.lng,D.lat]);Z.current.getSource("route")||(Z.current.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:B}}}),Z.current.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2563eb","line-width":4,"line-opacity":.6,"line-dasharray":[2,2]}}))}u.sort((B,D)=>B.stop_order-D.stop_order).forEach((B,D)=>{const P=document.createElement("div");P.className="route-marker",P.style.width="32px",P.style.height="32px",P.style.borderRadius="50%",P.style.border="3px solid white",P.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",P.style.cursor="pointer",P.style.display="flex",P.style.alignItems="center",P.style.justifyContent="center",P.style.fontSize="12px",P.style.fontWeight="bold",P.style.color="white",D===0?(P.style.backgroundColor="#10b981",P.innerHTML=""):D===u.length-1?(P.style.backgroundColor="#ef4444",P.innerHTML=""):(P.style.backgroundColor="#2563eb",P.innerHTML=(D+1).toString());const G=new Dm.Popup({offset:25}).setHTML(`
          <div style="padding: 8px; min-width: 150px;">
            <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
              ${B.name||B.address}
            </div>
            ${B.estimated_arrival?`
              <div style="font-size: 12px; color: #6b7280;">
                ETA: ${B.estimated_arrival}
              </div>
            `:""}
          </div>
        `);new Dm.Marker(P).setLngLat([B.lng,B.lat]).setPopup(G).addTo(Z.current)})}},[S,u,o]),l.jsx("div",{className:`${g} rounded-xl overflow-hidden border border-gray-200 shadow-sm`,"data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL1JvdXRlTWFwUHJldmlldy50c3hAMTk2OjQ","data-yw-s":!0,children:l.jsx("div",{ref:j,className:"w-full h-full","data-yw":"c3JjL2NvbXBvbmVudHMvbWFwL1JvdXRlTWFwUHJldmlldy50c3hAMTk3OjY","data-yw-s":!0})})}function Fw(u,o,d=new Date,g="passenger"){const Z=(u.getTime()-d.getTime())/(1e3*60*60);let S=!1,n=0,B=0,D=0;return g==="driver"||Z>=24?(S=!0,n=100,B=o,D=0):Z>=12?(S=!0,n=50,B=Math.round(o*.5*100)/100,D=Math.round(o*.5*100)/100):(S=!1,n=0,B=0,D=o),{refundEligible:S,refundPercentage:n,refundAmount:B,cancellationFee:D,hoursBeforeDeparture:Math.round(Z*100)/100}}function mN(u){const o=u.date,d=u.time;if(!o||!d)throw new Error("Ride date or time is missing");const g=new Date(`${o}T${d}`);if(isNaN(g.getTime()))throw new Error("Invalid ride date or time format");return g}async function pk(u){try{const{rideId:o,cancelledBy:d,cancelledByRole:g,reason:j}=u,{data:Z,error:S}=await It.from("rides").select("*").eq("id",o).single();if(S||!Z)return{success:!1,refundEligible:!1,refundPercentage:0,refundAmount:0,cancellationFee:0,message:"Ride not found",error:S?.message};if(Z.status==="cancelled")return{success:!1,refundEligible:!1,refundPercentage:0,refundAmount:0,cancellationFee:0,message:"Ride is already cancelled"};if(Z.status==="completed")return{success:!1,refundEligible:!1,refundPercentage:0,refundAmount:0,cancellationFee:0,message:"Cannot cancel a completed ride"};const n=mN(Z),B=new Date,{data:D,error:P}=await It.from("ride_requests").select("*, profiles!ride_requests_passenger_id_fkey(*)").eq("ride_id",o).eq("status","accepted");P&&console.error("Error fetching bookings:",P);const G=Z.price_per_seat||0,Y=Fw(n,G,B,g),{data:X,error:ue}=await It.from("ride_cancellations").insert({ride_id:o,cancelled_by:d,cancelled_by_role:g,cancellation_reason:j||null,cancellation_timestamp:B.toISOString(),ride_departure_time:n.toISOString(),hours_before_departure:Y.hoursBeforeDeparture,refund_eligible:Y.refundEligible,refund_percentage:Y.refundPercentage,original_amount:G,refund_amount:Y.refundAmount,cancellation_fee:Y.cancellationFee,status:"pending"}).select().single();if(ue||!X)return{success:!1,refundEligible:Y.refundEligible,refundPercentage:Y.refundPercentage,refundAmount:Y.refundAmount,cancellationFee:Y.cancellationFee,message:"Failed to create cancellation record",error:ue?.message};const{error:oe}=await It.from("rides").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("id",o);if(oe&&console.error("Error updating ride status:",oe),D&&D.length>0){const{error:pe}=await It.from("ride_requests").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("ride_id",o).in("status",["pending","accepted"]);pe&&console.error("Error updating bookings:",pe);for(const ve of D){const ke=Number(ve.price_per_seat)||G,ye=ke*(ve.requested_seats||1),$e=Fw(n,ke,B,g),De=$e.refundAmount*(ve.requested_seats||1),Te=$e.cancellationFee*(ve.requested_seats||1),Qe=await RI(ve.id);if(Qe){const Ft=await AI(Qe.id,n,g,j||"Ride cancelled");Ft.success?console.log(` Payment ${Ft.refundPercentage}% refunded for booking ${ve.id}`):console.error(` Payment refund failed for booking ${ve.id}:`,Ft.error)}$e.refundEligible&&De>0&&await It.from("refund_transactions").insert({cancellation_id:X.id,ride_id:o,user_id:ve.passenger_id,refund_amount:De,refund_method:"original_payment_method",transaction_status:"pending"}),await n_({userId:ve.passenger_id,type:"cancellation",title:"Ride Cancelled",message:$e.refundEligible&&De>0?g==="driver"?`Driver cancelled your ride. You will receive a ${$e.refundPercentage}% refund ($${De.toFixed(2)}).`:`Your ride has been cancelled. Refund: $${De.toFixed(2)} (${$e.refundPercentage}%)`:g==="driver"?"Driver cancelled your ride. You will receive a full refund.":`Your ride has been cancelled. No refund available (cancelled ${$e.hoursBeforeDeparture.toFixed(1)} hours before departure).`,rideId:o,senderId:d,metadata:{refund_amount:De,refund_percentage:$e.refundPercentage,cancellation_fee:Te,booking_amount:ye},actionUrl:"/rider/rides"})}}return await mk(X.id,d,"cancellation_confirmed",{ride_id:o,refund_eligible:Y.refundEligible,refund_percentage:Y.refundPercentage,refund_amount:Y.refundAmount,cancellation_fee:Y.cancellationFee,hours_before_departure:Y.hoursBeforeDeparture,cancelled_by_role:g}),{success:!0,cancellationId:X.id,refundEligible:Y.refundEligible,refundPercentage:Y.refundPercentage,refundAmount:Y.refundAmount,cancellationFee:Y.cancellationFee,message:Y.refundEligible?`Cancellation successful. ${Y.refundPercentage}% refund (${Y.refundAmount.toFixed(2)}) will be processed.`:"Cancellation successful. No refund available due to late cancellation."}}catch(o){return console.error("Error cancelling ride:",o),{success:!1,refundEligible:!1,refundPercentage:0,refundAmount:0,cancellationFee:0,message:"Failed to cancel ride",error:o.message}}}async function mk(u,o,d,g){try{const Z={cancellation_confirmed:{title:"Ride Cancelled",message:g?.refund_eligible?g.cancelled_by_role==="driver"?`Ride cancelled by driver. You will receive a full refund ($${g.refund_amount.toFixed(2)}).`:`Your ride has been cancelled. ${g.refund_percentage}% refund ($${g.refund_amount.toFixed(2)}) will be processed.`:"Your ride has been cancelled. No refund available due to late cancellation (less than 12 hours notice).",type:"cancellation"},refund_initiated:{title:"Refund Processing",message:"Your refund is being processed and will be credited to your account soon.",type:"refund_processed"},refund_completed:{title:"Refund Completed",message:"Your refund has been successfully processed and credited to your account.",type:"refund_processed"},refund_failed:{title:"Refund Failed",message:"There was an issue processing your refund. Please contact support.",type:"refund_processed"}}[d];if(!Z){console.error("Unknown notification type:",d);return}await It.from("notifications").insert({user_id:o,type:Z.type,title:Z.title,message:Z.message,ride_id:g?.ride_id||null,metadata:{cancellation_id:u,notification_subtype:d,refund_details:g?{refund_eligible:g.refund_eligible,refund_percentage:g.refund_percentage,refund_amount:g.refund_amount,cancellation_fee:g.cancellation_fee,hours_before_departure:g.hours_before_departure}:null},is_read:!1,action_url:g?.ride_id?`/ride/${g.ride_id}`:null}),await It.from("cancellation_notifications").insert({cancellation_id:u,user_id:o,notification_type:d,notification_channel:"in_app",sent:!0,sent_at:new Date().toISOString()})}catch(j){console.error("Error creating notification:",j)}}async function yk(u){try{const{data:o,error:d}=await It.from("refund_transactions").select(`
        *,
        cancellations:cancellation_id (
          cancellation_reason,
          cancellation_timestamp,
          refund_percentage
        ),
        rides:ride_id (
          from_location,
          to_location,
          date,
          time
        )
      `).eq("user_id",u).order("created_at",{ascending:!1});return d?(console.error("Error fetching user refunds:",d),[]):o||[]}catch(o){return console.error("Error fetching user refunds:",o),[]}}async function gk(u,o="passenger",d){try{const{data:g,error:j}=await It.from("rides").select("date, time, price_per_seat").eq("id",u).single();if(j||!g)return console.error("Error fetching ride for refund estimate:",j),null;let Z=g.price_per_seat||0;if(d){const{data:n,error:B}=await It.from("ride_requests").select("price_per_seat, requested_seats").eq("id",d).single();!B&&n&&n.price_per_seat?(Z=Number(n.price_per_seat),console.log("[getRefundEstimate] Using segment price:",Z,"for booking:",d)):(console.warn("[getRefundEstimate] Could not fetch booking price, using ride price:",Z),B&&console.error("[getRefundEstimate] Booking fetch error:",B))}const S=mN(g);return Fw(S,Z,new Date,o)}catch(g){return console.error("Error calculating refund estimate:",g),null}}function yN({isOpen:u,onClose:o,rideId:d,userId:g,userRole:j,rideName:Z,bookingId:S,onCancellationSuccess:n}){const[B,D]=fe.useState("estimate"),[P,G]=fe.useState(null),[Y,X]=fe.useState(""),[ue,oe]=fe.useState(!1),[pe,ve]=fe.useState(null);fe.useEffect(()=>{u?ke():(D("estimate"),X(""),ve(null))},[u,d]);const ke=async()=>{oe(!0);try{const $e=await gk(d,j,S);G($e)}catch($e){console.error("Error loading refund estimate:",$e)}finally{oe(!1)}},ye=async()=>{D("processing"),oe(!0);try{const $e=await pk({rideId:d,cancelledBy:g,cancelledByRole:j,reason:Y||void 0,bookingId:S});ve({success:$e.success,message:$e.message}),D("result"),$e.success&&setTimeout(()=>{n(),o()},2e3)}catch($e){ve({success:!1,message:$e.message||"Failed to cancel ride"}),D("result")}finally{oe(!1)}};return u?l.jsx("div",{className:"fixed inset-0 z-50 flex items-end mobile:items-center justify-center bg-black/50 backdrop-blur-sm","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDk5OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"bg-white w-full mobile:max-w-md rounded-t-3xl mobile:rounded-2xl shadow-2xl",style:{maxHeight:"calc(100vh - env(safe-area-inset-top) - 1rem)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEwMDo2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEwODo4","data-yw-s":!0,children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEwOToxMA","data-yw-t":!0,"data-yw-s":!0,children:"Cancel Ride"}),l.jsx("button",{onClick:o,className:"p-2 rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDExMDoxMA","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5 text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDExNDoxMg","data-yw-s":!0})})]}),l.jsxs("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"70vh"},"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDExOTo4","data-yw-s":!0,children:[B==="estimate"&&l.jsxs("div",{className:"space-y-6","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyMjoxMg","data-yw-s":!0,children:[l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyMzoxNA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyNDoxNg","data-yw-s":!0,children:[l.jsx(Kc,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyNToxOA","data-yw-s":!0}),l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyNjoxOA","data-yw-s":!0,children:[l.jsxs("p",{className:"text-sm font-medium text-blue-900","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyNzoyMA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyNzo2OQ","data-yw-t":!0,"data-yw-auto":!0,children:"Cancelling: "}),Z]}),l.jsx("p",{className:"text-xs text-blue-700 mt-1","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEyODoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Review the refund policy before proceeding"})]})]})}),ue?l.jsxs("div",{className:"text-center py-8","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEzNjoxNg","data-yw-s":!0,children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mx-auto","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEzNzoxOA","data-yw-s":!0}),l.jsx("p",{className:"text-sm text-gray-600 mt-4","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDEzODoxOA","data-yw-t":!0,"data-yw-s":!0,children:"Calculating refund..."})]}):P?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE0MzoxOA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE0NDoyMA","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE0NToyMg","data-yw-t":!0,"data-yw-s":!0,children:"Time until departure"}),l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE0NjoyMg","data-yw-s":!0,children:[l.jsx(ws,{className:"w-4 h-4 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE0NzoyNA","data-yw-s":!0}),l.jsxs("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE0ODoyNA","data-yw-s":!0,children:[P.hoursBeforeDeparture.toFixed(1),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE0OTo3NA","data-yw-t":!0,"data-yw-auto":!0,children:" hours"})]})]})]}),l.jsx("div",{className:"border-t border-gray-200 pt-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE1NDoyMA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE1NToyMg","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE1NjoyNA","data-yw-t":!0,"data-yw-s":!0,children:"Refund percentage"}),l.jsxs("span",{className:`text-lg font-bold ${P.refundPercentage===100?"text-green-600":P.refundPercentage===50?"text-orange-600":"text-red-600"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE1NzoyNA","data-yw-s":!0,children:[P.refundPercentage,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE2Mjo1OQ","data-yw-t":!0,"data-yw-auto":!0,children:"%"})]})]})}),P.refundEligible?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE2OToyNA","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE3MDoyNg","data-yw-t":!0,"data-yw-s":!0,children:"Refund amount"}),l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE3MToyNg","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-4 h-4 text-green-500","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE3MjoyOA","data-yw-s":!0}),l.jsxs("span",{className:"text-lg font-bold text-green-600","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE3MzoyOA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE3Mzo3OQ","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),P.refundAmount.toFixed(2)]})]})]}),P.cancellationFee>0&&l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE4MDoyNg","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE4MToyOA","data-yw-t":!0,"data-yw-s":!0,children:"Cancellation fee"}),l.jsxs("span",{className:"text-sm font-medium text-red-600","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE4MjoyOA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE4Mjo3OQ","data-yw-t":!0,"data-yw-auto":!0,children:"-$"}),P.cancellationFee.toFixed(2)]})]})]}):l.jsxs("div",{className:"flex items-center gap-2 text-red-600 bg-red-50 rounded-lg p-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE4OToyMg","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-5 h-5 flex-shrink-0","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE5MDoyNA","data-yw-s":!0}),l.jsx("span",{className:"text-sm font-medium","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE5MToyNA","data-yw-t":!0,"data-yw-s":!0,children:"No refund available"})]})]}),l.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE5NzoxOA","data-yw-s":!0,children:[l.jsx("h4",{className:"text-sm font-semibold text-amber-900 mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDE5ODoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Cancellation Policy"}),l.jsxs("ul",{className:"text-xs text-amber-800 space-y-1","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIwMToyMA","data-yw-s":!0,children:[l.jsx("li",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIwMjoyMg","data-yw-t":!0,"data-yw-s":!0,children:" 24+ hours before: 100% refund"}),l.jsx("li",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIwMzoyMg","data-yw-t":!0,"data-yw-s":!0,children:" 12-24 hours before: 50% refund"}),l.jsx("li",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIwNDoyMg","data-yw-t":!0,"data-yw-s":!0,children:" Less than 12 hours: No refund"})]})]}),l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIwOToxOA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIxMDoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Reason for cancellation (optional)"}),l.jsx("textarea",{value:Y,onChange:$e=>X($e.target.value),placeholder:"Let us know why you're cancelling...",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIxMzoyMA","data-yw-s":!0})]}),l.jsxs("div",{className:"flex gap-3 pt-4","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIyMzoxOA","data-yw-s":!0,children:[l.jsx("button",{onClick:o,className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 active:bg-gray-300 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIyNDoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Keep Ride"}),l.jsx("button",{onClick:()=>D("confirm"),className:"flex-1 px-6 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 active:bg-red-700 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIzMDoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Cancel Ride"})]})]}):l.jsxs("div",{className:"text-center py-8","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDIzOToxNg","data-yw-s":!0,children:[l.jsx(Kc,{className:"w-12 h-12 text-red-500 mx-auto mb-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI0MDoxOA","data-yw-s":!0}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI0MToxOA","data-yw-t":!0,"data-yw-s":!0,children:"Unable to calculate refund"})]})]}),B==="confirm"&&l.jsxs("div",{className:"space-y-6","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI0OToxMg","data-yw-s":!0,children:[l.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI1MDoxNA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI1MToxNg","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI1MjoxOA","data-yw-s":!0}),l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI1MzoxOA","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-red-900","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI1NDoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Confirm Cancellation"}),l.jsx("p",{className:"text-xs text-red-700 mt-1","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI1NToyMA","data-yw-t":!0,"data-yw-s":!0,children:"This action cannot be undone. Are you sure you want to cancel this ride?"})]})]})}),l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI2MjoxNA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>D("estimate"),className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 active:bg-gray-300 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI2MzoxNg","data-yw-t":!0,"data-yw-s":!0,children:"Go Back"}),l.jsx("button",{onClick:ye,className:"flex-1 px-6 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 active:bg-red-700 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI2OToxNg","data-yw-t":!0,"data-yw-s":!0,children:"Confirm Cancellation"})]})]}),B==="processing"&&l.jsxs("div",{className:"text-center py-8","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI4MToxMg","data-yw-s":!0,children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mx-auto","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI4MjoxNA","data-yw-s":!0}),l.jsx("p",{className:"text-sm text-gray-600 mt-4 font-medium","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI4MzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Processing cancellation..."}),l.jsx("p",{className:"text-xs text-gray-500 mt-2","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI4NDoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Please wait"})]}),B==="result"&&pe&&l.jsxs("div",{className:"space-y-6","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI5MDoxMg","data-yw-s":!0,children:[l.jsx("div",{className:`${pe.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"} border rounded-xl p-4`,"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI5MToxNA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDI5ODoxNg","data-yw-s":!0,children:[pe.success?l.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMwMDoyMA","data-yw-s":!0,children:l.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMwMToyMg","data-yw-s":!0,children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMwNzoyNA","data-yw-s":!0})})}):l.jsx(Kc,{className:"w-10 h-10 text-red-600 flex-shrink-0","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMxNjoyMA","data-yw-s":!0}),l.jsxs("div",{"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMxODoxOA","data-yw-s":!0,children:[l.jsx("p",{className:`text-sm font-medium ${pe.success?"text-green-900":"text-red-900"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMxOToyMA","data-yw-s":!0,children:pe.success?"Cancellation Successful":"Cancellation Failed"}),l.jsx("p",{className:`text-xs mt-1 ${pe.success?"text-green-700":"text-red-700"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMyNDoyMA","data-yw-s":!0,children:pe.message})]})]})}),pe.success&&l.jsx("p",{className:"text-center text-xs text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDMzNDoxNg","data-yw-t":!0,"data-yw-s":!0,children:"Closing automatically..."}),!pe.success&&l.jsx("button",{onClick:o,className:"w-full px-6 py-3 bg-gray-900 text-white rounded-xl font-medium hover:bg-gray-800 active:bg-gray-700 transition-colors","data-yw":"c3JjL2NvbXBvbmVudHMvQ2FuY2VsbGF0aW9uTW9kYWwudHN4QDM0MDoxNg","data-yw-t":!0,"data-yw-s":!0,children:"Close"})]})]})]})}):null}async function xv(u,o,d,g,j){try{const Z=`route_${u}_${o}_${d}_${g}`,S=sessionStorage.getItem(Z);if(S)try{const ke=JSON.parse(S);return console.log(" Using cached route data"),ke}catch{console.warn("Failed to parse cached route data, fetching fresh data")}const B=`https://api.mapbox.com/directions/v5/mapbox/driving/${`${o},${u};${g},${d}`}?access_token=${j}&geometries=geojson&overview=full`;console.log(" Fetching route from Mapbox Directions API...");const D=await fetch(B);if(!D.ok)return console.error("Mapbox API error:",D.status,D.statusText),null;const P=await D.json();if(P.code!=="Ok"||!P.routes||P.routes.length===0)return console.error("No routes found:",P.message||"Unknown error"),null;const G=P.routes[0],Y=G.distance/1e3,X=Math.round(G.duration/60),ue=new Date,oe=new Date(ue.getTime()+G.duration*1e3),pe=`${oe.getHours().toString().padStart(2,"0")}:${oe.getMinutes().toString().padStart(2,"0")}`,ve={distance:parseFloat(Y.toFixed(1)),duration:X,eta:pe,rawDistance:G.distance,rawDuration:G.duration};try{sessionStorage.setItem(Z,JSON.stringify(ve)),console.log(" Route data cached")}catch(ke){console.warn("Failed to cache route data:",ke)}return console.log(" Route calculated:",ve),ve}catch(Z){return console.error("Error calculating route:",Z),null}}function wv(u){return u<1?`${Math.round(u*1e3)} m`:`${u.toFixed(1)} km`}function l_(u){const o=Math.floor(u/60),d=u%60;return o===0?`${d} min`:`${o}h ${d}m`}async function vv(u,o,d){try{if(!u||u.length<2)return console.error("At least 2 stops required for route calculation"),null;const g=[...u].sort((ue,oe)=>ue.stop_order-oe.stop_order),j=typeof o=="string"?new Date(o):o,S=`https://api.mapbox.com/directions/v5/mapbox/driving/${g.map(ue=>`${ue.lng},${ue.lat}`).join(";")}?access_token=${d}&geometries=geojson&overview=full&steps=true`;console.log(" Fetching multi-stop route from Mapbox Directions API..."),console.log("Stops:",g.map(ue=>ue.name||ue.address));const n=await fetch(S);if(!n.ok)return console.error("Mapbox API error:",n.status,n.statusText),null;const B=await n.json();if(B.code!=="Ok"||!B.routes||B.routes.length===0)return console.error("No routes found:",B.message||"Unknown error"),null;const D=B.routes[0],P=D.legs||[],G=g.map((ue,oe)=>{let pe=0,ve=0,ke=0,ye=0;for(let bt=0;bt<oe&&bt<P.length;bt++)pe+=P[bt].duration,ve+=P[bt].distance;oe>0&&P[oe-1]&&(ke=P[oe-1].duration,ye=P[oe-1].distance);const $e=new Date(j.getTime()+pe*1e3),De=$e.getHours().toString().padStart(2,"0"),Te=$e.getMinutes().toString().padStart(2,"0"),Qe=$e.getSeconds().toString().padStart(2,"0"),Ft=`${De}:${Te}:${Qe}`;return{id:ue.id,name:ue.name||"",address:ue.address,lat:ue.lat,lng:ue.lng,stop_order:ue.stop_order,cumulativeDuration:pe,cumulativeDistance:ve,segmentDuration:oe>0?ke:void 0,segmentDistance:oe>0?ye:void 0,eta:Ft}}),Y=D.distance/1e3,X=Math.round(D.duration/60);return console.log(" Multi-stop route calculated:"),console.log("  Total distance:",Y.toFixed(1),"km"),console.log("  Total duration:",X,"min"),G.forEach((ue,oe)=>{console.log(`  Stop ${oe+1}: ${ue.name||ue.address}`),console.log(`    ETA: ${ue.eta}`),ue.segmentDistance&&console.log(`    From previous: ${(ue.segmentDistance/1e3).toFixed(1)} km, ${Math.round(ue.segmentDuration/60)} min`)}),{stops:G,totalDistance:Y,totalDuration:X,routeGeometry:D.geometry}}catch(g){return console.error("Error calculating multi-stop route:",g),null}}function _k(u){const o=Math.floor(u/3600),d=Math.floor(u%3600/60);return o===0?`${d} min`:`${o}h ${d}m`}const Cm=typeof window<"u"&&window.ywConfig?.mapbox_token||"";function SL(u,o){const d=new Date,g=new Date(`${u}T${o}`);return d>=g}function zL(u,o,d){const g=new Date;if(o){const j=o.includes("T")?new Date(o):new Date(`${u}T${o}`);return g>=j}return!1}function xk(){const{rideId:u}=Qp(),o=on(),[d,g]=fe.useState(null),[j,Z]=fe.useState(null),[S,n]=fe.useState(!0),[B,D]=fe.useState([]),[P,G]=fe.useState([]),[Y,X]=fe.useState(null),[ue,oe]=fe.useState(!1),[pe,ve]=fe.useState(null),[ke,ye]=fe.useState(!1),[$e,De]=fe.useState(null);fe.useEffect(()=>{(async()=>{n(!0);const Ke=await ui();if(!Ke||Ke.userType!=="driver"){o("/auth");return}if(Z(Ke),!u){o("/driver/home");return}const st=await __(u);if(console.log("Ride data:",st),st){if(st.status==="scheduled"&&SL(st.date,st.time))await kw(st.id,{status:"ongoing"}),st.status="ongoing";else if(st.status==="ongoing"){const Lt=st.route_stops?.sort((mt,ze)=>ze.stop_order-mt.stop_order)[0]?.estimated_arrival||st.estimated_arrival;if(Lt&&zL(st.date,Lt,st.duration)){const mt=await ZL(st.id);mt.success&&(st.status="completed",console.log(` Ride completed with ${mt.earningsCreated} earnings created`))}}if(g(st),st.from_location?.lat&&st.from_location?.lng&&st.to_location?.lat&&st.to_location?.lng&&Cm){ye(!0);const qt=await xv(st.from_location.lat,st.from_location.lng,st.to_location.lat,st.to_location.lng,Cm);qt?ve(qt):console.warn("Failed to calculate route, using database values as fallback"),ye(!1)}if(st.route_stops&&st.route_stops.length>=2&&Cm){ye(!0);const qt=new Date(`${st.date}T${st.time}`),Lt=await vv(st.route_stops,qt,Cm);Lt?(De(Lt),console.log(" Multi-stop route calculated with accurate road-based ETAs")):console.warn("Failed to calculate multi-stop route, using database values as fallback"),ye(!1)}const ht=await qx(u);D(ht);const Wt=await Kx(u);G(Wt)}else o("/driver/trips");n(!1)})()},[u,o]),fe.useEffect(()=>{if(!d||d.status!=="scheduled"&&d.status!=="ongoing")return;const yt=setInterval(()=>{if(d.status==="scheduled"&&SL(d.date,d.time))kw(d.id,{status:"ongoing"}),g({...d,status:"ongoing"});else if(d.status==="ongoing"){const st=d.route_stops?.sort((ht,Wt)=>Wt.stop_order-ht.stop_order)[0]?.estimated_arrival||d.estimated_arrival;st&&zL(d.date,st,d.duration)&&ZL(d.id).then(ht=>{ht.success&&(g({...d,status:"completed"}),console.log(` Ride completed with ${ht.earningsCreated} earnings created`))})}},6e4);return()=>clearInterval(yt)},[d]);const Te=()=>{o(`/driver/edit-ride/${u}`)},Qe=async(yt,Ke,st)=>{X(yt),un("medium");try{if(await dg(yt,"accepted")){if(await i_(yt,Ke,st),u){const Wt=await qx(u);D(Wt);const qt=await Kx(u);G(qt)}un("success"),alert("Request accepted successfully!")}else alert("Failed to accept request. Please try again.")}catch(ht){console.error("Error accepting request:",ht),alert("An error occurred while accepting the request.")}finally{X(null)}},Ft=async yt=>{if(window.confirm("Are you sure you want to decline this request?")){X(yt),un("light");try{if(await dg(yt,"rejected")){if(u){const st=await qx(u);D(st)}un("light")}else alert("Failed to decline request. Please try again.")}catch(Ke){console.error("Error declining request:",Ke),alert("An error occurred while declining the request.")}finally{X(null)}}},bt=async yt=>{if(window.confirm("Are you sure you want to cancel this accepted passenger?")){X(yt),un("light");try{if(await dg(yt,"cancelled")){if(u){const st=await Kx(u);G(st)}un("light"),alert("Passenger cancelled successfully.")}else alert("Failed to cancel passenger. Please try again.")}catch(Ke){console.error("Error cancelling passenger:",Ke),alert("An error occurred while cancelling the passenger.")}finally{X(null)}}},Qt=async yt=>{un("light");try{await i_(yt.id,j.id,yt.passenger_id)?o(`/driver/chat/${yt.id}`):alert("Failed to open chat. Please try again.")}catch(Ke){console.error("Error opening chat:",Ke),alert("An error occurred while opening the chat.")}},Gt=yt=>{switch(yt){case"scheduled":return"bg-blue-100 text-blue-800 border-blue-300";case"ongoing":return"bg-green-100 text-green-800 border-green-300";case"completed":return"bg-gray-100 text-gray-800 border-gray-300";case"cancelled":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}};return S?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzMxOjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzMyOjg","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzMzOjEw","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzM0OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading ride details..."})]})}):d?l.jsxs("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzQ1OjQ","data-yw-s":!0,children:[l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzQ2OjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzU0Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzU1OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>o(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzU2OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzYwOjE0","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzYyOjEy","data-yw-s":!0,children:[l.jsx("h1",{className:"text-xl font-semibold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzYzOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Ride Details"}),l.jsxs("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzY0OjE0","data-yw-s":!0,children:[d.date,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzY0OjYy","data-yw-t":!0,"data-yw-auto":!0,children:" at "}),Cl(d.time)]})]}),l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${Gt(d.status)}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzY2OjEy","data-yw-s":!0,children:d.status.charAt(0).toUpperCase()+d.status.slice(1)})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzczOjg","data-yw-s":!0,children:[(pe||ke)&&l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzc2OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzc3OjE0","data-yw-s":!0,children:[l.jsx(Xp,{className:"w-4 h-4 text-blue-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzc4OjE2","data-yw-s":!0}),l.jsx("h2",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzc5OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Live Route Data"})]}),ke?l.jsxs("div",{className:"flex items-center justify-center py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzgzOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzg0OjE4","data-yw-s":!0}),l.jsx("span",{className:"ml-2 text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzg1OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Calculating route..."})]}):pe?l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzg4OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzg5OjE4","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzkwOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Distance"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzkxOjIw","data-yw-s":!0,children:wv(pe.distance)})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzkzOjE4","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzk0OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Duration"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzk1OjIw","data-yw-s":!0,children:l_(pe.duration)})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzk3OjE4","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzk4OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Current ETA"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hAMzk5OjIw","data-yw-s":!0,children:pe.eta})]}),l.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDAxOjE4","data-yw-s":!0,children:l.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDAyOjIw","data-yw-s":!0,children:[l.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDAzOjIy","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDAzOjk0","data-yw-t":!0,"data-yw-auto":!0,children:"Real-time road data via Mapbox"})]})})]}):null]}),d.route_stops&&d.route_stops.length>0&&Cm?l.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 p-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDE0OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDE1OjE0","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm font-medium text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDE2OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Route Preview"}),l.jsxs("div",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDE3OjE2","data-yw-s":!0,children:[d.route_stops.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDE4OjQz","data-yw-t":!0,"data-yw-auto":!0,children:" stops"})]})]}),l.jsx(pN,{routeStops:$e?.stops||d.route_stops,routeGeometry:$e?.routeGeometry||d.route_data?.routes?.[0]?.geometry,mapboxToken:Cm,className:"w-full h-64","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDIxOjE0","data-yw-s":!0})]}):null,d.route_stops&&d.route_stops.length>0?l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDMxOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDMyOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDMzOjE2","data-yw-s":!0,children:[l.jsx("h2",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDM0OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Route & Stops"}),ke&&l.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDM2OjIw","data-yw-s":!0})]}),l.jsxs("span",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDM5OjE2","data-yw-s":!0,children:[d.route_stops.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDM5Ojgx","data-yw-t":!0,"data-yw-auto":!0,children:" stops"})]})]}),$e&&l.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg border border-blue-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDQzOjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDQ0OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDQ1OjIw","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDQ2OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Real-time road-based route via Mapbox"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDQ4OjE4","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDQ5OjIw","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDUwOjIy","data-yw-t":!0,"data-yw-s":!0,children:"Total Distance:"}),l.jsxs("span",{className:"ml-1 font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDUxOjIy","data-yw-s":!0,children:[$e.totalDistance.toFixed(1),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDUxOjExNg","data-yw-t":!0,"data-yw-auto":!0,children:" km"})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDUzOjIw","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDU0OjIy","data-yw-t":!0,"data-yw-s":!0,children:"Total Duration:"}),l.jsx("span",{className:"ml-1 font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDU1OjIy","data-yw-s":!0,children:l_($e.totalDuration)})]})]})]}),l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDYxOjE0","data-yw-s":!0,children:($e?.stops||d.route_stops).sort((yt,Ke)=>yt.stop_order-Ke.stop_order).map((yt,Ke)=>{const st=$e?.stops?.length||d.route_stops.length;return l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDY3OjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex flex-col items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDY4OjI0","data-yw-s":!0,children:[l.jsx("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${Ke===0?"bg-green-600":Ke===st-1?"bg-red-600":"bg-blue-600"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDY5OjI2","data-yw-s":!0,children:l.jsx("div",{className:"w-2 h-2 bg-white rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDc0OjI4","data-yw-s":!0})}),Ke<st-1&&l.jsx("div",{className:"w-0.5 h-16 bg-gray-300 my-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDc3OjI4","data-yw-s":!0})]}),l.jsx("div",{className:"flex-1 pb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDgwOjI0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDgxOjI2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDgyOjI4","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDgzOjMw","data-yw-s":!0,children:yt.name||yt.address}),l.jsxs("div",{className:"mt-1 space-y-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDg0OjMw","data-yw-s":!0,children:[yt.eta&&l.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDg3OjM0","data-yw-s":!0,children:[l.jsx(ws,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDg4OjM2","data-yw-s":!0}),l.jsxs("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDg5OjM2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDg5OjY2","data-yw-t":!0,"data-yw-auto":!0,children:"ETA: "}),yt.eta]})]}),yt.segmentDistance&&yt.segmentDuration&&l.jsxs("div",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDk0OjM0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDk0Ojcz","data-yw-t":!0,"data-yw-auto":!0,children:" "}),(yt.segmentDistance/1e3).toFixed(1),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANDk1Ojgw","data-yw-t":!0,"data-yw-auto":!0,children:" km, "}),_k(yt.segmentDuration)]})]})]}),Ke===0&&l.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full ml-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTAxOjMw","data-yw-t":!0,"data-yw-s":!0,children:"Start"}),Ke===st-1&&l.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full ml-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTA0OjMw","data-yw-t":!0,"data-yw-s":!0,children:"End"})]})})]},yt.id)})})]}):null,(!d.route_stops||d.route_stops.length===0)&&l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTE3OjEy","data-yw-s":!0,children:[l.jsx("h2",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTE4OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Route"}),l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTIwOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTIxOjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex flex-col items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTIyOjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-4 h-4 rounded-full bg-green-600 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTIzOjIw","data-yw-s":!0,children:l.jsx("div",{className:"w-2 h-2 bg-white rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTI0OjIy","data-yw-s":!0})}),l.jsx("div",{className:"w-0.5 h-12 bg-gray-300 my-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTI2OjIw","data-yw-s":!0})]}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTI4OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTI5OjIw","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTMwOjIy","data-yw-t":!0,"data-yw-s":!0,children:"Pick-up"}),l.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTMxOjIy","data-yw-t":!0,"data-yw-s":!0,children:"Start"})]}),l.jsx("div",{className:"text-sm text-gray-600 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTMzOjIw","data-yw-s":!0,children:d.from_location?.address||"N/A"}),d.time&&l.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTM1OjIy","data-yw-s":!0,children:[l.jsx(ws,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTM2OjI0","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTM3OjI0","data-yw-s":!0,children:Cl(d.time)})]})]})]}),l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTQzOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"flex flex-col items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTQ0OjE4","data-yw-s":!0,children:l.jsx("div",{className:"w-4 h-4 rounded-full bg-red-600 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTQ1OjIw","data-yw-s":!0,children:l.jsx("div",{className:"w-2 h-2 bg-white rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTQ2OjIy","data-yw-s":!0})})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTQ5OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTUwOjIw","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTUxOjIy","data-yw-t":!0,"data-yw-s":!0,children:"Drop-off"}),l.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTUyOjIy","data-yw-t":!0,"data-yw-s":!0,children:"End"})]}),l.jsx("div",{className:"text-sm text-gray-600 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTU0OjIw","data-yw-s":!0,children:d.to_location?.address||"N/A"}),d.estimated_arrival&&l.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTU2OjIy","data-yw-s":!0,children:[l.jsx(ws,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTU3OjI0","data-yw-s":!0}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTU4OjI0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTU4OjMw","data-yw-t":!0,"data-yw-auto":!0,children:"ETA: "}),d.estimated_arrival]})]})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTY4OjEw","data-yw-s":!0,children:[l.jsx("h2",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTY5OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Details"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTcxOjEy","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTcyOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTczOjE2","data-yw-s":!0,children:[l.jsx(ws,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTc0OjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTc1OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Time"})]}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTc3OjE2","data-yw-s":!0,children:Cl(d.time)})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTgwOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTgxOjE2","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTgyOjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTgzOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Seats"})]}),l.jsxs("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTg1OjE2","data-yw-s":!0,children:[d.available_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTg1Ojgx","data-yw-t":!0,"data-yw-auto":!0,children:" available"})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTg4OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTg5OjE2","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTkwOjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTkxOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Price"})]}),l.jsxs("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTkzOjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTkzOjU5","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),d.price_per_seat,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTkzOjgx","data-yw-t":!0,"data-yw-auto":!0,children:" per seat"})]})]}),d.distance&&l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTk3OjE2","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTk4OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Distance"}),l.jsxs("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTk5OjE4","data-yw-s":!0,children:[d.distance,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANTk5Ojc2","data-yw-t":!0,"data-yw-auto":!0,children:" km"})]})]}),d.duration&&l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjA0OjE2","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjA1OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Duration"}),l.jsxs("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjA2OjE4","data-yw-s":!0,children:[d.duration,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjA2Ojc2","data-yw-t":!0,"data-yw-auto":!0,children:" min"})]})]}),d.estimated_arrival&&l.jsxs("div",{className:"col-span-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjExOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjEyOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Estimated Arrival"}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjEzOjE4","data-yw-s":!0,children:d.estimated_arrival})]})]})]}),B.length>0&&l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjIxOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjIyOjE0","data-yw-s":!0,children:[l.jsx("h2",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjIzOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Pending Requests"}),l.jsxs("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjI0OjE2","data-yw-s":!0,children:[B.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjI1OjQy","data-yw-t":!0,"data-yw-auto":!0,children:" pending"})]})]}),l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjI5OjE0","data-yw-s":!0,children:B.map(yt=>l.jsxs("div",{className:"border border-gray-200 rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjMxOjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjMyOjIw","data-yw-s":!0,children:[l.jsx("img",{src:yt.passenger?.profile_image||"/assets/placeholder-avatar.jpg",alt:yt.passenger?.name,className:"w-12 h-12 rounded-full object-cover","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjMzOjIy","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjM4OjIy","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjM5OjI0","data-yw-s":!0,children:yt.passenger?.name}),l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjQwOjI0","data-yw-s":!0,children:[yt.requested_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjQxOjUx","data-yw-t":!0,"data-yw-auto":!0,children:" seat"}),yt.requested_seats>1?"s":""]}),yt.price?.[0]&&l.jsxs("div",{className:"text-sm font-medium text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjQ0OjI2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjQ0Ojc4","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),(yt.price[0].price_cents/100).toFixed(2)]})]})]}),l.jsxs("div",{className:"text-xs text-gray-600 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjUxOjIw","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjUyOjIy","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjUyOjI3","data-yw-t":!0,"data-yw-auto":!0,children:"From: "}),yt.pickup_location?.address]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjUzOjIy","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjUzOjI3","data-yw-t":!0,"data-yw-auto":!0,children:"To: "}),yt.dropoff_location?.address]})]}),l.jsxs("div",{className:"flex gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjU2OjIw","data-yw-s":!0,children:[l.jsxs("button",{onClick:()=>Qe(yt.id,j.id,yt.passenger_id),disabled:Y===yt.id,className:"flex-1 bg-green-600 text-white py-2 rounded-lg font-medium active:bg-green-700 disabled:bg-gray-300 flex items-center justify-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjU3OjIy","data-yw-s":!0,children:[l.jsx(Hp,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjYyOjI0","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjYyOjUz","data-yw-t":!0,"data-yw-auto":!0,children:"Accept"})]}),l.jsxs("button",{onClick:()=>Ft(yt.id),disabled:Y===yt.id,className:"flex-1 bg-red-50 text-red-600 py-2 rounded-lg font-medium active:bg-red-100 disabled:bg-gray-300 border border-red-200 flex items-center justify-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjY1OjIy","data-yw-s":!0,children:[l.jsx(lo,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjcwOjI0","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjcwOjQ5","data-yw-t":!0,"data-yw-auto":!0,children:"Decline"})]})]})]},yt.id))})]}),P.length>0&&l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjgyOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjgzOjE0","data-yw-s":!0,children:[l.jsx("h2",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjg0OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Passengers"}),l.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjg1OjE2","data-yw-s":!0,children:[P.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjg2OjQ1","data-yw-t":!0,"data-yw-auto":!0,children:" confirmed"})]})]}),l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjkwOjE0","data-yw-s":!0,children:P.map(yt=>l.jsxs("div",{className:"border border-green-200 bg-green-50 rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjkyOjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjkzOjIw","data-yw-s":!0,children:[l.jsx("img",{src:yt.passenger?.profile_image||"/assets/placeholder-avatar.jpg",alt:yt.passenger?.name,className:"w-12 h-12 rounded-full object-cover","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjk0OjIy","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANjk5OjIy","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzAwOjI0","data-yw-s":!0,children:yt.passenger?.name}),l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzAxOjI0","data-yw-s":!0,children:[yt.requested_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzAyOjUx","data-yw-t":!0,"data-yw-auto":!0,children:" seat"}),yt.requested_seats>1?"s":""]}),yt.price?.[0]&&l.jsxs("div",{className:"text-sm font-medium text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzA1OjI2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzA1Ojc4","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),(yt.price[0].price_cents/100).toFixed(2)]})]})]}),l.jsxs("div",{className:"flex gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzEyOjIw","data-yw-s":!0,children:[l.jsxs("button",{onClick:()=>Qt(yt),className:"flex-1 bg-blue-500 text-white py-2 rounded-lg font-medium active:bg-blue-600 flex items-center justify-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzEzOjIy","data-yw-s":!0,children:[l.jsx(eu,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzE3OjI0","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzE3OjYx","data-yw-t":!0,"data-yw-auto":!0,children:"Chat"})]}),d.status==="scheduled"&&l.jsxs("button",{onClick:()=>bt(yt.id),disabled:Y===yt.id,className:"flex-1 bg-red-50 text-red-600 py-2 rounded-lg font-medium active:bg-red-100 disabled:bg-gray-300 border border-red-200 flex items-center justify-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzIxOjI0","data-yw-s":!0,children:[l.jsx(Gp,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzI2OjI2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzI2OjU3","data-yw-t":!0,"data-yw-auto":!0,children:"Cancel"})]})]})]},yt.id))})]}),d.status==="scheduled"&&l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzM5OjEy","data-yw-s":!0,children:[l.jsxs("button",{onClick:Te,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 active:scale-98 transition-all flex items-center justify-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzQwOjE0","data-yw-s":!0,children:[l.jsx(UB,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzQ0OjE2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzQ0OjQ0","data-yw-t":!0,"data-yw-auto":!0,children:"Edit Ride"})]}),l.jsxs("button",{onClick:()=>oe(!0),className:"w-full bg-red-50 text-red-600 py-3 rounded-lg font-medium hover:bg-red-100 active:scale-98 transition-all border border-red-200 flex items-center justify-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzQ3OjE0","data-yw-s":!0,children:[l.jsx(Gp,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzUxOjE2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzUxOjQ3","data-yw-t":!0,"data-yw-auto":!0,children:"Cancel Ride"})]})]}),d.status==="ongoing"&&l.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzU5OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"text-green-800 font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzYwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Ride In Progress"}),l.jsx("div",{className:"text-green-600 text-sm mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzYxOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Will automatically complete at arrival time"})]}),d.status==="completed"&&l.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzY4OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"text-gray-800 font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzY5OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Ride Completed "}),l.jsx("div",{className:"text-gray-600 text-sm mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzcwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Earnings have been added to your account"}),l.jsx("div",{className:"text-green-600 text-xs mt-2 font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzczOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Check your Earnings page for details"})]})]})]}),j&&d&&l.jsx(yN,{isOpen:ue,onClose:()=>oe(!1),rideId:d.id,userId:j.id,userRole:"driver",rideName:`${d.from_location?.address||"Unknown"}  ${d.to_location?.address||"Unknown"}`,onCancellationSuccess:()=>{oe(!1),o("/driver/home")},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SaWRlRGV0YWlsUGFnZS50c3hANzgyOjg","data-yw-s":!0})]}):null}async function wk(){try{const{data:u,error:o}=await It.from("pricing_tiers").select("*").order("min_distance_km",{ascending:!0});return o?(Wn(o),[]):u||[]}catch(u){return console.error("Error fetching pricing tiers:",u),[]}}async function vk(u){try{const{data:o,error:d}=await It.from("pricing_tiers").select("*").lte("min_distance_km",u).or(`max_distance_km.gte.${u},max_distance_km.is.null`).single();if(d){const g=await wk();for(const j of g)if(u>=j.min_distance_km&&(j.max_distance_km===null||u<=j.max_distance_km))return j;return null}return o}catch(o){return console.error("Error fetching pricing tier for distance:",o),null}}function AL(u,o){return u<o.min_price_per_km?{valid:!1,message:`Price per km must be at least $${o.min_price_per_km.toFixed(2)}`}:u>o.max_price_per_km?{valid:!1,message:`Price per km cannot exceed $${o.max_price_per_km.toFixed(2)}`}:{valid:!0}}function bk(u,o){return Math.round(u*o*100)/100}const c_="license-photos";async function Lk(u,o,d){try{const g=Date.now(),j=u instanceof File?u.name.split(".").pop():"jpg",Z=`${o}/${d}-${g}.${j}`,{data:S,error:n}=await It.storage.from(c_).upload(Z,u,{cacheControl:"3600",upsert:!1});if(n)return console.error("Error uploading image to storage:",n),null;const{data:{publicUrl:B}}=It.storage.from(c_).getPublicUrl(S.path);return B}catch(g){return console.error("Error in uploadLicenseImage:",g),null}}async function RL(u,o,d){try{const j=await(await fetch(u)).blob();return await Lk(j,o,d)}catch(g){return console.error("Error converting data URL to blob:",g),null}}async function TL(u,o="both"){try{const{data:d,error:g}=await It.storage.from(c_).list(u);if(g)return console.error("Error listing user files:",g),!1;if(!d||d.length===0)return!0;const j=d.filter(S=>o==="both"?!0:S.name.startsWith(`${o}-`)).map(S=>`${u}/${S.name}`);if(j.length===0)return!0;const{error:Z}=await It.storage.from(c_).remove(j);return Z?(console.error("Error deleting old images:",Z),!1):!0}catch(d){return console.error("Error in deleteOldLicenseImages:",d),!1}}async function jk(u){try{const{data:o,error:d}=await It.from("driver_licenses").select("*").eq("user_id",u).single();return d?(d.code==="PGRST116"||Wn(d),null):o}catch(o){return console.error("Error fetching driver licence:",o),null}}async function VL(u){try{if(!u.licence_number||!u.licence_number.trim())return console.error("Error upserting driver licence: licence_number is required"),!1;if(!u.expiry_date||!u.expiry_date.trim())return console.error("Error upserting driver licence: expiry_date is required"),!1;let o=u.front_image_url||null,d=u.back_image_url||null;if(o&&o.startsWith("data:image")){console.log("Uploading front image to Supabase Storage..."),await TL(u.user_id,"front");const Z=await RL(o,u.user_id,"front");Z?o=Z:(console.error("Failed to upload front image, proceeding without it"),o=null)}if(d&&d.startsWith("data:image")){console.log("Uploading back image to Supabase Storage..."),await TL(u.user_id,"back");const Z=await RL(d,u.user_id,"back");Z?d=Z:(console.error("Failed to upload back image, proceeding without it"),d=null)}const g={user_id:u.user_id,licence_number:u.licence_number.trim(),expiry_date:u.expiry_date,issuing_country:u.issuing_country||null,issuing_state:u.issuing_state||null,licence_class:u.licence_class||null,front_image_url:o,back_image_url:d,is_verified:u.is_verified||!1,verification_status:u.verification_status||"pending",verification_notes:u.verification_notes||null,updated_at:new Date().toISOString()},{error:j}=await It.from("driver_licenses").upsert(g,{onConflict:"user_id"});return j?(Wn(j),!1):!0}catch(o){return console.error("Error upserting driver licence:",o),!1}}async function Zk(u){try{const{data:o,error:d}=await It.from("driver_licenses").select("is_verified").eq("user_id",u).single();return d?!1:o?.is_verified||!1}catch(o){return console.error("Error checking licence verification:",o),!1}}function Nk(u){const o=new Date(u),d=new Date,g=Math.floor((o.getTime()-d.getTime())/(1e3*60*60*24));return g<=30&&g>=0}function tw(u){return new Date(u)<new Date}function Ek(u){const o=new Date(u),d=new Date;return Math.floor((o.getTime()-d.getTime())/(1e3*60*60*24))}async function Sk(u){try{const{error:o}=await It.from("driver_licenses").update({verification_status:"pending",updated_at:new Date().toISOString()}).eq("user_id",u);return o?(Wn(o),!1):!0}catch(o){return console.error("Error submitting licence for verification:",o),!1}}async function bv(u){try{const{data:o,error:d}=await It.from("legal_documents").select("*").eq("document_type",u).eq("is_active",!0).order("effective_date",{ascending:!1}).limit(1).single();if(d){if(d.code==="PGRST116")return console.warn(`No active ${u} document found`),null;throw d}return o}catch(o){return Wn(o,`Failed to fetch ${u} document`),null}}async function zk(u,o,d,g){try{const j=navigator.userAgent,{error:Z}=await It.from("user_agreement_acceptances").upsert({user_id:u,document_id:o,document_type:d,accepted_version:g,accepted_at:new Date().toISOString(),user_agent:j},{onConflict:"user_id,document_id"});if(Z)throw Z;return!0}catch(j){return Wn(j,"Failed to record document acceptance"),!1}}async function Ak(u,o){try{const d=await bv(o);if(!d)return!1;const{data:g,error:j}=await It.from("user_agreement_acceptances").select("accepted_version").eq("user_id",u).eq("document_id",d.id).single();if(j){if(j.code==="PGRST116")return!1;throw j}return g.accepted_version===d.version}catch(d){return console.error("Error checking document acceptance:",d),!1}}async function Lv(){return bv("terms")}async function gN(){return bv("cancellation")}async function Rk(u){const o=await Lv();return o?zk(u,o.id,"terms",o.version):!1}function _N({checked:u,onChange:o,type:d="booking",className:g=""}){const j=on(),[Z,S]=fe.useState(""),[n,B]=fe.useState(""),[D,P]=fe.useState(!0);fe.useEffect(()=>{G()},[]);const G=async()=>{try{const[oe,pe]=await Promise.all([Lv(),gN()]);oe&&S(oe.version),pe&&B(pe.version)}catch(oe){console.error("Error loading terms versions:",oe)}finally{P(!1)}},Y=oe=>{oe.preventDefault(),j("/terms")},X=oe=>{oe.preventDefault(),j("/cancellation-policy")},ue=d==="booking"?"I agree to the Terms & Conditions and Cancellation Policy.":"I accept the Terms & Conditions and Cancellation Policy, and confirm all information is accurate.";return l.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-3 ${g}`,"data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hANjc6NA","data-yw-s":!0,children:[l.jsxs("label",{className:"flex items-start gap-2 cursor-pointer","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hANjg6Ng","data-yw-s":!0,children:[l.jsx("input",{type:"checkbox",checked:u,onChange:oe=>o(oe.target.checked),className:"mt-0.5 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500 flex-shrink-0","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hANjk6OA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hANzU6OA","data-yw-s":!0,children:[l.jsx("p",{className:"text-xs text-gray-700 leading-snug","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hANzY6MTA","data-yw-s":!0,children:ue}),l.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAODE6MTA","data-yw-s":!0,children:[l.jsxs("button",{onClick:Y,className:"inline-flex items-center gap-1 text-[10px] font-medium text-blue-600 hover:text-blue-700 active:text-blue-800","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAODI6MTI","data-yw-s":!0,children:[l.jsx(ey,{className:"w-3 h-3","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAODY6MTQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAODc6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Terms"}),Z&&l.jsxs("span",{className:"text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAODk6MTY","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAODk6NDg","data-yw-t":!0,"data-yw-auto":!0,children:"(v"}),Z,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAODk6NjQ","data-yw-t":!0,"data-yw-auto":!0,children:")"})]})]}),l.jsxs("button",{onClick:X,className:"inline-flex items-center gap-1 text-[10px] font-medium text-blue-600 hover:text-blue-700 active:text-blue-800","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAOTM6MTI","data-yw-s":!0,children:[l.jsx(ey,{className:"w-3 h-3","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAOTc6MTQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAOTg6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Cancellation"}),n&&l.jsxs("span",{className:"text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAMTAwOjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAMTAwOjQ4","data-yw-t":!0,"data-yw-auto":!0,children:"(v"}),n,l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAMTAwOjcx","data-yw-t":!0,"data-yw-auto":!0,children:")"})]})]})]})]})]}),!u&&l.jsx("div",{className:"mt-1.5 ml-6 text-[10px] text-orange-600 font-medium","data-yw":"c3JjL2NvbXBvbmVudHMvVGVybXNDaGVja2JveC50c3hAMTA4Ojg","data-yw-t":!0,"data-yw-s":!0,children:" Required to continue"})]})}const Tk=typeof window<"u"&&window.ywConfig?.mapbox_token||"pk.YOUR_MAPBOX_ACCESS_TOKEN_HERE",Vk=()=>{const u=on(),[o,d]=fe.useState(1),[g,j]=fe.useState(!1),[Z,S]=fe.useState(null),[n,B]=fe.useState(!1),[D,P]=fe.useState(null),[G,Y]=fe.useState(null),[X,ue]=fe.useState(.15),[oe,pe]=fe.useState(null);fe.useEffect(()=>{(async()=>{const st=await ui();if(!st||st.userType!=="driver"){u("/auth");return}if(S(st),!await Zk(st.id)){alert("You must verify your driver's licence before posting a ride."),u("/driver/license-verification");return}})()},[u]);const[ve,ke]=fe.useState({date:new Date().toISOString().split("T")[0],hour:"9",minute:"00",period:"AM",availableSeats:3,pricePerSeat:15,carMake:"",carModel:"",carYear:new Date().getFullYear(),carColor:"",licensePlate:"",music:!0,conversation:"moderate",smoking:!1,pets:!1,temperature:"moderate"}),ye=(Ke,st)=>{ke({...ve,[Ke]:st})},$e=async Ke=>{P(Ke);const st=Math.round(Ke.totalDistance/1e3),ht=await vk(st);if(Y(ht),ht){const Wt=ht.min_price_per_km;ue(Wt);const qt=bk(Wt,st);ye("pricePerSeat",Math.max(qt,5))}else{const Wt=Math.max(Ke.totalPrice,5);ye("pricePerSeat",Math.round(Wt))}},De=Ke=>{if(ye("pricePerSeat",Ke),pe(null),D&&G){const st=Math.round(D.totalDistance/1e3),ht=Ke/st;ue(ht);const Wt=AL(ht,G);Wt.valid||pe(Wt.message||"Invalid price")}},Te=()=>{if(o===1&&!D){alert("Please enter start and end locations to calculate route");return}o<3&&d(o+1)},Qe=()=>{o>1?d(o-1):u(-1)},Ft=async()=>{if(!g){alert("Please accept the ride policy to continue");return}if(!D){alert("Please calculate route first");return}if(!Z){alert("User not authenticated"),u("/auth");return}if(G){const ht=AL(X,G);if(!ht.valid){alert(ht.message),d(1);return}}let Ke=parseInt(ve.hour);ve.period==="PM"&&Ke!==12?Ke+=12:ve.period==="AM"&&Ke===12&&(Ke=0);const st=`${Ke.toString().padStart(2,"0")}:${ve.minute}`;if(!ve.date||!ve.hour){alert("Please fill in date and time"),d(1);return}if(!ve.carMake||!ve.carModel||!ve.carColor||!ve.licensePlate){alert("Please fill in all car details"),d(2);return}B(!0);try{const ht=await JI(Z.id,ve.date);if(!ht.allowed){alert(ht.message||"Daily ride limit exceeded"),B(!1);return}const Wt=await FI(Z.id,ve.date);if(!Wt.allowed){alert(Wt.message||"Monthly ride limit exceeded"),B(!1);return}const qt=Math.round(D.totalDuration/60),Lt=await OI(Z.id,ve.date,st,qt);if(Lt.hasConflict){const Ye=`${Lt.message}

Conflicting ride(s):
${Lt.conflictingRides.map((wt,Be)=>`${Be+1}. ${wt.from_location.address}  ${wt.to_location.address} at ${wt.time}`).join(`
`)}

Please choose a different time.`;alert(Ye),B(!1),d(1);return}const mt={fromLocation:{address:D.stops[0].address,lat:D.stops[0].lat,lng:D.stops[0].lng},toLocation:{address:D.stops[D.stops.length-1].address,lat:D.stops[D.stops.length-1].lat,lng:D.stops[D.stops.length-1].lng},stops:D.stops,date:ve.date,time:st,availableSeats:ve.availableSeats,pricePerSeat:ve.pricePerSeat,pricePerKm:X,distance:Math.round(D.totalDistance/1e3),duration:Math.round(D.totalDuration/60),estimatedArrival:D.stops[D.stops.length-1].estimatedArrival,routeData:D.fullRoute,ridePolicyAccepted:g};await BI(Z.id,mt)?(alert("Ride posted successfully! "),u("/driver/trips")):alert("Failed to post ride. Please try again.")}catch(ht){console.error("Error posting ride:",ht),alert("An error occurred while posting your ride. Please try again.")}finally{B(!1)}},bt=()=>l.jsx("div",{className:"flex items-center justify-center mb-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI2Nzo0","data-yw-s":!0,children:[1,2,3].map(Ke=>l.jsxs(mi.Fragment,{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI2OTo4","data-yw-s":!0,children:[l.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=Ke?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI3MDoxMA","data-yw-s":!0,children:o>Ke?l.jsx(Hd,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI3NTozNA","data-yw-s":!0}):Ke}),Ke<3&&l.jsx("div",{className:`w-16 h-1 ${o>Ke?"bg-blue-600":"bg-gray-200"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI3ODoxMg","data-yw-s":!0})]},Ke))}),Qt=()=>l.jsxs("div",{className:"space-y-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI4ODo0","data-yw-s":!0,children:[l.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI4OTo2","data-yw-t":!0,"data-yw-s":!0,children:"Route & Schedule"}),l.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI5Mjo2","data-yw-s":!0,children:l.jsx(uk,{onRouteCalculated:$e,startTime:`${parseInt(ve.hour)+(ve.period==="PM"&&parseInt(ve.hour)!==12?12:0)}:${ve.minute}`,pricePerKm:X,mapboxToken:Tk,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDI5Mzo4","data-yw-s":!0})}),l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMwMjo2","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMwMzo4","data-yw-s":!0,children:[l.jsx("span",{className:"text-2xl","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMwNDoxMA","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMwNToxMA","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-blue-900 mb-1 text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMwNjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Enter Full Addresses"}),l.jsx("p",{className:"text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMwNzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Please provide complete pickup and dropoff addresses (street name, number, city) for accurate location tracking and easier navigation."})]})]})}),G&&D&&l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMxNjo4","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMxNzoxMA","data-yw-s":!0,children:[l.jsx(Kc,{className:"w-5 h-5 text-blue-600 flex-none mt-0.5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMxODoxMg","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMxOToxMg","data-yw-s":!0,children:[l.jsxs("h4",{className:"font-semibold text-blue-900 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMyMDoxNA","data-yw-s":!0,children:[G.tier_name,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMyMTozOQ","data-yw-t":!0,"data-yw-auto":!0,children:" ("}),Math.round(D.totalDistance/1e3),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMyMTo4Nw","data-yw-t":!0,"data-yw-auto":!0,children:" km)"})]}),l.jsx("p",{className:"text-sm text-blue-800","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMyMzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Allowed price range per seat:"}),l.jsxs("p",{className:"text-lg font-bold text-blue-900 my-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMyNjoxNA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMyNjo2Ng","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),(G.min_price_per_km*Math.round(D.totalDistance/1e3)).toFixed(2),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMyNzoxMDc","data-yw-t":!0,"data-yw-auto":!0,children:" - $"}),(G.max_price_per_km*Math.round(D.totalDistance/1e3)).toFixed(2)]}),oe&&l.jsxs("p",{className:"text-sm text-red-600 mt-2 font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMzMToxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDMzMTo2OQ","data-yw-t":!0,"data-yw-auto":!0,children:" "}),oe]})]})]})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM0MTo2","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM0Mjo4","data-yw-s":!0,children:[l.jsx(bl,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM0MzoxMA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM0Mzo1NA","data-yw-t":!0,"data-yw-auto":!0,children:"Date"})]}),l.jsx("input",{type:"date",value:ve.date,onChange:Ke=>ye("date",Ke.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,min:new Date().toISOString().split("T")[0],"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM0Njo4","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM1Nzo2","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM1ODo4","data-yw-s":!0,children:[l.jsx(ws,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM1OToxMA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM1OTo1MQ","data-yw-t":!0,"data-yw-auto":!0,children:"Time"})]}),l.jsxs("div",{className:"flex gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM2Mjo4","data-yw-s":!0,children:[l.jsx("select",{value:ve.hour,onChange:Ke=>ye("hour",Ke.target.value),className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM2MzoxMA","data-yw-s":!0,children:Array.from({length:12},(Ke,st)=>st+1).map(Ke=>l.jsx("option",{value:Ke.toString(),"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM3MDoxNA","data-yw-s":!0,children:Ke},Ke))}),l.jsxs("select",{value:ve.minute,onChange:Ke=>ye("minute",Ke.target.value),className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM3NToxMA","data-yw-s":!0,children:[l.jsx("option",{value:"00","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM4MToxMg","data-yw-t":!0,"data-yw-s":!0,children:"00"}),l.jsx("option",{value:"15","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM4MjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"15"}),l.jsx("option",{value:"30","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM4MzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"30"}),l.jsx("option",{value:"45","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM4NDoxMg","data-yw-t":!0,"data-yw-s":!0,children:"45"})]}),l.jsxs("select",{value:ve.period,onChange:Ke=>ye("period",Ke.target.value),className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM4NjoxMA","data-yw-s":!0,children:[l.jsx("option",{value:"AM","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM5MjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"AM"}),l.jsx("option",{value:"PM","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM5MzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"PM"})]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDM5OTo2","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQwMDo4","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQwMToxMA","data-yw-s":!0,children:[l.jsx(Yd,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQwMjoxMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQwMjo1Mw","data-yw-t":!0,"data-yw-auto":!0,children:"Available Seats"})]}),l.jsx("input",{type:"number",value:ve.availableSeats,onChange:Ke=>ye("availableSeats",parseInt(Ke.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"7",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQwNToxMA","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQxNTo4","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQxNjoxMA","data-yw-s":!0,children:[l.jsx(Ho,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQxNzoxMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQxNzo1OA","data-yw-t":!0,"data-yw-auto":!0,children:"Price per Seat"})]}),l.jsx("input",{type:"number",value:ve.pricePerSeat,onChange:Ke=>De(parseFloat(Ke.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",step:"0.5",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQyMDoxMA","data-yw-s":!0})]})]}),D&&G&&l.jsxs("div",{className:"p-3 bg-green-50 rounded-lg text-sm text-green-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQzMzo4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQzMzo3NQ","data-yw-t":!0,"data-yw-auto":!0,children:" Suggested price range: $"}),(G.min_price_per_km*Math.round(D.totalDistance/1e3)).toFixed(2),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQzNDoxMjc","data-yw-t":!0,"data-yw-auto":!0,children:" - $"}),(G.max_price_per_km*Math.round(D.totalDistance/1e3)).toFixed(2),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQzNDoyMjE","data-yw-t":!0,"data-yw-auto":!0,children:" per seat"})]}),l.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQzOTo2","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ0MDo4","data-yw-s":!0,children:[l.jsx("span",{className:"text-2xl","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ0MToxMA","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ0MjoxMA","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-green-900 mb-1 text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ0MzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Cashless Payments Only"}),l.jsx("p",{className:"text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ0NDoxMg","data-yw-t":!0,"data-yw-s":!0,children:"All payments are processed digitally through the app. Do not accept cash from passengers."})]})]})})]}),Gt=()=>l.jsxs("div",{className:"space-y-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ1NDo0","data-yw-s":!0,children:[l.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ1NTo2","data-yw-t":!0,"data-yw-s":!0,children:"Car Details"}),l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ1Nzo2","data-yw-s":!0,children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ1ODo4","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ1OToxMA","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ2MDoxMg","data-yw-s":!0,children:[l.jsx(Wp,{className:"inline w-4 h-4 mr-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ2MToxNA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ2MTo1Mw","data-yw-t":!0,"data-yw-auto":!0,children:"Make"})]}),l.jsx("input",{type:"text",value:ve.carMake,onChange:Ke=>ye("carMake",Ke.target.value),placeholder:"Toyota",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ2NDoxMg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ3MzoxMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ3NDoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Model"}),l.jsx("input",{type:"text",value:ve.carModel,onChange:Ke=>ye("carModel",Ke.target.value),placeholder:"Camry",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ3NToxMg","data-yw-s":!0})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ4Njo4","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ4NzoxMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ4ODoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Year"}),l.jsx("input",{type:"number",value:ve.carYear,onChange:Ke=>ye("carYear",parseInt(Ke.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1990",max:new Date().getFullYear()+1,required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ4OToxMg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDQ5OToxMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUwMDoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Color"}),l.jsx("input",{type:"text",value:ve.carColor,onChange:Ke=>ye("carColor",Ke.target.value),placeholder:"Silver",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUwMToxMg","data-yw-s":!0})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUxMjo4","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUxMzoxMA","data-yw-t":!0,"data-yw-s":!0,children:"License Plate"}),l.jsx("input",{type:"text",value:ve.licensePlate,onChange:Ke=>ye("licensePlate",Ke.target.value.toUpperCase()),placeholder:"ABC 1234",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUxNDoxMA","data-yw-s":!0})]})]})]}),yt=()=>l.jsxs("div",{className:"space-y-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUyODo0","data-yw-s":!0,children:[l.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUyOTo2","data-yw-t":!0,"data-yw-s":!0,children:"Ride Preferences"}),l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUzMTo2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUzMzo4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUzNDoxMA","data-yw-s":!0,children:[l.jsx(bB,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUzNToxMg","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUzNjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Music Allowed"})]}),l.jsx("button",{onClick:()=>ye("music",!ve.music),className:`w-12 h-6 rounded-full transition-colors ${ve.music?"bg-blue-600":"bg-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDUzODoxMA","data-yw-s":!0,children:l.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform ${ve.music?"translate-x-6":"translate-x-1"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU0NDoxMg","data-yw-s":!0})})]}),l.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU1Mzo4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU1NDoxMA","data-yw-s":!0,children:[l.jsx(eu,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU1NToxMg","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU1NjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Conversation Level"})]}),l.jsx("div",{className:"grid grid-cols-3 gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU1ODoxMA","data-yw-s":!0,children:["quiet","moderate","chatty"].map(Ke=>l.jsx("button",{onClick:()=>ye("conversation",Ke),className:`py-2 px-3 rounded-lg text-sm font-medium ${ve.conversation===Ke?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU2MDoxNA","data-yw-s":!0,children:Ke.charAt(0).toUpperCase()+Ke.slice(1)},Ke))})]}),l.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU3Njo4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU3NzoxMA","data-yw-s":!0,children:[l.jsx(tI,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU3ODoxMg","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU3OToxMg","data-yw-t":!0,"data-yw-s":!0,children:"Temperature"})]}),l.jsx("div",{className:"grid grid-cols-3 gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU4MToxMA","data-yw-s":!0,children:["cool","moderate","warm"].map(Ke=>l.jsx("button",{onClick:()=>ye("temperature",Ke),className:`py-2 px-3 rounded-lg text-sm font-medium ${ve.temperature===Ke?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU4MzoxNA","data-yw-s":!0,children:Ke.charAt(0).toUpperCase()+Ke.slice(1)},Ke))})]}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDU5OTo4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYwMDoxMA","data-yw-s":!0,children:[l.jsx(PM,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYwMToxMg","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYwMjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Smoking Allowed"})]}),l.jsx("button",{onClick:()=>ye("smoking",!ve.smoking),className:`w-12 h-6 rounded-full transition-colors ${ve.smoking?"bg-blue-600":"bg-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYwNDoxMA","data-yw-s":!0,children:l.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform ${ve.smoking?"translate-x-6":"translate-x-1"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYxMDoxMg","data-yw-s":!0})})]}),l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYxOTo4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYyMDoxMA","data-yw-s":!0,children:[l.jsx(lB,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYyMToxMg","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYyMjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Pets Allowed"})]}),l.jsx("button",{onClick:()=>ye("pets",!ve.pets),className:`w-12 h-6 rounded-full transition-colors ${ve.pets?"bg-blue-600":"bg-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYyNDoxMA","data-yw-s":!0,children:l.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform ${ve.pets?"translate-x-6":"translate-x-1"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDYzMDoxMg","data-yw-s":!0})})]})]}),l.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY0MDo2","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY0MTo4","data-yw-s":!0,children:[l.jsx("span",{className:"text-2xl","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY0MjoxMA","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY0MzoxMA","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-orange-900 mb-1 text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY0NDoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Drive Safely"}),l.jsx("p",{className:"text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY0NToxMg","data-yw-t":!0,"data-yw-s":!0,children:"Follow all traffic rules, maintain safe speeds, and ensure passenger safety at all times. Your safety and theirs is our priority."})]})]})}),l.jsx("div",{className:"mt-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY1Mzo2","data-yw-s":!0,children:l.jsx(_N,{checked:g,onChange:j,type:"posting","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY1NDo4","data-yw-s":!0})})]});return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY2NDo0","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY2NTo2","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY3Mzo4","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY3NDoxMA","data-yw-s":!0,children:[l.jsx("button",{onClick:Qe,className:"p-2 hover:bg-gray-100 rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY3NToxMg","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY3NjoxNA","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-semibold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY3ODoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Post a Ride"})]})}),l.jsx("main",{className:"flex-1 overflow-y-auto px-4 py-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY4Mzo4","data-yw-s":!0,children:l.jsxs("div",{className:"max-w-mobile mx-auto","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY4NDoxMA","data-yw-s":!0,children:[bt(),o===1&&Qt(),o===2&&Gt(),o===3&&yt()]})}),l.jsx("div",{className:"flex-none p-4 bg-white border-t border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY5NDo4","data-yw-s":!0,children:l.jsxs("div",{className:"max-w-mobile mx-auto flex gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY5NToxMA","data-yw-s":!0,children:[o>1&&l.jsx("button",{onClick:Qe,className:"flex-1 py-3 px-4 bg-gray-100 text-gray-700 rounded-lg font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDY5NzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Back"}),o<3?l.jsx("button",{onClick:Te,className:"flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDcwNToxNA","data-yw-t":!0,"data-yw-s":!0,children:"Next"}):l.jsx("button",{onClick:Ft,disabled:!g||n,className:`flex-1 py-3 px-4 rounded-lg font-medium ${g&&!n?"bg-blue-600 text-white hover:bg-blue-700 active:scale-95 transition-all":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Qb3N0UmlkZVBhZ2UudHN4QDcxMjoxNA","data-yw-s":!0,children:n?"Posting...":"Post Ride"})]})})]})})};function Mk(){const u=on(),{rideRequestId:o}=Qp(),[d,g]=fe.useState(null),[j,Z]=fe.useState(null),[S,n]=fe.useState([]),[B,D]=fe.useState(""),[P,G]=fe.useState(!0),[Y,X]=fe.useState(!1),ue=fe.useRef(null),[oe,pe]=fe.useState(null),[ve,ke]=fe.useState(null);fe.useEffect(()=>{ye()},[o]),fe.useEffect(()=>{$e()},[S]),fe.useEffect(()=>{if(!j||!d)return;const Qe=d.id,Ft=j.id,bt=nN(Ft,Qt=>{n(Gt=>Gt.some(yt=>yt.id===Qt.id)?Gt:[...Gt,Qt]),Qt.sender_id!==Qe&&s_(Ft,Qe)});return()=>{bt()}},[j,d]);const ye=async()=>{try{const Qe=await ui();if(!Qe){u("/auth");return}if(g(Qe),!o){console.error("No ride request ID provided"),G(!1);return}const Ft=await yv(o);if(!Ft){console.error(`[ChatPage] Failed to load ride request: ${o}`),console.error("[ChatPage] This may be due to: invalid ID, RLS policy restrictions, or deleted record"),ke("Ride request not found. It may have been deleted or you may not have access to it."),G(!1);return}const bt=Ft.ride?.driver?.id||Ft.ride?.driver_id,Qt=Ft.passenger?.id||Ft.passenger_id;if(!bt||!Qt){console.error("Missing driver or passenger ID in booking data"),G(!1);return}const Gt=await i_(o,bt,Qt);if(!Gt){console.error("Failed to create/get conversation"),G(!1);return}Z(Gt);const yt=await aN(Gt.id);n(yt),await s_(Gt.id,Qe.id);const st=Qe.id===bt?Ft.passenger:Ft.ride?.driver;pe({id:st?.id,name:st?.name||"User",profile_image:st?.profile_image||null}),G(!1)}catch(Qe){console.error("Error loading chat:",Qe),G(!1)}},$e=()=>{ue.current?.scrollIntoView({behavior:"smooth"})},De=async()=>{if(!B.trim()||!j||!d||Y)return;X(!0),un("light");const Qe=B.trim();D("");const Ft={id:`temp-${Date.now()}`,conversation_id:j.id,sender_id:d.id,message_text:Qe,is_read:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};n(Qt=>[...Qt,Ft]);const bt=await rN(j.id,d.id,Qe);bt?(n(Qt=>{const Gt=Qt.filter(yt=>yt.id!==Ft.id);return Gt.some(yt=>yt.id===bt.id)?Gt:[...Gt,bt]}),un("success")):(n(Qt=>Qt.filter(Gt=>Gt.id!==Ft.id)),D(Qe),alert("Failed to send message. Please try again.")),X(!1)},Te=Qe=>{Qe.key==="Enter"&&!Qe.shiftKey&&(Qe.preventDefault(),De())};return P?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMTk4OjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMTk5Ojg","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjAwOjEw","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjAxOjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading chat..."})]})}):ve?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjA5OjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center px-6 max-w-md","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjEwOjg","data-yw-s":!0,children:[l.jsx("div",{className:"text-6xl mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjExOjEw","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjEyOjEw","data-yw-t":!0,"data-yw-s":!0,children:"Chat Not Available"}),l.jsx("p",{className:"text-gray-600 mb-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjEzOjEw","data-yw-s":!0,children:ve}),l.jsx("button",{onClick:()=>u("/driver/bookings"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjE0OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Back to Bookings"})]})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex flex-col","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjI2OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjI3OjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-blue-600 text-white px-4 py-3 shadow-md","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjM1Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjM2OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-blue-700 rounded-full active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjM3OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjQxOjE0","data-yw-s":!0})}),oe?.profile_image?l.jsx("img",{src:oe.profile_image,alt:oe.name,className:"w-10 h-10 rounded-full object-cover border-2 border-white","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjQ0OjE0","data-yw-s":!0}):l.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center border-2 border-white","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjUwOjE0","data-yw-s":!0,children:l.jsx("span",{className:"text-white font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjUxOjE2","data-yw-s":!0,children:oe?.name?.charAt(0)||"?"})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjU2OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjU3OjE0","data-yw-s":!0,children:oe?.name||"Chat"}),l.jsx("div",{className:"text-xs text-blue-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjU4OjE0","data-yw-s":!0,children:S.length>0?"Active":"Start conversation"})]})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjY2Ojg","data-yw-s":!0,children:[S.length===0?l.jsxs("div",{className:"text-center text-gray-500 mt-8","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjY4OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"text-4xl mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjY5OjE0","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsx("p",{className:"text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjcwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"No messages yet"}),l.jsx("p",{className:"text-xs text-gray-400 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjcxOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Send a message to start the conversation"})]}):S.map(Qe=>{const Ft=Qe.sender_id===d?.id;return l.jsx("div",{className:`flex ${Ft?"justify-end":"justify-start"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjc5OjE2","data-yw-s":!0,children:l.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-2 ${Ft?"bg-blue-600 text-white":"bg-white text-gray-900 border border-gray-200"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjgzOjE4","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm leading-relaxed break-words","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjkwOjIw","data-yw-s":!0,children:Qe.message_text}),l.jsx("div",{className:`text-xs mt-1 ${Ft?"text-blue-100":"text-gray-500"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMjkzOjIw","data-yw-s":!0,children:new Date(Qe.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},Qe.id)}),l.jsx("div",{ref:ue,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMzA4OjEw","data-yw-s":!0})]}),l.jsx("div",{className:"flex-none bg-white border-t border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMzEyOjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-end gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMzEzOjEw","data-yw-s":!0,children:[l.jsx("textarea",{value:B,onChange:Qe=>D(Qe.target.value),onKeyPress:Te,placeholder:"Type a message...",className:"flex-1 bg-gray-100 rounded-2xl px-4 py-3 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-600 min-h-[44px] max-h-32",rows:1,style:{height:"auto"},onInput:Qe=>{const Ft=Qe.target;Ft.style.height="auto",Ft.style.height=`${Math.min(Ft.scrollHeight,128)}px`},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMzE0OjEy","data-yw-s":!0}),l.jsx("button",{onClick:De,disabled:!B.trim()||Y,className:`flex-none p-3 rounded-full transition-all active:scale-95 ${B.trim()&&!Y?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMzI4OjEy","data-yw-s":!0,children:l.jsx(y_,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0UGFnZS50c3hAMzM3OjE0","data-yw-s":!0})})]})})]})})}function Bk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState([]),[Z,S]=fe.useState(!0);fe.useEffect(()=>{n()},[]);const n=async()=>{const P=await ui();if(!P||P.userType!=="driver"){u("/auth");return}d(P),await B(P.id),S(!1)},B=async P=>{try{const G=await iN(P);j(G)}catch(G){console.error("Error loading conversations:",G)}},D=P=>{const G=new Date(P),X=new Date().getTime()-G.getTime(),ue=Math.floor(X/6e4),oe=Math.floor(X/36e5),pe=Math.floor(X/864e5);return ue<1?"Just now":ue<60?`${ue}m ago`:oe<24?`${oe}h ago`:pe<7?`${pe}d ago`:G.toLocaleDateString()};return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDY0OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDY1OjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDcyOjg","data-yw-s":!0,children:l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDczOjEw","data-yw-t":!0,"data-yw-s":!0,children:"Messages"})}),l.jsx("div",{className:"flex-1 overflow-y-auto pb-24","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDc3Ojg","data-yw-s":!0,children:Z?l.jsx("div",{className:"flex items-center justify-center py-12","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDc5OjEy","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDgwOjE0","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDgxOjE2","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDgyOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Loading conversations..."})]})}):g.length>0?l.jsx("div",{className:"divide-y divide-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDg2OjEy","data-yw-s":!0,children:g.map(P=>l.jsxs("button",{onClick:()=>u(`/driver/chat/${P.ride_request_id}`),className:"w-full bg-white hover:bg-gray-50 active:bg-gray-100 px-4 py-4 flex items-center space-x-4 transition-colors","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDg4OjE2","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDk0OjE4","data-yw-s":!0,children:P.passenger_name?.charAt(0).toUpperCase()||"P"}),l.jsxs("div",{className:"flex-1 min-w-0 text-left","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDk5OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEwMDoyMA","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 truncate","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEwMToyMg","data-yw-s":!0,children:P.passenger_name||"Passenger"}),l.jsxs("div",{className:"flex items-center space-x-2 ml-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEwNDoyMg","data-yw-s":!0,children:[P.unread_count&&P.unread_count>0&&l.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEwNjoyNg","data-yw-s":!0,children:P.unread_count>9?"9+":P.unread_count}),l.jsx(zg,{className:"w-5 h-5 text-gray-400 flex-none","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDExMDoyNA","data-yw-s":!0})]})]}),l.jsxs("div",{className:"flex items-center space-x-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDExNDoyMA","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-600 truncate flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDExNToyMg","data-yw-s":!0,children:P.last_message||"No messages yet"}),l.jsx("span",{className:"text-xs text-gray-400 flex-none","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDExODoyMg","data-yw-s":!0,children:D(P.last_message_at)})]})]})]},P.id))}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center space-y-3 shadow-sm border border-gray-100 mx-4 mt-8","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEyNzoxMg","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEyODoxNA","data-yw-s":!0,children:l.jsx(eu,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEyOToxNg","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEzMToxNA","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEzMjoxNg","data-yw-t":!0,"data-yw-s":!0,children:"No messages yet"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDEzMzoxNg","data-yw-t":!0,"data-yw-s":!0,children:"When passengers send you messages, they'll appear here"})]})]})}),l.jsx(qf,{userType:"driver","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9DaGF0TGlzdFBhZ2UudHN4QDE0Mjo4","data-yw-s":!0})]})})}async function jv(u){try{const{data:o,error:d}=await It.from("profiles").select("*").eq("id",u).single();if(d)throw d;return o}catch(o){return console.error("Error fetching user profile:",o),null}}async function u_(u,o){try{const{error:d}=await It.from("profiles").update(o).eq("id",u);if(d)throw d;return!0}catch(d){return console.error("Error updating profile:",d),!1}}async function Ik(u){try{const{count:o,error:d}=await It.from("bookings").select("*, rides!inner(driver_id)",{count:"exact",head:!0}).eq("rides.driver_id",u).eq("status","completed");if(d)throw d;return o||0}catch(o){return console.error("Error fetching driver trip count:",o),0}}function kk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!0),[Z,S]=fe.useState(!1),[n,B]=fe.useState(null),[D,P]=fe.useState(!1),[G,Y]=fe.useState(!1),[X,ue]=fe.useState(0);fe.useEffect(()=>{oe()},[]);const oe=async()=>{try{const De=await ui();if(!De){u("/auth");return}if(De.userType!=="driver"){u("/rider/home");return}const Te=await jv(De.id);if(!Te){u("/auth");return}const Qe=await Ik(De.id);ue(Qe),d(Te)}catch(De){console.error("Error loading profile:",De),u("/auth")}finally{j(!1)}},pe=()=>{Z?(B(null),S(!1)):(B(o),S(!0))},ve=async()=>{if(!(!n||!o))try{await u_(o.id,{name:n.name,phone:n.phone||null,address:n.address||null,city:n.city||null,state:n.state||null,zipcode:n.zipcode||null})?(await oe(),S(!1),B(null)):alert("Failed to update profile. Please try again.")}catch(De){console.error("Error updating profile:",De),alert("Failed to update profile. Please try again.")}},ke=async De=>{if(o){Y(!0);try{await u_(o.id,{profile_image:De})?(await oe(),P(!1)):alert("Failed to update profile photo. Please try again.")}catch(Te){console.error("Error updating profile photo:",Te),alert("Failed to update profile photo. Please try again.")}finally{Y(!1)}}},ye=async()=>{if(window.confirm("Are you sure you want to logout?"))try{Lg(),await CZ(),u("/")}catch(De){console.error("Error signing out:",De)}},$e=[{icon:vs,label:"Ratings & Reviews",path:"/driver/ratings",color:"text-yellow-600",bg:"bg-yellow-50"},{icon:Ho,label:"Earnings",path:"/driver/earnings",color:"text-green-600",bg:"bg-green-50"},{icon:Ag,label:"Payout Method",path:"/driver/payout-method",color:"text-blue-600",bg:"bg-blue-50"},{icon:uB,label:"Payout History",path:"/driver/payout-history",color:"text-purple-600",bg:"bg-purple-50"},{icon:UZ,label:"License Verification",path:"/driver/license",color:"text-indigo-600",bg:"bg-indigo-50"},{icon:Wp,label:"Vehicle Details",path:"/driver/vehicle",color:"text-gray-600",bg:"bg-gray-50"},{icon:Kc,label:"Report Issue",path:"/driver/report-issue",color:"text-orange-600",bg:"bg-orange-50"},{icon:Up,label:"SOS Emergency",path:"/driver/sos",color:"text-red-600",bg:"bg-red-50"},{icon:ey,label:"Terms & Conditions",path:"/terms",color:"text-gray-600",bg:"bg-gray-50"},{icon:GZ,label:"Cancellation Policy",path:"/cancellation-policy",color:"text-gray-600",bg:"bg-gray-50"}];return l.jsxs("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMDc6NA","data-yw-s":!0,children:[l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMDg6Ng","data-yw-s":!0,children:[g?l.jsx("div",{className:"flex-1 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMTU6MTA","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMTY6MTI","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMTc6MTQ","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMTg6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):o?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex-none bg-gradient-to-br from-blue-600 to-indigo-600 px-4 py-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMjQ6MTI","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMjU6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"relative inline-block","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMjY6MTY","data-yw-s":!0,children:[o.profile_image?l.jsx("img",{src:o.profile_image,alt:o.name,className:"w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg mx-auto","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMjg6MjA","data-yw-s":!0}):l.jsx("div",{className:"w-24 h-24 rounded-full bg-white flex items-center justify-center text-4xl font-bold text-blue-600 border-4 border-white shadow-lg mx-auto","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMzQ6MjA","data-yw-s":!0,children:o.name.charAt(0)}),l.jsx("button",{onClick:()=>P(!0),className:"absolute bottom-0 right-0 bg-blue-500 text-white p-2 rounded-full shadow-lg active:bg-blue-600 transition-colors",disabled:G,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyMzg6MTg","data-yw-s":!0,children:l.jsx(ty,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNDM6MjA","data-yw-s":!0})})]}),l.jsxs("div",{className:"text-white","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNDc6MTY","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNDg6MTg","data-yw-s":!0,children:o.name}),l.jsx("p",{className:"text-blue-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNDk6MTg","data-yw-s":!0,children:o.email}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mt-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTA6MTg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTE6MjA","data-yw-s":!0,children:[l.jsx(vs,{className:"w-4 h-4 fill-yellow-400 text-yellow-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTI6MjI","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTM6MjI","data-yw-s":!0,children:o.rating.toFixed(1)})]}),l.jsx("span",{className:"text-blue-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTU6MjA","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTY6MjA","data-yw-s":!0,children:[l.jsx(Yp,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTc6MjI","data-yw-s":!0}),l.jsxs("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTg6MjI","data-yw-s":!0,children:[X,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNTg6NzE","data-yw-t":!0,"data-yw-auto":!0,children:" trips"})]})]})]})]})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto pb-24","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNjY6MTI","data-yw-s":!0,children:l.jsxs("div",{className:"px-4 py-4 space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNjg6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNjk6MTY","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNzA6MTg","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNzE6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Personal Information"}),l.jsx("button",{onClick:pe,className:"p-2 text-blue-600 active:bg-blue-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNzI6MjA","data-yw-s":!0,children:Z?l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNzY6MzU","data-yw-s":!0}):l.jsx(ty,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyNzY6NjM","data-yw-s":!0})})]}),l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyODA6MTg","data-yw-s":!0,children:Z?l.jsxs(l.Fragment,{children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyODM6MjQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyODQ6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Full Name"}),l.jsx("input",{type:"text",value:n?.name||"",onChange:De=>B({...n,name:De.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyODU6MjY","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyOTI6MjQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyOTM6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Phone"}),l.jsx("input",{type:"tel",value:n?.phone||"",onChange:De=>B({...n,phone:De.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAyOTQ6MjY","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMDE6MjQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMDI6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Email"}),l.jsx("input",{type:"email",value:n?.email||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm bg-gray-50 text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMDM6MjY","data-yw-s":!0}),l.jsx("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMDk6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Email cannot be changed"})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMTE6MjQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMTI6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Address"}),l.jsx("input",{type:"text",value:n?.address||"",onChange:De=>B({...n,address:De.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMTM6MjY","data-yw-s":!0})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMjA6MjQ","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMjE6MjY","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMjI6Mjg","data-yw-t":!0,"data-yw-s":!0,children:"City"}),l.jsx("input",{type:"text",value:n?.city||"",onChange:De=>B({...n,city:De.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMjM6Mjg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMzA6MjY","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMzE6Mjg","data-yw-t":!0,"data-yw-s":!0,children:"ZIP Code"}),l.jsx("input",{type:"text",value:n?.zipcode||"",onChange:De=>B({...n,zipcode:De.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzMzI6Mjg","data-yw-s":!0})]})]}),l.jsxs("button",{onClick:ve,className:"w-full flex items-center justify-center gap-2 py-2.5 bg-blue-600 text-white rounded-lg font-medium active:bg-blue-700 mt-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNDA6MjQ","data-yw-s":!0,children:[l.jsx(oy,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNDQ6MjY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNDQ6NTQ","data-yw-t":!0,"data-yw-auto":!0,children:"Save Changes"})]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTA6MjQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTE6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Name"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTI6MjY","data-yw-s":!0,children:o.name})]}),l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTQ6MjQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTU6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Phone"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTY6MjY","data-yw-s":!0,children:o.phone||"Not set"})]}),l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTg6MjQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNTk6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Email"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNjA6MjY","data-yw-s":!0,children:o.email})]}),l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNjI6MjQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNjM6MjY","data-yw-t":!0,"data-yw-s":!0,children:"Address"}),l.jsx("span",{className:"text-sm font-medium text-gray-900 text-right","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNjQ6MjY","data-yw-s":!0,children:o.address||"Not set"})]}),l.jsxs("div",{className:"flex justify-between py-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNjY6MjQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNjc6MjY","data-yw-t":!0,"data-yw-s":!0,children:"City"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNjg6MjY","data-yw-s":!0,children:o.city&&o.zipcode?`${o.city}, ${o.zipcode}`:"Not set"})]})]})})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNzg6MTY","data-yw-s":!0,children:[l.jsx("div",{className:"px-4 py-3 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzNzk6MTg","data-yw-s":!0,children:l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzODA6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Quick Actions"})}),l.jsx("div",{className:"divide-y divide-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzODI6MTg","data-yw-s":!0,children:$e.map(De=>l.jsxs("button",{onClick:()=>u(De.path),className:"w-full flex items-center gap-3 px-4 py-3 active:bg-gray-50 transition-colors","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzODQ6MjI","data-yw-s":!0,children:[l.jsx("div",{className:`p-2 rounded-lg ${De.bg}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzODk6MjQ","data-yw-s":!0,children:l.jsx(De.icon,{className:`w-5 h-5 ${De.color}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzOTA6MjY","data-yw-s":!0})}),l.jsx("span",{className:"flex-1 text-left text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzOTI6MjQ","data-yw-s":!0,children:De.label}),l.jsx(zg,{className:"w-5 h-5 text-gray-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEAzOTM6MjQ","data-yw-s":!0})]},De.path))})]}),l.jsxs("button",{onClick:ye,className:"w-full flex items-center justify-center gap-2 py-3 bg-red-50 text-red-600 rounded-xl font-medium active:bg-red-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MDA6MTY","data-yw-s":!0,children:[l.jsx(WZ,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MDQ6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MDQ6NDg","data-yw-t":!0,"data-yw-auto":!0,children:"Logout"})]})]})})]}):null,l.jsx(qf,{active:"profile",userType:"driver","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MTM6OA","data-yw-s":!0})]}),D&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 px-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MTg6OA","data-yw-s":!0,children:l.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MTk6MTA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MjA6MTI","data-yw-s":!0,children:[l.jsx("h3",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MjE6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Update Profile Photo"}),l.jsx("button",{onClick:()=>P(!1),disabled:G,className:"p-1 hover:bg-gray-100 rounded-lg disabled:opacity-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MjI6MTQ","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0Mjc6MTY","data-yw-s":!0})})]}),l.jsx(hv,{currentImage:o?.profile_image||"",onImageSelect:ke,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0MzE6MTI","data-yw-s":!0}),G&&l.jsxs("div",{className:"mt-4 text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0Mzc6MTQ","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0Mzg6MTY","data-yw-s":!0}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlLnRzeEA0Mzk6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Uploading..."})]})]})})]})}function Jk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState([]),[Z,S]=fe.useState(0),[n,B]=fe.useState(!0);fe.useEffect(()=>{D()},[u]);const D=async()=>{B(!0);const X=await ui();if(!X||X.userType!=="driver"){u("/auth");return}d(X),await P(X.id),B(!1)},P=async X=>{const[ue,oe]=await Promise.all([ik(X),hN(X)]);j(ue),S(oe)},G=async()=>{o&&(B(!0),await P(o.id),B(!1))},Y=[5,4,3,2,1].map(X=>g.filter(ue=>ue.rating===X).length);return n?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANTc6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANTg6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANTk6MTA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANjA6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading ratings..."})]})}):o?l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANjk6NA","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANzA6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANzg6OA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hANzk6MTA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAODA6MTI","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAODE6MTQ","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAODU6MTY","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAODc6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Ratings & Reviews"})]}),l.jsx("button",{onClick:G,className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all",title:"Refresh ratings","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAODk6MTI","data-yw-s":!0,children:l.jsx(dv,{className:"w-5 h-5 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAOTQ6MTQ","data-yw-s":!0})})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTAwOjg","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTAyOjEw","data-yw-s":!0,children:[l.jsx("div",{className:"text-5xl font-bold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTAzOjEy","data-yw-s":!0,children:Z>0?Z.toFixed(1):"N/A"}),l.jsx("div",{className:"flex items-center justify-center space-x-1 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTA2OjEy","data-yw-s":!0,children:[1,2,3,4,5].map(X=>l.jsx(vs,{className:`w-6 h-6 ${X<=Math.round(Z)?"text-yellow-500 fill-yellow-500":"text-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTA4OjE2","data-yw-s":!0},X))}),l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTE4OjEy","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTE4OjUx","data-yw-t":!0,"data-yw-auto":!0,children:"Based on "}),g.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTE5OjM5","data-yw-t":!0,"data-yw-auto":!0,children:" review"}),g.length!==1?"s":""]}),g.length>0&&l.jsx("div",{className:"mt-6 space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTI0OjE0","data-yw-s":!0,children:[5,4,3,2,1].map((X,ue)=>l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTI2OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600 w-8 text-right","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTI3OjIw","data-yw-s":!0,children:X}),l.jsx(vs,{className:"w-4 h-4 text-yellow-500 fill-yellow-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTI4OjIw","data-yw-s":!0}),l.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 overflow-hidden","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTI5OjIw","data-yw-s":!0,children:l.jsx("div",{className:"bg-yellow-500 h-full transition-all",style:{width:`${g.length>0?Y[ue]/g.length*100:0}%`},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTMwOjIy"})}),l.jsx("div",{className:"text-sm text-gray-600 w-8","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTM1OjIw","data-yw-s":!0,children:Y[ue]})]},X))})]}),g.length>0?l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTQ0OjEy","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTQ1OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Recent Reviews"}),g.map(X=>l.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTQ4OjE2","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTQ5OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTUwOjIw","data-yw-s":!0,children:X.reviewer?.name.charAt(0)||"U"}),l.jsxs("div",{className:"flex-1 min-w-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTU0OjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTU1OjIy","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTU2OjI0","data-yw-s":!0,children:X.reviewer?.name||"Unknown User"}),l.jsx("div",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTU5OjI0","data-yw-s":!0,children:new Date(X.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),l.jsx("div",{className:"flex items-center space-x-1 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTY0OjIy","data-yw-s":!0,children:[1,2,3,4,5].map(ue=>l.jsx(vs,{className:`w-4 h-4 ${ue<=X.rating?"text-yellow-500 fill-yellow-500":"text-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTY2OjI2","data-yw-s":!0},ue))}),X.comment&&l.jsx("p",{className:"text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTc4OjI0","data-yw-s":!0,children:X.comment})]})]})},X.id))]}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTg2OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto mb-3 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTg3OjE0","data-yw-s":!0,children:l.jsx(vs,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTg4OjE2","data-yw-s":!0})}),l.jsx("div",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTkwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"No reviews yet"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SYXRpbmdzUGFnZS50c3hAMTkxOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Complete rides to start receiving reviews from passengers"})]})]})]})}):null}function Fk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState([]),[Z,S]=fe.useState("all"),[n,B]=fe.useState({totalEarnings:0,totalNetEarnings:0,totalPlatformFees:0,thisMonthEarnings:0,thisMonthNetEarnings:0,thisWeekEarnings:0,thisWeekNetEarnings:0,pendingEarnings:0,paidEarnings:0}),[D,P]=fe.useState(!0);fe.useEffect(()=>{G()},[u]);const G=async()=>{P(!0);const ue=await ui();if(!ue||ue.userType!=="driver"){u("/auth");return}d(ue),await Y(ue.id),P(!1)};fe.useEffect(()=>{o&&X(o.id)},[Z,o]);const Y=async ue=>{const oe=await bI(ue);B(oe),await X(ue)},X=async ue=>{const oe=await vI(ue,Z);j(oe)};return o?D?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDY0OjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDY1Ojg","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDY2OjEw","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDY3OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading earnings..."})]})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDc0OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDc1OjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDgzOjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDg0OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDg1OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDg5OjE0","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDkxOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Earnings"})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDk2Ojg","data-yw-s":!0,children:[l.jsxs("div",{className:"grid grid-cols-1 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDk4OjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDk5OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwMDoxNA","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm font-medium opacity-90","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwMToxNg","data-yw-t":!0,"data-yw-s":!0,children:"Total Net Earnings"}),l.jsx(Ho,{className:"w-6 h-6 opacity-90","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwMjoxNg","data-yw-s":!0})]}),l.jsxs("div",{className:"text-4xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwNDoxNA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwNDo1MA","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),n.totalNetEarnings.toFixed(2)]}),l.jsx("div",{className:"text-sm mt-1 opacity-90","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwNToxNA","data-yw-t":!0,"data-yw-s":!0,children:"After 15% platform fee"}),l.jsxs("div",{className:"text-xs mt-2 opacity-75 border-t border-white/20 pt-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwNjoxNA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwNjo4NQ","data-yw-t":!0,"data-yw-auto":!0,children:"Gross: $"}),n.totalEarnings.toFixed(2),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEwNzo1OA","data-yw-t":!0,"data-yw-auto":!0,children:"  Fee: $"}),n.totalPlatformFees.toFixed(2)]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDExMToxMg","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDExMjoxNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDExMzoxNg","data-yw-s":!0,children:[l.jsx(bl,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDExNDoxOA","data-yw-s":!0}),l.jsx("div",{className:"text-xs font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDExNToxOA","data-yw-t":!0,"data-yw-s":!0,children:"This Week"})]}),l.jsxs("div",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDExNzoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDExNzo2NQ","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),n.thisWeekNetEarnings.toFixed(2)]}),l.jsxs("div",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEyMDoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEyMDo2MA","data-yw-t":!0,"data-yw-auto":!0,children:"Gross: $"}),n.thisWeekEarnings.toFixed(2)]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEyNToxNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEyNjoxNg","data-yw-s":!0,children:[l.jsx(bl,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEyNzoxOA","data-yw-s":!0}),l.jsx("div",{className:"text-xs font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEyODoxOA","data-yw-t":!0,"data-yw-s":!0,children:"This Month"})]}),l.jsxs("div",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEzMDoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEzMDo2NQ","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),n.thisMonthNetEarnings.toFixed(2)]}),l.jsxs("div",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEzMzoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEzMzo2MA","data-yw-t":!0,"data-yw-auto":!0,children:"Gross: $"}),n.thisMonthEarnings.toFixed(2)]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEzODoxNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDEzOToxNg","data-yw-s":!0,children:[l.jsx(Yp,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE0MDoxOA","data-yw-s":!0}),l.jsx("div",{className:"text-xs font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE0MToxOA","data-yw-t":!0,"data-yw-s":!0,children:"Pending"})]}),l.jsxs("div",{className:"text-xl font-bold text-yellow-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE0MzoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE0Mzo2Nw","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),n.pendingEarnings.toFixed(2)]})]})]})]}),l.jsxs("div",{className:"flex space-x-2 bg-white rounded-lg p-1 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE1MToxMA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>S("all"),className:`flex-1 py-2 rounded-md font-medium text-sm transition-all min-h-touch ${Z==="all"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-50"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE1MjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"All"}),l.jsx("button",{onClick:()=>S("paid"),className:`flex-1 py-2 rounded-md font-medium text-sm transition-all min-h-touch ${Z==="paid"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-50"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE2MjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Paid"}),l.jsx("button",{onClick:()=>S("pending"),className:`flex-1 py-2 rounded-md font-medium text-sm transition-all min-h-touch ${Z==="pending"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-50"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE3MjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Pending"})]}),l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE4NToxMA","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE4NjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Transaction History"}),g.length>0?l.jsx("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE4OToxNA","data-yw-s":!0,children:g.map(ue=>l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE5MToxOA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE5MjoyMA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE5MzoyMg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE5NDoyNA","data-yw-s":!0,children:[l.jsxs("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE5NToyNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE5NTo3MQ","data-yw-t":!0,"data-yw-auto":!0,children:"Ride #"}),ue.ride_id.slice(0,8)]}),l.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${ue.status==="paid"?"bg-green-100 text-green-800":ue.status==="processing"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDE5NjoyNg","data-yw-s":!0,children:ue.status.charAt(0).toUpperCase()+ue.status.slice(1)})]}),l.jsx("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIwNjoyNA","data-yw-s":!0,children:new Date(ue.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsxs("div",{className:"text-right","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIxNToyMg","data-yw-s":!0,children:[l.jsxs("div",{className:"text-xl font-bold text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIxNjoyNA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIxNjo3NA","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ue.net_amount.toFixed(2)]}),l.jsx("div",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIxOToyNA","data-yw-t":!0,"data-yw-s":!0,children:"Net amount"})]})]}),l.jsxs("div",{className:"border-t border-gray-100 pt-3 space-y-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIyNDoyMA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIyNToyMg","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIyNjoyNA","data-yw-t":!0,"data-yw-s":!0,children:"Gross Amount:"}),l.jsxs("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIyNzoyNA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIyNzo2OA","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ue.amount.toFixed(2)]})]}),l.jsxs("div",{className:"flex justify-between text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIyOToyMg","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIzMDoyNA","data-yw-t":!0,"data-yw-s":!0,children:"Platform Fee (15%):"}),l.jsxs("span",{className:"font-medium text-red-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIzMToyNA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIzMTo2Nw","data-yw-t":!0,"data-yw-auto":!0,children:"-$"}),ue.platform_fee.toFixed(2)]})]}),l.jsxs("div",{className:"flex justify-between text-sm font-semibold border-t border-gray-100 pt-1 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIzMzoyMg","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIzNDoyNA","data-yw-t":!0,"data-yw-s":!0,children:"You Receive:"}),l.jsxs("span",{className:"text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIzNToyNA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDIzNTo1Nw","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ue.net_amount.toFixed(2)]})]})]})]},ue.id))}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDI0MjoxNA","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto mb-3 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDI0MzoxNg","data-yw-s":!0,children:l.jsx(Ho,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDI0NDoxOA","data-yw-s":!0})}),l.jsx("div",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDI0NjoxNg","data-yw-t":!0,"data-yw-s":!0,children:"No earnings found"}),l.jsx("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FYXJuaW5nc1BhZ2UudHN4QDI0NzoxNg","data-yw-s":!0,children:Z==="pending"?"No pending earnings":Z==="paid"?"No paid earnings yet":"Complete rides to start earning"})]})]})]})]})}):null}function Ok(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState({bankName:"",accountNumber:"",confirmAccountNumber:"",transitNumber:"",institutionNumber:"",accountHolderName:""}),[Z,S]=fe.useState(null),[n,B]=fe.useState(!0),[D,P]=fe.useState(!1);fe.useEffect(()=>{G()},[u]);const G=async()=>{B(!0);const oe=await ui();if(!oe||oe.userType!=="driver"){u("/auth");return}d(oe),await Y(oe.id),B(!1)},Y=async oe=>{const pe=await jI(oe);if(pe.length>0){const ve=pe[0];S(ve),j({bankName:ve.bank_name,accountNumber:"****"+ve.account_number,confirmAccountNumber:"****"+ve.account_number,transitNumber:ve.transit_number,institutionNumber:ve.institution_number,accountHolderName:ve.account_holder_name})}else o&&j(ve=>({...ve,accountHolderName:o.name}));B(!1)},X=oe=>{j({...g,[oe.target.name]:oe.target.value})},ue=async oe=>{if(oe.preventDefault(),g.accountNumber!==g.confirmAccountNumber){alert("Account numbers do not match");return}if(!o)return;P(!0);const pe=await ZI(o.id,{bank_name:g.bankName,account_holder_name:g.accountHolderName,institution_number:g.institutionNumber,transit_number:g.transitNumber,account_number:g.accountNumber,is_default:!0});P(!1),pe?(alert("Payout method saved successfully"),u(-1)):alert("Failed to save payout method. Please try again.")};return o?n?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEA5Nzo2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEA5ODo4","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEA5OToxMA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMDA6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading payout method..."})]})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMDc6NA","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMDg6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMTY6OA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMTc6MTA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMTg6MTI","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMjI6MTQ","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMjQ6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Payout Method"})]})}),l.jsx("form",{onSubmit:ue,className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMjk6OA","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMzA6MTA","data-yw-s":!0,children:[l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMzI6MTI","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMzM6MTQ","data-yw-s":!0,children:[l.jsx(Ag,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMzQ6MTY","data-yw-s":!0}),l.jsxs("div",{className:"text-sm text-blue-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMzU6MTY","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMzY6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Canadian Bank Account Required"}),l.jsx("div",{className:"text-blue-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxMzc6MTg","data-yw-t":!0,"data-yw-s":!0,children:"We transfer earnings directly to your Canadian bank account. Please ensure all details are accurate."})]})]})}),Z&&Z.is_verified&&l.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNDY6MTQ","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNDc6MTY","data-yw-s":!0,children:[l.jsx("div",{className:"w-5 h-5 bg-green-600 rounded-full flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNDg6MTg","data-yw-s":!0,children:l.jsx("span",{className:"text-white text-xs","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNDk6MjA","data-yw-t":!0,"data-yw-s":!0,children:""})}),l.jsx("div",{className:"text-sm text-green-900 font-semibold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNTE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Account Verified"})]})}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNTk6MTI","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNjA6MTQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNjE6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Bank Name"}),l.jsx("input",{type:"text",name:"bankName",value:g.bankName,onChange:X,placeholder:"Royal Bank of Canada",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNjQ6MTY","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNzU6MTQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNzY6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Account Holder Name"}),l.jsx("input",{type:"text",name:"accountHolderName",value:g.accountHolderName,onChange:X,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxNzk6MTY","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxODk6MTQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxOTA6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Institution Number (3 digits)"}),l.jsx("input",{type:"text",name:"institutionNumber",value:g.institutionNumber,onChange:X,placeholder:"001",maxLength:3,pattern:"[0-9]{3}",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAxOTM6MTY","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyMDY6MTQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyMDc6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Transit Number (5 digits)"}),l.jsx("input",{type:"text",name:"transitNumber",value:g.transitNumber,onChange:X,placeholder:"12345",maxLength:5,pattern:"[0-9]{5}",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyMTA6MTY","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyMjM6MTQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyMjQ6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Account Number"}),l.jsx("input",{type:"text",name:"accountNumber",value:g.accountNumber,onChange:X,placeholder:"1234567",maxLength:12,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyMjc6MTY","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyMzk6MTQ","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNDA6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Confirm Account Number"}),l.jsx("input",{type:"text",name:"confirmAccountNumber",value:g.confirmAccountNumber,onChange:X,placeholder:"Re-enter account number",maxLength:12,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNDM6MTY","data-yw-s":!0})]})]}),l.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNTc6MTI","data-yw-s":!0,children:l.jsxs("div",{className:"text-sm text-gray-600 space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNTg6MTQ","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNTk6MTY","data-yw-t":!0,"data-yw-s":!0,children:"How to find your banking details:"}),l.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNjA6MTY","data-yw-s":!0,children:[l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNjE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Check your void cheque or bank statement"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNjI6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Institution Number: First 3 digits at bottom of cheque"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNjM6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Transit Number: Next 5 digits at bottom of cheque"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNjQ6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Account Number: Remaining digits at bottom of cheque"})]})]})}),l.jsxs("button",{type:"submit",disabled:D,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 active:scale-98 transition-all shadow-md flex items-center justify-center space-x-2 min-h-touch disabled:opacity-50 disabled:cursor-not-allowed","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNzA6MTI","data-yw-s":!0,children:[l.jsx(oy,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNzU6MTQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRNZXRob2RQYWdlLnRzeEAyNzY6MTQ","data-yw-s":!0,children:D?"Saving...":Z?"Update Payout Method":"Save Payout Method"})]})]})})]})}):null}const Dk=[{id:"1",date:"2025-11-10",amount:235,status:"completed",bankAccount:"****1234",transactionId:"TXN-001234"},{id:"2",date:"2025-11-03",amount:180,status:"completed",bankAccount:"****1234",transactionId:"TXN-001123"},{id:"3",date:"2025-10-27",amount:295.5,status:"completed",bankAccount:"****1234",transactionId:"TXN-000987"},{id:"4",date:"2025-10-20",amount:210,status:"completed",bankAccount:"****1234",transactionId:"TXN-000876"},{id:"5",date:"2025-11-17",amount:150,status:"pending",bankAccount:"****1234",transactionId:"TXN-001345"}];function Ck(){const u=on(),[o,d]=fe.useState(null),[g]=fe.useState(Dk),[j,Z]=fe.useState("all"),[S,n]=fe.useState(!0);fe.useEffect(()=>{(async()=>{const Y=await ui();if(!Y||Y.userType!=="driver"){u("/driver/home");return}d(Y),n(!1)})()},[u]);const B=j==="all"?g:g.filter(G=>G.status===j),D=g.filter(G=>G.status==="completed").reduce((G,Y)=>G+Y.amount,0),P=g.filter(G=>G.status==="pending").reduce((G,Y)=>G+Y.amount,0);return S?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAODU6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAODY6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAODc6MTA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAODg6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading payout history..."})]})}):o?l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAOTc6NA","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAOTg6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTA2Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTA3OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTA4OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTEyOjE0","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTE0OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Payout History"})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTE5Ojg","data-yw-s":!0,children:[l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTIxOjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTIyOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTIzOjE0","data-yw-s":!0,children:[l.jsx(Hd,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTI0OjE2","data-yw-s":!0}),l.jsx("div",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTI1OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Total Paid"})]}),l.jsxs("div",{className:"text-2xl font-bold text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTI3OjE0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTI3OjY1","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),D.toFixed(2)]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTMyOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTMzOjE0","data-yw-s":!0,children:[l.jsx(ws,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTM0OjE2","data-yw-s":!0}),l.jsx("div",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTM1OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Pending"})]}),l.jsxs("div",{className:"text-2xl font-bold text-yellow-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTM3OjE0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTM3OjY2","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),P.toFixed(2)]})]})]}),l.jsxs("div",{className:"flex space-x-2 bg-white rounded-lg p-1 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTQ0OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>Z("all"),className:`flex-1 py-2 rounded-md font-medium text-sm transition-all min-h-touch ${j==="all"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-50"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTQ1OjEy","data-yw-t":!0,"data-yw-s":!0,children:"All"}),l.jsx("button",{onClick:()=>Z("completed"),className:`flex-1 py-2 rounded-md font-medium text-sm transition-all min-h-touch ${j==="completed"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-50"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTU1OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Completed"}),l.jsx("button",{onClick:()=>Z("pending"),className:`flex-1 py-2 rounded-md font-medium text-sm transition-all min-h-touch ${j==="pending"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-50"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTY1OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Pending"})]}),l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTc4OjEw","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTc5OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Transaction History"}),B.length>0?l.jsx("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTgyOjE0","data-yw-s":!0,children:B.map(G=>l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTg0OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start justify-between mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTg1OjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTg2OjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTg3OjI0","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTg4OjI2","data-yw-s":!0,children:new Date(G.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),l.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded-full ${G.status==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMTk1OjI2","data-yw-s":!0,children:G.status.charAt(0).toUpperCase()+G.status.slice(1)})]}),l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjAzOjI0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjAzOjYz","data-yw-t":!0,"data-yw-auto":!0,children:"Bank Account: "}),G.bankAccount]}),l.jsxs("div",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjA2OjI0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjA2OjY4","data-yw-t":!0,"data-yw-auto":!0,children:"Transaction ID: "}),G.transactionId]})]}),l.jsx("div",{className:"text-right","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjExOjIy","data-yw-s":!0,children:l.jsxs("div",{className:"text-xl font-bold text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjEyOjI0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjEyOjc0","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),G.amount.toFixed(2)]})})]}),G.status==="pending"&&l.jsx("div",{className:"text-xs text-yellow-700 bg-yellow-50 px-3 py-2 rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjE5OjIy","data-yw-t":!0,"data-yw-s":!0,children:"Processing  Estimated arrival: 2-3 business days"})]},G.id))}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjI3OjE0","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto mb-3 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjI4OjE2","data-yw-s":!0,children:l.jsx(Ho,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjI5OjE4","data-yw-s":!0})}),l.jsx("div",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjMxOjE2","data-yw-t":!0,"data-yw-s":!0,children:"No payouts found"}),l.jsx("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9QYXlvdXRIaXN0b3J5UGFnZS50c3hAMjMyOjE2","data-yw-s":!0,children:j==="pending"?"No pending payouts":"No completed payouts yet"})]})]})]})]})}):null}function Pk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(null),[Z,S]=fe.useState(!0),[n,B]=fe.useState(!1),[D,P]=fe.useState(!1),[G,Y]=fe.useState(""),[X,ue]=fe.useState(""),[oe,pe]=fe.useState(""),[ve,ke]=fe.useState(""),[ye,$e]=fe.useState(""),[De,Te]=fe.useState(""),[Qe,Ft]=fe.useState(""),[bt,Qt]=fe.useState("");fe.useEffect(()=>{Gt()},[u]);const Gt=async()=>{const Ye=await ui();if(!Ye||Ye.userType!=="driver"){u("/driver/home");return}d(Ye);const wt=await jk(Ye.id);wt?(j(wt),Y(wt.licence_number),ue(wt.expiry_date),pe(wt.issue_date||""),ke(wt.issuing_country||""),$e(wt.issuing_state||""),Te(wt.licence_class||""),Ft(wt.front_image_url||""),Qt(wt.back_image_url||"")):P(!0),S(!1)},yt=(Ye,wt)=>{if(wt.size>5*1024*1024){alert("File size must be less than 5MB");return}const Be=new FileReader;Be.onloadend=()=>{const ba=Be.result;Ye==="front"?Ft(ba):Qt(ba)},Be.readAsDataURL(wt)},Ke=async()=>{if(!o)return;if(!G.trim()){alert("Please enter your licence number");return}if(!X){alert("Please select an expiry date");return}if(tw(X)){alert("Your licence has expired. Please renew it before verifying.");return}B(!0);const Ye={user_id:o.id,licence_number:G,expiry_date:X,issue_date:oe||void 0,issuing_country:ve||void 0,issuing_state:ye||void 0,licence_class:De||void 0,front_image_url:Qe||void 0,back_image_url:bt||void 0,is_verified:!1,verification_status:g?.verification_status||"pending"};await VL(Ye)?(alert("Licence information saved successfully!"),P(!1),await Gt()):alert("Failed to save licence information. Please try again."),B(!1)},st=async()=>{if(!o)return;if(!Qe||!bt){alert("Please upload both front and back images of your licence");return}if(!G||!X){alert("Please fill in all required licence information before submitting");return}B(!0);const Ye={user_id:o.id,licence_number:G,expiry_date:X,issue_date:oe||void 0,issuing_country:ve||void 0,issuing_state:ye||void 0,licence_class:De||void 0,front_image_url:Qe,back_image_url:bt,is_verified:!1,verification_status:"pending"};await VL(Ye)?await Sk(o.id)?(alert("Licence submitted for verification! We will review it within 24-48 hours."),await Gt()):alert("Failed to submit for verification. Please try again."):alert("Failed to save licence information. Please try again."),B(!1)},ht=()=>{g&&(Y(g.licence_number),ue(g.expiry_date),pe(g.issue_date||""),ke(g.issuing_country||""),$e(g.issuing_state||""),Te(g.licence_class||""),Ft(g.front_image_url||""),Qt(g.back_image_url||""),P(!1))};if(Z)return l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMTk2OjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMTk3Ojg","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMTk4OjEw","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMTk5OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})});if(!o)return null;const Wt=g?.verification_status||"pending",qt=g?.is_verified||!1,Lt=X&&Nk(X)&&!tw(X),mt=X&&tw(X),ze=X?Ek(X):0;return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjE0OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjE1OjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjIzOjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjI0OjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjI1OjEy","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjI2OjE0","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjMwOjE2","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjMyOjE0","data-yw-t":!0,"data-yw-s":!0,children:"License Verification"})]}),!D&&g&&l.jsxs("button",{onClick:()=>P(!0),className:"flex items-center space-x-2 px-3 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjM2OjE0","data-yw-s":!0,children:[l.jsx(ty,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjQwOjE2","data-yw-s":!0}),l.jsx("span",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjQxOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Edit"})]})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 pb-24","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjQ4Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjQ5OjEw","data-yw-s":!0,children:[mt&&l.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjUyOjE0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjUzOjE2","data-yw-s":!0,children:[l.jsx(Kc,{className:"w-6 h-6 text-red-600 flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjU0OjE4","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjU1OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-red-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjU2OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Licence Expired"}),l.jsxs("div",{className:"text-sm text-red-800","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjU3OjIw","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjU3OjU4","data-yw-t":!0,"data-yw-auto":!0,children:"Your licence expired "}),Math.abs(ze),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjU4Ojcw","data-yw-t":!0,"data-yw-auto":!0,children:" days ago. Please renew it to continue driving."})]})]})]})}),Lt&&l.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjY2OjE0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjY3OjE2","data-yw-s":!0,children:[l.jsx(bl,{className:"w-6 h-6 text-yellow-600 flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjY4OjE4","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjY5OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-yellow-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjcwOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Licence Expiring Soon"}),l.jsxs("div",{className:"text-sm text-yellow-800","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjcxOjIw","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjcxOjYx","data-yw-t":!0,"data-yw-auto":!0,children:"Your licence expires in "}),ze,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjcyOjYz","data-yw-t":!0,"data-yw-auto":!0,children:" days. Please renew it to avoid service interruption."})]})]})]})}),l.jsx("div",{className:`rounded-xl p-4 border ${qt?"bg-green-50 border-green-200":Wt==="pending"?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjgxOjE0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjg4OjE2","data-yw-s":!0,children:[qt?l.jsx(Hd,{className:"w-6 h-6 text-green-600 flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjkwOjIw","data-yw-s":!0}):Wt==="pending"?l.jsx(Kc,{className:"w-6 h-6 text-yellow-600 flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjkyOjIw","data-yw-s":!0}):l.jsx(Kc,{className:"w-6 h-6 text-red-600 flex-shrink-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjk0OjIw","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjk2OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:`font-semibold mb-1 ${qt?"text-green-900":Wt==="pending"?"text-yellow-900":"text-red-900"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMjk3OjIw","data-yw-s":!0,children:[qt&&"License Verified",Wt==="pending"&&!qt&&"Verification Pending",Wt==="rejected"&&"Verification Rejected"]}),l.jsxs("div",{className:`text-sm ${qt?"text-green-800":Wt==="pending"?"text-yellow-800":"text-red-800"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzA4OjIw","data-yw-s":!0,children:[qt&&"Your driver's license has been verified successfully.",Wt==="pending"&&!qt&&"Your license is being reviewed. This usually takes 24-48 hours.",Wt==="rejected"&&"Your license verification was rejected. Please upload clear photos and try again."]}),g?.verification_notes&&l.jsxs("div",{className:"mt-2 text-sm text-gray-700 bg-white bg-opacity-50 rounded p-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzIwOjIy","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzIxOjI0","data-yw-t":!0,"data-yw-s":!0,children:"Note:"})," ",g.verification_notes]})]})]})}),l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzMwOjEy","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzMxOjE0","data-yw-s":!0,children:[l.jsx(UZ,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzMyOjE2","data-yw-s":!0}),l.jsxs("div",{className:"text-sm text-blue-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzMzOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzM0OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Upload Your Driver's License"}),l.jsxs("ul",{className:"text-blue-700 space-y-1 list-disc list-inside","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzM1OjE4","data-yw-s":!0,children:[l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzM2OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Upload clear photos of both front and back"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzM3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Ensure all text is readable"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzM4OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Avoid glare and shadows"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzM5OjIw","data-yw-t":!0,"data-yw-s":!0,children:"License must be valid and not expired"})]})]})]})}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzQ2OjEy","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzQ3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"License Information"}),l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzQ4OjE0","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzQ5OjE2","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzUwOjE4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzUwOjgy","data-yw-t":!0,"data-yw-auto":!0,children:"Licence Number "}),l.jsx("span",{className:"text-red-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzUxOjM1","data-yw-t":!0,"data-yw-s":!0,children:"*"})]}),l.jsx("input",{type:"text",value:G,onChange:Ye=>Y(Ye.target.value),disabled:!D,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-600",placeholder:"Enter licence number","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzUzOjE4","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzYzOjE2","data-yw-s":!0,children:[l.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzY0OjE4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzY0Ojgy","data-yw-t":!0,"data-yw-auto":!0,children:"Expiry Date "}),l.jsx("span",{className:"text-red-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzY1OjMy","data-yw-t":!0,"data-yw-s":!0,children:"*"})]}),l.jsx("input",{type:"date",value:X,onChange:Ye=>ue(Ye.target.value),disabled:!D,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzY3OjE4","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzc2OjE2","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzc3OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Issue Date"}),l.jsx("input",{type:"date",value:oe,onChange:Ye=>pe(Ye.target.value),disabled:!D,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzgwOjE4","data-yw-s":!0})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzg5OjE2","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzkwOjE4","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzkxOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Country"}),l.jsx("input",{type:"text",value:ve,onChange:Ye=>ke(Ye.target.value),disabled:!D,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-600",placeholder:"e.g., USA","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hAMzk0OjIw","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDAzOjE4","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDA0OjIw","data-yw-t":!0,"data-yw-s":!0,children:"State/Province"}),l.jsx("input",{type:"text",value:ye,onChange:Ye=>$e(Ye.target.value),disabled:!D,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-600",placeholder:"e.g., CA","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDA3OjIw","data-yw-s":!0})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDE4OjE2","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDE5OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Licence Class"}),l.jsx("input",{type:"text",value:De,onChange:Ye=>Te(Ye.target.value),disabled:!D,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:text-gray-600",placeholder:"e.g., Class C","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDIyOjE4","data-yw-s":!0})]})]})]}),l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDM1OjEy","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDM2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Upload License Photos"}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDM5OjE0","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDQwOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Front Side"}),Qe?l.jsxs("div",{className:"relative","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDQzOjE4","data-yw-s":!0,children:[l.jsx("img",{src:Qe,alt:"License front",className:"w-full h-48 object-cover rounded-lg border-2 border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDQ0OjIw","data-yw-s":!0}),D&&l.jsx("button",{onClick:()=>Ft(""),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 active:scale-95 transition-all shadow-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDUwOjIy","data-yw-s":!0,children:l.jsx(lo,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDU0OjI0","data-yw-s":!0})})]}):l.jsxs("label",{className:`flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 rounded-lg transition-colors ${D?"hover:bg-gray-50 active:bg-gray-100 cursor-pointer":"bg-gray-100 cursor-not-allowed"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDU5OjE4","data-yw-s":!0,children:[l.jsx(Km,{className:"w-12 h-12 text-gray-400 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDYyOjIw","data-yw-s":!0}),l.jsx("span",{className:"text-sm font-medium text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDYzOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Upload Front Side"}),l.jsx("span",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDY0OjIw","data-yw-t":!0,"data-yw-s":!0,children:"PNG, JPG up to 5MB"}),l.jsx("input",{type:"file",accept:"image/*",onChange:Ye=>{const wt=Ye.target.files?.[0];wt&&yt("front",wt)},disabled:!D,className:"hidden","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDY1OjIw","data-yw-s":!0})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDgwOjE0","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDgxOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Back Side"}),bt?l.jsxs("div",{className:"relative","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDg0OjE4","data-yw-s":!0,children:[l.jsx("img",{src:bt,alt:"License back",className:"w-full h-48 object-cover rounded-lg border-2 border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDg1OjIw","data-yw-s":!0}),D&&l.jsx("button",{onClick:()=>Qt(""),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 active:scale-95 transition-all shadow-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDkxOjIy","data-yw-s":!0,children:l.jsx(lo,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANDk1OjI0","data-yw-s":!0})})]}):l.jsxs("label",{className:`flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 rounded-lg transition-colors ${D?"hover:bg-gray-50 active:bg-gray-100 cursor-pointer":"bg-gray-100 cursor-not-allowed"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTAwOjE4","data-yw-s":!0,children:[l.jsx(Km,{className:"w-12 h-12 text-gray-400 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTAzOjIw","data-yw-s":!0}),l.jsx("span",{className:"text-sm font-medium text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTA0OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Upload Back Side"}),l.jsx("span",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTA1OjIw","data-yw-t":!0,"data-yw-s":!0,children:"PNG, JPG up to 5MB"}),l.jsx("input",{type:"file",accept:"image/*",onChange:Ye=>{const wt=Ye.target.files?.[0];wt&&yt("back",wt)},disabled:!D,className:"hidden","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTA2OjIw","data-yw-s":!0})]})]})]}),D?l.jsxs("div",{className:"flex space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTIzOjE0","data-yw-s":!0,children:[l.jsxs("button",{onClick:ht,disabled:n,className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 active:scale-98 transition-all shadow-md flex items-center justify-center space-x-2 min-h-touch disabled:opacity-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTI0OjE2","data-yw-s":!0,children:[l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTI5OjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTMwOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Cancel"})]}),l.jsxs("button",{onClick:Ke,disabled:n||!G||!X,className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 active:scale-98 transition-all shadow-md flex items-center justify-center space-x-2 min-h-touch disabled:opacity-50 disabled:cursor-not-allowed","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTMyOjE2","data-yw-s":!0,children:[l.jsx(oy,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTM3OjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTM4OjE4","data-yw-s":!0,children:n?"Saving...":"Save"})]})]}):!qt&&l.jsxs("button",{onClick:st,disabled:n||!Qe||!bt||!G||!X||mt,className:"w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 active:scale-98 transition-all shadow-md flex items-center justify-center space-x-2 min-h-touch disabled:opacity-50 disabled:cursor-not-allowed","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTQzOjE2","data-yw-s":!0,children:[l.jsx(QZ,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTQ4OjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9MaWNlbnNlVmVyaWZpY2F0aW9uUGFnZS50c3hANTQ5OjE4","data-yw-s":!0,children:n?"Submitting...":"Submit for Verification"})]})]})})]})})}function Gk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!1),[Z,S]=fe.useState(null),[n,B]=fe.useState(!0);fe.useEffect(()=>{(async()=>{const ue=await ui();if(!ue||ue.userType!=="driver"){u("/driver/home");return}d(ue),B(!1)})()},[u]);const D=()=>{g?(S(null),j(!1)):(S(o),j(!0))},P=()=>{if(Z){const X=JSON.parse(localStorage.getItem("ongopool_users")||"[]"),ue=X.findIndex(oe=>oe.id===Z.id);ue!==-1&&(X[ue]=Z,localStorage.setItem("ongopool_users",JSON.stringify(X)),localStorage.setItem("ongopool_current_user",JSON.stringify(Z)),d(Z),j(!1),alert("Vehicle details updated successfully!"))}},G=(X,ue)=>{Z&&S({...Z,[X]:ue})};if(n)return l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDYyOjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDYzOjg","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDY0OjEw","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDY1OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})});if(!o)return null;const Y=g?Z:o;return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDc2OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDc3OjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDg1Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDg2OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDg3OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDkxOjE0","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDkzOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Vehicle Details"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDk4Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDk5OjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-8 text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEwMToxMg","data-yw-s":!0,children:[l.jsx(Wp,{className:"w-24 h-24 text-gray-600 mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEwMjoxNA","data-yw-s":!0}),l.jsxs("div",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEwMzoxNA","data-yw-s":!0,children:[Y.vehicleYear," ",Y.vehicleMake]}),l.jsx("div",{className:"text-lg text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEwNjoxNA","data-yw-s":!0,children:Y.vehicleModel}),l.jsx("div",{className:"text-sm text-gray-600 mt-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEwNzoxNA","data-yw-s":!0,children:Y.vehicleColor})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDExMToxMg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDExMjoxNA","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDExMzoxNg","data-yw-t":!0,"data-yw-s":!0,children:"Vehicle Information"}),g?l.jsxs("div",{className:"flex space-x-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDExNToxOA","data-yw-s":!0,children:[l.jsxs("button",{onClick:D,className:"flex items-center space-x-1 text-sm text-gray-600 font-medium px-3 py-1 rounded-lg hover:bg-gray-100 active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDExNjoyMA","data-yw-s":!0,children:[l.jsx(lo,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEyMDoyMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEyMToyMg","data-yw-t":!0,"data-yw-s":!0,children:"Cancel"})]}),l.jsxs("button",{onClick:P,className:"flex items-center space-x-1 text-sm text-blue-600 font-medium px-3 py-1 rounded-lg bg-blue-50 hover:bg-blue-100 active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEyMzoyMA","data-yw-s":!0,children:[l.jsx(oy,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEyNzoyMg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEyODoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Save"})]})]}):l.jsxs("button",{onClick:D,className:"flex items-center space-x-1 text-sm text-blue-600 font-medium px-3 py-1 rounded-lg hover:bg-blue-50 active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEzMjoxOA","data-yw-s":!0,children:[l.jsx(ty,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEzNjoyMA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDEzNzoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Edit"})]})]}),l.jsx("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE0MjoxNA","data-yw-s":!0,children:g?l.jsxs(l.Fragment,{children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE0NToyMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE0NjoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Make"}),l.jsx("input",{type:"text",value:Z?.vehicleMake||"",onChange:X=>G("vehicleMake",X.target.value),placeholder:"Toyota",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE0NzoyMg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE1NjoyMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE1NzoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Model"}),l.jsx("input",{type:"text",value:Z?.vehicleModel||"",onChange:X=>G("vehicleModel",X.target.value),placeholder:"Camry",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE1ODoyMg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE2NzoyMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE2ODoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Year"}),l.jsx("input",{type:"number",value:Z?.vehicleYear||"",onChange:X=>G("vehicleYear",parseInt(X.target.value)),placeholder:"2020",min:"2000",max:"2025",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE2OToyMg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE4MDoyMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE4MToyMg","data-yw-t":!0,"data-yw-s":!0,children:"Color"}),l.jsx("input",{type:"text",value:Z?.vehicleColor||"",onChange:X=>G("vehicleColor",X.target.value),placeholder:"Silver",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE4MjoyMg","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE5MToyMA","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE5MjoyMg","data-yw-t":!0,"data-yw-s":!0,children:"License Plate"}),l.jsx("input",{type:"text",value:Z?.vehiclePlate||"",onChange:X=>G("vehiclePlate",X.target.value),placeholder:"ABC 123",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDE5MzoyMg","data-yw-s":!0})]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIwNDoyMA","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIwNToyMg","data-yw-t":!0,"data-yw-s":!0,children:"Make"}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIwNjoyMg","data-yw-s":!0,children:Y.vehicleMake})]}),l.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIwOToyMA","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIxMDoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Model"}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIxMToyMg","data-yw-s":!0,children:Y.vehicleModel})]}),l.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIxNDoyMA","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIxNToyMg","data-yw-t":!0,"data-yw-s":!0,children:"Year"}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIxNjoyMg","data-yw-s":!0,children:Y.vehicleYear})]}),l.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIxOToyMA","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIyMDoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Color"}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIyMToyMg","data-yw-s":!0,children:Y.vehicleColor})]}),l.jsxs("div",{className:"flex justify-between items-center py-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIyNDoyMA","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIyNToyMg","data-yw-t":!0,"data-yw-s":!0,children:"License Plate"}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIyNjoyMg","data-yw-s":!0,children:Y.vehiclePlate})]})]})})]}),l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIzNDoxMg","data-yw-s":!0,children:l.jsxs("div",{className:"text-sm text-blue-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIzNToxNA","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIzNjoxNg","data-yw-t":!0,"data-yw-s":!0,children:"Keep Your Information Updated"}),l.jsx("div",{className:"text-blue-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9WZWhpY2xlRGV0YWlsc1BhZ2UudHN4QDIzNzoxNg","data-yw-t":!0,"data-yw-s":!0,children:"Make sure your vehicle information is accurate. Riders will see these details when booking your rides."})]})})]})})]})})}async function xN(u,o,d,g,j,Z,S="medium"){try{const{error:n}=await It.from("report_issues").insert({user_id:u,user_type:o,issue_type:d,title:g,description:j,ride_id:Z||null,status:"open",priority:S});if(n)throw n;return!0}catch(n){return console.error("Error submitting issue:",n),!1}}async function wN(u,o,d,g,j,Z,S){try{const{data:n,error:B}=await It.from("sos_emergencies").insert({user_id:u,user_type:o,emergency_type:d,location_lat:g?.lat||null,location_lng:g?.lng||null,location_address:g?.address||null,description:j||null,contact_phone:Z||null,ride_id:S||null,status:"active"}).select().single();if(B)throw B;return{success:!0,emergencyId:n?.id}}catch(n){return console.error("Error creating SOS emergency:",n),{success:!1}}}async function vN(u){try{const{error:o}=await It.from("sos_emergencies").update({status:"cancelled",resolved_at:new Date().toISOString()}).eq("id",u);if(o)throw o;return!0}catch(o){return console.error("Error cancelling SOS emergency:",o),!1}}async function bN(u){try{const{data:o,error:d}=await It.from("sos_emergencies").select("*").eq("user_id",u).eq("status","active").order("created_at",{ascending:!1}).limit(1).single();if(d&&d.code!=="PGRST116")throw d;return o||null}catch(o){return console.error("Error fetching active SOS emergency:",o),null}}const Uk=[{value:"payment",label:"Payment Issue"},{value:"rider_behavior",label:"Rider Behavior"},{value:"technical",label:"App Technical Problem"},{value:"safety",label:"Safety Concern"},{value:"account",label:"Account Issue"},{value:"vehicle",label:"Vehicle Problem"},{value:"navigation",label:"Route/Navigation Issue"},{value:"other",label:"Other"}],Wk=[{value:"low",label:"Low",color:"bg-blue-100 text-blue-800"},{value:"medium",label:"Medium",color:"bg-yellow-100 text-yellow-800"},{value:"high",label:"High",color:"bg-orange-100 text-orange-800"},{value:"critical",label:"Critical",color:"bg-red-100 text-red-800"}];function Xk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!0),[Z,S]=fe.useState(!1),[n,B]=fe.useState(""),[D,P]=fe.useState("medium"),[G,Y]=fe.useState(""),[X,ue]=fe.useState(""),[oe,pe]=fe.useState(!1);fe.useEffect(()=>{(async()=>{const ye=await ui();if(!ye){u("/auth");return}d(ye),j(!1)})()},[u]);const ve=async ke=>{if(ke.preventDefault(),!n||!G.trim()||!X.trim()){alert("Please fill in all required fields");return}S(!0),un("medium");try{await xN(o.id,o.userType,n,G,X,void 0,D)?(un("success"),pe(!0)):(un("error"),alert("Failed to submit issue. Please try again."))}catch(ye){console.error("Error submitting issue:",ye),alert("An error occurred. Please try again.")}finally{S(!1)}};return g||!o?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDg5OjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDkwOjg","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDkxOjEw","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDkyOjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):oe?l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEwMDo2","data-yw-s":!0,children:l.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center px-4",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEwMTo4","data-yw-s":!0,children:l.jsxs("div",{className:"bg-white rounded-xl p-8 shadow-lg border border-gray-100 max-w-md w-full text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEwODoxMA","data-yw-s":!0,children:[l.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full mx-auto mb-4 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEwOToxMg","data-yw-s":!0,children:l.jsx(Hd,{className:"w-12 h-12 text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDExMDoxNA","data-yw-s":!0})}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDExMjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Issue Reported"}),l.jsx("p",{className:"text-gray-600 mb-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDExMzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Thank you for reporting this issue. Our support team will review it and get back to you within 24-48 hours."}),l.jsx("button",{onClick:()=>u("/driver/profile"),className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold active:bg-blue-700 active:scale-98 transition-all min-h-touch","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDExNjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Back to Profile"})]})})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEyOTo0","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEzMDo2","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEzODo4","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDEzOToxMA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE0MDoxMg","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE0NDoxNA","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE0NjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Report Issue"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE1MTo4","data-yw-s":!0,children:l.jsxs("form",{onSubmit:ve,className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE1MjoxMA","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE1NDoxMg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE1NToxNA","data-yw-t":!0,"data-yw-s":!0,children:"Issue Category *"}),l.jsxs("select",{value:n,onChange:ke=>B(ke.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE1ODoxNA","data-yw-s":!0,children:[l.jsx("option",{value:"","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE2NDoxNg","data-yw-t":!0,"data-yw-s":!0,children:"Select a category"}),Uk.map(ke=>l.jsx("option",{value:ke.value,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE2NjoxOA","data-yw-s":!0,children:ke.label},ke.value))]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE3NDoxMg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE3NToxNA","data-yw-t":!0,"data-yw-s":!0,children:"Priority"}),l.jsx("div",{className:"grid grid-cols-2 gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE3ODoxNA","data-yw-s":!0,children:Wk.map(ke=>l.jsx("button",{type:"button",onClick:()=>P(ke.value),className:`px-4 py-2 rounded-lg font-medium transition-all ${D===ke.value?ke.color+" ring-2 ring-offset-2 ring-blue-500":"bg-gray-100 text-gray-700"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE4MDoxOA","data-yw-s":!0,children:ke.label},ke.value))})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE5NzoxMg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDE5ODoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Issue Title *"}),l.jsx("input",{type:"text",value:G,onChange:ke=>Y(ke.target.value),placeholder:"Brief description of the issue",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,maxLength:100,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIwMToxNA","data-yw-s":!0}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIxMDoxNA","data-yw-s":!0,children:[G.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIxMTozMA","data-yw-t":!0,"data-yw-auto":!0,children:"/100 characters"})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIxNjoxMg","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIxNzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Description *"}),l.jsx("textarea",{value:X,onChange:ke=>ue(ke.target.value),placeholder:"Please provide detailed information about the issue...",rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",required:!0,maxLength:1e3,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIyMDoxNA","data-yw-s":!0}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIyOToxNA","data-yw-s":!0,children:[X.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIzMDozNg","data-yw-t":!0,"data-yw-auto":!0,children:"/1000 characters"})]})]}),l.jsx("button",{type:"submit",disabled:Z,className:"w-full flex items-center justify-center gap-2 py-3 bg-blue-600 text-white rounded-lg font-semibold active:bg-blue-700 active:scale-98 transition-all disabled:opacity-50 disabled:cursor-not-allowed min-h-touch","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDIzNToxMg","data-yw-s":!0,children:Z?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDI0MjoxOA","data-yw-s":!0}),"Submitting..."]}):l.jsxs(l.Fragment,{children:[l.jsx(y_,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9SZXBvcnRJc3N1ZVBhZ2UudHN4QDI0NzoxOA","data-yw-s":!0}),"Submit Report"]})})]})})]})})}const Qk=[{id:"1",name:"Emergency Services (911)",phone:"911",type:"emergency"},{id:"2",name:"OnGoPool Safety Team",phone:"+1-800-555-0199",type:"support"},{id:"3",name:"Local Police (Non-Emergency)",phone:"311",type:"police"}],Hk=["Medical Emergency","Accident","Safety Threat","Vehicle Breakdown","Lost/Stranded","Other Emergency"];function Yk(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!0),[Z,S]=fe.useState(!1),[n,B]=fe.useState(5),[D,P]=fe.useState(null),[G,Y]=fe.useState("Safety Threat"),[X,ue]=fe.useState(null),[oe,pe]=fe.useState(null),[ve,ke]=fe.useState(null);fe.useEffect(()=>((async()=>{const Ft=await ui();if(!Ft){u("/auth");return}d(Ft);const bt=await bN(Ft.id);bt&&(P(bt.id),S(!0),B(0)),j(!1)})(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(Ft=>ue(Ft),Ft=>console.error("Error getting location:",Ft)),()=>{ve&&ve()}),[u,ve]),fe.useEffect(()=>{if(Z&&n>0){const Qe=setTimeout(()=>{B(n-1),o_(100)},1e3);return()=>clearTimeout(Qe)}else Z&&n===0&&!D&&ye()},[Z,n,D]);const ye=async()=>{try{const Qe=X?{lat:X.coords.latitude,lng:X.coords.longitude}:void 0,Ft=await wN(o.id,o.userType,G,Qe,`Emergency activated by ${o.userType}`,o.phone||void 0);if(Ft.success){P(Ft.emergencyId||null),un("success"),o_([200,100,200]);const{stopTracking:bt}=ek(Qt=>{pe(Qt),console.log("[SOS] Real-time location update:",Qt)},2e3);ke(()=>bt),alert(` Emergency Alert Sent!

Your location has been shared with:
 Emergency Services
 OnGoPool Safety Team
 Your emergency contacts

Real-time location tracking is now active.
Help is on the way!`)}}catch(Qe){console.error("Error activating emergency:",Qe),alert("Failed to activate emergency. Please call 911 directly.")}},$e=()=>{window.confirm(` EMERGENCY ACTIVATION

This will:
 Contact emergency services (911)
 Share your current location
 Notify OnGoPool safety team
 Alert your emergency contacts

Type: ${G}

Are you sure you need emergency help?`)&&(un("heavy"),S(!0))},De=async()=>{n>0?(S(!1),B(5),un("light")):D&&window.confirm("Are you sure you want to cancel the emergency alert?")&&await vN(D)&&(ve&&(ve(),ke(null)),S(!1),P(null),B(5),pe(null),un("success"))},Te=Qe=>{un("medium"),window.location.href=`tel:${Qe}`};return g||!o?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxNjU6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxNjY6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxNjc6MTA","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxNjg6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxNzU6NA","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxNzY6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxODQ6OA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxODU6MTA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all",disabled:Z&&n>0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxODY6MTI","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxOTE6MTQ","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxOTM6MTI","data-yw-t":!0,"data-yw-s":!0,children:"SOS Emergency"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxOTg6OA","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAxOTk6MTA","data-yw-s":!0,children:[Z?l.jsxs("div",{className:"bg-red-600 rounded-xl p-8 text-center shadow-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMDI6MTQ","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-20 h-20 text-white mx-auto mb-4 animate-pulse","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMDM6MTY","data-yw-s":!0}),l.jsx("div",{className:"text-white space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMDQ6MTY","data-yw-s":!0,children:n>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"text-3xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMDc6MjI","data-yw-s":!0,children:n}),l.jsx("div",{className:"text-xl font-semibold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMDg6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Emergency Alert Activating..."}),l.jsxs("div",{className:"text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMDk6MjI","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMDk6NDc","data-yw-t":!0,"data-yw-auto":!0,children:"Emergency services will be contacted in "}),n,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMTA6NzU","data-yw-t":!0,"data-yw-auto":!0,children:" second"}),n!==1?"s":""]}),l.jsx("button",{onClick:De,className:"mt-4 px-6 py-3 bg-white text-red-600 font-semibold rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMTI6MjI","data-yw-t":!0,"data-yw-s":!0,children:"CANCEL"})]}):l.jsxs(l.Fragment,{children:[l.jsx(Hd,{className:"w-16 h-16 mx-auto mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMjE6MjI","data-yw-s":!0}),l.jsx("div",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMjI6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Emergency Alert Active"}),l.jsx("div",{className:"text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMjM6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Help has been contacted. Stay safe!"}),l.jsx("button",{onClick:De,className:"mt-4 px-6 py-3 bg-white text-red-600 font-semibold rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMjY6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Mark as Resolved"})]})})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyMzk6MTY","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNDA6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Emergency Type"}),l.jsx("select",{value:G,onChange:Qe=>Y(Qe.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNDE6MTg","data-yw-s":!0,children:Hk.map(Qe=>l.jsx("option",{value:Qe,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNDc6MjI","data-yw-s":!0,children:Qe},Qe))})]}),l.jsxs("button",{onClick:$e,className:"w-full bg-red-600 text-white rounded-xl p-8 shadow-lg active:scale-98 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNTU6MTY","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-16 h-16 mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNTk6MTg","data-yw-s":!0}),l.jsx("div",{className:"text-2xl font-bold mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNjA6MTg","data-yw-t":!0,"data-yw-s":!0,children:"ACTIVATE SOS"}),l.jsx("div",{className:"text-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNjE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Press to alert emergency services"})]}),l.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNjc6MTY","data-yw-s":!0,children:l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNjg6MTg","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNjk6MjA","data-yw-s":!0}),l.jsxs("div",{className:"text-sm text-yellow-800","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNzA6MjA","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNzE6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Only use in real emergencies"}),l.jsx("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyNzI6MjI","data-yw-t":!0,"data-yw-s":!0,children:"False activation may result in fines and account suspension."})]})]})})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyODA6MTI","data-yw-s":!0,children:[l.jsx("div",{className:"px-4 py-3 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyODE6MTQ","data-yw-s":!0,children:l.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyODI6MTY","data-yw-s":!0,children:[l.jsx(Up,{className:"w-5 h-5 text-blue-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyODM6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyODM6NjU","data-yw-t":!0,"data-yw-auto":!0,children:"Emergency Contacts"})]})}),l.jsx("div",{className:"divide-y divide-gray-100","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyODc6MTQ","data-yw-s":!0,children:Qk.map(Qe=>l.jsxs("button",{onClick:()=>Te(Qe.phone),className:"w-full flex items-center justify-between px-4 py-4 active:bg-gray-50 transition-colors","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyODk6MTg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyOTQ6MjA","data-yw-s":!0,children:[l.jsx("div",{className:`p-2 rounded-lg ${Qe.type==="emergency"?"bg-red-100":Qe.type==="support"?"bg-blue-100":"bg-gray-100"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAyOTU6MjI","data-yw-s":!0,children:l.jsx(Up,{className:`w-5 h-5 ${Qe.type==="emergency"?"text-red-600":Qe.type==="support"?"text-blue-600":"text-gray-600"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMDA6MjQ","data-yw-s":!0})}),l.jsxs("div",{className:"text-left","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMDY6MjI","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMDc6MjQ","data-yw-s":!0,children:Qe.name}),l.jsx("div",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMDg6MjQ","data-yw-s":!0,children:Qe.phone})]})]}),l.jsx(Up,{className:"w-5 h-5 text-gray-400","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMTE6MjA","data-yw-s":!0})]},Qe.id))})]}),Z&&oe&&l.jsx("div",{className:"bg-green-50 border-2 border-green-500 rounded-xl p-4 shadow-sm animate-pulse","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMTk6MTQ","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjA6MTY","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjE6MTg","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjI6MTg","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900 mb-1 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjM6MjA","data-yw-t":!0,"data-yw-s":!0,children:" Live Location Tracking"}),l.jsxs("div",{className:"text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjY6MjA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjY6NTk","data-yw-t":!0,"data-yw-auto":!0,children:"Lat: "}),oe.lat.toFixed(6),l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjc6NjA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMjc6NjY","data-yw-t":!0,"data-yw-auto":!0,children:"Lng: "}),oe.lng.toFixed(6),oe.accuracy&&l.jsxs(l.Fragment,{children:[l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMzA6MjY","data-yw-s":!0}),"Accuracy: ",Math.round(oe.accuracy),"m"]}),oe.speed&&oe.speed>0&&l.jsxs(l.Fragment,{children:[l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMzM6MjY","data-yw-s":!0}),"Speed: ",oe.speed.toFixed(1)," km/h"]})]}),l.jsx("div",{className:"text-xs text-green-700 mt-2 font-medium","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMzY6MjA","data-yw-t":!0,"data-yw-s":!0,children:" Location shared with emergency services in real-time"}),l.jsxs("div",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMzk6MjA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzMzk6NjQ","data-yw-t":!0,"data-yw-auto":!0,children:"Updated: "}),new Date(oe.timestamp).toLocaleTimeString()]})]})]})}),!Z&&X&&l.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNDk6MTQ","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTA6MTY","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTE6MTg","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTI6MTg","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTM6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Current Location"}),l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTQ6MjA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTQ6NTk","data-yw-t":!0,"data-yw-auto":!0,children:"Lat: "}),X.coords.latitude.toFixed(6),l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTU6NzE","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTU6Nzc","data-yw-t":!0,"data-yw-auto":!0,children:"Lng: "}),X.coords.longitude.toFixed(6)]}),l.jsx("div",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9TT1NQYWdlLnRzeEAzNTg6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Location will be shared with emergency services"})]})]})})]})})]})})}function $k(){const u=on(),{rideId:o}=Qp(),[d,g]=fe.useState(null),[j,Z]=fe.useState(null),[S,n]=fe.useState(!0),[B,D]=fe.useState(!1),[P,G]=fe.useState(!1),[Y,X]=fe.useState(0),[ue,oe]=fe.useState({date:"",time:"",availableSeats:1,pricePerSeat:""}),[pe,ve]=fe.useState({hour:"12",minute:"00",period:"AM"});fe.useEffect(()=>{ke()},[o]);const ke=async()=>{try{const Te=await ui();if(!Te||Te.userType!=="driver"){u("/auth");return}if(g(Te),!o){u("/driver/trips");return}const Qe=await __(o);if(!Qe){alert("Ride not found"),u("/driver/trips");return}if(Qe.driver_id!==Te.id){alert("You can only edit your own rides"),u("/driver/trips");return}if(Z(Qe),oe({date:Qe.date||"",time:Qe.time||"",availableSeats:Qe.available_seats||1,pricePerSeat:Qe.price_per_seat?.toString()||""}),Qe.time){const[Gt,yt]=Qe.time.split(":"),Ke=parseInt(Gt),st=Ke===0?12:Ke>12?Ke-12:Ke,ht=Ke>=12?"PM":"AM";ve({hour:st.toString().padStart(2,"0"),minute:yt,period:ht})}const Qt=(await mv(Te.id)).filter(Gt=>Gt.ride_id===o).filter(Gt=>Gt.status==="pending"||Gt.status==="accepted");Qt.length>0&&(G(!0),X(Qt.length))}catch(Te){console.error("Error loading data:",Te),alert("Failed to load ride details"),u("/driver/trips")}finally{n(!1)}},ye=(Te,Qe,Ft)=>{let bt=parseInt(Te);return Ft==="AM"?bt===12&&(bt=0):bt!==12&&(bt+=12),`${bt.toString().padStart(2,"0")}:${Qe}:00`},$e=(Te,Qe)=>{const[Ft,bt,Qt]=Te.split(":").map(Number),Gt=Ft*3600+bt*60+(Qt||0),yt=Math.floor(Qe/1e3);let Ke=Gt+yt;Ke<0&&(Ke+=86400),Ke>=86400&&(Ke-=86400);const st=Math.floor(Ke/3600),ht=Math.floor(Ke%3600/60),Wt=Ke%60;return`${st.toString().padStart(2,"0")}:${ht.toString().padStart(2,"0")}:${Wt.toString().padStart(2,"0")}`},De=async Te=>{if(Te.preventDefault(),P){alert("Cannot edit ride with active bookings");return}un("medium"),D(!0);try{const Qe=ye(pe.hour,pe.minute,pe.period),{data:Ft,error:bt}=await It.from("rides").select("id, time, estimated_arrival, from_location, to_location").eq("driver_id",d.id).eq("date",ue.date).eq("status","scheduled").neq("id",o);if(bt)throw bt;if(Ft&&Ft.length>0){const[yt,Ke,st]=Qe.split(":").map(Number),ht=yt*60+Ke,Wt=ht+(j.duration||0);for(const qt of Ft){const[Lt,mt]=qt.time.split(":").map(Number),ze=Lt*60+mt;let Ye=ze;if(qt.estimated_arrival){const[Be,ba]=qt.estimated_arrival.split(":").map(Number);Ye=Be*60+ba}if(ht<Ye&&ze<Wt){alert(`Time conflict detected!

Your new ride time (${pe.hour}:${pe.minute} ${pe.period}) conflicts with another ride:
${qt.from_location.address}  ${qt.to_location.address}
at ${qt.time}

Please choose a different time.`),D(!1);return}}}let Qt=j.estimated_arrival;if(Qe!==j.time&&j.duration){const[yt,Ke,st]=j.time.split(":").map(Number),[ht,Wt,qt]=Qe.split(":").map(Number),Lt=yt*3600+Ke*60+(st||0),ze=(ht*3600+Wt*60+(qt||0)-Lt)*1e3;j.estimated_arrival&&(Qt=$e(j.estimated_arrival,ze))}const{error:Gt}=await It.from("rides").update({date:ue.date,time:Qe,available_seats:ue.availableSeats,estimated_arrival:Qt,updated_at:new Date().toISOString()}).eq("id",o);if(Gt)throw Gt;if(Qe!==j.time){const[yt,Ke,st]=j.time.split(":").map(Number),[ht,Wt,qt]=Qe.split(":").map(Number),Lt=yt*3600+Ke*60+(st||0),ze=(ht*3600+Wt*60+(qt||0)-Lt)*1e3,{data:Ye,error:wt}=await It.from("route_stops").select("*").eq("ride_id",o);if(!wt&&Ye&&Ye.length>0){const Be=Ye.map(async ba=>{if(ba.estimated_arrival){const lr=$e(ba.estimated_arrival,ze);return It.from("route_stops").update({estimated_arrival:lr}).eq("id",ba.id)}});await Promise.all(Be.filter(Boolean))}}un("success"),alert("Ride updated successfully with new ETA times!"),u("/driver/trips")}catch(Qe){console.error("Error updating ride:",Qe),alert("Failed to update ride")}finally{D(!1)}};return S?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDI3Nzo2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDI3ODo4","data-yw-s":!0,children:[l.jsx(r_,{className:"w-12 h-12 text-blue-600 animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDI3OToxMA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDI4MDoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Loading ride details..."})]})}):j?l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDI5MTo0","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDI5Mjo2","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDI5OTo4","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMwMDoxMA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-white/10 rounded-full active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMwMToxMg","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMwNToxNA","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMwNzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Edit Ride"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMxMjo4","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMxMzoxMA","data-yw-s":!0,children:[P&&l.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMxNjoxNA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMxNzoxNg","data-yw-s":!0,children:[l.jsx(Kc,{className:"w-6 h-6 text-orange-600 flex-none mt-0.5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMxODoxOA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMxOToxOA","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-orange-900 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMyMDoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Cannot Edit This Ride"}),l.jsxs("p",{className:"text-sm text-orange-700 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMyMzoyMA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMyMzo2NA","data-yw-t":!0,"data-yw-auto":!0,children:"You have "}),Y,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMyNDo1Mg","data-yw-t":!0,"data-yw-auto":!0,children:" active booking"}),Y>1?"s":""," ",l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMyNDoxMDg","data-yw-t":!0,"data-yw-auto":!0,children:"(pending or accepted) for this ride. Please cancel or complete these bookings before editing the ride."})]}),l.jsx("button",{onClick:()=>u(`/driver/ride-detail/${o}`),className:"text-sm font-medium text-orange-700 underline","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDMyODoyMA","data-yw-t":!0,"data-yw-s":!0,children:"View Booking Requests"})]})]})}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0MDoxMg","data-yw-s":!0,children:[l.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0MToxNA","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0MjoxNg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0Mjo2MA","data-yw-t":!0,"data-yw-auto":!0,children:"Route (Cannot be changed)"})]}),l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0NToxNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0NjoxNg","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mt-1.5 flex-none","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0NzoxOA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0ODoxOA","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM0OToyMA","data-yw-t":!0,"data-yw-s":!0,children:"From"}),l.jsx("p",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM1MDoyMA","data-yw-s":!0,children:j.from_location?.address||"Unknown"})]})]}),l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM1NToxNg","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mt-1.5 flex-none","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM1NjoxOA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM1NzoxOA","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM1ODoyMA","data-yw-t":!0,"data-yw-s":!0,children:"To"}),l.jsx("p",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM1OToyMA","data-yw-s":!0,children:j.to_location?.address||"Unknown"})]})]})]})]}),l.jsxs("form",{onSubmit:De,className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM2ODoxMg","data-yw-s":!0,children:[l.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM3MDoxNA","data-yw-s":!0,children:l.jsxs("label",{className:"block","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM3MToxNg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM3MjoxOA","data-yw-s":!0,children:[l.jsx(bl,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM3MzoyMA","data-yw-s":!0}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM3NDoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Date"})]}),l.jsx("input",{type:"date",value:ue.date,onChange:Te=>oe({...ue,date:Te.target.value}),disabled:P,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",required:!0,min:new Date().toISOString().split("T")[0],"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM3NjoxOA","data-yw-s":!0})]})}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM4OToxNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM5MDoxNg","data-yw-s":!0,children:[l.jsx(ws,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM5MToxOA","data-yw-s":!0}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM5MjoxOA","data-yw-t":!0,"data-yw-s":!0,children:"Time"})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM5NDoxNg","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM5NjoxOA","data-yw-s":!0,children:[l.jsx("label",{className:"text-xs text-gray-500 mb-1 block","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM5NzoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Hour"}),l.jsx("select",{value:pe.hour,onChange:Te=>ve({...pe,hour:Te.target.value}),disabled:P,className:"w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-center font-medium",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDM5ODoyMA","data-yw-s":!0,children:Array.from({length:12},(Te,Qe)=>Qe+1).map(Te=>l.jsx("option",{value:Te.toString().padStart(2,"0"),"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQwNjoyNA","data-yw-s":!0,children:Te.toString().padStart(2,"0")},Te))})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQxNDoxOA","data-yw-s":!0,children:[l.jsx("label",{className:"text-xs text-gray-500 mb-1 block","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQxNToyMA","data-yw-t":!0,"data-yw-s":!0,children:"Minute"}),l.jsx("select",{value:pe.minute,onChange:Te=>ve({...pe,minute:Te.target.value}),disabled:P,className:"w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-center font-medium",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQxNjoyMA","data-yw-s":!0,children:Array.from({length:60},(Te,Qe)=>Qe).map(Te=>l.jsx("option",{value:Te.toString().padStart(2,"0"),"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQyNDoyNA","data-yw-s":!0,children:Te.toString().padStart(2,"0")},Te))})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQzMjoxOA","data-yw-s":!0,children:[l.jsx("label",{className:"text-xs text-gray-500 mb-1 block","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQzMzoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Period"}),l.jsxs("select",{value:pe.period,onChange:Te=>ve({...pe,period:Te.target.value}),disabled:P,className:"w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed text-center font-medium",required:!0,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQzNDoyMA","data-yw-s":!0,children:[l.jsx("option",{value:"AM","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ0MToyMg","data-yw-t":!0,"data-yw-s":!0,children:"AM"}),l.jsx("option",{value:"PM","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ0MjoyMg","data-yw-t":!0,"data-yw-s":!0,children:"PM"})]})]})]})]}),l.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ0OToxNA","data-yw-s":!0,children:l.jsxs("label",{className:"block","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ1MDoxNg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ1MToxOA","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ1MjoyMA","data-yw-s":!0}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ1MzoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Available Seats"})]}),l.jsx("input",{type:"number",value:ue.availableSeats,onChange:Te=>oe({...ue,availableSeats:parseInt(Te.target.value)||1}),disabled:P,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",required:!0,min:"1",max:"8","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ1NToxOA","data-yw-s":!0})]})}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ3MToxNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ3MjoxNg","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ3MzoxOA","data-yw-s":!0}),l.jsx("span",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ3NDoxOA","data-yw-t":!0,"data-yw-s":!0,children:"Price Per Seat ($)"}),l.jsx("span",{className:"ml-auto text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ3NToxOA","data-yw-t":!0,"data-yw-s":!0,children:"Cannot be changed"})]}),l.jsxs("div",{className:"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-700 font-semibold text-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ3NzoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ3NzoxMzE","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),parseFloat(ue.pricePerSeat||"0").toFixed(2)]})]}),l.jsx("button",{type:"submit",disabled:P||B,className:"w-full bg-blue-600 text-white py-4 rounded-xl font-semibold hover:bg-blue-700 active:scale-95 transition-all min-h-touch shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ4MzoxNA","data-yw-s":!0,children:B?l.jsxs(l.Fragment,{children:[l.jsx(r_,{className:"w-5 h-5 animate-spin","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ5MDoyMA","data-yw-s":!0}),"Saving..."]}):l.jsxs(l.Fragment,{children:[l.jsx(oy,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9FZGl0UmlkZVBhZ2UudHN4QDQ5NToyMA","data-yw-s":!0}),"Save Changes"]})})]})]})})]})}):null}function ML(){const u=on(),{driverId:o}=Qp(),[d,g]=fe.useState(null),[j,Z]=fe.useState(null),[S,n]=fe.useState([]),[B,D]=fe.useState({totalTrips:0,completedTrips:0}),[P,G]=fe.useState(!0);fe.useEffect(()=>{o&&Y()},[o]);const Y=async()=>{G(!0);try{const{data:X,error:ue}=await It.from("profiles").select("*").eq("id",o).single();if(ue)throw ue;g(X);const{data:oe,error:pe}=await It.from("car_details").select("*").eq("user_id",o).single();!pe&&oe&&Z(oe);const{data:ve,error:ke}=await It.from("reviews").select(`
          *,
          reviewer:profiles!reviews_reviewer_id_fkey(id, name, profile_image)
        `).eq("reviewed_user_id",o).order("created_at",{ascending:!1}).limit(10);!ke&&ve&&n(ve);const{data:ye,error:$e}=await It.from("rides").select("id, status").eq("driver_id",o);if(!$e&&ye){const De=ye.length,Te=ye.filter(Qe=>Qe.status==="completed").length;D({totalTrips:De,completedTrips:Te})}}catch(X){console.error("Error loading driver data:",X)}finally{G(!1)}};return P?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA4MDo2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA4MTo4","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA4MjoxMA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA4MzoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Loading driver profile..."})]})}):d?l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMDY6NA","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMDc6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMTQ6OA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMTU6MTA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-white/10 rounded-full active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMTY6MTI","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMjA6MTQ","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMjI6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Driver Profile"})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMjc6OA","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMjk6MTA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-4 mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMzA6MTI","data-yw-s":!0,children:[d.profile_image?l.jsx("img",{src:d.profile_image,alt:d.name,className:"w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMzI6MTY","data-yw-s":!0}):l.jsx("div",{className:"w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center border-4 border-white shadow-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMzg6MTY","data-yw-s":!0,children:l.jsx(vg,{className:"w-12 h-12 text-white","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxMzk6MTg","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDI6MTQ","data-yw-s":!0,children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDM6MTY","data-yw-s":!0,children:d.name}),l.jsxs("div",{className:"flex items-center gap-1 mt-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDQ6MTY","data-yw-s":!0,children:[l.jsx(vs,{className:"w-6 h-6 text-yellow-500 fill-yellow-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDU6MTg","data-yw-s":!0}),l.jsx("span",{className:"text-xl font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDY6MTg","data-yw-s":!0,children:d.rating?.toFixed(1)||"5.0"}),l.jsxs("span",{className:"text-sm text-gray-600 ml-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDk6MTg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDk6NjM","data-yw-t":!0,"data-yw-auto":!0,children:"("}),S.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNDk6ODA","data-yw-t":!0,"data-yw-auto":!0,children:" reviews)"})]})]}),d.verified&&l.jsx("span",{className:"inline-block mt-2 px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNTI6MTg","data-yw-t":!0,"data-yw-s":!0,children:" Verified Driver"})]})]}),d.bio&&l.jsx("div",{className:"mt-3 bg-white/60 rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNjI6MTQ","data-yw-s":!0,children:l.jsx("p",{className:"text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNjM6MTY","data-yw-s":!0,children:d.bio})})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNjk6MTA","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzA6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzE6MTQ","data-yw-s":!0,children:[l.jsx(Yp,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzI6MTY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzI6NTA","data-yw-t":!0,"data-yw-auto":!0,children:"Total Trips"})]}),l.jsx("div",{className:"text-3xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzU6MTQ","data-yw-s":!0,children:B.totalTrips})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzc6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzg6MTQ","data-yw-s":!0,children:[l.jsx(bl,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzk6MTY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxNzk6NDg","data-yw-t":!0,"data-yw-auto":!0,children:"Completed"})]}),l.jsx("div",{className:"text-3xl font-bold text-green-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxODI6MTQ","data-yw-s":!0,children:B.completedTrips})]})]}),j&&l.jsxs("div",{className:"bg-white rounded-xl border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxODg6MTI","data-yw-s":!0,children:[l.jsx("div",{className:"p-4 border-b border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxODk6MTQ","data-yw-s":!0,children:l.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxOTA6MTY","data-yw-s":!0,children:[l.jsx(Wp,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxOTE6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxOTE6NTk","data-yw-t":!0,"data-yw-auto":!0,children:"Vehicle Information"})]})}),l.jsxs("div",{className:"p-4 space-y-3","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxOTU6MTQ","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxOTY6MTY","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxOTc6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Make & Model"}),l.jsxs("span",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAxOTg6MTg","data-yw-s":!0,children:[j.make," ",j.model]})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMDI6MTY","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMDM6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Year"}),l.jsx("span",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMDQ6MTg","data-yw-s":!0,children:j.year})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMDY6MTY","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMDc6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Color"}),l.jsx("span",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMDg6MTg","data-yw-s":!0,children:j.color})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMTA6MTY","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMTE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"License Plate"}),l.jsx("span",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMTI6MTg","data-yw-s":!0,children:j.license_plate})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMTQ6MTY","data-yw-s":!0,children:[l.jsx("span",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMTU6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Seats"}),l.jsx("span",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMTY6MTg","data-yw-s":!0,children:j.seats})]})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMjM6MTA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMjQ6MTI","data-yw-s":!0,children:[l.jsx(bl,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMjU6MTQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMjU6NDY","data-yw-t":!0,"data-yw-auto":!0,children:"Member Since"})]}),l.jsx("div",{className:"text-lg font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMjg6MTI","data-yw-s":!0,children:new Date(d.member_since||d.created_at).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMzg6MTA","data-yw-s":!0,children:[l.jsx("div",{className:"p-4 border-b border-gray-200","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyMzk6MTI","data-yw-s":!0,children:l.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNDA6MTQ","data-yw-s":!0,children:[l.jsx(eu,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNDE6MTY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNDE6Njc","data-yw-t":!0,"data-yw-auto":!0,children:"Reviews ("}),S.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNDI6NDE","data-yw-t":!0,"data-yw-auto":!0,children:")"})]})}),l.jsx("div",{className:"p-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNDU6MTI","data-yw-s":!0,children:S.length>0?l.jsx("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNDc6MTY","data-yw-s":!0,children:S.map(X=>l.jsxs("div",{className:"border-b border-gray-100 last:border-0 pb-4 last:pb-0","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNDk6MjA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNTM6MjI","data-yw-s":!0,children:[X.reviewer?.profile_image?l.jsx("img",{src:X.reviewer.profile_image,alt:X.reviewer.name,className:"w-10 h-10 rounded-full object-cover","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNTU6MjY","data-yw-s":!0}):l.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNjE6MjY","data-yw-s":!0,children:l.jsx(vg,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNjI6Mjg","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNjU6MjQ","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNjY6MjY","data-yw-s":!0,children:X.reviewer?.name||"Anonymous"}),l.jsx("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNjk6MjY","data-yw-s":!0,children:[...Array(5)].map((ue,oe)=>l.jsx(vs,{className:`w-4 h-4 ${oe<X.rating?"text-yellow-500 fill-yellow-500":"text-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyNzE6MzA","data-yw-s":!0},oe))})]}),l.jsx("span",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyODI6MjQ","data-yw-s":!0,children:new Date(X.created_at).toLocaleDateString()})]}),X.comment&&l.jsx("p",{className:"text-sm text-gray-700 ml-13","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyODc6MjQ","data-yw-s":!0,children:X.comment})]},X.id))}):l.jsxs("div",{className:"text-center py-8","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyOTM6MTY","data-yw-s":!0,children:[l.jsx(eu,{className:"w-12 h-12 text-gray-300 mx-auto mb-2","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyOTQ6MTg","data-yw-s":!0}),l.jsx("p",{className:"text-gray-500","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEAyOTU6MTg","data-yw-t":!0,"data-yw-s":!0,children:"No reviews yet"})]})})]})]})]})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA5MTo2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA5Mjo4","data-yw-s":!0,children:[l.jsx("p",{className:"text-gray-600 mb-4","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA5MzoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Driver not found"}),l.jsx("button",{onClick:()=>u(-1),className:"px-4 py-2 bg-blue-600 text-white rounded-lg","data-yw":"c3JjL3BhZ2VzL2RyaXZlci9Ecml2ZXJQcm9maWxlRGV0YWlsLnRzeEA5NDoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Go Back"})]})})}function qk(){const u=on(),[o,d]=fe.useState([]),[g,j]=fe.useState([]),[Z,S]=fe.useState(null),[n,B]=fe.useState(!0),[D,P]=fe.useState(!0),[G,Y]=fe.useState({totalRides:0,upcomingRides:0}),[X,ue]=fe.useState(null),[oe,pe]=fe.useState(null),[ve,ke]=fe.useState(!1);fe.useEffect(()=>{const De=ye();return()=>{De&&typeof De.then=="function"?De.then(Te=>{typeof Te=="function"&&Te()}):typeof De=="function"&&De()}},[]);const ye=async()=>{try{const De=await ui();if(!De){u("/auth");return}S(De),B(!1),P(!0);const Te=await tN(De.id),Qe=pv(Te);d(Qe);const Ft=Qe.length,bt=Qe.filter(st=>st.status==="accepted"||st.status==="pending").length;Y({totalRides:Ft,upcomingRides:bt});const Qt=Qe.find(st=>st.status==="accepted"&&st.ride?.status==="ongoing");if(ue(Qt||null),Qt&&Qt.ride?.id){const st=oN(Qt.ride.id,ht=>{pe(ht)});return P(!1),st}const Gt=new Date().toISOString().split("T")[0],yt=await eN({fromLat:43.6532,fromLng:-79.3832,toLat:43.6708,toLng:-79.3799,date:Gt,seats:1}),Ke=Bw(yt);j(Ke.slice(0,3))}catch(De){console.error("Error loading data:",De)}finally{P(!1)}},$e=De=>{const Te=new URLSearchParams;De.isSegmentBooking&&De.displayFrom&&De.displayTo&&(Te.set("from",De.displayFrom.address||""),Te.set("to",De.displayTo.address||""),Te.set("fromLat",De.displayFrom.lat?.toString()||""),Te.set("fromLng",De.displayFrom.lng?.toString()||""),Te.set("toLat",De.displayTo.lat?.toString()||""),Te.set("toLng",De.displayTo.lng?.toString()||""),Te.set("segmentPrice",De.displayPrice?.toString()||""),Te.set("segmentDistance",De.displayDistance?.toString()||""));const Qe=Te.toString()?`/rider/ride-preview/${De.id}?${Te.toString()}`:`/rider/ride-preview/${De.id}`;u(Qe)};return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTQ4OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTQ5OjY","data-yw-s":!0,children:[!Z&&n?l.jsx("div",{className:"flex-1 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTU2OjEw","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTU3OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTU4OjE0","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTU5OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):Z?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex-none bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTY1OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTY2OjE0","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTY3OjE2","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTY4OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Welcome back!"}),l.jsx("p",{className:"text-blue-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTY5OjE4","data-yw-s":!0,children:Z.name})]}),l.jsx(YZ,{onOpen:()=>ke(!0),className:"p-2 bg-white/20 rounded-full hover:bg-white/30 active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTcxOjE2","data-yw-s":!0})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTc4OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTc5OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTgwOjE4","data-yw-s":!0,children:[l.jsx(Yp,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTgxOjIw","data-yw-s":!0}),l.jsx("span",{className:"text-xs font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTgyOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Total Rides"})]}),l.jsx("div",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTg0OjE4","data-yw-s":!0,children:G.totalRides})]}),l.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTg3OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTg4OjE4","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTg5OjIw","data-yw-s":!0}),l.jsx("span",{className:"text-xs font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTkwOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Upcoming"})]}),l.jsx("div",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTkyOjE4","data-yw-s":!0,children:G.upcomingRides})]})]})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 pb-24","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTk4OjEy","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMTk5OjE0","data-yw-s":!0,children:[X&&X.ride?.status==="ongoing"&&l.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 overflow-hidden","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjAyOjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"px-4 pt-3 pb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjAzOjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjA0OjIy","data-yw-s":!0,children:[l.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjA1OjI0","data-yw-s":!0,children:[l.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjA2OjI2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjA2Ojk2","data-yw-t":!0,"data-yw-auto":!0,children:"Driver Approaching"})]}),l.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-1 rounded-full font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjA5OjI0","data-yw-t":!0,"data-yw-s":!0,children:"ACTIVE"})]}),l.jsxs("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjEzOjIy","data-yw-s":!0,children:[X.pickup_location?.address,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjE0OjY0","data-yw-t":!0,"data-yw-auto":!0,children:"  "}),X.dropoff_location?.address]})]}),l.jsx("div",{className:"h-[500px]","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjE3OjIw","data-yw-s":!0,children:l.jsx(lN,{rideId:X.ride.id,pickupLocation:X.pickup_location,dropoffLocation:X.dropoff_location,role:"rider","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjE4OjIy","data-yw-s":!0})})]}),D?l.jsx(_v,{count:2,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjMxOjE4","data-yw-s":!0}):o.length>0?l.jsxs("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjMzOjE4","data-yw-s":!0,children:[o.slice(0,2).map(De=>{}),o.length>2&&l.jsxs("button",{onClick:()=>u("/rider/trips"),className:"w-full text-center text-blue-600 font-medium py-2 hover:bg-blue-50 rounded-lg transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjM2OjIy","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjM5OjIz","data-yw-t":!0,"data-yw-auto":!0,children:"View All Bookings ("}),o.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjQwOjYw","data-yw-t":!0,"data-yw-auto":!0,children:")"})]})]}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center space-y-3 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjQ1OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjQ2OjIw","data-yw-s":!0,children:l.jsx(Yo,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjQ3OjIy","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjQ5OjIw","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjUwOjIy","data-yw-t":!0,"data-yw-s":!0,children:"No bookings yet"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjUxOjIy","data-yw-t":!0,"data-yw-s":!0,children:"Start your journey by finding a ride"})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjU2OjE2","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjU3OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Available Rides"}),l.jsx("button",{onClick:()=>u("/rider/find-ride"),className:"text-blue-600 text-sm font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjU4OjE4","data-yw-t":!0,"data-yw-s":!0,children:"See All"})]}),g.length>0?l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjY3OjE4","data-yw-s":!0,children:g.map(De=>l.jsxs("div",{onClick:()=>$e(De),className:"bg-white rounded-xl p-4 shadow-sm border border-blue-100 active:scale-98 transition-all","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjY5OjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjc1OjI0","data-yw-s":!0,children:[De.driver?.profile_image?l.jsx(bg,{src:De.driver.profile_image,alt:De.driver.name,className:"w-12 h-12 rounded-full object-cover border-2 border-gray-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjc3OjI4","data-yw-s":!0}):l.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjgzOjI4","data-yw-s":!0,children:l.jsx("span",{className:"text-gray-600 font-semibold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjg0OjMw","data-yw-s":!0,children:De.driver?.name?.charAt(0)||"?"})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjg5OjI2","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjkwOjI4","data-yw-s":!0,children:De.driver?.name||"Driver"}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjkxOjI4","data-yw-s":!0,children:[l.jsx(vs,{className:"w-4 h-4 text-yellow-500 fill-yellow-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjkyOjMw","data-yw-s":!0}),l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjkzOjMw","data-yw-s":!0,children:De.driver?.rating?.toFixed(1)||"5.0"})]})]}),l.jsxs("div",{className:"text-right","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjk2OjI2","data-yw-s":!0,children:[l.jsxs("p",{className:"text-lg font-bold text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjk3OjI4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMjk3Ojc1","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),(De.displayPrice||De.price_per_seat).toFixed(2)]}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzAwOjI4","data-yw-t":!0,"data-yw-s":!0,children:"per seat"})]})]}),l.jsxs("div",{className:"space-y-2 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzA1OjI0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzA2OjI2","data-yw-s":!0,children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-green-600 mt-1.5 flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzA3OjI4","data-yw-s":!0}),l.jsx("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzA4OjI4","data-yw-s":!0,children:l.jsx("p",{className:"text-sm font-medium text-gray-900 truncate","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzA5OjMw","data-yw-s":!0,children:De.displayFrom?.address||De.from_location?.address||"Pickup"})})]}),l.jsxs("div",{className:"flex items-start gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzE0OjI2","data-yw-s":!0,children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-red-600 mt-1.5 flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzE1OjI4","data-yw-s":!0}),l.jsx("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzE2OjI4","data-yw-s":!0,children:l.jsx("p",{className:"text-sm font-medium text-gray-900 truncate","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzE3OjMw","data-yw-s":!0,children:De.displayTo?.address||De.to_location?.address||"Dropoff"})})]})]}),l.jsx("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzI1OjI0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzI2OjI2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzI3OjI4","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzI4OjMw","data-yw-s":!0}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzI5OjMw","data-yw-s":!0,children:[De.available_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzI5OjU4","data-yw-t":!0,"data-yw-auto":!0,children:" seats"})]})]}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzMxOjI4","data-yw-s":!0,children:[l.jsx(ws,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzMyOjMw","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzMzOjMw","data-yw-s":!0,children:Cl(De.time)})]})]})})]},De.id))}):l.jsxs("div",{className:"bg-white rounded-xl p-6 text-center shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzQxOjE4","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzQyOjIw","data-yw-t":!0,"data-yw-s":!0,children:"No available rides at the moment"}),l.jsx("button",{onClick:()=>u("/rider/find-ride"),className:"mt-3 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg active:bg-blue-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzQzOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Search Rides"})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzUyOjE2","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzUzOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Quick Actions"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzU0OjE4","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u("/rider/trips"),className:"bg-blue-50 text-blue-700 py-3 rounded-lg font-medium hover:bg-blue-100 active:scale-95 transition-all border border-blue-200 min-h-touch","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzU1OjIw","data-yw-t":!0,"data-yw-s":!0,children:"My Trips"}),l.jsx("button",{onClick:()=>u("/rider/find-ride"),className:"bg-green-50 text-green-700 py-3 rounded-lg font-medium hover:bg-green-100 active:scale-95 transition-all border border-green-200 min-h-touch","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzYxOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Find Ride"})]})]})]})})]}):null,l.jsx(qf,{active:"home",userType:"rider","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzc1Ojg","data-yw-s":!0}),l.jsx($Z,{isOpen:ve,onClose:()=>ke(!1),"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVySG9tZS50c3hAMzc4Ojg","data-yw-s":!0})]})})}const Kk=["all","pending","confirmed","in-progress","completed","canceled"],BL={all:"bg-gray-100 text-gray-700",searching:"bg-gray-100 text-gray-700",pending:"bg-yellow-100 text-yellow-700",confirmed:"bg-green-100 text-green-700","in-progress":"bg-blue-100 text-blue-700",completed:"bg-gray-100 text-gray-500",canceled:"bg-red-100 text-red-700"};function eJ(){const u=on(),[o,d]=fe.useState([]),[g,j]=fe.useState([]),[Z,S]=fe.useState("all"),[n,B]=fe.useState(null),[D,P]=fe.useState(!0),[G,Y]=fe.useState(!1),[X,ue]=fe.useState(null),[oe,pe]=fe.useState(new Set);fe.useEffect(()=>{ve()},[u]);const ve=async()=>{const De=await ui();if(!De||De.userType!=="rider"){u("/");return}B(De);const Te=await tN(De.id);console.log("[RiderTrips] Fetched bookings:",Te.length,Te);const Qe=pv(Te);console.log("[RiderTrips] After cleanup:",Qe.length,Qe),d(Qe),P(!1),await ke(De.id,Qe)},ke=async(De,Te)=>{const Qe=Te.filter(Qt=>Qt.status==="accepted"&&Qt.ride?.status==="completed"),Ft=new Set;let bt=null;for(const Qt of Qe)await Jw(De,Qt.ride.driver_id,Qt.ride_id)||(Ft.add(Qt.id),bt||(bt=Qt));pe(Ft),bt&&(ue(bt),Y(!0))},ye=async(De,Te)=>{if(!n||!X)return;await dN(n.id,{reviewed_user_id:X.ride.driver_id,ride_id:X.ride_id,rating:De,comment:Te})&&(Y(!1),ue(null),await ke(n.id,o))};fe.useEffect(()=>{if(Z==="all")j(o);else{const De={pending:"pending",accepted:"confirmed",rejected:"canceled",cancelled:"canceled"};j(o.filter(Te=>De[Te.status]===Z||Te.status===Z))}},[Z,o]);const $e=De=>{De.status==="accepted"&&De.ride?.status==="completed"&&n?Jw(n.id,De.ride.driver_id,De.ride_id).then(Te=>{Te?u(`/rider/ride-detail/${De.id}`):(ue(De),Y(!0))}):u(`/rider/ride-detail/${De.id}`)};return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-full h-dvh bg-gradient-to-b from-blue-50 to-white","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE1Njo2","data-yw-s":!0,children:l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE1Nzo4","data-yw-s":!0,children:[l.jsxs("header",{className:"flex-none px-4 pt-4 pb-3 bg-white shadow-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE2NToxMA","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE2NjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"My Trips"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE2NzoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Track your ride requests"})]}),l.jsx("div",{className:"flex-none px-4 py-3 bg-white border-b border-gray-200 overflow-x-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE3MToxMA","data-yw-s":!0,children:l.jsx("div",{className:"flex gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE3MjoxMg","data-yw-s":!0,children:Kk.map(De=>l.jsx("button",{onClick:()=>S(De),className:`px-4 py-2 rounded-full text-xs font-medium whitespace-nowrap ${Z===De?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE3NDoxNg","data-yw-s":!0,children:De==="all"?"All":De.replace("-"," ").toUpperCase()},De))})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 pb-24 space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5MDoxMA","data-yw-s":!0,children:D?l.jsx(_v,{count:5,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5MjoxNA","data-yw-s":!0}):g.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5NDoxNA","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-16 h-16 text-gray-300 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5NToxNg","data-yw-s":!0}),l.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5NjoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5Njo3Mw","data-yw-t":!0,"data-yw-auto":!0,children:"No "}),Z!=="all"?Z:"",l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5Nzo2NQ","data-yw-t":!0,"data-yw-auto":!0,children:" Trips"})]}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDE5OToxNg","data-yw-s":!0,children:Z==="all"?"Start your journey by finding a ride":`No trips with ${Z} status`})]}):g.map(De=>{const Qe={pending:"pending",accepted:"confirmed",rejected:"canceled",cancelled:"canceled"}[De.status]||De.status;return l.jsxs("div",{onClick:()=>$e(De),className:"bg-white rounded-xl shadow-md p-4 active:bg-gray-50 transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIxNjoxOA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIyMjoyMA","data-yw-s":!0,children:[l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${BL[Qe]||BL.pending}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIyMzoyMg","data-yw-s":!0,children:De.status.toUpperCase()}),l.jsx(zg,{className:"w-5 h-5 text-gray-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIyNjoyMg","data-yw-s":!0})]}),De.ride?.driver&&l.jsxs("div",{className:"flex items-center gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIzMToyMg","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIzMjoyNA","data-yw-s":!0,children:l.jsx(bg,{src:De.ride.driver.profile_image||"",alt:De.ride.driver.name||"Driver",className:"w-12 h-12 rounded-full object-cover","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIzMzoyNg","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDIzOToyNA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI0MDoyNg","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI0MToyOA","data-yw-s":!0,children:De.ride.driver.name}),l.jsx(uN,{rating:De.ride.driver.rating,pending:oe.has(De.id),"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI0MjoyOA","data-yw-s":!0})]}),De.ride.car_details?.[0]&&l.jsxs("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI0ODoyOA","data-yw-s":!0,children:[De.ride.car_details[0].make," ",De.ride.car_details[0].model]})]})]}),l.jsxs("div",{className:"space-y-2 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI1NzoyMA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI1ODoyMg","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600 mt-1 flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI1OToyNA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2MDoyNA","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2MToyNg","data-yw-s":!0,children:De.pickup_location?.address}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2MjoyNg","data-yw-s":!0,children:Cl(De.ride?.time)})]})]}),l.jsxs("div",{className:"flex items-start gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2NToyMg","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-red-600 mt-1 flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2NjoyNA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2NzoyNA","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2ODoyNg","data-yw-s":!0,children:De.dropoff_location?.address}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI2OToyNg","data-yw-s":!0,children:De.ride?.estimated_arrival||"Est. arrival"})]})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI3NToyMA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI3NjoyMg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI3NzoyNA","data-yw-s":!0,children:[l.jsx(vg,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI3ODoyNg","data-yw-s":!0}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI3OToyNg","data-yw-s":!0,children:[De.requested_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI3OTo1Nw","data-yw-t":!0,"data-yw-auto":!0,children:" seat"}),De.requested_seats>1?"s":""]})]}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI4MToyNA","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI4MjoyNg","data-yw-s":!0}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI4MzoyNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI4MzozMg","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),De.price?.[0]?.price_cents?(De.price[0].price_cents/100).toFixed(2):(De.requested_seats*(De.ride?.price_per_seat||0)).toFixed(2)]})]})]}),l.jsx("div",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDI5MDoyMg","data-yw-s":!0,children:De.ride?.date})]})]},De.id)})}),l.jsx(qf,{active:"trips",userType:"rider","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDMwMToxMA","data-yw-s":!0})]})}),G&&X&&l.jsx(cN,{isOpen:G,onClose:()=>{Y(!1),ue(null)},onSubmit:ye,userName:X.ride?.driver?.name||"Driver",userImage:X.ride?.driver?.profile_image,userType:"driver","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyVHJpcHMudHN4QDMwNzo4","data-yw-s":!0})]})}const IL=typeof window<"u"&&window.ywConfig?.mapbox_token||"";function tJ(){const{requestId:u}=Qp(),o=on(),[d,g]=fe.useState(null),[j,Z]=fe.useState(!0),[S,n]=fe.useState(!1),[B,D]=fe.useState(null),[P,G]=fe.useState(!1);fe.useEffect(()=>{Y()},[u]);const Y=async()=>{if(!u){Z(!1);return}try{const oe=await yv(u);if(!oe){console.error(`[RideDetailPage] Booking not found: ${u}`),console.error("[RideDetailPage] This may be due to: invalid ID, RLS policy restrictions, or deleted record"),g(null),Z(!1);return}if(g(oe),oe.pickup_location?.lat&&oe.pickup_location?.lng&&oe.dropoff_location?.lat&&oe.dropoff_location?.lng&&IL){G(!0);const pe=await xv(oe.pickup_location.lat,oe.pickup_location.lng,oe.dropoff_location.lat,oe.dropoff_location.lng,IL);pe?D(pe):console.warn("Failed to calculate route, using database values as fallback"),G(!1)}}catch(oe){console.error("Error loading booking details:",oe),g(null)}finally{Z(!1)}},X=()=>{o(`/rider/chat/${d?.id}`)};if(j)return l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA4NTo2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA4Njo4","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA4NzoxMA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA4ODoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Loading ride details..."})]})});if(!d)return l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA5Njo2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center px-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA5Nzo4","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA5ODoxMA","data-yw-s":!0,children:l.jsx(Gp,{className:"w-8 h-8 text-red-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEA5OToxMg","data-yw-s":!0})}),l.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMDE6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Booking Not Found"}),l.jsx("p",{className:"text-gray-600 mb-6 max-w-sm mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMDI6MTA","data-yw-t":!0,"data-yw-s":!0,children:"This booking may have been deleted, cancelled, or you may not have access to it."}),l.jsx("button",{onClick:()=>o("/rider/home"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMDU6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Back to Home"})]})});const ue={pending:"bg-yellow-100 text-yellow-700",accepted:"bg-green-100 text-green-700",rejected:"bg-red-100 text-red-700",cancelled:"bg-gray-100 text-gray-700"};return l.jsxs("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMjQ6NA","data-yw-s":!0,children:[l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMjU6Ng","data-yw-s":!0,children:[l.jsxs("header",{className:"flex-none px-4 py-3 bg-white shadow-sm flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMzM6OA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>o(-1),className:"p-2 active:bg-gray-100 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMzQ6MTA","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMzU6MTI","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxMzc6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Ride Details"})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNDE6OA","data-yw-s":!0,children:[l.jsx("div",{className:"bg-white p-4 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNDM6MTA","data-yw-s":!0,children:l.jsx("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNDQ6MTI","data-yw-s":!0,children:l.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-medium ${ue[d.status]||"bg-gray-100 text-gray-700"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNDU6MTQ","data-yw-s":!0,children:d.status.toUpperCase()})})}),l.jsxs("div",{className:"bg-white p-4 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNTI6MTA","data-yw-s":!0,children:[l.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNTM6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Driver Information"}),l.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNTQ6MTI","data-yw-s":!0,children:[d.ride?.driver?.profile_image?l.jsx("img",{src:d.ride.driver.profile_image,alt:d.ride.driver.name,className:"w-16 h-16 rounded-full object-cover","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNTY6MTY","data-yw-s":!0}):l.jsx("div",{className:"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNjI6MTY","data-yw-s":!0,children:l.jsx("span",{className:"text-white font-bold text-xl","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNjM6MTg","data-yw-s":!0,children:d.ride?.driver?.name?.charAt(0)||"?"})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNjg6MTQ","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNjk6MTY","data-yw-s":!0,children:d.ride?.driver?.name||"Driver"}),l.jsxs("div",{className:"flex items-center gap-1 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNzA6MTY","data-yw-s":!0,children:[l.jsx("span",{className:"text-yellow-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNzE6MTg","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxNzI6MTg","data-yw-s":!0,children:d.ride?.driver?.rating?.toFixed(1)||"5.0"})]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODE6MTA","data-yw-s":!0,children:[l.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODI6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Trip Details"}),l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODM6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODU6MTQ","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-green-600 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODY6MTY","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODc6MTY","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODg6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Pickup"}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxODk6MTg","data-yw-s":!0,children:d.pickup_location?.address||"N/A"}),l.jsxs("div",{className:"flex items-center gap-1 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxOTA6MTg","data-yw-s":!0,children:[l.jsx(ws,{className:"w-3 h-3 text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxOTE6MjA","data-yw-s":!0}),l.jsxs("span",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxOTI6MjA","data-yw-s":!0,children:[d.ride?.date," ",Cl(d.ride?.time)]})]})]})]}),l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxOTg6MTQ","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-red-600 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAxOTk6MTY","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMDA6MTY","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMDE6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Dropoff"}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMDI6MTg","data-yw-s":!0,children:d.dropoff_location?.address||"N/A"})]})]})]})]}),(B||P)&&l.jsxs("div",{className:"bg-white p-4 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMTA6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMTE6MTQ","data-yw-s":!0,children:[l.jsx(Xp,{className:"w-4 h-4 text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMTI6MTY","data-yw-s":!0}),l.jsx("h3",{className:"text-sm font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMTM6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Route Information"})]}),P?l.jsxs("div",{className:"flex items-center justify-center py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMTc6MTY","data-yw-s":!0,children:[l.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMTg6MTg","data-yw-s":!0}),l.jsx("span",{className:"ml-2 text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMTk6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Calculating route..."})]}):B?l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMjI6MTY","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMjM6MTg","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMjQ6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Distance"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMjU6MjA","data-yw-s":!0,children:wv(B.distance)})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMjc6MTg","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMjg6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Duration"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMjk6MjA","data-yw-s":!0,children:l_(B.duration)})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMzE6MTg","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMzI6MjA","data-yw-t":!0,"data-yw-s":!0,children:"Estimated Arrival"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMzM6MjA","data-yw-s":!0,children:B.eta})]}),l.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMzU6MTg","data-yw-s":!0,children:l.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMzY6MjA","data-yw-s":!0,children:[l.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMzc6MjI","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyMzc6OTQ","data-yw-t":!0,"data-yw-auto":!0,children:"Live route data via Mapbox"})]})})]}):null]}),l.jsxs("div",{className:"bg-white p-4 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNDc6MTA","data-yw-s":!0,children:[l.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNDg6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Booking Summary"}),l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNDk6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNTA6MTQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNTE6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Seats Booked"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNTI6MTY","data-yw-s":!0,children:d.requested_seats})]}),l.jsxs("div",{className:"flex justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNTQ6MTQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNTU6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Price per Seat"}),l.jsxs("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNTY6MTY","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNTY6Njg","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),d.price?.[0]?.price_cents?(d.price[0].price_cents/100/d.requested_seats).toFixed(2):d.ride?.price_per_seat?.toFixed(2)||"0.00"]})]}),l.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNjI6MTQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-base font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNjM6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Total Amount"}),l.jsxs("span",{className:"text-base font-semibold text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNjQ6MTY","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNjQ6NzI","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),d.price?.[0]?.price_cents?(d.price[0].price_cents/100).toFixed(2):((d.ride?.price_per_seat||0)*d.requested_seats).toFixed(2)]})]})]})]})]}),l.jsx("div",{className:"flex-none bg-white border-t border-gray-200 p-4 space-y-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNzU6OA","data-yw-s":!0,children:d.status==="pending"?l.jsxs(l.Fragment,{children:[l.jsxs("button",{onClick:X,className:"w-full py-3 bg-blue-600 text-white font-medium rounded-lg flex items-center justify-center gap-2 active:bg-blue-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyNzg6MTQ","data-yw-s":!0,children:[l.jsx(eu,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyODI6MTY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyODI6NTM","data-yw-t":!0,"data-yw-auto":!0,children:"Contact Driver"})]}),l.jsxs("button",{onClick:()=>n(!0),className:"w-full py-3 bg-red-50 text-red-600 font-medium rounded-lg flex items-center justify-center gap-2 active:bg-red-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyODU6MTQ","data-yw-s":!0,children:[l.jsx(Gp,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyODk6MTY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyODk6NDc","data-yw-t":!0,"data-yw-auto":!0,children:"Cancel Ride"})]})]}):d.status==="accepted"?l.jsxs(l.Fragment,{children:[l.jsxs("button",{onClick:X,className:"w-full py-3 bg-blue-600 text-white font-medium rounded-lg flex items-center justify-center gap-2 active:bg-blue-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyOTU6MTQ","data-yw-s":!0,children:[l.jsx(eu,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyOTk6MTY","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAyOTk6NTM","data-yw-t":!0,"data-yw-auto":!0,children:"Contact Driver"})]}),d.ride?.status==="scheduled"&&l.jsxs("button",{onClick:()=>n(!0),className:"w-full py-3 bg-red-50 text-red-600 font-medium rounded-lg flex items-center justify-center gap-2 active:bg-red-100 border border-red-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAzMDM6MTY","data-yw-s":!0,children:[l.jsx(Gp,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAzMDc6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAzMDc6NDk","data-yw-t":!0,"data-yw-auto":!0,children:"Cancel Ride"})]})]}):d.status==="rejected"?l.jsx("button",{onClick:()=>o("/rider/home"),className:"w-full py-3 bg-gray-600 text-white font-medium rounded-lg active:bg-gray-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAzMTM6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Back to Home"}):null})]}),d&&d.passenger&&d.ride&&l.jsx(yN,{isOpen:S,onClose:()=>n(!1),rideId:d.ride.id,userId:d.passenger.id,userRole:"passenger",rideName:`${d.pickup_location?.address||d.ride.from_location?.address||"Unknown"}  ${d.dropoff_location?.address||d.ride.to_location?.address||"Unknown"}`,bookingId:d.id,onCancellationSuccess:()=>{n(!1),o("/rider/home")},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVEZXRhaWxQYWdlLnRzeEAzMjU6OA","data-yw-s":!0})]})}const kL=typeof window<"u"&&window.ywConfig?.mapbox_token||"pk.YOUR_MAPBOX_ACCESS_TOKEN_HERE";function aJ(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(""),[Z,S]=fe.useState(null),[n,B]=fe.useState(""),[D,P]=fe.useState(""),[G,Y]=fe.useState("1"),X=()=>{if(!o||!Z){alert("Please select both pickup and dropoff locations from the suggestions");return}const ue=new URLSearchParams({from:o.address,to:Z.address,fromLat:o.lat.toString(),fromLng:o.lng.toString(),toLat:Z.lat.toString(),toLng:Z.lng.toString(),...D&&{date:D},passengers:G});u(`/rider/available-rides?${ue.toString()}`)};return l.jsx("div",{className:"w-full h-dvh bg-gradient-to-b from-blue-50 to-white","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANDA6NA","data-yw-s":!0,children:l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANDE6Ng","data-yw-s":!0,children:[l.jsxs("header",{className:"flex-none px-4 py-3 bg-white shadow-sm flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANDk6OA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 active:bg-gray-100 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANTA6MTA","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANTE6MTI","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANTM6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Find a Ride"})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANTc6OA","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANTg6MTA","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANjA6MTI","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANjE6MTQ","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANjI6MTY","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANjM6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANjM6NzQ","data-yw-t":!0,"data-yw-auto":!0,children:"Pickup Location"})]})}),l.jsx(hg,{value:g,onChange:ue=>j(ue),onSelectLocation:ue=>{d(ue),j(ue.address)},placeholder:"Enter pickup address, mall, landmark...",mapboxToken:kL,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hANjc6MTQ","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAODA6MTI","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAODE6MTQ","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAODI6MTY","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-red-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAODM6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAODM6NzM","data-yw-t":!0,"data-yw-auto":!0,children:"Dropoff Location"})]})}),l.jsx(hg,{value:n,onChange:ue=>B(ue),onSelectLocation:ue=>{S(ue),B(ue.address)},placeholder:"Enter dropoff address, mall, landmark...",mapboxToken:kL,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAODc6MTQ","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTAwOjEy","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTAxOjE0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTAyOjE2","data-yw-s":!0,children:[l.jsx(bl,{className:"w-4 h-4 text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTAzOjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTAzOjY0","data-yw-t":!0,"data-yw-auto":!0,children:"Date"})]})}),l.jsx("input",{type:"date",value:D,onChange:ue=>P(ue.target.value),min:(()=>{const ue=new Date,oe=ue.getFullYear(),pe=String(ue.getMonth()+1).padStart(2,"0"),ve=String(ue.getDate()).padStart(2,"0");return`${oe}-${pe}-${ve}`})(),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTA1OjE0","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTIxOjEy","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTIyOjE0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTIzOjE2","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-4 h-4 text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTI0OjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTI0OjYx","data-yw-t":!0,"data-yw-auto":!0,children:"Number of Passengers"})]})}),l.jsx("select",{value:G,onChange:ue=>Y(ue.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTI4OjE0","data-yw-s":!0,children:[1,2,3,4,5,6].map(ue=>l.jsxs("option",{value:ue,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTM0OjE4","data-yw-s":!0,children:[ue," ",ue===1?"Passenger":"Passengers"]},ue))})]}),l.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mt-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTQwOjEy","data-yw-s":!0,children:[l.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTQxOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Search Tips"}),l.jsxs("ul",{className:"text-xs text-blue-800 space-y-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTQyOjE0","data-yw-s":!0,children:[l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTQzOjE2","data-yw-t":!0,"data-yw-s":!0,children:" Enter full addresses for better results"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTQ0OjE2","data-yw-t":!0,"data-yw-s":!0,children:" Leave date empty to see all available rides"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTQ1OjE2","data-yw-t":!0,"data-yw-s":!0,children:" Segment booking available for OnGoPool drivers"})]})]})]})}),l.jsx("div",{className:"flex-none bg-white border-t border-gray-200 p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTUyOjg","data-yw-s":!0,children:l.jsxs("button",{onClick:X,className:"w-full py-4 bg-blue-600 text-white font-semibold rounded-lg flex items-center justify-center gap-2 active:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",disabled:!o||!Z,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTUzOjEw","data-yw-s":!0,children:[l.jsx(XZ,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTU4OjEy","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0ZpbmRSaWRlUGFnZS50c3hAMTU4OjQy","data-yw-t":!0,"data-yw-auto":!0,children:"Search Available Rides"})]})})]})})}function rJ(u,o,d){if(!u||!u.stops||u.stops.length<2)return null;const g=u.stops.findIndex(B=>B.address===o||B.name===o),j=u.stops.findIndex(B=>B.address===d||B.name===d);if(g===-1||j===-1||g>=j)return null;const Z=u.stops[g].cumulativeDistance||0;return((u.stops[j].cumulativeDistance||0)-Z)/1e3}const J0=typeof window<"u"&&window.ywConfig?.mapbox_token||"";function nJ(){const u=on(),[o]=ev(),[d,g]=fe.useState([]),[j,Z]=fe.useState(!0),[S,n]=fe.useState(new Map),[B,D]=fe.useState(new Set),P=o.get("from")||"",G=o.get("to")||"",Y=o.get("fromLat"),X=o.get("fromLng"),ue=o.get("toLat"),oe=o.get("toLng"),pe=o.get("date")||"",ve=o.get("passengers")||"1";fe.useEffect(()=>{ke()},[P,G,pe,ve,Y,X,ue,oe]);const ke=async()=>{Z(!0);try{if(!Y||!X||!ue||!oe){console.error("Missing location coordinates"),g([]),Z(!1);return}const Te=pe||new Date().toISOString().split("T")[0];console.log(" SEARCH PARAMETERS:"),console.log("From:",P,`(${Y}, ${X})`),console.log("To:",G,`(${ue}, ${oe})`),console.log("Date:",Te),console.log("Passengers:",ve);const Qe=await eN({fromLat:parseFloat(Y),fromLng:parseFloat(X),toLat:parseFloat(ue),toLng:parseFloat(oe),date:Te,seats:parseInt(ve)});console.log(` Found ${Qe.length} rides`),g(Qe),J0&&ye(Qe)}catch(Te){console.error("Error loading rides:",Te)}finally{Z(!1)}},ye=async Te=>{const Qe=new Set;for(const Gt of Te)Gt.route_stops&&Gt.route_stops.length>=2&&Qe.add(Gt.id);D(Qe);const Ft=Te.filter(Gt=>Gt.route_stops&&Gt.route_stops.length>=2).map(async Gt=>{try{const yt=new Date(`${Gt.date}T${Gt.time}`),Ke=await vv(Gt.route_stops,yt,J0);if(Ke)return{rideId:Gt.id,routeData:Ke}}catch(yt){console.warn(`Failed to calculate route for ride ${Gt.id}:`,yt)}return null}),bt=await Promise.all(Ft),Qt=new Map(S);bt.forEach(Gt=>{Gt&&Qt.set(Gt.rideId,Gt.routeData)}),n(Qt),D(new Set)},$e=Te=>{const Qe=new URLSearchParams;Te.isSegmentBooking&&Te.displayFrom&&Te.displayTo&&(Qe.set("from",Te.displayFrom.address||""),Qe.set("to",Te.displayTo.address||""),Qe.set("fromLat",Te.displayFrom.lat?.toString()||""),Qe.set("fromLng",Te.displayFrom.lng?.toString()||""),Qe.set("toLat",Te.displayTo.lat?.toString()||""),Qe.set("toLng",Te.displayTo.lng?.toString()||""),Qe.set("segmentPrice",Te.displayPrice?.toString()||""),Qe.set("segmentDistance",Te.displayDistance?.toString()||""));const Ft=Qe.toString()?`/rider/ride-preview/${Te.id}?${Qe.toString()}`:`/rider/ride-preview/${Te.id}`;u(Ft)},De=({ride:Te})=>{const Qe=Te.displayFrom||Te.from_location,Ft=Te.displayTo||Te.to_location,bt=Te.displayPrice||Te.price_per_seat,Qt=Te.displayDistance||Te.distance,Gt=Te.isSegmentBooking||!1,yt=S.get(Te.id),Ke=B.has(Te.id),st=Qe?.estimated_arrival||Qe?.time||Te.time;let ht=null;if(yt&&Ft?.address){const Wt=yt.stops.find(qt=>qt.address===Ft.address||qt.name===Ft.address);Wt?ht=Wt.eta:ht=yt.stops[yt.stops.length-1]?.eta}return l.jsxs("div",{onClick:()=>$e(Te),className:"bg-white rounded-xl shadow-md p-4 active:bg-gray-50 transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTc4OjY","data-yw-s":!0,children:[Gt&&l.jsx("div",{className:"mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTg0OjEw","data-yw-s":!0}),l.jsxs("div",{className:"flex items-center gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTkwOjg","data-yw-s":!0,children:[l.jsx("img",{src:Te.driver?.profile_image||"/assets/placeholder-avatar.jpg",alt:Te.driver?.name||"Driver",className:"w-12 h-12 rounded-full object-cover","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTkxOjEw","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTk2OjEw","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTk3OjEy","data-yw-s":!0,children:Te.driver?.name||"Driver"}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTk4OjEy","data-yw-s":!0,children:[l.jsx(vs,{className:"w-4 h-4 text-yellow-500 fill-yellow-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMTk5OjE0","data-yw-s":!0}),l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjAwOjE0","data-yw-s":!0,children:Te.driver?.rating?.toFixed(1)||"5.0"})]})]}),l.jsxs("div",{className:"text-right","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjAzOjEw","data-yw-s":!0,children:[l.jsxs("p",{className:"text-lg font-bold text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjA0OjEy","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjA0OjU5","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),bt.toFixed(2)]}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjA1OjEy","data-yw-t":!0,"data-yw-s":!0,children:"per seat"}),Gt&&l.jsx("p",{className:"text-xs text-purple-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjA3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"price"})]})]}),l.jsxs("div",{className:"space-y-2 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjEyOjg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjEzOjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-600 mt-1.5 flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjE0OjEy","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjE1OjEy","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjE2OjE0","data-yw-s":!0,children:Qe?.address||"Pickup location"}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjE5OjE0","data-yw-s":!0,children:Cl(st)})]})]}),Gt,!Gt&&Te.route_stops&&Te.route_stops.length>0,l.jsxs("div",{className:"flex items-start gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjI0OjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-red-600 mt-1.5 flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjI1OjEy","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjI2OjEy","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjI3OjE0","data-yw-s":!0,children:Ft?.address||"Dropoff location"}),l.jsx("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjMwOjE0","data-yw-s":!0,children:Ke?l.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjMyOjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 border-2 border-gray-400 border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjMzOjIw","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjM0OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Calculating..."})]}):ht?l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjM3OjE4","data-yw-s":!0,children:[l.jsx("p",{className:"text-xs text-gray-900 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjM4OjIw","data-yw-s":!0,children:Cl(ht)}),l.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-green-500 rounded-full",title:"Real-time road-based ETA","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjM5OjIw","data-yw-s":!0})]}):l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjQyOjE4","data-yw-s":!0,children:Cl(Ft?.estimatedArrival||Te.estimated_arrival||"")})})]})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjQ5Ojg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjUwOjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjUxOjEy","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjUyOjE0","data-yw-s":!0}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjUzOjE0","data-yw-s":!0,children:[Te.available_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjUzOjQy","data-yw-t":!0,"data-yw-auto":!0,children:" seats"})]})]}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjU1OjEy","data-yw-s":!0,children:[l.jsx(ws,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjU2OjE0","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjU3OjE0","data-yw-s":!0,children:Te.date})]})]}),l.jsx("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjYwOjEw","data-yw-s":!0,children:yt&&Gt&&Qe&&Ft?(()=>{const Wt=rJ(yt,Qe.address,Ft.address);return Wt!==null?l.jsxs("span",{className:"text-xs text-green-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjY2OjE4","data-yw-s":!0,children:[Wt.toFixed(1),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjY2Ojk1","data-yw-t":!0,"data-yw-auto":!0,children:" km"})]}):Qt&&l.jsxs("span",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjY4OjM3","data-yw-s":!0,children:[Qt.toFixed(1),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjY4OjEwNQ","data-yw-t":!0,"data-yw-auto":!0,children:" km"})]})})():yt?l.jsxs("span",{className:"text-xs text-green-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjczOjE1","data-yw-s":!0,children:[yt.totalDistance.toFixed(1),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjczOjEwNA","data-yw-t":!0,"data-yw-auto":!0,children:"km"})]}):Qt?l.jsxs("span",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjc2OjE1","data-yw-s":!0,children:[Qt.toFixed(1),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjc2Ojgz","data-yw-t":!0,"data-yw-auto":!0,children:"km"})]}):null})]})]})};return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjg1OjQ","data-yw-s":!0,children:l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjg2OjY","data-yw-s":!0,children:[l.jsxs("header",{className:"flex-none px-4 py-3 bg-white shadow-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjk0Ojg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjk1OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 active:bg-gray-100 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjk2OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjk3OjE0","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMjk5OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Available Rides"})]}),l.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzAxOjEw","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzAyOjEy","data-yw-s":!0}),l.jsxs("span",{className:"truncate","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzAzOjEy","data-yw-s":!0,children:[P,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzAzOjQ1","data-yw-t":!0,"data-yw-auto":!0,children:"  "}),G]})]})]}),l.jsx("div",{className:"flex-1 overflow-y-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzA4Ojg","data-yw-s":!0,children:j?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzEwOjEy","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzExOjE0","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzEyOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Searching for rides..."})]}):d.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzE1OjEy","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-16 h-16 text-gray-300 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzE2OjE0","data-yw-s":!0}),l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzE3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"No Rides Found"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzE4OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Try adjusting your search criteria or search for a different date"})]}):l.jsxs("div",{className:"px-4 py-4 space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzIzOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzI0OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzI1OjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-1 h-6 bg-blue-600 rounded","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzI2OjE4","data-yw-s":!0}),l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzI3OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Available Rides"}),l.jsxs("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzI4OjE4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzI4OjU4","data-yw-t":!0,"data-yw-auto":!0,children:"("}),d.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzI4Ojgy","data-yw-t":!0,"data-yw-auto":!0,children:")"})]})]}),J0&&B.size>0&&l.jsxs("div",{className:"ml-3 flex items-center gap-1 text-xs text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzMxOjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-3 h-3 border-2 border-blue-600 border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzMyOjIw","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzMzOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Calculating accurate road-based ETAs..."})]}),J0&&S.size>0&&B.size===0]}),d.map(Te=>l.jsx(De,{ride:Te,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0F2YWlsYWJsZVJpZGVzUGFnZS50c3hAMzM5OjE2","data-yw-s":!0},Te.id))]})})]})})}var LN="clover",iJ=function(o){return o===3?"v3":o},jN="https://js.stripe.com",sJ="".concat(jN,"/").concat(LN,"/stripe.js"),oJ=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,lJ=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var cJ=function(o){return oJ.test(o)||lJ.test(o)},uJ=function(){for(var o=document.querySelectorAll('script[src^="'.concat(jN,'"]')),d=0;d<o.length;d++){var g=o[d];if(cJ(g.src))return g}return null},JL=function(o){var d="",g=document.createElement("script");g.src="".concat(sJ).concat(d);var j=document.head||document.body;if(!j)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return j.appendChild(g),g},dJ=function(o,d){!o||!o._registerWrapper||o._registerWrapper({name:"stripe-js",version:"8.5.2",startTime:d})},ag=null,F0=null,O0=null,hJ=function(o){return function(d){o(new Error("Failed to load Stripe.js",{cause:d}))}},fJ=function(o,d){return function(){window.Stripe?o(window.Stripe):d(new Error("Stripe.js not available"))}},pJ=function(o){return ag!==null?ag:(ag=new Promise(function(d,g){if(typeof window>"u"||typeof document>"u"){d(null);return}if(window.Stripe){d(window.Stripe);return}try{var j=uJ();if(!(j&&o)){if(!j)j=JL(o);else if(j&&O0!==null&&F0!==null){var Z;j.removeEventListener("load",O0),j.removeEventListener("error",F0),(Z=j.parentNode)===null||Z===void 0||Z.removeChild(j),j=JL(o)}}O0=fJ(d,g),F0=hJ(g),j.addEventListener("load",O0),j.addEventListener("error",F0)}catch(S){g(S);return}}),ag.catch(function(d){return ag=null,Promise.reject(d)}))},mJ=function(o,d,g){if(o===null)return null;var j=d[0],Z=j.match(/^pk_test/),S=iJ(o.version),n=LN;Z&&S!==n&&console.warn("Stripe.js@".concat(S," was loaded on the page, but @stripe/stripe-js@").concat("8.5.2"," expected Stripe.js@").concat(n,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var B=o.apply(void 0,d);return dJ(B,g),B},rg,ZN=!1,NN=function(){return rg||(rg=pJ(null).catch(function(o){return rg=null,Promise.reject(o)}),rg)};Promise.resolve().then(function(){return NN()}).catch(function(u){ZN||console.warn(u)});var yJ=function(){for(var o=arguments.length,d=new Array(o),g=0;g<o;g++)d[g]=arguments[g];ZN=!0;var j=Date.now();return NN().then(function(Z){return mJ(Z,d,j)})},aw={exports:{}},rw,FL;function gJ(){if(FL)return rw;FL=1;var u="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return rw=u,rw}var nw,OL;function _J(){if(OL)return nw;OL=1;var u=gJ();function o(){}function d(){}return d.resetWarningCache=o,nw=function(){function g(S,n,B,D,P,G){if(G!==u){var Y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw Y.name="Invariant Violation",Y}}g.isRequired=g;function j(){return g}var Z={array:g,bigint:g,bool:g,func:g,number:g,object:g,string:g,symbol:g,any:g,arrayOf:j,element:g,elementType:g,instanceOf:j,node:g,objectOf:j,oneOf:j,oneOfType:j,shape:j,exact:j,checkPropTypes:d,resetWarningCache:o};return Z.PropTypes=Z,Z},nw}var DL;function xJ(){return DL||(DL=1,aw.exports=_J()()),aw.exports}var wJ=xJ();const ji=ry(wJ);function CL(u,o){var d=Object.keys(u);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(u);o&&(g=g.filter(function(j){return Object.getOwnPropertyDescriptor(u,j).enumerable})),d.push.apply(d,g)}return d}function PL(u){for(var o=1;o<arguments.length;o++){var d=arguments[o]!=null?arguments[o]:{};o%2?CL(Object(d),!0).forEach(function(g){EN(u,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(d)):CL(Object(d)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(d,g))})}return u}function H0(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?H0=function(o){return typeof o}:H0=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},H0(u)}function EN(u,o,d){return o in u?Object.defineProperty(u,o,{value:d,enumerable:!0,configurable:!0,writable:!0}):u[o]=d,u}function vJ(u,o){if(u==null)return{};var d={},g=Object.keys(u),j,Z;for(Z=0;Z<g.length;Z++)j=g[Z],!(o.indexOf(j)>=0)&&(d[j]=u[j]);return d}function bJ(u,o){if(u==null)return{};var d=vJ(u,o),g,j;if(Object.getOwnPropertySymbols){var Z=Object.getOwnPropertySymbols(u);for(j=0;j<Z.length;j++)g=Z[j],!(o.indexOf(g)>=0)&&Object.prototype.propertyIsEnumerable.call(u,g)&&(d[g]=u[g])}return d}function SN(u,o){return LJ(u)||jJ(u,o)||ZJ(u,o)||NJ()}function LJ(u){if(Array.isArray(u))return u}function jJ(u,o){var d=u&&(typeof Symbol<"u"&&u[Symbol.iterator]||u["@@iterator"]);if(d!=null){var g=[],j=!0,Z=!1,S,n;try{for(d=d.call(u);!(j=(S=d.next()).done)&&(g.push(S.value),!(o&&g.length===o));j=!0);}catch(B){Z=!0,n=B}finally{try{!j&&d.return!=null&&d.return()}finally{if(Z)throw n}}return g}}function ZJ(u,o){if(u){if(typeof u=="string")return GL(u,o);var d=Object.prototype.toString.call(u).slice(8,-1);if(d==="Object"&&u.constructor&&(d=u.constructor.name),d==="Map"||d==="Set")return Array.from(u);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return GL(u,o)}}function GL(u,o){(o==null||o>u.length)&&(o=u.length);for(var d=0,g=new Array(o);d<o;d++)g[d]=u[d];return g}function NJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var vl=function(o,d,g){var j=!!g,Z=mi.useRef(g);mi.useEffect(function(){Z.current=g},[g]),mi.useEffect(function(){if(!j||!o)return function(){};var S=function(){Z.current&&Z.current.apply(Z,arguments)};return o.on(d,S),function(){o.off(d,S)}},[j,d,o,Z])},Ow=function(o){var d=mi.useRef(o);return mi.useEffect(function(){d.current=o},[o]),d.current},ay=function(o){return o!==null&&H0(o)==="object"},EJ=function(o){return ay(o)&&typeof o.then=="function"},SJ=function(o){return ay(o)&&typeof o.elements=="function"&&typeof o.createToken=="function"&&typeof o.createPaymentMethod=="function"&&typeof o.confirmCardPayment=="function"},UL="[object Object]",zJ=function u(o,d){if(!ay(o)||!ay(d))return o===d;var g=Array.isArray(o),j=Array.isArray(d);if(g!==j)return!1;var Z=Object.prototype.toString.call(o)===UL,S=Object.prototype.toString.call(d)===UL;if(Z!==S)return!1;if(!Z&&!g)return o===d;var n=Object.keys(o),B=Object.keys(d);if(n.length!==B.length)return!1;for(var D={},P=0;P<n.length;P+=1)D[n[P]]=!0;for(var G=0;G<B.length;G+=1)D[B[G]]=!0;var Y=Object.keys(D);if(Y.length!==n.length)return!1;var X=o,ue=d,oe=function(ve){return u(X[ve],ue[ve])};return Y.every(oe)},zN=function(o,d,g){return ay(o)?Object.keys(o).reduce(function(j,Z){var S=!ay(d)||!zJ(o[Z],d[Z]);return g.includes(Z)?(S&&console.warn("Unsupported prop change: options.".concat(Z," is not a mutable property.")),j):S?PL(PL({},j||{}),{},EN({},Z,o[Z])):j},null):null},AN="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",WL=function(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:AN;if(o===null||SJ(o))return o;throw new Error(d)},AJ=function(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:AN;if(EJ(o))return{tag:"async",stripePromise:Promise.resolve(o).then(function(j){return WL(j,d)})};var g=WL(o,d);return g===null?{tag:"empty"}:{tag:"sync",stripe:g}},RJ=function(o){!o||!o._registerWrapper||!o.registerAppInfo||(o._registerWrapper({name:"react-stripe-js",version:"5.4.0"}),o.registerAppInfo({name:"react-stripe-js",version:"5.4.0",url:"https://stripe.com/docs/stripe-js/react"}))},x_=mi.createContext(null);x_.displayName="ElementsContext";var RN=function(o,d){if(!o)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(d," in an <Elements> provider."));return o},TN=function(o){var d=o.stripe,g=o.options,j=o.children,Z=mi.useMemo(function(){return AJ(d)},[d]),S=mi.useState(function(){return{stripe:Z.tag==="sync"?Z.stripe:null,elements:Z.tag==="sync"?Z.stripe.elements(g):null}}),n=SN(S,2),B=n[0],D=n[1];mi.useEffect(function(){var Y=!0,X=function(oe){D(function(pe){return pe.stripe?pe:{stripe:oe,elements:oe.elements(g)}})};return Z.tag==="async"&&!B.stripe?Z.stripePromise.then(function(ue){ue&&Y&&X(ue)}):Z.tag==="sync"&&!B.stripe&&X(Z.stripe),function(){Y=!1}},[Z,B,g]);var P=Ow(d);mi.useEffect(function(){P!==null&&P!==d&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[P,d]);var G=Ow(g);return mi.useEffect(function(){if(B.elements){var Y=zN(g,G,["clientSecret","fonts"]);Y&&B.elements.update(Y)}},[g,G,B.elements]),mi.useEffect(function(){RJ(B.stripe)},[B.stripe]),mi.createElement(x_.Provider,{value:B},j)};TN.propTypes={stripe:ji.any,options:ji.object};var TJ=function(o){var d=mi.useContext(x_);return RN(d,o)},VJ=function(){var o=TJ("calls useElements()"),d=o.elements;return d};ji.func.isRequired;var VN=mi.createContext(null);VN.displayName="CheckoutContext";ji.any,ji.shape({clientSecret:ji.oneOfType([ji.string,ji.instanceOf(Promise)]).isRequired,elementsOptions:ji.object}).isRequired;var Dw=function(o){var d=mi.useContext(VN),g=mi.useContext(x_);if(d){if(g)throw new Error("You cannot wrap the part of your app that ".concat(o," in both <CheckoutProvider> and <Elements> providers."));return d}else return RN(g,o)},MJ=["mode"],BJ=function(o){return o.charAt(0).toUpperCase()+o.slice(1)},Gl=function(o,d){var g="".concat(BJ(o),"Element"),j=function(B){var D=B.id,P=B.className,G=B.options,Y=G===void 0?{}:G,X=B.onBlur,ue=B.onFocus,oe=B.onReady,pe=B.onChange,ve=B.onEscape,ke=B.onClick,ye=B.onLoadError,$e=B.onLoaderStart,De=B.onNetworksChange,Te=B.onConfirm,Qe=B.onCancel,Ft=B.onShippingAddressChange,bt=B.onShippingRateChange,Qt=B.onSavedPaymentMethodRemove,Gt=B.onSavedPaymentMethodUpdate,yt=Dw("mounts <".concat(g,">")),Ke="elements"in yt?yt.elements:null,st="checkoutState"in yt?yt.checkoutState:null,ht=st?.type==="success"||st?.type==="loading"?st.sdk:null,Wt=mi.useState(null),qt=SN(Wt,2),Lt=qt[0],mt=qt[1],ze=mi.useRef(null),Ye=mi.useRef(null);vl(Lt,"blur",X),vl(Lt,"focus",ue),vl(Lt,"escape",ve),vl(Lt,"click",ke),vl(Lt,"loaderror",ye),vl(Lt,"loaderstart",$e),vl(Lt,"networkschange",De),vl(Lt,"confirm",Te),vl(Lt,"cancel",Qe),vl(Lt,"shippingaddresschange",Ft),vl(Lt,"shippingratechange",bt),vl(Lt,"savedpaymentmethodremove",Qt),vl(Lt,"savedpaymentmethodupdate",Gt),vl(Lt,"change",pe);var wt;oe&&(o==="expressCheckout"?wt=oe:wt=function(){oe(Lt)}),vl(Lt,"ready",wt),mi.useLayoutEffect(function(){if(ze.current===null&&Ye.current!==null&&(Ke||ht)){var ba=null;if(ht)switch(o){case"paymentForm":ba=ht.createPaymentFormElement();break;case"payment":ba=ht.createPaymentElement(Y);break;case"address":if("mode"in Y){var lr=Y.mode,Ja=bJ(Y,MJ);if(lr==="shipping")ba=ht.createShippingAddressElement(Ja);else if(lr==="billing")ba=ht.createBillingAddressElement(Ja);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":ba=ht.createExpressCheckoutElement(Y);break;case"currencySelector":ba=ht.createCurrencySelectorElement();break;case"taxId":ba=ht.createTaxIdElement(Y);break;default:throw new Error("Invalid Element type ".concat(g,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else Ke&&(ba=Ke.create(o,Y));ze.current=ba,mt(ba),ba&&ba.mount(Ye.current)}},[Ke,ht,Y]);var Be=Ow(Y);return mi.useEffect(function(){if(ze.current){var ba=zN(Y,Be,["paymentRequest"]);ba&&"update"in ze.current&&ze.current.update(ba)}},[Y,Be]),mi.useLayoutEffect(function(){return function(){if(ze.current&&typeof ze.current.destroy=="function")try{ze.current.destroy(),ze.current=null}catch{}}},[]),mi.createElement("div",{id:D,className:P,ref:Ye})},Z=function(B){Dw("mounts <".concat(g,">"));var D=B.id,P=B.className;return mi.createElement("div",{id:D,className:P})},S=d?Z:j;return S.propTypes={id:ji.string,className:ji.string,onChange:ji.func,onBlur:ji.func,onFocus:ji.func,onReady:ji.func,onEscape:ji.func,onClick:ji.func,onLoadError:ji.func,onLoaderStart:ji.func,onNetworksChange:ji.func,onConfirm:ji.func,onCancel:ji.func,onShippingAddressChange:ji.func,onShippingRateChange:ji.func,onSavedPaymentMethodRemove:ji.func,onSavedPaymentMethodUpdate:ji.func,options:ji.object},S.displayName=g,S.__elementType=o,S},Ul=typeof window>"u",IJ=mi.createContext(null);IJ.displayName="EmbeddedCheckoutProviderContext";var kJ=function(){var o=Dw("calls useStripe()"),d=o.stripe;return d};Gl("auBankAccount",Ul);Gl("card",Ul);Gl("cardNumber",Ul);Gl("cardExpiry",Ul);Gl("cardCvc",Ul);Gl("iban",Ul);var JJ=Gl("payment",Ul);Gl("expressCheckout",Ul);Gl("paymentRequestButton",Ul);Gl("linkAuthentication",Ul);Gl("address",Ul);Gl("shippingAddress",Ul);Gl("paymentMethodMessaging",Ul);Gl("taxId",Ul);function FJ({onSuccess:u,onError:o,amount:d}){const g=kJ(),j=VJ(),[Z,S]=fe.useState(!1),[n,B]=fe.useState(null),D=async P=>{if(P.preventDefault(),!g||!j){B("Stripe not loaded");return}S(!0),B(null);try{const{error:G}=await j.submit();if(G){B(G.message||"Payment submission failed"),S(!1),o(G.message||"Payment submission failed");return}const{error:Y,paymentIntent:X}=await g.confirmPayment({elements:j,redirect:"if_required",confirmParams:{return_url:window.location.origin+"/rider/trips"}});if(Y){B(Y.message||"Payment confirmation failed"),S(!1),o(Y.message||"Payment confirmation failed");return}X&&X.status==="requires_capture"||X&&X.status==="succeeded"?(S(!1),u()):(B("Unexpected payment status: "+X?.status),S(!1),o("Unexpected payment status"))}catch(G){console.error("Payment error:",G);const Y=G instanceof Error?G.message:"Payment failed";B(Y),S(!1),o(Y)}};return l.jsxs("form",{onSubmit:D,className:"space-y-4","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDkwOjQ","data-yw-s":!0,children:[l.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDkyOjY","data-yw-s":!0,children:l.jsx(JJ,{options:{layout:"tabs",paymentMethodOrder:["card","google_pay","apple_pay"]},"data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDkzOjg","data-yw-s":!0})}),n&&l.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-start gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEwMzo4","data-yw-s":!0,children:[l.jsx(Kc,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEwNDoxMA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEwNToxMA","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm font-medium text-red-900","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEwNjoxMg","data-yw-t":!0,"data-yw-s":!0,children:"Payment Error"}),l.jsx("p",{className:"text-xs text-red-700 mt-1","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEwNzoxMg","data-yw-s":!0,children:n})]})]}),l.jsx("button",{type:"submit",disabled:!g||Z,className:"w-full py-4 bg-blue-600 text-white font-semibold rounded-xl flex items-center justify-center gap-2 active:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed shadow-lg","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDExMzo2","data-yw-s":!0,children:Z?l.jsxs(l.Fragment,{children:[l.jsx(r_,{className:"w-5 h-5 animate-spin","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEyMDoxMg","data-yw-s":!0}),"Processing Payment..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Hp,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEyNToxMg","data-yw-s":!0}),"Authorize $",(d/100).toFixed(2)]})}),l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEzMjo2","data-yw-s":!0,children:l.jsxs("p",{className:"text-xs text-blue-800","data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEzMzo4","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEzNDoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Secure Authorization:"}),l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvU3RyaXBlUGF5bWVudEZvcm0udHN4QDEzNDo0OA","data-yw-t":!0,"data-yw-auto":!0,children:" Your payment method will be authorized but not charged until the ride is completed. The hold will be released if the ride is cancelled."})]})})]})}const XL=()=>{if(typeof window>"u")return null;const u=window.ywConfig?.stripe_publishable_key;return!u||u==="pk_test_YOUR_KEY_HERE"?(console.error(" STRIPE ERROR: No valid Stripe publishable key configured in yw_manifest.json"),console.error("Please add your Stripe publishable key to yw_manifest.json:"),console.error('{ "stripe_publishable_key": "pk_test_..." }'),null):u},QL=XL()?yJ(XL()):null,Pm=typeof window<"u"&&window.ywConfig?.mapbox_token||"";function OJ(){const{rideId:u}=Qp(),o=on(),[d]=ev(),[g,j]=fe.useState(null),[Z,S]=fe.useState(null),[n,B]=fe.useState(!0),[D,P]=fe.useState(!1),[G,Y]=fe.useState(1),[X,ue]=fe.useState(null),[oe,pe]=fe.useState(!1),[ve,ke]=fe.useState(null),[ye,$e]=fe.useState(!1),[De,Te]=fe.useState(!1),[Qe,Ft]=fe.useState(null),[bt,Qt]=fe.useState(null),[Gt,yt]=fe.useState(null),[Ke,st]=fe.useState(!1),[ht,Wt]=fe.useState(null),qt=d.get("fromLat"),Lt=d.get("fromLng"),mt=d.get("toLat"),ze=d.get("toLng"),Ye=d.get("from"),wt=d.get("to"),Be=d.get("segmentPrice"),ba=d.get("segmentDistance");fe.useEffect(()=>{lr()},[u,o]);const lr=async()=>{const Xr=await ui();if(!Xr||Xr.userType!=="rider"){o("/");return}S(Xr);const Gn=await lI(Xr.id);if(Gn&&(yt(Gn),st(!0),Wt(Gn.discountType||"referred"),Gn.discountType==="referred"?console.log(" User has pending 10% discount (used referral code)"):console.log(" User has pending 10% discount (referral reward from sharing code)")),u){const rn=await __(u);if(console.log("Ride data loaded:",rn),j(rn),rn.from_location?.lat&&rn.from_location?.lng&&rn.to_location?.lat&&rn.to_location?.lng&&Pm){pe(!0);const Sr=await xv(rn.from_location.lat,rn.from_location.lng,rn.to_location.lat,rn.to_location.lng,Pm);Sr?ue(Sr):console.warn("Failed to calculate route"),pe(!1)}if(rn.route_stops&&rn.route_stops.length>=2&&Pm){pe(!0);const Sr=new Date(`${rn.date}T${rn.time}`),pi=await vv(rn.route_stops,Sr,Pm);pi&&(ke(pi),console.log(" Multi-stop route calculated for preview")),pe(!1)}}B(!1)},Ja=g?.isSegmentBooking||qt&&Lt&&mt&&ze&&g?.from_location&&(parseFloat(qt)!==g.from_location.lat||parseFloat(Lt)!==g.from_location.lng||parseFloat(mt)!==g.to_location.lat||parseFloat(ze)!==g.to_location.lng),Er=g?.displayFrom||(Ye&&qt&&Lt?{address:Ye,lat:parseFloat(qt),lng:parseFloat(Lt)}:null),or=g?.displayTo||(wt&&mt&&ze?{address:wt,lat:parseFloat(mt),lng:parseFloat(ze)}:null),ka=Be?parseFloat(Be):g?.displayPrice||g?.price_per_seat,gr=ba?parseFloat(ba):g?.displayDistance||g?.distance,Pn=async()=>{if(G<1){alert("Please select at least one seat");return}if(!(!g||!Z)){P(!0);try{if(await UI(Z.id,g.id)){alert("You already have a booking for this ride"),P(!1);return}const Gn=Ja&&Er?{address:Er.address,lat:Er.lat,lng:Er.lng}:{address:g.from_location.address,lat:g.from_location.lat,lng:g.from_location.lng},rn=Ja&&or?{address:or.address,lat:or.lat,lng:or.lng}:{address:g.to_location.address,lat:g.to_location.lat,lng:g.to_location.lng},Sr=ka||g.price_per_seat;let pi=G*Sr;const di=gr||g.distance;let Tn=0;Ke&&Gt&&(Tn=pi*.1,pi=pi*.9,console.log(` Referral discount applied: -$${Tn.toFixed(2)} (10% off)`));const cs=Math.round(pi*100),Ls=await EI({rideId:g.id,bookingId:void 0,riderId:Z.id,driverId:g.driver_id,amountSubtotal:cs,metadata:{requestedSeats:G,isSegmentBooking:Ja,pickupAddress:Gn.address,dropoffAddress:rn.address}});if(!Ls.success||!Ls.clientSecret){alert(`Failed to initialize payment: ${Ls.error}

Please try again.`),P(!1);return}Ft(Ls.clientSecret),Qt(Ls.paymentIntent?.id||null),Te(!0),P(!1)}catch(Xr){console.error("Error booking ride:",Xr),alert("An error occurred while booking the ride."),P(!1)}}},qo=async()=>{if(!(!g||!Z||!bt)){P(!0);try{const Xr=Ja&&Er?{address:Er.address,lat:Er.lat,lng:Er.lng}:{address:g.from_location.address,lat:g.from_location.lat,lng:g.from_location.lng},Gn=Ja&&or?{address:or.address,lat:or.lat,lng:or.lng}:{address:g.to_location.address,lat:g.to_location.lat,lng:g.to_location.lng},rn=ka||g.price_per_seat;let Sr=G*rn;const pi=gr||g.distance;let di=0;Ke&&Gt&&(di=Sr*.1,Sr=Sr*.9,console.log(` Referral discount applied: -$${di.toFixed(2)} (10% off)`));const Tn=await PI({rideId:g.id,passengerId:Z.id,requestedSeats:G,pickupLocation:Xr,dropoffLocation:Gn,message:Ja?"Segment booking request":"Looking forward to the ride!",pricePerSeat:rn,totalPrice:Sr,distanceKm:pi,referralUseId:Gt?.id,discountApplied:di});if(Tn){bt&&await It.from("stripe_payment_intents").update({booking_id:Tn}).eq("stripe_payment_intent_id",bt);let cs=`Booking request sent successfully!
Total: $${Sr.toFixed(2)}
Payment authorized (will be charged after ride completion)
Driver will review your request.`;if(Ke&&di>0){const Ls=ht==="referred"?"Used referral code":"Reward for sharing your code";cs=`Booking request sent successfully!
 Referral discount applied: -$${di.toFixed(2)}
(${Ls})
Total: $${Sr.toFixed(2)}
Payment authorized (will be charged after ride completion)
Driver will review your request.`}alert(cs),o("/rider/trips")}else{alert("Failed to create booking. Payment authorization will be cancelled."),bt&&await It.from("stripe_payment_intents").update({status:"canceled",canceled_at:new Date().toISOString(),cancellation_reason:"Booking creation failed"}).eq("stripe_payment_intent_id",bt),P(!1);return}}catch(Xr){console.error("Error booking ride:",Xr),alert("An error occurred while booking the ride.")}finally{P(!1)}}},ln=Xr=>{console.error("Payment error:",Xr),Te(!1),Ft(null),Qt(null)};if(De&&Qe)return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzMzOjY","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzM0Ojg","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzQyOjEw","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzQzOjEy","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>{Te(!1),Ft(null),Qt(null)},className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzQ0OjE0","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzUyOjE2","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzU0OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Payment Authorization"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzU5OjEw","data-yw-s":!0,children:l.jsxs("div",{className:"max-w-md mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzYwOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"mb-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzYxOjE0","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzYyOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Authorize Payment"}),l.jsxs("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzYzOjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzYzOjUz","data-yw-t":!0,"data-yw-auto":!0,children:"Your payment method will be authorized for $"}),(G*(ka||g.price_per_seat)).toFixed(2),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzY0OjEzMQ","data-yw-t":!0,"data-yw-auto":!0,children:". No charge will be made until the ride is completed."})]})]}),QL?l.jsx(TN,{stripe:QL,options:{clientSecret:Qe},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzcwOjE2","data-yw-s":!0,children:l.jsx(FJ,{onSuccess:qo,onError:ln,amount:Math.round(G*(ka||g.price_per_seat)*100),"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzcxOjE4","data-yw-s":!0})}):l.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzc4OjE2","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-red-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzc5OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Payment Configuration Error"}),l.jsx("p",{className:"text-sm text-red-700 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzgwOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Stripe payment system is not properly configured. Please contact support or check your Stripe API keys in the project configuration."}),l.jsxs("div",{className:"text-xs text-red-600 font-mono bg-red-100 p-3 rounded","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzgzOjE4","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg0OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Developer Note:"}),l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg0OjUy","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg0OjU3","data-yw-t":!0,"data-yw-auto":!0,children:"1. Get your Stripe publishable key from: "}),l.jsx("a",{href:"https://dashboard.stripe.com/test/apikeys",target:"_blank",rel:"noopener noreferrer",className:"underline","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg1OjYx","data-yw-t":!0,"data-yw-s":!0,"data-yw-l":!0,children:"Stripe Dashboard"}),l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg1OjE5Nw","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg1OjIwMg","data-yw-t":!0,"data-yw-auto":!0,children:'2. Update yw_manifest.json with: "stripe_publishable_key": "pk_test_YOUR_KEY"'}),l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg2Ojk3","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hAMzg2OjEwMg","data-yw-t":!0,"data-yw-auto":!0,children:"3. Reload the application"})]})]})]})})]})});if(n||!g)return l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDAwOjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDAxOjg","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDAyOjEw","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDAzOjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading ride details..."})]})});const bs=g.route_stops&&g.route_stops.length>0?g.route_stops.sort((Xr,Gn)=>Xr.stop_order-Gn.stop_order):[{id:"start",address:g.from_location.address,estimated_arrival:g.time,lat:g.from_location.lat,lng:g.from_location.lng,stop_order:0},{id:"end",address:g.to_location.address,estimated_arrival:g.estimated_arrival,lat:g.to_location.lat,lng:g.to_location.lng,stop_order:999}];return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDMyOjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDMzOjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDQwOjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDQxOjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>o(-1),className:"p-2 active:bg-gray-100 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDQyOjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDQ2OjE0","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDQ4OjEy","data-yw-s":!0,children:[l.jsx("h1",{className:"text-xl font-semibold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDQ5OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Ride Details"}),l.jsxs("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDUwOjE0","data-yw-s":!0,children:[g.date,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDUwOjYy","data-yw-t":!0,"data-yw-auto":!0,children:" at "}),Cl(g.time)]})]})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDU2Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"px-4 py-4 space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDU3OjEw","data-yw-s":!0,children:[Ja,(X||oe)&&l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDYzOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDY0OjE2","data-yw-s":!0,children:[l.jsx(Xp,{className:"w-4 h-4 text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDY1OjE4","data-yw-s":!0}),l.jsx("h3",{className:"text-sm font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDY2OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Live Route Information"})]}),oe?l.jsxs("div",{className:"flex items-center justify-center py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDcwOjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDcxOjIw","data-yw-s":!0}),l.jsx("span",{className:"ml-2 text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDcyOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Calculating route..."})]}):X?l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDc1OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDc2OjIw","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDc3OjIy","data-yw-t":!0,"data-yw-s":!0,children:"Distance"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDc4OjIy","data-yw-s":!0,children:wv(X.distance)})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDgwOjIw","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDgxOjIy","data-yw-t":!0,"data-yw-s":!0,children:"Duration"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDgyOjIy","data-yw-s":!0,children:l_(X.duration)})]}),l.jsxs("div",{className:"flex justify-between items-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDg0OjIw","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDg1OjIy","data-yw-t":!0,"data-yw-s":!0,children:"Estimated Arrival"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDg2OjIy","data-yw-s":!0,children:X.eta})]}),l.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDg4OjIw","data-yw-s":!0,children:l.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDg5OjIy","data-yw-s":!0,children:[l.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDkwOjI0","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANDkwOjk2","data-yw-t":!0,"data-yw-auto":!0,children:"Real-time road data via Mapbox"})]})})]}):null]}),g.route_stops&&g.route_stops.length>0&&Pm?l.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 p-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTAxOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTAyOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm font-medium text-gray-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTAzOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Route Map"}),l.jsxs("div",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTA0OjE4","data-yw-s":!0,children:[gr?`${gr.toFixed(1)} km`:g.distance?`${g.distance.toFixed(1)} km`:"",g.duration?`  ${g.duration} min`:""]})]}),l.jsx(pN,{routeStops:ve?.stops||g.route_stops,routeGeometry:ve?.routeGeometry||g.route_data?.routes?.[0]?.geometry,mapboxToken:Pm,className:"w-full h-64","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTA5OjE2","data-yw-s":!0})]}):l.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTE3OjE0","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-48 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg flex flex-col items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTE4OjE2","data-yw-s":!0,children:[l.jsx(Xp,{className:"w-12 h-12 text-blue-400 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTE5OjE4","data-yw-s":!0}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTIwOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Route Preview"}),l.jsx("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTIxOjE4","data-yw-s":!0,children:gr?`${gr.toFixed(1)} km`:g.distance?`${g.distance.toFixed(1)} km`:""})]})}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTI5OjEy","data-yw-s":!0,children:[l.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTMwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Driver"}),l.jsxs("div",{onClick:()=>o(`/rider/driver-profile/${g.driver_id}`),className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg active:bg-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTMxOjE0","data-yw-s":!0,children:[l.jsx("img",{src:g.driver?.profile_image||"/assets/placeholder-avatar.jpg",alt:g.driver?.name||"Driver",className:"w-14 h-14 rounded-full object-cover border-2 border-blue-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTM1OjE2","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQwOjE2","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQxOjE4","data-yw-s":!0,children:g.driver?.name||"Driver"}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQyOjE4","data-yw-s":!0,children:[l.jsx(vs,{className:"w-4 h-4 text-yellow-500 fill-yellow-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQzOjIw","data-yw-s":!0}),l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQ0OjIw","data-yw-s":!0,children:g.driver?.rating?.toFixed(1)||"5.0"}),l.jsxs("span",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQ1OjIw","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQ1OjYw","data-yw-t":!0,"data-yw-auto":!0,children:" "}),g.driver?.total_rides||0,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQ1Ojkz","data-yw-t":!0,"data-yw-auto":!0,children:" trips"})]})]}),l.jsx("p",{className:"text-xs text-blue-600 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTQ3OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Tap to view profile"})]})]})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTUzOjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTU0OjE0","data-yw-s":!0,children:[l.jsx("h2",{className:"text-sm font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTU1OjE2","data-yw-s":!0,children:Ja?"Full Route (Your Route highlighted)":"Route & Stops"}),l.jsxs("span",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTU4OjE2","data-yw-s":!0,children:[bs.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTU4Ojcz","data-yw-t":!0,"data-yw-auto":!0,children:" stops"})]})]}),l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTYxOjE0","data-yw-s":!0,children:bs.map((Xr,Gn)=>{const rn=Gn===0,Sr=Gn===bs.length-1,pi=Ja&&Er&&Math.abs(Xr.lat-Er.lat)<.01&&Math.abs(Xr.lng-Er.lng)<.01,di=Ja&&or&&Math.abs(Xr.lat-or.lat)<.01&&Math.abs(Xr.lng-or.lng)<.01,Tn=Ja&&(pi||di);return l.jsxs("div",{className:`flex items-start gap-3 ${Tn?"bg-purple-50 -mx-2 px-2 py-2 rounded-lg":""}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTc0OjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex flex-col items-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTc1OjIy","data-yw-s":!0,children:[l.jsx("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${pi||rn?"bg-green-600 ring-4 ring-green-200":di||Sr?"bg-red-600 ring-4 ring-red-200":"bg-blue-600"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTc2OjI0","data-yw-s":!0,children:l.jsx("div",{className:"w-2 h-2 bg-white rounded-full","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTgxOjI2","data-yw-s":!0})}),!Sr&&l.jsx("div",{className:`w-0.5 h-12 my-1 ${Tn?"bg-purple-400":"bg-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTg0OjI2","data-yw-s":!0})]}),l.jsx("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTg3OjIy","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTg4OjI0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTg5OjI2","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTkwOjI4","data-yw-s":!0,children:Xr.name||Xr.address}),Xr.estimated_arrival&&l.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTkyOjMw","data-yw-s":!0,children:[l.jsx(ws,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTkzOjMy","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTk0OjMy","data-yw-s":!0,children:Xr.estimated_arrival})]})]}),l.jsxs("div",{className:"flex flex-col gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANTk4OjI2","data-yw-s":!0,children:[pi&&l.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjAwOjMw","data-yw-t":!0,"data-yw-s":!0,children:"Your Pickup"}),di&&l.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjA1OjMw","data-yw-t":!0,"data-yw-s":!0,children:"Your Dropoff"}),!Tn&&rn&&l.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjEwOjMw","data-yw-t":!0,"data-yw-s":!0,children:"Start"}),!Tn&&Sr&&l.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjEzOjMw","data-yw-t":!0,"data-yw-s":!0,children:"End"})]})]})})]},Xr.id||Gn)})})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjI1OjEy","data-yw-s":!0,children:[l.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjI2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Trip Details"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjI4OjE0","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjI5OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjMwOjE4","data-yw-s":!0,children:[l.jsx(ws,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjMxOjIw","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjMyOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Departure"})]}),l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjM0OjE4","data-yw-s":!0,children:Cl(g.time)})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjM3OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjM4OjE4","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjM5OjIw","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjQwOjIw","data-yw-t":!0,"data-yw-s":!0,children:"Available"})]}),l.jsxs("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjQyOjE4","data-yw-s":!0,children:[g.available_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjQyOjgz","data-yw-t":!0,"data-yw-auto":!0,children:" seats"})]})]}),gr&&l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjQ2OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjQ3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Distance"}),l.jsxs("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjQ4OjIw","data-yw-s":!0,children:[gr.toFixed(1),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjQ5OjUw","data-yw-t":!0,"data-yw-auto":!0,children:" km"}),Ja&&l.jsx("span",{className:"text-xs text-purple-600 ml-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjUwOjQz","data-yw-s":!0})]})]}),g.duration&&l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjU2OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"text-sm text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjU3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Duration"}),l.jsxs("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjU4OjIw","data-yw-s":!0,children:[g.duration,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjU4Ojc4","data-yw-t":!0,"data-yw-auto":!0,children:" min"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjY1OjEy","data-yw-s":!0,children:[l.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjY2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Select Seats"}),l.jsxs("div",{className:"flex items-center gap-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjY3OjE0","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>Y(Math.max(1,G-1)),className:"w-12 h-12 rounded-xl bg-gray-100 active:bg-gray-200 flex items-center justify-center font-bold text-gray-900 text-xl","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjY4OjE2","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("div",{className:"flex-1 text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjc0OjE2","data-yw-s":!0,children:[l.jsx("div",{className:"text-3xl font-bold text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjc1OjE4","data-yw-s":!0,children:G}),l.jsxs("div",{className:"text-xs text-gray-600 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjc2OjE4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjc2OjYy","data-yw-t":!0,"data-yw-auto":!0,children:"seat"}),G>1?"s":"",l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjc2Ojk3","data-yw-t":!0,"data-yw-auto":!0,children:" selected"})]})]}),l.jsx("button",{onClick:()=>Y(Math.min(g.available_seats,G+1)),disabled:G>=g.available_seats,className:"w-12 h-12 rounded-xl bg-blue-600 active:bg-blue-700 disabled:bg-gray-300 flex items-center justify-center font-bold text-white text-xl","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjc4OjE2","data-yw-t":!0,"data-yw-s":!0,children:"+"})]}),l.jsx("div",{className:"mt-3 text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjg2OjE0","data-yw-s":!0,children:l.jsxs("span",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjg3OjE2","data-yw-s":!0,children:[g.available_seats,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjg4OjQw","data-yw-t":!0,"data-yw-auto":!0,children:" seat"}),g.available_seats>1?"s":"",l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjg4Ojgy","data-yw-t":!0,"data-yw-auto":!0,children:" available"})]})})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjk0OjEy","data-yw-s":!0,children:[l.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjk1OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Price Summary"}),l.jsxs("div",{className:"space-y-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjk2OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjk3OjE2","data-yw-s":!0,children:[l.jsxs("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjk4OjE4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANjk4OjU4","data-yw-t":!0,"data-yw-auto":!0,children:"Price per Seat"}),Ja&&l.jsx("span",{className:"text-xs text-purple-600 ml-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzAwOjQx","data-yw-s":!0})]}),l.jsxs("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzAyOjE4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzAyOjcw","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ka?.toFixed(2)||g.price_per_seat?.toFixed(2)]})]}),l.jsxs("div",{className:"flex justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzA0OjE2","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzA1OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Number of Seats"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzA2OjE4","data-yw-s":!0,children:G})]}),Ke&&l.jsxs("div",{className:"flex flex-col gap-1 text-green-600 bg-green-50 -mx-2 px-2 py-2 rounded","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzA5OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzEwOjIw","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzExOjIy","data-yw-t":!0,"data-yw-s":!0,children:" Referral Discount (10%)"}),l.jsxs("span",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzE0OjIy","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzE0OjYw","data-yw-t":!0,"data-yw-auto":!0,children:"-$"}),((ka||g.price_per_seat)*G*.1).toFixed(2)]})]}),l.jsx("div",{className:"text-xs text-green-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzE2OjIw","data-yw-s":!0,children:ht==="referred"?"Thank you for using a referral code!":"Reward for sharing your referral code!"})]}),l.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzIzOjE2","data-yw-s":!0,children:[l.jsx("span",{className:"text-base font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzI0OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Total Amount"}),l.jsxs("span",{className:"text-lg font-bold text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzI1OjE4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzI1OjY4","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),Ke?(G*(ka||g.price_per_seat)*.9).toFixed(2):(G*(ka||g.price_per_seat)).toFixed(2)]})]})]})]}),l.jsx("div",{className:"mt-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzM1OjEy","data-yw-s":!0,children:l.jsx(_N,{checked:ye,onChange:$e,type:"booking","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzM2OjE0","data-yw-s":!0})})]})}),l.jsx("div",{className:"flex-none bg-white border-t border-gray-200 p-4",style:{paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzQ2Ojg","data-yw-s":!0,children:l.jsx("button",{onClick:Pn,disabled:D||G<1||!ye,className:"w-full py-4 bg-blue-600 text-white font-semibold rounded-xl flex items-center justify-center gap-2 active:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed shadow-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzUwOjEw","data-yw-s":!0,children:D?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzU3OjE2","data-yw-s":!0}),"Booking..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Hp,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVQcmV2aWV3UGFnZS50c3hANzYyOjE2","data-yw-s":!0}),"Send Booking Request ($",(G*(ka||g.price_per_seat)).toFixed(2),")"]})})})]})})}const DJ=({driverName:u,driverAvatar:o,onBack:d})=>{const g=on(),j=()=>{d?d():g(-1)};return l.jsx("header",{className:"flex-none bg-white border-b border-gray-200",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEAyNzo0","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center justify-between px-4 py-3","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEAzMTo2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 flex-1","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEAzMjo4","data-yw-s":!0,children:[l.jsx("button",{onClick:j,className:"p-2 -ml-2 active:bg-gray-100 rounded-full transition-colors min-h-touch min-w-touch flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEAzMzoxMA","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEAzNzoxMg","data-yw-s":!0})}),l.jsxs("div",{className:"flex items-center gap-3 flex-1","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA0MDoxMA","data-yw-s":!0,children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-semibold overflow-hidden","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA0MToxMg","data-yw-s":!0,children:o?l.jsx("img",{src:o,alt:u,className:"w-full h-full object-cover","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA0MzoxNg","data-yw-s":!0}):l.jsx("span",{"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA0OToxNg","data-yw-s":!0,children:u.charAt(0).toUpperCase()})}),l.jsxs("div",{className:"flex-1 min-w-0","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA1MzoxMg","data-yw-s":!0,children:[l.jsx("h1",{className:"font-semibold text-gray-900 truncate","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA1NDoxNA","data-yw-s":!0,children:u}),l.jsx("p",{className:"text-sm text-green-600","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA1NzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Online"})]})]})]}),l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA2Mjo4","data-yw-s":!0,children:[l.jsx("button",{className:"p-2 active:bg-gray-100 rounded-full transition-colors min-h-touch min-w-touch flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA2MzoxMA","data-yw-s":!0}),l.jsx("button",{className:"p-2 active:bg-gray-100 rounded-full transition-colors min-h-touch min-w-touch flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA2NjoxMA","data-yw-s":!0}),l.jsx("button",{className:"p-2 active:bg-gray-100 rounded-full transition-colors min-h-touch min-w-touch flex items-center justify-center","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA2OToxMA","data-yw-s":!0,children:l.jsx(rB,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9DaGF0SGVhZGVyLnRzeEA3MDoxMg","data-yw-s":!0})})]})]})})},CJ=({messages:u,currentUserId:o})=>{const d=fe.useRef(null);fe.useEffect(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[u]);const g=Z=>new Intl.DateTimeFormat("zh-CN",{hour:"2-digit",minute:"2-digit"}).format(Z),j=Z=>Z==="sending"?l.jsx(Hp,{className:"w-4 h-4 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hAMzg6MTM","data-yw-s":!0}):Z==="sent"?l.jsx(bL,{className:"w-4 h-4 text-gray-400","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANDE6MTM","data-yw-s":!0}):l.jsx(bL,{className:"w-4 h-4 text-blue-500","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANDM6MTE","data-yw-s":!0});return l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 bg-gray-50","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANDc6NA","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANDg6Ng","data-yw-s":!0,children:[u.map(Z=>l.jsx("div",{className:`flex ${Z.isCurrentUser?"justify-end":"justify-start"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANTA6MTA","data-yw-s":!0,children:l.jsxs("div",{className:`max-w-[75%] ${Z.isCurrentUser?"items-end":"items-start"} flex flex-col gap-1`,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANTY6MTI","data-yw-s":!0,children:[!Z.isCurrentUser&&l.jsx("span",{className:"text-xs text-gray-500 px-2","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANjI6MTY","data-yw-s":!0,children:Z.senderName}),l.jsx("div",{className:`rounded-2xl px-4 py-2.5 ${Z.isCurrentUser?"bg-blue-500 text-white":"bg-white text-gray-900 border border-gray-200"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANjc6MTQ","data-yw-s":!0,children:l.jsx("p",{className:"text-[15px] leading-relaxed break-words","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANzQ6MTY","data-yw-s":!0,children:Z.text})}),l.jsxs("div",{className:`flex items-center gap-1 px-2 ${Z.isCurrentUser?"flex-row-reverse":"flex-row"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hANzk6MTQ","data-yw-s":!0,children:[l.jsx("span",{className:"text-xs text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hAODQ6MTY","data-yw-s":!0,children:g(Z.timestamp)}),Z.isCurrentUser&&j(Z.status)]})]})},Z.id)),l.jsx("div",{ref:d,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlTGlzdC50c3hAOTI6OA","data-yw-s":!0})]})})},PJ=({onSendMessage:u,disabled:o=!1})=>{const[d,g]=fe.useState(""),[j,Z]=fe.useState(!1),S=fe.useRef(null),n=()=>{const P=d.trim();P&&!o&&(un("light"),u(P),g(""),S.current&&(S.current.style.height="auto"))},B=P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),n())},D=P=>{g(P.target.value),S.current&&(S.current.style.height="auto",S.current.style.height=`${Math.min(S.current.scrollHeight,120)}px`)};return l.jsx("div",{className:"flex-none bg-white border-t border-gray-200",style:{paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDU2OjQ","data-yw-s":!0,children:l.jsx("div",{className:"px-3 py-3","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDYwOjY","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-end gap-2","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDYxOjg","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1 flex items-end gap-2 bg-gray-100 rounded-3xl px-3 py-2","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDYzOjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>un("light"),className:"flex-none p-1 active:bg-gray-200 rounded-full transition-colors",disabled:o,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDY0OjEy","data-yw-s":!0,children:l.jsx(PB,{className:"w-5 h-5 text-gray-500","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDY5OjE0","data-yw-s":!0})}),l.jsx("textarea",{ref:S,value:d,onChange:D,onKeyDown:B,placeholder:"Type a message...",disabled:o,className:"flex-1 bg-transparent resize-none outline-none text-[15px] leading-relaxed max-h-[120px] placeholder:text-gray-400",rows:1,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDcyOjEy","data-yw-s":!0})]}),l.jsx("button",{onClick:n,disabled:!d.trim()||o,className:`flex-none w-11 h-11 rounded-full transition-all flex items-center justify-center ${d.trim()&&!o?"bg-blue-500 text-white active:bg-blue-600 shadow-lg":"bg-gray-200 text-gray-400"}`,"data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDg1OjEw","data-yw-s":!0,children:l.jsx(y_,{className:"w-5 h-5","data-yw":"c3JjL2NvbXBvbmVudHMvY2hhdC9NZXNzYWdlSW5wdXQudHN4QDk0OjEy","data-yw-s":!0})})]})})})};function GJ(){const{conversationId:u}=Qp(),[o,d]=fe.useState([]),[g,j]=fe.useState(!0),[Z,S]=fe.useState(""),[n,B]=fe.useState("Driver");fe.useEffect(()=>{if(!u)return;let P=null;return(async()=>{try{const Y=await ui();Y?.id&&S(Y.id);const ue=(await aN(u)).map(oe=>({id:oe.id,text:oe.message_text,senderId:oe.sender_id,senderName:oe.sender_id===Y?.id?"Me":n,timestamp:new Date(oe.created_at),status:oe.is_read?"read":"sent",isCurrentUser:oe.sender_id===Y?.id}));d(ue),j(!1),Y?.id&&await s_(u,Y.id),P=nN(u,oe=>{const pe={id:oe.id,text:oe.message_text,senderId:oe.sender_id,senderName:oe.sender_id===Y?.id?"Me":n,timestamp:new Date(oe.created_at),status:oe.is_read?"read":"sent",isCurrentUser:oe.sender_id===Y?.id};d(ve=>[...ve,pe]),un("light"),oe.sender_id!==Y?.id&&Y?.id&&s_(u,Y.id)})}catch(Y){console.error("Error setting up chat:",Y),j(!1)}})(),()=>{P&&P()}},[u,n]);const D=async P=>{if(!(!u||!Z))try{const G={id:`temp-${Date.now()}`,text:P,senderId:Z,senderName:"Me",timestamp:new Date,status:"sending",isCurrentUser:!0};d(X=>[...X,G]),un("light");const Y=await rN(u,Z,P);d(Y?X=>X.map(ue=>ue.id===G.id?{...ue,id:Y.id,status:"sent"}:ue):X=>X.filter(ue=>ue.id!==G.id))}catch(G){console.error("Error sending message:",G)}};return g?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxMzg6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxMzk6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNDA6MTA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNDE6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):u?l.jsxs("div",{className:"w-full h-dvh bg-gray-50 flex flex-col","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNTg6NA","data-yw-s":!0,children:[l.jsx(DJ,{driverName:n,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNTk6Ng","data-yw-s":!0}),l.jsx(CJ,{messages:o,currentUserId:Z,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNjE6Ng","data-yw-s":!0}),l.jsx(PJ,{onSendMessage:D,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNjM6Ng","data-yw-s":!0})]}):l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNDk6Ng","data-yw-s":!0,children:l.jsx("div",{className:"text-center px-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNTA6OA","data-yw-s":!0,children:l.jsx("p",{className:"text-gray-600 text-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRQYWdlLnRzeEAxNTE6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Conversation not found"})})})}function UJ(){const u=on(),[o,d]=fe.useState([]),[g,j]=fe.useState(""),[Z,S]=fe.useState(!0),[n,B]=fe.useState("");fe.useEffect(()=>{D()},[]);const D=async()=>{try{const X=await ui();if(!X?.id){S(!1);return}B(X.id);const oe=(await iN(X.id)).map(pe=>({id:pe.id,driverName:pe.driver_name||"Driver",passengerName:pe.passenger_name||"Passenger",lastMessage:pe.last_message||"No messages yet",lastMessageTime:new Date(pe.last_message_at),unreadCount:pe.unread_count||0}));d(oe),S(!1)}catch(X){console.error("Error loading conversations:",X),S(!1)}},P=o.filter(X=>X.driverName.toLowerCase().includes(g.toLowerCase())||X.passengerName.toLowerCase().includes(g.toLowerCase())),G=X=>{const oe=new Date().getTime()-X.getTime(),pe=Math.floor(oe/6e4),ve=Math.floor(oe/36e5),ke=Math.floor(oe/864e5);return pe<1?"Just now":pe<60?`${pe}m ago`:ve<24?`${ve}h ago`:ke<7?`${ke}d ago`:new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(X)},Y=X=>{un("light"),u(`/rider/chat/${X}`)};return l.jsxs("div",{className:"w-full h-dvh bg-gray-50 flex flex-col","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAODc6NA","data-yw-s":!0,children:[l.jsxs("header",{className:"flex-none bg-white border-b border-gray-200",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAODk6Ng","data-yw-s":!0,children:[l.jsx("div",{className:"px-4 py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAOTM6OA","data-yw-s":!0,children:l.jsx("h1",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAOTQ6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Messages"})}),l.jsx("div",{className:"px-4 pb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAOTg6OA","data-yw-s":!0,children:l.jsxs("div",{className:"relative","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAOTk6MTA","data-yw-s":!0,children:[l.jsx(XZ,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTAwOjEy","data-yw-s":!0}),l.jsx("input",{type:"text",value:g,onChange:X=>j(X.target.value),placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2.5 bg-gray-100 rounded-xl text-[15px] outline-none focus:bg-gray-200 transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTAxOjEy","data-yw-s":!0})]})})]}),l.jsx("div",{className:"flex-1 overflow-y-auto pb-20","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTEzOjY","data-yw-s":!0,children:Z?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTE1OjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTE2OjEy","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTE3OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Loading conversations..."})]}):P.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full px-4 text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTIwOjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTIxOjEy","data-yw-s":!0,children:l.jsx(uv,{className:"w-10 h-10 text-gray-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTIyOjE0","data-yw-s":!0})}),l.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTI0OjEy","data-yw-s":!0,children:g?"No conversations found":"No messages yet"}),l.jsx("p",{className:"text-gray-500 text-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTI3OjEy","data-yw-s":!0,children:g?"Try searching with different keywords":"Start chatting with drivers after booking a ride"})]}):l.jsx("div",{className:"divide-y divide-gray-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTM0OjEw","data-yw-s":!0,children:P.map(X=>l.jsxs("button",{onClick:()=>Y(X.id),className:"w-full px-4 py-4 flex items-center gap-3 bg-white active:bg-gray-50 transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTM2OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-none relative","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTQyOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-semibold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTQzOjE4","data-yw-s":!0,children:l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTQ0OjIw","data-yw-s":!0,children:X.driverName.charAt(0)})}),X.unreadCount>0&&l.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTQ3OjIw","data-yw-s":!0,children:l.jsx("span",{className:"text-white text-xs font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTQ4OjIy","data-yw-s":!0,children:X.unreadCount>9?"9+":X.unreadCount})})]}),l.jsxs("div",{className:"flex-1 min-w-0 text-left","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTU4OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTU5OjE4","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 truncate","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTYwOjIw","data-yw-s":!0,children:X.driverName}),l.jsx("span",{className:"text-xs text-gray-500 flex-none ml-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTYzOjIw","data-yw-s":!0,children:G(X.lastMessageTime)})]}),l.jsx("p",{className:`text-sm truncate ${X.unreadCount>0?"text-gray-900 font-medium":"text-gray-500"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTY3OjE4","data-yw-s":!0,children:X.lastMessage})]}),l.jsx(zg,{className:"w-5 h-5 text-gray-400 flex-none","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTc5OjE2","data-yw-s":!0})]},X.id))})}),l.jsx(qf,{active:"chat",userType:"rider","data-yw":"c3JjL3BhZ2VzL3JpZGVyL0NoYXRMaXN0UGFnZS50c3hAMTg3OjY","data-yw-s":!0})]})}function WJ(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!0),[Z,S]=fe.useState(!1),[n,B]=fe.useState(null),[D,P]=fe.useState(!1),[G,Y]=fe.useState(!1);fe.useEffect(()=>{X()},[]);const X=async()=>{try{const ye=await ui();if(!ye){u("/auth");return}const $e=await jv(ye.id);if(!$e){u("/auth");return}d($e)}catch(ye){console.error("Error loading profile:",ye),u("/auth")}finally{j(!1)}},ue=()=>{Z?(B(null),S(!1)):(B(o),S(!0))},oe=async()=>{if(!(!n||!o))try{await u_(o.id,{name:n.name,phone:n.phone||null,address:n.address||null,city:n.city||null,state:n.state||null,zipcode:n.zipcode||null})?(await X(),S(!1),B(null)):alert("Failed to update profile. Please try again.")}catch(ye){console.error("Error updating profile:",ye),alert("Failed to update profile. Please try again.")}},pe=async ye=>{if(o){Y(!0);try{await u_(o.id,{profile_image:ye})?(await X(),P(!1)):alert("Failed to update profile photo. Please try again.")}catch($e){console.error("Error updating profile photo:",$e),alert("Failed to update profile photo. Please try again.")}finally{Y(!1)}}},ve=async()=>{if(window.confirm("Are you sure you want to logout?"))try{Lg(),await CZ(),u("/")}catch(ye){console.error("Error signing out:",ye)}},ke=[{icon:vs,label:"My Ratings & Reviews",path:"/rider/profile/ratings",color:"text-yellow-600",bg:"bg-yellow-50"},{icon:Ag,label:"Payment Methods",path:"/rider/profile/payment-methods",color:"text-blue-600",bg:"bg-blue-50"},{icon:Ho,label:"Payment History",path:"/rider/profile/payment-history",color:"text-green-600",bg:"bg-green-50"},{icon:a_,label:"Refer & Earn",path:"/rider/profile/refer",color:"text-purple-600",bg:"bg-purple-50"},{icon:Kc,label:"Report an Issue",path:"/rider/profile/report-issue",color:"text-orange-600",bg:"bg-orange-50"},{icon:Qh,label:"SOS Emergency",path:"/rider/profile/sos",color:"text-red-600",bg:"bg-red-50"},{icon:ey,label:"Terms & Conditions",path:"/terms",color:"text-gray-600",bg:"bg-gray-50"},{icon:GZ,label:"Cancellation Policy",path:"/cancellation-policy",color:"text-gray-600",bg:"bg-gray-50"}];return l.jsxs("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMTgzOjQ","data-yw-s":!0,children:[l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMTg0OjY","data-yw-s":!0,children:[g?l.jsx("div",{className:"flex-1 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMTkxOjEw","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMTkyOjEy","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMTkzOjE0","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMTk0OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):o?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex-none bg-gradient-to-br from-blue-600 to-indigo-600 px-4 py-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjAwOjEy","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjAxOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"relative inline-block","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjAyOjE2","data-yw-s":!0,children:[o.profile_image?l.jsx("img",{src:o.profile_image,alt:o.name,className:"w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjA0OjIw","data-yw-s":!0}):l.jsx("div",{className:"w-24 h-24 rounded-full bg-white flex items-center justify-center text-4xl font-bold text-blue-600 border-4 border-white shadow-lg mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjEwOjIw","data-yw-s":!0,children:o.name.charAt(0)}),l.jsx("button",{onClick:()=>P(!0),className:"absolute bottom-0 right-0 bg-blue-500 text-white p-2 rounded-full shadow-lg active:bg-blue-600 transition-colors",disabled:G,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjE0OjE4","data-yw-s":!0,children:l.jsx(ty,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjE5OjIw","data-yw-s":!0})})]}),l.jsxs("div",{className:"text-white","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjIzOjE2","data-yw-s":!0,children:[l.jsx("h1",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjI0OjE4","data-yw-s":!0,children:o.name}),l.jsx("p",{className:"text-blue-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjI1OjE4","data-yw-s":!0,children:o.email}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mt-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjI2OjE4","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjI3OjIw","data-yw-s":!0,children:[l.jsx(vs,{className:"w-4 h-4 fill-yellow-400 text-yellow-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjI4OjIy","data-yw-s":!0}),l.jsx("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjI5OjIy","data-yw-s":!0,children:o.rating.toFixed(1)})]}),l.jsx("span",{className:"text-blue-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjMxOjIw","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjMyOjIw","data-yw-s":!0,children:[l.jsx(Yp,{className:"w-4 h-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjMzOjIy","data-yw-s":!0}),l.jsxs("span",{className:"font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjM0OjIy","data-yw-s":!0,children:[o.total_rides,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjM0Ojcz","data-yw-t":!0,"data-yw-auto":!0,children:" trips"})]})]})]})]})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto pb-24","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjQyOjEy","data-yw-s":!0,children:l.jsxs("div",{className:"px-4 py-4 space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjQ0OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjQ1OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjQ2OjE4","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjQ3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Personal Information"}),l.jsx("button",{onClick:ue,className:"p-2 text-blue-600 active:bg-blue-50 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjQ4OjIw","data-yw-s":!0,children:Z?l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjUyOjM1","data-yw-s":!0}):l.jsx(ty,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjUyOjYz","data-yw-s":!0})})]}),l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjU2OjE4","data-yw-s":!0,children:Z?l.jsxs(l.Fragment,{children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjU5OjI0","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjYwOjI2","data-yw-t":!0,"data-yw-s":!0,children:"Full Name"}),l.jsx("input",{type:"text",value:n?.name||"",onChange:ye=>B({...n,name:ye.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjYxOjI2","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjY4OjI0","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjY5OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Phone"}),l.jsx("input",{type:"tel",value:n?.phone||"",onChange:ye=>B({...n,phone:ye.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjcwOjI2","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjc3OjI0","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjc4OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Email"}),l.jsx("input",{type:"email",value:n?.email||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-200 rounded-lg text-sm bg-gray-50 text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjc5OjI2","data-yw-s":!0}),l.jsx("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjg1OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Email cannot be changed"})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjg3OjI0","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjg4OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Address"}),l.jsx("input",{type:"text",value:n?.address||"",onChange:ye=>B({...n,address:ye.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjg5OjI2","data-yw-s":!0})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjk2OjI0","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjk3OjI2","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjk4OjI4","data-yw-t":!0,"data-yw-s":!0,children:"City"}),l.jsx("input",{type:"text",value:n?.city||"",onChange:ye=>B({...n,city:ye.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMjk5OjI4","data-yw-s":!0})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzA2OjI2","data-yw-s":!0,children:[l.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzA3OjI4","data-yw-t":!0,"data-yw-s":!0,children:"ZIP Code"}),l.jsx("input",{type:"text",value:n?.zipcode||"",onChange:ye=>B({...n,zipcode:ye.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzA4OjI4","data-yw-s":!0})]})]}),l.jsxs("button",{onClick:oe,className:"w-full flex items-center justify-center gap-2 py-2.5 bg-blue-600 text-white rounded-lg font-medium active:bg-blue-700 mt-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzE2OjI0","data-yw-s":!0,children:[l.jsx(oy,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzIwOjI2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzIwOjU0","data-yw-t":!0,"data-yw-auto":!0,children:"Save Changes"})]})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzI2OjI0","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzI3OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Name"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzI4OjI2","data-yw-s":!0,children:o.name})]}),l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzMwOjI0","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzMxOjI2","data-yw-t":!0,"data-yw-s":!0,children:"Phone"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzMyOjI2","data-yw-s":!0,children:o.phone||"Not set"})]}),l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzM0OjI0","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzM1OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Email"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzM2OjI2","data-yw-s":!0,children:o.email})]}),l.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzM4OjI0","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzM5OjI2","data-yw-t":!0,"data-yw-s":!0,children:"Address"}),l.jsx("span",{className:"text-sm font-medium text-gray-900 text-right","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzQwOjI2","data-yw-s":!0,children:o.address||"Not set"})]}),l.jsxs("div",{className:"flex justify-between py-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzQyOjI0","data-yw-s":!0,children:[l.jsx("span",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzQzOjI2","data-yw-t":!0,"data-yw-s":!0,children:"City"}),l.jsx("span",{className:"text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzQ0OjI2","data-yw-s":!0,children:o.city&&o.zipcode?`${o.city}, ${o.zipcode}`:"Not set"})]})]})})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzU0OjE2","data-yw-s":!0,children:[l.jsx("div",{className:"px-4 py-3 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzU1OjE4","data-yw-s":!0,children:l.jsx("h2",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzU2OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Quick Actions"})}),l.jsx("div",{className:"divide-y divide-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzU4OjE4","data-yw-s":!0,children:ke.map(ye=>l.jsxs("button",{onClick:()=>u(ye.path),className:"w-full flex items-center gap-3 px-4 py-3 active:bg-gray-50 transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzYwOjIy","data-yw-s":!0,children:[l.jsx("div",{className:`p-2 rounded-lg ${ye.bg}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzY1OjI0","data-yw-s":!0,children:l.jsx(ye.icon,{className:`w-5 h-5 ${ye.color}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzY2OjI2","data-yw-s":!0})}),l.jsx("span",{className:"flex-1 text-left text-sm font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzY4OjI0","data-yw-s":!0,children:ye.label}),l.jsx(zg,{className:"w-5 h-5 text-gray-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzY5OjI0","data-yw-s":!0})]},ye.path))})]}),l.jsxs("button",{onClick:ve,className:"w-full flex items-center justify-center gap-2 py-3 bg-red-50 text-red-600 rounded-xl font-medium active:bg-red-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzc2OjE2","data-yw-s":!0,children:[l.jsx(WZ,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzgwOjE4","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzgwOjQ4","data-yw-t":!0,"data-yw-auto":!0,children:"Logout"})]})]})})]}):null,l.jsx(qf,{active:"profile",userType:"rider","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzg5Ojg","data-yw-s":!0})]}),D&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 px-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzk0Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzk1OjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzk2OjEy","data-yw-s":!0,children:[l.jsx("h3",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzk3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Update Profile Photo"}),l.jsx("button",{onClick:()=>P(!1),disabled:G,className:"p-1 hover:bg-gray-100 rounded-lg disabled:opacity-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hAMzk4OjE0","data-yw-s":!0,children:l.jsx(lo,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hANDAzOjE2","data-yw-s":!0})})]}),l.jsx(hv,{currentImage:o?.profile_image||"",onImageSelect:pe,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hANDA3OjEy","data-yw-s":!0}),G&&l.jsxs("div",{className:"mt-4 text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hANDEzOjE0","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hANDE0OjE2","data-yw-s":!0}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JpZGVyUHJvZmlsZS50c3hANDE1OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Uploading..."})]})]})})]})}function XJ(){const u=on(),[o]=ev(),d=o.get("returnUrl");return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTA6NA","data-yw-s":!0,children:l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTE6Ng","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none px-4 py-3 bg-white shadow-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTk6OA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMjA6MTA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(d?decodeURIComponent(d):"/rider/profile"),className:"p-2 active:bg-gray-100 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMjE6MTI","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMjU6MTQ","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMjc6MTI","data-yw-s":!0,children:[l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMjg6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Payment Information"}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMjk6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Secure payment processing"})]})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMzU6OA","data-yw-s":!0,children:l.jsxs("div",{className:"max-w-md mx-auto space-y-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMzY6MTA","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMzg6MTI","data-yw-s":!0,children:[l.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-white/20 rounded-full mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMzk6MTQ","data-yw-s":!0,children:l.jsx(FB,{className:"w-8 h-8","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANDA6MTY","data-yw-s":!0})}),l.jsx("h2",{className:"text-2xl font-bold mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANDI6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Secure Payment Processing"}),l.jsx("p",{className:"text-blue-100 text-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANDM6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Your payment information is collected securely at the time of booking using industry-standard encryption."})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5 space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANDk6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANTA6MTQ","data-yw-s":!0,children:[l.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANTE6MTY","data-yw-s":!0,children:l.jsx(Ag,{className:"w-5 h-5 text-green-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANTI6MTg","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANTQ6MTY","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANTU6MTg","data-yw-t":!0,"data-yw-s":!0,children:"No Stored Cards Required"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANTY6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Enter your payment details securely when booking a ride. We don't store your card information."})]})]}),l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANjI6MTQ","data-yw-s":!0,children:[l.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANjM6MTY","data-yw-s":!0,children:l.jsx(LL,{className:"w-5 h-5 text-purple-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANjQ6MTg","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANjY6MTY","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANjc6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Payment Authorization"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANjg6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Your card is authorized when you book, but you're only charged after the ride is completed."})]})]}),l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANzQ6MTQ","data-yw-s":!0,children:[l.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANzU6MTY","data-yw-s":!0,children:l.jsx(nI,{className:"w-5 h-5 text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANzY6MTg","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANzg6MTY","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hANzk6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Quick & Easy Checkout"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAODA6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Complete your booking in seconds with our streamlined payment process powered by Stripe."})]})]})]}),l.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAODg6MTI","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAODk6MTQ","data-yw-s":!0,children:[l.jsx(LL,{className:"w-4 h-4 text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAOTA6MTY","data-yw-s":!0}),l.jsx("p",{className:"text-sm font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAOTE6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Secured by Stripe"})]}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAOTM6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"All transactions are encrypted and processed securely through Stripe's PCI-compliant payment infrastructure."})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAOTk6MTI","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTAwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"How Payment Works"}),l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTAxOjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTAyOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTAzOjE4","data-yw-t":!0,"data-yw-s":!0,children:"1"}),l.jsxs("div",{className:"flex-1 pt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTA2OjE4","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-900 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTA3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Choose Your Ride"}),l.jsx("p",{className:"text-xs text-gray-600 mt-0.5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTA4OjIw","data-yw-t":!0,"data-yw-s":!0,children:'Select a ride and click "Book Ride"'})]})]}),l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTEyOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTEzOjE4","data-yw-t":!0,"data-yw-s":!0,children:"2"}),l.jsxs("div",{className:"flex-1 pt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTE2OjE4","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-900 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTE3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Enter Payment Details"}),l.jsx("p",{className:"text-xs text-gray-600 mt-0.5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTE4OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Securely provide your card information via Stripe"})]})]}),l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTIyOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTIzOjE4","data-yw-t":!0,"data-yw-s":!0,children:"3"}),l.jsxs("div",{className:"flex-1 pt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTI2OjE4","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-900 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTI3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Authorization Hold"}),l.jsx("p",{className:"text-xs text-gray-600 mt-0.5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTI4OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Your payment is authorized but not charged yet"})]})]}),l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTMyOjE2","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTMzOjE4","data-yw-t":!0,"data-yw-s":!0,children:"4"}),l.jsxs("div",{className:"flex-1 pt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTM2OjE4","data-yw-s":!0,children:[l.jsx("p",{className:"text-sm text-gray-900 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTM3OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Ride & Charge"}),l.jsx("p",{className:"text-xs text-gray-600 mt-0.5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTM4OjIw","data-yw-t":!0,"data-yw-s":!0,children:"Complete your ride and payment is automatically charged"})]})]})]})]}),d&&l.jsx("button",{onClick:()=>u(decodeURIComponent(d)),className:"w-full py-4 bg-blue-600 text-white font-semibold rounded-xl active:bg-blue-700 shadow-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRNZXRob2RzUGFnZS50c3hAMTQ2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Continue to Booking"})]})})]})})}const QJ=["all","paid","authorized","pending","refunded"],HJ={paid:Hp,authorized:ws,pending:ws,refunded:Gp},HL={paid:"text-green-600 bg-green-100",authorized:"text-yellow-600 bg-yellow-100",pending:"text-gray-600 bg-gray-100",refunded:"text-red-600 bg-red-100"};function YJ(){const u=on(),[o,d]=fe.useState("payments"),[g,j]=fe.useState([]),[Z,S]=fe.useState([]),[n,B]=fe.useState([]),[D,P]=fe.useState("all"),[G,Y]=fe.useState(!0);fe.useEffect(()=>{X()},[]),fe.useEffect(()=>{B(D==="all"?g:g.filter(ye=>ye.status===D))},[D,g]);const X=async()=>{try{const ye=await ui();if(!ye){u("/auth");return}const[$e,De]=await Promise.all([TI(ye.id),yk(ye.id)]);j($e),S(De)}catch(ye){console.error("Error loading payment history:",ye)}finally{Y(!1)}},ue=g.filter(ye=>ye.status==="paid").reduce((ye,$e)=>ye+$e.amount,0),oe=g.filter(ye=>ye.status==="authorized"||ye.status==="pending").reduce((ye,$e)=>ye+$e.amount,0),pe=Z.filter(ye=>ye.transaction_status==="completed").reduce((ye,$e)=>ye+$e.refund_amount,0),ve=Z.filter(ye=>ye.transaction_status==="pending"||ye.transaction_status==="processing").reduce((ye,$e)=>ye+$e.refund_amount,0),ke=ye=>new Date(ye).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return G?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAODg6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAODk6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAOTA6MTA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAOTE6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAOTg6NA","data-yw-s":!0,children:l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAOTk6Ng","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none px-4 py-3 bg-white shadow-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTA3Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTA4OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 active:bg-gray-100 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTA5OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTEwOjE0","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTEyOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Payment History"})]})}),l.jsx("div",{className:"flex-none px-4 py-3 bg-white border-b border-gray-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTE3Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTE4OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>d("payments"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o==="payments"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTE5OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Payments"}),l.jsx("button",{onClick:()=>d("refunds"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o==="refunds"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTI5OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Refunds"})]})}),l.jsx("div",{className:"flex-none px-4 py-4 bg-white border-b border-gray-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTQzOjg","data-yw-s":!0,children:o==="payments"?l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTQ1OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-green-50 rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTQ2OjE0","data-yw-s":!0,children:[l.jsx("p",{className:"text-xs text-green-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTQ3OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Total Paid"}),l.jsxs("p",{className:"text-2xl font-bold text-green-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTQ4OjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTQ4OjY1","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ue.toFixed(2)]})]}),l.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTUwOjE0","data-yw-s":!0,children:[l.jsx("p",{className:"text-xs text-yellow-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTUxOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Pending"}),l.jsxs("p",{className:"text-2xl font-bold text-yellow-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTUyOjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTUyOjY2","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),oe.toFixed(2)]})]})]}):l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTU2OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-blue-50 rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTU3OjE0","data-yw-s":!0,children:[l.jsx("p",{className:"text-xs text-blue-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTU4OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Total Refunded"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTU5OjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTU5OjY0","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),pe.toFixed(2)]})]}),l.jsxs("div",{className:"bg-orange-50 rounded-lg p-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTYxOjE0","data-yw-s":!0,children:[l.jsx("p",{className:"text-xs text-orange-700 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTYyOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Pending Refunds"}),l.jsxs("p",{className:"text-2xl font-bold text-orange-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTYzOjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTYzOjY2","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ve.toFixed(2)]})]})]})}),o==="payments"?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex-none px-4 py-3 bg-white border-b border-gray-200 overflow-x-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTcyOjEy","data-yw-s":!0,children:l.jsx("div",{className:"flex gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTczOjE0","data-yw-s":!0,children:QJ.map(ye=>l.jsx("button",{onClick:()=>P(ye),className:`px-4 py-2 rounded-full text-xs font-medium whitespace-nowrap ${D===ye?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTc1OjE4","data-yw-s":!0,children:ye.toUpperCase()},ye))})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTkxOjEy","data-yw-s":!0,children:n.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTkzOjE2","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-16 h-16 text-gray-300 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTk0OjE4","data-yw-s":!0}),l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTk1OjE4","data-yw-t":!0,"data-yw-s":!0,children:"No Payments"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMTk2OjE4","data-yw-s":!0,children:D==="all"?"No payment history available":`No ${D} payments`})]}):n.map(ye=>{const $e=HJ[ye.status];return l.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjA2OjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start justify-between mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjA3OjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjA4OjI0","data-yw-s":!0,children:[l.jsx("div",{className:`p-2 rounded-lg ${HL[ye.status]}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjA5OjI2","data-yw-s":!0,children:l.jsx($e,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjEwOjI4","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjEyOjI2","data-yw-s":!0,children:[l.jsxs("p",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjEzOjI4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjEzOjcx","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),ye.amount.toFixed(2)]}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjE0OjI4","data-yw-s":!0,children:ye.payment_method})]})]}),l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${HL[ye.status]}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjE3OjI0","data-yw-s":!0,children:ye.status.toUpperCase()})]}),l.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjIxOjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjIyOjI0","data-yw-s":!0,children:[l.jsx(bl,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjIzOjI2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjI0OjI2","data-yw-s":!0,children:ke(ye.date)})]}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjI2OjI0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjI2OjMw","data-yw-t":!0,"data-yw-auto":!0,children:"ID: "}),ye.transaction_id]})]})]},ye.id)})})]}):l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjM3OjEy","data-yw-s":!0,children:Z.length===0?l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjM5OjE2","data-yw-s":!0,children:[l.jsx(dv,{className:"w-16 h-16 text-gray-300 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjQwOjE4","data-yw-s":!0}),l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjQxOjE4","data-yw-t":!0,"data-yw-s":!0,children:"No Refunds"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjQyOjE4","data-yw-t":!0,"data-yw-s":!0,children:"No refund transactions available"})]}):Z.map(ye=>{const $e=Qe=>{switch(Qe){case"completed":return"text-green-600 bg-green-100";case"processing":return"text-blue-600 bg-blue-100";case"pending":return"text-yellow-600 bg-yellow-100";case"failed":return"text-red-600 bg-red-100";case"cancelled":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},Te=(Qe=>{switch(Qe){case"completed":return Hp;case"processing":case"pending":return ws;case"failed":case"cancelled":return Gp;default:return ws}})(ye.transaction_status);return l.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjgzOjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start justify-between mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjg0OjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjg1OjI0","data-yw-s":!0,children:[l.jsx("div",{className:`p-2 rounded-lg ${$e(ye.transaction_status)}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjg2OjI2","data-yw-s":!0,children:l.jsx(Te,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjg3OjI4","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjg5OjI2","data-yw-s":!0,children:[l.jsxs("p",{className:"font-semibold text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjkwOjI4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjkwOjcx","data-yw-t":!0,"data-yw-auto":!0,children:"+$"}),ye.refund_amount.toFixed(2)]}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjkxOjI4","data-yw-s":!0,children:ye.refund_method})]})]}),l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${$e(ye.transaction_status)}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMjk0OjI0","data-yw-s":!0,children:ye.transaction_status.toUpperCase()})]}),ye.rides&&l.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzAxOjI0","data-yw-s":!0,children:[l.jsx("p",{className:"text-xs text-gray-600 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzAyOjI2","data-yw-t":!0,"data-yw-s":!0,children:"Ride Details:"}),l.jsxs("p",{className:"text-xs font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzAzOjI2","data-yw-s":!0,children:[ye.rides.from_address,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzA0OjU1","data-yw-t":!0,"data-yw-auto":!0,children:"  "}),ye.rides.to_address]}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzA2OjI2","data-yw-s":!0,children:[new Date(ye.rides.date).toLocaleDateString(),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzA3Ojc4","data-yw-t":!0,"data-yw-auto":!0,children:" at "}),ye.rides.time]})]}),ye.cancellations&&l.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzE0OjI0","data-yw-s":!0,children:[l.jsxs("p",{className:"text-xs text-blue-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzE1OjI2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzE1OjYz","data-yw-t":!0,"data-yw-auto":!0,children:"Refund: "}),ye.cancellations.refund_percentage,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzE2Ojc2","data-yw-t":!0,"data-yw-auto":!0,children:"% of original amount"})]}),ye.cancellations.cancellation_reason&&l.jsxs("p",{className:"text-xs text-gray-600 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzE5OjI4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzE5Ojcw","data-yw-t":!0,"data-yw-auto":!0,children:"Reason: "}),ye.cancellations.cancellation_reason]})]}),l.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzI3OjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzI4OjI0","data-yw-s":!0,children:[l.jsx(bl,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzI5OjI2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzMwOjI2","data-yw-s":!0,children:ke(ye.created_at)})]}),ye.transaction_reference&&l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzMzOjI2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzMzOjMy","data-yw-t":!0,"data-yw-auto":!0,children:"Ref: "}),ye.transaction_reference]})]}),ye.error_message&&ye.transaction_status==="failed"&&l.jsxs("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzM5OjI0","data-yw-s":!0,children:[l.jsxs("p",{className:"text-xs text-red-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzQwOjI2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzQwOjYy","data-yw-t":!0,"data-yw-auto":!0,children:"Error: "}),ye.error_message]}),ye.retry_count>0&&l.jsxs("p",{className:"text-xs text-red-600 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzQ0OjI4","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzQ0OjY5","data-yw-t":!0,"data-yw-auto":!0,children:"Retry attempts: "}),ye.retry_count]})]}),ye.processed_at&&l.jsxs("div",{className:"mt-2 text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzUzOjI0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1BheW1lbnRIaXN0b3J5UGFnZS50c3hAMzUzOjY4","data-yw-t":!0,"data-yw-auto":!0,children:"Processed: "}),ke(ye.processed_at)]})]},ye.id)})})})]})})}const $J=[{value:"payment",label:"Payment Issue"},{value:"rider_behavior",label:"Rider Behavior"},{value:"technical",label:"App Technical Problem"},{value:"safety",label:"Safety Concern"},{value:"account",label:"Account Issue"},{value:"vehicle",label:"Vehicle Problem"},{value:"navigation",label:"Route/Navigation Issue"},{value:"other",label:"Other"}],qJ=[{value:"low",label:"Low",color:"bg-blue-100 text-blue-800"},{value:"medium",label:"Medium",color:"bg-yellow-100 text-yellow-800"},{value:"high",label:"High",color:"bg-orange-100 text-orange-800"},{value:"critical",label:"Critical",color:"bg-red-100 text-red-800"}];function KJ(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!0),[Z,S]=fe.useState(!1),[n,B]=fe.useState(""),[D,P]=fe.useState("medium"),[G,Y]=fe.useState(""),[X,ue]=fe.useState(""),[oe,pe]=fe.useState(!1);fe.useEffect(()=>{(async()=>{const ye=await ui();if(!ye){u("/auth");return}d(ye),j(!1)})()},[u]);const ve=async ke=>{if(ke.preventDefault(),!n||!G.trim()||!X.trim()){alert("Please fill in all required fields");return}S(!0),un("medium");try{await xN(o.id,o.userType,n,G,X,void 0,D)?(un("success"),pe(!0)):(un("error"),alert("Failed to submit issue. Please try again."))}catch(ye){console.error("Error submitting issue:",ye),alert("An error occurred. Please try again.")}finally{S(!1)}};return g||!o?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAODk6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAOTA6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAOTE6MTA","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAOTI6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):oe?l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTAwOjY","data-yw-s":!0,children:l.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center px-4",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTAxOjg","data-yw-s":!0,children:l.jsxs("div",{className:"bg-white rounded-xl p-8 shadow-lg border border-gray-100 max-w-md w-full text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTA4OjEw","data-yw-s":!0,children:[l.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full mx-auto mb-4 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTA5OjEy","data-yw-s":!0,children:l.jsx(Hd,{className:"w-12 h-12 text-green-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTEwOjE0","data-yw-s":!0})}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTEyOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Issue Reported"}),l.jsx("p",{className:"text-gray-600 mb-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTEzOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Thank you for reporting this issue. Our support team will review it and get back to you within 24-48 hours."}),l.jsx("button",{onClick:()=>u("/rider/profile"),className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold active:bg-blue-700 active:scale-98 transition-all min-h-touch","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTE2OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Back to Profile"})]})})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTI5OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTMwOjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTM4Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTM5OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTQwOjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTQ0OjE0","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTQ2OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Report Issue"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTUxOjg","data-yw-s":!0,children:l.jsxs("form",{onSubmit:ve,className:"space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTUyOjEw","data-yw-s":!0,children:[l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTU0OjEy","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTU1OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Issue Category *"}),l.jsxs("select",{value:n,onChange:ke=>B(ke.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTU4OjE0","data-yw-s":!0,children:[l.jsx("option",{value:"","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTY0OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Select a category"}),$J.map(ke=>l.jsx("option",{value:ke.value,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTY2OjE4","data-yw-s":!0,children:ke.label},ke.value))]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTc0OjEy","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTc1OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Priority"}),l.jsx("div",{className:"grid grid-cols-2 gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTc4OjE0","data-yw-s":!0,children:qJ.map(ke=>l.jsx("button",{type:"button",onClick:()=>P(ke.value),className:`px-4 py-2 rounded-lg font-medium transition-all ${D===ke.value?ke.color+" ring-2 ring-offset-2 ring-blue-500":"bg-gray-100 text-gray-700"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTgwOjE4","data-yw-s":!0,children:ke.label},ke.value))})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTk3OjEy","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMTk4OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Issue Title *"}),l.jsx("input",{type:"text",value:G,onChange:ke=>Y(ke.target.value),placeholder:"Brief description of the issue",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,maxLength:100,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjAxOjE0","data-yw-s":!0}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjEwOjE0","data-yw-s":!0,children:[G.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjExOjMw","data-yw-t":!0,"data-yw-auto":!0,children:"/100 characters"})]})]}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjE2OjEy","data-yw-s":!0,children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjE3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Description *"}),l.jsx("textarea",{value:X,onChange:ke=>ue(ke.target.value),placeholder:"Please provide detailed information about the issue...",rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",required:!0,maxLength:1e3,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjIwOjE0","data-yw-s":!0}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjI5OjE0","data-yw-s":!0,children:[X.length,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjMwOjM2","data-yw-t":!0,"data-yw-auto":!0,children:"/1000 characters"})]})]}),l.jsx("button",{type:"submit",disabled:Z,className:"w-full flex items-center justify-center gap-2 py-3 bg-blue-600 text-white rounded-lg font-semibold active:bg-blue-700 active:scale-98 transition-all disabled:opacity-50 disabled:cursor-not-allowed min-h-touch","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjM1OjEy","data-yw-s":!0,children:Z?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjQyOjE4","data-yw-s":!0}),"Submitting..."]}):l.jsxs(l.Fragment,{children:[l.jsx(y_,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlcG9ydElzc3VlUGFnZS50c3hAMjQ3OjE4","data-yw-s":!0}),"Submit Report"]})})]})})]})})}function eF(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(5),[Z,S]=fe.useState(0),[n,B]=fe.useState([]),[D,P]=fe.useState(!0);fe.useEffect(()=>{G()},[]);const G=async()=>{try{const ue=await ui();if(!ue){u("/auth");return}d(ue),await Y(ue.id)}catch(ue){console.error("Error loading data:",ue)}finally{P(!1)}},Y=async ue=>{const oe=await jv(ue);if(oe){const ve=typeof oe.rating=="string"?parseFloat(oe.rating):oe.rating;j(ve||5),S(oe.total_rides||0)}const pe=await nk(ue);B(pe)},X=async()=>{o&&(P(!0),await Y(o.id),P(!1))};return D?l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hANjQ6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hANjU6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hANjY6MTA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hANjc6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading ratings..."})]})}):o?l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hANzY6NA","data-yw-s":!0,children:l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hANzc6Ng","data-yw-s":!0,children:[l.jsxs("header",{className:"flex-none px-4 py-3 bg-white shadow-sm flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAODU6OA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAODY6MTA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 active:bg-gray-100 rounded-lg transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAODc6MTI","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAOTE6MTQ","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAOTM6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Ratings & Reviews"})]}),l.jsx("button",{onClick:X,className:"p-2 active:bg-gray-100 rounded-lg transition-colors",title:"Refresh ratings","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAOTU6MTA","data-yw-s":!0,children:l.jsx(dv,{className:"w-5 h-5 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTAwOjEy","data-yw-s":!0})})]}),l.jsx("div",{className:"flex-none bg-white p-6 border-b border-gray-200","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTA1Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTA2OjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTA3OjEy","data-yw-s":!0,children:[l.jsx(vs,{className:"w-8 h-8 text-yellow-500 fill-yellow-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTA4OjE0","data-yw-s":!0}),l.jsx("span",{className:"text-4xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTA5OjE0","data-yw-s":!0,children:g.toFixed(1)})]}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTExOjEy","data-yw-t":!0,"data-yw-s":!0,children:"Your average rating"}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTEyOjEy","data-yw-s":!0,children:[Z,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTEyOjY2","data-yw-t":!0,"data-yw-auto":!0,children:" rides completed"})]})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTE3Ojg","data-yw-s":!0,children:[l.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTE4OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Reviews You've Given"}),n.length>0?l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTIxOjEy","data-yw-s":!0,children:n.map(ue=>l.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTIzOjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-start gap-3 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTI0OjE4","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTI1OjIw","data-yw-s":!0,children:ue.reviewed_user?.name.charAt(0)||"D"}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTI4OjIw","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTI5OjIy","data-yw-s":!0,children:ue.reviewed_user?.name||"Driver"}),l.jsx("div",{className:"flex items-center gap-1 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTMyOjIy","data-yw-s":!0,children:[1,2,3,4,5].map(oe=>l.jsx(vs,{className:`w-4 h-4 ${oe<=ue.rating?"text-yellow-500 fill-yellow-500":"text-gray-300"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTM0OjI2","data-yw-s":!0},oe))})]}),l.jsx("span",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTQ1OjIw","data-yw-s":!0,children:new Date(ue.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),ue.comment&&l.jsx("p",{className:"text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTUzOjIw","data-yw-s":!0,children:ue.comment})]},ue.id))}):l.jsxs("div",{className:"bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTU5OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full mx-auto mb-3 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTYwOjE0","data-yw-s":!0,children:l.jsx(vs,{className:"w-8 h-8 text-gray-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTYxOjE2","data-yw-s":!0})}),l.jsx("div",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTYzOjE0","data-yw-t":!0,"data-yw-s":!0,children:"No reviews yet"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JhdGluZ3NSZXZpZXdzUGFnZS50c3hAMTY0OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Complete rides and rate your drivers to see your reviews here"})]})]})]})}):null}const tF=[{id:"1",name:"Emergency Services (911)",phone:"911",type:"emergency"},{id:"2",name:"OnGoPool Safety Team",phone:"+1-800-555-0199",type:"support"},{id:"3",name:"Local Police (Non-Emergency)",phone:"311",type:"police"}],aF=["Medical Emergency","Accident","Safety Threat","Vehicle Breakdown","Lost/Stranded","Other Emergency"];function rF(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!0),[Z,S]=fe.useState(!1),[n,B]=fe.useState(5),[D,P]=fe.useState(null),[G,Y]=fe.useState("Safety Threat"),[X,ue]=fe.useState(null);fe.useEffect(()=>{(async()=>{const $e=await ui();if(!$e){u("/auth");return}d($e);const De=await bN($e.id);De&&(P(De.id),S(!0),B(0)),j(!1)})(),navigator.geolocation&&navigator.geolocation.getCurrentPosition($e=>ue($e),$e=>console.error("Error getting location:",$e))},[u]),fe.useEffect(()=>{if(Z&&n>0){const ye=setTimeout(()=>{B(n-1),o_(100)},1e3);return()=>clearTimeout(ye)}else Z&&n===0&&!D&&oe()},[Z,n,D]);const oe=async()=>{try{const ye=X?{lat:X.coords.latitude,lng:X.coords.longitude}:void 0,$e=await wN(o.id,o.userType,G,ye,`Emergency activated by ${o.userType}`,o.phone||void 0);$e.success&&(P($e.emergencyId||null),un("success"),o_([200,100,200]),alert(` Emergency Alert Sent!

Your location has been shared with:
 Emergency Services
 OnGoPool Safety Team
 Your emergency contacts

Help is on the way!`))}catch(ye){console.error("Error activating emergency:",ye),alert("Failed to activate emergency. Please call 911 directly.")}},pe=()=>{window.confirm(` EMERGENCY ACTIVATION

This will:
 Contact emergency services (911)
 Share your current location
 Notify OnGoPool safety team
 Alert your emergency contacts

Type: ${G}

Are you sure you need emergency help?`)&&(un("heavy"),S(!0))},ve=async()=>{n>0?(S(!1),B(5),un("light")):D&&window.confirm("Are you sure you want to cancel the emergency alert?")&&await vN(D)&&(S(!1),P(null),B(5),un("success"))},ke=ye=>{un("medium"),window.location.href=`tel:${ye}`};return g||!o?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE0MDo2","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE0MTo4","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE0MjoxMA","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE0MzoxMA","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE1MDo0","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE1MTo2","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE1OTo4","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center space-x-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE2MDoxMA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all",disabled:Z&&n>0,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE2MToxMg","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE2NjoxNA","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE2ODoxMg","data-yw-t":!0,"data-yw-s":!0,children:"SOS Emergency"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE3Mzo4","data-yw-s":!0,children:l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE3NDoxMA","data-yw-s":!0,children:[Z?l.jsxs("div",{className:"bg-red-600 rounded-xl p-8 text-center shadow-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE3NzoxNA","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-20 h-20 text-white mx-auto mb-4 animate-pulse","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE3ODoxNg","data-yw-s":!0}),l.jsx("div",{className:"text-white space-y-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE3OToxNg","data-yw-s":!0,children:n>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"text-3xl font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE4MjoyMg","data-yw-s":!0,children:n}),l.jsx("div",{className:"text-xl font-semibold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE4MzoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Emergency Alert Activating..."}),l.jsxs("div",{className:"text-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE4NDoyMg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE4NDo0Nw","data-yw-t":!0,"data-yw-auto":!0,children:"Emergency services will be contacted in "}),n,l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE4NTo3NQ","data-yw-t":!0,"data-yw-auto":!0,children:" second"}),n!==1?"s":""]}),l.jsx("button",{onClick:ve,className:"mt-4 px-6 py-3 bg-white text-red-600 font-semibold rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE4NzoyMg","data-yw-t":!0,"data-yw-s":!0,children:"CANCEL"})]}):l.jsxs(l.Fragment,{children:[l.jsx(Hd,{className:"w-16 h-16 mx-auto mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE5NjoyMg","data-yw-s":!0}),l.jsx("div",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE5NzoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Emergency Alert Active"}),l.jsx("div",{className:"text-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDE5ODoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Help has been contacted. Stay safe!"}),l.jsx("button",{onClick:ve,className:"mt-4 px-6 py-3 bg-white text-red-600 font-semibold rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIwMToyMg","data-yw-t":!0,"data-yw-s":!0,children:"Mark as Resolved"})]})})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIxNDoxNg","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIxNToxOA","data-yw-t":!0,"data-yw-s":!0,children:"Emergency Type"}),l.jsx("select",{value:G,onChange:ye=>Y(ye.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIxNjoxOA","data-yw-s":!0,children:aF.map(ye=>l.jsx("option",{value:ye,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIyMjoyMg","data-yw-s":!0,children:ye},ye))})]}),l.jsxs("button",{onClick:pe,className:"w-full bg-red-600 text-white rounded-xl p-8 shadow-lg active:scale-98 transition-all","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIzMDoxNg","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-16 h-16 mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIzNDoxOA","data-yw-s":!0}),l.jsx("div",{className:"text-2xl font-bold mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIzNToxOA","data-yw-t":!0,"data-yw-s":!0,children:"ACTIVATE SOS"}),l.jsx("div",{className:"text-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDIzNjoxOA","data-yw-t":!0,"data-yw-s":!0,children:"Press to alert emergency services"})]}),l.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI0MjoxNg","data-yw-s":!0,children:l.jsxs("div",{className:"flex gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI0MzoxOA","data-yw-s":!0,children:[l.jsx(Qh,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI0NDoyMA","data-yw-s":!0}),l.jsxs("div",{className:"text-sm text-yellow-800","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI0NToyMA","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI0NjoyMg","data-yw-t":!0,"data-yw-s":!0,children:"Only use in real emergencies"}),l.jsx("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI0NzoyMg","data-yw-t":!0,"data-yw-s":!0,children:"False activation may result in fines and account suspension."})]})]})})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI1NToxMg","data-yw-s":!0,children:[l.jsx("div",{className:"px-4 py-3 border-b border-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI1NjoxNA","data-yw-s":!0,children:l.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI1NzoxNg","data-yw-s":!0,children:[l.jsx(Up,{className:"w-5 h-5 text-blue-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI1ODoxOA","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI1ODo2NQ","data-yw-t":!0,"data-yw-auto":!0,children:"Emergency Contacts"})]})}),l.jsx("div",{className:"divide-y divide-gray-100","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI2MjoxNA","data-yw-s":!0,children:tF.map(ye=>l.jsxs("button",{onClick:()=>ke(ye.phone),className:"w-full flex items-center justify-between px-4 py-4 active:bg-gray-50 transition-colors","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI2NDoxOA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI2OToyMA","data-yw-s":!0,children:[l.jsx("div",{className:`p-2 rounded-lg ${ye.type==="emergency"?"bg-red-100":ye.type==="support"?"bg-blue-100":"bg-gray-100"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI3MDoyMg","data-yw-s":!0,children:l.jsx(Up,{className:`w-5 h-5 ${ye.type==="emergency"?"text-red-600":ye.type==="support"?"text-blue-600":"text-gray-600"}`,"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI3NToyNA","data-yw-s":!0})}),l.jsxs("div",{className:"text-left","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI4MToyMg","data-yw-s":!0,children:[l.jsx("div",{className:"font-medium text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI4MjoyNA","data-yw-s":!0,children:ye.name}),l.jsx("div",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI4MzoyNA","data-yw-s":!0,children:ye.phone})]})]}),l.jsx(Up,{className:"w-5 h-5 text-gray-400","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI4NjoyMA","data-yw-s":!0})]},ye.id))})]}),X&&l.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI5NDoxNA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI5NToxNg","data-yw-s":!0,children:[l.jsx(Yo,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI5NjoxOA","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI5NzoxOA","data-yw-s":!0,children:[l.jsx("div",{className:"font-semibold text-gray-900 mb-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI5ODoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Current Location"}),l.jsxs("div",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI5OToyMA","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDI5OTo1OQ","data-yw-t":!0,"data-yw-auto":!0,children:"Lat: "}),X.coords.latitude.toFixed(6),l.jsx("br",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDMwMDo3MQ","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDMwMDo3Nw","data-yw-t":!0,"data-yw-auto":!0,children:"Lng: "}),X.coords.longitude.toFixed(6)]}),l.jsx("div",{className:"text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1NPU1BhZ2UudHN4QDMwMzoyMA","data-yw-t":!0,"data-yw-s":!0,children:"Location will be shared with emergency services"})]})]})})]})})]})})}function nF(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState({totalReferrals:0,totalEarned:0,pendingReferrals:0}),[Z,S]=fe.useState(!0),[n,B]=fe.useState(!1);fe.useEffect(()=>{D()},[]);const D=async()=>{try{const Y=await ui();if(!Y){u("/auth");return}const X=await oI(Y.id,Y.name);d(X);const ue=await uI(Y.id);ue&&j(ue)}catch(Y){console.error("Error loading referral data:",Y)}finally{S(!1)}},P=()=>{o&&(navigator.clipboard.writeText(o.referral_code),B(!0),setTimeout(()=>B(!1),2e3))},G=async()=>{if(!o)return;const Y=`Join OnGoPool with my referral code ${o.referral_code} and get 10% off your first ride! `;if(navigator.share)try{await navigator.share({title:"OnGoPool Referral",text:Y})}catch{console.log("Share cancelled")}else navigator.clipboard.writeText(Y),B(!0),setTimeout(()=>B(!1),2e3)};return Z?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gray-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hANzM6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hANzQ6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hANzU6MTA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hANzY6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):l.jsx("div",{className:"w-full h-dvh bg-gradient-to-b from-blue-50 to-white","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAODM6NA","data-yw-s":!0,children:l.jsxs("main",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAODQ6Ng","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none px-4 py-3 bg-white shadow-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAOTI6OA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAOTM6MTA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 active:bg-gray-100 rounded-lg","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAOTQ6MTI","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAOTU6MTQ","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAOTc6MTI","data-yw-t":!0,"data-yw-s":!0,children:"Refer & Earn"})]})}),l.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTAyOjg","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl p-6 text-white","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTA0OjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTA1OjEy","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTA2OjE0","data-yw-s":!0,children:l.jsx(a_,{className:"w-6 h-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTA3OjE2","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTA5OjE0","data-yw-s":!0,children:[l.jsx("h2",{className:"text-2xl font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTEwOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Give 10%, Get Rewards"}),l.jsx("p",{className:"text-blue-100 text-sm","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTExOjE2","data-yw-t":!0,"data-yw-s":!0,children:"Share with friends and earn together"})]})]}),l.jsxs("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTE1OjEy","data-yw-s":!0,children:[l.jsx("p",{className:"text-blue-100 text-xs mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTE2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Your Referral Code"}),l.jsx("div",{className:"flex items-center justify-between","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTE3OjE0","data-yw-s":!0,children:l.jsx("span",{className:"text-3xl font-bold tracking-wider","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTE4OjE2","data-yw-s":!0,children:o?.referral_code||"LOADING"})})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTI0OjEy","data-yw-s":!0,children:[l.jsxs("button",{onClick:P,className:"bg-white text-blue-600 py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2 active:bg-blue-50","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTI1OjE0","data-yw-s":!0,children:[n?l.jsx(Hd,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTI5OjI2","data-yw-s":!0}):l.jsx(KM,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTI5OjY0","data-yw-s":!0}),n?"Copied!":"Copy"]}),l.jsxs("button",{onClick:G,className:"bg-white/20 backdrop-blur text-white py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2 active:bg-white/30","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTMyOjE0","data-yw-s":!0,children:[l.jsx(kB,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTM2OjE2","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTM2OjQ2","data-yw-t":!0,"data-yw-auto":!0,children:"Share"})]})]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-3","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTQzOjEw","data-yw-s":!0,children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-md","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTQ0OjEy","data-yw-s":!0,children:[l.jsx(Yd,{className:"w-8 h-8 text-blue-600 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTQ1OjE0","data-yw-s":!0}),l.jsx("p",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTQ2OjE0","data-yw-s":!0,children:g.totalReferrals}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTQ3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Total Referrals"})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-md","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTQ5OjEy","data-yw-s":!0,children:[l.jsx(Ho,{className:"w-8 h-8 text-green-600 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTUwOjE0","data-yw-s":!0}),l.jsxs("p",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTUxOjE0","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTUxOjYy","data-yw-t":!0,"data-yw-auto":!0,children:"$"}),g.totalEarned.toFixed(0)]}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTUyOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Total Earned"})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-md","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTU0OjEy","data-yw-s":!0,children:[l.jsx(a_,{className:"w-8 h-8 text-purple-600 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTU1OjE0","data-yw-s":!0}),l.jsx("p",{className:"text-2xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTU2OjE0","data-yw-s":!0,children:g.pendingReferrals}),l.jsx("p",{className:"text-xs text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTU3OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Pending"})]})]}),l.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTYyOjEw","data-yw-s":!0,children:[l.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTYzOjEy","data-yw-t":!0,"data-yw-s":!0,children:"How It Works"}),l.jsxs("div",{className:"space-y-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTY0OjEy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex gap-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTY1OjE0","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTY2OjE2","data-yw-s":!0,children:l.jsx("span",{className:"text-blue-600 font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTY3OjE4","data-yw-t":!0,"data-yw-s":!0,children:"1"})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTY5OjE2","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTcwOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Share Your Code"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTcxOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Send your unique referral code to friends and family"})]})]}),l.jsxs("div",{className:"flex gap-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTc0OjE0","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTc1OjE2","data-yw-s":!0,children:l.jsx("span",{className:"text-purple-600 font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTc2OjE4","data-yw-t":!0,"data-yw-s":!0,children:"2"})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTc4OjE2","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTc5OjE4","data-yw-t":!0,"data-yw-s":!0,children:"They Get 10% Off"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTgwOjE4","data-yw-t":!0,"data-yw-s":!0,children:"Your friends receive 10% discount on their first ride"})]})]}),l.jsxs("div",{className:"flex gap-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTgzOjE0","data-yw-s":!0,children:[l.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTg0OjE2","data-yw-s":!0,children:l.jsx("span",{className:"text-green-600 font-bold","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTg1OjE4","data-yw-t":!0,"data-yw-s":!0,children:"3"})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTg3OjE2","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTg4OjE4","data-yw-t":!0,"data-yw-s":!0,children:"You Earn Rewards"}),l.jsx("p",{className:"text-sm text-gray-600","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTg5OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Get credits and bonuses for each successful referral"})]})]})]})]}),l.jsxs("div",{className:"bg-gray-50 rounded-xl p-4","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTk2OjEw","data-yw-s":!0,children:[l.jsx("h4",{className:"font-semibold text-gray-900 mb-2","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTk3OjEy","data-yw-t":!0,"data-yw-s":!0,children:"Terms & Conditions"}),l.jsxs("ul",{className:"text-xs text-gray-600 space-y-1","data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTk4OjEy","data-yw-s":!0,children:[l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMTk5OjE0","data-yw-t":!0,"data-yw-s":!0,children:" 10% discount applies to first ride only"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMjAwOjE0","data-yw-t":!0,"data-yw-s":!0,children:" Minimum ride value of $10 required"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMjAxOjE0","data-yw-t":!0,"data-yw-s":!0,children:" Referral code valid for 90 days"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMjAyOjE0","data-yw-t":!0,"data-yw-s":!0,children:" Cannot be combined with other offers"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL3JpZGVyL1JlZmVyUGFnZS50c3hAMjAzOjE0","data-yw-t":!0,"data-yw-s":!0,children:" OnGoPool reserves the right to modify terms"})]})]})]})]})})}function iF(u,o){const d={};return(u[u.length-1]===""?[...u,""]:u).join((d.padRight?" ":"")+","+(d.padLeft===!1?"":" ")).trim()}const sF=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,oF=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,lF={};function YL(u,o){return(lF.jsx?oF:sF).test(u)}const cF=/[ \t\n\f\r]/g;function uF(u){return typeof u=="object"?u.type==="text"?$L(u.value):!1:$L(u)}function $L(u){return u.replace(cF,"")===""}class Rg{constructor(o,d,g){this.normal=d,this.property=o,g&&(this.space=g)}}Rg.prototype.normal={};Rg.prototype.property={};Rg.prototype.space=void 0;function MN(u,o){const d={},g={};for(const j of u)Object.assign(d,j.property),Object.assign(g,j.normal);return new Rg(d,g,o)}function Cw(u){return u.toLowerCase()}class Wl{constructor(o,d){this.attribute=d,this.property=o}}Wl.prototype.attribute="";Wl.prototype.booleanish=!1;Wl.prototype.boolean=!1;Wl.prototype.commaOrSpaceSeparated=!1;Wl.prototype.commaSeparated=!1;Wl.prototype.defined=!1;Wl.prototype.mustUseProperty=!1;Wl.prototype.number=!1;Wl.prototype.overloadedBoolean=!1;Wl.prototype.property="";Wl.prototype.spaceSeparated=!1;Wl.prototype.space=void 0;let dF=0;const mn=$p(),Ts=$p(),Pw=$p(),Ea=$p(),Ri=$p(),Ym=$p(),_c=$p();function $p(){return 2**++dF}const Gw=Object.freeze(Object.defineProperty({__proto__:null,boolean:mn,booleanish:Ts,commaOrSpaceSeparated:_c,commaSeparated:Ym,number:Ea,overloadedBoolean:Pw,spaceSeparated:Ri},Symbol.toStringTag,{value:"Module"})),iw=Object.keys(Gw);class Zv extends Wl{constructor(o,d,g,j){let Z=-1;if(super(o,d),qL(this,"space",j),typeof g=="number")for(;++Z<iw.length;){const S=iw[Z];qL(this,iw[Z],(g&Gw[S])===Gw[S])}}}Zv.prototype.defined=!0;function qL(u,o,d){d&&(u[o]=d)}function ly(u){const o={},d={};for(const[g,j]of Object.entries(u.properties)){const Z=new Zv(g,u.transform(u.attributes||{},g),j,u.space);u.mustUseProperty&&u.mustUseProperty.includes(g)&&(Z.mustUseProperty=!0),o[g]=Z,d[Cw(g)]=g,d[Cw(Z.attribute)]=g}return new Rg(o,d,u.space)}const BN=ly({properties:{ariaActiveDescendant:null,ariaAtomic:Ts,ariaAutoComplete:null,ariaBusy:Ts,ariaChecked:Ts,ariaColCount:Ea,ariaColIndex:Ea,ariaColSpan:Ea,ariaControls:Ri,ariaCurrent:null,ariaDescribedBy:Ri,ariaDetails:null,ariaDisabled:Ts,ariaDropEffect:Ri,ariaErrorMessage:null,ariaExpanded:Ts,ariaFlowTo:Ri,ariaGrabbed:Ts,ariaHasPopup:null,ariaHidden:Ts,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ri,ariaLevel:Ea,ariaLive:null,ariaModal:Ts,ariaMultiLine:Ts,ariaMultiSelectable:Ts,ariaOrientation:null,ariaOwns:Ri,ariaPlaceholder:null,ariaPosInSet:Ea,ariaPressed:Ts,ariaReadOnly:Ts,ariaRelevant:null,ariaRequired:Ts,ariaRoleDescription:Ri,ariaRowCount:Ea,ariaRowIndex:Ea,ariaRowSpan:Ea,ariaSelected:Ts,ariaSetSize:Ea,ariaSort:null,ariaValueMax:Ea,ariaValueMin:Ea,ariaValueNow:Ea,ariaValueText:null,role:null},transform(u,o){return o==="role"?o:"aria-"+o.slice(4).toLowerCase()}});function IN(u,o){return o in u?u[o]:o}function kN(u,o){return IN(u,o.toLowerCase())}const hF=ly({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Ym,acceptCharset:Ri,accessKey:Ri,action:null,allow:null,allowFullScreen:mn,allowPaymentRequest:mn,allowUserMedia:mn,alt:null,as:null,async:mn,autoCapitalize:null,autoComplete:Ri,autoFocus:mn,autoPlay:mn,blocking:Ri,capture:null,charSet:null,checked:mn,cite:null,className:Ri,cols:Ea,colSpan:null,content:null,contentEditable:Ts,controls:mn,controlsList:Ri,coords:Ea|Ym,crossOrigin:null,data:null,dateTime:null,decoding:null,default:mn,defer:mn,dir:null,dirName:null,disabled:mn,download:Pw,draggable:Ts,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:mn,formTarget:null,headers:Ri,height:Ea,hidden:Pw,high:Ea,href:null,hrefLang:null,htmlFor:Ri,httpEquiv:Ri,id:null,imageSizes:null,imageSrcSet:null,inert:mn,inputMode:null,integrity:null,is:null,isMap:mn,itemId:null,itemProp:Ri,itemRef:Ri,itemScope:mn,itemType:Ri,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:mn,low:Ea,manifest:null,max:null,maxLength:Ea,media:null,method:null,min:null,minLength:Ea,multiple:mn,muted:mn,name:null,nonce:null,noModule:mn,noValidate:mn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:mn,optimum:Ea,pattern:null,ping:Ri,placeholder:null,playsInline:mn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:mn,referrerPolicy:null,rel:Ri,required:mn,reversed:mn,rows:Ea,rowSpan:Ea,sandbox:Ri,scope:null,scoped:mn,seamless:mn,selected:mn,shadowRootClonable:mn,shadowRootDelegatesFocus:mn,shadowRootMode:null,shape:null,size:Ea,sizes:null,slot:null,span:Ea,spellCheck:Ts,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Ea,step:null,style:null,tabIndex:Ea,target:null,title:null,translate:null,type:null,typeMustMatch:mn,useMap:null,value:Ts,width:Ea,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ri,axis:null,background:null,bgColor:null,border:Ea,borderColor:null,bottomMargin:Ea,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:mn,declare:mn,event:null,face:null,frame:null,frameBorder:null,hSpace:Ea,leftMargin:Ea,link:null,longDesc:null,lowSrc:null,marginHeight:Ea,marginWidth:Ea,noResize:mn,noHref:mn,noShade:mn,noWrap:mn,object:null,profile:null,prompt:null,rev:null,rightMargin:Ea,rules:null,scheme:null,scrolling:Ts,standby:null,summary:null,text:null,topMargin:Ea,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Ea,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:mn,disableRemotePlayback:mn,prefix:null,property:null,results:Ea,security:null,unselectable:null},space:"html",transform:kN}),fF=ly({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:_c,accentHeight:Ea,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Ea,amplitude:Ea,arabicForm:null,ascent:Ea,attributeName:null,attributeType:null,azimuth:Ea,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Ea,by:null,calcMode:null,capHeight:Ea,className:Ri,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Ea,diffuseConstant:Ea,direction:null,display:null,dur:null,divisor:Ea,dominantBaseline:null,download:mn,dx:null,dy:null,edgeMode:null,editable:null,elevation:Ea,enableBackground:null,end:null,event:null,exponent:Ea,externalResourcesRequired:null,fill:null,fillOpacity:Ea,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Ym,g2:Ym,glyphName:Ym,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Ea,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Ea,horizOriginX:Ea,horizOriginY:Ea,id:null,ideographic:Ea,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Ea,k:Ea,k1:Ea,k2:Ea,k3:Ea,k4:Ea,kernelMatrix:_c,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Ea,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Ea,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Ea,overlineThickness:Ea,paintOrder:null,panose1:null,path:null,pathLength:Ea,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ri,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Ea,pointsAtY:Ea,pointsAtZ:Ea,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:_c,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:_c,rev:_c,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:_c,requiredFeatures:_c,requiredFonts:_c,requiredFormats:_c,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Ea,specularExponent:Ea,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Ea,strikethroughThickness:Ea,string:null,stroke:null,strokeDashArray:_c,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Ea,strokeOpacity:Ea,strokeWidth:null,style:null,surfaceScale:Ea,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:_c,tabIndex:Ea,tableValues:null,target:null,targetX:Ea,targetY:Ea,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:_c,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Ea,underlineThickness:Ea,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Ea,values:null,vAlphabetic:Ea,vMathematical:Ea,vectorEffect:null,vHanging:Ea,vIdeographic:Ea,version:null,vertAdvY:Ea,vertOriginX:Ea,vertOriginY:Ea,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Ea,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:IN}),JN=ly({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(u,o){return"xlink:"+o.slice(5).toLowerCase()}}),FN=ly({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:kN}),ON=ly({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(u,o){return"xml:"+o.slice(3).toLowerCase()}}),pF={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},mF=/[A-Z]/g,KL=/-[a-z]/g,yF=/^data[-\w.:]+$/i;function gF(u,o){const d=Cw(o);let g=o,j=Wl;if(d in u.normal)return u.property[u.normal[d]];if(d.length>4&&d.slice(0,4)==="data"&&yF.test(o)){if(o.charAt(4)==="-"){const Z=o.slice(5).replace(KL,xF);g="data"+Z.charAt(0).toUpperCase()+Z.slice(1)}else{const Z=o.slice(4);if(!KL.test(Z)){let S=Z.replace(mF,_F);S.charAt(0)!=="-"&&(S="-"+S),o="data"+S}}j=Zv}return new j(g,o)}function _F(u){return"-"+u.toLowerCase()}function xF(u){return u.charAt(1).toUpperCase()}const wF=MN([BN,hF,JN,FN,ON],"html"),Nv=MN([BN,fF,JN,FN,ON],"svg");function vF(u){return u.join(" ").trim()}var Gm={},sw,ej;function bF(){if(ej)return sw;ej=1;var u=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,o=/\n/g,d=/^\s*/,g=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,j=/^:\s*/,Z=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,S=/^[;\s]*/,n=/^\s+|\s+$/g,B=`
`,D="/",P="*",G="",Y="comment",X="declaration";function ue(pe,ve){if(typeof pe!="string")throw new TypeError("First argument must be a string");if(!pe)return[];ve=ve||{};var ke=1,ye=1;function $e(st){var ht=st.match(o);ht&&(ke+=ht.length);var Wt=st.lastIndexOf(B);ye=~Wt?st.length-Wt:ye+st.length}function De(){var st={line:ke,column:ye};return function(ht){return ht.position=new Te(st),bt(),ht}}function Te(st){this.start=st,this.end={line:ke,column:ye},this.source=ve.source}Te.prototype.content=pe;function Qe(st){var ht=new Error(ve.source+":"+ke+":"+ye+": "+st);if(ht.reason=st,ht.filename=ve.source,ht.line=ke,ht.column=ye,ht.source=pe,!ve.silent)throw ht}function Ft(st){var ht=st.exec(pe);if(ht){var Wt=ht[0];return $e(Wt),pe=pe.slice(Wt.length),ht}}function bt(){Ft(d)}function Qt(st){var ht;for(st=st||[];ht=Gt();)ht!==!1&&st.push(ht);return st}function Gt(){var st=De();if(!(D!=pe.charAt(0)||P!=pe.charAt(1))){for(var ht=2;G!=pe.charAt(ht)&&(P!=pe.charAt(ht)||D!=pe.charAt(ht+1));)++ht;if(ht+=2,G===pe.charAt(ht-1))return Qe("End of comment missing");var Wt=pe.slice(2,ht-2);return ye+=2,$e(Wt),pe=pe.slice(ht),ye+=2,st({type:Y,comment:Wt})}}function yt(){var st=De(),ht=Ft(g);if(ht){if(Gt(),!Ft(j))return Qe("property missing ':'");var Wt=Ft(Z),qt=st({type:X,property:oe(ht[0].replace(u,G)),value:Wt?oe(Wt[0].replace(u,G)):G});return Ft(S),qt}}function Ke(){var st=[];Qt(st);for(var ht;ht=yt();)ht!==!1&&(st.push(ht),Qt(st));return st}return bt(),Ke()}function oe(pe){return pe?pe.replace(n,G):G}return sw=ue,sw}var tj;function LF(){if(tj)return Gm;tj=1;var u=Gm&&Gm.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(Gm,"__esModule",{value:!0}),Gm.default=d;const o=u(bF());function d(g,j){let Z=null;if(!g||typeof g!="string")return Z;const S=(0,o.default)(g),n=typeof j=="function";return S.forEach(B=>{if(B.type!=="declaration")return;const{property:D,value:P}=B;n?j(D,P,B):P&&(Z=Z||{},Z[D]=P)}),Z}return Gm}var ng={},aj;function jF(){if(aj)return ng;aj=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.camelCase=void 0;var u=/^--[a-zA-Z0-9_-]+$/,o=/-([a-z])/g,d=/^[^-]+$/,g=/^-(webkit|moz|ms|o|khtml)-/,j=/^-(ms)-/,Z=function(D){return!D||d.test(D)||u.test(D)},S=function(D,P){return P.toUpperCase()},n=function(D,P){return"".concat(P,"-")},B=function(D,P){return P===void 0&&(P={}),Z(D)?D:(D=D.toLowerCase(),P.reactCompat?D=D.replace(j,n):D=D.replace(g,n),D.replace(o,S))};return ng.camelCase=B,ng}var ig,rj;function ZF(){if(rj)return ig;rj=1;var u=ig&&ig.__importDefault||function(j){return j&&j.__esModule?j:{default:j}},o=u(LF()),d=jF();function g(j,Z){var S={};return!j||typeof j!="string"||(0,o.default)(j,function(n,B){n&&B&&(S[(0,d.camelCase)(n,Z)]=B)}),S}return g.default=g,ig=g,ig}var NF=ZF();const EF=ry(NF),DN=CN("end"),Ev=CN("start");function CN(u){return o;function o(d){const g=d&&d.position&&d.position[u]||{};if(typeof g.line=="number"&&g.line>0&&typeof g.column=="number"&&g.column>0)return{line:g.line,column:g.column,offset:typeof g.offset=="number"&&g.offset>-1?g.offset:void 0}}}function SF(u){const o=Ev(u),d=DN(u);if(o&&d)return{start:o,end:d}}function fg(u){return!u||typeof u!="object"?"":"position"in u||"type"in u?nj(u.position):"start"in u||"end"in u?nj(u):"line"in u||"column"in u?Uw(u):""}function Uw(u){return ij(u&&u.line)+":"+ij(u&&u.column)}function nj(u){return Uw(u&&u.start)+"-"+Uw(u&&u.end)}function ij(u){return u&&typeof u=="number"?u:1}class $o extends Error{constructor(o,d,g){super(),typeof d=="string"&&(g=d,d=void 0);let j="",Z={},S=!1;if(d&&("line"in d&&"column"in d?Z={place:d}:"start"in d&&"end"in d?Z={place:d}:"type"in d?Z={ancestors:[d],place:d.position}:Z={...d}),typeof o=="string"?j=o:!Z.cause&&o&&(S=!0,j=o.message,Z.cause=o),!Z.ruleId&&!Z.source&&typeof g=="string"){const B=g.indexOf(":");B===-1?Z.ruleId=g:(Z.source=g.slice(0,B),Z.ruleId=g.slice(B+1))}if(!Z.place&&Z.ancestors&&Z.ancestors){const B=Z.ancestors[Z.ancestors.length-1];B&&(Z.place=B.position)}const n=Z.place&&"start"in Z.place?Z.place.start:Z.place;this.ancestors=Z.ancestors||void 0,this.cause=Z.cause||void 0,this.column=n?n.column:void 0,this.fatal=void 0,this.file="",this.message=j,this.line=n?n.line:void 0,this.name=fg(Z.place)||"1:1",this.place=Z.place||void 0,this.reason=this.message,this.ruleId=Z.ruleId||void 0,this.source=Z.source||void 0,this.stack=S&&Z.cause&&typeof Z.cause.stack=="string"?Z.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}$o.prototype.file="";$o.prototype.name="";$o.prototype.reason="";$o.prototype.message="";$o.prototype.stack="";$o.prototype.column=void 0;$o.prototype.line=void 0;$o.prototype.ancestors=void 0;$o.prototype.cause=void 0;$o.prototype.fatal=void 0;$o.prototype.place=void 0;$o.prototype.ruleId=void 0;$o.prototype.source=void 0;const Sv={}.hasOwnProperty,zF=new Map,AF=/[A-Z]/g,RF=new Set(["table","tbody","thead","tfoot","tr"]),TF=new Set(["td","th"]),PN="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function VF(u,o){if(!o||o.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const d=o.filePath||void 0;let g;if(o.development){if(typeof o.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");g=DF(d,o.jsxDEV)}else{if(typeof o.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof o.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");g=OF(d,o.jsx,o.jsxs)}const j={Fragment:o.Fragment,ancestors:[],components:o.components||{},create:g,elementAttributeNameCase:o.elementAttributeNameCase||"react",evaluater:o.createEvaluater?o.createEvaluater():void 0,filePath:d,ignoreInvalidStyle:o.ignoreInvalidStyle||!1,passKeys:o.passKeys!==!1,passNode:o.passNode||!1,schema:o.space==="svg"?Nv:wF,stylePropertyNameCase:o.stylePropertyNameCase||"dom",tableCellAlignToStyle:o.tableCellAlignToStyle!==!1},Z=GN(j,u,void 0);return Z&&typeof Z!="string"?Z:j.create(u,j.Fragment,{children:Z||void 0},void 0)}function GN(u,o,d){if(o.type==="element")return MF(u,o,d);if(o.type==="mdxFlowExpression"||o.type==="mdxTextExpression")return BF(u,o);if(o.type==="mdxJsxFlowElement"||o.type==="mdxJsxTextElement")return kF(u,o,d);if(o.type==="mdxjsEsm")return IF(u,o);if(o.type==="root")return JF(u,o,d);if(o.type==="text")return FF(u,o)}function MF(u,o,d){const g=u.schema;let j=g;o.tagName.toLowerCase()==="svg"&&g.space==="html"&&(j=Nv,u.schema=j),u.ancestors.push(o);const Z=WN(u,o.tagName,!1),S=CF(u,o);let n=Av(u,o);return RF.has(o.tagName)&&(n=n.filter(function(B){return typeof B=="string"?!uF(B):!0})),UN(u,S,Z,o),zv(S,n),u.ancestors.pop(),u.schema=g,u.create(o,Z,S,d)}function BF(u,o){if(o.data&&o.data.estree&&u.evaluater){const g=o.data.estree.body[0];return g.type,u.evaluater.evaluateExpression(g.expression)}jg(u,o.position)}function IF(u,o){if(o.data&&o.data.estree&&u.evaluater)return u.evaluater.evaluateProgram(o.data.estree);jg(u,o.position)}function kF(u,o,d){const g=u.schema;let j=g;o.name==="svg"&&g.space==="html"&&(j=Nv,u.schema=j),u.ancestors.push(o);const Z=o.name===null?u.Fragment:WN(u,o.name,!0),S=PF(u,o),n=Av(u,o);return UN(u,S,Z,o),zv(S,n),u.ancestors.pop(),u.schema=g,u.create(o,Z,S,d)}function JF(u,o,d){const g={};return zv(g,Av(u,o)),u.create(o,u.Fragment,g,d)}function FF(u,o){return o.value}function UN(u,o,d,g){typeof d!="string"&&d!==u.Fragment&&u.passNode&&(o.node=g)}function zv(u,o){if(o.length>0){const d=o.length>1?o:o[0];d&&(u.children=d)}}function OF(u,o,d){return g;function g(j,Z,S,n){const D=Array.isArray(S.children)?d:o;return n?D(Z,S,n):D(Z,S)}}function DF(u,o){return d;function d(g,j,Z,S){const n=Array.isArray(Z.children),B=Ev(g);return o(j,Z,S,n,{columnNumber:B?B.column-1:void 0,fileName:u,lineNumber:B?B.line:void 0},void 0)}}function CF(u,o){const d={};let g,j;for(j in o.properties)if(j!=="children"&&Sv.call(o.properties,j)){const Z=GF(u,j,o.properties[j]);if(Z){const[S,n]=Z;u.tableCellAlignToStyle&&S==="align"&&typeof n=="string"&&TF.has(o.tagName)?g=n:d[S]=n}}if(g){const Z=d.style||(d.style={});Z[u.stylePropertyNameCase==="css"?"text-align":"textAlign"]=g}return d}function PF(u,o){const d={};for(const g of o.attributes)if(g.type==="mdxJsxExpressionAttribute")if(g.data&&g.data.estree&&u.evaluater){const Z=g.data.estree.body[0];Z.type;const S=Z.expression;S.type;const n=S.properties[0];n.type,Object.assign(d,u.evaluater.evaluateExpression(n.argument))}else jg(u,o.position);else{const j=g.name;let Z;if(g.value&&typeof g.value=="object")if(g.value.data&&g.value.data.estree&&u.evaluater){const n=g.value.data.estree.body[0];n.type,Z=u.evaluater.evaluateExpression(n.expression)}else jg(u,o.position);else Z=g.value===null?!0:g.value;d[j]=Z}return d}function Av(u,o){const d=[];let g=-1;const j=u.passKeys?new Map:zF;for(;++g<o.children.length;){const Z=o.children[g];let S;if(u.passKeys){const B=Z.type==="element"?Z.tagName:Z.type==="mdxJsxFlowElement"||Z.type==="mdxJsxTextElement"?Z.name:void 0;if(B){const D=j.get(B)||0;S=B+"-"+D,j.set(B,D+1)}}const n=GN(u,Z,S);n!==void 0&&d.push(n)}return d}function GF(u,o,d){const g=gF(u.schema,o);if(!(d==null||typeof d=="number"&&Number.isNaN(d))){if(Array.isArray(d)&&(d=g.commaSeparated?iF(d):vF(d)),g.property==="style"){let j=typeof d=="object"?d:UF(u,String(d));return u.stylePropertyNameCase==="css"&&(j=WF(j)),["style",j]}return[u.elementAttributeNameCase==="react"&&g.space?pF[g.property]||g.property:g.attribute,d]}}function UF(u,o){try{return EF(o,{reactCompat:!0})}catch(d){if(u.ignoreInvalidStyle)return{};const g=d,j=new $o("Cannot parse `style` attribute",{ancestors:u.ancestors,cause:g,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw j.file=u.filePath||void 0,j.url=PN+"#cannot-parse-style-attribute",j}}function WN(u,o,d){let g;if(!d)g={type:"Literal",value:o};else if(o.includes(".")){const j=o.split(".");let Z=-1,S;for(;++Z<j.length;){const n=YL(j[Z])?{type:"Identifier",name:j[Z]}:{type:"Literal",value:j[Z]};S=S?{type:"MemberExpression",object:S,property:n,computed:!!(Z&&n.type==="Literal"),optional:!1}:n}g=S}else g=YL(o)&&!/^[a-z]/.test(o)?{type:"Identifier",name:o}:{type:"Literal",value:o};if(g.type==="Literal"){const j=g.value;return Sv.call(u.components,j)?u.components[j]:j}if(u.evaluater)return u.evaluater.evaluateExpression(g);jg(u)}function jg(u,o){const d=new $o("Cannot handle MDX estrees without `createEvaluater`",{ancestors:u.ancestors,place:o,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw d.file=u.filePath||void 0,d.url=PN+"#cannot-handle-mdx-estrees-without-createevaluater",d}function WF(u){const o={};let d;for(d in u)Sv.call(u,d)&&(o[XF(d)]=u[d]);return o}function XF(u){let o=u.replace(AF,QF);return o.slice(0,3)==="ms-"&&(o="-"+o),o}function QF(u){return"-"+u.toLowerCase()}const ow={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},HF={};function YF(u,o){const d=HF,g=typeof d.includeImageAlt=="boolean"?d.includeImageAlt:!0,j=typeof d.includeHtml=="boolean"?d.includeHtml:!0;return XN(u,g,j)}function XN(u,o,d){if($F(u)){if("value"in u)return u.type==="html"&&!d?"":u.value;if(o&&"alt"in u&&u.alt)return u.alt;if("children"in u)return sj(u.children,o,d)}return Array.isArray(u)?sj(u,o,d):""}function sj(u,o,d){const g=[];let j=-1;for(;++j<u.length;)g[j]=XN(u[j],o,d);return g.join("")}function $F(u){return!!(u&&typeof u=="object")}const oj=document.createElement("i");function Rv(u){const o="&"+u+";";oj.innerHTML=o;const d=oj.textContent;return d.charCodeAt(d.length-1)===59&&u!=="semi"||d===o?!1:d}function Qd(u,o,d,g){const j=u.length;let Z=0,S;if(o<0?o=-o>j?0:j+o:o=o>j?j:o,d=d>0?d:0,g.length<1e4)S=Array.from(g),S.unshift(o,d),u.splice(...S);else for(d&&u.splice(o,d);Z<g.length;)S=g.slice(Z,Z+1e4),S.unshift(o,0),u.splice(...S),Z+=1e4,o+=1e4}function qc(u,o){return u.length>0?(Qd(u,u.length,0,o),u):o}const lj={}.hasOwnProperty;function qF(u){const o={};let d=-1;for(;++d<u.length;)KF(o,u[d]);return o}function KF(u,o){let d;for(d in o){const j=(lj.call(u,d)?u[d]:void 0)||(u[d]={}),Z=o[d];let S;if(Z)for(S in Z){lj.call(j,S)||(j[S]=[]);const n=Z[S];eO(j[S],Array.isArray(n)?n:n?[n]:[])}}}function eO(u,o){let d=-1;const g=[];for(;++d<o.length;)(o[d].add==="after"?u:g).push(o[d]);Qd(u,0,0,g)}function QN(u,o){const d=Number.parseInt(u,o);return d<9||d===11||d>13&&d<32||d>126&&d<160||d>55295&&d<57344||d>64975&&d<65008||(d&65535)===65535||(d&65535)===65534||d>1114111?"":String.fromCodePoint(d)}function $m(u){return u.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Xd=Kf(/[A-Za-z]/),vc=Kf(/[\dA-Za-z]/),tO=Kf(/[#-'*+\--9=?A-Z^-~]/);function Ww(u){return u!==null&&(u<32||u===127)}const Xw=Kf(/\d/),aO=Kf(/[\dA-Fa-f]/),rO=Kf(/[!-/:-@[-`{-~]/);function Hr(u){return u!==null&&u<-2}function Pl(u){return u!==null&&(u<0||u===32)}function ri(u){return u===-2||u===-1||u===32}const nO=Kf(new RegExp("\\p{P}|\\p{S}","u")),iO=Kf(/\s/);function Kf(u){return o;function o(d){return d!==null&&d>-1&&u.test(String.fromCharCode(d))}}function cy(u){const o=[];let d=-1,g=0,j=0;for(;++d<u.length;){const Z=u.charCodeAt(d);let S="";if(Z===37&&vc(u.charCodeAt(d+1))&&vc(u.charCodeAt(d+2)))j=2;else if(Z<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(Z))||(S=String.fromCharCode(Z));else if(Z>55295&&Z<57344){const n=u.charCodeAt(d+1);Z<56320&&n>56319&&n<57344?(S=String.fromCharCode(Z,n),j=1):S=""}else S=String.fromCharCode(Z);S&&(o.push(u.slice(g,d),encodeURIComponent(S)),g=d+j+1,S=""),j&&(d+=j,j=0)}return o.join("")+u.slice(g)}function Ti(u,o,d,g){const j=g?g-1:Number.POSITIVE_INFINITY;let Z=0;return S;function S(B){return ri(B)?(u.enter(d),n(B)):o(B)}function n(B){return ri(B)&&Z++<j?(u.consume(B),n):(u.exit(d),o(B))}}const sO={tokenize:oO};function oO(u){const o=u.attempt(this.parser.constructs.contentInitial,g,j);let d;return o;function g(n){if(n===null){u.consume(n);return}return u.enter("lineEnding"),u.consume(n),u.exit("lineEnding"),Ti(u,o,"linePrefix")}function j(n){return u.enter("paragraph"),Z(n)}function Z(n){const B=u.enter("chunkText",{contentType:"text",previous:d});return d&&(d.next=B),d=B,S(n)}function S(n){if(n===null){u.exit("chunkText"),u.exit("paragraph"),u.consume(n);return}return Hr(n)?(u.consume(n),u.exit("chunkText"),Z):(u.consume(n),S)}}const lO={tokenize:cO},cj={tokenize:uO};function cO(u){const o=this,d=[];let g=0,j,Z,S;return n;function n(ye){if(g<d.length){const $e=d[g];return o.containerState=$e[1],u.attempt($e[0].continuation,B,D)(ye)}return D(ye)}function B(ye){if(g++,o.containerState._closeFlow){o.containerState._closeFlow=void 0,j&&ke();const $e=o.events.length;let De=$e,Te;for(;De--;)if(o.events[De][0]==="exit"&&o.events[De][1].type==="chunkFlow"){Te=o.events[De][1].end;break}ve(g);let Qe=$e;for(;Qe<o.events.length;)o.events[Qe][1].end={...Te},Qe++;return Qd(o.events,De+1,0,o.events.slice($e)),o.events.length=Qe,D(ye)}return n(ye)}function D(ye){if(g===d.length){if(!j)return Y(ye);if(j.currentConstruct&&j.currentConstruct.concrete)return ue(ye);o.interrupt=!!(j.currentConstruct&&!j._gfmTableDynamicInterruptHack)}return o.containerState={},u.check(cj,P,G)(ye)}function P(ye){return j&&ke(),ve(g),Y(ye)}function G(ye){return o.parser.lazy[o.now().line]=g!==d.length,S=o.now().offset,ue(ye)}function Y(ye){return o.containerState={},u.attempt(cj,X,ue)(ye)}function X(ye){return g++,d.push([o.currentConstruct,o.containerState]),Y(ye)}function ue(ye){if(ye===null){j&&ke(),ve(0),u.consume(ye);return}return j=j||o.parser.flow(o.now()),u.enter("chunkFlow",{_tokenizer:j,contentType:"flow",previous:Z}),oe(ye)}function oe(ye){if(ye===null){pe(u.exit("chunkFlow"),!0),ve(0),u.consume(ye);return}return Hr(ye)?(u.consume(ye),pe(u.exit("chunkFlow")),g=0,o.interrupt=void 0,n):(u.consume(ye),oe)}function pe(ye,$e){const De=o.sliceStream(ye);if($e&&De.push(null),ye.previous=Z,Z&&(Z.next=ye),Z=ye,j.defineSkip(ye.start),j.write(De),o.parser.lazy[ye.start.line]){let Te=j.events.length;for(;Te--;)if(j.events[Te][1].start.offset<S&&(!j.events[Te][1].end||j.events[Te][1].end.offset>S))return;const Qe=o.events.length;let Ft=Qe,bt,Qt;for(;Ft--;)if(o.events[Ft][0]==="exit"&&o.events[Ft][1].type==="chunkFlow"){if(bt){Qt=o.events[Ft][1].end;break}bt=!0}for(ve(g),Te=Qe;Te<o.events.length;)o.events[Te][1].end={...Qt},Te++;Qd(o.events,Ft+1,0,o.events.slice(Qe)),o.events.length=Te}}function ve(ye){let $e=d.length;for(;$e-- >ye;){const De=d[$e];o.containerState=De[1],De[0].exit.call(o,u)}d.length=ye}function ke(){j.write([null]),Z=void 0,j=void 0,o.containerState._closeFlow=void 0}}function uO(u,o,d){return Ti(u,u.attempt(this.parser.constructs.document,o,d),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function uj(u){if(u===null||Pl(u)||iO(u))return 1;if(nO(u))return 2}function Tv(u,o,d){const g=[];let j=-1;for(;++j<u.length;){const Z=u[j].resolveAll;Z&&!g.includes(Z)&&(o=Z(o,d),g.push(Z))}return o}const Qw={name:"attention",resolveAll:dO,tokenize:hO};function dO(u,o){let d=-1,g,j,Z,S,n,B,D,P;for(;++d<u.length;)if(u[d][0]==="enter"&&u[d][1].type==="attentionSequence"&&u[d][1]._close){for(g=d;g--;)if(u[g][0]==="exit"&&u[g][1].type==="attentionSequence"&&u[g][1]._open&&o.sliceSerialize(u[g][1]).charCodeAt(0)===o.sliceSerialize(u[d][1]).charCodeAt(0)){if((u[g][1]._close||u[d][1]._open)&&(u[d][1].end.offset-u[d][1].start.offset)%3&&!((u[g][1].end.offset-u[g][1].start.offset+u[d][1].end.offset-u[d][1].start.offset)%3))continue;B=u[g][1].end.offset-u[g][1].start.offset>1&&u[d][1].end.offset-u[d][1].start.offset>1?2:1;const G={...u[g][1].end},Y={...u[d][1].start};dj(G,-B),dj(Y,B),S={type:B>1?"strongSequence":"emphasisSequence",start:G,end:{...u[g][1].end}},n={type:B>1?"strongSequence":"emphasisSequence",start:{...u[d][1].start},end:Y},Z={type:B>1?"strongText":"emphasisText",start:{...u[g][1].end},end:{...u[d][1].start}},j={type:B>1?"strong":"emphasis",start:{...S.start},end:{...n.end}},u[g][1].end={...S.start},u[d][1].start={...n.end},D=[],u[g][1].end.offset-u[g][1].start.offset&&(D=qc(D,[["enter",u[g][1],o],["exit",u[g][1],o]])),D=qc(D,[["enter",j,o],["enter",S,o],["exit",S,o],["enter",Z,o]]),D=qc(D,Tv(o.parser.constructs.insideSpan.null,u.slice(g+1,d),o)),D=qc(D,[["exit",Z,o],["enter",n,o],["exit",n,o],["exit",j,o]]),u[d][1].end.offset-u[d][1].start.offset?(P=2,D=qc(D,[["enter",u[d][1],o],["exit",u[d][1],o]])):P=0,Qd(u,g-1,d-g+3,D),d=g+D.length-P-2;break}}for(d=-1;++d<u.length;)u[d][1].type==="attentionSequence"&&(u[d][1].type="data");return u}function hO(u,o){const d=this.parser.constructs.attentionMarkers.null,g=this.previous,j=uj(g);let Z;return S;function S(B){return Z=B,u.enter("attentionSequence"),n(B)}function n(B){if(B===Z)return u.consume(B),n;const D=u.exit("attentionSequence"),P=uj(B),G=!P||P===2&&j||d.includes(B),Y=!j||j===2&&P||d.includes(g);return D._open=!!(Z===42?G:G&&(j||!Y)),D._close=!!(Z===42?Y:Y&&(P||!G)),o(B)}}function dj(u,o){u.column+=o,u.offset+=o,u._bufferIndex+=o}const fO={name:"autolink",tokenize:pO};function pO(u,o,d){let g=0;return j;function j(X){return u.enter("autolink"),u.enter("autolinkMarker"),u.consume(X),u.exit("autolinkMarker"),u.enter("autolinkProtocol"),Z}function Z(X){return Xd(X)?(u.consume(X),S):X===64?d(X):D(X)}function S(X){return X===43||X===45||X===46||vc(X)?(g=1,n(X)):D(X)}function n(X){return X===58?(u.consume(X),g=0,B):(X===43||X===45||X===46||vc(X))&&g++<32?(u.consume(X),n):(g=0,D(X))}function B(X){return X===62?(u.exit("autolinkProtocol"),u.enter("autolinkMarker"),u.consume(X),u.exit("autolinkMarker"),u.exit("autolink"),o):X===null||X===32||X===60||Ww(X)?d(X):(u.consume(X),B)}function D(X){return X===64?(u.consume(X),P):tO(X)?(u.consume(X),D):d(X)}function P(X){return vc(X)?G(X):d(X)}function G(X){return X===46?(u.consume(X),g=0,P):X===62?(u.exit("autolinkProtocol").type="autolinkEmail",u.enter("autolinkMarker"),u.consume(X),u.exit("autolinkMarker"),u.exit("autolink"),o):Y(X)}function Y(X){if((X===45||vc(X))&&g++<63){const ue=X===45?Y:G;return u.consume(X),ue}return d(X)}}const w_={partial:!0,tokenize:mO};function mO(u,o,d){return g;function g(Z){return ri(Z)?Ti(u,j,"linePrefix")(Z):j(Z)}function j(Z){return Z===null||Hr(Z)?o(Z):d(Z)}}const HN={continuation:{tokenize:gO},exit:_O,name:"blockQuote",tokenize:yO};function yO(u,o,d){const g=this;return j;function j(S){if(S===62){const n=g.containerState;return n.open||(u.enter("blockQuote",{_container:!0}),n.open=!0),u.enter("blockQuotePrefix"),u.enter("blockQuoteMarker"),u.consume(S),u.exit("blockQuoteMarker"),Z}return d(S)}function Z(S){return ri(S)?(u.enter("blockQuotePrefixWhitespace"),u.consume(S),u.exit("blockQuotePrefixWhitespace"),u.exit("blockQuotePrefix"),o):(u.exit("blockQuotePrefix"),o(S))}}function gO(u,o,d){const g=this;return j;function j(S){return ri(S)?Ti(u,Z,"linePrefix",g.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(S):Z(S)}function Z(S){return u.attempt(HN,o,d)(S)}}function _O(u){u.exit("blockQuote")}const YN={name:"characterEscape",tokenize:xO};function xO(u,o,d){return g;function g(Z){return u.enter("characterEscape"),u.enter("escapeMarker"),u.consume(Z),u.exit("escapeMarker"),j}function j(Z){return rO(Z)?(u.enter("characterEscapeValue"),u.consume(Z),u.exit("characterEscapeValue"),u.exit("characterEscape"),o):d(Z)}}const $N={name:"characterReference",tokenize:wO};function wO(u,o,d){const g=this;let j=0,Z,S;return n;function n(G){return u.enter("characterReference"),u.enter("characterReferenceMarker"),u.consume(G),u.exit("characterReferenceMarker"),B}function B(G){return G===35?(u.enter("characterReferenceMarkerNumeric"),u.consume(G),u.exit("characterReferenceMarkerNumeric"),D):(u.enter("characterReferenceValue"),Z=31,S=vc,P(G))}function D(G){return G===88||G===120?(u.enter("characterReferenceMarkerHexadecimal"),u.consume(G),u.exit("characterReferenceMarkerHexadecimal"),u.enter("characterReferenceValue"),Z=6,S=aO,P):(u.enter("characterReferenceValue"),Z=7,S=Xw,P(G))}function P(G){if(G===59&&j){const Y=u.exit("characterReferenceValue");return S===vc&&!Rv(g.sliceSerialize(Y))?d(G):(u.enter("characterReferenceMarker"),u.consume(G),u.exit("characterReferenceMarker"),u.exit("characterReference"),o)}return S(G)&&j++<Z?(u.consume(G),P):d(G)}}const hj={partial:!0,tokenize:bO},fj={concrete:!0,name:"codeFenced",tokenize:vO};function vO(u,o,d){const g=this,j={partial:!0,tokenize:De};let Z=0,S=0,n;return B;function B(Te){return D(Te)}function D(Te){const Qe=g.events[g.events.length-1];return Z=Qe&&Qe[1].type==="linePrefix"?Qe[2].sliceSerialize(Qe[1],!0).length:0,n=Te,u.enter("codeFenced"),u.enter("codeFencedFence"),u.enter("codeFencedFenceSequence"),P(Te)}function P(Te){return Te===n?(S++,u.consume(Te),P):S<3?d(Te):(u.exit("codeFencedFenceSequence"),ri(Te)?Ti(u,G,"whitespace")(Te):G(Te))}function G(Te){return Te===null||Hr(Te)?(u.exit("codeFencedFence"),g.interrupt?o(Te):u.check(hj,oe,$e)(Te)):(u.enter("codeFencedFenceInfo"),u.enter("chunkString",{contentType:"string"}),Y(Te))}function Y(Te){return Te===null||Hr(Te)?(u.exit("chunkString"),u.exit("codeFencedFenceInfo"),G(Te)):ri(Te)?(u.exit("chunkString"),u.exit("codeFencedFenceInfo"),Ti(u,X,"whitespace")(Te)):Te===96&&Te===n?d(Te):(u.consume(Te),Y)}function X(Te){return Te===null||Hr(Te)?G(Te):(u.enter("codeFencedFenceMeta"),u.enter("chunkString",{contentType:"string"}),ue(Te))}function ue(Te){return Te===null||Hr(Te)?(u.exit("chunkString"),u.exit("codeFencedFenceMeta"),G(Te)):Te===96&&Te===n?d(Te):(u.consume(Te),ue)}function oe(Te){return u.attempt(j,$e,pe)(Te)}function pe(Te){return u.enter("lineEnding"),u.consume(Te),u.exit("lineEnding"),ve}function ve(Te){return Z>0&&ri(Te)?Ti(u,ke,"linePrefix",Z+1)(Te):ke(Te)}function ke(Te){return Te===null||Hr(Te)?u.check(hj,oe,$e)(Te):(u.enter("codeFlowValue"),ye(Te))}function ye(Te){return Te===null||Hr(Te)?(u.exit("codeFlowValue"),ke(Te)):(u.consume(Te),ye)}function $e(Te){return u.exit("codeFenced"),o(Te)}function De(Te,Qe,Ft){let bt=0;return Qt;function Qt(ht){return Te.enter("lineEnding"),Te.consume(ht),Te.exit("lineEnding"),Gt}function Gt(ht){return Te.enter("codeFencedFence"),ri(ht)?Ti(Te,yt,"linePrefix",g.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(ht):yt(ht)}function yt(ht){return ht===n?(Te.enter("codeFencedFenceSequence"),Ke(ht)):Ft(ht)}function Ke(ht){return ht===n?(bt++,Te.consume(ht),Ke):bt>=S?(Te.exit("codeFencedFenceSequence"),ri(ht)?Ti(Te,st,"whitespace")(ht):st(ht)):Ft(ht)}function st(ht){return ht===null||Hr(ht)?(Te.exit("codeFencedFence"),Qe(ht)):Ft(ht)}}}function bO(u,o,d){const g=this;return j;function j(S){return S===null?d(S):(u.enter("lineEnding"),u.consume(S),u.exit("lineEnding"),Z)}function Z(S){return g.parser.lazy[g.now().line]?d(S):o(S)}}const lw={name:"codeIndented",tokenize:jO},LO={partial:!0,tokenize:ZO};function jO(u,o,d){const g=this;return j;function j(D){return u.enter("codeIndented"),Ti(u,Z,"linePrefix",5)(D)}function Z(D){const P=g.events[g.events.length-1];return P&&P[1].type==="linePrefix"&&P[2].sliceSerialize(P[1],!0).length>=4?S(D):d(D)}function S(D){return D===null?B(D):Hr(D)?u.attempt(LO,S,B)(D):(u.enter("codeFlowValue"),n(D))}function n(D){return D===null||Hr(D)?(u.exit("codeFlowValue"),S(D)):(u.consume(D),n)}function B(D){return u.exit("codeIndented"),o(D)}}function ZO(u,o,d){const g=this;return j;function j(S){return g.parser.lazy[g.now().line]?d(S):Hr(S)?(u.enter("lineEnding"),u.consume(S),u.exit("lineEnding"),j):Ti(u,Z,"linePrefix",5)(S)}function Z(S){const n=g.events[g.events.length-1];return n&&n[1].type==="linePrefix"&&n[2].sliceSerialize(n[1],!0).length>=4?o(S):Hr(S)?j(S):d(S)}}const NO={name:"codeText",previous:SO,resolve:EO,tokenize:zO};function EO(u){let o=u.length-4,d=3,g,j;if((u[d][1].type==="lineEnding"||u[d][1].type==="space")&&(u[o][1].type==="lineEnding"||u[o][1].type==="space")){for(g=d;++g<o;)if(u[g][1].type==="codeTextData"){u[d][1].type="codeTextPadding",u[o][1].type="codeTextPadding",d+=2,o-=2;break}}for(g=d-1,o++;++g<=o;)j===void 0?g!==o&&u[g][1].type!=="lineEnding"&&(j=g):(g===o||u[g][1].type==="lineEnding")&&(u[j][1].type="codeTextData",g!==j+2&&(u[j][1].end=u[g-1][1].end,u.splice(j+2,g-j-2),o-=g-j-2,g=j+2),j=void 0);return u}function SO(u){return u!==96||this.events[this.events.length-1][1].type==="characterEscape"}function zO(u,o,d){let g=0,j,Z;return S;function S(G){return u.enter("codeText"),u.enter("codeTextSequence"),n(G)}function n(G){return G===96?(u.consume(G),g++,n):(u.exit("codeTextSequence"),B(G))}function B(G){return G===null?d(G):G===32?(u.enter("space"),u.consume(G),u.exit("space"),B):G===96?(Z=u.enter("codeTextSequence"),j=0,P(G)):Hr(G)?(u.enter("lineEnding"),u.consume(G),u.exit("lineEnding"),B):(u.enter("codeTextData"),D(G))}function D(G){return G===null||G===32||G===96||Hr(G)?(u.exit("codeTextData"),B(G)):(u.consume(G),D)}function P(G){return G===96?(u.consume(G),j++,P):j===g?(u.exit("codeTextSequence"),u.exit("codeText"),o(G)):(Z.type="codeTextData",D(G))}}class AO{constructor(o){this.left=o?[...o]:[],this.right=[]}get(o){if(o<0||o>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+o+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return o<this.left.length?this.left[o]:this.right[this.right.length-o+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(o,d){const g=d??Number.POSITIVE_INFINITY;return g<this.left.length?this.left.slice(o,g):o>this.left.length?this.right.slice(this.right.length-g+this.left.length,this.right.length-o+this.left.length).reverse():this.left.slice(o).concat(this.right.slice(this.right.length-g+this.left.length).reverse())}splice(o,d,g){const j=d||0;this.setCursor(Math.trunc(o));const Z=this.right.splice(this.right.length-j,Number.POSITIVE_INFINITY);return g&&sg(this.left,g),Z.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(o){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(o)}pushMany(o){this.setCursor(Number.POSITIVE_INFINITY),sg(this.left,o)}unshift(o){this.setCursor(0),this.right.push(o)}unshiftMany(o){this.setCursor(0),sg(this.right,o.reverse())}setCursor(o){if(!(o===this.left.length||o>this.left.length&&this.right.length===0||o<0&&this.left.length===0))if(o<this.left.length){const d=this.left.splice(o,Number.POSITIVE_INFINITY);sg(this.right,d.reverse())}else{const d=this.right.splice(this.left.length+this.right.length-o,Number.POSITIVE_INFINITY);sg(this.left,d.reverse())}}}function sg(u,o){let d=0;if(o.length<1e4)u.push(...o);else for(;d<o.length;)u.push(...o.slice(d,d+1e4)),d+=1e4}function qN(u){const o={};let d=-1,g,j,Z,S,n,B,D;const P=new AO(u);for(;++d<P.length;){for(;d in o;)d=o[d];if(g=P.get(d),d&&g[1].type==="chunkFlow"&&P.get(d-1)[1].type==="listItemPrefix"&&(B=g[1]._tokenizer.events,Z=0,Z<B.length&&B[Z][1].type==="lineEndingBlank"&&(Z+=2),Z<B.length&&B[Z][1].type==="content"))for(;++Z<B.length&&B[Z][1].type!=="content";)B[Z][1].type==="chunkText"&&(B[Z][1]._isInFirstContentOfListItem=!0,Z++);if(g[0]==="enter")g[1].contentType&&(Object.assign(o,RO(P,d)),d=o[d],D=!0);else if(g[1]._container){for(Z=d,j=void 0;Z--;)if(S=P.get(Z),S[1].type==="lineEnding"||S[1].type==="lineEndingBlank")S[0]==="enter"&&(j&&(P.get(j)[1].type="lineEndingBlank"),S[1].type="lineEnding",j=Z);else if(!(S[1].type==="linePrefix"||S[1].type==="listItemIndent"))break;j&&(g[1].end={...P.get(j)[1].start},n=P.slice(j,d),n.unshift(g),P.splice(j,d-j+1,n))}}return Qd(u,0,Number.POSITIVE_INFINITY,P.slice(0)),!D}function RO(u,o){const d=u.get(o)[1],g=u.get(o)[2];let j=o-1;const Z=[];let S=d._tokenizer;S||(S=g.parser[d.contentType](d.start),d._contentTypeTextTrailing&&(S._contentTypeTextTrailing=!0));const n=S.events,B=[],D={};let P,G,Y=-1,X=d,ue=0,oe=0;const pe=[oe];for(;X;){for(;u.get(++j)[1]!==X;);Z.push(j),X._tokenizer||(P=g.sliceStream(X),X.next||P.push(null),G&&S.defineSkip(X.start),X._isInFirstContentOfListItem&&(S._gfmTasklistFirstContentOfListItem=!0),S.write(P),X._isInFirstContentOfListItem&&(S._gfmTasklistFirstContentOfListItem=void 0)),G=X,X=X.next}for(X=d;++Y<n.length;)n[Y][0]==="exit"&&n[Y-1][0]==="enter"&&n[Y][1].type===n[Y-1][1].type&&n[Y][1].start.line!==n[Y][1].end.line&&(oe=Y+1,pe.push(oe),X._tokenizer=void 0,X.previous=void 0,X=X.next);for(S.events=[],X?(X._tokenizer=void 0,X.previous=void 0):pe.pop(),Y=pe.length;Y--;){const ve=n.slice(pe[Y],pe[Y+1]),ke=Z.pop();B.push([ke,ke+ve.length-1]),u.splice(ke,2,ve)}for(B.reverse(),Y=-1;++Y<B.length;)D[ue+B[Y][0]]=ue+B[Y][1],ue+=B[Y][1]-B[Y][0]-1;return D}const TO={resolve:MO,tokenize:BO},VO={partial:!0,tokenize:IO};function MO(u){return qN(u),u}function BO(u,o){let d;return g;function g(n){return u.enter("content"),d=u.enter("chunkContent",{contentType:"content"}),j(n)}function j(n){return n===null?Z(n):Hr(n)?u.check(VO,S,Z)(n):(u.consume(n),j)}function Z(n){return u.exit("chunkContent"),u.exit("content"),o(n)}function S(n){return u.consume(n),u.exit("chunkContent"),d.next=u.enter("chunkContent",{contentType:"content",previous:d}),d=d.next,j}}function IO(u,o,d){const g=this;return j;function j(S){return u.exit("chunkContent"),u.enter("lineEnding"),u.consume(S),u.exit("lineEnding"),Ti(u,Z,"linePrefix")}function Z(S){if(S===null||Hr(S))return d(S);const n=g.events[g.events.length-1];return!g.parser.constructs.disable.null.includes("codeIndented")&&n&&n[1].type==="linePrefix"&&n[2].sliceSerialize(n[1],!0).length>=4?o(S):u.interrupt(g.parser.constructs.flow,d,o)(S)}}function KN(u,o,d,g,j,Z,S,n,B){const D=B||Number.POSITIVE_INFINITY;let P=0;return G;function G(ve){return ve===60?(u.enter(g),u.enter(j),u.enter(Z),u.consume(ve),u.exit(Z),Y):ve===null||ve===32||ve===41||Ww(ve)?d(ve):(u.enter(g),u.enter(S),u.enter(n),u.enter("chunkString",{contentType:"string"}),oe(ve))}function Y(ve){return ve===62?(u.enter(Z),u.consume(ve),u.exit(Z),u.exit(j),u.exit(g),o):(u.enter(n),u.enter("chunkString",{contentType:"string"}),X(ve))}function X(ve){return ve===62?(u.exit("chunkString"),u.exit(n),Y(ve)):ve===null||ve===60||Hr(ve)?d(ve):(u.consume(ve),ve===92?ue:X)}function ue(ve){return ve===60||ve===62||ve===92?(u.consume(ve),X):X(ve)}function oe(ve){return!P&&(ve===null||ve===41||Pl(ve))?(u.exit("chunkString"),u.exit(n),u.exit(S),u.exit(g),o(ve)):P<D&&ve===40?(u.consume(ve),P++,oe):ve===41?(u.consume(ve),P--,oe):ve===null||ve===32||ve===40||Ww(ve)?d(ve):(u.consume(ve),ve===92?pe:oe)}function pe(ve){return ve===40||ve===41||ve===92?(u.consume(ve),oe):oe(ve)}}function eE(u,o,d,g,j,Z){const S=this;let n=0,B;return D;function D(X){return u.enter(g),u.enter(j),u.consume(X),u.exit(j),u.enter(Z),P}function P(X){return n>999||X===null||X===91||X===93&&!B||X===94&&!n&&"_hiddenFootnoteSupport"in S.parser.constructs?d(X):X===93?(u.exit(Z),u.enter(j),u.consume(X),u.exit(j),u.exit(g),o):Hr(X)?(u.enter("lineEnding"),u.consume(X),u.exit("lineEnding"),P):(u.enter("chunkString",{contentType:"string"}),G(X))}function G(X){return X===null||X===91||X===93||Hr(X)||n++>999?(u.exit("chunkString"),P(X)):(u.consume(X),B||(B=!ri(X)),X===92?Y:G)}function Y(X){return X===91||X===92||X===93?(u.consume(X),n++,G):G(X)}}function tE(u,o,d,g,j,Z){let S;return n;function n(Y){return Y===34||Y===39||Y===40?(u.enter(g),u.enter(j),u.consume(Y),u.exit(j),S=Y===40?41:Y,B):d(Y)}function B(Y){return Y===S?(u.enter(j),u.consume(Y),u.exit(j),u.exit(g),o):(u.enter(Z),D(Y))}function D(Y){return Y===S?(u.exit(Z),B(S)):Y===null?d(Y):Hr(Y)?(u.enter("lineEnding"),u.consume(Y),u.exit("lineEnding"),Ti(u,D,"linePrefix")):(u.enter("chunkString",{contentType:"string"}),P(Y))}function P(Y){return Y===S||Y===null||Hr(Y)?(u.exit("chunkString"),D(Y)):(u.consume(Y),Y===92?G:P)}function G(Y){return Y===S||Y===92?(u.consume(Y),P):P(Y)}}function pg(u,o){let d;return g;function g(j){return Hr(j)?(u.enter("lineEnding"),u.consume(j),u.exit("lineEnding"),d=!0,g):ri(j)?Ti(u,g,d?"linePrefix":"lineSuffix")(j):o(j)}}const kO={name:"definition",tokenize:FO},JO={partial:!0,tokenize:OO};function FO(u,o,d){const g=this;let j;return Z;function Z(X){return u.enter("definition"),S(X)}function S(X){return eE.call(g,u,n,d,"definitionLabel","definitionLabelMarker","definitionLabelString")(X)}function n(X){return j=$m(g.sliceSerialize(g.events[g.events.length-1][1]).slice(1,-1)),X===58?(u.enter("definitionMarker"),u.consume(X),u.exit("definitionMarker"),B):d(X)}function B(X){return Pl(X)?pg(u,D)(X):D(X)}function D(X){return KN(u,P,d,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(X)}function P(X){return u.attempt(JO,G,G)(X)}function G(X){return ri(X)?Ti(u,Y,"whitespace")(X):Y(X)}function Y(X){return X===null||Hr(X)?(u.exit("definition"),g.parser.defined.push(j),o(X)):d(X)}}function OO(u,o,d){return g;function g(n){return Pl(n)?pg(u,j)(n):d(n)}function j(n){return tE(u,Z,d,"definitionTitle","definitionTitleMarker","definitionTitleString")(n)}function Z(n){return ri(n)?Ti(u,S,"whitespace")(n):S(n)}function S(n){return n===null||Hr(n)?o(n):d(n)}}const DO={name:"hardBreakEscape",tokenize:CO};function CO(u,o,d){return g;function g(Z){return u.enter("hardBreakEscape"),u.consume(Z),j}function j(Z){return Hr(Z)?(u.exit("hardBreakEscape"),o(Z)):d(Z)}}const PO={name:"headingAtx",resolve:GO,tokenize:UO};function GO(u,o){let d=u.length-2,g=3,j,Z;return u[g][1].type==="whitespace"&&(g+=2),d-2>g&&u[d][1].type==="whitespace"&&(d-=2),u[d][1].type==="atxHeadingSequence"&&(g===d-1||d-4>g&&u[d-2][1].type==="whitespace")&&(d-=g+1===d?2:4),d>g&&(j={type:"atxHeadingText",start:u[g][1].start,end:u[d][1].end},Z={type:"chunkText",start:u[g][1].start,end:u[d][1].end,contentType:"text"},Qd(u,g,d-g+1,[["enter",j,o],["enter",Z,o],["exit",Z,o],["exit",j,o]])),u}function UO(u,o,d){let g=0;return j;function j(P){return u.enter("atxHeading"),Z(P)}function Z(P){return u.enter("atxHeadingSequence"),S(P)}function S(P){return P===35&&g++<6?(u.consume(P),S):P===null||Pl(P)?(u.exit("atxHeadingSequence"),n(P)):d(P)}function n(P){return P===35?(u.enter("atxHeadingSequence"),B(P)):P===null||Hr(P)?(u.exit("atxHeading"),o(P)):ri(P)?Ti(u,n,"whitespace")(P):(u.enter("atxHeadingText"),D(P))}function B(P){return P===35?(u.consume(P),B):(u.exit("atxHeadingSequence"),n(P))}function D(P){return P===null||P===35||Pl(P)?(u.exit("atxHeadingText"),n(P)):(u.consume(P),D)}}const WO=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],pj=["pre","script","style","textarea"],XO={concrete:!0,name:"htmlFlow",resolveTo:YO,tokenize:$O},QO={partial:!0,tokenize:KO},HO={partial:!0,tokenize:qO};function YO(u){let o=u.length;for(;o--&&!(u[o][0]==="enter"&&u[o][1].type==="htmlFlow"););return o>1&&u[o-2][1].type==="linePrefix"&&(u[o][1].start=u[o-2][1].start,u[o+1][1].start=u[o-2][1].start,u.splice(o-2,2)),u}function $O(u,o,d){const g=this;let j,Z,S,n,B;return D;function D(Be){return P(Be)}function P(Be){return u.enter("htmlFlow"),u.enter("htmlFlowData"),u.consume(Be),G}function G(Be){return Be===33?(u.consume(Be),Y):Be===47?(u.consume(Be),Z=!0,oe):Be===63?(u.consume(Be),j=3,g.interrupt?o:ze):Xd(Be)?(u.consume(Be),S=String.fromCharCode(Be),pe):d(Be)}function Y(Be){return Be===45?(u.consume(Be),j=2,X):Be===91?(u.consume(Be),j=5,n=0,ue):Xd(Be)?(u.consume(Be),j=4,g.interrupt?o:ze):d(Be)}function X(Be){return Be===45?(u.consume(Be),g.interrupt?o:ze):d(Be)}function ue(Be){const ba="CDATA[";return Be===ba.charCodeAt(n++)?(u.consume(Be),n===ba.length?g.interrupt?o:yt:ue):d(Be)}function oe(Be){return Xd(Be)?(u.consume(Be),S=String.fromCharCode(Be),pe):d(Be)}function pe(Be){if(Be===null||Be===47||Be===62||Pl(Be)){const ba=Be===47,lr=S.toLowerCase();return!ba&&!Z&&pj.includes(lr)?(j=1,g.interrupt?o(Be):yt(Be)):WO.includes(S.toLowerCase())?(j=6,ba?(u.consume(Be),ve):g.interrupt?o(Be):yt(Be)):(j=7,g.interrupt&&!g.parser.lazy[g.now().line]?d(Be):Z?ke(Be):ye(Be))}return Be===45||vc(Be)?(u.consume(Be),S+=String.fromCharCode(Be),pe):d(Be)}function ve(Be){return Be===62?(u.consume(Be),g.interrupt?o:yt):d(Be)}function ke(Be){return ri(Be)?(u.consume(Be),ke):Qt(Be)}function ye(Be){return Be===47?(u.consume(Be),Qt):Be===58||Be===95||Xd(Be)?(u.consume(Be),$e):ri(Be)?(u.consume(Be),ye):Qt(Be)}function $e(Be){return Be===45||Be===46||Be===58||Be===95||vc(Be)?(u.consume(Be),$e):De(Be)}function De(Be){return Be===61?(u.consume(Be),Te):ri(Be)?(u.consume(Be),De):ye(Be)}function Te(Be){return Be===null||Be===60||Be===61||Be===62||Be===96?d(Be):Be===34||Be===39?(u.consume(Be),B=Be,Qe):ri(Be)?(u.consume(Be),Te):Ft(Be)}function Qe(Be){return Be===B?(u.consume(Be),B=null,bt):Be===null||Hr(Be)?d(Be):(u.consume(Be),Qe)}function Ft(Be){return Be===null||Be===34||Be===39||Be===47||Be===60||Be===61||Be===62||Be===96||Pl(Be)?De(Be):(u.consume(Be),Ft)}function bt(Be){return Be===47||Be===62||ri(Be)?ye(Be):d(Be)}function Qt(Be){return Be===62?(u.consume(Be),Gt):d(Be)}function Gt(Be){return Be===null||Hr(Be)?yt(Be):ri(Be)?(u.consume(Be),Gt):d(Be)}function yt(Be){return Be===45&&j===2?(u.consume(Be),Wt):Be===60&&j===1?(u.consume(Be),qt):Be===62&&j===4?(u.consume(Be),Ye):Be===63&&j===3?(u.consume(Be),ze):Be===93&&j===5?(u.consume(Be),mt):Hr(Be)&&(j===6||j===7)?(u.exit("htmlFlowData"),u.check(QO,wt,Ke)(Be)):Be===null||Hr(Be)?(u.exit("htmlFlowData"),Ke(Be)):(u.consume(Be),yt)}function Ke(Be){return u.check(HO,st,wt)(Be)}function st(Be){return u.enter("lineEnding"),u.consume(Be),u.exit("lineEnding"),ht}function ht(Be){return Be===null||Hr(Be)?Ke(Be):(u.enter("htmlFlowData"),yt(Be))}function Wt(Be){return Be===45?(u.consume(Be),ze):yt(Be)}function qt(Be){return Be===47?(u.consume(Be),S="",Lt):yt(Be)}function Lt(Be){if(Be===62){const ba=S.toLowerCase();return pj.includes(ba)?(u.consume(Be),Ye):yt(Be)}return Xd(Be)&&S.length<8?(u.consume(Be),S+=String.fromCharCode(Be),Lt):yt(Be)}function mt(Be){return Be===93?(u.consume(Be),ze):yt(Be)}function ze(Be){return Be===62?(u.consume(Be),Ye):Be===45&&j===2?(u.consume(Be),ze):yt(Be)}function Ye(Be){return Be===null||Hr(Be)?(u.exit("htmlFlowData"),wt(Be)):(u.consume(Be),Ye)}function wt(Be){return u.exit("htmlFlow"),o(Be)}}function qO(u,o,d){const g=this;return j;function j(S){return Hr(S)?(u.enter("lineEnding"),u.consume(S),u.exit("lineEnding"),Z):d(S)}function Z(S){return g.parser.lazy[g.now().line]?d(S):o(S)}}function KO(u,o,d){return g;function g(j){return u.enter("lineEnding"),u.consume(j),u.exit("lineEnding"),u.attempt(w_,o,d)}}const eD={name:"htmlText",tokenize:tD};function tD(u,o,d){const g=this;let j,Z,S;return n;function n(ze){return u.enter("htmlText"),u.enter("htmlTextData"),u.consume(ze),B}function B(ze){return ze===33?(u.consume(ze),D):ze===47?(u.consume(ze),De):ze===63?(u.consume(ze),ye):Xd(ze)?(u.consume(ze),Ft):d(ze)}function D(ze){return ze===45?(u.consume(ze),P):ze===91?(u.consume(ze),Z=0,ue):Xd(ze)?(u.consume(ze),ke):d(ze)}function P(ze){return ze===45?(u.consume(ze),X):d(ze)}function G(ze){return ze===null?d(ze):ze===45?(u.consume(ze),Y):Hr(ze)?(S=G,qt(ze)):(u.consume(ze),G)}function Y(ze){return ze===45?(u.consume(ze),X):G(ze)}function X(ze){return ze===62?Wt(ze):ze===45?Y(ze):G(ze)}function ue(ze){const Ye="CDATA[";return ze===Ye.charCodeAt(Z++)?(u.consume(ze),Z===Ye.length?oe:ue):d(ze)}function oe(ze){return ze===null?d(ze):ze===93?(u.consume(ze),pe):Hr(ze)?(S=oe,qt(ze)):(u.consume(ze),oe)}function pe(ze){return ze===93?(u.consume(ze),ve):oe(ze)}function ve(ze){return ze===62?Wt(ze):ze===93?(u.consume(ze),ve):oe(ze)}function ke(ze){return ze===null||ze===62?Wt(ze):Hr(ze)?(S=ke,qt(ze)):(u.consume(ze),ke)}function ye(ze){return ze===null?d(ze):ze===63?(u.consume(ze),$e):Hr(ze)?(S=ye,qt(ze)):(u.consume(ze),ye)}function $e(ze){return ze===62?Wt(ze):ye(ze)}function De(ze){return Xd(ze)?(u.consume(ze),Te):d(ze)}function Te(ze){return ze===45||vc(ze)?(u.consume(ze),Te):Qe(ze)}function Qe(ze){return Hr(ze)?(S=Qe,qt(ze)):ri(ze)?(u.consume(ze),Qe):Wt(ze)}function Ft(ze){return ze===45||vc(ze)?(u.consume(ze),Ft):ze===47||ze===62||Pl(ze)?bt(ze):d(ze)}function bt(ze){return ze===47?(u.consume(ze),Wt):ze===58||ze===95||Xd(ze)?(u.consume(ze),Qt):Hr(ze)?(S=bt,qt(ze)):ri(ze)?(u.consume(ze),bt):Wt(ze)}function Qt(ze){return ze===45||ze===46||ze===58||ze===95||vc(ze)?(u.consume(ze),Qt):Gt(ze)}function Gt(ze){return ze===61?(u.consume(ze),yt):Hr(ze)?(S=Gt,qt(ze)):ri(ze)?(u.consume(ze),Gt):bt(ze)}function yt(ze){return ze===null||ze===60||ze===61||ze===62||ze===96?d(ze):ze===34||ze===39?(u.consume(ze),j=ze,Ke):Hr(ze)?(S=yt,qt(ze)):ri(ze)?(u.consume(ze),yt):(u.consume(ze),st)}function Ke(ze){return ze===j?(u.consume(ze),j=void 0,ht):ze===null?d(ze):Hr(ze)?(S=Ke,qt(ze)):(u.consume(ze),Ke)}function st(ze){return ze===null||ze===34||ze===39||ze===60||ze===61||ze===96?d(ze):ze===47||ze===62||Pl(ze)?bt(ze):(u.consume(ze),st)}function ht(ze){return ze===47||ze===62||Pl(ze)?bt(ze):d(ze)}function Wt(ze){return ze===62?(u.consume(ze),u.exit("htmlTextData"),u.exit("htmlText"),o):d(ze)}function qt(ze){return u.exit("htmlTextData"),u.enter("lineEnding"),u.consume(ze),u.exit("lineEnding"),Lt}function Lt(ze){return ri(ze)?Ti(u,mt,"linePrefix",g.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(ze):mt(ze)}function mt(ze){return u.enter("htmlTextData"),S(ze)}}const Vv={name:"labelEnd",resolveAll:iD,resolveTo:sD,tokenize:oD},aD={tokenize:lD},rD={tokenize:cD},nD={tokenize:uD};function iD(u){let o=-1;const d=[];for(;++o<u.length;){const g=u[o][1];if(d.push(u[o]),g.type==="labelImage"||g.type==="labelLink"||g.type==="labelEnd"){const j=g.type==="labelImage"?4:2;g.type="data",o+=j}}return u.length!==d.length&&Qd(u,0,u.length,d),u}function sD(u,o){let d=u.length,g=0,j,Z,S,n;for(;d--;)if(j=u[d][1],Z){if(j.type==="link"||j.type==="labelLink"&&j._inactive)break;u[d][0]==="enter"&&j.type==="labelLink"&&(j._inactive=!0)}else if(S){if(u[d][0]==="enter"&&(j.type==="labelImage"||j.type==="labelLink")&&!j._balanced&&(Z=d,j.type!=="labelLink")){g=2;break}}else j.type==="labelEnd"&&(S=d);const B={type:u[Z][1].type==="labelLink"?"link":"image",start:{...u[Z][1].start},end:{...u[u.length-1][1].end}},D={type:"label",start:{...u[Z][1].start},end:{...u[S][1].end}},P={type:"labelText",start:{...u[Z+g+2][1].end},end:{...u[S-2][1].start}};return n=[["enter",B,o],["enter",D,o]],n=qc(n,u.slice(Z+1,Z+g+3)),n=qc(n,[["enter",P,o]]),n=qc(n,Tv(o.parser.constructs.insideSpan.null,u.slice(Z+g+4,S-3),o)),n=qc(n,[["exit",P,o],u[S-2],u[S-1],["exit",D,o]]),n=qc(n,u.slice(S+1)),n=qc(n,[["exit",B,o]]),Qd(u,Z,u.length,n),u}function oD(u,o,d){const g=this;let j=g.events.length,Z,S;for(;j--;)if((g.events[j][1].type==="labelImage"||g.events[j][1].type==="labelLink")&&!g.events[j][1]._balanced){Z=g.events[j][1];break}return n;function n(Y){return Z?Z._inactive?G(Y):(S=g.parser.defined.includes($m(g.sliceSerialize({start:Z.end,end:g.now()}))),u.enter("labelEnd"),u.enter("labelMarker"),u.consume(Y),u.exit("labelMarker"),u.exit("labelEnd"),B):d(Y)}function B(Y){return Y===40?u.attempt(aD,P,S?P:G)(Y):Y===91?u.attempt(rD,P,S?D:G)(Y):S?P(Y):G(Y)}function D(Y){return u.attempt(nD,P,G)(Y)}function P(Y){return o(Y)}function G(Y){return Z._balanced=!0,d(Y)}}function lD(u,o,d){return g;function g(G){return u.enter("resource"),u.enter("resourceMarker"),u.consume(G),u.exit("resourceMarker"),j}function j(G){return Pl(G)?pg(u,Z)(G):Z(G)}function Z(G){return G===41?P(G):KN(u,S,n,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(G)}function S(G){return Pl(G)?pg(u,B)(G):P(G)}function n(G){return d(G)}function B(G){return G===34||G===39||G===40?tE(u,D,d,"resourceTitle","resourceTitleMarker","resourceTitleString")(G):P(G)}function D(G){return Pl(G)?pg(u,P)(G):P(G)}function P(G){return G===41?(u.enter("resourceMarker"),u.consume(G),u.exit("resourceMarker"),u.exit("resource"),o):d(G)}}function cD(u,o,d){const g=this;return j;function j(n){return eE.call(g,u,Z,S,"reference","referenceMarker","referenceString")(n)}function Z(n){return g.parser.defined.includes($m(g.sliceSerialize(g.events[g.events.length-1][1]).slice(1,-1)))?o(n):d(n)}function S(n){return d(n)}}function uD(u,o,d){return g;function g(Z){return u.enter("reference"),u.enter("referenceMarker"),u.consume(Z),u.exit("referenceMarker"),j}function j(Z){return Z===93?(u.enter("referenceMarker"),u.consume(Z),u.exit("referenceMarker"),u.exit("reference"),o):d(Z)}}const dD={name:"labelStartImage",resolveAll:Vv.resolveAll,tokenize:hD};function hD(u,o,d){const g=this;return j;function j(n){return u.enter("labelImage"),u.enter("labelImageMarker"),u.consume(n),u.exit("labelImageMarker"),Z}function Z(n){return n===91?(u.enter("labelMarker"),u.consume(n),u.exit("labelMarker"),u.exit("labelImage"),S):d(n)}function S(n){return n===94&&"_hiddenFootnoteSupport"in g.parser.constructs?d(n):o(n)}}const fD={name:"labelStartLink",resolveAll:Vv.resolveAll,tokenize:pD};function pD(u,o,d){const g=this;return j;function j(S){return u.enter("labelLink"),u.enter("labelMarker"),u.consume(S),u.exit("labelMarker"),u.exit("labelLink"),Z}function Z(S){return S===94&&"_hiddenFootnoteSupport"in g.parser.constructs?d(S):o(S)}}const cw={name:"lineEnding",tokenize:mD};function mD(u,o){return d;function d(g){return u.enter("lineEnding"),u.consume(g),u.exit("lineEnding"),Ti(u,o,"linePrefix")}}const Y0={name:"thematicBreak",tokenize:yD};function yD(u,o,d){let g=0,j;return Z;function Z(D){return u.enter("thematicBreak"),S(D)}function S(D){return j=D,n(D)}function n(D){return D===j?(u.enter("thematicBreakSequence"),B(D)):g>=3&&(D===null||Hr(D))?(u.exit("thematicBreak"),o(D)):d(D)}function B(D){return D===j?(u.consume(D),g++,B):(u.exit("thematicBreakSequence"),ri(D)?Ti(u,n,"whitespace")(D):n(D))}}const Dl={continuation:{tokenize:wD},exit:bD,name:"list",tokenize:xD},gD={partial:!0,tokenize:LD},_D={partial:!0,tokenize:vD};function xD(u,o,d){const g=this,j=g.events[g.events.length-1];let Z=j&&j[1].type==="linePrefix"?j[2].sliceSerialize(j[1],!0).length:0,S=0;return n;function n(X){const ue=g.containerState.type||(X===42||X===43||X===45?"listUnordered":"listOrdered");if(ue==="listUnordered"?!g.containerState.marker||X===g.containerState.marker:Xw(X)){if(g.containerState.type||(g.containerState.type=ue,u.enter(ue,{_container:!0})),ue==="listUnordered")return u.enter("listItemPrefix"),X===42||X===45?u.check(Y0,d,D)(X):D(X);if(!g.interrupt||X===49)return u.enter("listItemPrefix"),u.enter("listItemValue"),B(X)}return d(X)}function B(X){return Xw(X)&&++S<10?(u.consume(X),B):(!g.interrupt||S<2)&&(g.containerState.marker?X===g.containerState.marker:X===41||X===46)?(u.exit("listItemValue"),D(X)):d(X)}function D(X){return u.enter("listItemMarker"),u.consume(X),u.exit("listItemMarker"),g.containerState.marker=g.containerState.marker||X,u.check(w_,g.interrupt?d:P,u.attempt(gD,Y,G))}function P(X){return g.containerState.initialBlankLine=!0,Z++,Y(X)}function G(X){return ri(X)?(u.enter("listItemPrefixWhitespace"),u.consume(X),u.exit("listItemPrefixWhitespace"),Y):d(X)}function Y(X){return g.containerState.size=Z+g.sliceSerialize(u.exit("listItemPrefix"),!0).length,o(X)}}function wD(u,o,d){const g=this;return g.containerState._closeFlow=void 0,u.check(w_,j,Z);function j(n){return g.containerState.furtherBlankLines=g.containerState.furtherBlankLines||g.containerState.initialBlankLine,Ti(u,o,"listItemIndent",g.containerState.size+1)(n)}function Z(n){return g.containerState.furtherBlankLines||!ri(n)?(g.containerState.furtherBlankLines=void 0,g.containerState.initialBlankLine=void 0,S(n)):(g.containerState.furtherBlankLines=void 0,g.containerState.initialBlankLine=void 0,u.attempt(_D,o,S)(n))}function S(n){return g.containerState._closeFlow=!0,g.interrupt=void 0,Ti(u,u.attempt(Dl,o,d),"linePrefix",g.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(n)}}function vD(u,o,d){const g=this;return Ti(u,j,"listItemIndent",g.containerState.size+1);function j(Z){const S=g.events[g.events.length-1];return S&&S[1].type==="listItemIndent"&&S[2].sliceSerialize(S[1],!0).length===g.containerState.size?o(Z):d(Z)}}function bD(u){u.exit(this.containerState.type)}function LD(u,o,d){const g=this;return Ti(u,j,"listItemPrefixWhitespace",g.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function j(Z){const S=g.events[g.events.length-1];return!ri(Z)&&S&&S[1].type==="listItemPrefixWhitespace"?o(Z):d(Z)}}const mj={name:"setextUnderline",resolveTo:jD,tokenize:ZD};function jD(u,o){let d=u.length,g,j,Z;for(;d--;)if(u[d][0]==="enter"){if(u[d][1].type==="content"){g=d;break}u[d][1].type==="paragraph"&&(j=d)}else u[d][1].type==="content"&&u.splice(d,1),!Z&&u[d][1].type==="definition"&&(Z=d);const S={type:"setextHeading",start:{...u[g][1].start},end:{...u[u.length-1][1].end}};return u[j][1].type="setextHeadingText",Z?(u.splice(j,0,["enter",S,o]),u.splice(Z+1,0,["exit",u[g][1],o]),u[g][1].end={...u[Z][1].end}):u[g][1]=S,u.push(["exit",S,o]),u}function ZD(u,o,d){const g=this;let j;return Z;function Z(D){let P=g.events.length,G;for(;P--;)if(g.events[P][1].type!=="lineEnding"&&g.events[P][1].type!=="linePrefix"&&g.events[P][1].type!=="content"){G=g.events[P][1].type==="paragraph";break}return!g.parser.lazy[g.now().line]&&(g.interrupt||G)?(u.enter("setextHeadingLine"),j=D,S(D)):d(D)}function S(D){return u.enter("setextHeadingLineSequence"),n(D)}function n(D){return D===j?(u.consume(D),n):(u.exit("setextHeadingLineSequence"),ri(D)?Ti(u,B,"lineSuffix")(D):B(D))}function B(D){return D===null||Hr(D)?(u.exit("setextHeadingLine"),o(D)):d(D)}}const ND={tokenize:ED};function ED(u){const o=this,d=u.attempt(w_,g,u.attempt(this.parser.constructs.flowInitial,j,Ti(u,u.attempt(this.parser.constructs.flow,j,u.attempt(TO,j)),"linePrefix")));return d;function g(Z){if(Z===null){u.consume(Z);return}return u.enter("lineEndingBlank"),u.consume(Z),u.exit("lineEndingBlank"),o.currentConstruct=void 0,d}function j(Z){if(Z===null){u.consume(Z);return}return u.enter("lineEnding"),u.consume(Z),u.exit("lineEnding"),o.currentConstruct=void 0,d}}const SD={resolveAll:rE()},zD=aE("string"),AD=aE("text");function aE(u){return{resolveAll:rE(u==="text"?RD:void 0),tokenize:o};function o(d){const g=this,j=this.parser.constructs[u],Z=d.attempt(j,S,n);return S;function S(P){return D(P)?Z(P):n(P)}function n(P){if(P===null){d.consume(P);return}return d.enter("data"),d.consume(P),B}function B(P){return D(P)?(d.exit("data"),Z(P)):(d.consume(P),B)}function D(P){if(P===null)return!0;const G=j[P];let Y=-1;if(G)for(;++Y<G.length;){const X=G[Y];if(!X.previous||X.previous.call(g,g.previous))return!0}return!1}}}function rE(u){return o;function o(d,g){let j=-1,Z;for(;++j<=d.length;)Z===void 0?d[j]&&d[j][1].type==="data"&&(Z=j,j++):(!d[j]||d[j][1].type!=="data")&&(j!==Z+2&&(d[Z][1].end=d[j-1][1].end,d.splice(Z+2,j-Z-2),j=Z+2),Z=void 0);return u?u(d,g):d}}function RD(u,o){let d=0;for(;++d<=u.length;)if((d===u.length||u[d][1].type==="lineEnding")&&u[d-1][1].type==="data"){const g=u[d-1][1],j=o.sliceStream(g);let Z=j.length,S=-1,n=0,B;for(;Z--;){const D=j[Z];if(typeof D=="string"){for(S=D.length;D.charCodeAt(S-1)===32;)n++,S--;if(S)break;S=-1}else if(D===-2)B=!0,n++;else if(D!==-1){Z++;break}}if(o._contentTypeTextTrailing&&d===u.length&&(n=0),n){const D={type:d===u.length||B||n<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:Z?S:g.start._bufferIndex+S,_index:g.start._index+Z,line:g.end.line,column:g.end.column-n,offset:g.end.offset-n},end:{...g.end}};g.end={...D.start},g.start.offset===g.end.offset?Object.assign(g,D):(u.splice(d,0,["enter",D,o],["exit",D,o]),d+=2)}d++}return u}const TD={42:Dl,43:Dl,45:Dl,48:Dl,49:Dl,50:Dl,51:Dl,52:Dl,53:Dl,54:Dl,55:Dl,56:Dl,57:Dl,62:HN},VD={91:kO},MD={[-2]:lw,[-1]:lw,32:lw},BD={35:PO,42:Y0,45:[mj,Y0],60:XO,61:mj,95:Y0,96:fj,126:fj},ID={38:$N,92:YN},kD={[-5]:cw,[-4]:cw,[-3]:cw,33:dD,38:$N,42:Qw,60:[fO,eD],91:fD,92:[DO,YN],93:Vv,95:Qw,96:NO},JD={null:[Qw,SD]},FD={null:[42,95]},OD={null:[]},DD=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:FD,contentInitial:VD,disable:OD,document:TD,flow:BD,flowInitial:MD,insideSpan:JD,string:ID,text:kD},Symbol.toStringTag,{value:"Module"}));function CD(u,o,d){let g={_bufferIndex:-1,_index:0,line:d&&d.line||1,column:d&&d.column||1,offset:d&&d.offset||0};const j={},Z=[];let S=[],n=[];const B={attempt:Qe(De),check:Qe(Te),consume:ke,enter:ye,exit:$e,interrupt:Qe(Te,{interrupt:!0})},D={code:null,containerState:{},defineSkip:oe,events:[],now:ue,parser:u,previous:null,sliceSerialize:Y,sliceStream:X,write:G};let P=o.tokenize.call(D,B);return o.resolveAll&&Z.push(o),D;function G(Gt){return S=qc(S,Gt),pe(),S[S.length-1]!==null?[]:(Ft(o,0),D.events=Tv(Z,D.events,D),D.events)}function Y(Gt,yt){return GD(X(Gt),yt)}function X(Gt){return PD(S,Gt)}function ue(){const{_bufferIndex:Gt,_index:yt,line:Ke,column:st,offset:ht}=g;return{_bufferIndex:Gt,_index:yt,line:Ke,column:st,offset:ht}}function oe(Gt){j[Gt.line]=Gt.column,Qt()}function pe(){let Gt;for(;g._index<S.length;){const yt=S[g._index];if(typeof yt=="string")for(Gt=g._index,g._bufferIndex<0&&(g._bufferIndex=0);g._index===Gt&&g._bufferIndex<yt.length;)ve(yt.charCodeAt(g._bufferIndex));else ve(yt)}}function ve(Gt){P=P(Gt)}function ke(Gt){Hr(Gt)?(g.line++,g.column=1,g.offset+=Gt===-3?2:1,Qt()):Gt!==-1&&(g.column++,g.offset++),g._bufferIndex<0?g._index++:(g._bufferIndex++,g._bufferIndex===S[g._index].length&&(g._bufferIndex=-1,g._index++)),D.previous=Gt}function ye(Gt,yt){const Ke=yt||{};return Ke.type=Gt,Ke.start=ue(),D.events.push(["enter",Ke,D]),n.push(Ke),Ke}function $e(Gt){const yt=n.pop();return yt.end=ue(),D.events.push(["exit",yt,D]),yt}function De(Gt,yt){Ft(Gt,yt.from)}function Te(Gt,yt){yt.restore()}function Qe(Gt,yt){return Ke;function Ke(st,ht,Wt){let qt,Lt,mt,ze;return Array.isArray(st)?wt(st):"tokenize"in st?wt([st]):Ye(st);function Ye(Ja){return Er;function Er(or){const ka=or!==null&&Ja[or],gr=or!==null&&Ja.null,Pn=[...Array.isArray(ka)?ka:ka?[ka]:[],...Array.isArray(gr)?gr:gr?[gr]:[]];return wt(Pn)(or)}}function wt(Ja){return qt=Ja,Lt=0,Ja.length===0?Wt:Be(Ja[Lt])}function Be(Ja){return Er;function Er(or){return ze=bt(),mt=Ja,Ja.partial||(D.currentConstruct=Ja),Ja.name&&D.parser.constructs.disable.null.includes(Ja.name)?lr():Ja.tokenize.call(yt?Object.assign(Object.create(D),yt):D,B,ba,lr)(or)}}function ba(Ja){return Gt(mt,ze),ht}function lr(Ja){return ze.restore(),++Lt<qt.length?Be(qt[Lt]):Wt}}}function Ft(Gt,yt){Gt.resolveAll&&!Z.includes(Gt)&&Z.push(Gt),Gt.resolve&&Qd(D.events,yt,D.events.length-yt,Gt.resolve(D.events.slice(yt),D)),Gt.resolveTo&&(D.events=Gt.resolveTo(D.events,D))}function bt(){const Gt=ue(),yt=D.previous,Ke=D.currentConstruct,st=D.events.length,ht=Array.from(n);return{from:st,restore:Wt};function Wt(){g=Gt,D.previous=yt,D.currentConstruct=Ke,D.events.length=st,n=ht,Qt()}}function Qt(){g.line in j&&g.column<2&&(g.column=j[g.line],g.offset+=j[g.line]-1)}}function PD(u,o){const d=o.start._index,g=o.start._bufferIndex,j=o.end._index,Z=o.end._bufferIndex;let S;if(d===j)S=[u[d].slice(g,Z)];else{if(S=u.slice(d,j),g>-1){const n=S[0];typeof n=="string"?S[0]=n.slice(g):S.shift()}Z>0&&S.push(u[j].slice(0,Z))}return S}function GD(u,o){let d=-1;const g=[];let j;for(;++d<u.length;){const Z=u[d];let S;if(typeof Z=="string")S=Z;else switch(Z){case-5:{S="\r";break}case-4:{S=`
`;break}case-3:{S=`\r
`;break}case-2:{S=o?" ":"	";break}case-1:{if(!o&&j)continue;S=" ";break}default:S=String.fromCharCode(Z)}j=Z===-2,g.push(S)}return g.join("")}function UD(u){const g={constructs:qF([DD,...(u||{}).extensions||[]]),content:j(sO),defined:[],document:j(lO),flow:j(ND),lazy:{},string:j(zD),text:j(AD)};return g;function j(Z){return S;function S(n){return CD(g,Z,n)}}}function WD(u){for(;!qN(u););return u}const yj=/[\0\t\n\r]/g;function XD(){let u=1,o="",d=!0,g;return j;function j(Z,S,n){const B=[];let D,P,G,Y,X;for(Z=o+(typeof Z=="string"?Z.toString():new TextDecoder(S||void 0).decode(Z)),G=0,o="",d&&(Z.charCodeAt(0)===65279&&G++,d=void 0);G<Z.length;){if(yj.lastIndex=G,D=yj.exec(Z),Y=D&&D.index!==void 0?D.index:Z.length,X=Z.charCodeAt(Y),!D){o=Z.slice(G);break}if(X===10&&G===Y&&g)B.push(-3),g=void 0;else switch(g&&(B.push(-5),g=void 0),G<Y&&(B.push(Z.slice(G,Y)),u+=Y-G),X){case 0:{B.push(65533),u++;break}case 9:{for(P=Math.ceil(u/4)*4,B.push(-2);u++<P;)B.push(-1);break}case 10:{B.push(-4),u=1;break}default:g=!0,u=1}G=Y+1}return n&&(g&&B.push(-5),o&&B.push(o),B.push(null)),B}}const QD=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function HD(u){return u.replace(QD,YD)}function YD(u,o,d){if(o)return o;if(d.charCodeAt(0)===35){const j=d.charCodeAt(1),Z=j===120||j===88;return QN(d.slice(Z?2:1),Z?16:10)}return Rv(d)||u}const nE={}.hasOwnProperty;function $D(u,o,d){return typeof o!="string"&&(d=o,o=void 0),qD(d)(WD(UD(d).document().write(XD()(u,o,!0))))}function qD(u){const o={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:Z(pi),autolinkProtocol:bt,autolinkEmail:bt,atxHeading:Z(Xr),blockQuote:Z(gr),characterEscape:bt,characterReference:bt,codeFenced:Z(Pn),codeFencedFenceInfo:S,codeFencedFenceMeta:S,codeIndented:Z(Pn,S),codeText:Z(qo,S),codeTextData:bt,data:bt,codeFlowValue:bt,definition:Z(ln),definitionDestinationString:S,definitionLabelString:S,definitionTitleString:S,emphasis:Z(bs),hardBreakEscape:Z(Gn),hardBreakTrailing:Z(Gn),htmlFlow:Z(rn,S),htmlFlowData:bt,htmlText:Z(rn,S),htmlTextData:bt,image:Z(Sr),label:S,link:Z(pi),listItem:Z(Tn),listItemValue:Y,listOrdered:Z(di,G),listUnordered:Z(di),paragraph:Z(cs),reference:Be,referenceString:S,resourceDestinationString:S,resourceTitleString:S,setextHeading:Z(Xr),strong:Z(Ls),thematicBreak:Z(Ko)},exit:{atxHeading:B(),atxHeadingSequence:De,autolink:B(),autolinkEmail:ka,autolinkProtocol:or,blockQuote:B(),characterEscapeValue:Qt,characterReferenceMarkerHexadecimal:lr,characterReferenceMarkerNumeric:lr,characterReferenceValue:Ja,characterReference:Er,codeFenced:B(pe),codeFencedFence:oe,codeFencedFenceInfo:X,codeFencedFenceMeta:ue,codeFlowValue:Qt,codeIndented:B(ve),codeText:B(ht),codeTextData:Qt,data:Qt,definition:B(),definitionDestinationString:$e,definitionLabelString:ke,definitionTitleString:ye,emphasis:B(),hardBreakEscape:B(yt),hardBreakTrailing:B(yt),htmlFlow:B(Ke),htmlFlowData:Qt,htmlText:B(st),htmlTextData:Qt,image:B(qt),label:mt,labelText:Lt,lineEnding:Gt,link:B(Wt),listItem:B(),listOrdered:B(),listUnordered:B(),paragraph:B(),referenceString:ba,resourceDestinationString:ze,resourceTitleString:Ye,resource:wt,setextHeading:B(Ft),setextHeadingLineSequence:Qe,setextHeadingText:Te,strong:B(),thematicBreak:B()}};iE(o,(u||{}).mdastExtensions||[]);const d={};return g;function g(aa){let La={type:"root",children:[]};const hr={stack:[La],tokenStack:[],config:o,enter:n,exit:D,buffer:S,resume:P,data:d},wr=[];let nn=-1;for(;++nn<aa.length;)if(aa[nn][1].type==="listOrdered"||aa[nn][1].type==="listUnordered")if(aa[nn][0]==="enter")wr.push(nn);else{const ni=wr.pop();nn=j(aa,ni,nn)}for(nn=-1;++nn<aa.length;){const ni=o[aa[nn][0]];nE.call(ni,aa[nn][1].type)&&ni[aa[nn][1].type].call(Object.assign({sliceSerialize:aa[nn][2].sliceSerialize},hr),aa[nn][1])}if(hr.tokenStack.length>0){const ni=hr.tokenStack[hr.tokenStack.length-1];(ni[1]||gj).call(hr,void 0,ni[0])}for(La.position={start:Wf(aa.length>0?aa[0][1].start:{line:1,column:1,offset:0}),end:Wf(aa.length>0?aa[aa.length-2][1].end:{line:1,column:1,offset:0})},nn=-1;++nn<o.transforms.length;)La=o.transforms[nn](La)||La;return La}function j(aa,La,hr){let wr=La-1,nn=-1,ni=!1,Gs,us,kn,co;for(;++wr<=hr;){const Zi=aa[wr];switch(Zi[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Zi[0]==="enter"?nn++:nn--,co=void 0;break}case"lineEndingBlank":{Zi[0]==="enter"&&(Gs&&!co&&!nn&&!kn&&(kn=wr),co=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:co=void 0}if(!nn&&Zi[0]==="enter"&&Zi[1].type==="listItemPrefix"||nn===-1&&Zi[0]==="exit"&&(Zi[1].type==="listUnordered"||Zi[1].type==="listOrdered")){if(Gs){let ts=wr;for(us=void 0;ts--;){const yi=aa[ts];if(yi[1].type==="lineEnding"||yi[1].type==="lineEndingBlank"){if(yi[0]==="exit")continue;us&&(aa[us][1].type="lineEndingBlank",ni=!0),yi[1].type="lineEnding",us=ts}else if(!(yi[1].type==="linePrefix"||yi[1].type==="blockQuotePrefix"||yi[1].type==="blockQuotePrefixWhitespace"||yi[1].type==="blockQuoteMarker"||yi[1].type==="listItemIndent"))break}kn&&(!us||kn<us)&&(Gs._spread=!0),Gs.end=Object.assign({},us?aa[us][1].start:Zi[1].end),aa.splice(us||wr,0,["exit",Gs,Zi[2]]),wr++,hr++}if(Zi[1].type==="listItemPrefix"){const ts={type:"listItem",_spread:!1,start:Object.assign({},Zi[1].start),end:void 0};Gs=ts,aa.splice(wr,0,["enter",ts,Zi[2]]),wr++,hr++,kn=void 0,co=!0}}}return aa[La][1]._spread=ni,hr}function Z(aa,La){return hr;function hr(wr){n.call(this,aa(wr),wr),La&&La.call(this,wr)}}function S(){this.stack.push({type:"fragment",children:[]})}function n(aa,La,hr){this.stack[this.stack.length-1].children.push(aa),this.stack.push(aa),this.tokenStack.push([La,hr||void 0]),aa.position={start:Wf(La.start),end:void 0}}function B(aa){return La;function La(hr){aa&&aa.call(this,hr),D.call(this,hr)}}function D(aa,La){const hr=this.stack.pop(),wr=this.tokenStack.pop();if(wr)wr[0].type!==aa.type&&(La?La.call(this,aa,wr[0]):(wr[1]||gj).call(this,aa,wr[0]));else throw new Error("Cannot close `"+aa.type+"` ("+fg({start:aa.start,end:aa.end})+"): its not open");hr.position.end=Wf(aa.end)}function P(){return YF(this.stack.pop())}function G(){this.data.expectingFirstListItemValue=!0}function Y(aa){if(this.data.expectingFirstListItemValue){const La=this.stack[this.stack.length-2];La.start=Number.parseInt(this.sliceSerialize(aa),10),this.data.expectingFirstListItemValue=void 0}}function X(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.lang=aa}function ue(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.meta=aa}function oe(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function pe(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.value=aa.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function ve(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.value=aa.replace(/(\r?\n|\r)$/g,"")}function ke(aa){const La=this.resume(),hr=this.stack[this.stack.length-1];hr.label=La,hr.identifier=$m(this.sliceSerialize(aa)).toLowerCase()}function ye(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.title=aa}function $e(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.url=aa}function De(aa){const La=this.stack[this.stack.length-1];if(!La.depth){const hr=this.sliceSerialize(aa).length;La.depth=hr}}function Te(){this.data.setextHeadingSlurpLineEnding=!0}function Qe(aa){const La=this.stack[this.stack.length-1];La.depth=this.sliceSerialize(aa).codePointAt(0)===61?1:2}function Ft(){this.data.setextHeadingSlurpLineEnding=void 0}function bt(aa){const hr=this.stack[this.stack.length-1].children;let wr=hr[hr.length-1];(!wr||wr.type!=="text")&&(wr=Xi(),wr.position={start:Wf(aa.start),end:void 0},hr.push(wr)),this.stack.push(wr)}function Qt(aa){const La=this.stack.pop();La.value+=this.sliceSerialize(aa),La.position.end=Wf(aa.end)}function Gt(aa){const La=this.stack[this.stack.length-1];if(this.data.atHardBreak){const hr=La.children[La.children.length-1];hr.position.end=Wf(aa.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&o.canContainEols.includes(La.type)&&(bt.call(this,aa),Qt.call(this,aa))}function yt(){this.data.atHardBreak=!0}function Ke(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.value=aa}function st(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.value=aa}function ht(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.value=aa}function Wt(){const aa=this.stack[this.stack.length-1];if(this.data.inReference){const La=this.data.referenceType||"shortcut";aa.type+="Reference",aa.referenceType=La,delete aa.url,delete aa.title}else delete aa.identifier,delete aa.label;this.data.referenceType=void 0}function qt(){const aa=this.stack[this.stack.length-1];if(this.data.inReference){const La=this.data.referenceType||"shortcut";aa.type+="Reference",aa.referenceType=La,delete aa.url,delete aa.title}else delete aa.identifier,delete aa.label;this.data.referenceType=void 0}function Lt(aa){const La=this.sliceSerialize(aa),hr=this.stack[this.stack.length-2];hr.label=HD(La),hr.identifier=$m(La).toLowerCase()}function mt(){const aa=this.stack[this.stack.length-1],La=this.resume(),hr=this.stack[this.stack.length-1];if(this.data.inReference=!0,hr.type==="link"){const wr=aa.children;hr.children=wr}else hr.alt=La}function ze(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.url=aa}function Ye(){const aa=this.resume(),La=this.stack[this.stack.length-1];La.title=aa}function wt(){this.data.inReference=void 0}function Be(){this.data.referenceType="collapsed"}function ba(aa){const La=this.resume(),hr=this.stack[this.stack.length-1];hr.label=La,hr.identifier=$m(this.sliceSerialize(aa)).toLowerCase(),this.data.referenceType="full"}function lr(aa){this.data.characterReferenceType=aa.type}function Ja(aa){const La=this.sliceSerialize(aa),hr=this.data.characterReferenceType;let wr;hr?(wr=QN(La,hr==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):wr=Rv(La);const nn=this.stack[this.stack.length-1];nn.value+=wr}function Er(aa){const La=this.stack.pop();La.position.end=Wf(aa.end)}function or(aa){Qt.call(this,aa);const La=this.stack[this.stack.length-1];La.url=this.sliceSerialize(aa)}function ka(aa){Qt.call(this,aa);const La=this.stack[this.stack.length-1];La.url="mailto:"+this.sliceSerialize(aa)}function gr(){return{type:"blockquote",children:[]}}function Pn(){return{type:"code",lang:null,meta:null,value:""}}function qo(){return{type:"inlineCode",value:""}}function ln(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function bs(){return{type:"emphasis",children:[]}}function Xr(){return{type:"heading",depth:0,children:[]}}function Gn(){return{type:"break"}}function rn(){return{type:"html",value:""}}function Sr(){return{type:"image",title:null,url:"",alt:null}}function pi(){return{type:"link",title:null,url:"",children:[]}}function di(aa){return{type:"list",ordered:aa.type==="listOrdered",start:null,spread:aa._spread,children:[]}}function Tn(aa){return{type:"listItem",spread:aa._spread,checked:null,children:[]}}function cs(){return{type:"paragraph",children:[]}}function Ls(){return{type:"strong",children:[]}}function Xi(){return{type:"text",value:""}}function Ko(){return{type:"thematicBreak"}}}function Wf(u){return{line:u.line,column:u.column,offset:u.offset}}function iE(u,o){let d=-1;for(;++d<o.length;){const g=o[d];Array.isArray(g)?iE(u,g):KD(u,g)}}function KD(u,o){let d;for(d in o)if(nE.call(o,d))switch(d){case"canContainEols":{const g=o[d];g&&u[d].push(...g);break}case"transforms":{const g=o[d];g&&u[d].push(...g);break}case"enter":case"exit":{const g=o[d];g&&Object.assign(u[d],g);break}}}function gj(u,o){throw u?new Error("Cannot close `"+u.type+"` ("+fg({start:u.start,end:u.end})+"): a different token (`"+o.type+"`, "+fg({start:o.start,end:o.end})+") is open"):new Error("Cannot close document, a token (`"+o.type+"`, "+fg({start:o.start,end:o.end})+") is still open")}function eC(u){const o=this;o.parser=d;function d(g){return $D(g,{...o.data("settings"),...u,extensions:o.data("micromarkExtensions")||[],mdastExtensions:o.data("fromMarkdownExtensions")||[]})}}function tC(u,o){const d={type:"element",tagName:"blockquote",properties:{},children:u.wrap(u.all(o),!0)};return u.patch(o,d),u.applyData(o,d)}function aC(u,o){const d={type:"element",tagName:"br",properties:{},children:[]};return u.patch(o,d),[u.applyData(o,d),{type:"text",value:`
`}]}function rC(u,o){const d=o.value?o.value+`
`:"",g={};o.lang&&(g.className=["language-"+o.lang]);let j={type:"element",tagName:"code",properties:g,children:[{type:"text",value:d}]};return o.meta&&(j.data={meta:o.meta}),u.patch(o,j),j=u.applyData(o,j),j={type:"element",tagName:"pre",properties:{},children:[j]},u.patch(o,j),j}function nC(u,o){const d={type:"element",tagName:"del",properties:{},children:u.all(o)};return u.patch(o,d),u.applyData(o,d)}function iC(u,o){const d={type:"element",tagName:"em",properties:{},children:u.all(o)};return u.patch(o,d),u.applyData(o,d)}function sC(u,o){const d=typeof u.options.clobberPrefix=="string"?u.options.clobberPrefix:"user-content-",g=String(o.identifier).toUpperCase(),j=cy(g.toLowerCase()),Z=u.footnoteOrder.indexOf(g);let S,n=u.footnoteCounts.get(g);n===void 0?(n=0,u.footnoteOrder.push(g),S=u.footnoteOrder.length):S=Z+1,n+=1,u.footnoteCounts.set(g,n);const B={type:"element",tagName:"a",properties:{href:"#"+d+"fn-"+j,id:d+"fnref-"+j+(n>1?"-"+n:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(S)}]};u.patch(o,B);const D={type:"element",tagName:"sup",properties:{},children:[B]};return u.patch(o,D),u.applyData(o,D)}function oC(u,o){const d={type:"element",tagName:"h"+o.depth,properties:{},children:u.all(o)};return u.patch(o,d),u.applyData(o,d)}function lC(u,o){if(u.options.allowDangerousHtml){const d={type:"raw",value:o.value};return u.patch(o,d),u.applyData(o,d)}}function sE(u,o){const d=o.referenceType;let g="]";if(d==="collapsed"?g+="[]":d==="full"&&(g+="["+(o.label||o.identifier)+"]"),o.type==="imageReference")return[{type:"text",value:"!["+o.alt+g}];const j=u.all(o),Z=j[0];Z&&Z.type==="text"?Z.value="["+Z.value:j.unshift({type:"text",value:"["});const S=j[j.length-1];return S&&S.type==="text"?S.value+=g:j.push({type:"text",value:g}),j}function cC(u,o){const d=String(o.identifier).toUpperCase(),g=u.definitionById.get(d);if(!g)return sE(u,o);const j={src:cy(g.url||""),alt:o.alt};g.title!==null&&g.title!==void 0&&(j.title=g.title);const Z={type:"element",tagName:"img",properties:j,children:[]};return u.patch(o,Z),u.applyData(o,Z)}function uC(u,o){const d={src:cy(o.url)};o.alt!==null&&o.alt!==void 0&&(d.alt=o.alt),o.title!==null&&o.title!==void 0&&(d.title=o.title);const g={type:"element",tagName:"img",properties:d,children:[]};return u.patch(o,g),u.applyData(o,g)}function dC(u,o){const d={type:"text",value:o.value.replace(/\r?\n|\r/g," ")};u.patch(o,d);const g={type:"element",tagName:"code",properties:{},children:[d]};return u.patch(o,g),u.applyData(o,g)}function hC(u,o){const d=String(o.identifier).toUpperCase(),g=u.definitionById.get(d);if(!g)return sE(u,o);const j={href:cy(g.url||"")};g.title!==null&&g.title!==void 0&&(j.title=g.title);const Z={type:"element",tagName:"a",properties:j,children:u.all(o)};return u.patch(o,Z),u.applyData(o,Z)}function fC(u,o){const d={href:cy(o.url)};o.title!==null&&o.title!==void 0&&(d.title=o.title);const g={type:"element",tagName:"a",properties:d,children:u.all(o)};return u.patch(o,g),u.applyData(o,g)}function pC(u,o,d){const g=u.all(o),j=d?mC(d):oE(o),Z={},S=[];if(typeof o.checked=="boolean"){const P=g[0];let G;P&&P.type==="element"&&P.tagName==="p"?G=P:(G={type:"element",tagName:"p",properties:{},children:[]},g.unshift(G)),G.children.length>0&&G.children.unshift({type:"text",value:" "}),G.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:o.checked,disabled:!0},children:[]}),Z.className=["task-list-item"]}let n=-1;for(;++n<g.length;){const P=g[n];(j||n!==0||P.type!=="element"||P.tagName!=="p")&&S.push({type:"text",value:`
`}),P.type==="element"&&P.tagName==="p"&&!j?S.push(...P.children):S.push(P)}const B=g[g.length-1];B&&(j||B.type!=="element"||B.tagName!=="p")&&S.push({type:"text",value:`
`});const D={type:"element",tagName:"li",properties:Z,children:S};return u.patch(o,D),u.applyData(o,D)}function mC(u){let o=!1;if(u.type==="list"){o=u.spread||!1;const d=u.children;let g=-1;for(;!o&&++g<d.length;)o=oE(d[g])}return o}function oE(u){const o=u.spread;return o??u.children.length>1}function yC(u,o){const d={},g=u.all(o);let j=-1;for(typeof o.start=="number"&&o.start!==1&&(d.start=o.start);++j<g.length;){const S=g[j];if(S.type==="element"&&S.tagName==="li"&&S.properties&&Array.isArray(S.properties.className)&&S.properties.className.includes("task-list-item")){d.className=["contains-task-list"];break}}const Z={type:"element",tagName:o.ordered?"ol":"ul",properties:d,children:u.wrap(g,!0)};return u.patch(o,Z),u.applyData(o,Z)}function gC(u,o){const d={type:"element",tagName:"p",properties:{},children:u.all(o)};return u.patch(o,d),u.applyData(o,d)}function _C(u,o){const d={type:"root",children:u.wrap(u.all(o))};return u.patch(o,d),u.applyData(o,d)}function xC(u,o){const d={type:"element",tagName:"strong",properties:{},children:u.all(o)};return u.patch(o,d),u.applyData(o,d)}function wC(u,o){const d=u.all(o),g=d.shift(),j=[];if(g){const S={type:"element",tagName:"thead",properties:{},children:u.wrap([g],!0)};u.patch(o.children[0],S),j.push(S)}if(d.length>0){const S={type:"element",tagName:"tbody",properties:{},children:u.wrap(d,!0)},n=Ev(o.children[1]),B=DN(o.children[o.children.length-1]);n&&B&&(S.position={start:n,end:B}),j.push(S)}const Z={type:"element",tagName:"table",properties:{},children:u.wrap(j,!0)};return u.patch(o,Z),u.applyData(o,Z)}function vC(u,o,d){const g=d?d.children:void 0,Z=(g?g.indexOf(o):1)===0?"th":"td",S=d&&d.type==="table"?d.align:void 0,n=S?S.length:o.children.length;let B=-1;const D=[];for(;++B<n;){const G=o.children[B],Y={},X=S?S[B]:void 0;X&&(Y.align=X);let ue={type:"element",tagName:Z,properties:Y,children:[]};G&&(ue.children=u.all(G),u.patch(G,ue),ue=u.applyData(G,ue)),D.push(ue)}const P={type:"element",tagName:"tr",properties:{},children:u.wrap(D,!0)};return u.patch(o,P),u.applyData(o,P)}function bC(u,o){const d={type:"element",tagName:"td",properties:{},children:u.all(o)};return u.patch(o,d),u.applyData(o,d)}const _j=9,xj=32;function LC(u){const o=String(u),d=/\r?\n|\r/g;let g=d.exec(o),j=0;const Z=[];for(;g;)Z.push(wj(o.slice(j,g.index),j>0,!0),g[0]),j=g.index+g[0].length,g=d.exec(o);return Z.push(wj(o.slice(j),j>0,!1)),Z.join("")}function wj(u,o,d){let g=0,j=u.length;if(o){let Z=u.codePointAt(g);for(;Z===_j||Z===xj;)g++,Z=u.codePointAt(g)}if(d){let Z=u.codePointAt(j-1);for(;Z===_j||Z===xj;)j--,Z=u.codePointAt(j-1)}return j>g?u.slice(g,j):""}function jC(u,o){const d={type:"text",value:LC(String(o.value))};return u.patch(o,d),u.applyData(o,d)}function ZC(u,o){const d={type:"element",tagName:"hr",properties:{},children:[]};return u.patch(o,d),u.applyData(o,d)}const NC={blockquote:tC,break:aC,code:rC,delete:nC,emphasis:iC,footnoteReference:sC,heading:oC,html:lC,imageReference:cC,image:uC,inlineCode:dC,linkReference:hC,link:fC,listItem:pC,list:yC,paragraph:gC,root:_C,strong:xC,table:wC,tableCell:bC,tableRow:vC,text:jC,thematicBreak:ZC,toml:D0,yaml:D0,definition:D0,footnoteDefinition:D0};function D0(){}const lE=-1,v_=0,mg=1,d_=2,Mv=3,Bv=4,Iv=5,kv=6,cE=7,uE=8,vj=typeof self=="object"?self:globalThis,EC=(u,o)=>{const d=(j,Z)=>(u.set(Z,j),j),g=j=>{if(u.has(j))return u.get(j);const[Z,S]=o[j];switch(Z){case v_:case lE:return d(S,j);case mg:{const n=d([],j);for(const B of S)n.push(g(B));return n}case d_:{const n=d({},j);for(const[B,D]of S)n[g(B)]=g(D);return n}case Mv:return d(new Date(S),j);case Bv:{const{source:n,flags:B}=S;return d(new RegExp(n,B),j)}case Iv:{const n=d(new Map,j);for(const[B,D]of S)n.set(g(B),g(D));return n}case kv:{const n=d(new Set,j);for(const B of S)n.add(g(B));return n}case cE:{const{name:n,message:B}=S;return d(new vj[n](B),j)}case uE:return d(BigInt(S),j);case"BigInt":return d(Object(BigInt(S)),j);case"ArrayBuffer":return d(new Uint8Array(S).buffer,S);case"DataView":{const{buffer:n}=new Uint8Array(S);return d(new DataView(n),S)}}return d(new vj[Z](S),j)};return g},bj=u=>EC(new Map,u)(0),Um="",{toString:SC}={},{keys:zC}=Object,og=u=>{const o=typeof u;if(o!=="object"||!u)return[v_,o];const d=SC.call(u).slice(8,-1);switch(d){case"Array":return[mg,Um];case"Object":return[d_,Um];case"Date":return[Mv,Um];case"RegExp":return[Bv,Um];case"Map":return[Iv,Um];case"Set":return[kv,Um];case"DataView":return[mg,d]}return d.includes("Array")?[mg,d]:d.includes("Error")?[cE,d]:[d_,d]},C0=([u,o])=>u===v_&&(o==="function"||o==="symbol"),AC=(u,o,d,g)=>{const j=(S,n)=>{const B=g.push(S)-1;return d.set(n,B),B},Z=S=>{if(d.has(S))return d.get(S);let[n,B]=og(S);switch(n){case v_:{let P=S;switch(B){case"bigint":n=uE,P=S.toString();break;case"function":case"symbol":if(u)throw new TypeError("unable to serialize "+B);P=null;break;case"undefined":return j([lE],S)}return j([n,P],S)}case mg:{if(B){let Y=S;return B==="DataView"?Y=new Uint8Array(S.buffer):B==="ArrayBuffer"&&(Y=new Uint8Array(S)),j([B,[...Y]],S)}const P=[],G=j([n,P],S);for(const Y of S)P.push(Z(Y));return G}case d_:{if(B)switch(B){case"BigInt":return j([B,S.toString()],S);case"Boolean":case"Number":case"String":return j([B,S.valueOf()],S)}if(o&&"toJSON"in S)return Z(S.toJSON());const P=[],G=j([n,P],S);for(const Y of zC(S))(u||!C0(og(S[Y])))&&P.push([Z(Y),Z(S[Y])]);return G}case Mv:return j([n,S.toISOString()],S);case Bv:{const{source:P,flags:G}=S;return j([n,{source:P,flags:G}],S)}case Iv:{const P=[],G=j([n,P],S);for(const[Y,X]of S)(u||!(C0(og(Y))||C0(og(X))))&&P.push([Z(Y),Z(X)]);return G}case kv:{const P=[],G=j([n,P],S);for(const Y of S)(u||!C0(og(Y)))&&P.push(Z(Y));return G}}const{message:D}=S;return j([n,{name:B,message:D}],S)};return Z},Lj=(u,{json:o,lossy:d}={})=>{const g=[];return AC(!(o||d),!!o,new Map,g)(u),g},h_=typeof structuredClone=="function"?(u,o)=>o&&("json"in o||"lossy"in o)?bj(Lj(u,o)):structuredClone(u):(u,o)=>bj(Lj(u,o));function RC(u,o){const d=[{type:"text",value:""}];return o>1&&d.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(o)}]}),d}function TC(u,o){return"Back to reference "+(u+1)+(o>1?"-"+o:"")}function VC(u){const o=typeof u.options.clobberPrefix=="string"?u.options.clobberPrefix:"user-content-",d=u.options.footnoteBackContent||RC,g=u.options.footnoteBackLabel||TC,j=u.options.footnoteLabel||"Footnotes",Z=u.options.footnoteLabelTagName||"h2",S=u.options.footnoteLabelProperties||{className:["sr-only"]},n=[];let B=-1;for(;++B<u.footnoteOrder.length;){const D=u.footnoteById.get(u.footnoteOrder[B]);if(!D)continue;const P=u.all(D),G=String(D.identifier).toUpperCase(),Y=cy(G.toLowerCase());let X=0;const ue=[],oe=u.footnoteCounts.get(G);for(;oe!==void 0&&++X<=oe;){ue.length>0&&ue.push({type:"text",value:" "});let ke=typeof d=="string"?d:d(B,X);typeof ke=="string"&&(ke={type:"text",value:ke}),ue.push({type:"element",tagName:"a",properties:{href:"#"+o+"fnref-"+Y+(X>1?"-"+X:""),dataFootnoteBackref:"",ariaLabel:typeof g=="string"?g:g(B,X),className:["data-footnote-backref"]},children:Array.isArray(ke)?ke:[ke]})}const pe=P[P.length-1];if(pe&&pe.type==="element"&&pe.tagName==="p"){const ke=pe.children[pe.children.length-1];ke&&ke.type==="text"?ke.value+=" ":pe.children.push({type:"text",value:" "}),pe.children.push(...ue)}else P.push(...ue);const ve={type:"element",tagName:"li",properties:{id:o+"fn-"+Y},children:u.wrap(P,!0)};u.patch(D,ve),n.push(ve)}if(n.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:Z,properties:{...h_(S),id:"footnote-label"},children:[{type:"text",value:j}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:u.wrap(n,!0)},{type:"text",value:`
`}]}}const dE=function(u){if(u==null)return kC;if(typeof u=="function")return b_(u);if(typeof u=="object")return Array.isArray(u)?MC(u):BC(u);if(typeof u=="string")return IC(u);throw new Error("Expected function, string, or object as test")};function MC(u){const o=[];let d=-1;for(;++d<u.length;)o[d]=dE(u[d]);return b_(g);function g(...j){let Z=-1;for(;++Z<o.length;)if(o[Z].apply(this,j))return!0;return!1}}function BC(u){const o=u;return b_(d);function d(g){const j=g;let Z;for(Z in u)if(j[Z]!==o[Z])return!1;return!0}}function IC(u){return b_(o);function o(d){return d&&d.type===u}}function b_(u){return o;function o(d,g,j){return!!(JC(d)&&u.call(this,d,typeof g=="number"?g:void 0,j||void 0))}}function kC(){return!0}function JC(u){return u!==null&&typeof u=="object"&&"type"in u}const hE=[],FC=!0,jj=!1,OC="skip";function DC(u,o,d,g){let j;typeof o=="function"&&typeof d!="function"?(g=d,d=o):j=o;const Z=dE(j),S=g?-1:1;n(u,void 0,[])();function n(B,D,P){const G=B&&typeof B=="object"?B:{};if(typeof G.type=="string"){const X=typeof G.tagName=="string"?G.tagName:typeof G.name=="string"?G.name:void 0;Object.defineProperty(Y,"name",{value:"node ("+(B.type+(X?"<"+X+">":""))+")"})}return Y;function Y(){let X=hE,ue,oe,pe;if((!o||Z(B,D,P[P.length-1]||void 0))&&(X=CC(d(B,P)),X[0]===jj))return X;if("children"in B&&B.children){const ve=B;if(ve.children&&X[0]!==OC)for(oe=(g?ve.children.length:-1)+S,pe=P.concat(ve);oe>-1&&oe<ve.children.length;){const ke=ve.children[oe];if(ue=n(ke,oe,pe)(),ue[0]===jj)return ue;oe=typeof ue[1]=="number"?ue[1]:oe+S}}return X}}}function CC(u){return Array.isArray(u)?u:typeof u=="number"?[FC,u]:u==null?hE:[u]}function fE(u,o,d,g){let j,Z,S;typeof o=="function"&&typeof d!="function"?(Z=void 0,S=o,j=d):(Z=o,S=d,j=g),DC(u,Z,n,j);function n(B,D){const P=D[D.length-1],G=P?P.children.indexOf(B):void 0;return S(B,G,P)}}const Hw={}.hasOwnProperty,PC={};function GC(u,o){const d=o||PC,g=new Map,j=new Map,Z=new Map,S={...NC,...d.handlers},n={all:D,applyData:WC,definitionById:g,footnoteById:j,footnoteCounts:Z,footnoteOrder:[],handlers:S,one:B,options:d,patch:UC,wrap:QC};return fE(u,function(P){if(P.type==="definition"||P.type==="footnoteDefinition"){const G=P.type==="definition"?g:j,Y=String(P.identifier).toUpperCase();G.has(Y)||G.set(Y,P)}}),n;function B(P,G){const Y=P.type,X=n.handlers[Y];if(Hw.call(n.handlers,Y)&&X)return X(n,P,G);if(n.options.passThrough&&n.options.passThrough.includes(Y)){if("children"in P){const{children:oe,...pe}=P,ve=h_(pe);return ve.children=n.all(P),ve}return h_(P)}return(n.options.unknownHandler||XC)(n,P,G)}function D(P){const G=[];if("children"in P){const Y=P.children;let X=-1;for(;++X<Y.length;){const ue=n.one(Y[X],P);if(ue){if(X&&Y[X-1].type==="break"&&(!Array.isArray(ue)&&ue.type==="text"&&(ue.value=Zj(ue.value)),!Array.isArray(ue)&&ue.type==="element")){const oe=ue.children[0];oe&&oe.type==="text"&&(oe.value=Zj(oe.value))}Array.isArray(ue)?G.push(...ue):G.push(ue)}}}return G}}function UC(u,o){u.position&&(o.position=SF(u))}function WC(u,o){let d=o;if(u&&u.data){const g=u.data.hName,j=u.data.hChildren,Z=u.data.hProperties;if(typeof g=="string")if(d.type==="element")d.tagName=g;else{const S="children"in d?d.children:[d];d={type:"element",tagName:g,properties:{},children:S}}d.type==="element"&&Z&&Object.assign(d.properties,h_(Z)),"children"in d&&d.children&&j!==null&&j!==void 0&&(d.children=j)}return d}function XC(u,o){const d=o.data||{},g="value"in o&&!(Hw.call(d,"hProperties")||Hw.call(d,"hChildren"))?{type:"text",value:o.value}:{type:"element",tagName:"div",properties:{},children:u.all(o)};return u.patch(o,g),u.applyData(o,g)}function QC(u,o){const d=[];let g=-1;for(o&&d.push({type:"text",value:`
`});++g<u.length;)g&&d.push({type:"text",value:`
`}),d.push(u[g]);return o&&u.length>0&&d.push({type:"text",value:`
`}),d}function Zj(u){let o=0,d=u.charCodeAt(o);for(;d===9||d===32;)o++,d=u.charCodeAt(o);return u.slice(o)}function Nj(u,o){const d=GC(u,o),g=d.one(u,void 0),j=VC(d),Z=Array.isArray(g)?{type:"root",children:g}:g||{type:"root",children:[]};return j&&Z.children.push({type:"text",value:`
`},j),Z}function HC(u,o){return u&&"run"in u?async function(d,g){const j=Nj(d,{file:g,...o});await u.run(j,g)}:function(d,g){return Nj(d,{file:g,...u||o})}}function Ej(u){if(u)throw u}var uw,Sj;function YC(){if(Sj)return uw;Sj=1;var u=Object.prototype.hasOwnProperty,o=Object.prototype.toString,d=Object.defineProperty,g=Object.getOwnPropertyDescriptor,j=function(D){return typeof Array.isArray=="function"?Array.isArray(D):o.call(D)==="[object Array]"},Z=function(D){if(!D||o.call(D)!=="[object Object]")return!1;var P=u.call(D,"constructor"),G=D.constructor&&D.constructor.prototype&&u.call(D.constructor.prototype,"isPrototypeOf");if(D.constructor&&!P&&!G)return!1;var Y;for(Y in D);return typeof Y>"u"||u.call(D,Y)},S=function(D,P){d&&P.name==="__proto__"?d(D,P.name,{enumerable:!0,configurable:!0,value:P.newValue,writable:!0}):D[P.name]=P.newValue},n=function(D,P){if(P==="__proto__")if(u.call(D,P)){if(g)return g(D,P).value}else return;return D[P]};return uw=function B(){var D,P,G,Y,X,ue,oe=arguments[0],pe=1,ve=arguments.length,ke=!1;for(typeof oe=="boolean"&&(ke=oe,oe=arguments[1]||{},pe=2),(oe==null||typeof oe!="object"&&typeof oe!="function")&&(oe={});pe<ve;++pe)if(D=arguments[pe],D!=null)for(P in D)G=n(oe,P),Y=n(D,P),oe!==Y&&(ke&&Y&&(Z(Y)||(X=j(Y)))?(X?(X=!1,ue=G&&j(G)?G:[]):ue=G&&Z(G)?G:{},S(oe,{name:P,newValue:B(ke,ue,Y)})):typeof Y<"u"&&S(oe,{name:P,newValue:Y}));return oe},uw}var $C=YC();const dw=ry($C);function Yw(u){if(typeof u!="object"||u===null)return!1;const o=Object.getPrototypeOf(u);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in u)&&!(Symbol.iterator in u)}function qC(){const u=[],o={run:d,use:g};return o;function d(...j){let Z=-1;const S=j.pop();if(typeof S!="function")throw new TypeError("Expected function as last argument, not "+S);n(null,...j);function n(B,...D){const P=u[++Z];let G=-1;if(B){S(B);return}for(;++G<j.length;)(D[G]===null||D[G]===void 0)&&(D[G]=j[G]);j=D,P?KC(P,n)(...D):S(null,...D)}}function g(j){if(typeof j!="function")throw new TypeError("Expected `middelware` to be a function, not "+j);return u.push(j),o}}function KC(u,o){let d;return g;function g(...S){const n=u.length>S.length;let B;n&&S.push(j);try{B=u.apply(this,S)}catch(D){const P=D;if(n&&d)throw P;return j(P)}n||(B&&B.then&&typeof B.then=="function"?B.then(Z,j):B instanceof Error?j(B):Z(B))}function j(S,...n){d||(d=!0,o(S,...n))}function Z(S){j(null,S)}}const Wd={basename:e5,dirname:t5,extname:a5,join:r5,sep:"/"};function e5(u,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');Tg(u);let d=0,g=-1,j=u.length,Z;if(o===void 0||o.length===0||o.length>u.length){for(;j--;)if(u.codePointAt(j)===47){if(Z){d=j+1;break}}else g<0&&(Z=!0,g=j+1);return g<0?"":u.slice(d,g)}if(o===u)return"";let S=-1,n=o.length-1;for(;j--;)if(u.codePointAt(j)===47){if(Z){d=j+1;break}}else S<0&&(Z=!0,S=j+1),n>-1&&(u.codePointAt(j)===o.codePointAt(n--)?n<0&&(g=j):(n=-1,g=S));return d===g?g=S:g<0&&(g=u.length),u.slice(d,g)}function t5(u){if(Tg(u),u.length===0)return".";let o=-1,d=u.length,g;for(;--d;)if(u.codePointAt(d)===47){if(g){o=d;break}}else g||(g=!0);return o<0?u.codePointAt(0)===47?"/":".":o===1&&u.codePointAt(0)===47?"//":u.slice(0,o)}function a5(u){Tg(u);let o=u.length,d=-1,g=0,j=-1,Z=0,S;for(;o--;){const n=u.codePointAt(o);if(n===47){if(S){g=o+1;break}continue}d<0&&(S=!0,d=o+1),n===46?j<0?j=o:Z!==1&&(Z=1):j>-1&&(Z=-1)}return j<0||d<0||Z===0||Z===1&&j===d-1&&j===g+1?"":u.slice(j,d)}function r5(...u){let o=-1,d;for(;++o<u.length;)Tg(u[o]),u[o]&&(d=d===void 0?u[o]:d+"/"+u[o]);return d===void 0?".":n5(d)}function n5(u){Tg(u);const o=u.codePointAt(0)===47;let d=i5(u,!o);return d.length===0&&!o&&(d="."),d.length>0&&u.codePointAt(u.length-1)===47&&(d+="/"),o?"/"+d:d}function i5(u,o){let d="",g=0,j=-1,Z=0,S=-1,n,B;for(;++S<=u.length;){if(S<u.length)n=u.codePointAt(S);else{if(n===47)break;n=47}if(n===47){if(!(j===S-1||Z===1))if(j!==S-1&&Z===2){if(d.length<2||g!==2||d.codePointAt(d.length-1)!==46||d.codePointAt(d.length-2)!==46){if(d.length>2){if(B=d.lastIndexOf("/"),B!==d.length-1){B<0?(d="",g=0):(d=d.slice(0,B),g=d.length-1-d.lastIndexOf("/")),j=S,Z=0;continue}}else if(d.length>0){d="",g=0,j=S,Z=0;continue}}o&&(d=d.length>0?d+"/..":"..",g=2)}else d.length>0?d+="/"+u.slice(j+1,S):d=u.slice(j+1,S),g=S-j-1;j=S,Z=0}else n===46&&Z>-1?Z++:Z=-1}return d}function Tg(u){if(typeof u!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(u))}const s5={cwd:o5};function o5(){return"/"}function $w(u){return!!(u!==null&&typeof u=="object"&&"href"in u&&u.href&&"protocol"in u&&u.protocol&&u.auth===void 0)}function l5(u){if(typeof u=="string")u=new URL(u);else if(!$w(u)){const o=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+u+"`");throw o.code="ERR_INVALID_ARG_TYPE",o}if(u.protocol!=="file:"){const o=new TypeError("The URL must be of scheme file");throw o.code="ERR_INVALID_URL_SCHEME",o}return c5(u)}function c5(u){if(u.hostname!==""){const g=new TypeError('File URL host must be "localhost" or empty on darwin');throw g.code="ERR_INVALID_FILE_URL_HOST",g}const o=u.pathname;let d=-1;for(;++d<o.length;)if(o.codePointAt(d)===37&&o.codePointAt(d+1)===50){const g=o.codePointAt(d+2);if(g===70||g===102){const j=new TypeError("File URL path must not include encoded / characters");throw j.code="ERR_INVALID_FILE_URL_PATH",j}}return decodeURIComponent(o)}const hw=["history","path","basename","stem","extname","dirname"];class pE{constructor(o){let d;o?$w(o)?d={path:o}:typeof o=="string"||u5(o)?d={value:o}:d=o:d={},this.cwd="cwd"in d?"":s5.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let g=-1;for(;++g<hw.length;){const Z=hw[g];Z in d&&d[Z]!==void 0&&d[Z]!==null&&(this[Z]=Z==="history"?[...d[Z]]:d[Z])}let j;for(j in d)hw.includes(j)||(this[j]=d[j])}get basename(){return typeof this.path=="string"?Wd.basename(this.path):void 0}set basename(o){pw(o,"basename"),fw(o,"basename"),this.path=Wd.join(this.dirname||"",o)}get dirname(){return typeof this.path=="string"?Wd.dirname(this.path):void 0}set dirname(o){zj(this.basename,"dirname"),this.path=Wd.join(o||"",this.basename)}get extname(){return typeof this.path=="string"?Wd.extname(this.path):void 0}set extname(o){if(fw(o,"extname"),zj(this.dirname,"extname"),o){if(o.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(o.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Wd.join(this.dirname,this.stem+(o||""))}get path(){return this.history[this.history.length-1]}set path(o){$w(o)&&(o=l5(o)),pw(o,"path"),this.path!==o&&this.history.push(o)}get stem(){return typeof this.path=="string"?Wd.basename(this.path,this.extname):void 0}set stem(o){pw(o,"stem"),fw(o,"stem"),this.path=Wd.join(this.dirname||"",o+(this.extname||""))}fail(o,d,g){const j=this.message(o,d,g);throw j.fatal=!0,j}info(o,d,g){const j=this.message(o,d,g);return j.fatal=void 0,j}message(o,d,g){const j=new $o(o,d,g);return this.path&&(j.name=this.path+":"+j.name,j.file=this.path),j.fatal=!1,this.messages.push(j),j}toString(o){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(o||void 0).decode(this.value)}}function fw(u,o){if(u&&u.includes(Wd.sep))throw new Error("`"+o+"` cannot be a path: did not expect `"+Wd.sep+"`")}function pw(u,o){if(!u)throw new Error("`"+o+"` cannot be empty")}function zj(u,o){if(!u)throw new Error("Setting `"+o+"` requires `path` to be set too")}function u5(u){return!!(u&&typeof u=="object"&&"byteLength"in u&&"byteOffset"in u)}const d5=function(u){const g=this.constructor.prototype,j=g[u],Z=function(){return j.apply(Z,arguments)};return Object.setPrototypeOf(Z,g),Z},h5={}.hasOwnProperty;class Jv extends d5{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=qC()}copy(){const o=new Jv;let d=-1;for(;++d<this.attachers.length;){const g=this.attachers[d];o.use(...g)}return o.data(dw(!0,{},this.namespace)),o}data(o,d){return typeof o=="string"?arguments.length===2?(gw("data",this.frozen),this.namespace[o]=d,this):h5.call(this.namespace,o)&&this.namespace[o]||void 0:o?(gw("data",this.frozen),this.namespace=o,this):this.namespace}freeze(){if(this.frozen)return this;const o=this;for(;++this.freezeIndex<this.attachers.length;){const[d,...g]=this.attachers[this.freezeIndex];if(g[0]===!1)continue;g[0]===!0&&(g[0]=void 0);const j=d.call(o,...g);typeof j=="function"&&this.transformers.use(j)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(o){this.freeze();const d=P0(o),g=this.parser||this.Parser;return mw("parse",g),g(String(d),d)}process(o,d){const g=this;return this.freeze(),mw("process",this.parser||this.Parser),yw("process",this.compiler||this.Compiler),d?j(void 0,d):new Promise(j);function j(Z,S){const n=P0(o),B=g.parse(n);g.run(B,n,function(P,G,Y){if(P||!G||!Y)return D(P);const X=G,ue=g.stringify(X,Y);m5(ue)?Y.value=ue:Y.result=ue,D(P,Y)});function D(P,G){P||!G?S(P):Z?Z(G):d(void 0,G)}}}processSync(o){let d=!1,g;return this.freeze(),mw("processSync",this.parser||this.Parser),yw("processSync",this.compiler||this.Compiler),this.process(o,j),Rj("processSync","process",d),g;function j(Z,S){d=!0,Ej(Z),g=S}}run(o,d,g){Aj(o),this.freeze();const j=this.transformers;return!g&&typeof d=="function"&&(g=d,d=void 0),g?Z(void 0,g):new Promise(Z);function Z(S,n){const B=P0(d);j.run(o,B,D);function D(P,G,Y){const X=G||o;P?n(P):S?S(X):g(void 0,X,Y)}}}runSync(o,d){let g=!1,j;return this.run(o,d,Z),Rj("runSync","run",g),j;function Z(S,n){Ej(S),j=n,g=!0}}stringify(o,d){this.freeze();const g=P0(d),j=this.compiler||this.Compiler;return yw("stringify",j),Aj(o),j(o,g)}use(o,...d){const g=this.attachers,j=this.namespace;if(gw("use",this.frozen),o!=null)if(typeof o=="function")B(o,d);else if(typeof o=="object")Array.isArray(o)?n(o):S(o);else throw new TypeError("Expected usable value, not `"+o+"`");return this;function Z(D){if(typeof D=="function")B(D,[]);else if(typeof D=="object")if(Array.isArray(D)){const[P,...G]=D;B(P,G)}else S(D);else throw new TypeError("Expected usable value, not `"+D+"`")}function S(D){if(!("plugins"in D)&&!("settings"in D))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");n(D.plugins),D.settings&&(j.settings=dw(!0,j.settings,D.settings))}function n(D){let P=-1;if(D!=null)if(Array.isArray(D))for(;++P<D.length;){const G=D[P];Z(G)}else throw new TypeError("Expected a list of plugins, not `"+D+"`")}function B(D,P){let G=-1,Y=-1;for(;++G<g.length;)if(g[G][0]===D){Y=G;break}if(Y===-1)g.push([D,...P]);else if(P.length>0){let[X,...ue]=P;const oe=g[Y][1];Yw(oe)&&Yw(X)&&(X=dw(!0,oe,X)),g[Y]=[D,X,...ue]}}}}const f5=new Jv().freeze();function mw(u,o){if(typeof o!="function")throw new TypeError("Cannot `"+u+"` without `parser`")}function yw(u,o){if(typeof o!="function")throw new TypeError("Cannot `"+u+"` without `compiler`")}function gw(u,o){if(o)throw new Error("Cannot call `"+u+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Aj(u){if(!Yw(u)||typeof u.type!="string")throw new TypeError("Expected node, got `"+u+"`")}function Rj(u,o,d){if(!d)throw new Error("`"+u+"` finished async. Use `"+o+"` instead")}function P0(u){return p5(u)?u:new pE(u)}function p5(u){return!!(u&&typeof u=="object"&&"message"in u&&"messages"in u)}function m5(u){return typeof u=="string"||y5(u)}function y5(u){return!!(u&&typeof u=="object"&&"byteLength"in u&&"byteOffset"in u)}const g5="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Tj=[],Vj={allowDangerousHtml:!0},_5=/^(https?|ircs?|mailto|xmpp)$/i,x5=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function mE(u){const o=w5(u),d=v5(u);return b5(o.runSync(o.parse(d),d),u)}function w5(u){const o=u.rehypePlugins||Tj,d=u.remarkPlugins||Tj,g=u.remarkRehypeOptions?{...u.remarkRehypeOptions,...Vj}:Vj;return f5().use(eC).use(d).use(HC,g).use(o)}function v5(u){const o=u.children||"",d=new pE;return typeof o=="string"&&(d.value=o),d}function b5(u,o){const d=o.allowedElements,g=o.allowElement,j=o.components,Z=o.disallowedElements,S=o.skipHtml,n=o.unwrapDisallowed,B=o.urlTransform||L5;for(const P of x5)Object.hasOwn(o,P.from)&&(""+P.from+(P.to?"use `"+P.to+"` instead":"remove it")+g5+P.id,void 0);return fE(u,D),VF(u,{Fragment:l.Fragment,components:j,ignoreInvalidStyle:!0,jsx:l.jsx,jsxs:l.jsxs,passKeys:!0,passNode:!0});function D(P,G,Y){if(P.type==="raw"&&Y&&typeof G=="number")return S?Y.children.splice(G,1):Y.children[G]={type:"text",value:P.value},G;if(P.type==="element"){let X;for(X in ow)if(Object.hasOwn(ow,X)&&Object.hasOwn(P.properties,X)){const ue=P.properties[X],oe=ow[X];(oe===null||oe.includes(P.tagName))&&(P.properties[X]=B(String(ue||""),X,P))}}if(P.type==="element"){let X=d?!d.includes(P.tagName):Z?Z.includes(P.tagName):!1;if(!X&&g&&typeof G=="number"&&(X=!g(P,G,Y)),X&&Y&&typeof G=="number")return n&&P.children?Y.children.splice(G,1,...P.children):Y.children.splice(G,1),G}}}function L5(u){const o=u.indexOf(":"),d=u.indexOf("?"),g=u.indexOf("#"),j=u.indexOf("/");return o===-1||j!==-1&&o>j||d!==-1&&o>d||g!==-1&&o>g||_5.test(u.slice(0,o))?u:""}function j5(){const u=on(),[o,d]=fe.useState(!0),[g,j]=fe.useState(!1),[Z,S]=fe.useState(null),[n,B]=fe.useState(!1),[D,P]=fe.useState(null);fe.useEffect(()=>{G()},[]);const G=async()=>{d(!0);try{const X=await Lv();S(X);const ue=await ui();if(P(ue),ue){const oe=await Ak(ue.id,"terms");B(oe)}}catch(X){console.error("Error loading terms:",X)}finally{d(!1)}},Y=async()=>{if(!(!D||!Z)){j(!0);try{await Rk(D.id)?(B(!0),alert(" Terms & Conditions accepted successfully!")):alert(" Failed to accept terms. Please try again.")}catch(X){console.error("Error accepting terms:",X),alert(" An error occurred. Please try again.")}finally{j(!1)}}};return o?l.jsx("div",{className:"w-full h-dvh bg-white flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hANjQ6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hANjU6OA","data-yw-s":!0,children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hANjY6MTA","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hANjc6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading Terms & Conditions..."})]})}):Z?l.jsx("div",{className:"w-full h-dvh bg-white","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTE0OjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTE1OjY","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTIzOjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTI0OjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTI1OjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTI5OjE0","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTMxOjEy","data-yw-s":!0,children:[l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTMyOjE0","data-yw-s":!0,children:Z.title}),l.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTMzOjE0","data-yw-s":!0,children:[l.jsx(bl,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTM0OjE2","data-yw-s":!0}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTM1OjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTM1OjIy","data-yw-t":!0,"data-yw-auto":!0,children:"Effective: "}),new Date(Z.effective_date).toLocaleDateString()]}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTM2OjE2","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTM3OjE2","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTM3OjIy","data-yw-t":!0,"data-yw-auto":!0,children:"Version "}),Z.version]})]})]})]})}),D&&n&&l.jsx("div",{className:"flex-none bg-green-50 border-b border-green-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTQ1OjEw","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-2 text-green-800","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTQ2OjEy","data-yw-s":!0,children:[l.jsx(Hd,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTQ3OjE0","data-yw-s":!0}),l.jsx("span",{className:"text-sm font-medium","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTQ4OjE0","data-yw-t":!0,"data-yw-s":!0,children:"You have accepted these terms"})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTU0Ojg","data-yw-s":!0,children:l.jsx("div",{className:"max-w-3xl mx-auto","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTU1OjEw","data-yw-s":!0,children:l.jsx("article",{className:"prose prose-sm max-w-none","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTU2OjEy","data-yw-s":!0,children:l.jsx(mE,{"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTU3OjE0","data-yw-s":!0,children:Z.content})})})}),D&&!n&&l.jsx("div",{className:"flex-none bg-white border-t border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTY0OjEw","data-yw-s":!0,children:l.jsx("button",{onClick:Y,disabled:g,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 active:scale-98 transition-all disabled:opacity-50 disabled:cursor-not-allowed","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTY1OjEy","data-yw-s":!0,children:g?"Accepting...":"Accept Terms & Conditions"})})]})}):l.jsx("div",{className:"w-full h-dvh bg-white","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hANzU6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hANzY6OA","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAODQ6MTA","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAODU6MTI","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAODY6MTQ","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAOTA6MTY","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAOTI6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Terms & Conditions"})]})}),l.jsx("div",{className:"flex-1 flex items-center justify-center px-4","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAOTY6MTA","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAOTc6MTI","data-yw-s":!0,children:[l.jsx(ey,{className:"w-16 h-16 text-gray-400 mx-auto mb-4","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAOTg6MTQ","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 mb-4","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAOTk6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"Terms & Conditions not available"}),l.jsx("button",{onClick:()=>u(-1),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","data-yw":"c3JjL3BhZ2VzL1Rlcm1zUGFnZS50c3hAMTAwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Go Back"})]})})]})})}function Z5(){const u=on(),[o,d]=fe.useState(!0),[g,j]=fe.useState(null);fe.useEffect(()=>{Z()},[]);const Z=async()=>{d(!0);try{const S=await gN();j(S)}catch(S){console.error("Error loading cancellation policy:",S)}finally{d(!1)}};return o?l.jsx("div",{className:"w-full h-dvh bg-white flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDMwOjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDMxOjg","data-yw-s":!0,children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDMyOjEw","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDMzOjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading Cancellation Policy..."})]})}):g?l.jsx("div",{className:"w-full h-dvh bg-white","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDgwOjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDgxOjY","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDg5Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDkwOjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDkxOjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDk1OjE0","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDk3OjEy","data-yw-s":!0,children:[l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDk4OjE0","data-yw-s":!0,children:g.title}),l.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDk5OjE0","data-yw-s":!0,children:[l.jsx(bl,{className:"w-3 h-3","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEwMDoxNg","data-yw-s":!0}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEwMToxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEwMToyMg","data-yw-t":!0,"data-yw-auto":!0,children:"Effective: "}),new Date(g.effective_date).toLocaleDateString()]}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEwMjoxNg","data-yw-t":!0,"data-yw-s":!0,children:""}),l.jsxs("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEwMzoxNg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEwMzoyMg","data-yw-t":!0,"data-yw-auto":!0,children:"Version "}),g.version]})]})]})]})}),l.jsxs("div",{className:"flex-none bg-blue-50 border-b border-blue-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExMDo4","data-yw-s":!0,children:[l.jsx("h2",{className:"text-sm font-semibold text-blue-900 mb-3","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExMToxMA","data-yw-t":!0,"data-yw-s":!0,children:"Quick Reference"}),l.jsxs("div",{className:"space-y-2 text-xs text-blue-800","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExMjoxMA","data-yw-s":!0,children:[l.jsxs("div",{className:"flex justify-between items-center bg-white p-2 rounded","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExMzoxMg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExNDoxNA","data-yw-t":!0,"data-yw-s":!0,children:"12+ hours before"}),l.jsx("span",{className:"font-semibold text-green-600","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExNToxNA","data-yw-t":!0,"data-yw-s":!0,children:"100% Refund"})]}),l.jsxs("div",{className:"flex justify-between items-center bg-white p-2 rounded","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExNzoxMg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExODoxNA","data-yw-t":!0,"data-yw-s":!0,children:"6-12 hours before"}),l.jsx("span",{className:"font-semibold text-yellow-600","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDExOToxNA","data-yw-t":!0,"data-yw-s":!0,children:"50% Refund"})]}),l.jsxs("div",{className:"flex justify-between items-center bg-white p-2 rounded","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEyMToxMg","data-yw-s":!0,children:[l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEyMjoxNA","data-yw-t":!0,"data-yw-s":!0,children:"<6 hours / No-show"}),l.jsx("span",{className:"font-semibold text-red-600","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEyMzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"No Refund"})]})]})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEyOTo4","data-yw-s":!0,children:l.jsx("div",{className:"max-w-3xl mx-auto","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEzMDoxMA","data-yw-s":!0,children:l.jsx("article",{className:"prose prose-sm max-w-none","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEzMToxMg","data-yw-s":!0,children:l.jsx(mE,{"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDEzMjoxNA","data-yw-s":!0,children:g.content})})})})]})}):l.jsx("div",{className:"w-full h-dvh bg-white","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDQxOjY","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDQyOjg","data-yw-s":!0,children:[l.jsx("header",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDUwOjEw","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDUxOjEy","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDUyOjE0","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDU2OjE2","data-yw-s":!0})}),l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDU4OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Cancellation Policy"})]})}),l.jsx("div",{className:"flex-1 flex items-center justify-center px-4","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDYyOjEw","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDYzOjEy","data-yw-s":!0,children:[l.jsx(ey,{className:"w-16 h-16 text-gray-400 mx-auto mb-4","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDY0OjE0","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 mb-4","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDY1OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Cancellation Policy not available"}),l.jsx("button",{onClick:()=>u(-1),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","data-yw":"c3JjL3BhZ2VzL0NhbmNlbGxhdGlvblBvbGljeVBhZ2UudHN4QDY2OjE0","data-yw-t":!0,"data-yw-s":!0,children:"Go Back"})]})})]})})}function N5(){const u=on(),[o,d]=fe.useState(null),[g,j]=fe.useState(!0),[Z,S]=fe.useState(!1),[n,B]=fe.useState("");fe.useEffect(()=>{D()},[]);const D=async()=>{try{const{data:{user:Y}}=await It.auth.getUser();if(!Y){u("/auth");return}const{data:X,error:ue}=await gI(Y.id);if(ue)throw ue;d(X),j(!1)}catch(Y){console.error("Error loading preferences:",Y),j(!1)}},P=async Y=>{if(!o)return;const X=!o[Y],ue={...o,[Y]:X};d(ue),un("light");try{S(!0);const{data:{user:oe}}=await It.auth.getUser();if(!oe)return;const{error:pe}=await _I(oe.id,{[Y]:X});if(pe)throw pe;B("Saved"),setTimeout(()=>B(""),2e3)}catch(oe){console.error("Error updating preferences:",oe),d(pe=>pe?{...pe,[Y]:!X}:null),B("Error saving"),setTimeout(()=>B(""),2e3)}finally{S(!1)}};if(g)return l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hANzc6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hANzg6OA","data-yw-s":!0,children:[l.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-3","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hANzk6MTA","data-yw-s":!0}),l.jsx("div",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAODA6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Loading preferences..."})]})});if(!o)return l.jsx("div",{className:"w-full h-dvh bg-gray-50 flex items-center justify-center","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAODg6Ng","data-yw-s":!0,children:l.jsxs("div",{className:"text-center p-8","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAODk6OA","data-yw-s":!0,children:[l.jsx("p",{className:"text-gray-600","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAOTA6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Failed to load preferences"}),l.jsx("button",{onClick:()=>u(-1),className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAOTE6MTA","data-yw-t":!0,"data-yw-s":!0,children:"Go Back"})]})});const G=[{key:"ride_post_enabled",icon:Wp,title:"New Ride Posts",description:"Get notified when new rides match your preferences"},{key:"chat_message_enabled",icon:uv,title:"Chat Messages",description:"Receive notifications for new chat messages"},{key:"ride_request_enabled",icon:Wp,title:"Ride Requests",description:"Be notified when riders request to join your rides"},{key:"booking_enabled",icon:Xh,title:"Booking Updates",description:"Stay informed about booking confirmations and rejections"},{key:"payment_enabled",icon:Ag,title:"Payment Notifications",description:"Receive updates on payments and refunds"},{key:"rating_enabled",icon:vs,title:"Rating Reminders",description:"Get reminded to rate your completed rides"}];return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTQyOjQ","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTQzOjY","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-4","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTUxOjg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTUyOjEw","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 -ml-2 rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTUzOjEy","data-yw-s":!0,children:l.jsx(ei,{className:"w-6 h-6 text-gray-700","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTU3OjE0","data-yw-s":!0})}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTU5OjEy","data-yw-s":!0,children:[l.jsx("h1",{className:"text-xl font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTYwOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Notification Settings"}),l.jsx("p",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTYxOjE0","data-yw-t":!0,"data-yw-s":!0,children:"Manage your notification preferences"})]}),n&&l.jsx("span",{className:`text-sm font-medium ${n==="Saved"?"text-green-600":"text-red-600"}`,"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTY0OjE0","data-yw-s":!0,children:n})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTc0Ojg","data-yw-s":!0,children:l.jsxs("div",{className:"p-4 space-y-4","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTc1OjEw","data-yw-s":!0,children:[l.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTc3OjEy","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start justify-between","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTc4OjE0","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTc5OjE2","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTgwOjE4","data-yw-s":!0,children:[l.jsx(Xh,{className:"w-5 h-5 text-blue-600","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTgxOjIw","data-yw-s":!0}),l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTgyOjIw","data-yw-t":!0,"data-yw-s":!0,children:"All Notifications"})]}),l.jsx("p",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTg0OjE4","data-yw-t":!0,"data-yw-s":!0,children:"Enable or disable all in-app notifications"})]}),l.jsx("button",{onClick:()=>P("in_app_enabled"),disabled:Z,className:`relative w-14 h-8 rounded-full transition-colors ${o.in_app_enabled?"bg-blue-600":"bg-gray-300"} ${Z?"opacity-50":""}`,"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTg4OjE2","data-yw-s":!0,children:l.jsx("div",{className:`absolute top-1 left-1 w-6 h-6 bg-white rounded-full transition-transform ${o.in_app_enabled?"translate-x-6":"translate-x-0"}`,"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMTk1OjE4","data-yw-s":!0})})]})}),l.jsx("div",{className:"space-y-3","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjA1OjEy","data-yw-s":!0,children:G.map(Y=>{const X=Y.icon,ue=o[Y.key],oe=!o.in_app_enabled||Z;return l.jsx("div",{className:`bg-white rounded-xl p-4 border border-gray-200 ${oe?"opacity-50":""}`,"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjEyOjE4","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start justify-between","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjE4OjIw","data-yw-s":!0,children:[l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjE5OjIy","data-yw-s":!0,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjIwOjI0","data-yw-s":!0,children:[l.jsx(X,{className:"w-5 h-5 text-gray-600","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjIxOjI2","data-yw-s":!0}),l.jsx("h3",{className:"font-semibold text-gray-900","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjIyOjI2","data-yw-s":!0,children:Y.title})]}),l.jsx("p",{className:"text-sm text-gray-500","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjI0OjI0","data-yw-s":!0,children:Y.description})]}),l.jsx("button",{onClick:()=>P(Y.key),disabled:oe,className:`relative w-14 h-8 rounded-full transition-colors ${ue?"bg-blue-600":"bg-gray-300"} ${oe?"cursor-not-allowed":""}`,"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjI2OjIy","data-yw-s":!0,children:l.jsx("div",{className:`absolute top-1 left-1 w-6 h-6 bg-white rounded-full transition-transform ${ue?"translate-x-6":"translate-x-0"}`,"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjMzOjI0","data-yw-s":!0})})]})},Y.key)})}),l.jsx("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-100","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjQ2OjEy","data-yw-s":!0,children:l.jsxs("p",{className:"text-sm text-blue-800","data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjQ3OjE0","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjQ4OjE2","data-yw-t":!0,"data-yw-s":!0,children:"Note:"}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL05vdGlmaWNhdGlvblNldHRpbmdzUGFnZS50c3hAMjQ4OjM4","data-yw-t":!0,"data-yw-auto":!0,children:" Notification preferences are synced across all your devices. Disabling a notification type will prevent you from receiving those notifications."})]})})]})})]})})}function E5(){const u=on(),[o,d]=fe.useState(!1),[g,j]=fe.useState(null),Z="e1a3edf5-28f3-4934-a93d-52061487b3c6",S="00980084-bae2-4443-86f7-d94470d0160e",n=async()=>{d(!0),j(null);try{console.log(" Calling Stripe Edge Function to capture payment..."),console.log("Payment Intent ID:",Z);const{data:B,error:D}=await It.functions.invoke("stripe-payment",{body:{action:"capture",paymentIntentId:Z}});if(D)throw D;console.log(" Capture result:",B),j({success:!0,message:"Payment captured successfully!",details:B})}catch(B){console.error(" Capture error:",B),j({success:!1,message:B.message||"Failed to capture payment",details:B})}finally{d(!1)}};return l.jsx("div",{className:"w-full h-dvh bg-gray-50","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA2NTo0","data-yw-s":!0,children:l.jsxs("div",{className:"w-full h-full flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA2Njo2","data-yw-s":!0,children:[l.jsx("div",{className:"flex-none bg-white border-b border-gray-200 px-4 py-3","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA3NDo4","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-center gap-3","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA3NToxMA","data-yw-s":!0,children:[l.jsx("button",{onClick:()=>u(-1),className:"p-2 hover:bg-gray-100 rounded-lg active:scale-95 transition-all","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA3NjoxMg","data-yw-s":!0,children:l.jsx(ei,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA4MDoxNA","data-yw-s":!0})}),l.jsxs("div",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA4MjoxMg","data-yw-s":!0,children:[l.jsx("h1",{className:"text-lg font-bold text-gray-900","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA4MzoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Manual Payment Capture"}),l.jsx("p",{className:"text-xs text-gray-500","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA4NDoxNA","data-yw-t":!0,"data-yw-s":!0,children:"Admin Tool"})]})]})}),l.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5MDo4","data-yw-s":!0,children:l.jsxs("div",{className:"max-w-2xl mx-auto space-y-6","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5MToxMA","data-yw-s":!0,children:[l.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5MzoxMg","data-yw-s":!0,children:l.jsxs("div",{className:"flex items-start gap-3","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5NDoxNA","data-yw-s":!0,children:[l.jsx(Kc,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5NToxNg","data-yw-s":!0}),l.jsxs("div",{className:"flex-1","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5NjoxNg","data-yw-s":!0,children:[l.jsx("h3",{className:"font-semibold text-yellow-800 mb-1","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5NzoxOA","data-yw-t":!0,"data-yw-s":!0,children:"Purpose"}),l.jsx("p",{className:"text-sm text-yellow-700 mb-3","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEA5ODoxOA","data-yw-t":!0,"data-yw-s":!0,children:"This tool manually captures stuck payments for completed rides."}),l.jsxs("div",{className:"text-sm text-yellow-700 space-y-1 font-mono","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDE6MTg","data-yw-s":!0,children:[l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDI6MjA","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDI6MjM","data-yw-t":!0,"data-yw-s":!0,children:"Ride ID:"})," ",S]}),l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDM6MjA","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDM6MjM","data-yw-t":!0,"data-yw-s":!0,children:"Payment Intent ID:"})," ",Z]}),l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDQ6MjA","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDQ6MjM","data-yw-t":!0,"data-yw-s":!0,children:"Amount:"}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDQ6NDc","data-yw-t":!0,"data-yw-auto":!0,children:" $5.00 CAD"})]}),l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDU6MjA","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDU6MjM","data-yw-t":!0,"data-yw-s":!0,children:"Status:"}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMDU6NDc","data-yw-t":!0,"data-yw-auto":!0,children:" authorized (needs capture)"})]})]})]})]})}),l.jsx("button",{onClick:n,disabled:o||g?.success,className:`w-full py-4 px-6 rounded-lg font-semibold text-white transition-all ${g?.success?"bg-green-600 cursor-not-allowed":o?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 active:scale-98"}`,"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMTI6MTI","data-yw-s":!0,children:o?l.jsxs("div",{className:"flex items-center justify-center gap-2","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMjQ6MTY","data-yw-s":!0,children:[l.jsx(r_,{className:"w-5 h-5 animate-spin","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMjU6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMjY6MTg","data-yw-t":!0,"data-yw-s":!0,children:"Capturing payment..."})]}):g?.success?l.jsxs("div",{className:"flex items-center justify-center gap-2","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMjk6MTY","data-yw-s":!0,children:[l.jsx(Hd,{className:"w-5 h-5","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMzA6MTg","data-yw-s":!0}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxMzE6MTg","data-yw-t":!0,"data-yw-s":!0,children:" Payment Captured"})]}):"Capture Payment Now"}),g&&l.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${g.success?"bg-green-50 border-green-400":"bg-red-50 border-red-400"}`,"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNDA6MTQ","data-yw-s":!0,children:[l.jsx("h3",{className:`font-semibold mb-2 ${g.success?"text-green-900":"text-red-900"}`,"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNDc6MTY","data-yw-s":!0,children:g.success?" Success":" Error"}),l.jsx("p",{className:`text-sm mb-3 ${g.success?"text-green-800":"text-red-800"}`,"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNTQ6MTY","data-yw-s":!0,children:g.message}),g.success&&g.details&&l.jsxs("div",{className:"text-sm text-green-800 space-y-1 font-mono","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNjI6MTg","data-yw-s":!0,children:[l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNjM6MjA","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNjQ6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Captured Amount:"}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNjQ6NTU","data-yw-t":!0,"data-yw-auto":!0,children:" $"}),(g.details.capturedAmount/100).toFixed(2),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNjU6NzI","data-yw-t":!0,"data-yw-auto":!0,children:" CAD"})]}),l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNjc6MjA","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNjg6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Stripe Payment ID:"})," ",g.details.stripePaymentIntentId]}),l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNzE6MjA","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNzI6MjI","data-yw-t":!0,"data-yw-s":!0,children:"Status:"}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNzI6NDY","data-yw-t":!0,"data-yw-auto":!0,children:" succeeded"})]}),g.details.earningCreated&&l.jsxs("p",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNzU6MjI","data-yw-s":!0,children:[l.jsx("strong",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNzY6MjQ","data-yw-t":!0,"data-yw-s":!0,children:"Driver Earning:"}),l.jsx("span",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxNzY6NTY","data-yw-t":!0,"data-yw-auto":!0,children:" Created "})]})]}),!g.success&&g.details&&l.jsx("pre",{className:"text-xs text-red-700 overflow-x-auto p-2 bg-red-100 rounded","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxODI6MTg","data-yw-s":!0,children:JSON.stringify(g.details,null,2)})]}),l.jsxs("div",{className:"bg-gray-100 rounded-lg p-4","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTA6MTI","data-yw-s":!0,children:[l.jsx("h2",{className:"font-semibold text-gray-900 mb-3","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTE6MTQ","data-yw-t":!0,"data-yw-s":!0,children:"What this does:"}),l.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-700","data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTI6MTQ","data-yw-s":!0,children:[l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTM6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Calls the Supabase Edge Function to capture the Stripe payment"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTQ6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Updates payment status from 'authorized' to 'succeeded'"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTU6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Creates driver earnings record"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTY6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Creates payment history record"}),l.jsx("li",{"data-yw":"c3JjL3BhZ2VzL2FkbWluL01hbnVhbFBheW1lbnRDYXB0dXJlLnRzeEAxOTc6MTY","data-yw-t":!0,"data-yw-s":!0,children:"Transfers funds from rider to platform"})]})]})]})})]})})}function S5(){const[u,o]=fe.useState(null),[d,g]=fe.useState(!0);return fe.useEffect(()=>{tT(),(async()=>{try{const S=new Promise(B=>{setTimeout(()=>{console.warn("Auth initialization timeout - continuing without auth"),B(null)},5e3)}),n=await Promise.race([ui(),S]);o(n)}catch(S){console.error("Auth initialization error:",S),o(null)}finally{g(!1)}})();const Z=EM(S=>{o(S)});return()=>{Z.unsubscribe()}},[]),d?l.jsx("div",{className:"w-full h-dvh flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-indigo-50","data-yw":"c3JjL0FwcC50c3hAMTA0OjY","data-yw-s":!0,children:l.jsxs("div",{className:"text-center space-y-4","data-yw":"c3JjL0FwcC50c3hAMTA1Ojg","data-yw-s":!0,children:[l.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto","data-yw":"c3JjL0FwcC50c3hAMTA2OjEw","data-yw-s":!0}),l.jsx("p",{className:"text-gray-600 font-medium","data-yw":"c3JjL0FwcC50c3hAMTA3OjEw","data-yw-t":!0,"data-yw-s":!0,children:"Loading..."})]})}):l.jsx(eT,{"data-yw":"c3JjL0FwcC50c3hAMTE0OjQ","data-yw-s":!0,children:l.jsxs(YR,{"data-yw":"c3JjL0FwcC50c3hAMTE1OjY","data-yw-s":!0,children:[l.jsx(pn,{path:"/",element:u?l.jsx(Rn,{to:u.userType==="driver"?"/driver/home":"/rider/home",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTIxOjE0","data-yw-s":!0}):l.jsx(iI,{"data-yw":"c3JjL0FwcC50c3hAMTIzOjE0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTE3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/auth",element:u?l.jsx(Rn,{to:u.userType==="driver"?"/driver/home":"/rider/home",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTMxOjE0","data-yw-s":!0}):l.jsx(dI,{"data-yw":"c3JjL0FwcC50c3hAMTMzOjE0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTI3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/terms",element:l.jsx(j5,{"data-yw":"c3JjL0FwcC50c3hAMTM5OjM4","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTM5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/cancellation-policy",element:l.jsx(Z5,{"data-yw":"c3JjL0FwcC50c3hAMTQwOjUy","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTQwOjg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/home",element:u?.userType==="driver"?l.jsx(rk,{"data-yw":"c3JjL0FwcC50c3hAMTQ2OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTQ2OjY2","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTQzOjg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/trips",element:u?.userType==="driver"?l.jsx(ok,{"data-yw":"c3JjL0FwcC50c3hAMTUyOjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTUyOjY3","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTQ5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/ride/:rideId",element:u?.userType==="driver"?l.jsx(xk,{"data-yw":"c3JjL0FwcC50c3hAMTU4OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTU4Ojc2","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTU1Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/post-ride",element:u?.userType==="driver"?l.jsx(Vk,{"data-yw":"c3JjL0FwcC50c3hAMTY0OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTY0OjY4","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTYxOjg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/chat/:rideRequestId",element:u?.userType==="driver"?l.jsx(Mk,{"data-yw":"c3JjL0FwcC50c3hAMTcwOjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTcwOjcw","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTY3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/chat",element:u?.userType==="driver"?l.jsx(Bk,{"data-yw":"c3JjL0FwcC50c3hAMTc2OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTc2Ojc0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTczOjg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/profile",element:u?.userType==="driver"?l.jsx(kk,{"data-yw":"c3JjL0FwcC50c3hAMTgyOjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTgyOjY5","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTc5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/ratings",element:u?.userType==="driver"?l.jsx(Jk,{"data-yw":"c3JjL0FwcC50c3hAMTg4OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTg4Ojcz","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTg1Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/earnings",element:u?.userType==="driver"?l.jsx(Fk,{"data-yw":"c3JjL0FwcC50c3hAMTk0OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMTk0OjY4","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTkxOjg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/payout-method",element:u?.userType==="driver"?l.jsx(Ok,{"data-yw":"c3JjL0FwcC50c3hAMjAwOjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjAwOjcy","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMTk3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/payout-history",element:u?.userType==="driver"?l.jsx(Ck,{"data-yw":"c3JjL0FwcC50c3hAMjA2OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjA2Ojc5","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjAzOjg","data-yw-s":!0}),l.jsx(pn,{path:"/admin/manual-payment-capture",element:l.jsx(E5,{"data-yw":"c3JjL0FwcC50c3hAMjExOjE5","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjA5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/license",element:u?.userType==="driver"?l.jsx(Pk,{"data-yw":"c3JjL0FwcC50c3hAMjE2OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjE2Ojc5","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjEzOjg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/vehicle",element:u?.userType==="driver"?l.jsx(Gk,{"data-yw":"c3JjL0FwcC50c3hAMjIyOjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjIyOjc0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjE5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/report-issue",element:u?.userType==="driver"?l.jsx(Xk,{"data-yw":"c3JjL0FwcC50c3hAMjI4OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjI4Ojc3","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjI1Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/sos",element:u?.userType==="driver"?l.jsx(Yk,{"data-yw":"c3JjL0FwcC50c3hAMjM0OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjM0OjY5","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjMxOjg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/edit-ride/:rideId",element:u?.userType==="driver"?l.jsx($k,{"data-yw":"c3JjL0FwcC50c3hAMjQwOjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjQwOjY4","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjM3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/driver/profile/:driverId",element:u?.userType==="driver"?l.jsx(ML,{"data-yw":"c3JjL0FwcC50c3hAMjQ2OjQ5","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjQ2Ojc1","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjQzOjg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/home",element:u?.userType==="rider"?l.jsx(qk,{"data-yw":"c3JjL0FwcC50c3hAMjU0OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjU0OjY0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjUxOjg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/trips",element:u?.userType==="rider"?l.jsx(eJ,{"data-yw":"c3JjL0FwcC50c3hAMjYwOjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjYwOjY1","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjU3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/ride-detail/:requestId",element:u?.userType==="rider"?l.jsx(tJ,{"data-yw":"c3JjL0FwcC50c3hAMjY2OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjY2Ojc0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjYzOjg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/find-ride",element:u?.userType==="rider"?l.jsx(aJ,{"data-yw":"c3JjL0FwcC50c3hAMjcyOjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjcyOjY3","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjY5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/available-rides",element:u?.userType==="rider"?l.jsx(nJ,{"data-yw":"c3JjL0FwcC50c3hAMjc4OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjc4Ojcz","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjc1Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/ride-preview/:rideId",element:u?.userType==="rider"?l.jsx(OJ,{"data-yw":"c3JjL0FwcC50c3hAMjg0OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjg0Ojcw","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjgxOjg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/driver-profile/:driverId",element:u?.userType==="rider"?l.jsx(ML,{"data-yw":"c3JjL0FwcC50c3hAMjkwOjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjkwOjc0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjg3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/chat",element:u?.userType==="rider"?l.jsx(UJ,{"data-yw":"c3JjL0FwcC50c3hAMjk2OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMjk2Ojcy","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjkzOjg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/chat/:conversationId",element:u?.userType==="rider"?l.jsx(GJ,{"data-yw":"c3JjL0FwcC50c3hAMzAyOjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzAyOjY4","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMjk5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/profile",element:u?.userType==="rider"?l.jsx(WJ,{"data-yw":"c3JjL0FwcC50c3hAMzA4OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzA4OjY3","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzA1Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/profile/payment-methods",element:u?.userType==="rider"?l.jsx(XJ,{"data-yw":"c3JjL0FwcC50c3hAMzE0OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzE0Ojcz","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzExOjg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/profile/payment-history",element:u?.userType==="rider"?l.jsx(YJ,{"data-yw":"c3JjL0FwcC50c3hAMzIwOjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzIwOjcz","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzE3Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/profile/report-issue",element:u?.userType==="rider"?l.jsx(KJ,{"data-yw":"c3JjL0FwcC50c3hAMzI2OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzI2Ojc1","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzIzOjg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/profile/ratings",element:u?.userType==="rider"?l.jsx(eF,{"data-yw":"c3JjL0FwcC50c3hAMzMyOjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzMyOjcz","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzI5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/profile/sos",element:u?.userType==="rider"?l.jsx(rF,{"data-yw":"c3JjL0FwcC50c3hAMzM4OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzM4OjY3","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzM1Ojg","data-yw-s":!0}),l.jsx(pn,{path:"/rider/profile/refer",element:u?.userType==="rider"?l.jsx(nF,{"data-yw":"c3JjL0FwcC50c3hAMzQ0OjQ4","data-yw-s":!0}):l.jsx(Rn,{to:"/auth",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzQ0OjY0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzQxOjg","data-yw-s":!0}),l.jsx(pn,{path:"/settings/notifications",element:l.jsx(N5,{"data-yw":"c3JjL0FwcC50c3hAMzQ5OjU1","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzQ5Ojg","data-yw-s":!0}),l.jsx(pn,{path:"*",element:u?l.jsx(Rn,{to:u.userType==="driver"?"/driver/home":"/rider/home",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzU2OjE0","data-yw-s":!0}):l.jsx(Rn,{to:"/",replace:!0,"data-yw":"c3JjL0FwcC50c3hAMzU4OjE0","data-yw-s":!0}),"data-yw":"c3JjL0FwcC50c3hAMzUyOjg","data-yw-s":!0})]})})}sR.createRoot(document.getElementById("root")).render(l.jsx(fe.StrictMode,{"data-yw":"c3JjL21haW4udHN4QDc6Mg","data-yw-s":!0,children:l.jsx(S5,{"data-yw":"c3JjL21haW4udHN4QDg6NA","data-yw-s":!0})}));
//# sourceMappingURL=index-CwY9LzPo.js.map
